<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>libtoxcore: toxcore/onion.h File Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../tox.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">libtoxcore
   </div>
   <div id="projectbrief">The future of instant messaging</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_0b4cb6aa1b49ded7d7b217b80a3955c0.html">toxcore</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">onion.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="../../df/dad/_d_h_t_8h_source.html">DHT.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for onion.h:</div>
<div class="dyncontent">
<div class="center"><img src="../../d7/d4c/onion_8h__incl.png" border="0" usemap="#toxcore_2onion_8h" alt=""/></div>
<map name="toxcore_2onion_8h" id="toxcore_2onion_8h">
<area shape="rect" id="node2" href="../../df/dad/_d_h_t_8h.html" title="DHT.h" alt="" coords="600,80,661,107"/><area shape="rect" id="node3" href="../../dd/d3e/crypto__core_8h.html" title="crypto_core.h" alt="" coords="701,155,803,181"/><area shape="rect" id="node4" href="../../d9/d94/network_8h.html" title="network.h" alt="" coords="591,229,670,256"/><area shape="rect" id="node20" href="../../dd/dec/ping__array_8h.html" title="ping_array.h" alt="" coords="584,155,677,181"/></map>
</div>
</div><div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><img src="../../df/dcf/onion_8h__dep__incl.png" border="0" usemap="#toxcore_2onion_8hdep" alt=""/></div>
<map name="toxcore_2onion_8hdep" id="toxcore_2onion_8hdep">
<area shape="rect" id="node2" href="../../d6/d03/_t_c_p__server_8h.html" title="toxcore/TCP_server.h" alt="" coords="736,80,887,107"/><area shape="rect" id="node32" href="../../d7/dd9/onion__test_8c.html" title="auto_tests/onion_test.c" alt="" coords="184,468,343,495"/><area shape="rect" id="node40" href="../../d7/dfd/onion__announce_8h.html" title="toxcore/onion_announce.h" alt="" coords="427,80,601,107"/><area shape="rect" id="node42" href="../../d4/d18/onion_8c.html" title="toxcore/onion.c" alt="" coords="911,80,1021,107"/><area shape="rect" id="node3" href="../../d0/df3/_t_c_p__client_8h.html" title="toxcore/TCP_client.h" alt="" coords="739,162,884,189"/><area shape="rect" id="node27" href="../../db/d5e/_d_h_t__bootstrap_8c.html" title="other/DHT_bootstrap.c" alt="" coords="1070,617,1225,644"/><area shape="rect" id="node35" href="../../d2/d8d/_t_c_p__test_8c.html" title="auto_tests/TCP_test.c" alt="" coords="939,319,1094,345"/><area shape="rect" id="node38" href="../../d1/d36/tox-bootstrapd_8c.html" title="other/bootstrap_daemon\l/tox&#45;bootstrapd.c" alt="" coords="551,155,714,196"/><area shape="rect" id="node39" href="../../d4/d40/_t_c_p__server_8c.html" title="toxcore/TCP_server.c" alt="" coords="908,162,1059,189"/><area shape="rect" id="node4" href="../../da/d39/_t_c_p__connection_8h.html" title="toxcore/TCP_connection.h" alt="" coords="737,244,915,271"/><area shape="rect" id="node37" href="../../da/da1/_t_c_p__client_8c.html" title="toxcore/TCP_client.c" alt="" coords="568,244,713,271"/><area shape="rect" id="node5" href="../../de/d42/net__crypto_8h.html" title="toxcore/net_crypto.h" alt="" coords="571,319,713,345"/><area shape="rect" id="node36" href="../../d5/d26/_t_c_p__connection_8c.html" title="toxcore/TCP_connection.c" alt="" coords="737,319,915,345"/><area shape="rect" id="node6" href="../../d5/d29/crypto__test_8c.html" title="auto_tests/crypto_test.c" alt="" coords="721,393,883,420"/><area shape="rect" id="node7" href="../../d0/d08/friend__connection_8h.html" title="toxcore/friend_connection.h" alt="" coords="563,468,745,495"/><area shape="rect" id="node31" href="../../d9/d26/onion__client_8h.html" title="toxcore/onion_client.h" alt="" coords="382,393,531,420"/><area shape="rect" id="node34" href="../../d8/dc6/net__crypto_8c.html" title="toxcore/net_crypto.c" alt="" coords="555,393,697,420"/><area shape="rect" id="node8" href="../../d5/d24/friend__requests_8h.html" title="toxcore/friend_requests.h" alt="" coords="696,543,865,569"/><area shape="rect" id="node10" href="../../d4/d30/_messenger_8h.html" title="toxcore/Messenger.h" alt="" coords="499,617,643,644"/><area shape="rect" id="node30" href="../../d2/db1/friend__connection_8c.html" title="toxcore/friend_connection.c" alt="" coords="433,543,616,569"/><area shape="rect" id="node9" href="../../d2/dee/friends__test_8c.html" title="auto_tests/friends\l_test.c" alt="" coords="1036,692,1163,733"/><area shape="rect" id="node28" href="../../d3/dfd/_d_h_t__test_8c.html" title="testing/DHT_test.c" alt="" coords="718,617,851,644"/><area shape="rect" id="node29" href="../../d6/da4/friend__requests_8c.html" title="toxcore/friend_requests.c" alt="" coords="876,617,1045,644"/><area shape="rect" id="node11" href="../../d8/dda/messenger__test_8c.html" title="auto_tests/messenger\l_test.c" alt="" coords="861,692,1012,733"/><area shape="rect" id="node12" href="../../db/de9/_messenger__test_8c.html" title="testing/Messenger_test.c" alt="" coords="5,699,175,726"/><area shape="rect" id="node13" href="../../df/dc1/rtp_8h.html" title="toxav/rtp.h" alt="" coords="199,699,283,726"/><area shape="rect" id="node16" href="../../d9/d06/msi_8h.html" title="toxav/msi.h" alt="" coords="239,856,330,883"/><area shape="rect" id="node20" href="../../dd/de4/toxcore_2group_8h.html" title="toxcore/group.h" alt="" coords="367,699,479,726"/><area shape="rect" id="node24" href="../../d3/d69/tox_8c.html" title="toxcore/tox.c" alt="" coords="629,781,727,808"/><area shape="rect" id="node25" href="../../d8/d8d/_messenger_8c.html" title="toxcore/Messenger.c" alt="" coords="554,699,698,726"/><area shape="rect" id="node26" href="../../da/d84/toxdns_8c.html" title="toxdns/toxdns.c" alt="" coords="722,699,837,726"/><area shape="rect" id="node14" href="../../d1/d16/codec_8h.html" title="toxav/codec.h" alt="" coords="189,781,293,808"/><area shape="rect" id="node15" href="../../d5/def/codec_8c.html" title="toxav/codec.c" alt="" coords="111,931,215,957"/><area shape="rect" id="node19" href="../../d6/d46/rtp_8c.html" title="toxav/rtp.c" alt="" coords="29,781,113,808"/><area shape="rect" id="node18" href="../../d8/d0e/toxav_8c.html" title="toxav/toxav.c" alt="" coords="354,931,455,957"/><area shape="rect" id="node17" href="../../d2/d9b/msi_8c.html" title="toxav/msi.c" alt="" coords="239,931,330,957"/><area shape="rect" id="node21" href="../../d8/da5/toxav_2group_8h.html" title="toxav/group.h" alt="" coords="367,781,469,808"/><area shape="rect" id="node23" href="../../df/de9/toxcore_2group_8c.html" title="toxcore/group.c" alt="" coords="493,781,605,808"/><area shape="rect" id="node22" href="../../db/d46/toxav_2group_8c.html" title="toxav/group.c" alt="" coords="455,856,557,883"/><area shape="rect" id="node33" href="../../db/d79/onion__client_8c.html" title="toxcore/onion_client.c" alt="" coords="382,468,531,495"/><area shape="rect" id="node41" href="../../df/d75/onion__announce_8c.html" title="toxcore/onion_announce.c" alt="" coords="301,162,476,189"/></map>
</div>
</div>
<p><a href="../../d3/db9/onion_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d01/struct_onion.html">Onion</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d31/struct_onion___path.html">Onion_Path</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a48fdc4b34dbecf0a3417a557b83a4ff4"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/db9/onion_8h.html#a48fdc4b34dbecf0a3417a557b83a4ff4">ONION_MAX_PACKET_SIZE</a>&#160;&#160;&#160;1400</td></tr>
<tr class="separator:a48fdc4b34dbecf0a3417a557b83a4ff4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a45874dbad3133dc676900407c0672660"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/db9/onion_8h.html#a45874dbad3133dc676900407c0672660">ONION_RETURN_1</a>&#160;&#160;&#160;(crypto_box_NONCEBYTES + <a class="el" href="../../d9/d94/network_8h.html#a42c0a5872a869ac0cfd8200935ed49ee">SIZE_IPPORT</a> + crypto_box_MACBYTES)</td></tr>
<tr class="separator:a45874dbad3133dc676900407c0672660"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6c5f216c5efb2bf4097d42378d3f7afc"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/db9/onion_8h.html#a6c5f216c5efb2bf4097d42378d3f7afc">ONION_RETURN_2</a>&#160;&#160;&#160;(crypto_box_NONCEBYTES + <a class="el" href="../../d9/d94/network_8h.html#a42c0a5872a869ac0cfd8200935ed49ee">SIZE_IPPORT</a> + crypto_box_MACBYTES + <a class="el" href="../../d3/db9/onion_8h.html#a45874dbad3133dc676900407c0672660">ONION_RETURN_1</a>)</td></tr>
<tr class="separator:a6c5f216c5efb2bf4097d42378d3f7afc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3a333162e7c23bebfa7554654db9374e"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/db9/onion_8h.html#a3a333162e7c23bebfa7554654db9374e">ONION_RETURN_3</a>&#160;&#160;&#160;(crypto_box_NONCEBYTES + <a class="el" href="../../d9/d94/network_8h.html#a42c0a5872a869ac0cfd8200935ed49ee">SIZE_IPPORT</a> + crypto_box_MACBYTES + <a class="el" href="../../d3/db9/onion_8h.html#a6c5f216c5efb2bf4097d42378d3f7afc">ONION_RETURN_2</a>)</td></tr>
<tr class="separator:a3a333162e7c23bebfa7554654db9374e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac078bb7fac05e43bda3ef57b9d017ab9"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/db9/onion_8h.html#ac078bb7fac05e43bda3ef57b9d017ab9">ONION_SEND_BASE</a>&#160;&#160;&#160;(crypto_box_PUBLICKEYBYTES + <a class="el" href="../../d9/d94/network_8h.html#a42c0a5872a869ac0cfd8200935ed49ee">SIZE_IPPORT</a> + crypto_box_MACBYTES)</td></tr>
<tr class="separator:ac078bb7fac05e43bda3ef57b9d017ab9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9bbd0314179eebb50fc1773e17acedcc"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/db9/onion_8h.html#a9bbd0314179eebb50fc1773e17acedcc">ONION_SEND_3</a>&#160;&#160;&#160;(crypto_box_NONCEBYTES + <a class="el" href="../../d3/db9/onion_8h.html#ac078bb7fac05e43bda3ef57b9d017ab9">ONION_SEND_BASE</a> + <a class="el" href="../../d3/db9/onion_8h.html#a6c5f216c5efb2bf4097d42378d3f7afc">ONION_RETURN_2</a>)</td></tr>
<tr class="separator:a9bbd0314179eebb50fc1773e17acedcc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8fccb7f9c3804fe5b1f9f3847efa68ac"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/db9/onion_8h.html#a8fccb7f9c3804fe5b1f9f3847efa68ac">ONION_SEND_2</a>&#160;&#160;&#160;(crypto_box_NONCEBYTES + <a class="el" href="../../d3/db9/onion_8h.html#ac078bb7fac05e43bda3ef57b9d017ab9">ONION_SEND_BASE</a>*2 + <a class="el" href="../../d3/db9/onion_8h.html#a45874dbad3133dc676900407c0672660">ONION_RETURN_1</a>)</td></tr>
<tr class="separator:a8fccb7f9c3804fe5b1f9f3847efa68ac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a41398e07b064bd6f26f7cd54c6974354"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/db9/onion_8h.html#a41398e07b064bd6f26f7cd54c6974354">ONION_SEND_1</a>&#160;&#160;&#160;(crypto_box_NONCEBYTES + <a class="el" href="../../d3/db9/onion_8h.html#ac078bb7fac05e43bda3ef57b9d017ab9">ONION_SEND_BASE</a>*3)</td></tr>
<tr class="separator:a41398e07b064bd6f26f7cd54c6974354"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6a19b54ee0c1699e0c6e76820efbce18"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/db9/onion_8h.html#a6a19b54ee0c1699e0c6e76820efbce18">ONION_MAX_DATA_SIZE</a>&#160;&#160;&#160;(<a class="el" href="../../d3/db9/onion_8h.html#a48fdc4b34dbecf0a3417a557b83a4ff4">ONION_MAX_PACKET_SIZE</a> - (<a class="el" href="../../d3/db9/onion_8h.html#a41398e07b064bd6f26f7cd54c6974354">ONION_SEND_1</a> + 1))</td></tr>
<tr class="separator:a6a19b54ee0c1699e0c6e76820efbce18"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aea8fcee93c08e278868fb377062789e9"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/db9/onion_8h.html#aea8fcee93c08e278868fb377062789e9">ONION_RESPONSE_MAX_DATA_SIZE</a>&#160;&#160;&#160;(<a class="el" href="../../d3/db9/onion_8h.html#a48fdc4b34dbecf0a3417a557b83a4ff4">ONION_MAX_PACKET_SIZE</a> - (1 + <a class="el" href="../../d3/db9/onion_8h.html#a3a333162e7c23bebfa7554654db9374e">ONION_RETURN_3</a>))</td></tr>
<tr class="separator:aea8fcee93c08e278868fb377062789e9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abe0dd1f2cbadfda52425e7c2fed7d8c3"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/db9/onion_8h.html#abe0dd1f2cbadfda52425e7c2fed7d8c3">ONION_PATH_LENGTH</a>&#160;&#160;&#160;3</td></tr>
<tr class="separator:abe0dd1f2cbadfda52425e7c2fed7d8c3"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a2637801832f6ad6ad6fce79e76565d84"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/db9/onion_8h.html#a2637801832f6ad6ad6fce79e76565d84">create_onion_path</a> (const <a class="el" href="../../de/d15/struct_d_h_t.html">DHT</a> *dht, <a class="el" href="../../df/d31/struct_onion___path.html">Onion_Path</a> *new_path, const <a class="el" href="../../d3/d53/struct_node__format.html">Node_format</a> *nodes)</td></tr>
<tr class="separator:a2637801832f6ad6ad6fce79e76565d84"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0037270c6e9bca59c4e0cd118ebfa593"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/db9/onion_8h.html#a0037270c6e9bca59c4e0cd118ebfa593">onion_path_to_nodes</a> (<a class="el" href="../../d3/d53/struct_node__format.html">Node_format</a> *nodes, unsigned int num_nodes, const <a class="el" href="../../df/d31/struct_onion___path.html">Onion_Path</a> *<a class="el" href="../../dd/d99/tox__sync_8c.html#a6f50c85874ef8f3405625e5a26febbcb">path</a>)</td></tr>
<tr class="separator:a0037270c6e9bca59c4e0cd118ebfa593"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a34cf7934690ab5336b99844383a445a8"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/db9/onion_8h.html#a34cf7934690ab5336b99844383a445a8">create_onion_packet</a> (uint8_t *packet, uint16_t max_packet_length, const <a class="el" href="../../df/d31/struct_onion___path.html">Onion_Path</a> *<a class="el" href="../../dd/d99/tox__sync_8c.html#a6f50c85874ef8f3405625e5a26febbcb">path</a>, <a class="el" href="../../db/d14/struct_i_p___port.html">IP_Port</a> dest, const uint8_t *data, uint16_t length)</td></tr>
<tr class="separator:a34cf7934690ab5336b99844383a445a8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab04a946f429ee9f9e79ac83e95ec6271"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/db9/onion_8h.html#ab04a946f429ee9f9e79ac83e95ec6271">create_onion_packet_tcp</a> (uint8_t *packet, uint16_t max_packet_length, const <a class="el" href="../../df/d31/struct_onion___path.html">Onion_Path</a> *<a class="el" href="../../dd/d99/tox__sync_8c.html#a6f50c85874ef8f3405625e5a26febbcb">path</a>, <a class="el" href="../../db/d14/struct_i_p___port.html">IP_Port</a> dest, const uint8_t *data, uint16_t length)</td></tr>
<tr class="separator:ab04a946f429ee9f9e79ac83e95ec6271"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af06edfff31b42d31803e24fc7f47d365"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/db9/onion_8h.html#af06edfff31b42d31803e24fc7f47d365">send_onion_packet</a> (<a class="el" href="../../d3/d0b/struct_networking___core.html">Networking_Core</a> *net, const <a class="el" href="../../df/d31/struct_onion___path.html">Onion_Path</a> *<a class="el" href="../../dd/d99/tox__sync_8c.html#a6f50c85874ef8f3405625e5a26febbcb">path</a>, <a class="el" href="../../db/d14/struct_i_p___port.html">IP_Port</a> dest, const uint8_t *data, uint16_t length)</td></tr>
<tr class="separator:af06edfff31b42d31803e24fc7f47d365"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8d81f915fcff64bfe2508296d325f7d4"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/db9/onion_8h.html#a8d81f915fcff64bfe2508296d325f7d4">send_onion_response</a> (<a class="el" href="../../d3/d0b/struct_networking___core.html">Networking_Core</a> *net, <a class="el" href="../../db/d14/struct_i_p___port.html">IP_Port</a> dest, const uint8_t *data, uint16_t length, const uint8_t *ret)</td></tr>
<tr class="separator:a8d81f915fcff64bfe2508296d325f7d4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a112ff3dd6d8a1e104516eb4b465fc2fa"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/db9/onion_8h.html#a112ff3dd6d8a1e104516eb4b465fc2fa">onion_send_1</a> (const <a class="el" href="../../d3/d01/struct_onion.html">Onion</a> *onion, const uint8_t *plain, uint16_t len, <a class="el" href="../../db/d14/struct_i_p___port.html">IP_Port</a> source, const uint8_t *<a class="el" href="../../d7/dd9/onion__test_8c.html#af73a4a6ff6a4878d8eae4ec38ffeaac2">nonce</a>)</td></tr>
<tr class="separator:a112ff3dd6d8a1e104516eb4b465fc2fa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae1b8e562e22bd28deca3f98dace1a421"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/db9/onion_8h.html#ae1b8e562e22bd28deca3f98dace1a421">set_callback_handle_recv_1</a> (<a class="el" href="../../d3/d01/struct_onion.html">Onion</a> *onion, int(*function)(void *, <a class="el" href="../../db/d14/struct_i_p___port.html">IP_Port</a>, const uint8_t *, uint16_t), void *object)</td></tr>
<tr class="separator:ae1b8e562e22bd28deca3f98dace1a421"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a71877ec5931feec418ed1ae10b0963d8"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d3/d01/struct_onion.html">Onion</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/db9/onion_8h.html#a71877ec5931feec418ed1ae10b0963d8">new_onion</a> (<a class="el" href="../../de/d15/struct_d_h_t.html">DHT</a> *dht)</td></tr>
<tr class="separator:a71877ec5931feec418ed1ae10b0963d8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a301c5cb9db2604dc1ea885c3a2cf8408"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/db9/onion_8h.html#a301c5cb9db2604dc1ea885c3a2cf8408">kill_onion</a> (<a class="el" href="../../d3/d01/struct_onion.html">Onion</a> *onion)</td></tr>
<tr class="separator:a301c5cb9db2604dc1ea885c3a2cf8408"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="a6a19b54ee0c1699e0c6e76820efbce18"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ONION_MAX_DATA_SIZE&#160;&#160;&#160;(<a class="el" href="../../d3/db9/onion_8h.html#a48fdc4b34dbecf0a3417a557b83a4ff4">ONION_MAX_PACKET_SIZE</a> - (<a class="el" href="../../d3/db9/onion_8h.html#a41398e07b064bd6f26f7cd54c6974354">ONION_SEND_1</a> + 1))</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/db9/onion_8h_source.html#l00053">53</a> of file <a class="el" href="../../d3/db9/onion_8h_source.html">onion.h</a>.</p>

<p>Referenced by <a class="el" href="../../df/d75/onion__announce_8c_source.html#l00089">create_data_request()</a>, and <a class="el" href="../../df/d75/onion__announce_8c_source.html#l00169">send_data_request()</a>.</p>

</div>
</div>
<a class="anchor" id="a48fdc4b34dbecf0a3417a557b83a4ff4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ONION_MAX_PACKET_SIZE&#160;&#160;&#160;1400</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/db9/onion_8h_source.html#l00042">42</a> of file <a class="el" href="../../d3/db9/onion_8h_source.html">onion.h</a>.</p>

<p>Referenced by <a class="el" href="../../df/d75/onion__announce_8c_source.html#l00382">handle_data_request()</a>, <a class="el" href="../../d4/d18/onion_8c_source.html#l00541">handle_recv_1()</a>, <a class="el" href="../../d4/d18/onion_8c_source.html#l00505">handle_recv_2()</a>, <a class="el" href="../../d4/d18/onion_8c_source.html#l00469">handle_recv_3()</a>, <a class="el" href="../../d4/d18/onion_8c_source.html#l00370">handle_send_1()</a>, <a class="el" href="../../d4/d18/onion_8c_source.html#l00420">handle_send_2()</a>, <a class="el" href="../../d4/d18/onion_8c_source.html#l00309">handle_send_initial()</a>, <a class="el" href="../../d4/d18/onion_8c_source.html#l00333">onion_send_1()</a>, <a class="el" href="../../df/d75/onion__announce_8c_source.html#l00132">send_announce_request()</a>, <a class="el" href="../../df/d75/onion__announce_8c_source.html#l00169">send_data_request()</a>, <a class="el" href="../../db/d79/onion__client_8c_source.html#l00789">send_onion_data()</a>, <a class="el" href="../../d4/d18/onion_8c_source.html#l00273">send_onion_packet()</a>, and <a class="el" href="../../db/d79/onion__client_8c_source.html#l00311">send_onion_packet_tcp_udp()</a>.</p>

</div>
</div>
<a class="anchor" id="abe0dd1f2cbadfda52425e7c2fed7d8c3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ONION_PATH_LENGTH&#160;&#160;&#160;3</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/db9/onion_8h_source.html#l00056">56</a> of file <a class="el" href="../../d3/db9/onion_8h_source.html">onion.h</a>.</p>

<p>Referenced by <a class="el" href="../../db/d79/onion__client_8c_source.html#l00180">is_path_used()</a>, <a class="el" href="../../d4/d18/onion_8c_source.html#l00149">onion_path_to_nodes()</a>, <a class="el" href="../../db/d79/onion__client_8c_source.html#l00220">random_path()</a>, and <a class="el" href="../../db/d79/onion__client_8c_source.html#l00273">set_path_timeouts()</a>.</p>

</div>
</div>
<a class="anchor" id="aea8fcee93c08e278868fb377062789e9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ONION_RESPONSE_MAX_DATA_SIZE&#160;&#160;&#160;(<a class="el" href="../../d3/db9/onion_8h.html#a48fdc4b34dbecf0a3417a557b83a4ff4">ONION_MAX_PACKET_SIZE</a> - (1 + <a class="el" href="../../d3/db9/onion_8h.html#a3a333162e7c23bebfa7554654db9374e">ONION_RETURN_3</a>))</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/db9/onion_8h_source.html#l00054">54</a> of file <a class="el" href="../../d3/db9/onion_8h_source.html">onion.h</a>.</p>

<p>Referenced by <a class="el" href="../../d4/d18/onion_8c_source.html#l00293">send_onion_response()</a>.</p>

</div>
</div>
<a class="anchor" id="a45874dbad3133dc676900407c0672660"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ONION_RETURN_1&#160;&#160;&#160;(crypto_box_NONCEBYTES + <a class="el" href="../../d9/d94/network_8h.html#a42c0a5872a869ac0cfd8200935ed49ee">SIZE_IPPORT</a> + crypto_box_MACBYTES)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/db9/onion_8h_source.html#l00044">44</a> of file <a class="el" href="../../d3/db9/onion_8h_source.html">onion.h</a>.</p>

<p>Referenced by <a class="el" href="../../d4/d18/onion_8c_source.html#l00333">onion_send_1()</a>.</p>

</div>
</div>
<a class="anchor" id="a6c5f216c5efb2bf4097d42378d3f7afc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ONION_RETURN_2&#160;&#160;&#160;(crypto_box_NONCEBYTES + <a class="el" href="../../d9/d94/network_8h.html#a42c0a5872a869ac0cfd8200935ed49ee">SIZE_IPPORT</a> + crypto_box_MACBYTES + <a class="el" href="../../d3/db9/onion_8h.html#a45874dbad3133dc676900407c0672660">ONION_RETURN_1</a>)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/db9/onion_8h_source.html#l00045">45</a> of file <a class="el" href="../../d3/db9/onion_8h_source.html">onion.h</a>.</p>

</div>
</div>
<a class="anchor" id="a3a333162e7c23bebfa7554654db9374e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ONION_RETURN_3&#160;&#160;&#160;(crypto_box_NONCEBYTES + <a class="el" href="../../d9/d94/network_8h.html#a42c0a5872a869ac0cfd8200935ed49ee">SIZE_IPPORT</a> + crypto_box_MACBYTES + <a class="el" href="../../d3/db9/onion_8h.html#a6c5f216c5efb2bf4097d42378d3f7afc">ONION_RETURN_2</a>)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/db9/onion_8h_source.html#l00046">46</a> of file <a class="el" href="../../d3/db9/onion_8h_source.html">onion.h</a>.</p>

<p>Referenced by <a class="el" href="../../df/d75/onion__announce_8c_source.html#l00255">add_to_entries()</a>, <a class="el" href="../../df/d75/onion__announce_8c_source.html#l00289">handle_announce_request()</a>, and <a class="el" href="../../df/d75/onion__announce_8c_source.html#l00382">handle_data_request()</a>.</p>

</div>
</div>
<a class="anchor" id="a41398e07b064bd6f26f7cd54c6974354"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ONION_SEND_1&#160;&#160;&#160;(crypto_box_NONCEBYTES + <a class="el" href="../../d3/db9/onion_8h.html#ac078bb7fac05e43bda3ef57b9d017ab9">ONION_SEND_BASE</a>*3)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/db9/onion_8h_source.html#l00051">51</a> of file <a class="el" href="../../d3/db9/onion_8h_source.html">onion.h</a>.</p>

</div>
</div>
<a class="anchor" id="a8fccb7f9c3804fe5b1f9f3847efa68ac"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ONION_SEND_2&#160;&#160;&#160;(crypto_box_NONCEBYTES + <a class="el" href="../../d3/db9/onion_8h.html#ac078bb7fac05e43bda3ef57b9d017ab9">ONION_SEND_BASE</a>*2 + <a class="el" href="../../d3/db9/onion_8h.html#a45874dbad3133dc676900407c0672660">ONION_RETURN_1</a>)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/db9/onion_8h_source.html#l00050">50</a> of file <a class="el" href="../../d3/db9/onion_8h_source.html">onion.h</a>.</p>

</div>
</div>
<a class="anchor" id="a9bbd0314179eebb50fc1773e17acedcc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ONION_SEND_3&#160;&#160;&#160;(crypto_box_NONCEBYTES + <a class="el" href="../../d3/db9/onion_8h.html#ac078bb7fac05e43bda3ef57b9d017ab9">ONION_SEND_BASE</a> + <a class="el" href="../../d3/db9/onion_8h.html#a6c5f216c5efb2bf4097d42378d3f7afc">ONION_RETURN_2</a>)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/db9/onion_8h_source.html#l00049">49</a> of file <a class="el" href="../../d3/db9/onion_8h_source.html">onion.h</a>.</p>

</div>
</div>
<a class="anchor" id="ac078bb7fac05e43bda3ef57b9d017ab9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ONION_SEND_BASE&#160;&#160;&#160;(crypto_box_PUBLICKEYBYTES + <a class="el" href="../../d9/d94/network_8h.html#a42c0a5872a869ac0cfd8200935ed49ee">SIZE_IPPORT</a> + crypto_box_MACBYTES)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d3/db9/onion_8h_source.html#l00048">48</a> of file <a class="el" href="../../d3/db9/onion_8h_source.html">onion.h</a>.</p>

<p>Referenced by <a class="el" href="../../d4/d40/_t_c_p__server_8c_source.html#l00740">handle_TCP_packet()</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a34cf7934690ab5336b99844383a445a8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int create_onion_packet </td>
          <td>(</td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>packet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>max_packet_length</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../df/d31/struct_onion___path.html">Onion_Path</a> *&#160;</td>
          <td class="paramname"><em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../db/d14/struct_i_p___port.html">IP_Port</a>&#160;</td>
          <td class="paramname"><em>dest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>length</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d4/d18/onion_8c_source.html#l00173">173</a> of file <a class="el" href="../../d4/d18/onion_8c_source.html">onion.c</a>.</p>

<p>References <a class="el" href="../../dc/d85/crypto__core_8c_source.html#l00084">encrypt_data_symmetric()</a>, <a class="el" href="../../d3/db9/onion_8h_source.html#l00070">Onion_Path::ip_port2</a>, <a class="el" href="../../d3/db9/onion_8h_source.html#l00073">Onion_Path::ip_port3</a>, <a class="el" href="../../d4/d18/onion_8c_source.html#l00085">ipport_pack()</a>, <a class="el" href="../../d9/d94/network_8h_source.html#l00109">NET_PACKET_ONION_SEND_INITIAL</a>, <a class="el" href="../../d5/d29/crypto__test_8c_source.html#l00040">nonce</a>, <a class="el" href="../../d3/db9/onion_8h_source.html#l00063">Onion_Path::public_key1</a>, <a class="el" href="../../d3/db9/onion_8h_source.html#l00064">Onion_Path::public_key2</a>, <a class="el" href="../../d3/db9/onion_8h_source.html#l00065">Onion_Path::public_key3</a>, <a class="el" href="../../dc/d85/crypto__core_8c_source.html#l00176">random_nonce()</a>, <a class="el" href="../../d4/d18/onion_8c_source.html#l00036">SEND_1</a>, <a class="el" href="../../d4/d18/onion_8c_source.html#l00033">SEND_BASE</a>, <a class="el" href="../../d3/db9/onion_8h_source.html#l00059">Onion_Path::shared_key1</a>, <a class="el" href="../../d3/db9/onion_8h_source.html#l00060">Onion_Path::shared_key2</a>, <a class="el" href="../../d3/db9/onion_8h_source.html#l00061">Onion_Path::shared_key3</a>, and <a class="el" href="../../d9/d94/network_8h_source.html#l00175">SIZE_IPPORT</a>.</p>

<p>Referenced by <a class="el" href="../../df/d75/onion__announce_8c_source.html#l00132">send_announce_request()</a>, <a class="el" href="../../df/d75/onion__announce_8c_source.html#l00169">send_data_request()</a>, <a class="el" href="../../d4/d18/onion_8c_source.html#l00273">send_onion_packet()</a>, and <a class="el" href="../../db/d79/onion__client_8c_source.html#l00311">send_onion_packet_tcp_udp()</a>.</p>
<div class="fragment"><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;{</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <span class="keywordflow">if</span> (1 + length + <a class="code" href="../../d4/d18/onion_8c.html#aeb042381456a47261906ba91c1a6d75a">SEND_1</a> &gt; max_packet_length || length == 0)</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    uint8_t step1[<a class="code" href="../../d9/d94/network_8h.html#a42c0a5872a869ac0cfd8200935ed49ee">SIZE_IPPORT</a> + length];</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <a class="code" href="../../d4/d18/onion_8c.html#ae9d8dde9317c06fe493658b8145de853">ipport_pack</a>(step1, &amp;dest);</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    memcpy(step1 + <a class="code" href="../../d9/d94/network_8h.html#a42c0a5872a869ac0cfd8200935ed49ee">SIZE_IPPORT</a>, <a class="code" href="../../df/db5/namespacemake-funny-savefile.html#aa7a0efb8690a34f61a95b00cc723ca27">data</a>, length);</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    uint8_t <a class="code" href="../../d5/d29/crypto__test_8c.html#a7932c523f7065073a396e571319201ce">nonce</a>[crypto_box_NONCEBYTES];</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <a class="code" href="../../dc/d85/crypto__core_8c.html#a15ef255ab026d4881a16b99148b05dd7">random_nonce</a>(nonce);</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    uint8_t step2[<a class="code" href="../../d9/d94/network_8h.html#a42c0a5872a869ac0cfd8200935ed49ee">SIZE_IPPORT</a> + <a class="code" href="../../d4/d18/onion_8c.html#ad40bb79953288e33ace996a24cc7c86f">SEND_BASE</a> + length];</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <a class="code" href="../../d4/d18/onion_8c.html#ae9d8dde9317c06fe493658b8145de853">ipport_pack</a>(step2, &amp;path-&gt;<a class="code" href="../../df/d31/struct_onion___path.html#aef20a4d17084ae724f2e496f8f7a106a">ip_port3</a>);</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    memcpy(step2 + <a class="code" href="../../d9/d94/network_8h.html#a42c0a5872a869ac0cfd8200935ed49ee">SIZE_IPPORT</a>, path-&gt;<a class="code" href="../../df/d31/struct_onion___path.html#a0fa442ed05e4279ea8bcb1d039724f2b">public_key3</a>, crypto_box_PUBLICKEYBYTES);</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <span class="keywordtype">int</span> len = <a class="code" href="../../dc/d85/crypto__core_8c.html#a81efc0a4a6e0efe372651e26e342a6e5">encrypt_data_symmetric</a>(path-&gt;<a class="code" href="../../df/d31/struct_onion___path.html#ab9b6dd504522fbbb77500ab7e5d27121">shared_key3</a>, nonce, step1, <span class="keyword">sizeof</span>(step1),</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;                                     step2 + <a class="code" href="../../d9/d94/network_8h.html#a42c0a5872a869ac0cfd8200935ed49ee">SIZE_IPPORT</a> + crypto_box_PUBLICKEYBYTES);</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <span class="keywordflow">if</span> (len != <a class="code" href="../../d9/d94/network_8h.html#a42c0a5872a869ac0cfd8200935ed49ee">SIZE_IPPORT</a> + length + crypto_box_MACBYTES)</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    uint8_t step3[<a class="code" href="../../d9/d94/network_8h.html#a42c0a5872a869ac0cfd8200935ed49ee">SIZE_IPPORT</a> + <a class="code" href="../../d4/d18/onion_8c.html#ad40bb79953288e33ace996a24cc7c86f">SEND_BASE</a> * 2 + length];</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <a class="code" href="../../d4/d18/onion_8c.html#ae9d8dde9317c06fe493658b8145de853">ipport_pack</a>(step3, &amp;path-&gt;<a class="code" href="../../df/d31/struct_onion___path.html#adcf789584e4efc296bc6f915d3e2e9f9">ip_port2</a>);</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    memcpy(step3 + <a class="code" href="../../d9/d94/network_8h.html#a42c0a5872a869ac0cfd8200935ed49ee">SIZE_IPPORT</a>, path-&gt;<a class="code" href="../../df/d31/struct_onion___path.html#adb351a6df6a87dbb748077bd8081270d">public_key2</a>, crypto_box_PUBLICKEYBYTES);</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;    len = <a class="code" href="../../dc/d85/crypto__core_8c.html#a81efc0a4a6e0efe372651e26e342a6e5">encrypt_data_symmetric</a>(path-&gt;<a class="code" href="../../df/d31/struct_onion___path.html#a677ff69e40fecc070cfe5ebe1f4ecb71">shared_key2</a>, nonce, step2, <span class="keyword">sizeof</span>(step2),</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;                                 step3 + <a class="code" href="../../d9/d94/network_8h.html#a42c0a5872a869ac0cfd8200935ed49ee">SIZE_IPPORT</a> + crypto_box_PUBLICKEYBYTES);</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="keywordflow">if</span> (len != <a class="code" href="../../d9/d94/network_8h.html#a42c0a5872a869ac0cfd8200935ed49ee">SIZE_IPPORT</a> + <a class="code" href="../../d4/d18/onion_8c.html#ad40bb79953288e33ace996a24cc7c86f">SEND_BASE</a> + length + crypto_box_MACBYTES)</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    packet[0] = <a class="code" href="../../d9/d94/network_8h.html#a6d89eb02b93f686802f9d3e5e7f7ab2d">NET_PACKET_ONION_SEND_INITIAL</a>;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    memcpy(packet + 1, nonce, crypto_box_NONCEBYTES);</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    memcpy(packet + 1 + crypto_box_NONCEBYTES, path-&gt;<a class="code" href="../../df/d31/struct_onion___path.html#a203561e286f807c2f057fc6bce17e2d8">public_key1</a>, crypto_box_PUBLICKEYBYTES);</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    len = <a class="code" href="../../dc/d85/crypto__core_8c.html#a81efc0a4a6e0efe372651e26e342a6e5">encrypt_data_symmetric</a>(path-&gt;<a class="code" href="../../df/d31/struct_onion___path.html#ac38c2cdd308cce10c53e276cb664c644">shared_key1</a>, nonce, step3, <span class="keyword">sizeof</span>(step3),</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;                                 packet + 1 + crypto_box_NONCEBYTES + crypto_box_PUBLICKEYBYTES);</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <span class="keywordflow">if</span> (len != <a class="code" href="../../d9/d94/network_8h.html#a42c0a5872a869ac0cfd8200935ed49ee">SIZE_IPPORT</a> + <a class="code" href="../../d4/d18/onion_8c.html#ad40bb79953288e33ace996a24cc7c86f">SEND_BASE</a> * 2 + length + crypto_box_MACBYTES)</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <span class="keywordflow">return</span> 1 + crypto_box_NONCEBYTES + crypto_box_PUBLICKEYBYTES + len;</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;}</div>
<div class="ttc" id="struct_onion___path_html_ac38c2cdd308cce10c53e276cb664c644"><div class="ttname"><a href="../../df/d31/struct_onion___path.html#ac38c2cdd308cce10c53e276cb664c644">Onion_Path::shared_key1</a></div><div class="ttdeci">uint8_t shared_key1[crypto_box_BEFORENMBYTES]</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db9/onion_8h_source.html#l00059">onion.h:59</a></div></div>
<div class="ttc" id="crypto__core_8c_html_a81efc0a4a6e0efe372651e26e342a6e5"><div class="ttname"><a href="../../dc/d85/crypto__core_8c.html#a81efc0a4a6e0efe372651e26e342a6e5">encrypt_data_symmetric</a></div><div class="ttdeci">int encrypt_data_symmetric(const uint8_t *secret_key, const uint8_t *nonce, const uint8_t *plain, uint32_t length, uint8_t *encrypted)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d85/crypto__core_8c_source.html#l00084">crypto_core.c:84</a></div></div>
<div class="ttc" id="struct_onion___path_html_adb351a6df6a87dbb748077bd8081270d"><div class="ttname"><a href="../../df/d31/struct_onion___path.html#adb351a6df6a87dbb748077bd8081270d">Onion_Path::public_key2</a></div><div class="ttdeci">uint8_t public_key2[crypto_box_PUBLICKEYBYTES]</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db9/onion_8h_source.html#l00064">onion.h:64</a></div></div>
<div class="ttc" id="network_8h_html_a6d89eb02b93f686802f9d3e5e7f7ab2d"><div class="ttname"><a href="../../d9/d94/network_8h.html#a6d89eb02b93f686802f9d3e5e7f7ab2d">NET_PACKET_ONION_SEND_INITIAL</a></div><div class="ttdeci">#define NET_PACKET_ONION_SEND_INITIAL</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d94/network_8h_source.html#l00109">network.h:109</a></div></div>
<div class="ttc" id="struct_onion___path_html_a677ff69e40fecc070cfe5ebe1f4ecb71"><div class="ttname"><a href="../../df/d31/struct_onion___path.html#a677ff69e40fecc070cfe5ebe1f4ecb71">Onion_Path::shared_key2</a></div><div class="ttdeci">uint8_t shared_key2[crypto_box_BEFORENMBYTES]</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db9/onion_8h_source.html#l00060">onion.h:60</a></div></div>
<div class="ttc" id="network_8h_html_a42c0a5872a869ac0cfd8200935ed49ee"><div class="ttname"><a href="../../d9/d94/network_8h.html#a42c0a5872a869ac0cfd8200935ed49ee">SIZE_IPPORT</a></div><div class="ttdeci">#define SIZE_IPPORT</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d94/network_8h_source.html#l00175">network.h:175</a></div></div>
<div class="ttc" id="crypto__core_8c_html_a15ef255ab026d4881a16b99148b05dd7"><div class="ttname"><a href="../../dc/d85/crypto__core_8c.html#a15ef255ab026d4881a16b99148b05dd7">random_nonce</a></div><div class="ttdeci">void random_nonce(uint8_t *nonce)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d85/crypto__core_8c_source.html#l00176">crypto_core.c:176</a></div></div>
<div class="ttc" id="onion_8c_html_ad40bb79953288e33ace996a24cc7c86f"><div class="ttname"><a href="../../d4/d18/onion_8c.html#ad40bb79953288e33ace996a24cc7c86f">SEND_BASE</a></div><div class="ttdeci">#define SEND_BASE</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d18/onion_8c_source.html#l00033">onion.c:33</a></div></div>
<div class="ttc" id="struct_onion___path_html_a203561e286f807c2f057fc6bce17e2d8"><div class="ttname"><a href="../../df/d31/struct_onion___path.html#a203561e286f807c2f057fc6bce17e2d8">Onion_Path::public_key1</a></div><div class="ttdeci">uint8_t public_key1[crypto_box_PUBLICKEYBYTES]</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db9/onion_8h_source.html#l00063">onion.h:63</a></div></div>
<div class="ttc" id="struct_onion___path_html_a0fa442ed05e4279ea8bcb1d039724f2b"><div class="ttname"><a href="../../df/d31/struct_onion___path.html#a0fa442ed05e4279ea8bcb1d039724f2b">Onion_Path::public_key3</a></div><div class="ttdeci">uint8_t public_key3[crypto_box_PUBLICKEYBYTES]</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db9/onion_8h_source.html#l00065">onion.h:65</a></div></div>
<div class="ttc" id="namespacemake-funny-savefile_html_aa7a0efb8690a34f61a95b00cc723ca27"><div class="ttname"><a href="../../df/db5/namespacemake-funny-savefile.html#aa7a0efb8690a34f61a95b00cc723ca27">make-funny-savefile.data</a></div><div class="ttdeci">tuple data</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d01/make-funny-savefile_8py_source.html#l00098">make-funny-savefile.py:98</a></div></div>
<div class="ttc" id="onion_8c_html_aeb042381456a47261906ba91c1a6d75a"><div class="ttname"><a href="../../d4/d18/onion_8c.html#aeb042381456a47261906ba91c1a6d75a">SEND_1</a></div><div class="ttdeci">#define SEND_1</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d18/onion_8c_source.html#l00036">onion.c:36</a></div></div>
<div class="ttc" id="struct_onion___path_html_ab9b6dd504522fbbb77500ab7e5d27121"><div class="ttname"><a href="../../df/d31/struct_onion___path.html#ab9b6dd504522fbbb77500ab7e5d27121">Onion_Path::shared_key3</a></div><div class="ttdeci">uint8_t shared_key3[crypto_box_BEFORENMBYTES]</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db9/onion_8h_source.html#l00061">onion.h:61</a></div></div>
<div class="ttc" id="struct_onion___path_html_adcf789584e4efc296bc6f915d3e2e9f9"><div class="ttname"><a href="../../df/d31/struct_onion___path.html#adcf789584e4efc296bc6f915d3e2e9f9">Onion_Path::ip_port2</a></div><div class="ttdeci">IP_Port ip_port2</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db9/onion_8h_source.html#l00070">onion.h:70</a></div></div>
<div class="ttc" id="crypto__test_8c_html_a7932c523f7065073a396e571319201ce"><div class="ttname"><a href="../../d5/d29/crypto__test_8c.html#a7932c523f7065073a396e571319201ce">nonce</a></div><div class="ttdeci">unsigned char nonce[24]</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d29/crypto__test_8c_source.html#l00040">crypto_test.c:40</a></div></div>
<div class="ttc" id="onion_8c_html_ae9d8dde9317c06fe493658b8145de853"><div class="ttname"><a href="../../d4/d18/onion_8c.html#ae9d8dde9317c06fe493658b8145de853">ipport_pack</a></div><div class="ttdeci">static void ipport_pack(uint8_t *data, const IP_Port *source)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d18/onion_8c_source.html#l00085">onion.c:85</a></div></div>
<div class="ttc" id="struct_onion___path_html_aef20a4d17084ae724f2e496f8f7a106a"><div class="ttname"><a href="../../df/d31/struct_onion___path.html#aef20a4d17084ae724f2e496f8f7a106a">Onion_Path::ip_port3</a></div><div class="ttdeci">IP_Port ip_port3</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db9/onion_8h_source.html#l00073">onion.h:73</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d3/db9/onion_8h_a34cf7934690ab5336b99844383a445a8_cgraph.png" border="0" usemap="#d3/db9/onion_8h_a34cf7934690ab5336b99844383a445a8_cgraph" alt=""/></div>
<map name="d3/db9/onion_8h_a34cf7934690ab5336b99844383a445a8_cgraph" id="d3/db9/onion_8h_a34cf7934690ab5336b99844383a445a8_cgraph">
<area shape="rect" id="node2" href="../../dc/d85/crypto__core_8c.html#a81efc0a4a6e0efe372651e26e342a6e5" title="encrypt_data_symmetric" alt="" coords="196,5,361,32"/><area shape="rect" id="node3" href="../../d4/d18/onion_8c.html#ae9d8dde9317c06fe493658b8145de853" title="ipport_pack" alt="" coords="234,56,323,83"/><area shape="rect" id="node6" href="../../dc/d85/crypto__core_8c.html#a15ef255ab026d4881a16b99148b05dd7" title="random_nonce" alt="" coords="225,107,332,133"/><area shape="rect" id="node4" href="../../d4/d18/onion_8c.html#a6b9b6abcbb6fde502e7822236a978118" title="ip_pack" alt="" coords="409,56,476,83"/><area shape="rect" id="node5" href="../../dc/dc1/_d_h_t_8c.html#ae7f65a76f9c4b0093f45fc1777238459" title="to_net_family" alt="" coords="524,56,624,83"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d3/db9/onion_8h_a34cf7934690ab5336b99844383a445a8_icgraph.png" border="0" usemap="#d3/db9/onion_8h_a34cf7934690ab5336b99844383a445a8_icgraph" alt=""/></div>
<map name="d3/db9/onion_8h_a34cf7934690ab5336b99844383a445a8_icgraph" id="d3/db9/onion_8h_a34cf7934690ab5336b99844383a445a8_icgraph">
<area shape="rect" id="node2" href="../../d7/dfd/onion__announce_8h.html#adf4563e859323282731b183ef62cfbcc" title="send_announce_request" alt="" coords="208,79,371,105"/><area shape="rect" id="node4" href="../../d7/dfd/onion__announce_8h.html#a16a4948e44b16b56b9c0de61d2988082" title="send_data_request" alt="" coords="223,129,355,156"/><area shape="rect" id="node5" href="../../d3/db9/onion_8h.html#af06edfff31b42d31803e24fc7f47d365" title="send_onion_packet" alt="" coords="222,28,357,55"/><area shape="rect" id="node6" href="../../db/d79/onion__client_8c.html#a4be9a76607f006a407f4f96dd49f25da" title="send_onion_packet_tcp_udp" alt="" coords="196,180,383,207"/><area shape="rect" id="node3" href="../../d7/dd9/onion__test_8c.html#ad7475d1539db4bb3bcf8673dd7f7cf68" title="START_TEST" alt="" coords="453,79,559,105"/><area shape="rect" id="node7" href="../../db/d79/onion__client_8c.html#a4253f1739f978c9aac584c97b7a55f48" title="client_send_announce\l_request" alt="" coords="431,151,581,193"/><area shape="rect" id="node33" href="../../d9/d26/onion__client_8h.html#aa1be42b5ea93bd068f47271831157927" title="send_onion_data" alt="" coords="446,239,566,265"/><area shape="rect" id="node8" href="../../db/d79/onion__client_8c.html#a934df896ad375a9dbd82f563fb27144f" title="client_ping_nodes" alt="" coords="642,87,769,113"/><area shape="rect" id="node23" href="../../db/d79/onion__client_8c.html#a02301d507ab3c11bfee8112560f36f87" title="do_friend" alt="" coords="883,195,958,221"/><area shape="rect" id="node32" href="../../db/d79/onion__client_8c.html#ae37f00e2304222b24cef2cce370e58d3" title="do_announce" alt="" coords="656,137,755,164"/><area shape="rect" id="node9" href="../../db/d79/onion__client_8c.html#acef82e3853e62dce8cd45450ff028f97" title="handle_announce_response" alt="" coords="829,87,1012,113"/><area shape="rect" id="node10" href="../../db/d79/onion__client_8c.html#a3519dd95525df398b46b0e4a928f54f0" title="handle_tcp_onion" alt="" coords="1060,61,1183,88"/><area shape="rect" id="node11" href="../../d9/d26/onion__client_8h.html#a9a6ae3a9c70a5221a65bd1c9be751a2e" title="new_onion_client" alt="" coords="1231,100,1353,127"/><area shape="rect" id="node12" href="../../d7/dd9/onion__test_8c.html#a5945771cafdfe39074adf8ddd47ae81b" title="new_onions" alt="" coords="1415,144,1505,171"/><area shape="rect" id="node14" href="../../d4/d30/_messenger_8h.html#af015ea2e74c58196e0564719a6c6a112" title="new_messenger" alt="" coords="1401,93,1519,120"/><area shape="rect" id="node13" href="../../d7/dd9/onion__test_8c.html#a1bd0e98b361db6749c50308a7555a192" title="START_TEST" alt="" coords="1567,172,1673,199"/><area shape="rect" id="node15" href="../../d8/dda/messenger__test_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="1595,47,1645,73"/><area shape="rect" id="node16" href="../../da/d8f/tox_8h.html#aa0e6afccd06a766b84a0633e259f9165" title="Creates and initialises a new Tox instance with the options passed. " alt="" coords="1585,97,1655,124"/><area shape="rect" id="node17" href="../../d0/de9/encryptsave__test_8c.html#abfc6ca1e662bc2b41efecb0b9e35cc9d" title="START_TEST" alt="" coords="1721,107,1828,133"/><area shape="rect" id="node18" href="../../db/d11/irc__syncbot_8c.html#a7a3ec256dab5cbac9fc01ff328980da7" title="init_tox" alt="" coords="1743,5,1807,32"/><area shape="rect" id="node20" href="../../d2/d65/n_tox_8c.html#ac47fc78dd12365ddfd46c70003627250" title="load_data" alt="" coords="1735,56,1814,83"/><area shape="rect" id="node22" href="../../d7/db1/tox__shell_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="1749,157,1800,184"/><area shape="rect" id="node19" href="../../db/d11/irc__syncbot_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="1876,107,1927,133"/><area shape="rect" id="node21" href="../../d2/d65/n_tox_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="1876,208,1927,235"/><area shape="rect" id="node24" href="../../d9/d26/onion__client_8h.html#aa1771a7c1ebf446973e8d2bbb7ea8c2d" title="do_onion_client" alt="" coords="1065,195,1177,221"/><area shape="rect" id="node25" href="../../d7/dd9/onion__test_8c.html#ab45bd517e9eb750ba65272a4a8ebc250" title="do_onions" alt="" coords="1251,195,1333,221"/><area shape="rect" id="node26" href="../../d4/d30/_messenger_8h.html#ae0686caa878183a98920aeb7486afcb6" title="do_messenger" alt="" coords="1239,256,1345,283"/><area shape="rect" id="node27" href="../../db/de9/_messenger__test_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="1435,252,1485,279"/><area shape="rect" id="node28" href="../../da/d8f/tox_8h.html#a649c8740c523fb52272396cb0b70b8dc" title="tox_iterate" alt="" coords="1579,303,1661,329"/><area shape="rect" id="node29" href="../../d9/d35/tox__test_8c.html#a4c612d3a3f15c8fbf2e4bde8002bc33b" title="START_TEST" alt="" coords="1721,259,1828,285"/><area shape="rect" id="node30" href="../../d6/dc0/toxav__many__test_8c.html#a8fdafe3be7e00ce3d4f0cb50a9a5eb39" title="while" alt="" coords="1749,309,1801,336"/><area shape="rect" id="node31" href="../../d2/d65/n_tox_8c.html#a1e3c1630c0ca8b687a6a878aa27dd69c" title="line_eval" alt="" coords="1738,360,1811,387"/><area shape="rect" id="node34" href="../../d0/d08/friend__connection_8h.html#a2af492c22c086276ed147d0826839d25" title="send_friend_request\l_packet" alt="" coords="851,279,990,321"/><area shape="rect" id="node36" href="../../db/d79/onion__client_8c.html#a64e317f7dd22c983c325f62aed9ecfae" title="send_dhtpk_announce" alt="" coords="629,239,781,265"/><area shape="rect" id="node35" href="../../d8/d8d/_messenger_8c.html#a5e3bee5110a3531eedb8f92ffd600af8" title="do_friends" alt="" coords="1080,281,1163,308"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ab04a946f429ee9f9e79ac83e95ec6271"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int create_onion_packet_tcp </td>
          <td>(</td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>packet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>max_packet_length</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../df/d31/struct_onion___path.html">Onion_Path</a> *&#160;</td>
          <td class="paramname"><em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../db/d14/struct_i_p___port.html">IP_Port</a>&#160;</td>
          <td class="paramname"><em>dest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>length</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d4/d18/onion_8c_source.html#l00228">228</a> of file <a class="el" href="../../d4/d18/onion_8c_source.html">onion.c</a>.</p>

<p>References <a class="el" href="../../dc/d85/crypto__core_8c_source.html#l00084">encrypt_data_symmetric()</a>, <a class="el" href="../../d3/db9/onion_8h_source.html#l00070">Onion_Path::ip_port2</a>, <a class="el" href="../../d3/db9/onion_8h_source.html#l00073">Onion_Path::ip_port3</a>, <a class="el" href="../../d4/d18/onion_8c_source.html#l00085">ipport_pack()</a>, <a class="el" href="../../d5/d29/crypto__test_8c_source.html#l00040">nonce</a>, <a class="el" href="../../d3/db9/onion_8h_source.html#l00064">Onion_Path::public_key2</a>, <a class="el" href="../../d3/db9/onion_8h_source.html#l00065">Onion_Path::public_key3</a>, <a class="el" href="../../dc/d85/crypto__core_8c_source.html#l00176">random_nonce()</a>, <a class="el" href="../../d4/d18/onion_8c_source.html#l00033">SEND_BASE</a>, <a class="el" href="../../d3/db9/onion_8h_source.html#l00060">Onion_Path::shared_key2</a>, <a class="el" href="../../d3/db9/onion_8h_source.html#l00061">Onion_Path::shared_key3</a>, and <a class="el" href="../../d9/d94/network_8h_source.html#l00175">SIZE_IPPORT</a>.</p>

<p>Referenced by <a class="el" href="../../db/d79/onion__client_8c_source.html#l00311">send_onion_packet_tcp_udp()</a>.</p>
<div class="fragment"><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;{</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    <span class="keywordflow">if</span> (crypto_box_NONCEBYTES + <a class="code" href="../../d9/d94/network_8h.html#a42c0a5872a869ac0cfd8200935ed49ee">SIZE_IPPORT</a> + <a class="code" href="../../d4/d18/onion_8c.html#ad40bb79953288e33ace996a24cc7c86f">SEND_BASE</a> * 2 + length &gt; max_packet_length || length == 0)</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    uint8_t step1[<a class="code" href="../../d9/d94/network_8h.html#a42c0a5872a869ac0cfd8200935ed49ee">SIZE_IPPORT</a> + length];</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <a class="code" href="../../d4/d18/onion_8c.html#ae9d8dde9317c06fe493658b8145de853">ipport_pack</a>(step1, &amp;dest);</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    memcpy(step1 + <a class="code" href="../../d9/d94/network_8h.html#a42c0a5872a869ac0cfd8200935ed49ee">SIZE_IPPORT</a>, <a class="code" href="../../df/db5/namespacemake-funny-savefile.html#aa7a0efb8690a34f61a95b00cc723ca27">data</a>, length);</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    uint8_t <a class="code" href="../../d5/d29/crypto__test_8c.html#a7932c523f7065073a396e571319201ce">nonce</a>[crypto_box_NONCEBYTES];</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <a class="code" href="../../dc/d85/crypto__core_8c.html#a15ef255ab026d4881a16b99148b05dd7">random_nonce</a>(nonce);</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    uint8_t step2[<a class="code" href="../../d9/d94/network_8h.html#a42c0a5872a869ac0cfd8200935ed49ee">SIZE_IPPORT</a> + <a class="code" href="../../d4/d18/onion_8c.html#ad40bb79953288e33ace996a24cc7c86f">SEND_BASE</a> + length];</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <a class="code" href="../../d4/d18/onion_8c.html#ae9d8dde9317c06fe493658b8145de853">ipport_pack</a>(step2, &amp;path-&gt;<a class="code" href="../../df/d31/struct_onion___path.html#aef20a4d17084ae724f2e496f8f7a106a">ip_port3</a>);</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    memcpy(step2 + <a class="code" href="../../d9/d94/network_8h.html#a42c0a5872a869ac0cfd8200935ed49ee">SIZE_IPPORT</a>, path-&gt;<a class="code" href="../../df/d31/struct_onion___path.html#a0fa442ed05e4279ea8bcb1d039724f2b">public_key3</a>, crypto_box_PUBLICKEYBYTES);</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    <span class="keywordtype">int</span> len = <a class="code" href="../../dc/d85/crypto__core_8c.html#a81efc0a4a6e0efe372651e26e342a6e5">encrypt_data_symmetric</a>(path-&gt;<a class="code" href="../../df/d31/struct_onion___path.html#ab9b6dd504522fbbb77500ab7e5d27121">shared_key3</a>, nonce, step1, <span class="keyword">sizeof</span>(step1),</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;                                     step2 + <a class="code" href="../../d9/d94/network_8h.html#a42c0a5872a869ac0cfd8200935ed49ee">SIZE_IPPORT</a> + crypto_box_PUBLICKEYBYTES);</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    <span class="keywordflow">if</span> (len != <a class="code" href="../../d9/d94/network_8h.html#a42c0a5872a869ac0cfd8200935ed49ee">SIZE_IPPORT</a> + length + crypto_box_MACBYTES)</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    <a class="code" href="../../d4/d18/onion_8c.html#ae9d8dde9317c06fe493658b8145de853">ipport_pack</a>(packet + crypto_box_NONCEBYTES, &amp;path-&gt;<a class="code" href="../../df/d31/struct_onion___path.html#adcf789584e4efc296bc6f915d3e2e9f9">ip_port2</a>);</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    memcpy(packet + crypto_box_NONCEBYTES + <a class="code" href="../../d9/d94/network_8h.html#a42c0a5872a869ac0cfd8200935ed49ee">SIZE_IPPORT</a>, path-&gt;<a class="code" href="../../df/d31/struct_onion___path.html#adb351a6df6a87dbb748077bd8081270d">public_key2</a>, crypto_box_PUBLICKEYBYTES);</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    len = <a class="code" href="../../dc/d85/crypto__core_8c.html#a81efc0a4a6e0efe372651e26e342a6e5">encrypt_data_symmetric</a>(path-&gt;<a class="code" href="../../df/d31/struct_onion___path.html#a677ff69e40fecc070cfe5ebe1f4ecb71">shared_key2</a>, nonce, step2, <span class="keyword">sizeof</span>(step2),</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                                 packet + crypto_box_NONCEBYTES + <a class="code" href="../../d9/d94/network_8h.html#a42c0a5872a869ac0cfd8200935ed49ee">SIZE_IPPORT</a> + crypto_box_PUBLICKEYBYTES);</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <span class="keywordflow">if</span> (len != <a class="code" href="../../d9/d94/network_8h.html#a42c0a5872a869ac0cfd8200935ed49ee">SIZE_IPPORT</a> + <a class="code" href="../../d4/d18/onion_8c.html#ad40bb79953288e33ace996a24cc7c86f">SEND_BASE</a> + length + crypto_box_MACBYTES)</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    memcpy(packet, nonce, crypto_box_NONCEBYTES);</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <span class="keywordflow">return</span> crypto_box_NONCEBYTES + <a class="code" href="../../d9/d94/network_8h.html#a42c0a5872a869ac0cfd8200935ed49ee">SIZE_IPPORT</a> + crypto_box_PUBLICKEYBYTES + len;</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;}</div>
<div class="ttc" id="crypto__core_8c_html_a81efc0a4a6e0efe372651e26e342a6e5"><div class="ttname"><a href="../../dc/d85/crypto__core_8c.html#a81efc0a4a6e0efe372651e26e342a6e5">encrypt_data_symmetric</a></div><div class="ttdeci">int encrypt_data_symmetric(const uint8_t *secret_key, const uint8_t *nonce, const uint8_t *plain, uint32_t length, uint8_t *encrypted)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d85/crypto__core_8c_source.html#l00084">crypto_core.c:84</a></div></div>
<div class="ttc" id="struct_onion___path_html_adb351a6df6a87dbb748077bd8081270d"><div class="ttname"><a href="../../df/d31/struct_onion___path.html#adb351a6df6a87dbb748077bd8081270d">Onion_Path::public_key2</a></div><div class="ttdeci">uint8_t public_key2[crypto_box_PUBLICKEYBYTES]</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db9/onion_8h_source.html#l00064">onion.h:64</a></div></div>
<div class="ttc" id="struct_onion___path_html_a677ff69e40fecc070cfe5ebe1f4ecb71"><div class="ttname"><a href="../../df/d31/struct_onion___path.html#a677ff69e40fecc070cfe5ebe1f4ecb71">Onion_Path::shared_key2</a></div><div class="ttdeci">uint8_t shared_key2[crypto_box_BEFORENMBYTES]</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db9/onion_8h_source.html#l00060">onion.h:60</a></div></div>
<div class="ttc" id="network_8h_html_a42c0a5872a869ac0cfd8200935ed49ee"><div class="ttname"><a href="../../d9/d94/network_8h.html#a42c0a5872a869ac0cfd8200935ed49ee">SIZE_IPPORT</a></div><div class="ttdeci">#define SIZE_IPPORT</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d94/network_8h_source.html#l00175">network.h:175</a></div></div>
<div class="ttc" id="crypto__core_8c_html_a15ef255ab026d4881a16b99148b05dd7"><div class="ttname"><a href="../../dc/d85/crypto__core_8c.html#a15ef255ab026d4881a16b99148b05dd7">random_nonce</a></div><div class="ttdeci">void random_nonce(uint8_t *nonce)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d85/crypto__core_8c_source.html#l00176">crypto_core.c:176</a></div></div>
<div class="ttc" id="onion_8c_html_ad40bb79953288e33ace996a24cc7c86f"><div class="ttname"><a href="../../d4/d18/onion_8c.html#ad40bb79953288e33ace996a24cc7c86f">SEND_BASE</a></div><div class="ttdeci">#define SEND_BASE</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d18/onion_8c_source.html#l00033">onion.c:33</a></div></div>
<div class="ttc" id="struct_onion___path_html_a0fa442ed05e4279ea8bcb1d039724f2b"><div class="ttname"><a href="../../df/d31/struct_onion___path.html#a0fa442ed05e4279ea8bcb1d039724f2b">Onion_Path::public_key3</a></div><div class="ttdeci">uint8_t public_key3[crypto_box_PUBLICKEYBYTES]</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db9/onion_8h_source.html#l00065">onion.h:65</a></div></div>
<div class="ttc" id="namespacemake-funny-savefile_html_aa7a0efb8690a34f61a95b00cc723ca27"><div class="ttname"><a href="../../df/db5/namespacemake-funny-savefile.html#aa7a0efb8690a34f61a95b00cc723ca27">make-funny-savefile.data</a></div><div class="ttdeci">tuple data</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d01/make-funny-savefile_8py_source.html#l00098">make-funny-savefile.py:98</a></div></div>
<div class="ttc" id="struct_onion___path_html_ab9b6dd504522fbbb77500ab7e5d27121"><div class="ttname"><a href="../../df/d31/struct_onion___path.html#ab9b6dd504522fbbb77500ab7e5d27121">Onion_Path::shared_key3</a></div><div class="ttdeci">uint8_t shared_key3[crypto_box_BEFORENMBYTES]</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db9/onion_8h_source.html#l00061">onion.h:61</a></div></div>
<div class="ttc" id="struct_onion___path_html_adcf789584e4efc296bc6f915d3e2e9f9"><div class="ttname"><a href="../../df/d31/struct_onion___path.html#adcf789584e4efc296bc6f915d3e2e9f9">Onion_Path::ip_port2</a></div><div class="ttdeci">IP_Port ip_port2</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db9/onion_8h_source.html#l00070">onion.h:70</a></div></div>
<div class="ttc" id="crypto__test_8c_html_a7932c523f7065073a396e571319201ce"><div class="ttname"><a href="../../d5/d29/crypto__test_8c.html#a7932c523f7065073a396e571319201ce">nonce</a></div><div class="ttdeci">unsigned char nonce[24]</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d29/crypto__test_8c_source.html#l00040">crypto_test.c:40</a></div></div>
<div class="ttc" id="onion_8c_html_ae9d8dde9317c06fe493658b8145de853"><div class="ttname"><a href="../../d4/d18/onion_8c.html#ae9d8dde9317c06fe493658b8145de853">ipport_pack</a></div><div class="ttdeci">static void ipport_pack(uint8_t *data, const IP_Port *source)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d18/onion_8c_source.html#l00085">onion.c:85</a></div></div>
<div class="ttc" id="struct_onion___path_html_aef20a4d17084ae724f2e496f8f7a106a"><div class="ttname"><a href="../../df/d31/struct_onion___path.html#aef20a4d17084ae724f2e496f8f7a106a">Onion_Path::ip_port3</a></div><div class="ttdeci">IP_Port ip_port3</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db9/onion_8h_source.html#l00073">onion.h:73</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d3/db9/onion_8h_ab04a946f429ee9f9e79ac83e95ec6271_cgraph.png" border="0" usemap="#d3/db9/onion_8h_ab04a946f429ee9f9e79ac83e95ec6271_cgraph" alt=""/></div>
<map name="d3/db9/onion_8h_ab04a946f429ee9f9e79ac83e95ec6271_cgraph" id="d3/db9/onion_8h_ab04a946f429ee9f9e79ac83e95ec6271_cgraph">
<area shape="rect" id="node2" href="../../dc/d85/crypto__core_8c.html#a81efc0a4a6e0efe372651e26e342a6e5" title="encrypt_data_symmetric" alt="" coords="220,5,385,32"/><area shape="rect" id="node3" href="../../d4/d18/onion_8c.html#ae9d8dde9317c06fe493658b8145de853" title="ipport_pack" alt="" coords="258,56,347,83"/><area shape="rect" id="node6" href="../../dc/d85/crypto__core_8c.html#a15ef255ab026d4881a16b99148b05dd7" title="random_nonce" alt="" coords="249,107,356,133"/><area shape="rect" id="node4" href="../../d4/d18/onion_8c.html#a6b9b6abcbb6fde502e7822236a978118" title="ip_pack" alt="" coords="433,56,500,83"/><area shape="rect" id="node5" href="../../dc/dc1/_d_h_t_8c.html#ae7f65a76f9c4b0093f45fc1777238459" title="to_net_family" alt="" coords="548,56,648,83"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d3/db9/onion_8h_ab04a946f429ee9f9e79ac83e95ec6271_icgraph.png" border="0" usemap="#d3/db9/onion_8h_ab04a946f429ee9f9e79ac83e95ec6271_icgraph" alt=""/></div>
<map name="d3/db9/onion_8h_ab04a946f429ee9f9e79ac83e95ec6271_icgraph" id="d3/db9/onion_8h_ab04a946f429ee9f9e79ac83e95ec6271_icgraph">
<area shape="rect" id="node2" href="../../db/d79/onion__client_8c.html#a4be9a76607f006a407f4f96dd49f25da" title="send_onion_packet_tcp_udp" alt="" coords="220,161,407,188"/><area shape="rect" id="node3" href="../../db/d79/onion__client_8c.html#a4253f1739f978c9aac584c97b7a55f48" title="client_send_announce\l_request" alt="" coords="455,114,605,155"/><area shape="rect" id="node29" href="../../d9/d26/onion__client_8h.html#aa1be42b5ea93bd068f47271831157927" title="send_onion_data" alt="" coords="470,201,590,228"/><area shape="rect" id="node4" href="../../db/d79/onion__client_8c.html#a934df896ad375a9dbd82f563fb27144f" title="client_ping_nodes" alt="" coords="666,49,793,76"/><area shape="rect" id="node19" href="../../db/d79/onion__client_8c.html#a02301d507ab3c11bfee8112560f36f87" title="do_friend" alt="" coords="907,151,982,177"/><area shape="rect" id="node28" href="../../db/d79/onion__client_8c.html#ae37f00e2304222b24cef2cce370e58d3" title="do_announce" alt="" coords="680,100,779,127"/><area shape="rect" id="node5" href="../../db/d79/onion__client_8c.html#acef82e3853e62dce8cd45450ff028f97" title="handle_announce_response" alt="" coords="853,49,1036,76"/><area shape="rect" id="node6" href="../../db/d79/onion__client_8c.html#a3519dd95525df398b46b0e4a928f54f0" title="handle_tcp_onion" alt="" coords="1084,24,1207,51"/><area shape="rect" id="node7" href="../../d9/d26/onion__client_8h.html#a9a6ae3a9c70a5221a65bd1c9be751a2e" title="new_onion_client" alt="" coords="1255,63,1377,89"/><area shape="rect" id="node8" href="../../d7/dd9/onion__test_8c.html#a5945771cafdfe39074adf8ddd47ae81b" title="new_onions" alt="" coords="1439,56,1529,83"/><area shape="rect" id="node10" href="../../d4/d30/_messenger_8h.html#af015ea2e74c58196e0564719a6c6a112" title="new_messenger" alt="" coords="1425,157,1543,184"/><area shape="rect" id="node9" href="../../d7/dd9/onion__test_8c.html#a1bd0e98b361db6749c50308a7555a192" title="START_TEST" alt="" coords="1591,56,1697,83"/><area shape="rect" id="node11" href="../../d8/dda/messenger__test_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="1619,157,1669,184"/><area shape="rect" id="node12" href="../../da/d8f/tox_8h.html#aa0e6afccd06a766b84a0633e259f9165" title="Creates and initialises a new Tox instance with the options passed. " alt="" coords="1609,107,1679,133"/><area shape="rect" id="node13" href="../../d0/de9/encryptsave__test_8c.html#abfc6ca1e662bc2b41efecb0b9e35cc9d" title="START_TEST" alt="" coords="1745,56,1852,83"/><area shape="rect" id="node14" href="../../db/d11/irc__syncbot_8c.html#a7a3ec256dab5cbac9fc01ff328980da7" title="init_tox" alt="" coords="1767,5,1831,32"/><area shape="rect" id="node16" href="../../d2/d65/n_tox_8c.html#ac47fc78dd12365ddfd46c70003627250" title="load_data" alt="" coords="1759,157,1838,184"/><area shape="rect" id="node18" href="../../d7/db1/tox__shell_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="1773,107,1824,133"/><area shape="rect" id="node15" href="../../db/d11/irc__syncbot_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="1900,56,1951,83"/><area shape="rect" id="node17" href="../../d2/d65/n_tox_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="1900,208,1951,235"/><area shape="rect" id="node20" href="../../d9/d26/onion__client_8h.html#aa1771a7c1ebf446973e8d2bbb7ea8c2d" title="do_onion_client" alt="" coords="1089,141,1201,168"/><area shape="rect" id="node21" href="../../d7/dd9/onion__test_8c.html#ab45bd517e9eb750ba65272a4a8ebc250" title="do_onions" alt="" coords="1275,123,1357,149"/><area shape="rect" id="node22" href="../../d4/d30/_messenger_8h.html#ae0686caa878183a98920aeb7486afcb6" title="do_messenger" alt="" coords="1263,252,1369,279"/><area shape="rect" id="node23" href="../../db/de9/_messenger__test_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="1459,303,1509,329"/><area shape="rect" id="node24" href="../../da/d8f/tox_8h.html#a649c8740c523fb52272396cb0b70b8dc" title="tox_iterate" alt="" coords="1603,259,1685,285"/><area shape="rect" id="node25" href="../../d9/d35/tox__test_8c.html#a4c612d3a3f15c8fbf2e4bde8002bc33b" title="START_TEST" alt="" coords="1745,360,1852,387"/><area shape="rect" id="node26" href="../../d6/dc0/toxav__many__test_8c.html#a8fdafe3be7e00ce3d4f0cb50a9a5eb39" title="while" alt="" coords="1773,309,1825,336"/><area shape="rect" id="node27" href="../../d2/d65/n_tox_8c.html#a1e3c1630c0ca8b687a6a878aa27dd69c" title="line_eval" alt="" coords="1762,259,1835,285"/><area shape="rect" id="node30" href="../../d0/d08/friend__connection_8h.html#a2af492c22c086276ed147d0826839d25" title="send_friend_request\l_packet" alt="" coords="875,245,1014,286"/><area shape="rect" id="node32" href="../../db/d79/onion__client_8c.html#a64e317f7dd22c983c325f62aed9ecfae" title="send_dhtpk_announce" alt="" coords="653,201,805,228"/><area shape="rect" id="node31" href="../../d8/d8d/_messenger_8c.html#a5e3bee5110a3531eedb8f92ffd600af8" title="do_friends" alt="" coords="1104,252,1187,279"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a2637801832f6ad6ad6fce79e76565d84"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int create_onion_path </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../de/d15/struct_d_h_t.html">DHT</a> *&#160;</td>
          <td class="paramname"><em>dht</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../df/d31/struct_onion___path.html">Onion_Path</a> *&#160;</td>
          <td class="paramname"><em>new_path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d3/d53/struct_node__format.html">Node_format</a> *&#160;</td>
          <td class="paramname"><em>nodes</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d4/d18/onion_8c_source.html#l00114">114</a> of file <a class="el" href="../../d4/d18/onion_8c_source.html">onion.c</a>.</p>

<p>References <a class="el" href="../../dc/d85/crypto__core_8c_source.html#l00079">encrypt_precompute()</a>, <a class="el" href="../../df/dad/_d_h_t_8h_source.html#l00149">Node_format::ip_port</a>, <a class="el" href="../../d3/db9/onion_8h_source.html#l00067">Onion_Path::ip_port1</a>, <a class="el" href="../../d3/db9/onion_8h_source.html#l00070">Onion_Path::ip_port2</a>, <a class="el" href="../../d3/db9/onion_8h_source.html#l00073">Onion_Path::ip_port3</a>, <a class="el" href="../../d3/db9/onion_8h_source.html#l00068">Onion_Path::node_public_key1</a>, <a class="el" href="../../d3/db9/onion_8h_source.html#l00071">Onion_Path::node_public_key2</a>, <a class="el" href="../../d3/db9/onion_8h_source.html#l00074">Onion_Path::node_public_key3</a>, <a class="el" href="../../d2/d01/make-funny-savefile_8py_source.html#l00068">make-funny-savefile::public_key</a>, <a class="el" href="../../df/dad/_d_h_t_8h_source.html#l00148">Node_format::public_key</a>, <a class="el" href="../../d3/db9/onion_8h_source.html#l00063">Onion_Path::public_key1</a>, <a class="el" href="../../d3/db9/onion_8h_source.html#l00064">Onion_Path::public_key2</a>, <a class="el" href="../../d3/db9/onion_8h_source.html#l00065">Onion_Path::public_key3</a>, <a class="el" href="../../df/dad/_d_h_t_8h_source.html#l00210">DHT::self_public_key</a>, <a class="el" href="../../df/dad/_d_h_t_8h_source.html#l00211">DHT::self_secret_key</a>, <a class="el" href="../../d3/db9/onion_8h_source.html#l00059">Onion_Path::shared_key1</a>, <a class="el" href="../../d3/db9/onion_8h_source.html#l00060">Onion_Path::shared_key2</a>, and <a class="el" href="../../d3/db9/onion_8h_source.html#l00061">Onion_Path::shared_key3</a>.</p>

<p>Referenced by <a class="el" href="../../db/d79/onion__client_8c_source.html#l00220">random_path()</a>, and <a class="el" href="../../d7/dd9/onion__test_8c_source.html#l00129">START_TEST()</a>.</p>
<div class="fragment"><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;{</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <span class="keywordflow">if</span> (!new_path || !nodes)</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <a class="code" href="../../dc/d85/crypto__core_8c.html#a0d8eaef49981c5dc3ada078866b42f6d">encrypt_precompute</a>(nodes[0].<a class="code" href="../../df/db5/namespacemake-funny-savefile.html#a6734667aeff5c30ad9e5624ccb556a87">public_key</a>, dht-&gt;<a class="code" href="../../de/d15/struct_d_h_t.html#aa05050f86513ff53fe9da81f73c72267">self_secret_key</a>, new_path-&gt;<a class="code" href="../../df/d31/struct_onion___path.html#ac38c2cdd308cce10c53e276cb664c644">shared_key1</a>);</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    memcpy(new_path-&gt;<a class="code" href="../../df/d31/struct_onion___path.html#a203561e286f807c2f057fc6bce17e2d8">public_key1</a>, dht-&gt;<a class="code" href="../../de/d15/struct_d_h_t.html#ae726df8bdc26380e5a6c3187a00d6881">self_public_key</a>, crypto_box_PUBLICKEYBYTES);</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    uint8_t random_public_key[crypto_box_PUBLICKEYBYTES];</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    uint8_t random_secret_key[crypto_box_SECRETKEYBYTES];</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    crypto_box_keypair(random_public_key, random_secret_key);</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <a class="code" href="../../dc/d85/crypto__core_8c.html#a0d8eaef49981c5dc3ada078866b42f6d">encrypt_precompute</a>(nodes[1].<a class="code" href="../../df/db5/namespacemake-funny-savefile.html#a6734667aeff5c30ad9e5624ccb556a87">public_key</a>, random_secret_key, new_path-&gt;<a class="code" href="../../df/d31/struct_onion___path.html#a677ff69e40fecc070cfe5ebe1f4ecb71">shared_key2</a>);</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    memcpy(new_path-&gt;<a class="code" href="../../df/d31/struct_onion___path.html#adb351a6df6a87dbb748077bd8081270d">public_key2</a>, random_public_key, crypto_box_PUBLICKEYBYTES);</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    crypto_box_keypair(random_public_key, random_secret_key);</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <a class="code" href="../../dc/d85/crypto__core_8c.html#a0d8eaef49981c5dc3ada078866b42f6d">encrypt_precompute</a>(nodes[2].<a class="code" href="../../df/db5/namespacemake-funny-savefile.html#a6734667aeff5c30ad9e5624ccb556a87">public_key</a>, random_secret_key, new_path-&gt;<a class="code" href="../../df/d31/struct_onion___path.html#ab9b6dd504522fbbb77500ab7e5d27121">shared_key3</a>);</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    memcpy(new_path-&gt;<a class="code" href="../../df/d31/struct_onion___path.html#a0fa442ed05e4279ea8bcb1d039724f2b">public_key3</a>, random_public_key, crypto_box_PUBLICKEYBYTES);</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    new_path-&gt;<a class="code" href="../../df/d31/struct_onion___path.html#ad7670c0a1a9d05b2a807a9c1a7950b79">ip_port1</a> = nodes[0].<a class="code" href="../../d3/d53/struct_node__format.html#a86e2a5a56c0dd22df6e8b8a10e40f9e4">ip_port</a>;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    new_path-&gt;<a class="code" href="../../df/d31/struct_onion___path.html#adcf789584e4efc296bc6f915d3e2e9f9">ip_port2</a> = nodes[1].<a class="code" href="../../d3/d53/struct_node__format.html#a86e2a5a56c0dd22df6e8b8a10e40f9e4">ip_port</a>;</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    new_path-&gt;<a class="code" href="../../df/d31/struct_onion___path.html#aef20a4d17084ae724f2e496f8f7a106a">ip_port3</a> = nodes[2].<a class="code" href="../../d3/d53/struct_node__format.html#a86e2a5a56c0dd22df6e8b8a10e40f9e4">ip_port</a>;</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    memcpy(new_path-&gt;<a class="code" href="../../df/d31/struct_onion___path.html#a38f4e3f7780648cf74f808d7942113d8">node_public_key1</a>, nodes[0].<a class="code" href="../../d3/d53/struct_node__format.html#aaa806bb1136fb3d4b5d8d8970b596ff7">public_key</a>, crypto_box_PUBLICKEYBYTES);</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    memcpy(new_path-&gt;<a class="code" href="../../df/d31/struct_onion___path.html#adc5a9730c2f43085e83ece3257af154a">node_public_key2</a>, nodes[1].<a class="code" href="../../d3/d53/struct_node__format.html#aaa806bb1136fb3d4b5d8d8970b596ff7">public_key</a>, crypto_box_PUBLICKEYBYTES);</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    memcpy(new_path-&gt;<a class="code" href="../../df/d31/struct_onion___path.html#a4725b29fc0349714fa0ab0938844cf19">node_public_key3</a>, nodes[2].<a class="code" href="../../d3/d53/struct_node__format.html#aaa806bb1136fb3d4b5d8d8970b596ff7">public_key</a>, crypto_box_PUBLICKEYBYTES);</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;}</div>
<div class="ttc" id="struct_d_h_t_html_aa05050f86513ff53fe9da81f73c72267"><div class="ttname"><a href="../../de/d15/struct_d_h_t.html#aa05050f86513ff53fe9da81f73c72267">DHT::self_secret_key</a></div><div class="ttdeci">uint8_t self_secret_key[crypto_box_SECRETKEYBYTES]</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dad/_d_h_t_8h_source.html#l00211">DHT.h:211</a></div></div>
<div class="ttc" id="struct_onion___path_html_ac38c2cdd308cce10c53e276cb664c644"><div class="ttname"><a href="../../df/d31/struct_onion___path.html#ac38c2cdd308cce10c53e276cb664c644">Onion_Path::shared_key1</a></div><div class="ttdeci">uint8_t shared_key1[crypto_box_BEFORENMBYTES]</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db9/onion_8h_source.html#l00059">onion.h:59</a></div></div>
<div class="ttc" id="struct_onion___path_html_adb351a6df6a87dbb748077bd8081270d"><div class="ttname"><a href="../../df/d31/struct_onion___path.html#adb351a6df6a87dbb748077bd8081270d">Onion_Path::public_key2</a></div><div class="ttdeci">uint8_t public_key2[crypto_box_PUBLICKEYBYTES]</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db9/onion_8h_source.html#l00064">onion.h:64</a></div></div>
<div class="ttc" id="struct_onion___path_html_a677ff69e40fecc070cfe5ebe1f4ecb71"><div class="ttname"><a href="../../df/d31/struct_onion___path.html#a677ff69e40fecc070cfe5ebe1f4ecb71">Onion_Path::shared_key2</a></div><div class="ttdeci">uint8_t shared_key2[crypto_box_BEFORENMBYTES]</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db9/onion_8h_source.html#l00060">onion.h:60</a></div></div>
<div class="ttc" id="crypto__core_8c_html_a0d8eaef49981c5dc3ada078866b42f6d"><div class="ttname"><a href="../../dc/d85/crypto__core_8c.html#a0d8eaef49981c5dc3ada078866b42f6d">encrypt_precompute</a></div><div class="ttdeci">void encrypt_precompute(const uint8_t *public_key, const uint8_t *secret_key, uint8_t *enc_key)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d85/crypto__core_8c_source.html#l00079">crypto_core.c:79</a></div></div>
<div class="ttc" id="namespacemake-funny-savefile_html_a6734667aeff5c30ad9e5624ccb556a87"><div class="ttname"><a href="../../df/db5/namespacemake-funny-savefile.html#a6734667aeff5c30ad9e5624ccb556a87">make-funny-savefile.public_key</a></div><div class="ttdeci">list public_key</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d01/make-funny-savefile_8py_source.html#l00068">make-funny-savefile.py:68</a></div></div>
<div class="ttc" id="struct_onion___path_html_a38f4e3f7780648cf74f808d7942113d8"><div class="ttname"><a href="../../df/d31/struct_onion___path.html#a38f4e3f7780648cf74f808d7942113d8">Onion_Path::node_public_key1</a></div><div class="ttdeci">uint8_t node_public_key1[crypto_box_PUBLICKEYBYTES]</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db9/onion_8h_source.html#l00068">onion.h:68</a></div></div>
<div class="ttc" id="struct_node__format_html_aaa806bb1136fb3d4b5d8d8970b596ff7"><div class="ttname"><a href="../../d3/d53/struct_node__format.html#aaa806bb1136fb3d4b5d8d8970b596ff7">Node_format::public_key</a></div><div class="ttdeci">uint8_t public_key[crypto_box_PUBLICKEYBYTES]</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dad/_d_h_t_8h_source.html#l00148">DHT.h:148</a></div></div>
<div class="ttc" id="struct_onion___path_html_ad7670c0a1a9d05b2a807a9c1a7950b79"><div class="ttname"><a href="../../df/d31/struct_onion___path.html#ad7670c0a1a9d05b2a807a9c1a7950b79">Onion_Path::ip_port1</a></div><div class="ttdeci">IP_Port ip_port1</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db9/onion_8h_source.html#l00067">onion.h:67</a></div></div>
<div class="ttc" id="struct_onion___path_html_a203561e286f807c2f057fc6bce17e2d8"><div class="ttname"><a href="../../df/d31/struct_onion___path.html#a203561e286f807c2f057fc6bce17e2d8">Onion_Path::public_key1</a></div><div class="ttdeci">uint8_t public_key1[crypto_box_PUBLICKEYBYTES]</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db9/onion_8h_source.html#l00063">onion.h:63</a></div></div>
<div class="ttc" id="struct_onion___path_html_a4725b29fc0349714fa0ab0938844cf19"><div class="ttname"><a href="../../df/d31/struct_onion___path.html#a4725b29fc0349714fa0ab0938844cf19">Onion_Path::node_public_key3</a></div><div class="ttdeci">uint8_t node_public_key3[crypto_box_PUBLICKEYBYTES]</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db9/onion_8h_source.html#l00074">onion.h:74</a></div></div>
<div class="ttc" id="struct_onion___path_html_a0fa442ed05e4279ea8bcb1d039724f2b"><div class="ttname"><a href="../../df/d31/struct_onion___path.html#a0fa442ed05e4279ea8bcb1d039724f2b">Onion_Path::public_key3</a></div><div class="ttdeci">uint8_t public_key3[crypto_box_PUBLICKEYBYTES]</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db9/onion_8h_source.html#l00065">onion.h:65</a></div></div>
<div class="ttc" id="struct_node__format_html_a86e2a5a56c0dd22df6e8b8a10e40f9e4"><div class="ttname"><a href="../../d3/d53/struct_node__format.html#a86e2a5a56c0dd22df6e8b8a10e40f9e4">Node_format::ip_port</a></div><div class="ttdeci">IP_Port ip_port</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dad/_d_h_t_8h_source.html#l00149">DHT.h:149</a></div></div>
<div class="ttc" id="struct_onion___path_html_ab9b6dd504522fbbb77500ab7e5d27121"><div class="ttname"><a href="../../df/d31/struct_onion___path.html#ab9b6dd504522fbbb77500ab7e5d27121">Onion_Path::shared_key3</a></div><div class="ttdeci">uint8_t shared_key3[crypto_box_BEFORENMBYTES]</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db9/onion_8h_source.html#l00061">onion.h:61</a></div></div>
<div class="ttc" id="struct_d_h_t_html_ae726df8bdc26380e5a6c3187a00d6881"><div class="ttname"><a href="../../de/d15/struct_d_h_t.html#ae726df8bdc26380e5a6c3187a00d6881">DHT::self_public_key</a></div><div class="ttdeci">uint8_t self_public_key[crypto_box_PUBLICKEYBYTES]</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dad/_d_h_t_8h_source.html#l00210">DHT.h:210</a></div></div>
<div class="ttc" id="struct_onion___path_html_adcf789584e4efc296bc6f915d3e2e9f9"><div class="ttname"><a href="../../df/d31/struct_onion___path.html#adcf789584e4efc296bc6f915d3e2e9f9">Onion_Path::ip_port2</a></div><div class="ttdeci">IP_Port ip_port2</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db9/onion_8h_source.html#l00070">onion.h:70</a></div></div>
<div class="ttc" id="struct_onion___path_html_adc5a9730c2f43085e83ece3257af154a"><div class="ttname"><a href="../../df/d31/struct_onion___path.html#adc5a9730c2f43085e83ece3257af154a">Onion_Path::node_public_key2</a></div><div class="ttdeci">uint8_t node_public_key2[crypto_box_PUBLICKEYBYTES]</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db9/onion_8h_source.html#l00071">onion.h:71</a></div></div>
<div class="ttc" id="struct_onion___path_html_aef20a4d17084ae724f2e496f8f7a106a"><div class="ttname"><a href="../../df/d31/struct_onion___path.html#aef20a4d17084ae724f2e496f8f7a106a">Onion_Path::ip_port3</a></div><div class="ttdeci">IP_Port ip_port3</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db9/onion_8h_source.html#l00073">onion.h:73</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d3/db9/onion_8h_a2637801832f6ad6ad6fce79e76565d84_cgraph.png" border="0" usemap="#d3/db9/onion_8h_a2637801832f6ad6ad6fce79e76565d84_cgraph" alt=""/></div>
<map name="d3/db9/onion_8h_a2637801832f6ad6ad6fce79e76565d84_cgraph" id="d3/db9/onion_8h_a2637801832f6ad6ad6fce79e76565d84_cgraph">
<area shape="rect" id="node2" href="../../dc/d85/crypto__core_8c.html#a0d8eaef49981c5dc3ada078866b42f6d" title="encrypt_precompute" alt="" coords="181,5,321,32"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d3/db9/onion_8h_a2637801832f6ad6ad6fce79e76565d84_icgraph.png" border="0" usemap="#d3/db9/onion_8h_a2637801832f6ad6ad6fce79e76565d84_icgraph" alt=""/></div>
<map name="d3/db9/onion_8h_a2637801832f6ad6ad6fce79e76565d84_icgraph" id="d3/db9/onion_8h_a2637801832f6ad6ad6fce79e76565d84_icgraph">
<area shape="rect" id="node2" href="../../db/d79/onion__client_8c.html#a0ec6065dac34021e69682691f70b667c" title="random_path" alt="" coords="186,161,283,188"/><area shape="rect" id="node33" href="../../d7/dd9/onion__test_8c.html#ad7475d1539db4bb3bcf8673dd7f7cf68" title="START_TEST" alt="" coords="181,212,288,239"/><area shape="rect" id="node3" href="../../db/d79/onion__client_8c.html#a4253f1739f978c9aac584c97b7a55f48" title="client_send_announce\l_request" alt="" coords="336,114,487,155"/><area shape="rect" id="node29" href="../../d9/d26/onion__client_8h.html#aa1be42b5ea93bd068f47271831157927" title="send_onion_data" alt="" coords="351,201,471,228"/><area shape="rect" id="node4" href="../../db/d79/onion__client_8c.html#a934df896ad375a9dbd82f563fb27144f" title="client_ping_nodes" alt="" coords="547,49,674,76"/><area shape="rect" id="node19" href="../../db/d79/onion__client_8c.html#a02301d507ab3c11bfee8112560f36f87" title="do_friend" alt="" coords="789,151,863,177"/><area shape="rect" id="node28" href="../../db/d79/onion__client_8c.html#ae37f00e2304222b24cef2cce370e58d3" title="do_announce" alt="" coords="561,100,660,127"/><area shape="rect" id="node5" href="../../db/d79/onion__client_8c.html#acef82e3853e62dce8cd45450ff028f97" title="handle_announce_response" alt="" coords="735,49,917,76"/><area shape="rect" id="node6" href="../../db/d79/onion__client_8c.html#a3519dd95525df398b46b0e4a928f54f0" title="handle_tcp_onion" alt="" coords="965,24,1088,51"/><area shape="rect" id="node7" href="../../d9/d26/onion__client_8h.html#a9a6ae3a9c70a5221a65bd1c9be751a2e" title="new_onion_client" alt="" coords="1136,63,1259,89"/><area shape="rect" id="node8" href="../../d7/dd9/onion__test_8c.html#a5945771cafdfe39074adf8ddd47ae81b" title="new_onions" alt="" coords="1320,56,1411,83"/><area shape="rect" id="node10" href="../../d4/d30/_messenger_8h.html#af015ea2e74c58196e0564719a6c6a112" title="new_messenger" alt="" coords="1307,157,1424,184"/><area shape="rect" id="node9" href="../../d7/dd9/onion__test_8c.html#a1bd0e98b361db6749c50308a7555a192" title="START_TEST" alt="" coords="1472,56,1579,83"/><area shape="rect" id="node11" href="../../d8/dda/messenger__test_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="1500,157,1551,184"/><area shape="rect" id="node12" href="../../da/d8f/tox_8h.html#aa0e6afccd06a766b84a0633e259f9165" title="Creates and initialises a new Tox instance with the options passed. " alt="" coords="1490,107,1561,133"/><area shape="rect" id="node13" href="../../d0/de9/encryptsave__test_8c.html#abfc6ca1e662bc2b41efecb0b9e35cc9d" title="START_TEST" alt="" coords="1627,56,1733,83"/><area shape="rect" id="node14" href="../../db/d11/irc__syncbot_8c.html#a7a3ec256dab5cbac9fc01ff328980da7" title="init_tox" alt="" coords="1648,5,1712,32"/><area shape="rect" id="node16" href="../../d2/d65/n_tox_8c.html#ac47fc78dd12365ddfd46c70003627250" title="load_data" alt="" coords="1641,157,1719,184"/><area shape="rect" id="node18" href="../../d7/db1/tox__shell_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="1655,107,1705,133"/><area shape="rect" id="node15" href="../../db/d11/irc__syncbot_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="1781,56,1832,83"/><area shape="rect" id="node17" href="../../d2/d65/n_tox_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="1781,208,1832,235"/><area shape="rect" id="node20" href="../../d9/d26/onion__client_8h.html#aa1771a7c1ebf446973e8d2bbb7ea8c2d" title="do_onion_client" alt="" coords="971,141,1083,168"/><area shape="rect" id="node21" href="../../d7/dd9/onion__test_8c.html#ab45bd517e9eb750ba65272a4a8ebc250" title="do_onions" alt="" coords="1157,123,1238,149"/><area shape="rect" id="node22" href="../../d4/d30/_messenger_8h.html#ae0686caa878183a98920aeb7486afcb6" title="do_messenger" alt="" coords="1144,252,1251,279"/><area shape="rect" id="node23" href="../../db/de9/_messenger__test_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="1340,303,1391,329"/><area shape="rect" id="node24" href="../../da/d8f/tox_8h.html#a649c8740c523fb52272396cb0b70b8dc" title="tox_iterate" alt="" coords="1484,259,1567,285"/><area shape="rect" id="node25" href="../../d9/d35/tox__test_8c.html#a4c612d3a3f15c8fbf2e4bde8002bc33b" title="START_TEST" alt="" coords="1627,360,1733,387"/><area shape="rect" id="node26" href="../../d6/dc0/toxav__many__test_8c.html#a8fdafe3be7e00ce3d4f0cb50a9a5eb39" title="while" alt="" coords="1654,309,1706,336"/><area shape="rect" id="node27" href="../../d2/d65/n_tox_8c.html#a1e3c1630c0ca8b687a6a878aa27dd69c" title="line_eval" alt="" coords="1643,259,1717,285"/><area shape="rect" id="node30" href="../../d0/d08/friend__connection_8h.html#a2af492c22c086276ed147d0826839d25" title="send_friend_request\l_packet" alt="" coords="757,245,895,286"/><area shape="rect" id="node32" href="../../db/d79/onion__client_8c.html#a64e317f7dd22c983c325f62aed9ecfae" title="send_dhtpk_announce" alt="" coords="535,201,687,228"/><area shape="rect" id="node31" href="../../d8/d8d/_messenger_8c.html#a5e3bee5110a3531eedb8f92ffd600af8" title="do_friends" alt="" coords="985,252,1068,279"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a301c5cb9db2604dc1ea885c3a2cf8408"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kill_onion </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d3/d01/struct_onion.html">Onion</a> *&#160;</td>
          <td class="paramname"><em>onion</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d4/d18/onion_8c_source.html#l00608">608</a> of file <a class="el" href="../../d4/d18/onion_8c_source.html">onion.c</a>.</p>

<p>References <a class="el" href="../../d3/db9/onion_8h_source.html#l00030">Onion::net</a>, <a class="el" href="../../d9/d94/network_8h_source.html#l00120">NET_PACKET_ONION_RECV_1</a>, <a class="el" href="../../d9/d94/network_8h_source.html#l00119">NET_PACKET_ONION_RECV_2</a>, <a class="el" href="../../d9/d94/network_8h_source.html#l00118">NET_PACKET_ONION_RECV_3</a>, <a class="el" href="../../d9/d94/network_8h_source.html#l00110">NET_PACKET_ONION_SEND_1</a>, <a class="el" href="../../d9/d94/network_8h_source.html#l00111">NET_PACKET_ONION_SEND_2</a>, <a class="el" href="../../d9/d94/network_8h_source.html#l00109">NET_PACKET_ONION_SEND_INITIAL</a>, and <a class="el" href="../../d6/d6e/network_8c_source.html#l00409">networking_registerhandler()</a>.</p>

<p>Referenced by <a class="el" href="../../d8/d8d/_messenger_8c_source.html#l01848">kill_messenger()</a>, <a class="el" href="../../d7/dd9/onion__test_8c_source.html#l00294">kill_onions()</a>, <a class="el" href="../../d8/d8d/_messenger_8c_source.html#l01751">new_messenger()</a>, and <a class="el" href="../../d7/dd9/onion__test_8c_source.html#l00129">START_TEST()</a>.</p>
<div class="fragment"><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;{</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    <span class="keywordflow">if</span> (onion == NULL)</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    <a class="code" href="../../d6/d6e/network_8c.html#a230a192ca9463ec4985d4f86de439733">networking_registerhandler</a>(onion-&gt;<a class="code" href="../../d3/d01/struct_onion.html#aa14ea2f67950f57fe4235d7375a2216c">net</a>, <a class="code" href="../../d9/d94/network_8h.html#a6d89eb02b93f686802f9d3e5e7f7ab2d">NET_PACKET_ONION_SEND_INITIAL</a>, NULL, NULL);</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    <a class="code" href="../../d6/d6e/network_8c.html#a230a192ca9463ec4985d4f86de439733">networking_registerhandler</a>(onion-&gt;<a class="code" href="../../d3/d01/struct_onion.html#aa14ea2f67950f57fe4235d7375a2216c">net</a>, <a class="code" href="../../d9/d94/network_8h.html#af35e3289fe8c4324b7a07655952f5eab">NET_PACKET_ONION_SEND_1</a>, NULL, NULL);</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    <a class="code" href="../../d6/d6e/network_8c.html#a230a192ca9463ec4985d4f86de439733">networking_registerhandler</a>(onion-&gt;<a class="code" href="../../d3/d01/struct_onion.html#aa14ea2f67950f57fe4235d7375a2216c">net</a>, <a class="code" href="../../d9/d94/network_8h.html#ac537a2a6be093500c4d362012515b565">NET_PACKET_ONION_SEND_2</a>, NULL, NULL);</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;    <a class="code" href="../../d6/d6e/network_8c.html#a230a192ca9463ec4985d4f86de439733">networking_registerhandler</a>(onion-&gt;<a class="code" href="../../d3/d01/struct_onion.html#aa14ea2f67950f57fe4235d7375a2216c">net</a>, <a class="code" href="../../d9/d94/network_8h.html#a7ef70febad8b27e23b73db25d78cd666">NET_PACKET_ONION_RECV_3</a>, NULL, NULL);</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    <a class="code" href="../../d6/d6e/network_8c.html#a230a192ca9463ec4985d4f86de439733">networking_registerhandler</a>(onion-&gt;<a class="code" href="../../d3/d01/struct_onion.html#aa14ea2f67950f57fe4235d7375a2216c">net</a>, <a class="code" href="../../d9/d94/network_8h.html#a27ee7b36bdc6b4fb72e704fee4dc392b">NET_PACKET_ONION_RECV_2</a>, NULL, NULL);</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    <a class="code" href="../../d6/d6e/network_8c.html#a230a192ca9463ec4985d4f86de439733">networking_registerhandler</a>(onion-&gt;<a class="code" href="../../d3/d01/struct_onion.html#aa14ea2f67950f57fe4235d7375a2216c">net</a>, <a class="code" href="../../d9/d94/network_8h.html#ac2df6c149caae49d80e5217d480ae839">NET_PACKET_ONION_RECV_1</a>, NULL, NULL);</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    free(onion);</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;}</div>
<div class="ttc" id="network_8h_html_ac2df6c149caae49d80e5217d480ae839"><div class="ttname"><a href="../../d9/d94/network_8h.html#ac2df6c149caae49d80e5217d480ae839">NET_PACKET_ONION_RECV_1</a></div><div class="ttdeci">#define NET_PACKET_ONION_RECV_1</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d94/network_8h_source.html#l00120">network.h:120</a></div></div>
<div class="ttc" id="network_8h_html_ac537a2a6be093500c4d362012515b565"><div class="ttname"><a href="../../d9/d94/network_8h.html#ac537a2a6be093500c4d362012515b565">NET_PACKET_ONION_SEND_2</a></div><div class="ttdeci">#define NET_PACKET_ONION_SEND_2</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d94/network_8h_source.html#l00111">network.h:111</a></div></div>
<div class="ttc" id="network_8h_html_a27ee7b36bdc6b4fb72e704fee4dc392b"><div class="ttname"><a href="../../d9/d94/network_8h.html#a27ee7b36bdc6b4fb72e704fee4dc392b">NET_PACKET_ONION_RECV_2</a></div><div class="ttdeci">#define NET_PACKET_ONION_RECV_2</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d94/network_8h_source.html#l00119">network.h:119</a></div></div>
<div class="ttc" id="network_8h_html_a7ef70febad8b27e23b73db25d78cd666"><div class="ttname"><a href="../../d9/d94/network_8h.html#a7ef70febad8b27e23b73db25d78cd666">NET_PACKET_ONION_RECV_3</a></div><div class="ttdeci">#define NET_PACKET_ONION_RECV_3</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d94/network_8h_source.html#l00118">network.h:118</a></div></div>
<div class="ttc" id="network_8h_html_a6d89eb02b93f686802f9d3e5e7f7ab2d"><div class="ttname"><a href="../../d9/d94/network_8h.html#a6d89eb02b93f686802f9d3e5e7f7ab2d">NET_PACKET_ONION_SEND_INITIAL</a></div><div class="ttdeci">#define NET_PACKET_ONION_SEND_INITIAL</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d94/network_8h_source.html#l00109">network.h:109</a></div></div>
<div class="ttc" id="struct_onion_html_aa14ea2f67950f57fe4235d7375a2216c"><div class="ttname"><a href="../../d3/d01/struct_onion.html#aa14ea2f67950f57fe4235d7375a2216c">Onion::net</a></div><div class="ttdeci">Networking_Core * net</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db9/onion_8h_source.html#l00030">onion.h:30</a></div></div>
<div class="ttc" id="network_8c_html_a230a192ca9463ec4985d4f86de439733"><div class="ttname"><a href="../../d6/d6e/network_8c.html#a230a192ca9463ec4985d4f86de439733">networking_registerhandler</a></div><div class="ttdeci">void networking_registerhandler(Networking_Core *net, uint8_t byte, packet_handler_callback cb, void *object)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d6e/network_8c_source.html#l00409">network.c:409</a></div></div>
<div class="ttc" id="network_8h_html_af35e3289fe8c4324b7a07655952f5eab"><div class="ttname"><a href="../../d9/d94/network_8h.html#af35e3289fe8c4324b7a07655952f5eab">NET_PACKET_ONION_SEND_1</a></div><div class="ttdeci">#define NET_PACKET_ONION_SEND_1</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d94/network_8h_source.html#l00110">network.h:110</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d3/db9/onion_8h_a301c5cb9db2604dc1ea885c3a2cf8408_cgraph.png" border="0" usemap="#d3/db9/onion_8h_a301c5cb9db2604dc1ea885c3a2cf8408_cgraph" alt=""/></div>
<map name="d3/db9/onion_8h_a301c5cb9db2604dc1ea885c3a2cf8408_cgraph" id="d3/db9/onion_8h_a301c5cb9db2604dc1ea885c3a2cf8408_cgraph">
<area shape="rect" id="node2" href="../../d6/d6e/network_8c.html#a230a192ca9463ec4985d4f86de439733" title="networking_registerhandler" alt="" coords="129,5,307,32"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d3/db9/onion_8h_a301c5cb9db2604dc1ea885c3a2cf8408_icgraph.png" border="0" usemap="#d3/db9/onion_8h_a301c5cb9db2604dc1ea885c3a2cf8408_icgraph" alt=""/></div>
<map name="d3/db9/onion_8h_a301c5cb9db2604dc1ea885c3a2cf8408_icgraph" id="d3/db9/onion_8h_a301c5cb9db2604dc1ea885c3a2cf8408_icgraph">
<area shape="rect" id="node2" href="../../d4/d30/_messenger_8h.html#a771c65c3057d870b0653c2fdf0a12fb7" title="kill_messenger" alt="" coords="133,107,243,133"/><area shape="rect" id="node12" href="../../d7/dd9/onion__test_8c.html#a11b4d3c94243b8abdd439dea94ee679e" title="kill_onions" alt="" coords="147,157,229,184"/><area shape="rect" id="node14" href="../../d4/d30/_messenger_8h.html#af015ea2e74c58196e0564719a6c6a112" title="new_messenger" alt="" coords="129,56,247,83"/><area shape="rect" id="node15" href="../../d7/dd9/onion__test_8c.html#ad7475d1539db4bb3bcf8673dd7f7cf68" title="START_TEST" alt="" coords="135,208,241,235"/><area shape="rect" id="node3" href="../../d8/dda/messenger__test_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="323,31,373,57"/><area shape="rect" id="node4" href="../../da/d8f/tox_8h.html#a52259e134bfb9396d9fef4fffe94e878" title="tox_kill" alt="" coords="317,132,379,159"/><area shape="rect" id="node5" href="../../da/d8f/tox_8h.html#aa0e6afccd06a766b84a0633e259f9165" title="Creates and initialises a new Tox instance with the options passed. " alt="" coords="313,81,383,108"/><area shape="rect" id="node6" href="../../d0/de9/encryptsave__test_8c.html#abfc6ca1e662bc2b41efecb0b9e35cc9d" title="START_TEST" alt="" coords="449,5,556,32"/><area shape="rect" id="node7" href="../../db/d11/irc__syncbot_8c.html#a7a3ec256dab5cbac9fc01ff328980da7" title="init_tox" alt="" coords="471,56,535,83"/><area shape="rect" id="node9" href="../../d2/d65/n_tox_8c.html#ac47fc78dd12365ddfd46c70003627250" title="load_data" alt="" coords="463,107,542,133"/><area shape="rect" id="node11" href="../../d7/db1/tox__shell_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="477,157,528,184"/><area shape="rect" id="node8" href="../../db/d11/irc__syncbot_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="604,56,655,83"/><area shape="rect" id="node10" href="../../d2/d65/n_tox_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="604,107,655,133"/><area shape="rect" id="node13" href="../../d7/dd9/onion__test_8c.html#a1bd0e98b361db6749c50308a7555a192" title="START_TEST" alt="" coords="295,183,401,209"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a71877ec5931feec418ed1ae10b0963d8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d3/d01/struct_onion.html">Onion</a>* new_onion </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../de/d15/struct_d_h_t.html">DHT</a> *&#160;</td>
          <td class="paramname"><em>dht</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d4/d18/onion_8c_source.html#l00582">582</a> of file <a class="el" href="../../d4/d18/onion_8c_source.html">onion.c</a>.</p>

<p>References <a class="el" href="../../d3/db9/onion_8h_source.html#l00029">Onion::dht</a>, <a class="el" href="../../d4/d18/onion_8c_source.html#l00541">handle_recv_1()</a>, <a class="el" href="../../d4/d18/onion_8c_source.html#l00505">handle_recv_2()</a>, <a class="el" href="../../d4/d18/onion_8c_source.html#l00469">handle_recv_3()</a>, <a class="el" href="../../d4/d18/onion_8c_source.html#l00370">handle_send_1()</a>, <a class="el" href="../../d4/d18/onion_8c_source.html#l00420">handle_send_2()</a>, <a class="el" href="../../d4/d18/onion_8c_source.html#l00309">handle_send_initial()</a>, <a class="el" href="../../d3/db9/onion_8h_source.html#l00030">Onion::net</a>, <a class="el" href="../../df/dad/_d_h_t_8h_source.html#l00201">DHT::net</a>, <a class="el" href="../../d9/d94/network_8h_source.html#l00120">NET_PACKET_ONION_RECV_1</a>, <a class="el" href="../../d9/d94/network_8h_source.html#l00119">NET_PACKET_ONION_RECV_2</a>, <a class="el" href="../../d9/d94/network_8h_source.html#l00118">NET_PACKET_ONION_RECV_3</a>, <a class="el" href="../../d9/d94/network_8h_source.html#l00110">NET_PACKET_ONION_SEND_1</a>, <a class="el" href="../../d9/d94/network_8h_source.html#l00111">NET_PACKET_ONION_SEND_2</a>, <a class="el" href="../../d9/d94/network_8h_source.html#l00109">NET_PACKET_ONION_SEND_INITIAL</a>, <a class="el" href="../../d6/d6e/network_8c_source.html#l00409">networking_registerhandler()</a>, <a class="el" href="../../dc/d85/crypto__core_8c_source.html#l00182">new_symmetric_key()</a>, <a class="el" href="../../d3/db9/onion_8h_source.html#l00031">Onion::secret_symmetric_key</a>, <a class="el" href="../../d3/db9/onion_8h_source.html#l00032">Onion::timestamp</a>, and <a class="el" href="../../de/df1/util_8c_source.html#l00049">unix_time()</a>.</p>

<p>Referenced by <a class="el" href="../../d1/d36/tox-bootstrapd_8c_source.html#l00519">main()</a>, <a class="el" href="../../d8/d8d/_messenger_8c_source.html#l01751">new_messenger()</a>, <a class="el" href="../../d7/dd9/onion__test_8c_source.html#l00269">new_onions()</a>, and <a class="el" href="../../d7/dd9/onion__test_8c_source.html#l00129">START_TEST()</a>.</p>
<div class="fragment"><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;{</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    <span class="keywordflow">if</span> (dht == NULL)</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;        <span class="keywordflow">return</span> NULL;</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    <a class="code" href="../../d3/d01/struct_onion.html">Onion</a> *onion = calloc(1, <span class="keyword">sizeof</span>(<a class="code" href="../../d3/d01/struct_onion.html">Onion</a>));</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    <span class="keywordflow">if</span> (onion == NULL)</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;        <span class="keywordflow">return</span> NULL;</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    onion-&gt;<a class="code" href="../../d3/d01/struct_onion.html#a8b3d6ce8745acc52695e252bdb1531b6">dht</a> = dht;</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    onion-&gt;<a class="code" href="../../d3/d01/struct_onion.html#aa14ea2f67950f57fe4235d7375a2216c">net</a> = dht-&gt;<a class="code" href="../../de/d15/struct_d_h_t.html#aa14ea2f67950f57fe4235d7375a2216c">net</a>;</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    <a class="code" href="../../dc/d85/crypto__core_8c.html#a89b4a1a4a7d8bfabdf0e1b60f074e531">new_symmetric_key</a>(onion-&gt;<a class="code" href="../../d3/d01/struct_onion.html#ab9f2ff47bc0b1e5110202a6e4be86390">secret_symmetric_key</a>);</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    onion-&gt;<a class="code" href="../../d3/d01/struct_onion.html#a465bef81f6478756e5443025b1f2ddfa">timestamp</a> = <a class="code" href="../../de/df1/util_8c.html#ac958d9f8847cb8039444bfa3d304233a">unix_time</a>();</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    <a class="code" href="../../d6/d6e/network_8c.html#a230a192ca9463ec4985d4f86de439733">networking_registerhandler</a>(onion-&gt;<a class="code" href="../../d3/d01/struct_onion.html#aa14ea2f67950f57fe4235d7375a2216c">net</a>, <a class="code" href="../../d9/d94/network_8h.html#a6d89eb02b93f686802f9d3e5e7f7ab2d">NET_PACKET_ONION_SEND_INITIAL</a>, &amp;<a class="code" href="../../d4/d18/onion_8c.html#ad1a4dfd05094ff479cda552ed94059f7">handle_send_initial</a>, onion);</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    <a class="code" href="../../d6/d6e/network_8c.html#a230a192ca9463ec4985d4f86de439733">networking_registerhandler</a>(onion-&gt;<a class="code" href="../../d3/d01/struct_onion.html#aa14ea2f67950f57fe4235d7375a2216c">net</a>, <a class="code" href="../../d9/d94/network_8h.html#af35e3289fe8c4324b7a07655952f5eab">NET_PACKET_ONION_SEND_1</a>, &amp;<a class="code" href="../../d4/d18/onion_8c.html#af8b808b43786292e39b10d6e05ba1cb7">handle_send_1</a>, onion);</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    <a class="code" href="../../d6/d6e/network_8c.html#a230a192ca9463ec4985d4f86de439733">networking_registerhandler</a>(onion-&gt;<a class="code" href="../../d3/d01/struct_onion.html#aa14ea2f67950f57fe4235d7375a2216c">net</a>, <a class="code" href="../../d9/d94/network_8h.html#ac537a2a6be093500c4d362012515b565">NET_PACKET_ONION_SEND_2</a>, &amp;<a class="code" href="../../d4/d18/onion_8c.html#a60a847c1f3f33f8e2efdc13ede5f7ecc">handle_send_2</a>, onion);</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    <a class="code" href="../../d6/d6e/network_8c.html#a230a192ca9463ec4985d4f86de439733">networking_registerhandler</a>(onion-&gt;<a class="code" href="../../d3/d01/struct_onion.html#aa14ea2f67950f57fe4235d7375a2216c">net</a>, <a class="code" href="../../d9/d94/network_8h.html#a7ef70febad8b27e23b73db25d78cd666">NET_PACKET_ONION_RECV_3</a>, &amp;<a class="code" href="../../d4/d18/onion_8c.html#aad67ae9de051b78358faf690eaa03099">handle_recv_3</a>, onion);</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    <a class="code" href="../../d6/d6e/network_8c.html#a230a192ca9463ec4985d4f86de439733">networking_registerhandler</a>(onion-&gt;<a class="code" href="../../d3/d01/struct_onion.html#aa14ea2f67950f57fe4235d7375a2216c">net</a>, <a class="code" href="../../d9/d94/network_8h.html#a27ee7b36bdc6b4fb72e704fee4dc392b">NET_PACKET_ONION_RECV_2</a>, &amp;<a class="code" href="../../d4/d18/onion_8c.html#a2efffc024cccd53f433718980ccf4541">handle_recv_2</a>, onion);</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    <a class="code" href="../../d6/d6e/network_8c.html#a230a192ca9463ec4985d4f86de439733">networking_registerhandler</a>(onion-&gt;<a class="code" href="../../d3/d01/struct_onion.html#aa14ea2f67950f57fe4235d7375a2216c">net</a>, <a class="code" href="../../d9/d94/network_8h.html#ac2df6c149caae49d80e5217d480ae839">NET_PACKET_ONION_RECV_1</a>, &amp;<a class="code" href="../../d4/d18/onion_8c.html#a733219ca8d321d01a999f10447b2e301">handle_recv_1</a>, onion);</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    <span class="keywordflow">return</span> onion;</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;}</div>
<div class="ttc" id="network_8h_html_ac2df6c149caae49d80e5217d480ae839"><div class="ttname"><a href="../../d9/d94/network_8h.html#ac2df6c149caae49d80e5217d480ae839">NET_PACKET_ONION_RECV_1</a></div><div class="ttdeci">#define NET_PACKET_ONION_RECV_1</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d94/network_8h_source.html#l00120">network.h:120</a></div></div>
<div class="ttc" id="network_8h_html_ac537a2a6be093500c4d362012515b565"><div class="ttname"><a href="../../d9/d94/network_8h.html#ac537a2a6be093500c4d362012515b565">NET_PACKET_ONION_SEND_2</a></div><div class="ttdeci">#define NET_PACKET_ONION_SEND_2</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d94/network_8h_source.html#l00111">network.h:111</a></div></div>
<div class="ttc" id="network_8h_html_a27ee7b36bdc6b4fb72e704fee4dc392b"><div class="ttname"><a href="../../d9/d94/network_8h.html#a27ee7b36bdc6b4fb72e704fee4dc392b">NET_PACKET_ONION_RECV_2</a></div><div class="ttdeci">#define NET_PACKET_ONION_RECV_2</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d94/network_8h_source.html#l00119">network.h:119</a></div></div>
<div class="ttc" id="network_8h_html_a7ef70febad8b27e23b73db25d78cd666"><div class="ttname"><a href="../../d9/d94/network_8h.html#a7ef70febad8b27e23b73db25d78cd666">NET_PACKET_ONION_RECV_3</a></div><div class="ttdeci">#define NET_PACKET_ONION_RECV_3</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d94/network_8h_source.html#l00118">network.h:118</a></div></div>
<div class="ttc" id="util_8c_html_ac958d9f8847cb8039444bfa3d304233a"><div class="ttname"><a href="../../de/df1/util_8c.html#ac958d9f8847cb8039444bfa3d304233a">unix_time</a></div><div class="ttdeci">uint64_t unix_time()</div><div class="ttdef"><b>Definition:</b> <a href="../../de/df1/util_8c_source.html#l00049">util.c:49</a></div></div>
<div class="ttc" id="network_8h_html_a6d89eb02b93f686802f9d3e5e7f7ab2d"><div class="ttname"><a href="../../d9/d94/network_8h.html#a6d89eb02b93f686802f9d3e5e7f7ab2d">NET_PACKET_ONION_SEND_INITIAL</a></div><div class="ttdeci">#define NET_PACKET_ONION_SEND_INITIAL</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d94/network_8h_source.html#l00109">network.h:109</a></div></div>
<div class="ttc" id="struct_onion_html"><div class="ttname"><a href="../../d3/d01/struct_onion.html">Onion</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db9/onion_8h_source.html#l00028">onion.h:28</a></div></div>
<div class="ttc" id="onion_8c_html_af8b808b43786292e39b10d6e05ba1cb7"><div class="ttname"><a href="../../d4/d18/onion_8c.html#af8b808b43786292e39b10d6e05ba1cb7">handle_send_1</a></div><div class="ttdeci">static int handle_send_1(void *object, IP_Port source, const uint8_t *packet, uint16_t length)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d18/onion_8c_source.html#l00370">onion.c:370</a></div></div>
<div class="ttc" id="struct_d_h_t_html_aa14ea2f67950f57fe4235d7375a2216c"><div class="ttname"><a href="../../de/d15/struct_d_h_t.html#aa14ea2f67950f57fe4235d7375a2216c">DHT::net</a></div><div class="ttdeci">Networking_Core * net</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dad/_d_h_t_8h_source.html#l00201">DHT.h:201</a></div></div>
<div class="ttc" id="onion_8c_html_aad67ae9de051b78358faf690eaa03099"><div class="ttname"><a href="../../d4/d18/onion_8c.html#aad67ae9de051b78358faf690eaa03099">handle_recv_3</a></div><div class="ttdeci">static int handle_recv_3(void *object, IP_Port source, const uint8_t *packet, uint16_t length)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d18/onion_8c_source.html#l00469">onion.c:469</a></div></div>
<div class="ttc" id="crypto__core_8c_html_a89b4a1a4a7d8bfabdf0e1b60f074e531"><div class="ttname"><a href="../../dc/d85/crypto__core_8c.html#a89b4a1a4a7d8bfabdf0e1b60f074e531">new_symmetric_key</a></div><div class="ttdeci">void new_symmetric_key(uint8_t *key)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d85/crypto__core_8c_source.html#l00182">crypto_core.c:182</a></div></div>
<div class="ttc" id="struct_onion_html_a465bef81f6478756e5443025b1f2ddfa"><div class="ttname"><a href="../../d3/d01/struct_onion.html#a465bef81f6478756e5443025b1f2ddfa">Onion::timestamp</a></div><div class="ttdeci">uint64_t timestamp</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db9/onion_8h_source.html#l00032">onion.h:32</a></div></div>
<div class="ttc" id="struct_onion_html_a8b3d6ce8745acc52695e252bdb1531b6"><div class="ttname"><a href="../../d3/d01/struct_onion.html#a8b3d6ce8745acc52695e252bdb1531b6">Onion::dht</a></div><div class="ttdeci">DHT * dht</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db9/onion_8h_source.html#l00029">onion.h:29</a></div></div>
<div class="ttc" id="struct_onion_html_aa14ea2f67950f57fe4235d7375a2216c"><div class="ttname"><a href="../../d3/d01/struct_onion.html#aa14ea2f67950f57fe4235d7375a2216c">Onion::net</a></div><div class="ttdeci">Networking_Core * net</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db9/onion_8h_source.html#l00030">onion.h:30</a></div></div>
<div class="ttc" id="struct_onion_html_ab9f2ff47bc0b1e5110202a6e4be86390"><div class="ttname"><a href="../../d3/d01/struct_onion.html#ab9f2ff47bc0b1e5110202a6e4be86390">Onion::secret_symmetric_key</a></div><div class="ttdeci">uint8_t secret_symmetric_key[crypto_box_KEYBYTES]</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db9/onion_8h_source.html#l00031">onion.h:31</a></div></div>
<div class="ttc" id="onion_8c_html_a60a847c1f3f33f8e2efdc13ede5f7ecc"><div class="ttname"><a href="../../d4/d18/onion_8c.html#a60a847c1f3f33f8e2efdc13ede5f7ecc">handle_send_2</a></div><div class="ttdeci">static int handle_send_2(void *object, IP_Port source, const uint8_t *packet, uint16_t length)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d18/onion_8c_source.html#l00420">onion.c:420</a></div></div>
<div class="ttc" id="onion_8c_html_a733219ca8d321d01a999f10447b2e301"><div class="ttname"><a href="../../d4/d18/onion_8c.html#a733219ca8d321d01a999f10447b2e301">handle_recv_1</a></div><div class="ttdeci">static int handle_recv_1(void *object, IP_Port source, const uint8_t *packet, uint16_t length)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d18/onion_8c_source.html#l00541">onion.c:541</a></div></div>
<div class="ttc" id="onion_8c_html_a2efffc024cccd53f433718980ccf4541"><div class="ttname"><a href="../../d4/d18/onion_8c.html#a2efffc024cccd53f433718980ccf4541">handle_recv_2</a></div><div class="ttdeci">static int handle_recv_2(void *object, IP_Port source, const uint8_t *packet, uint16_t length)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d18/onion_8c_source.html#l00505">onion.c:505</a></div></div>
<div class="ttc" id="network_8c_html_a230a192ca9463ec4985d4f86de439733"><div class="ttname"><a href="../../d6/d6e/network_8c.html#a230a192ca9463ec4985d4f86de439733">networking_registerhandler</a></div><div class="ttdeci">void networking_registerhandler(Networking_Core *net, uint8_t byte, packet_handler_callback cb, void *object)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d6e/network_8c_source.html#l00409">network.c:409</a></div></div>
<div class="ttc" id="network_8h_html_af35e3289fe8c4324b7a07655952f5eab"><div class="ttname"><a href="../../d9/d94/network_8h.html#af35e3289fe8c4324b7a07655952f5eab">NET_PACKET_ONION_SEND_1</a></div><div class="ttdeci">#define NET_PACKET_ONION_SEND_1</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d94/network_8h_source.html#l00110">network.h:110</a></div></div>
<div class="ttc" id="onion_8c_html_ad1a4dfd05094ff479cda552ed94059f7"><div class="ttname"><a href="../../d4/d18/onion_8c.html#ad1a4dfd05094ff479cda552ed94059f7">handle_send_initial</a></div><div class="ttdeci">static int handle_send_initial(void *object, IP_Port source, const uint8_t *packet, uint16_t length)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d18/onion_8c_source.html#l00309">onion.c:309</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d3/db9/onion_8h_a71877ec5931feec418ed1ae10b0963d8_cgraph.png" border="0" usemap="#d3/db9/onion_8h_a71877ec5931feec418ed1ae10b0963d8_cgraph" alt=""/></div>
<map name="d3/db9/onion_8h_a71877ec5931feec418ed1ae10b0963d8_cgraph" id="d3/db9/onion_8h_a71877ec5931feec418ed1ae10b0963d8_cgraph">
<area shape="rect" id="node2" href="../../d4/d18/onion_8c.html#a733219ca8d321d01a999f10447b2e301" title="handle_recv_1" alt="" coords="364,195,471,222"/><area shape="rect" id="node5" href="../../de/df1/util_8c.html#ac958d9f8847cb8039444bfa3d304233a" title="unix_time" alt="" coords="938,195,1017,222"/><area shape="rect" id="node6" href="../../dc/d85/crypto__core_8c.html#a89b4a1a4a7d8bfabdf0e1b60f074e531" title="new_symmetric_key" alt="" coords="733,80,876,107"/><area shape="rect" id="node12" href="../../d4/d18/onion_8c.html#a2efffc024cccd53f433718980ccf4541" title="handle_recv_2" alt="" coords="364,296,471,323"/><area shape="rect" id="node13" href="../../d4/d18/onion_8c.html#aad67ae9de051b78358faf690eaa03099" title="handle_recv_3" alt="" coords="364,144,471,171"/><area shape="rect" id="node14" href="../../d4/d18/onion_8c.html#af8b808b43786292e39b10d6e05ba1cb7" title="handle_send_1" alt="" coords="363,347,472,374"/><area shape="rect" id="node23" href="../../d4/d18/onion_8c.html#a60a847c1f3f33f8e2efdc13ede5f7ecc" title="handle_send_2" alt="" coords="363,398,472,424"/><area shape="rect" id="node24" href="../../d4/d18/onion_8c.html#ad1a4dfd05094ff479cda552ed94059f7" title="handle_send_initial" alt="" coords="160,296,292,323"/><area shape="rect" id="node26" href="../../d6/d6e/network_8c.html#a230a192ca9463ec4985d4f86de439733" title="networking_registerhandler" alt="" coords="137,448,315,475"/><area shape="rect" id="node3" href="../../d4/d18/onion_8c.html#aa1c4b4ce8c4a67cd1590892ee6ed57c7" title="change_symmetric_key" alt="" coords="523,170,683,196"/><area shape="rect" id="node7" href="../../dc/d85/crypto__core_8c.html#a824b257fcff74b9d17c5247223fbed29" title="decrypt_data_symmetric" alt="" coords="520,220,685,247"/><area shape="rect" id="node8" href="../../d4/d18/onion_8c.html#a5134cc15375a918b584e3c408e038331" title="ipport_unpack" alt="" coords="551,322,654,348"/><area shape="rect" id="node11" href="../../d6/d6e/network_8c.html#a7b90f87f3ba60cc5c66dd6dd77cd5cb1" title="sendpacket" alt="" coords="558,271,647,298"/><area shape="rect" id="node4" href="../../de/df1/util_8c.html#ab643c84141e04b54ba650c50165ba288" title="is_timeout" alt="" coords="763,220,846,247"/><area shape="rect" id="node9" href="../../d4/d18/onion_8c.html#a0687fad9fd17ea53d6b84a6cfc7e0d78" title="ip_unpack" alt="" coords="764,322,845,348"/><area shape="rect" id="node10" href="../../dc/dc1/_d_h_t_8c.html#a74120ec4fc551572bff2a08436854c97" title="to_host_family" alt="" coords="924,322,1031,348"/><area shape="rect" id="node15" href="../../dc/d85/crypto__core_8c.html#a81efc0a4a6e0efe372651e26e342a6e5" title="encrypt_data_symmetric" alt="" coords="520,423,685,450"/><area shape="rect" id="node16" href="../../dc/dc1/_d_h_t_8c.html#a6cd4aa89d7bfcf6805c5ce6b273d9e9e" title="get_shared_key" alt="" coords="545,474,660,500"/><area shape="rect" id="node18" href="../../d4/d18/onion_8c.html#ae9d8dde9317c06fe493658b8145de853" title="ipport_pack" alt="" coords="558,524,647,551"/><area shape="rect" id="node21" href="../../dc/d85/crypto__core_8c.html#a8b1033efb47c625779d11be7d8eb9e24" title="new_nonce" alt="" coords="559,372,647,399"/><area shape="rect" id="node17" href="../../dc/d85/crypto__core_8c.html#a0d8eaef49981c5dc3ada078866b42f6d" title="encrypt_precompute" alt="" coords="735,474,875,500"/><area shape="rect" id="node19" href="../../d4/d18/onion_8c.html#a6b9b6abcbb6fde502e7822236a978118" title="ip_pack" alt="" coords="771,524,838,551"/><area shape="rect" id="node20" href="../../dc/dc1/_d_h_t_8c.html#ae7f65a76f9c4b0093f45fc1777238459" title="to_net_family" alt="" coords="927,524,1027,551"/><area shape="rect" id="node22" href="../../dc/d85/crypto__core_8c.html#a15ef255ab026d4881a16b99148b05dd7" title="random_nonce" alt="" coords="751,372,858,399"/><area shape="rect" id="node25" href="../../d4/d18/onion_8c.html#a112ff3dd6d8a1e104516eb4b465fc2fa" title="onion_send_1" alt="" coords="366,448,469,475"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d3/db9/onion_8h_a71877ec5931feec418ed1ae10b0963d8_icgraph.png" border="0" usemap="#d3/db9/onion_8h_a71877ec5931feec418ed1ae10b0963d8_icgraph" alt=""/></div>
<map name="d3/db9/onion_8h_a71877ec5931feec418ed1ae10b0963d8_icgraph" id="d3/db9/onion_8h_a71877ec5931feec418ed1ae10b0963d8_icgraph">
<area shape="rect" id="node2" href="../../d1/d36/tox-bootstrapd_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="171,31,221,57"/><area shape="rect" id="node3" href="../../d4/d30/_messenger_8h.html#af015ea2e74c58196e0564719a6c6a112" title="new_messenger" alt="" coords="137,81,255,108"/><area shape="rect" id="node12" href="../../d7/dd9/onion__test_8c.html#a5945771cafdfe39074adf8ddd47ae81b" title="new_onions" alt="" coords="151,132,241,159"/><area shape="rect" id="node14" href="../../d7/dd9/onion__test_8c.html#ad7475d1539db4bb3bcf8673dd7f7cf68" title="START_TEST" alt="" coords="143,183,249,209"/><area shape="rect" id="node4" href="../../d8/dda/messenger__test_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="331,31,381,57"/><area shape="rect" id="node5" href="../../da/d8f/tox_8h.html#aa0e6afccd06a766b84a0633e259f9165" title="Creates and initialises a new Tox instance with the options passed. " alt="" coords="321,81,391,108"/><area shape="rect" id="node6" href="../../d0/de9/encryptsave__test_8c.html#abfc6ca1e662bc2b41efecb0b9e35cc9d" title="START_TEST" alt="" coords="457,5,564,32"/><area shape="rect" id="node7" href="../../db/d11/irc__syncbot_8c.html#a7a3ec256dab5cbac9fc01ff328980da7" title="init_tox" alt="" coords="479,56,543,83"/><area shape="rect" id="node9" href="../../d2/d65/n_tox_8c.html#ac47fc78dd12365ddfd46c70003627250" title="load_data" alt="" coords="471,107,550,133"/><area shape="rect" id="node11" href="../../d7/db1/tox__shell_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="485,157,536,184"/><area shape="rect" id="node8" href="../../db/d11/irc__syncbot_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="612,56,663,83"/><area shape="rect" id="node10" href="../../d2/d65/n_tox_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="612,107,663,133"/><area shape="rect" id="node13" href="../../d7/dd9/onion__test_8c.html#a1bd0e98b361db6749c50308a7555a192" title="START_TEST" alt="" coords="303,132,409,159"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a0037270c6e9bca59c4e0cd118ebfa593"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int onion_path_to_nodes </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d3/d53/struct_node__format.html">Node_format</a> *&#160;</td>
          <td class="paramname"><em>nodes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>num_nodes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../df/d31/struct_onion___path.html">Onion_Path</a> *&#160;</td>
          <td class="paramname"><em>path</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d4/d18/onion_8c_source.html#l00149">149</a> of file <a class="el" href="../../d4/d18/onion_8c_source.html">onion.c</a>.</p>

<p>References <a class="el" href="../../df/dad/_d_h_t_8h_source.html#l00149">Node_format::ip_port</a>, <a class="el" href="../../d3/db9/onion_8h_source.html#l00067">Onion_Path::ip_port1</a>, <a class="el" href="../../d3/db9/onion_8h_source.html#l00070">Onion_Path::ip_port2</a>, <a class="el" href="../../d3/db9/onion_8h_source.html#l00073">Onion_Path::ip_port3</a>, <a class="el" href="../../d3/db9/onion_8h_source.html#l00068">Onion_Path::node_public_key1</a>, <a class="el" href="../../d3/db9/onion_8h_source.html#l00071">Onion_Path::node_public_key2</a>, <a class="el" href="../../d3/db9/onion_8h_source.html#l00074">Onion_Path::node_public_key3</a>, <a class="el" href="../../d3/db9/onion_8h_source.html#l00056">ONION_PATH_LENGTH</a>, and <a class="el" href="../../d2/d01/make-funny-savefile_8py_source.html#l00068">make-funny-savefile::public_key</a>.</p>

<p>Referenced by <a class="el" href="../../db/d79/onion__client_8c_source.html#l00273">set_path_timeouts()</a>.</p>
<div class="fragment"><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;{</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <span class="keywordflow">if</span> (num_nodes &lt; <a class="code" href="../../d3/db9/onion_8h.html#abe0dd1f2cbadfda52425e7c2fed7d8c3">ONION_PATH_LENGTH</a>)</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    nodes[0].<a class="code" href="../../d3/d53/struct_node__format.html#a86e2a5a56c0dd22df6e8b8a10e40f9e4">ip_port</a> = path-&gt;<a class="code" href="../../df/d31/struct_onion___path.html#ad7670c0a1a9d05b2a807a9c1a7950b79">ip_port1</a>;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    nodes[1].<a class="code" href="../../d3/d53/struct_node__format.html#a86e2a5a56c0dd22df6e8b8a10e40f9e4">ip_port</a> = path-&gt;<a class="code" href="../../df/d31/struct_onion___path.html#adcf789584e4efc296bc6f915d3e2e9f9">ip_port2</a>;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    nodes[2].<a class="code" href="../../d3/d53/struct_node__format.html#a86e2a5a56c0dd22df6e8b8a10e40f9e4">ip_port</a> = path-&gt;<a class="code" href="../../df/d31/struct_onion___path.html#aef20a4d17084ae724f2e496f8f7a106a">ip_port3</a>;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    memcpy(nodes[0].<a class="code" href="../../df/db5/namespacemake-funny-savefile.html#a6734667aeff5c30ad9e5624ccb556a87">public_key</a>, path-&gt;<a class="code" href="../../df/d31/struct_onion___path.html#a38f4e3f7780648cf74f808d7942113d8">node_public_key1</a>, crypto_box_PUBLICKEYBYTES);</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    memcpy(nodes[1].<a class="code" href="../../df/db5/namespacemake-funny-savefile.html#a6734667aeff5c30ad9e5624ccb556a87">public_key</a>, path-&gt;<a class="code" href="../../df/d31/struct_onion___path.html#adc5a9730c2f43085e83ece3257af154a">node_public_key2</a>, crypto_box_PUBLICKEYBYTES);</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    memcpy(nodes[2].<a class="code" href="../../df/db5/namespacemake-funny-savefile.html#a6734667aeff5c30ad9e5624ccb556a87">public_key</a>, path-&gt;<a class="code" href="../../df/d31/struct_onion___path.html#a4725b29fc0349714fa0ab0938844cf19">node_public_key3</a>, crypto_box_PUBLICKEYBYTES);</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;}</div>
<div class="ttc" id="namespacemake-funny-savefile_html_a6734667aeff5c30ad9e5624ccb556a87"><div class="ttname"><a href="../../df/db5/namespacemake-funny-savefile.html#a6734667aeff5c30ad9e5624ccb556a87">make-funny-savefile.public_key</a></div><div class="ttdeci">list public_key</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d01/make-funny-savefile_8py_source.html#l00068">make-funny-savefile.py:68</a></div></div>
<div class="ttc" id="struct_onion___path_html_a38f4e3f7780648cf74f808d7942113d8"><div class="ttname"><a href="../../df/d31/struct_onion___path.html#a38f4e3f7780648cf74f808d7942113d8">Onion_Path::node_public_key1</a></div><div class="ttdeci">uint8_t node_public_key1[crypto_box_PUBLICKEYBYTES]</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db9/onion_8h_source.html#l00068">onion.h:68</a></div></div>
<div class="ttc" id="struct_onion___path_html_ad7670c0a1a9d05b2a807a9c1a7950b79"><div class="ttname"><a href="../../df/d31/struct_onion___path.html#ad7670c0a1a9d05b2a807a9c1a7950b79">Onion_Path::ip_port1</a></div><div class="ttdeci">IP_Port ip_port1</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db9/onion_8h_source.html#l00067">onion.h:67</a></div></div>
<div class="ttc" id="struct_onion___path_html_a4725b29fc0349714fa0ab0938844cf19"><div class="ttname"><a href="../../df/d31/struct_onion___path.html#a4725b29fc0349714fa0ab0938844cf19">Onion_Path::node_public_key3</a></div><div class="ttdeci">uint8_t node_public_key3[crypto_box_PUBLICKEYBYTES]</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db9/onion_8h_source.html#l00074">onion.h:74</a></div></div>
<div class="ttc" id="struct_node__format_html_a86e2a5a56c0dd22df6e8b8a10e40f9e4"><div class="ttname"><a href="../../d3/d53/struct_node__format.html#a86e2a5a56c0dd22df6e8b8a10e40f9e4">Node_format::ip_port</a></div><div class="ttdeci">IP_Port ip_port</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dad/_d_h_t_8h_source.html#l00149">DHT.h:149</a></div></div>
<div class="ttc" id="onion_8h_html_abe0dd1f2cbadfda52425e7c2fed7d8c3"><div class="ttname"><a href="../../d3/db9/onion_8h.html#abe0dd1f2cbadfda52425e7c2fed7d8c3">ONION_PATH_LENGTH</a></div><div class="ttdeci">#define ONION_PATH_LENGTH</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db9/onion_8h_source.html#l00056">onion.h:56</a></div></div>
<div class="ttc" id="struct_onion___path_html_adcf789584e4efc296bc6f915d3e2e9f9"><div class="ttname"><a href="../../df/d31/struct_onion___path.html#adcf789584e4efc296bc6f915d3e2e9f9">Onion_Path::ip_port2</a></div><div class="ttdeci">IP_Port ip_port2</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db9/onion_8h_source.html#l00070">onion.h:70</a></div></div>
<div class="ttc" id="struct_onion___path_html_adc5a9730c2f43085e83ece3257af154a"><div class="ttname"><a href="../../df/d31/struct_onion___path.html#adc5a9730c2f43085e83ece3257af154a">Onion_Path::node_public_key2</a></div><div class="ttdeci">uint8_t node_public_key2[crypto_box_PUBLICKEYBYTES]</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db9/onion_8h_source.html#l00071">onion.h:71</a></div></div>
<div class="ttc" id="struct_onion___path_html_aef20a4d17084ae724f2e496f8f7a106a"><div class="ttname"><a href="../../df/d31/struct_onion___path.html#aef20a4d17084ae724f2e496f8f7a106a">Onion_Path::ip_port3</a></div><div class="ttdeci">IP_Port ip_port3</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db9/onion_8h_source.html#l00073">onion.h:73</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d3/db9/onion_8h_a0037270c6e9bca59c4e0cd118ebfa593_icgraph.png" border="0" usemap="#d3/db9/onion_8h_a0037270c6e9bca59c4e0cd118ebfa593_icgraph" alt=""/></div>
<map name="d3/db9/onion_8h_a0037270c6e9bca59c4e0cd118ebfa593_icgraph" id="d3/db9/onion_8h_a0037270c6e9bca59c4e0cd118ebfa593_icgraph">
<area shape="rect" id="node2" href="../../db/d79/onion__client_8c.html#a79b0950c5eea44ddc315ef8a9b2e47f1" title="set_path_timeouts" alt="" coords="199,31,328,57"/><area shape="rect" id="node3" href="../../db/d79/onion__client_8c.html#a4f1e9a581f96d31f2f822ca6be9cc0eb" title="client_add_to_list" alt="" coords="376,31,499,57"/><area shape="rect" id="node4" href="../../db/d79/onion__client_8c.html#acef82e3853e62dce8cd45450ff028f97" title="handle_announce_response" alt="" coords="547,31,729,57"/><area shape="rect" id="node5" href="../../db/d79/onion__client_8c.html#a3519dd95525df398b46b0e4a928f54f0" title="handle_tcp_onion" alt="" coords="777,5,900,32"/><area shape="rect" id="node6" href="../../d9/d26/onion__client_8h.html#a9a6ae3a9c70a5221a65bd1c9be751a2e" title="new_onion_client" alt="" coords="948,31,1071,57"/><area shape="rect" id="node7" href="../../d7/dd9/onion__test_8c.html#a5945771cafdfe39074adf8ddd47ae81b" title="new_onions" alt="" coords="1132,5,1223,32"/><area shape="rect" id="node9" href="../../d4/d30/_messenger_8h.html#af015ea2e74c58196e0564719a6c6a112" title="new_messenger" alt="" coords="1119,56,1236,83"/><area shape="rect" id="node8" href="../../d7/dd9/onion__test_8c.html#a1bd0e98b361db6749c50308a7555a192" title="START_TEST" alt="" coords="1284,5,1391,32"/><area shape="rect" id="node10" href="../../d8/dda/messenger__test_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="1312,56,1363,83"/><area shape="rect" id="node11" href="../../da/d8f/tox_8h.html#aa0e6afccd06a766b84a0633e259f9165" title="Creates and initialises a new Tox instance with the options passed. " alt="" coords="1302,107,1373,133"/><area shape="rect" id="node12" href="../../d0/de9/encryptsave__test_8c.html#abfc6ca1e662bc2b41efecb0b9e35cc9d" title="START_TEST" alt="" coords="1439,31,1545,57"/><area shape="rect" id="node13" href="../../db/d11/irc__syncbot_8c.html#a7a3ec256dab5cbac9fc01ff328980da7" title="init_tox" alt="" coords="1460,81,1524,108"/><area shape="rect" id="node15" href="../../d2/d65/n_tox_8c.html#ac47fc78dd12365ddfd46c70003627250" title="load_data" alt="" coords="1453,132,1531,159"/><area shape="rect" id="node17" href="../../d7/db1/tox__shell_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="1467,183,1517,209"/><area shape="rect" id="node14" href="../../db/d11/irc__syncbot_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="1593,81,1644,108"/><area shape="rect" id="node16" href="../../d2/d65/n_tox_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="1593,132,1644,159"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a112ff3dd6d8a1e104516eb4b465fc2fa"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int onion_send_1 </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d3/d01/struct_onion.html">Onion</a> *&#160;</td>
          <td class="paramname"><em>onion</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>plain</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../db/d14/struct_i_p___port.html">IP_Port</a>&#160;</td>
          <td class="paramname"><em>source</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>nonce</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d4/d18/onion_8c_source.html#l00333">333</a> of file <a class="el" href="../../d4/d18/onion_8c_source.html">onion.c</a>.</p>

<p>References <a class="el" href="../../d2/d01/make-funny-savefile_8py_source.html#l00098">make-funny-savefile::data</a>, <a class="el" href="../../dc/d85/crypto__core_8c_source.html#l00084">encrypt_data_symmetric()</a>, <a class="el" href="../../d4/d18/onion_8c_source.html#l00085">ipport_pack()</a>, <a class="el" href="../../d4/d18/onion_8c_source.html#l00092">ipport_unpack()</a>, <a class="el" href="../../d3/db9/onion_8h_source.html#l00030">Onion::net</a>, <a class="el" href="../../d9/d94/network_8h_source.html#l00110">NET_PACKET_ONION_SEND_1</a>, <a class="el" href="../../dc/d85/crypto__core_8c_source.html#l00188">new_nonce()</a>, <a class="el" href="../../d3/db9/onion_8h_source.html#l00042">ONION_MAX_PACKET_SIZE</a>, <a class="el" href="../../d3/db9/onion_8h_source.html#l00044">ONION_RETURN_1</a>, <a class="el" href="../../d3/db9/onion_8h_source.html#l00031">Onion::secret_symmetric_key</a>, <a class="el" href="../../d4/d18/onion_8c_source.html#l00033">SEND_BASE</a>, <a class="el" href="../../d6/d6e/network_8c_source.html#l00295">sendpacket()</a>, and <a class="el" href="../../d9/d94/network_8h_source.html#l00175">SIZE_IPPORT</a>.</p>

<p>Referenced by <a class="el" href="../../d4/d18/onion_8c_source.html#l00309">handle_send_initial()</a>, and <a class="el" href="../../d4/d40/_t_c_p__server_8c_source.html#l00740">handle_TCP_packet()</a>.</p>
<div class="fragment"><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;{</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    <span class="keywordflow">if</span> (len &gt; <a class="code" href="../../d3/db9/onion_8h.html#a48fdc4b34dbecf0a3417a557b83a4ff4">ONION_MAX_PACKET_SIZE</a> + <a class="code" href="../../d9/d94/network_8h.html#a42c0a5872a869ac0cfd8200935ed49ee">SIZE_IPPORT</a> - (1 + crypto_box_NONCEBYTES + <a class="code" href="../../d3/db9/onion_8h.html#a45874dbad3133dc676900407c0672660">ONION_RETURN_1</a>))</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;        <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <span class="keywordflow">if</span> (len &lt;= <a class="code" href="../../d9/d94/network_8h.html#a42c0a5872a869ac0cfd8200935ed49ee">SIZE_IPPORT</a> + <a class="code" href="../../d4/d18/onion_8c.html#ad40bb79953288e33ace996a24cc7c86f">SEND_BASE</a> * 2)</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;        <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    <a class="code" href="../../db/d14/struct_i_p___port.html">IP_Port</a> send_to;</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d4/d18/onion_8c.html#a5134cc15375a918b584e3c408e038331">ipport_unpack</a>(&amp;send_to, plain, len, 0) == -1)</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;        <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    uint8_t ip_port[<a class="code" href="../../d9/d94/network_8h.html#a42c0a5872a869ac0cfd8200935ed49ee">SIZE_IPPORT</a>];</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    <a class="code" href="../../d4/d18/onion_8c.html#ae9d8dde9317c06fe493658b8145de853">ipport_pack</a>(ip_port, &amp;source);</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    uint8_t <a class="code" href="../../df/db5/namespacemake-funny-savefile.html#aa7a0efb8690a34f61a95b00cc723ca27">data</a>[<a class="code" href="../../d3/db9/onion_8h.html#a48fdc4b34dbecf0a3417a557b83a4ff4">ONION_MAX_PACKET_SIZE</a>];</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;    data[0] = <a class="code" href="../../d9/d94/network_8h.html#af35e3289fe8c4324b7a07655952f5eab">NET_PACKET_ONION_SEND_1</a>;</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    memcpy(data + 1, <a class="code" href="../../d5/d29/crypto__test_8c.html#a7932c523f7065073a396e571319201ce">nonce</a>, crypto_box_NONCEBYTES);</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    memcpy(data + 1 + crypto_box_NONCEBYTES, plain + <a class="code" href="../../d9/d94/network_8h.html#a42c0a5872a869ac0cfd8200935ed49ee">SIZE_IPPORT</a>, len - <a class="code" href="../../d9/d94/network_8h.html#a42c0a5872a869ac0cfd8200935ed49ee">SIZE_IPPORT</a>);</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    uint16_t data_len = 1 + crypto_box_NONCEBYTES + (len - <a class="code" href="../../d9/d94/network_8h.html#a42c0a5872a869ac0cfd8200935ed49ee">SIZE_IPPORT</a>);</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    uint8_t *ret_part = data + data_len;</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    <a class="code" href="../../dc/d85/crypto__core_8c.html#a8b1033efb47c625779d11be7d8eb9e24">new_nonce</a>(ret_part);</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    len = <a class="code" href="../../dc/d85/crypto__core_8c.html#a81efc0a4a6e0efe372651e26e342a6e5">encrypt_data_symmetric</a>(onion-&gt;<a class="code" href="../../d3/d01/struct_onion.html#ab9f2ff47bc0b1e5110202a6e4be86390">secret_symmetric_key</a>, ret_part, ip_port, <a class="code" href="../../d9/d94/network_8h.html#a42c0a5872a869ac0cfd8200935ed49ee">SIZE_IPPORT</a>,</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;                                 ret_part + crypto_box_NONCEBYTES);</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    <span class="keywordflow">if</span> (len != <a class="code" href="../../d9/d94/network_8h.html#a42c0a5872a869ac0cfd8200935ed49ee">SIZE_IPPORT</a> + crypto_box_MACBYTES)</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;        <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    data_len += crypto_box_NONCEBYTES + len;</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <span class="keywordflow">if</span> ((uint32_t)<a class="code" href="../../d6/d6e/network_8c.html#a7b90f87f3ba60cc5c66dd6dd77cd5cb1">sendpacket</a>(onion-&gt;<a class="code" href="../../d3/d01/struct_onion.html#aa14ea2f67950f57fe4235d7375a2216c">net</a>, send_to, data, data_len) != data_len)</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;        <span class="keywordflow">return</span> 1;</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;}</div>
<div class="ttc" id="onion_8c_html_a5134cc15375a918b584e3c408e038331"><div class="ttname"><a href="../../d4/d18/onion_8c.html#a5134cc15375a918b584e3c408e038331">ipport_unpack</a></div><div class="ttdeci">static int ipport_unpack(IP_Port *target, const uint8_t *data, unsigned int data_size, _Bool disable_family_check)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d18/onion_8c_source.html#l00092">onion.c:92</a></div></div>
<div class="ttc" id="crypto__core_8c_html_a81efc0a4a6e0efe372651e26e342a6e5"><div class="ttname"><a href="../../dc/d85/crypto__core_8c.html#a81efc0a4a6e0efe372651e26e342a6e5">encrypt_data_symmetric</a></div><div class="ttdeci">int encrypt_data_symmetric(const uint8_t *secret_key, const uint8_t *nonce, const uint8_t *plain, uint32_t length, uint8_t *encrypted)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d85/crypto__core_8c_source.html#l00084">crypto_core.c:84</a></div></div>
<div class="ttc" id="network_8h_html_a42c0a5872a869ac0cfd8200935ed49ee"><div class="ttname"><a href="../../d9/d94/network_8h.html#a42c0a5872a869ac0cfd8200935ed49ee">SIZE_IPPORT</a></div><div class="ttdeci">#define SIZE_IPPORT</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d94/network_8h_source.html#l00175">network.h:175</a></div></div>
<div class="ttc" id="onion_8c_html_ad40bb79953288e33ace996a24cc7c86f"><div class="ttname"><a href="../../d4/d18/onion_8c.html#ad40bb79953288e33ace996a24cc7c86f">SEND_BASE</a></div><div class="ttdeci">#define SEND_BASE</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d18/onion_8c_source.html#l00033">onion.c:33</a></div></div>
<div class="ttc" id="struct_i_p___port_html"><div class="ttname"><a href="../../db/d14/struct_i_p___port.html">IP_Port</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d94/network_8h_source.html#l00162">network.h:162</a></div></div>
<div class="ttc" id="namespacemake-funny-savefile_html_aa7a0efb8690a34f61a95b00cc723ca27"><div class="ttname"><a href="../../df/db5/namespacemake-funny-savefile.html#aa7a0efb8690a34f61a95b00cc723ca27">make-funny-savefile.data</a></div><div class="ttdeci">tuple data</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d01/make-funny-savefile_8py_source.html#l00098">make-funny-savefile.py:98</a></div></div>
<div class="ttc" id="struct_onion_html_aa14ea2f67950f57fe4235d7375a2216c"><div class="ttname"><a href="../../d3/d01/struct_onion.html#aa14ea2f67950f57fe4235d7375a2216c">Onion::net</a></div><div class="ttdeci">Networking_Core * net</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db9/onion_8h_source.html#l00030">onion.h:30</a></div></div>
<div class="ttc" id="struct_onion_html_ab9f2ff47bc0b1e5110202a6e4be86390"><div class="ttname"><a href="../../d3/d01/struct_onion.html#ab9f2ff47bc0b1e5110202a6e4be86390">Onion::secret_symmetric_key</a></div><div class="ttdeci">uint8_t secret_symmetric_key[crypto_box_KEYBYTES]</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db9/onion_8h_source.html#l00031">onion.h:31</a></div></div>
<div class="ttc" id="crypto__test_8c_html_a7932c523f7065073a396e571319201ce"><div class="ttname"><a href="../../d5/d29/crypto__test_8c.html#a7932c523f7065073a396e571319201ce">nonce</a></div><div class="ttdeci">unsigned char nonce[24]</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d29/crypto__test_8c_source.html#l00040">crypto_test.c:40</a></div></div>
<div class="ttc" id="network_8h_html_af35e3289fe8c4324b7a07655952f5eab"><div class="ttname"><a href="../../d9/d94/network_8h.html#af35e3289fe8c4324b7a07655952f5eab">NET_PACKET_ONION_SEND_1</a></div><div class="ttdeci">#define NET_PACKET_ONION_SEND_1</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d94/network_8h_source.html#l00110">network.h:110</a></div></div>
<div class="ttc" id="onion_8h_html_a45874dbad3133dc676900407c0672660"><div class="ttname"><a href="../../d3/db9/onion_8h.html#a45874dbad3133dc676900407c0672660">ONION_RETURN_1</a></div><div class="ttdeci">#define ONION_RETURN_1</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db9/onion_8h_source.html#l00044">onion.h:44</a></div></div>
<div class="ttc" id="network_8c_html_a7b90f87f3ba60cc5c66dd6dd77cd5cb1"><div class="ttname"><a href="../../d6/d6e/network_8c.html#a7b90f87f3ba60cc5c66dd6dd77cd5cb1">sendpacket</a></div><div class="ttdeci">int sendpacket(Networking_Core *net, IP_Port ip_port, const uint8_t *data, uint16_t length)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d6e/network_8c_source.html#l00295">network.c:295</a></div></div>
<div class="ttc" id="onion_8c_html_ae9d8dde9317c06fe493658b8145de853"><div class="ttname"><a href="../../d4/d18/onion_8c.html#ae9d8dde9317c06fe493658b8145de853">ipport_pack</a></div><div class="ttdeci">static void ipport_pack(uint8_t *data, const IP_Port *source)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d18/onion_8c_source.html#l00085">onion.c:85</a></div></div>
<div class="ttc" id="crypto__core_8c_html_a8b1033efb47c625779d11be7d8eb9e24"><div class="ttname"><a href="../../dc/d85/crypto__core_8c.html#a8b1033efb47c625779d11be7d8eb9e24">new_nonce</a></div><div class="ttdeci">void new_nonce(uint8_t *nonce)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d85/crypto__core_8c_source.html#l00188">crypto_core.c:188</a></div></div>
<div class="ttc" id="onion_8h_html_a48fdc4b34dbecf0a3417a557b83a4ff4"><div class="ttname"><a href="../../d3/db9/onion_8h.html#a48fdc4b34dbecf0a3417a557b83a4ff4">ONION_MAX_PACKET_SIZE</a></div><div class="ttdeci">#define ONION_MAX_PACKET_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db9/onion_8h_source.html#l00042">onion.h:42</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d3/db9/onion_8h_a112ff3dd6d8a1e104516eb4b465fc2fa_cgraph.png" border="0" usemap="#d3/db9/onion_8h_a112ff3dd6d8a1e104516eb4b465fc2fa_cgraph" alt=""/></div>
<map name="d3/db9/onion_8h_a112ff3dd6d8a1e104516eb4b465fc2fa_cgraph" id="d3/db9/onion_8h_a112ff3dd6d8a1e104516eb4b465fc2fa_cgraph">
<area shape="rect" id="node2" href="../../dc/d85/crypto__core_8c.html#a81efc0a4a6e0efe372651e26e342a6e5" title="encrypt_data_symmetric" alt="" coords="156,5,321,32"/><area shape="rect" id="node3" href="../../d4/d18/onion_8c.html#ae9d8dde9317c06fe493658b8145de853" title="ipport_pack" alt="" coords="194,56,283,83"/><area shape="rect" id="node6" href="../../d4/d18/onion_8c.html#a5134cc15375a918b584e3c408e038331" title="ipport_unpack" alt="" coords="187,107,290,133"/><area shape="rect" id="node9" href="../../dc/d85/crypto__core_8c.html#a8b1033efb47c625779d11be7d8eb9e24" title="new_nonce" alt="" coords="195,157,283,184"/><area shape="rect" id="node11" href="../../d6/d6e/network_8c.html#a7b90f87f3ba60cc5c66dd6dd77cd5cb1" title="sendpacket" alt="" coords="194,208,283,235"/><area shape="rect" id="node4" href="../../d4/d18/onion_8c.html#a6b9b6abcbb6fde502e7822236a978118" title="ip_pack" alt="" coords="389,56,456,83"/><area shape="rect" id="node5" href="../../dc/dc1/_d_h_t_8c.html#ae7f65a76f9c4b0093f45fc1777238459" title="to_net_family" alt="" coords="527,56,627,83"/><area shape="rect" id="node7" href="../../d4/d18/onion_8c.html#a0687fad9fd17ea53d6b84a6cfc7e0d78" title="ip_unpack" alt="" coords="382,107,463,133"/><area shape="rect" id="node8" href="../../dc/dc1/_d_h_t_8c.html#a74120ec4fc551572bff2a08436854c97" title="to_host_family" alt="" coords="524,107,631,133"/><area shape="rect" id="node10" href="../../dc/d85/crypto__core_8c.html#a15ef255ab026d4881a16b99148b05dd7" title="random_nonce" alt="" coords="369,157,476,184"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d3/db9/onion_8h_a112ff3dd6d8a1e104516eb4b465fc2fa_icgraph.png" border="0" usemap="#d3/db9/onion_8h_a112ff3dd6d8a1e104516eb4b465fc2fa_icgraph" alt=""/></div>
<map name="d3/db9/onion_8h_a112ff3dd6d8a1e104516eb4b465fc2fa_icgraph" id="d3/db9/onion_8h_a112ff3dd6d8a1e104516eb4b465fc2fa_icgraph">
<area shape="rect" id="node2" href="../../d4/d18/onion_8c.html#ad1a4dfd05094ff479cda552ed94059f7" title="handle_send_initial" alt="" coords="160,136,292,162"/><area shape="rect" id="node17" href="../../d4/d40/_t_c_p__server_8c.html#a904af6fcbd24cb3f75c4a04470be46de" title="handle_TCP_packet" alt="" coords="156,186,296,213"/><area shape="rect" id="node3" href="../../d3/db9/onion_8h.html#a71877ec5931feec418ed1ae10b0963d8" title="new_onion" alt="" coords="776,136,860,162"/><area shape="rect" id="node4" href="../../d1/d36/tox-bootstrapd_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="1134,186,1185,213"/><area shape="rect" id="node5" href="../../d4/d30/_messenger_8h.html#af015ea2e74c58196e0564719a6c6a112" title="new_messenger" alt="" coords="940,85,1057,112"/><area shape="rect" id="node14" href="../../d7/dd9/onion__test_8c.html#a5945771cafdfe39074adf8ddd47ae81b" title="new_onions" alt="" coords="953,136,1044,162"/><area shape="rect" id="node16" href="../../d7/dd9/onion__test_8c.html#ad7475d1539db4bb3bcf8673dd7f7cf68" title="START_TEST" alt="" coords="945,34,1052,61"/><area shape="rect" id="node6" href="../../d8/dda/messenger__test_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="1134,85,1185,112"/><area shape="rect" id="node7" href="../../da/d8f/tox_8h.html#aa0e6afccd06a766b84a0633e259f9165" title="Creates and initialises a new Tox instance with the options passed. " alt="" coords="1124,34,1195,61"/><area shape="rect" id="node8" href="../../d0/de9/encryptsave__test_8c.html#abfc6ca1e662bc2b41efecb0b9e35cc9d" title="START_TEST" alt="" coords="1261,73,1368,100"/><area shape="rect" id="node9" href="../../db/d11/irc__syncbot_8c.html#a7a3ec256dab5cbac9fc01ff328980da7" title="init_tox" alt="" coords="1283,124,1347,150"/><area shape="rect" id="node11" href="../../d2/d65/n_tox_8c.html#ac47fc78dd12365ddfd46c70003627250" title="load_data" alt="" coords="1430,10,1509,37"/><area shape="rect" id="node13" href="../../d7/db1/tox__shell_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="1289,22,1340,49"/><area shape="rect" id="node10" href="../../db/d11/irc__syncbot_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="1444,112,1495,138"/><area shape="rect" id="node12" href="../../d2/d65/n_tox_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="1571,86,1621,113"/><area shape="rect" id="node15" href="../../d7/dd9/onion__test_8c.html#a1bd0e98b361db6749c50308a7555a192" title="START_TEST" alt="" coords="1106,136,1213,162"/><area shape="rect" id="node18" href="../../d4/d40/_t_c_p__server_8c.html#a00813f259948ef060f6ab7ec40da2f2c" title="confirm_TCP_connection" alt="" coords="344,186,513,213"/><area shape="rect" id="node31" href="../../d4/d40/_t_c_p__server_8c.html#ab84742dd52ed6c8e83287ea5202e4326" title="do_confirmed_recv" alt="" coords="363,237,495,264"/><area shape="rect" id="node19" href="../../d4/d40/_t_c_p__server_8c.html#a8cdae1ef768b85b02dcc79ff2258606f" title="do_unconfirmed" alt="" coords="571,186,686,213"/><area shape="rect" id="node20" href="../../d4/d40/_t_c_p__server_8c.html#aed90b296bcb98bcb905565ae68548c9a" title="do_TCP_unconfirmed" alt="" coords="744,186,892,213"/><area shape="rect" id="node21" href="../../d6/d03/_t_c_p__server_8h.html#a40e8a0302a359dd4f712eb1e9c346fe5" title="do_TCP_server" alt="" coords="942,237,1055,264"/><area shape="rect" id="node22" href="../../d2/d8d/_t_c_p__test_8c.html#ad7475d1539db4bb3bcf8673dd7f7cf68" title="START_TEST" alt="" coords="1106,288,1213,314"/><area shape="rect" id="node23" href="../../d2/d8d/_t_c_p__test_8c.html#a8958ca530ce6534e81eaa06e582a26ad" title="new_TCP_con" alt="" coords="1105,338,1213,365"/><area shape="rect" id="node25" href="../../d4/d30/_messenger_8h.html#ae0686caa878183a98920aeb7486afcb6" title="do_messenger" alt="" coords="1106,237,1213,264"/><area shape="rect" id="node24" href="../../d2/d8d/_t_c_p__test_8c.html#a0ee98d716eb7311dd4b6d217289734ff" title="START_TEST" alt="" coords="1261,338,1368,365"/><area shape="rect" id="node26" href="../../db/de9/_messenger__test_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="1289,250,1340,277"/><area shape="rect" id="node27" href="../../da/d8f/tox_8h.html#a649c8740c523fb52272396cb0b70b8dc" title="tox_iterate" alt="" coords="1273,200,1356,226"/><area shape="rect" id="node28" href="../../d9/d35/tox__test_8c.html#a4c612d3a3f15c8fbf2e4bde8002bc33b" title="START_TEST" alt="" coords="1416,264,1523,290"/><area shape="rect" id="node29" href="../../d6/dc0/toxav__many__test_8c.html#a8fdafe3be7e00ce3d4f0cb50a9a5eb39" title="while" alt="" coords="1443,213,1495,240"/><area shape="rect" id="node30" href="../../d2/d65/n_tox_8c.html#a1e3c1630c0ca8b687a6a878aa27dd69c" title="line_eval" alt="" coords="1433,162,1506,189"/><area shape="rect" id="node32" href="../../d4/d40/_t_c_p__server_8c.html#a001f38d27860442b6fe9fe7dd030a7a0" title="do_TCP_confirmed" alt="" coords="561,237,696,264"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="af06edfff31b42d31803e24fc7f47d365"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int send_onion_packet </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d3/d0b/struct_networking___core.html">Networking_Core</a> *&#160;</td>
          <td class="paramname"><em>net</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../df/d31/struct_onion___path.html">Onion_Path</a> *&#160;</td>
          <td class="paramname"><em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../db/d14/struct_i_p___port.html">IP_Port</a>&#160;</td>
          <td class="paramname"><em>dest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>length</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d4/d18/onion_8c_source.html#l00273">273</a> of file <a class="el" href="../../d4/d18/onion_8c_source.html">onion.c</a>.</p>

<p>References <a class="el" href="../../d4/d18/onion_8c_source.html#l00173">create_onion_packet()</a>, <a class="el" href="../../d3/db9/onion_8h_source.html#l00067">Onion_Path::ip_port1</a>, <a class="el" href="../../d3/db9/onion_8h_source.html#l00042">ONION_MAX_PACKET_SIZE</a>, and <a class="el" href="../../d6/d6e/network_8c_source.html#l00295">sendpacket()</a>.</p>

<p>Referenced by <a class="el" href="../../d7/dd9/onion__test_8c_source.html#l00129">START_TEST()</a>.</p>
<div class="fragment"><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;{</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    uint8_t packet[<a class="code" href="../../d3/db9/onion_8h.html#a48fdc4b34dbecf0a3417a557b83a4ff4">ONION_MAX_PACKET_SIZE</a>];</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    <span class="keywordtype">int</span> len = <a class="code" href="../../d4/d18/onion_8c.html#a34cf7934690ab5336b99844383a445a8">create_onion_packet</a>(packet, <span class="keyword">sizeof</span>(packet), path, dest, <a class="code" href="../../df/db5/namespacemake-funny-savefile.html#aa7a0efb8690a34f61a95b00cc723ca27">data</a>, length);</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    <span class="keywordflow">if</span> (len == -1)</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d6/d6e/network_8c.html#a7b90f87f3ba60cc5c66dd6dd77cd5cb1">sendpacket</a>(net, path-&gt;<a class="code" href="../../df/d31/struct_onion___path.html#ad7670c0a1a9d05b2a807a9c1a7950b79">ip_port1</a>, packet, len) != len)</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;}</div>
<div class="ttc" id="struct_onion___path_html_ad7670c0a1a9d05b2a807a9c1a7950b79"><div class="ttname"><a href="../../df/d31/struct_onion___path.html#ad7670c0a1a9d05b2a807a9c1a7950b79">Onion_Path::ip_port1</a></div><div class="ttdeci">IP_Port ip_port1</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db9/onion_8h_source.html#l00067">onion.h:67</a></div></div>
<div class="ttc" id="namespacemake-funny-savefile_html_aa7a0efb8690a34f61a95b00cc723ca27"><div class="ttname"><a href="../../df/db5/namespacemake-funny-savefile.html#aa7a0efb8690a34f61a95b00cc723ca27">make-funny-savefile.data</a></div><div class="ttdeci">tuple data</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d01/make-funny-savefile_8py_source.html#l00098">make-funny-savefile.py:98</a></div></div>
<div class="ttc" id="onion_8c_html_a34cf7934690ab5336b99844383a445a8"><div class="ttname"><a href="../../d4/d18/onion_8c.html#a34cf7934690ab5336b99844383a445a8">create_onion_packet</a></div><div class="ttdeci">int create_onion_packet(uint8_t *packet, uint16_t max_packet_length, const Onion_Path *path, IP_Port dest, const uint8_t *data, uint16_t length)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d18/onion_8c_source.html#l00173">onion.c:173</a></div></div>
<div class="ttc" id="network_8c_html_a7b90f87f3ba60cc5c66dd6dd77cd5cb1"><div class="ttname"><a href="../../d6/d6e/network_8c.html#a7b90f87f3ba60cc5c66dd6dd77cd5cb1">sendpacket</a></div><div class="ttdeci">int sendpacket(Networking_Core *net, IP_Port ip_port, const uint8_t *data, uint16_t length)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d6e/network_8c_source.html#l00295">network.c:295</a></div></div>
<div class="ttc" id="onion_8h_html_a48fdc4b34dbecf0a3417a557b83a4ff4"><div class="ttname"><a href="../../d3/db9/onion_8h.html#a48fdc4b34dbecf0a3417a557b83a4ff4">ONION_MAX_PACKET_SIZE</a></div><div class="ttdeci">#define ONION_MAX_PACKET_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db9/onion_8h_source.html#l00042">onion.h:42</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d3/db9/onion_8h_af06edfff31b42d31803e24fc7f47d365_cgraph.png" border="0" usemap="#d3/db9/onion_8h_af06edfff31b42d31803e24fc7f47d365_cgraph" alt=""/></div>
<map name="d3/db9/onion_8h_af06edfff31b42d31803e24fc7f47d365_cgraph" id="d3/db9/onion_8h_af06edfff31b42d31803e24fc7f47d365_cgraph">
<area shape="rect" id="node2" href="../../d4/d18/onion_8c.html#a34cf7934690ab5336b99844383a445a8" title="create_onion_packet" alt="" coords="188,56,331,83"/><area shape="rect" id="node8" href="../../d6/d6e/network_8c.html#a7b90f87f3ba60cc5c66dd6dd77cd5cb1" title="sendpacket" alt="" coords="215,107,304,133"/><area shape="rect" id="node3" href="../../dc/d85/crypto__core_8c.html#a81efc0a4a6e0efe372651e26e342a6e5" title="encrypt_data_symmetric" alt="" coords="379,5,544,32"/><area shape="rect" id="node4" href="../../d4/d18/onion_8c.html#ae9d8dde9317c06fe493658b8145de853" title="ipport_pack" alt="" coords="417,56,506,83"/><area shape="rect" id="node7" href="../../dc/d85/crypto__core_8c.html#a15ef255ab026d4881a16b99148b05dd7" title="random_nonce" alt="" coords="408,107,515,133"/><area shape="rect" id="node5" href="../../d4/d18/onion_8c.html#a6b9b6abcbb6fde502e7822236a978118" title="ip_pack" alt="" coords="592,56,659,83"/><area shape="rect" id="node6" href="../../dc/dc1/_d_h_t_8c.html#ae7f65a76f9c4b0093f45fc1777238459" title="to_net_family" alt="" coords="707,56,807,83"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d3/db9/onion_8h_af06edfff31b42d31803e24fc7f47d365_icgraph.png" border="0" usemap="#d3/db9/onion_8h_af06edfff31b42d31803e24fc7f47d365_icgraph" alt=""/></div>
<map name="d3/db9/onion_8h_af06edfff31b42d31803e24fc7f47d365_icgraph" id="d3/db9/onion_8h_af06edfff31b42d31803e24fc7f47d365_icgraph">
<area shape="rect" id="node2" href="../../d7/dd9/onion__test_8c.html#ad7475d1539db4bb3bcf8673dd7f7cf68" title="START_TEST" alt="" coords="188,5,295,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a8d81f915fcff64bfe2508296d325f7d4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int send_onion_response </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d3/d0b/struct_networking___core.html">Networking_Core</a> *&#160;</td>
          <td class="paramname"><em>net</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../db/d14/struct_i_p___port.html">IP_Port</a>&#160;</td>
          <td class="paramname"><em>dest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>length</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>ret</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d4/d18/onion_8c_source.html#l00293">293</a> of file <a class="el" href="../../d4/d18/onion_8c_source.html">onion.c</a>.</p>

<p>References <a class="el" href="../../d9/d94/network_8h_source.html#l00118">NET_PACKET_ONION_RECV_3</a>, <a class="el" href="../../d3/db9/onion_8h_source.html#l00054">ONION_RESPONSE_MAX_DATA_SIZE</a>, <a class="el" href="../../d4/d18/onion_8c_source.html#l00031">RETURN_3</a>, and <a class="el" href="../../d6/d6e/network_8c_source.html#l00295">sendpacket()</a>.</p>

<p>Referenced by <a class="el" href="../../df/d75/onion__announce_8c_source.html#l00289">handle_announce_request()</a>, <a class="el" href="../../df/d75/onion__announce_8c_source.html#l00382">handle_data_request()</a>, and <a class="el" href="../../d7/dd9/onion__test_8c_source.html#l00033">handle_test_1()</a>.</p>
<div class="fragment"><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;{</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    <span class="keywordflow">if</span> (length &gt; <a class="code" href="../../d3/db9/onion_8h.html#aea8fcee93c08e278868fb377062789e9">ONION_RESPONSE_MAX_DATA_SIZE</a> || length == 0)</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    uint8_t packet[1 + <a class="code" href="../../d4/d18/onion_8c.html#a06d1047d4f4a1f8a3d2239594e2da9fc">RETURN_3</a> + length];</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    packet[0] = <a class="code" href="../../d9/d94/network_8h.html#a7ef70febad8b27e23b73db25d78cd666">NET_PACKET_ONION_RECV_3</a>;</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    memcpy(packet + 1, ret, <a class="code" href="../../d4/d18/onion_8c.html#a06d1047d4f4a1f8a3d2239594e2da9fc">RETURN_3</a>);</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    memcpy(packet + 1 + <a class="code" href="../../d4/d18/onion_8c.html#a06d1047d4f4a1f8a3d2239594e2da9fc">RETURN_3</a>, <a class="code" href="../../df/db5/namespacemake-funny-savefile.html#aa7a0efb8690a34f61a95b00cc723ca27">data</a>, length);</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <span class="keywordflow">if</span> ((uint32_t)<a class="code" href="../../d6/d6e/network_8c.html#a7b90f87f3ba60cc5c66dd6dd77cd5cb1">sendpacket</a>(net, dest, packet, <span class="keyword">sizeof</span>(packet)) != <span class="keyword">sizeof</span>(packet))</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;}</div>
<div class="ttc" id="network_8h_html_a7ef70febad8b27e23b73db25d78cd666"><div class="ttname"><a href="../../d9/d94/network_8h.html#a7ef70febad8b27e23b73db25d78cd666">NET_PACKET_ONION_RECV_3</a></div><div class="ttdeci">#define NET_PACKET_ONION_RECV_3</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d94/network_8h_source.html#l00118">network.h:118</a></div></div>
<div class="ttc" id="namespacemake-funny-savefile_html_aa7a0efb8690a34f61a95b00cc723ca27"><div class="ttname"><a href="../../df/db5/namespacemake-funny-savefile.html#aa7a0efb8690a34f61a95b00cc723ca27">make-funny-savefile.data</a></div><div class="ttdeci">tuple data</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d01/make-funny-savefile_8py_source.html#l00098">make-funny-savefile.py:98</a></div></div>
<div class="ttc" id="onion_8c_html_a06d1047d4f4a1f8a3d2239594e2da9fc"><div class="ttname"><a href="../../d4/d18/onion_8c.html#a06d1047d4f4a1f8a3d2239594e2da9fc">RETURN_3</a></div><div class="ttdeci">#define RETURN_3</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d18/onion_8c_source.html#l00031">onion.c:31</a></div></div>
<div class="ttc" id="onion_8h_html_aea8fcee93c08e278868fb377062789e9"><div class="ttname"><a href="../../d3/db9/onion_8h.html#aea8fcee93c08e278868fb377062789e9">ONION_RESPONSE_MAX_DATA_SIZE</a></div><div class="ttdeci">#define ONION_RESPONSE_MAX_DATA_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db9/onion_8h_source.html#l00054">onion.h:54</a></div></div>
<div class="ttc" id="network_8c_html_a7b90f87f3ba60cc5c66dd6dd77cd5cb1"><div class="ttname"><a href="../../d6/d6e/network_8c.html#a7b90f87f3ba60cc5c66dd6dd77cd5cb1">sendpacket</a></div><div class="ttdeci">int sendpacket(Networking_Core *net, IP_Port ip_port, const uint8_t *data, uint16_t length)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d6e/network_8c_source.html#l00295">network.c:295</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d3/db9/onion_8h_a8d81f915fcff64bfe2508296d325f7d4_cgraph.png" border="0" usemap="#d3/db9/onion_8h_a8d81f915fcff64bfe2508296d325f7d4_cgraph" alt=""/></div>
<map name="d3/db9/onion_8h_a8d81f915fcff64bfe2508296d325f7d4_cgraph" id="d3/db9/onion_8h_a8d81f915fcff64bfe2508296d325f7d4_cgraph">
<area shape="rect" id="node2" href="../../d6/d6e/network_8c.html#a7b90f87f3ba60cc5c66dd6dd77cd5cb1" title="sendpacket" alt="" coords="201,5,291,32"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d3/db9/onion_8h_a8d81f915fcff64bfe2508296d325f7d4_icgraph.png" border="0" usemap="#d3/db9/onion_8h_a8d81f915fcff64bfe2508296d325f7d4_icgraph" alt=""/></div>
<map name="d3/db9/onion_8h_a8d81f915fcff64bfe2508296d325f7d4_icgraph" id="d3/db9/onion_8h_a8d81f915fcff64bfe2508296d325f7d4_icgraph">
<area shape="rect" id="node2" href="../../df/d75/onion__announce_8c.html#a5cc40944c42a4e0d1d3d702cf93ac8ad" title="handle_announce_request" alt="" coords="201,56,375,83"/><area shape="rect" id="node17" href="../../df/d75/onion__announce_8c.html#a938e61f5184d72e920e81cab7dc8056a" title="handle_data_request" alt="" coords="217,107,359,133"/><area shape="rect" id="node18" href="../../d7/dd9/onion__test_8c.html#a0f896edb91ee630e579972c553919398" title="handle_test_1" alt="" coords="445,5,547,32"/><area shape="rect" id="node3" href="../../d7/dfd/onion__announce_8h.html#a1807a1d99b93e29c2a27648afe3e6c2c" title="new_onion_announce" alt="" coords="423,81,569,108"/><area shape="rect" id="node4" href="../../d7/dd9/onion__test_8c.html#ad7475d1539db4bb3bcf8673dd7f7cf68" title="START_TEST" alt="" coords="623,5,729,32"/><area shape="rect" id="node5" href="../../d7/dd9/onion__test_8c.html#a5945771cafdfe39074adf8ddd47ae81b" title="new_onions" alt="" coords="631,56,721,83"/><area shape="rect" id="node7" href="../../d1/d36/tox-bootstrapd_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="651,107,701,133"/><area shape="rect" id="node8" href="../../d4/d30/_messenger_8h.html#af015ea2e74c58196e0564719a6c6a112" title="new_messenger" alt="" coords="617,157,735,184"/><area shape="rect" id="node6" href="../../d7/dd9/onion__test_8c.html#a1bd0e98b361db6749c50308a7555a192" title="START_TEST" alt="" coords="783,56,889,83"/><area shape="rect" id="node9" href="../../d8/dda/messenger__test_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="811,132,861,159"/><area shape="rect" id="node10" href="../../da/d8f/tox_8h.html#aa0e6afccd06a766b84a0633e259f9165" title="Creates and initialises a new Tox instance with the options passed. " alt="" coords="801,183,871,209"/><area shape="rect" id="node11" href="../../d0/de9/encryptsave__test_8c.html#abfc6ca1e662bc2b41efecb0b9e35cc9d" title="START_TEST" alt="" coords="937,107,1044,133"/><area shape="rect" id="node12" href="../../db/d11/irc__syncbot_8c.html#a7a3ec256dab5cbac9fc01ff328980da7" title="init_tox" alt="" coords="959,157,1023,184"/><area shape="rect" id="node14" href="../../d2/d65/n_tox_8c.html#ac47fc78dd12365ddfd46c70003627250" title="load_data" alt="" coords="951,208,1030,235"/><area shape="rect" id="node16" href="../../d7/db1/tox__shell_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="965,259,1016,285"/><area shape="rect" id="node13" href="../../db/d11/irc__syncbot_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="1092,157,1143,184"/><area shape="rect" id="node15" href="../../d2/d65/n_tox_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="1092,208,1143,235"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ae1b8e562e22bd28deca3f98dace1a421"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void set_callback_handle_recv_1 </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d3/d01/struct_onion.html">Onion</a> *&#160;</td>
          <td class="paramname"><em>onion</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int(*)(void *, <a class="el" href="../../db/d14/struct_i_p___port.html">IP_Port</a>, const uint8_t *, uint16_t)&#160;</td>
          <td class="paramname"><em>function</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>object</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../d4/d18/onion_8c_source.html#l00576">576</a> of file <a class="el" href="../../d4/d18/onion_8c_source.html">onion.c</a>.</p>

<p>References <a class="el" href="../../d3/db9/onion_8h_source.html#l00039">Onion::callback_object</a>, and <a class="el" href="../../d3/db9/onion_8h_source.html#l00038">Onion::recv_1_function</a>.</p>

<p>Referenced by <a class="el" href="../../d4/d40/_t_c_p__server_8c_source.html#l01321">kill_TCP_server()</a>, and <a class="el" href="../../d4/d40/_t_c_p__server_8c_source.html#l00942">new_TCP_server()</a>.</p>
<div class="fragment"><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;{</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    onion-&gt;<a class="code" href="../../d3/d01/struct_onion.html#a980753d0df6688333680e95f637eb7a7">recv_1_function</a> = <span class="keyword">function</span>;</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    onion-&gt;<a class="code" href="../../d3/d01/struct_onion.html#aa30dff385b8f119ddb95900b2a250a08">callback_object</a> = object;</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;}</div>
<div class="ttc" id="struct_onion_html_a980753d0df6688333680e95f637eb7a7"><div class="ttname"><a href="../../d3/d01/struct_onion.html#a980753d0df6688333680e95f637eb7a7">Onion::recv_1_function</a></div><div class="ttdeci">int(* recv_1_function)(void *, IP_Port, const uint8_t *, uint16_t)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db9/onion_8h_source.html#l00038">onion.h:38</a></div></div>
<div class="ttc" id="struct_onion_html_aa30dff385b8f119ddb95900b2a250a08"><div class="ttname"><a href="../../d3/d01/struct_onion.html#aa30dff385b8f119ddb95900b2a250a08">Onion::callback_object</a></div><div class="ttdeci">void * callback_object</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db9/onion_8h_source.html#l00039">onion.h:39</a></div></div>
</div><!-- fragment -->
<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d3/db9/onion_8h_ae1b8e562e22bd28deca3f98dace1a421_icgraph.png" border="0" usemap="#d3/db9/onion_8h_ae1b8e562e22bd28deca3f98dace1a421_icgraph" alt=""/></div>
<map name="d3/db9/onion_8h_ae1b8e562e22bd28deca3f98dace1a421_icgraph" id="d3/db9/onion_8h_ae1b8e562e22bd28deca3f98dace1a421_icgraph">
<area shape="rect" id="node2" href="../../d6/d03/_t_c_p__server_8h.html#af6df6382ad309456dcf5b7b350313714" title="kill_TCP_server" alt="" coords="197,68,312,95"/><area shape="rect" id="node14" href="../../d6/d03/_t_c_p__server_8h.html#a148e632f4c51645cbc1b414bc3584b60" title="new_TCP_server" alt="" coords="193,119,316,145"/><area shape="rect" id="node3" href="../../d2/d8d/_t_c_p__test_8c.html#ad7475d1539db4bb3bcf8673dd7f7cf68" title="START_TEST" alt="" coords="369,68,476,95"/><area shape="rect" id="node4" href="../../d4/d30/_messenger_8h.html#a771c65c3057d870b0653c2fdf0a12fb7" title="kill_messenger" alt="" coords="368,17,477,44"/><area shape="rect" id="node5" href="../../d8/dda/messenger__test_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="539,157,590,184"/><area shape="rect" id="node6" href="../../da/d8f/tox_8h.html#a52259e134bfb9396d9fef4fffe94e878" title="tox_kill" alt="" coords="533,17,596,44"/><area shape="rect" id="node7" href="../../da/d8f/tox_8h.html#aa0e6afccd06a766b84a0633e259f9165" title="Creates and initialises a new Tox instance with the options passed. " alt="" coords="529,81,600,108"/><area shape="rect" id="node8" href="../../d0/de9/encryptsave__test_8c.html#abfc6ca1e662bc2b41efecb0b9e35cc9d" title="START_TEST" alt="" coords="648,5,755,32"/><area shape="rect" id="node9" href="../../db/d11/irc__syncbot_8c.html#a7a3ec256dab5cbac9fc01ff328980da7" title="init_tox" alt="" coords="669,56,733,83"/><area shape="rect" id="node11" href="../../d2/d65/n_tox_8c.html#ac47fc78dd12365ddfd46c70003627250" title="load_data" alt="" coords="662,107,741,133"/><area shape="rect" id="node13" href="../../d7/db1/tox__shell_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="676,157,727,184"/><area shape="rect" id="node10" href="../../db/d11/irc__syncbot_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="803,56,853,83"/><area shape="rect" id="node12" href="../../d2/d65/n_tox_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="803,107,853,133"/><area shape="rect" id="node15" href="../../d1/d36/tox-bootstrapd_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="main" alt="" coords="397,119,448,145"/><area shape="rect" id="node16" href="../../d4/d30/_messenger_8h.html#af015ea2e74c58196e0564719a6c6a112" title="new_messenger" alt="" coords="364,169,481,196"/></map>
</div>
</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Oct 2 2015 23:41:28 for libtoxcore by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.8
</small></address>
</body>
</html>
