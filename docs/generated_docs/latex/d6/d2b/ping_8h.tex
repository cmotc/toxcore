\hypertarget{ping_8h}{\section{toxcore/ping.h File Reference}
\label{ping_8h}\index{toxcore/ping.\+h@{toxcore/ping.\+h}}
}
This graph shows which files directly or indirectly include this file\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d0e/ping_8h__dep__incl}
\end{center}
\end{figure}
\subsection*{Typedefs}
\begin{DoxyCompactItemize}
\item 
typedef struct \hyperlink{struct_p_i_n_g}{P\+I\+N\+G} \hyperlink{ping_8h_ad760d3cf307442d129cf64a3dc315817}{P\+I\+N\+G}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{ping_8h_a088e8f057d04ba6808f300cde41fa6af}{add\+\_\+to\+\_\+ping} (\hyperlink{struct_p_i_n_g}{P\+I\+N\+G} $\ast$ping, const uint8\+\_\+t $\ast$public\+\_\+key, \hyperlink{struct_i_p___port}{I\+P\+\_\+\+Port} ip\+\_\+port)
\item 
void \hyperlink{ping_8h_af1ade820101b833a4615cb9fb58bebad}{do\+\_\+to\+\_\+ping} (\hyperlink{struct_p_i_n_g}{P\+I\+N\+G} $\ast$ping)
\item 
\hyperlink{struct_p_i_n_g}{P\+I\+N\+G} $\ast$ \hyperlink{ping_8h_a86e9eeead72b88b686ce5b7c0f78c325}{new\+\_\+ping} (\hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht)
\item 
void \hyperlink{ping_8h_a9487f04f4bb6ac4be59a4166236ec896}{kill\+\_\+ping} (\hyperlink{struct_p_i_n_g}{P\+I\+N\+G} $\ast$ping)
\item 
int \hyperlink{ping_8h_a1b3882fdfddc79be369ff230cd3e7a6a}{send\+\_\+ping\+\_\+request} (\hyperlink{struct_p_i_n_g}{P\+I\+N\+G} $\ast$ping, \hyperlink{struct_i_p___port}{I\+P\+\_\+\+Port} ipp, const uint8\+\_\+t $\ast$public\+\_\+key)
\end{DoxyCompactItemize}


\subsection{Typedef Documentation}
\hypertarget{ping_8h_ad760d3cf307442d129cf64a3dc315817}{\index{ping.\+h@{ping.\+h}!P\+I\+N\+G@{P\+I\+N\+G}}
\index{P\+I\+N\+G@{P\+I\+N\+G}!ping.\+h@{ping.\+h}}
\subsubsection[{P\+I\+N\+G}]{\setlength{\rightskip}{0pt plus 5cm}typedef struct {\bf P\+I\+N\+G} {\bf P\+I\+N\+G}}}\label{ping_8h_ad760d3cf307442d129cf64a3dc315817}


Definition at line 27 of file ping.\+h.



\subsection{Function Documentation}
\hypertarget{ping_8h_a088e8f057d04ba6808f300cde41fa6af}{\index{ping.\+h@{ping.\+h}!add\+\_\+to\+\_\+ping@{add\+\_\+to\+\_\+ping}}
\index{add\+\_\+to\+\_\+ping@{add\+\_\+to\+\_\+ping}!ping.\+h@{ping.\+h}}
\subsubsection[{add\+\_\+to\+\_\+ping}]{\setlength{\rightskip}{0pt plus 5cm}int add\+\_\+to\+\_\+ping (
\begin{DoxyParamCaption}
\item[{{\bf P\+I\+N\+G} $\ast$}]{ping, }
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key, }
\item[{{\bf I\+P\+\_\+\+Port}}]{ip\+\_\+port}
\end{DoxyParamCaption}
)}}\label{ping_8h_a088e8f057d04ba6808f300cde41fa6af}


Definition at line 260 of file ping.\+c.



References D\+H\+T\+::close\+\_\+clientlist, P\+I\+N\+G\+::dht, i, id\+\_\+closest(), in\+\_\+list(), I\+P\+\_\+\+Port\+::ip, ip\+\_\+isset(), Node\+\_\+format\+::ip\+\_\+port, ipport\+\_\+copy(), L\+C\+L\+I\+E\+N\+T\+\_\+\+L\+I\+S\+T, M\+A\+X\+\_\+\+T\+O\+\_\+\+P\+I\+N\+G, Node\+\_\+format\+::public\+\_\+key, D\+H\+T\+::self\+\_\+public\+\_\+key, and P\+I\+N\+G\+::to\+\_\+ping.



Referenced by handle\+\_\+getnodes(), and handle\+\_\+ping\+\_\+request().


\begin{DoxyCode}
261 \{
262     \textcolor{keywordflow}{if} (!\hyperlink{network_8c_ac56c677f4bc8bf8311370ee105ae7cbb}{ip\_isset}(&ip\_port.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}))
263         \textcolor{keywordflow}{return} -1;
264 
265     \textcolor{keywordflow}{if} (\hyperlink{ping_8c_afb4f8490dc31f6d2eab779e12e3ad85b}{in\_list}(ping->\hyperlink{struct_p_i_n_g_a8b3d6ce8745acc52695e252bdb1531b6}{dht}->\hyperlink{struct_d_h_t_a00ef35d5b0e7a791ef08a30b3bacbf9d}{close\_clientlist}, 
      \hyperlink{_d_h_t_8h_a3058f857a8316099e20c95fb07adc7c1}{LCLIENT\_LIST}, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, ip\_port))
266         \textcolor{keywordflow}{return} -1;
267 
268     uint32\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
269 
270     \textcolor{keywordflow}{for} (i = 0; i < \hyperlink{ping_8c_ad1ce7ca90b9952294a49754a8526efff}{MAX\_TO\_PING}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
271         \textcolor{keywordflow}{if} (!\hyperlink{network_8c_ac56c677f4bc8bf8311370ee105ae7cbb}{ip\_isset}(&ping->\hyperlink{struct_p_i_n_g_a285072fd4cc519802afa28bef4227c57}{to\_ping}[i].\hyperlink{struct_node__format_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip})) \{
272             memcpy(ping->\hyperlink{struct_p_i_n_g_a285072fd4cc519802afa28bef4227c57}{to\_ping}[i].\hyperlink{struct_node__format_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, 
      crypto\_box\_PUBLICKEYBYTES);
273             \hyperlink{network_8c_a98c8d0713b35c97e9861cd7e59c40890}{ipport\_copy}(&ping->\hyperlink{struct_p_i_n_g_a285072fd4cc519802afa28bef4227c57}{to\_ping}[i].\hyperlink{struct_node__format_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}, &ip\_port);
274             \textcolor{keywordflow}{return} 0;
275         \}
276 
277         \textcolor{keywordflow}{if} (memcmp(ping->\hyperlink{struct_p_i_n_g_a285072fd4cc519802afa28bef4227c57}{to\_ping}[i].\hyperlink{struct_node__format_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, 
      crypto\_box\_PUBLICKEYBYTES) == 0) \{
278             \textcolor{keywordflow}{return} -1;
279         \}
280     \}
281 
282     uint32\_t r = rand();
283 
284     \textcolor{keywordflow}{for} (i = 0; i < \hyperlink{ping_8c_ad1ce7ca90b9952294a49754a8526efff}{MAX\_TO\_PING}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
285         \textcolor{keywordflow}{if} (\hyperlink{_d_h_t_8c_a903a5bc580826fe447adb841b7782333}{id\_closest}(ping->\hyperlink{struct_p_i_n_g_a8b3d6ce8745acc52695e252bdb1531b6}{dht}->\hyperlink{struct_d_h_t_ae726df8bdc26380e5a6c3187a00d6881}{self\_public\_key}, ping->
      \hyperlink{struct_p_i_n_g_a285072fd4cc519802afa28bef4227c57}{to\_ping}[(i + r) % MAX\_TO\_PING].\hyperlink{struct_node__format_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}) == 2) \{
286             memcpy(ping->\hyperlink{struct_p_i_n_g_a285072fd4cc519802afa28bef4227c57}{to\_ping}[(i + r) % MAX\_TO\_PING].\hyperlink{struct_node__format_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, 
      \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, crypto\_box\_PUBLICKEYBYTES);
287             \hyperlink{network_8c_a98c8d0713b35c97e9861cd7e59c40890}{ipport\_copy}(&ping->\hyperlink{struct_p_i_n_g_a285072fd4cc519802afa28bef4227c57}{to\_ping}[(i + r) % MAX\_TO\_PING].
      \hyperlink{struct_node__format_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}, &ip\_port);
288             \textcolor{keywordflow}{return} 0;
289         \}
290     \}
291 
292     \textcolor{keywordflow}{return} -1;
293 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d6/d2b/ping_8h_a088e8f057d04ba6808f300cde41fa6af_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d6/d2b/ping_8h_a088e8f057d04ba6808f300cde41fa6af_icgraph}
\end{center}
\end{figure}


\hypertarget{ping_8h_af1ade820101b833a4615cb9fb58bebad}{\index{ping.\+h@{ping.\+h}!do\+\_\+to\+\_\+ping@{do\+\_\+to\+\_\+ping}}
\index{do\+\_\+to\+\_\+ping@{do\+\_\+to\+\_\+ping}!ping.\+h@{ping.\+h}}
\subsubsection[{do\+\_\+to\+\_\+ping}]{\setlength{\rightskip}{0pt plus 5cm}void do\+\_\+to\+\_\+ping (
\begin{DoxyParamCaption}
\item[{{\bf P\+I\+N\+G} $\ast$}]{ping}
\end{DoxyParamCaption}
)}}\label{ping_8h_af1ade820101b833a4615cb9fb58bebad}


Definition at line 299 of file ping.\+c.



References i, I\+P\+\_\+\+Port\+::ip, ip\+\_\+isset(), Node\+\_\+format\+::ip\+\_\+port, ip\+\_\+reset(), is\+\_\+timeout(), P\+I\+N\+G\+::last\+\_\+to\+\_\+ping, M\+A\+X\+\_\+\+T\+O\+\_\+\+P\+I\+N\+G, Node\+\_\+format\+::public\+\_\+key, send\+\_\+ping\+\_\+request(), T\+I\+M\+E\+\_\+\+T\+O\+\_\+\+P\+I\+N\+G, P\+I\+N\+G\+::to\+\_\+ping, and unix\+\_\+time().



Referenced by do\+\_\+\+D\+H\+T().


\begin{DoxyCode}
300 \{
301     \textcolor{keywordflow}{if} (!\hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(ping->\hyperlink{struct_p_i_n_g_afc22124d671081ed5b12fc2fa71801d3}{last\_to\_ping}, \hyperlink{ping_8c_a714c1fdaecd883185639562aa21c7981}{TIME\_TO\_PING}))
302         \textcolor{keywordflow}{return};
303 
304     \textcolor{keywordflow}{if} (!\hyperlink{network_8c_ac56c677f4bc8bf8311370ee105ae7cbb}{ip\_isset}(&ping->\hyperlink{struct_p_i_n_g_a285072fd4cc519802afa28bef4227c57}{to\_ping}[0].\hyperlink{struct_node__format_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}))
305         \textcolor{keywordflow}{return};
306 
307     uint32\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
308 
309     \textcolor{keywordflow}{for} (i = 0; i < \hyperlink{ping_8c_ad1ce7ca90b9952294a49754a8526efff}{MAX\_TO\_PING}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
310         \textcolor{keywordflow}{if} (!\hyperlink{network_8c_ac56c677f4bc8bf8311370ee105ae7cbb}{ip\_isset}(&ping->\hyperlink{struct_p_i_n_g_a285072fd4cc519802afa28bef4227c57}{to\_ping}[i].\hyperlink{struct_node__format_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}))
311             \textcolor{keywordflow}{break};
312 
313         \hyperlink{ping_8c_a1b3882fdfddc79be369ff230cd3e7a6a}{send\_ping\_request}(ping, ping->\hyperlink{struct_p_i_n_g_a285072fd4cc519802afa28bef4227c57}{to\_ping}[i].\hyperlink{struct_node__format_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}, ping->
      \hyperlink{struct_p_i_n_g_a285072fd4cc519802afa28bef4227c57}{to\_ping}[i].\hyperlink{struct_node__format_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key});
314         \hyperlink{network_8c_a2bfd1efbce5b035b10c879a7e85c08df}{ip\_reset}(&ping->\hyperlink{struct_p_i_n_g_a285072fd4cc519802afa28bef4227c57}{to\_ping}[i].\hyperlink{struct_node__format_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip});
315     \}
316 
317     \textcolor{keywordflow}{if} (i != 0)
318         ping->\hyperlink{struct_p_i_n_g_afc22124d671081ed5b12fc2fa71801d3}{last\_to\_ping} = \hyperlink{util_8c_ac958d9f8847cb8039444bfa3d304233a}{unix\_time}();
319 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d6/d2b/ping_8h_af1ade820101b833a4615cb9fb58bebad_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d6/d2b/ping_8h_af1ade820101b833a4615cb9fb58bebad_icgraph}
\end{center}
\end{figure}


\hypertarget{ping_8h_a9487f04f4bb6ac4be59a4166236ec896}{\index{ping.\+h@{ping.\+h}!kill\+\_\+ping@{kill\+\_\+ping}}
\index{kill\+\_\+ping@{kill\+\_\+ping}!ping.\+h@{ping.\+h}}
\subsubsection[{kill\+\_\+ping}]{\setlength{\rightskip}{0pt plus 5cm}void kill\+\_\+ping (
\begin{DoxyParamCaption}
\item[{{\bf P\+I\+N\+G} $\ast$}]{ping}
\end{DoxyParamCaption}
)}}\label{ping_8h_a9487f04f4bb6ac4be59a4166236ec896}


Definition at line 341 of file ping.\+c.



References P\+I\+N\+G\+::dht, D\+H\+T\+::net, N\+E\+T\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+P\+I\+N\+G\+\_\+\+R\+E\+Q\+U\+E\+S\+T, N\+E\+T\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+P\+I\+N\+G\+\_\+\+R\+E\+S\+P\+O\+N\+S\+E, networking\+\_\+registerhandler(), P\+I\+N\+G\+::ping\+\_\+array, and ping\+\_\+array\+\_\+free\+\_\+all().



Referenced by kill\+\_\+\+D\+H\+T().


\begin{DoxyCode}
342 \{
343     \hyperlink{network_8c_a230a192ca9463ec4985d4f86de439733}{networking\_registerhandler}(ping->\hyperlink{struct_p_i_n_g_a8b3d6ce8745acc52695e252bdb1531b6}{dht}->\hyperlink{struct_d_h_t_aa14ea2f67950f57fe4235d7375a2216c}{net}, 
      \hyperlink{network_8h_a0e8a1fd7942a30ebd883c1c25311a323}{NET\_PACKET\_PING\_REQUEST}, NULL, NULL);
344     \hyperlink{network_8c_a230a192ca9463ec4985d4f86de439733}{networking\_registerhandler}(ping->\hyperlink{struct_p_i_n_g_a8b3d6ce8745acc52695e252bdb1531b6}{dht}->\hyperlink{struct_d_h_t_aa14ea2f67950f57fe4235d7375a2216c}{net}, 
      \hyperlink{network_8h_a63c9253af079267e344036d235fcd48d}{NET\_PACKET\_PING\_RESPONSE}, NULL, NULL);
345     \hyperlink{ping__array_8c_a7e093974e6d616c5bbcadfd434b49824}{ping\_array\_free\_all}(&ping->\hyperlink{struct_p_i_n_g_afb64d37a183969be553d23416dc47a4b}{ping\_array});
346 
347     free(ping);
348 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d6/d2b/ping_8h_a9487f04f4bb6ac4be59a4166236ec896_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d6/d2b/ping_8h_a9487f04f4bb6ac4be59a4166236ec896_icgraph}
\end{center}
\end{figure}


\hypertarget{ping_8h_a86e9eeead72b88b686ce5b7c0f78c325}{\index{ping.\+h@{ping.\+h}!new\+\_\+ping@{new\+\_\+ping}}
\index{new\+\_\+ping@{new\+\_\+ping}!ping.\+h@{ping.\+h}}
\subsubsection[{new\+\_\+ping}]{\setlength{\rightskip}{0pt plus 5cm}{\bf P\+I\+N\+G}$\ast$ new\+\_\+ping (
\begin{DoxyParamCaption}
\item[{{\bf D\+H\+T} $\ast$}]{dht}
\end{DoxyParamCaption}
)}}\label{ping_8h_a86e9eeead72b88b686ce5b7c0f78c325}


Definition at line 322 of file ping.\+c.



References P\+I\+N\+G\+::dht, handle\+\_\+ping\+\_\+request(), handle\+\_\+ping\+\_\+response(), D\+H\+T\+::net, N\+E\+T\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+P\+I\+N\+G\+\_\+\+R\+E\+Q\+U\+E\+S\+T, N\+E\+T\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+P\+I\+N\+G\+\_\+\+R\+E\+S\+P\+O\+N\+S\+E, networking\+\_\+registerhandler(), P\+I\+N\+G\+::ping\+\_\+array, ping\+\_\+array\+\_\+init(), P\+I\+N\+G\+\_\+\+N\+U\+M\+\_\+\+M\+A\+X, and P\+I\+N\+G\+\_\+\+T\+I\+M\+E\+O\+U\+T.



Referenced by new\+\_\+\+D\+H\+T().


\begin{DoxyCode}
323 \{
324     \hyperlink{struct_p_i_n_g}{PING} *ping = calloc(1, \textcolor{keyword}{sizeof}(\hyperlink{struct_p_i_n_g}{PING}));
325 
326     \textcolor{keywordflow}{if} (ping == NULL)
327         \textcolor{keywordflow}{return} NULL;
328 
329     \textcolor{keywordflow}{if} (\hyperlink{ping__array_8c_a2d42b1adf1e6ff6a690fc515b9bb2570}{ping\_array\_init}(&ping->\hyperlink{struct_p_i_n_g_afb64d37a183969be553d23416dc47a4b}{ping\_array}, \hyperlink{ping_8c_af33ac2d5236d6400fb7c68fa596c3f77}{PING\_NUM\_MAX}, 
      \hyperlink{_d_h_t_8h_a733f0d1225f97d8acbd3388e0c0d320f}{PING\_TIMEOUT}) != 0) \{
330         free(ping);
331         \textcolor{keywordflow}{return} NULL;
332     \}
333 
334     ping->\hyperlink{struct_p_i_n_g_a8b3d6ce8745acc52695e252bdb1531b6}{dht} = dht;
335     \hyperlink{network_8c_a230a192ca9463ec4985d4f86de439733}{networking\_registerhandler}(ping->\hyperlink{struct_p_i_n_g_a8b3d6ce8745acc52695e252bdb1531b6}{dht}->\hyperlink{struct_d_h_t_aa14ea2f67950f57fe4235d7375a2216c}{net}, 
      \hyperlink{network_8h_a0e8a1fd7942a30ebd883c1c25311a323}{NET\_PACKET\_PING\_REQUEST}, &\hyperlink{ping_8c_a8bb0298504d1f6a612100d0b17e3ab90}{handle\_ping\_request}, dht);
336     \hyperlink{network_8c_a230a192ca9463ec4985d4f86de439733}{networking\_registerhandler}(ping->\hyperlink{struct_p_i_n_g_a8b3d6ce8745acc52695e252bdb1531b6}{dht}->\hyperlink{struct_d_h_t_aa14ea2f67950f57fe4235d7375a2216c}{net}, 
      \hyperlink{network_8h_a63c9253af079267e344036d235fcd48d}{NET\_PACKET\_PING\_RESPONSE}, &\hyperlink{ping_8c_a3927c1053be4390271a309982aa7284f}{handle\_ping\_response}, dht);
337 
338     \textcolor{keywordflow}{return} ping;
339 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d6/d2b/ping_8h_a86e9eeead72b88b686ce5b7c0f78c325_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d6/d2b/ping_8h_a86e9eeead72b88b686ce5b7c0f78c325_icgraph}
\end{center}
\end{figure}


\hypertarget{ping_8h_a1b3882fdfddc79be369ff230cd3e7a6a}{\index{ping.\+h@{ping.\+h}!send\+\_\+ping\+\_\+request@{send\+\_\+ping\+\_\+request}}
\index{send\+\_\+ping\+\_\+request@{send\+\_\+ping\+\_\+request}!ping.\+h@{ping.\+h}}
\subsubsection[{send\+\_\+ping\+\_\+request}]{\setlength{\rightskip}{0pt plus 5cm}int send\+\_\+ping\+\_\+request (
\begin{DoxyParamCaption}
\item[{{\bf P\+I\+N\+G} $\ast$}]{ping, }
\item[{{\bf I\+P\+\_\+\+Port}}]{ipp, }
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key}
\end{DoxyParamCaption}
)}}\label{ping_8h_a1b3882fdfddc79be369ff230cd3e7a6a}


Definition at line 61 of file ping.\+c.



References make-\/funny-\/savefile\+::data, P\+I\+N\+G\+::dht, D\+H\+T\+\_\+get\+\_\+shared\+\_\+key\+\_\+sent(), D\+H\+T\+\_\+\+P\+I\+N\+G\+\_\+\+S\+I\+Z\+E, encrypt\+\_\+data\+\_\+symmetric(), id\+\_\+copy(), id\+\_\+equal(), D\+H\+T\+::net, N\+E\+T\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+P\+I\+N\+G\+\_\+\+R\+E\+Q\+U\+E\+S\+T, new\+\_\+nonce(), P\+I\+N\+G\+::ping\+\_\+array, ping\+\_\+array\+\_\+add(), P\+I\+N\+G\+\_\+\+D\+A\+T\+A\+\_\+\+S\+I\+Z\+E, P\+I\+N\+G\+\_\+\+P\+L\+A\+I\+N\+\_\+\+S\+I\+Z\+E, D\+H\+T\+::self\+\_\+public\+\_\+key, and sendpacket().



Referenced by do\+\_\+ping\+\_\+and\+\_\+sendnode\+\_\+requests(), do\+\_\+to\+\_\+ping(), handle\+\_\+sendnodes\+\_\+ipv6(), and punch\+\_\+holes().


\begin{DoxyCode}
62 \{
63     uint8\_t   pk[\hyperlink{ping_8c_ae32390178daa4798de9871c97daa49ab}{DHT\_PING\_SIZE}];
64     \textcolor{keywordtype}{int}       rc;
65     uint64\_t  ping\_id;
66 
67     \textcolor{keywordflow}{if} (\hyperlink{util_8c_ada3d44b4f530d3c8c9cb69b732be94b1}{id\_equal}(\hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, ping->\hyperlink{struct_p_i_n_g_a8b3d6ce8745acc52695e252bdb1531b6}{dht}->\hyperlink{struct_d_h_t_ae726df8bdc26380e5a6c3187a00d6881}{self\_public\_key}))
68         \textcolor{keywordflow}{return} 1;
69 
70     uint8\_t shared\_key[crypto\_box\_BEFORENMBYTES];
71 
72     \textcolor{comment}{// generate key to encrypt ping\_id with recipient privkey}
73     \hyperlink{_d_h_t_8c_a087cceeacc5a14415b651c2980a24d34}{DHT\_get\_shared\_key\_sent}(ping->\hyperlink{struct_p_i_n_g_a8b3d6ce8745acc52695e252bdb1531b6}{dht}, shared\_key, 
      \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key});
74     \textcolor{comment}{// Generate random ping\_id.}
75     uint8\_t \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[\hyperlink{ping_8c_aae49a47b7be864d302fa11ad0b3b9589}{PING\_DATA\_SIZE}];
76     \hyperlink{util_8c_aa30049b8c1d82c280d6d872feea3353b}{id\_copy}(data, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key});
77     memcpy(data + crypto\_box\_PUBLICKEYBYTES, &ipp, \textcolor{keyword}{sizeof}(\hyperlink{struct_i_p___port}{IP\_Port}));
78     ping\_id = \hyperlink{ping__array_8c_a67470d42ee0e3e61bedfa598f3039266}{ping\_array\_add}(&ping->\hyperlink{struct_p_i_n_g_afb64d37a183969be553d23416dc47a4b}{ping\_array}, data, \textcolor{keyword}{sizeof}(data));
79 
80     \textcolor{keywordflow}{if} (ping\_id == 0)
81         \textcolor{keywordflow}{return} 1;
82 
83     uint8\_t ping\_plain[\hyperlink{ping_8c_a39ba6cad7fb7788ab3d3e5e546944e74}{PING\_PLAIN\_SIZE}];
84     ping\_plain[0] = \hyperlink{network_8h_a0e8a1fd7942a30ebd883c1c25311a323}{NET\_PACKET\_PING\_REQUEST};
85     memcpy(ping\_plain + 1, &ping\_id, \textcolor{keyword}{sizeof}(ping\_id));
86 
87     pk[0] = \hyperlink{network_8h_a0e8a1fd7942a30ebd883c1c25311a323}{NET\_PACKET\_PING\_REQUEST};
88     \hyperlink{util_8c_aa30049b8c1d82c280d6d872feea3353b}{id\_copy}(pk + 1, ping->\hyperlink{struct_p_i_n_g_a8b3d6ce8745acc52695e252bdb1531b6}{dht}->\hyperlink{struct_d_h_t_ae726df8bdc26380e5a6c3187a00d6881}{self\_public\_key});     \textcolor{comment}{// Our pubkey}
89     \hyperlink{crypto__core_8c_a8b1033efb47c625779d11be7d8eb9e24}{new\_nonce}(pk + 1 + crypto\_box\_PUBLICKEYBYTES); \textcolor{comment}{// Generate new nonce}
90 
91 
92     rc = \hyperlink{crypto__core_8c_a81efc0a4a6e0efe372651e26e342a6e5}{encrypt\_data\_symmetric}(shared\_key,
93                                 pk + 1 + crypto\_box\_PUBLICKEYBYTES,
94                                 ping\_plain, \textcolor{keyword}{sizeof}(ping\_plain),
95                                 pk + 1 + crypto\_box\_PUBLICKEYBYTES + crypto\_box\_NONCEBYTES);
96 
97     \textcolor{keywordflow}{if} (rc != \hyperlink{ping_8c_a39ba6cad7fb7788ab3d3e5e546944e74}{PING\_PLAIN\_SIZE} + crypto\_box\_MACBYTES)
98         \textcolor{keywordflow}{return} 1;
99 
100     \textcolor{keywordflow}{return} \hyperlink{network_8c_a7b90f87f3ba60cc5c66dd6dd77cd5cb1}{sendpacket}(ping->\hyperlink{struct_p_i_n_g_a8b3d6ce8745acc52695e252bdb1531b6}{dht}->\hyperlink{struct_d_h_t_aa14ea2f67950f57fe4235d7375a2216c}{net}, ipp, pk, \textcolor{keyword}{sizeof}(pk));
101 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d6/d2b/ping_8h_a1b3882fdfddc79be369ff230cd3e7a6a_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d6/d2b/ping_8h_a1b3882fdfddc79be369ff230cd3e7a6a_icgraph}
\end{center}
\end{figure}


