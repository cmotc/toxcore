\hypertarget{_d_h_t_8c}{\section{toxcore/\+D\+H\+T.c File Reference}
\label{_d_h_t_8c}\index{toxcore/\+D\+H\+T.\+c@{toxcore/\+D\+H\+T.\+c}}
}
{\ttfamily \#include \char`\"{}logger.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}D\+H\+T.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}ping.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}network.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}L\+A\+N\+\_\+discovery.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}misc\+\_\+tools.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}util.\+h\char`\"{}}\\*
Include dependency graph for D\+H\+T.\+c\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/d2a/_d_h_t_8c__incl}
\end{center}
\end{figure}
This graph shows which files directly or indirectly include this file\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=189pt]{d5/d6c/_d_h_t_8c__dep__incl}
\end{center}
\end{figure}
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{_d_h_t_8c_af1093baf3868bd51244122ec59316304}{K\+I\+L\+L\+\_\+\+N\+O\+D\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T}~(\hyperlink{_d_h_t_8h_a2c542fd03a43f340d1fb281afe54453f}{B\+A\+D\+\_\+\+N\+O\+D\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T} + \hyperlink{_d_h_t_8h_ae138d10c7cd4199e5e96377ff1f8e317}{P\+I\+N\+G\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L})
\item 
\#define \hyperlink{_d_h_t_8c_a5743fd97642ab4b5cc04e9e19c82e0f3}{G\+E\+T\+\_\+\+N\+O\+D\+E\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L}~20
\item 
\#define \hyperlink{_d_h_t_8c_aa26d44826e51b690cac89a8e81b53710}{M\+A\+X\+\_\+\+P\+U\+N\+C\+H\+I\+N\+G\+\_\+\+P\+O\+R\+T\+S}~48
\item 
\#define \hyperlink{_d_h_t_8c_afb88902dba0294dd97d42384ceacafa3}{P\+U\+N\+C\+H\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L}~3
\item 
\#define \hyperlink{_d_h_t_8c_a47f5811ec6dd12a1a14d7f44c717b5f1}{M\+A\+X\+\_\+\+N\+O\+R\+M\+A\+L\+\_\+\+P\+U\+N\+C\+H\+I\+N\+G\+\_\+\+T\+R\+I\+E\+S}~5
\item 
\#define \hyperlink{_d_h_t_8c_a2c654c475c840fc796772eef9079930f}{N\+A\+T\+\_\+\+P\+I\+N\+G\+\_\+\+R\+E\+Q\+U\+E\+S\+T}~0
\item 
\#define \hyperlink{_d_h_t_8c_a88eacf49971603509097ad0a46d7d9ff}{N\+A\+T\+\_\+\+P\+I\+N\+G\+\_\+\+R\+E\+S\+P\+O\+N\+S\+E}~1
\item 
\#define \hyperlink{_d_h_t_8c_ad54cdfc53c7a3f71e4f5dbfe22e84058}{M\+A\+X\+\_\+\+B\+O\+O\+T\+S\+T\+R\+A\+P\+\_\+\+T\+I\+M\+E\+S}~10
\item 
\#define \hyperlink{_d_h_t_8c_a03601baefa220335487dfc838c08d268}{P\+A\+C\+K\+E\+D\+\_\+\+N\+O\+D\+E\+\_\+\+S\+I\+Z\+E\+\_\+\+I\+P4}~(1 + \hyperlink{network_8h_af01e75c1c63a39bcd2aacdf3018b18c9}{S\+I\+Z\+E\+\_\+\+I\+P4} + sizeof(uint16\+\_\+t) + crypto\+\_\+box\+\_\+\+P\+U\+B\+L\+I\+C\+K\+E\+Y\+B\+Y\+T\+E\+S)
\item 
\#define \hyperlink{_d_h_t_8c_a9b47e23b0610a17f01902680f55d7963}{P\+A\+C\+K\+E\+D\+\_\+\+N\+O\+D\+E\+\_\+\+S\+I\+Z\+E\+\_\+\+I\+P6}~(1 + \hyperlink{network_8h_a5d7430ad26f80239b9fe1bbcd51b5ed2}{S\+I\+Z\+E\+\_\+\+I\+P6} + sizeof(uint16\+\_\+t) + crypto\+\_\+box\+\_\+\+P\+U\+B\+L\+I\+C\+K\+E\+Y\+B\+Y\+T\+E\+S)
\item 
\#define \hyperlink{_d_h_t_8c_a26075b69d14a1c08617bdb49aaf22ade}{H\+A\+R\+D\+E\+N\+I\+N\+G\+\_\+\+A\+L\+L\+\_\+\+O\+K}~2
\item 
\#define \hyperlink{_d_h_t_8c_a207dfa01a1f5f59c613d2202843bef3c}{H\+A\+R\+D\+R\+E\+Q\+\_\+\+D\+A\+T\+A\+\_\+\+S\+I\+Z\+E}~384 /$\ast$ Attempt to prevent amplification/other attacks$\ast$/
\item 
\#define \hyperlink{_d_h_t_8c_a21dd514df24c1d833d4e024513ac3bae}{C\+H\+E\+C\+K\+\_\+\+T\+Y\+P\+E\+\_\+\+R\+O\+U\+T\+E\+\_\+\+R\+E\+Q}~0
\item 
\#define \hyperlink{_d_h_t_8c_a22a8e95d63ebd6b8b8e627fdd12ef677}{C\+H\+E\+C\+K\+\_\+\+T\+Y\+P\+E\+\_\+\+R\+O\+U\+T\+E\+\_\+\+R\+E\+S}~1
\item 
\#define \hyperlink{_d_h_t_8c_ac582451ce11946977a1feec8591f7aa1}{C\+H\+E\+C\+K\+\_\+\+T\+Y\+P\+E\+\_\+\+G\+E\+T\+N\+O\+D\+E\+\_\+\+R\+E\+Q}~2
\item 
\#define \hyperlink{_d_h_t_8c_a4388a18c5f38b8aa28e413a6762a6444}{C\+H\+E\+C\+K\+\_\+\+T\+Y\+P\+E\+\_\+\+G\+E\+T\+N\+O\+D\+E\+\_\+\+R\+E\+S}~3
\item 
\#define \hyperlink{_d_h_t_8c_ab8829f898d28ca6202d33cdbb85ccec5}{C\+H\+E\+C\+K\+\_\+\+T\+Y\+P\+E\+\_\+\+T\+E\+S\+T\+\_\+\+R\+E\+Q}~4
\item 
\#define \hyperlink{_d_h_t_8c_aa08e3084aae64c11ed98a3373fa3fcc8}{C\+H\+E\+C\+K\+\_\+\+T\+Y\+P\+E\+\_\+\+T\+E\+S\+T\+\_\+\+R\+E\+S}~5
\item 
\#define \hyperlink{_d_h_t_8c_aa2f9a8d6135222d3875900ba8ef11e11}{H\+A\+R\+D\+E\+N\+I\+N\+G\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L}~120
\item 
\#define \hyperlink{_d_h_t_8c_a916b8aad63b31d6308952fa4bf526b09}{H\+A\+R\+D\+E\+N\+\_\+\+T\+I\+M\+E\+O\+U\+T}~1200
\item 
\#define \hyperlink{_d_h_t_8c_a6a842db82e30616af13990781cf13ab3}{D\+H\+T\+\_\+\+S\+T\+A\+T\+E\+\_\+\+C\+O\+O\+K\+I\+E\+\_\+\+G\+L\+O\+B\+A\+L}~0x159000d
\item 
\#define \hyperlink{_d_h_t_8c_a48a9324191a79b2e05af9b6499addba6}{D\+H\+T\+\_\+\+S\+T\+A\+T\+E\+\_\+\+C\+O\+O\+K\+I\+E\+\_\+\+T\+Y\+P\+E}~0x11ce
\item 
\#define \hyperlink{_d_h_t_8c_a2244b83e3fbf401e240bb5fa9a576e9e}{D\+H\+T\+\_\+\+S\+T\+A\+T\+E\+\_\+\+T\+Y\+P\+E\+\_\+\+N\+O\+D\+E\+S}~4
\item 
\#define \hyperlink{_d_h_t_8c_a4ebd02f5b13bf2d343bef7c55b88ef93}{M\+A\+X\+\_\+\+S\+A\+V\+E\+D\+\_\+\+D\+H\+T\+\_\+\+N\+O\+D\+E\+S}~(((\hyperlink{_d_h_t_8h_a09839809f361926e324196bfd9450bb4}{D\+H\+T\+\_\+\+F\+A\+K\+E\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+N\+U\+M\+B\+E\+R} $\ast$ \hyperlink{_d_h_t_8h_ad50d158518277ca4d19cbe364f3e958c}{M\+A\+X\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+C\+L\+I\+E\+N\+T\+S}) + \hyperlink{_d_h_t_8h_a3058f857a8316099e20c95fb07adc7c1}{L\+C\+L\+I\+E\+N\+T\+\_\+\+L\+I\+S\+T}) $\ast$ 2)
\item 
\#define \hyperlink{_d_h_t_8c_a696df5fcb740674dfec58340660641be}{S\+A\+V\+E\+\_\+\+B\+O\+O\+T\+S\+T\+A\+P\+\_\+\+F\+R\+E\+Q\+U\+E\+N\+C\+Y}~8
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{_d_h_t_8c_a903a5bc580826fe447adb841b7782333}{id\+\_\+closest} (const uint8\+\_\+t $\ast$pk, const uint8\+\_\+t $\ast$pk1, const uint8\+\_\+t $\ast$pk2)
\item 
void \hyperlink{_d_h_t_8c_a6cd4aa89d7bfcf6805c5ce6b273d9e9e}{get\+\_\+shared\+\_\+key} (\hyperlink{struct_shared___keys}{Shared\+\_\+\+Keys} $\ast$shared\+\_\+keys, uint8\+\_\+t $\ast$shared\+\_\+key, const uint8\+\_\+t $\ast$secret\+\_\+key, const uint8\+\_\+t $\ast$public\+\_\+key)
\item 
void \hyperlink{_d_h_t_8c_a9e92f7714ab1f2b37b54e8479717cbc7}{D\+H\+T\+\_\+get\+\_\+shared\+\_\+key\+\_\+recv} (\hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht, uint8\+\_\+t $\ast$shared\+\_\+key, const uint8\+\_\+t $\ast$public\+\_\+key)
\item 
void \hyperlink{_d_h_t_8c_a087cceeacc5a14415b651c2980a24d34}{D\+H\+T\+\_\+get\+\_\+shared\+\_\+key\+\_\+sent} (\hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht, uint8\+\_\+t $\ast$shared\+\_\+key, const uint8\+\_\+t $\ast$public\+\_\+key)
\item 
void \hyperlink{_d_h_t_8c_ae7f65a76f9c4b0093f45fc1777238459}{to\+\_\+net\+\_\+family} (\hyperlink{struct_i_p}{I\+P} $\ast$\hyperlink{irc__syncbot_8c_ae81515e082f9bc33e8968181945586da}{ip})
\item 
int \hyperlink{_d_h_t_8c_a74120ec4fc551572bff2a08436854c97}{to\+\_\+host\+\_\+family} (\hyperlink{struct_i_p}{I\+P} $\ast$\hyperlink{irc__syncbot_8c_ae81515e082f9bc33e8968181945586da}{ip})
\item 
int \hyperlink{_d_h_t_8c_aa980937ac320a4389b726e04da26cb44}{packed\+\_\+node\+\_\+size} (uint8\+\_\+t ip\+\_\+family)
\item 
int \hyperlink{_d_h_t_8c_a1d6f2fcb008c989f333ae89e840f94b4}{pack\+\_\+nodes} (uint8\+\_\+t $\ast$data, uint16\+\_\+t length, const \hyperlink{struct_node__format}{Node\+\_\+format} $\ast$nodes, uint16\+\_\+t number)
\item 
int \hyperlink{_d_h_t_8c_a45b33af842c0289c78c70f81e854ed62}{unpack\+\_\+nodes} (\hyperlink{struct_node__format}{Node\+\_\+format} $\ast$nodes, uint16\+\_\+t max\+\_\+num\+\_\+nodes, uint16\+\_\+t $\ast$processed\+\_\+data\+\_\+len, const uint8\+\_\+t $\ast$data, uint16\+\_\+t length, uint8\+\_\+t tcp\+\_\+enabled)
\item 
static int \hyperlink{_d_h_t_8c_af6cc6aba68b93656a8fdca733e2ae918}{client\+\_\+or\+\_\+ip\+\_\+port\+\_\+in\+\_\+list} (\hyperlink{struct_client__data}{Client\+\_\+data} $\ast$list, uint16\+\_\+t length, const uint8\+\_\+t $\ast$public\+\_\+key, \hyperlink{struct_i_p___port}{I\+P\+\_\+\+Port} ip\+\_\+port)
\item 
static int \hyperlink{_d_h_t_8c_ac2887d26ab67ac2ca1347b0ed8dadbf5}{client\+\_\+in\+\_\+nodelist} (const \hyperlink{struct_node__format}{Node\+\_\+format} $\ast$list, uint16\+\_\+t length, const uint8\+\_\+t $\ast$public\+\_\+key)
\item 
static int \hyperlink{_d_h_t_8c_a6cbd0f66d63003cc0def913dc7a4254b}{friend\+\_\+number} (const \hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht, const uint8\+\_\+t $\ast$public\+\_\+key)
\item 
static uint8\+\_\+t \hyperlink{_d_h_t_8c_a99cbbcdc9772e5c2b1ff8416074e88c0}{hardening\+\_\+correct} (const \hyperlink{struct_hardening}{Hardening} $\ast$h)
\item 
static void \hyperlink{_d_h_t_8c_a40b090e4bc0b1280a8689b7931f320c6}{get\+\_\+close\+\_\+nodes\+\_\+inner} (const uint8\+\_\+t $\ast$public\+\_\+key, \hyperlink{struct_node__format}{Node\+\_\+format} $\ast$nodes\+\_\+list, sa\+\_\+family\+\_\+t sa\+\_\+family, const \hyperlink{struct_client__data}{Client\+\_\+data} $\ast$client\+\_\+list, uint32\+\_\+t client\+\_\+list\+\_\+length, uint32\+\_\+t $\ast$num\+\_\+nodes\+\_\+ptr, uint8\+\_\+t is\+\_\+\+L\+A\+N, uint8\+\_\+t want\+\_\+good)
\item 
static int \hyperlink{_d_h_t_8c_ab7f89880bce923390748449ef6f60004}{get\+\_\+somewhat\+\_\+close\+\_\+nodes} (const \hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht, const uint8\+\_\+t $\ast$public\+\_\+key, \hyperlink{struct_node__format}{Node\+\_\+format} $\ast$nodes\+\_\+list, sa\+\_\+family\+\_\+t sa\+\_\+family, uint8\+\_\+t is\+\_\+\+L\+A\+N, uint8\+\_\+t want\+\_\+good)
\item 
int \hyperlink{_d_h_t_8c_a8abfc9cea3784b0cae354670bd4643cd}{get\+\_\+close\+\_\+nodes} (const \hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht, const uint8\+\_\+t $\ast$public\+\_\+key, \hyperlink{struct_node__format}{Node\+\_\+format} $\ast$nodes\+\_\+list, sa\+\_\+family\+\_\+t sa\+\_\+family, uint8\+\_\+t is\+\_\+\+L\+A\+N, uint8\+\_\+t want\+\_\+good)
\item 
static int \hyperlink{_d_h_t_8c_a15d71358ca3e1f937159a7982168bb30}{cmp\+\_\+dht\+\_\+entry} (const void $\ast$a, const void $\ast$b)
\item 
static unsigned int \hyperlink{_d_h_t_8c_addb87a718c80bb27e53e8dde5972dfe9}{store\+\_\+node\+\_\+ok} (const \hyperlink{struct_client__data}{Client\+\_\+data} $\ast$client, const uint8\+\_\+t $\ast$public\+\_\+key, const uint8\+\_\+t $\ast$comp\+\_\+public\+\_\+key)
\item 
static int \hyperlink{_d_h_t_8c_adfcc072141badf7d1cd04542b3dd26b1}{replace\+\_\+all} (\hyperlink{struct_client__data}{Client\+\_\+data} $\ast$list, uint16\+\_\+t length, const uint8\+\_\+t $\ast$public\+\_\+key, \hyperlink{struct_i_p___port}{I\+P\+\_\+\+Port} ip\+\_\+port, const uint8\+\_\+t $\ast$comp\+\_\+public\+\_\+key)
\item 
static unsigned int \hyperlink{_d_h_t_8c_ac03ed08d34d4135aa259515936209616}{ping\+\_\+node\+\_\+from\+\_\+getnodes\+\_\+ok} (\hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht, const uint8\+\_\+t $\ast$public\+\_\+key)
\item 
int \hyperlink{_d_h_t_8c_a9d898065db0fd4adf26fdb7f80e6d7ac}{addto\+\_\+lists} (\hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht, \hyperlink{struct_i_p___port}{I\+P\+\_\+\+Port} ip\+\_\+port, const uint8\+\_\+t $\ast$public\+\_\+key)
\item 
static int \hyperlink{_d_h_t_8c_a8c25b3f909399fff843f905f2ad9615f}{returnedip\+\_\+ports} (\hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht, \hyperlink{struct_i_p___port}{I\+P\+\_\+\+Port} ip\+\_\+port, const uint8\+\_\+t $\ast$public\+\_\+key, const uint8\+\_\+t $\ast$nodepublic\+\_\+key)
\item 
static int \hyperlink{_d_h_t_8c_a7af6c30b12e5cbda1e6d6d824794956e}{getnodes} (\hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht, \hyperlink{struct_i_p___port}{I\+P\+\_\+\+Port} ip\+\_\+port, const uint8\+\_\+t $\ast$public\+\_\+key, const uint8\+\_\+t $\ast$client\+\_\+id, const \hyperlink{struct_node__format}{Node\+\_\+format} $\ast$sendback\+\_\+node)
\item 
static int \hyperlink{_d_h_t_8c_acce043cdc5108edffc35e6e879197d20}{sendnodes\+\_\+ipv6} (const \hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht, \hyperlink{struct_i_p___port}{I\+P\+\_\+\+Port} ip\+\_\+port, const uint8\+\_\+t $\ast$public\+\_\+key, const uint8\+\_\+t $\ast$client\+\_\+id, const uint8\+\_\+t $\ast$sendback\+\_\+data, uint16\+\_\+t length, const uint8\+\_\+t $\ast$shared\+\_\+encryption\+\_\+key)
\item 
static int \hyperlink{_d_h_t_8c_afa4f13a29cbe60809f2446267d109383}{handle\+\_\+getnodes} (void $\ast$object, \hyperlink{struct_i_p___port}{I\+P\+\_\+\+Port} source, const uint8\+\_\+t $\ast$packet, uint16\+\_\+t length)
\item 
static uint8\+\_\+t \hyperlink{_d_h_t_8c_a8def0d75fd95309e03096fbcf5085fe3}{sent\+\_\+getnode\+\_\+to\+\_\+node} (\hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht, const uint8\+\_\+t $\ast$public\+\_\+key, \hyperlink{struct_i_p___port}{I\+P\+\_\+\+Port} node\+\_\+ip\+\_\+port, uint64\+\_\+t ping\+\_\+id, \hyperlink{struct_node__format}{Node\+\_\+format} $\ast$sendback\+\_\+node)
\item 
static int \hyperlink{_d_h_t_8c_ac35510e6bf4c6cfa950de4da3f4d8718}{send\+\_\+hardening\+\_\+getnode\+\_\+res} (const \hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht, const \hyperlink{struct_node__format}{Node\+\_\+format} $\ast$sendto, const uint8\+\_\+t $\ast$queried\+\_\+client\+\_\+id, const uint8\+\_\+t $\ast$nodes\+\_\+data, uint16\+\_\+t nodes\+\_\+data\+\_\+length)
\item 
static int \hyperlink{_d_h_t_8c_a4dcc848207b2408def323b8b79b08e4a}{handle\+\_\+sendnodes\+\_\+core} (void $\ast$object, \hyperlink{struct_i_p___port}{I\+P\+\_\+\+Port} source, const uint8\+\_\+t $\ast$packet, uint16\+\_\+t length, \hyperlink{struct_node__format}{Node\+\_\+format} $\ast$plain\+\_\+nodes, uint16\+\_\+t size\+\_\+plain\+\_\+nodes, uint32\+\_\+t $\ast$num\+\_\+nodes\+\_\+out)
\item 
static int \hyperlink{_d_h_t_8c_ac70b27be10ded8565ffcb94829e40514}{handle\+\_\+sendnodes\+\_\+ipv6} (void $\ast$object, \hyperlink{struct_i_p___port}{I\+P\+\_\+\+Port} source, const uint8\+\_\+t $\ast$packet, uint16\+\_\+t length)
\item 
int \hyperlink{_d_h_t_8c_a1dac5e05fd07964cb4914c17afeb9d50}{D\+H\+T\+\_\+addfriend} (\hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht, const uint8\+\_\+t $\ast$public\+\_\+key, void($\ast$ip\+\_\+callback)(void $\ast$data, int32\+\_\+t number, \hyperlink{struct_i_p___port}{I\+P\+\_\+\+Port}), void $\ast$data, int32\+\_\+t number, uint16\+\_\+t $\ast$lock\+\_\+count)
\item 
int \hyperlink{_d_h_t_8c_a4e70f3fc186c6e459908307c935d00b2}{D\+H\+T\+\_\+delfriend} (\hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht, const uint8\+\_\+t $\ast$public\+\_\+key, uint16\+\_\+t lock\+\_\+count)
\item 
int \hyperlink{_d_h_t_8c_a963cf2afd9283277f69a94381e3fc5f0}{D\+H\+T\+\_\+getfriendip} (const \hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht, const uint8\+\_\+t $\ast$public\+\_\+key, \hyperlink{struct_i_p___port}{I\+P\+\_\+\+Port} $\ast$ip\+\_\+port)
\item 
static uint8\+\_\+t \hyperlink{_d_h_t_8c_a1d3aa20a7622e95d168e3220f61f6227}{do\+\_\+ping\+\_\+and\+\_\+sendnode\+\_\+requests} (\hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht, uint64\+\_\+t $\ast$lastgetnode, const uint8\+\_\+t $\ast$public\+\_\+key, \hyperlink{struct_client__data}{Client\+\_\+data} $\ast$list, uint32\+\_\+t list\+\_\+count, uint32\+\_\+t $\ast$bootstrap\+\_\+times)
\item 
static void \hyperlink{_d_h_t_8c_ad1bcb472a3fd0ff8ab579551c4528b62}{do\+\_\+\+D\+H\+T\+\_\+friends} (\hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht)
\item 
static void \hyperlink{_d_h_t_8c_ae05715389aba7cec9083bdf9efad7a78}{do\+\_\+\+Close} (\hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht)
\item 
void \hyperlink{_d_h_t_8c_a769ef744f969e1b4c55547cb74abee59}{D\+H\+T\+\_\+getnodes} (\hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht, const \hyperlink{struct_i_p___port}{I\+P\+\_\+\+Port} $\ast$from\+\_\+ipp, const uint8\+\_\+t $\ast$from\+\_\+id, const uint8\+\_\+t $\ast$which\+\_\+id)
\item 
void \hyperlink{_d_h_t_8c_ab6d732074bab2377a7884c41c219cf96}{D\+H\+T\+\_\+bootstrap} (\hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht, \hyperlink{struct_i_p___port}{I\+P\+\_\+\+Port} ip\+\_\+port, const uint8\+\_\+t $\ast$public\+\_\+key)
\item 
int \hyperlink{_d_h_t_8c_af342c78837dbed569d4a75a0516455fc}{D\+H\+T\+\_\+bootstrap\+\_\+from\+\_\+address} (\hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht, const char $\ast$address, uint8\+\_\+t ipv6enabled, uint16\+\_\+t \hyperlink{irc__syncbot_8c_a8e0798404bf2cf5dabb84c5ba9a4f236}{port}, const uint8\+\_\+t $\ast$public\+\_\+key)
\item 
int \hyperlink{_d_h_t_8c_a91072d384a61a04ac1e4d679dc7efb3a}{route\+\_\+packet} (const \hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht, const uint8\+\_\+t $\ast$public\+\_\+key, const uint8\+\_\+t $\ast$packet, uint16\+\_\+t length)
\item 
static int \hyperlink{_d_h_t_8c_a1b3c1814260eace443e6feb13227cc82}{friend\+\_\+iplist} (const \hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht, \hyperlink{struct_i_p___port}{I\+P\+\_\+\+Port} $\ast$ip\+\_\+portlist, uint16\+\_\+t friend\+\_\+num)
\item 
int \hyperlink{_d_h_t_8c_aee23d763e291eefd141227cd9e3684ab}{route\+\_\+tofriend} (const \hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht, const uint8\+\_\+t $\ast$\hyperlink{messenger__test_8c_a5d7925718457bca84bda0952f9463a3c}{friend\+\_\+id}, const uint8\+\_\+t $\ast$packet, uint16\+\_\+t length)
\item 
static int \hyperlink{_d_h_t_8c_ad1a9a37b7cda1411149867eb77070bd1}{routeone\+\_\+tofriend} (\hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht, const uint8\+\_\+t $\ast$\hyperlink{messenger__test_8c_a5d7925718457bca84bda0952f9463a3c}{friend\+\_\+id}, const uint8\+\_\+t $\ast$packet, uint16\+\_\+t length)
\item 
static int \hyperlink{_d_h_t_8c_a25f7b3704b34bb8745a0a60939e1f49c}{send\+\_\+\+N\+A\+Tping} (\hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht, const uint8\+\_\+t $\ast$public\+\_\+key, uint64\+\_\+t ping\+\_\+id, uint8\+\_\+t type)
\item 
static int \hyperlink{_d_h_t_8c_a9684ffd3987f6c79663c1f07eed0c007}{handle\+\_\+\+N\+A\+Tping} (void $\ast$object, \hyperlink{struct_i_p___port}{I\+P\+\_\+\+Port} source, const uint8\+\_\+t $\ast$source\+\_\+pubkey, const uint8\+\_\+t $\ast$packet, uint16\+\_\+t length)
\item 
static \hyperlink{struct_i_p}{I\+P} \hyperlink{_d_h_t_8c_ae24a26ad9533b87cfbcb0093430bf136}{N\+A\+T\+\_\+commonip} (\hyperlink{struct_i_p___port}{I\+P\+\_\+\+Port} $\ast$ip\+\_\+portlist, uint16\+\_\+t len, uint16\+\_\+t min\+\_\+num)
\item 
static uint16\+\_\+t \hyperlink{_d_h_t_8c_a987dbba116d9982c336ea818f05e8c7c}{N\+A\+T\+\_\+getports} (uint16\+\_\+t $\ast$portlist, \hyperlink{struct_i_p___port}{I\+P\+\_\+\+Port} $\ast$ip\+\_\+portlist, uint16\+\_\+t len, \hyperlink{struct_i_p}{I\+P} \hyperlink{irc__syncbot_8c_ae81515e082f9bc33e8968181945586da}{ip})
\item 
static void \hyperlink{_d_h_t_8c_a7efc873280e2d502bf49489d3ebacc9c}{punch\+\_\+holes} (\hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht, \hyperlink{struct_i_p}{I\+P} \hyperlink{irc__syncbot_8c_ae81515e082f9bc33e8968181945586da}{ip}, uint16\+\_\+t $\ast$port\+\_\+list, uint16\+\_\+t numports, uint16\+\_\+t friend\+\_\+num)
\item 
static void \hyperlink{_d_h_t_8c_a9243f57fde4a9312f11575eb4e7b1275}{do\+\_\+\+N\+A\+T} (\hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht)
\item 
static int \hyperlink{_d_h_t_8c_a6461cdeec360ffa10fa03beb6af29aaf}{send\+\_\+hardening\+\_\+req} (\hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht, \hyperlink{struct_node__format}{Node\+\_\+format} $\ast$sendto, uint8\+\_\+t type, uint8\+\_\+t $\ast$contents, uint16\+\_\+t length)
\item 
static int \hyperlink{_d_h_t_8c_a3322fa3865c8dbbcd21b1a9a4955c193}{send\+\_\+hardening\+\_\+getnode\+\_\+req} (\hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht, \hyperlink{struct_node__format}{Node\+\_\+format} $\ast$dest, \hyperlink{struct_node__format}{Node\+\_\+format} $\ast$node\+\_\+totest, uint8\+\_\+t $\ast$search\+\_\+id)
\item 
static \hyperlink{struct_i_p_p_ts_png}{I\+P\+P\+Ts\+Png} $\ast$ \hyperlink{_d_h_t_8c_a0595b79448a6183eba8b2bcd77afcc8a}{get\+\_\+closelist\+\_\+\+I\+P\+P\+Ts\+Png} (\hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht, const uint8\+\_\+t $\ast$public\+\_\+key, sa\+\_\+family\+\_\+t sa\+\_\+family)
\item 
static uint32\+\_\+t \hyperlink{_d_h_t_8c_a014ce120084edcbc79a5fda25820fe1a}{have\+\_\+nodes\+\_\+closelist} (\hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht, \hyperlink{struct_node__format}{Node\+\_\+format} $\ast$nodes, uint16\+\_\+t \hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num})
\item 
static int \hyperlink{_d_h_t_8c_aa38b3670da696f600f37989e79ce4966}{handle\+\_\+hardening} (void $\ast$object, \hyperlink{struct_i_p___port}{I\+P\+\_\+\+Port} source, const uint8\+\_\+t $\ast$source\+\_\+pubkey, const uint8\+\_\+t $\ast$packet, uint16\+\_\+t length)
\item 
\hyperlink{struct_node__format}{Node\+\_\+format} \hyperlink{_d_h_t_8c_af89838d6c1c8e0ec82dfadbe2953e06d}{random\+\_\+node} (\hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht, sa\+\_\+family\+\_\+t sa\+\_\+family)
\item 
uint16\+\_\+t \hyperlink{_d_h_t_8c_a2b03f88384f04514e392abd12ef30140}{closelist\+\_\+nodes} (\hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht, \hyperlink{struct_node__format}{Node\+\_\+format} $\ast$nodes, uint16\+\_\+t max\+\_\+num)
\item 
void \hyperlink{_d_h_t_8c_a9480aac51c9c74c667267ce89a76604a}{do\+\_\+hardening} (\hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht)
\item 
void \hyperlink{_d_h_t_8c_a097913efd03d5106a66c15eb48b0e104}{cryptopacket\+\_\+registerhandler} (\hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht, uint8\+\_\+t byte, \hyperlink{_d_h_t_8h_abf840e82128d3aee3c9fc5ff51e83a14}{cryptopacket\+\_\+handler\+\_\+callback} cb, void $\ast$object)
\item 
static int \hyperlink{_d_h_t_8c_aa8dd9b8abd89728492c0c9c6299c0a8b}{cryptopacket\+\_\+handle} (void $\ast$object, \hyperlink{struct_i_p___port}{I\+P\+\_\+\+Port} source, const uint8\+\_\+t $\ast$packet, uint16\+\_\+t length)
\item 
\hyperlink{struct_d_h_t}{D\+H\+T} $\ast$ \hyperlink{_d_h_t_8c_adad04fa897751b06948a172044bf1c58}{new\+\_\+\+D\+H\+T} (\hyperlink{struct_networking___core}{Networking\+\_\+\+Core} $\ast$net)
\item 
void \hyperlink{_d_h_t_8c_a5be9dfb66fbf1fa7c267b016f3357534}{do\+\_\+\+D\+H\+T} (\hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht)
\item 
void \hyperlink{_d_h_t_8c_a816851e4f0f454c52b93d65544a2b2bb}{kill\+\_\+\+D\+H\+T} (\hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht)
\item 
uint32\+\_\+t \hyperlink{_d_h_t_8c_a55d92a2419bf9384e3cbfe0ec5a8f4d6}{D\+H\+T\+\_\+size} (const \hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht)
\item 
static uint8\+\_\+t $\ast$ \hyperlink{_d_h_t_8c_a910e4555ff14d9974e6f1dd227d8dd99}{z\+\_\+state\+\_\+save\+\_\+subheader} (uint8\+\_\+t $\ast$data, uint32\+\_\+t len, uint16\+\_\+t type)
\item 
void \hyperlink{_d_h_t_8c_a7510a9fdbacfffb5987590c4e193c40a}{D\+H\+T\+\_\+save} (\hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht, uint8\+\_\+t $\ast$data)
\item 
int \hyperlink{_d_h_t_8c_ad5df2ff5066cf93898e531d320ddd675}{D\+H\+T\+\_\+connect\+\_\+after\+\_\+load} (\hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht)
\item 
static int \hyperlink{_d_h_t_8c_a266c420f5eb745eddcf184e316b157be}{dht\+\_\+load\+\_\+state\+\_\+callback} (void $\ast$outer, const uint8\+\_\+t $\ast$data, uint32\+\_\+t length, uint16\+\_\+t type)
\item 
int \hyperlink{_d_h_t_8c_a36e42ad71b293cd0ada8a7b6de9ad86b}{D\+H\+T\+\_\+load} (\hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht, const uint8\+\_\+t $\ast$data, uint32\+\_\+t length)
\item 
int \hyperlink{_d_h_t_8c_a93770fe498d41d1c6b420275680967b6}{D\+H\+T\+\_\+isconnected} (const \hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht)
\item 
int \hyperlink{_d_h_t_8c_a90cd93b83fdec619c4924fd20c4fc005}{D\+H\+T\+\_\+non\+\_\+lan\+\_\+connected} (const \hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht)
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
static uint8\+\_\+t \hyperlink{_d_h_t_8c_a3551f15862efa7b58779722fe9763c45}{cmp\+\_\+public\+\_\+key} \mbox{[}crypto\+\_\+box\+\_\+\+P\+U\+B\+L\+I\+C\+K\+E\+Y\+B\+Y\+T\+E\+S\mbox{]}
\end{DoxyCompactItemize}


\subsection{Macro Definition Documentation}
\hypertarget{_d_h_t_8c_ac582451ce11946977a1feec8591f7aa1}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!C\+H\+E\+C\+K\+\_\+\+T\+Y\+P\+E\+\_\+\+G\+E\+T\+N\+O\+D\+E\+\_\+\+R\+E\+Q@{C\+H\+E\+C\+K\+\_\+\+T\+Y\+P\+E\+\_\+\+G\+E\+T\+N\+O\+D\+E\+\_\+\+R\+E\+Q}}
\index{C\+H\+E\+C\+K\+\_\+\+T\+Y\+P\+E\+\_\+\+G\+E\+T\+N\+O\+D\+E\+\_\+\+R\+E\+Q@{C\+H\+E\+C\+K\+\_\+\+T\+Y\+P\+E\+\_\+\+G\+E\+T\+N\+O\+D\+E\+\_\+\+R\+E\+Q}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{C\+H\+E\+C\+K\+\_\+\+T\+Y\+P\+E\+\_\+\+G\+E\+T\+N\+O\+D\+E\+\_\+\+R\+E\+Q}]{\setlength{\rightskip}{0pt plus 5cm}\#define C\+H\+E\+C\+K\+\_\+\+T\+Y\+P\+E\+\_\+\+G\+E\+T\+N\+O\+D\+E\+\_\+\+R\+E\+Q~2}}\label{_d_h_t_8c_ac582451ce11946977a1feec8591f7aa1}


Definition at line 1871 of file D\+H\+T.\+c.



Referenced by handle\+\_\+hardening(), and send\+\_\+hardening\+\_\+getnode\+\_\+req().

\hypertarget{_d_h_t_8c_a4388a18c5f38b8aa28e413a6762a6444}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!C\+H\+E\+C\+K\+\_\+\+T\+Y\+P\+E\+\_\+\+G\+E\+T\+N\+O\+D\+E\+\_\+\+R\+E\+S@{C\+H\+E\+C\+K\+\_\+\+T\+Y\+P\+E\+\_\+\+G\+E\+T\+N\+O\+D\+E\+\_\+\+R\+E\+S}}
\index{C\+H\+E\+C\+K\+\_\+\+T\+Y\+P\+E\+\_\+\+G\+E\+T\+N\+O\+D\+E\+\_\+\+R\+E\+S@{C\+H\+E\+C\+K\+\_\+\+T\+Y\+P\+E\+\_\+\+G\+E\+T\+N\+O\+D\+E\+\_\+\+R\+E\+S}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{C\+H\+E\+C\+K\+\_\+\+T\+Y\+P\+E\+\_\+\+G\+E\+T\+N\+O\+D\+E\+\_\+\+R\+E\+S}]{\setlength{\rightskip}{0pt plus 5cm}\#define C\+H\+E\+C\+K\+\_\+\+T\+Y\+P\+E\+\_\+\+G\+E\+T\+N\+O\+D\+E\+\_\+\+R\+E\+S~3}}\label{_d_h_t_8c_a4388a18c5f38b8aa28e413a6762a6444}


Definition at line 1872 of file D\+H\+T.\+c.



Referenced by handle\+\_\+hardening(), and send\+\_\+hardening\+\_\+getnode\+\_\+res().

\hypertarget{_d_h_t_8c_a21dd514df24c1d833d4e024513ac3bae}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!C\+H\+E\+C\+K\+\_\+\+T\+Y\+P\+E\+\_\+\+R\+O\+U\+T\+E\+\_\+\+R\+E\+Q@{C\+H\+E\+C\+K\+\_\+\+T\+Y\+P\+E\+\_\+\+R\+O\+U\+T\+E\+\_\+\+R\+E\+Q}}
\index{C\+H\+E\+C\+K\+\_\+\+T\+Y\+P\+E\+\_\+\+R\+O\+U\+T\+E\+\_\+\+R\+E\+Q@{C\+H\+E\+C\+K\+\_\+\+T\+Y\+P\+E\+\_\+\+R\+O\+U\+T\+E\+\_\+\+R\+E\+Q}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{C\+H\+E\+C\+K\+\_\+\+T\+Y\+P\+E\+\_\+\+R\+O\+U\+T\+E\+\_\+\+R\+E\+Q}]{\setlength{\rightskip}{0pt plus 5cm}\#define C\+H\+E\+C\+K\+\_\+\+T\+Y\+P\+E\+\_\+\+R\+O\+U\+T\+E\+\_\+\+R\+E\+Q~0}}\label{_d_h_t_8c_a21dd514df24c1d833d4e024513ac3bae}


Definition at line 1869 of file D\+H\+T.\+c.

\hypertarget{_d_h_t_8c_a22a8e95d63ebd6b8b8e627fdd12ef677}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!C\+H\+E\+C\+K\+\_\+\+T\+Y\+P\+E\+\_\+\+R\+O\+U\+T\+E\+\_\+\+R\+E\+S@{C\+H\+E\+C\+K\+\_\+\+T\+Y\+P\+E\+\_\+\+R\+O\+U\+T\+E\+\_\+\+R\+E\+S}}
\index{C\+H\+E\+C\+K\+\_\+\+T\+Y\+P\+E\+\_\+\+R\+O\+U\+T\+E\+\_\+\+R\+E\+S@{C\+H\+E\+C\+K\+\_\+\+T\+Y\+P\+E\+\_\+\+R\+O\+U\+T\+E\+\_\+\+R\+E\+S}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{C\+H\+E\+C\+K\+\_\+\+T\+Y\+P\+E\+\_\+\+R\+O\+U\+T\+E\+\_\+\+R\+E\+S}]{\setlength{\rightskip}{0pt plus 5cm}\#define C\+H\+E\+C\+K\+\_\+\+T\+Y\+P\+E\+\_\+\+R\+O\+U\+T\+E\+\_\+\+R\+E\+S~1}}\label{_d_h_t_8c_a22a8e95d63ebd6b8b8e627fdd12ef677}


Definition at line 1870 of file D\+H\+T.\+c.

\hypertarget{_d_h_t_8c_ab8829f898d28ca6202d33cdbb85ccec5}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!C\+H\+E\+C\+K\+\_\+\+T\+Y\+P\+E\+\_\+\+T\+E\+S\+T\+\_\+\+R\+E\+Q@{C\+H\+E\+C\+K\+\_\+\+T\+Y\+P\+E\+\_\+\+T\+E\+S\+T\+\_\+\+R\+E\+Q}}
\index{C\+H\+E\+C\+K\+\_\+\+T\+Y\+P\+E\+\_\+\+T\+E\+S\+T\+\_\+\+R\+E\+Q@{C\+H\+E\+C\+K\+\_\+\+T\+Y\+P\+E\+\_\+\+T\+E\+S\+T\+\_\+\+R\+E\+Q}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{C\+H\+E\+C\+K\+\_\+\+T\+Y\+P\+E\+\_\+\+T\+E\+S\+T\+\_\+\+R\+E\+Q}]{\setlength{\rightskip}{0pt plus 5cm}\#define C\+H\+E\+C\+K\+\_\+\+T\+Y\+P\+E\+\_\+\+T\+E\+S\+T\+\_\+\+R\+E\+Q~4}}\label{_d_h_t_8c_ab8829f898d28ca6202d33cdbb85ccec5}


Definition at line 1873 of file D\+H\+T.\+c.

\hypertarget{_d_h_t_8c_aa08e3084aae64c11ed98a3373fa3fcc8}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!C\+H\+E\+C\+K\+\_\+\+T\+Y\+P\+E\+\_\+\+T\+E\+S\+T\+\_\+\+R\+E\+S@{C\+H\+E\+C\+K\+\_\+\+T\+Y\+P\+E\+\_\+\+T\+E\+S\+T\+\_\+\+R\+E\+S}}
\index{C\+H\+E\+C\+K\+\_\+\+T\+Y\+P\+E\+\_\+\+T\+E\+S\+T\+\_\+\+R\+E\+S@{C\+H\+E\+C\+K\+\_\+\+T\+Y\+P\+E\+\_\+\+T\+E\+S\+T\+\_\+\+R\+E\+S}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{C\+H\+E\+C\+K\+\_\+\+T\+Y\+P\+E\+\_\+\+T\+E\+S\+T\+\_\+\+R\+E\+S}]{\setlength{\rightskip}{0pt plus 5cm}\#define C\+H\+E\+C\+K\+\_\+\+T\+Y\+P\+E\+\_\+\+T\+E\+S\+T\+\_\+\+R\+E\+S~5}}\label{_d_h_t_8c_aa08e3084aae64c11ed98a3373fa3fcc8}


Definition at line 1874 of file D\+H\+T.\+c.

\hypertarget{_d_h_t_8c_a6a842db82e30616af13990781cf13ab3}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!D\+H\+T\+\_\+\+S\+T\+A\+T\+E\+\_\+\+C\+O\+O\+K\+I\+E\+\_\+\+G\+L\+O\+B\+A\+L@{D\+H\+T\+\_\+\+S\+T\+A\+T\+E\+\_\+\+C\+O\+O\+K\+I\+E\+\_\+\+G\+L\+O\+B\+A\+L}}
\index{D\+H\+T\+\_\+\+S\+T\+A\+T\+E\+\_\+\+C\+O\+O\+K\+I\+E\+\_\+\+G\+L\+O\+B\+A\+L@{D\+H\+T\+\_\+\+S\+T\+A\+T\+E\+\_\+\+C\+O\+O\+K\+I\+E\+\_\+\+G\+L\+O\+B\+A\+L}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{D\+H\+T\+\_\+\+S\+T\+A\+T\+E\+\_\+\+C\+O\+O\+K\+I\+E\+\_\+\+G\+L\+O\+B\+A\+L}]{\setlength{\rightskip}{0pt plus 5cm}\#define D\+H\+T\+\_\+\+S\+T\+A\+T\+E\+\_\+\+C\+O\+O\+K\+I\+E\+\_\+\+G\+L\+O\+B\+A\+L~0x159000d}}\label{_d_h_t_8c_a6a842db82e30616af13990781cf13ab3}


Definition at line 2287 of file D\+H\+T.\+c.



Referenced by D\+H\+T\+\_\+load(), and D\+H\+T\+\_\+save().

\hypertarget{_d_h_t_8c_a48a9324191a79b2e05af9b6499addba6}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!D\+H\+T\+\_\+\+S\+T\+A\+T\+E\+\_\+\+C\+O\+O\+K\+I\+E\+\_\+\+T\+Y\+P\+E@{D\+H\+T\+\_\+\+S\+T\+A\+T\+E\+\_\+\+C\+O\+O\+K\+I\+E\+\_\+\+T\+Y\+P\+E}}
\index{D\+H\+T\+\_\+\+S\+T\+A\+T\+E\+\_\+\+C\+O\+O\+K\+I\+E\+\_\+\+T\+Y\+P\+E@{D\+H\+T\+\_\+\+S\+T\+A\+T\+E\+\_\+\+C\+O\+O\+K\+I\+E\+\_\+\+T\+Y\+P\+E}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{D\+H\+T\+\_\+\+S\+T\+A\+T\+E\+\_\+\+C\+O\+O\+K\+I\+E\+\_\+\+T\+Y\+P\+E}]{\setlength{\rightskip}{0pt plus 5cm}\#define D\+H\+T\+\_\+\+S\+T\+A\+T\+E\+\_\+\+C\+O\+O\+K\+I\+E\+\_\+\+T\+Y\+P\+E~0x11ce}}\label{_d_h_t_8c_a48a9324191a79b2e05af9b6499addba6}


Definition at line 2289 of file D\+H\+T.\+c.



Referenced by D\+H\+T\+\_\+load(), and z\+\_\+state\+\_\+save\+\_\+subheader().

\hypertarget{_d_h_t_8c_a2244b83e3fbf401e240bb5fa9a576e9e}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!D\+H\+T\+\_\+\+S\+T\+A\+T\+E\+\_\+\+T\+Y\+P\+E\+\_\+\+N\+O\+D\+E\+S@{D\+H\+T\+\_\+\+S\+T\+A\+T\+E\+\_\+\+T\+Y\+P\+E\+\_\+\+N\+O\+D\+E\+S}}
\index{D\+H\+T\+\_\+\+S\+T\+A\+T\+E\+\_\+\+T\+Y\+P\+E\+\_\+\+N\+O\+D\+E\+S@{D\+H\+T\+\_\+\+S\+T\+A\+T\+E\+\_\+\+T\+Y\+P\+E\+\_\+\+N\+O\+D\+E\+S}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{D\+H\+T\+\_\+\+S\+T\+A\+T\+E\+\_\+\+T\+Y\+P\+E\+\_\+\+N\+O\+D\+E\+S}]{\setlength{\rightskip}{0pt plus 5cm}\#define D\+H\+T\+\_\+\+S\+T\+A\+T\+E\+\_\+\+T\+Y\+P\+E\+\_\+\+N\+O\+D\+E\+S~4}}\label{_d_h_t_8c_a2244b83e3fbf401e240bb5fa9a576e9e}


Definition at line 2290 of file D\+H\+T.\+c.



Referenced by dht\+\_\+load\+\_\+state\+\_\+callback(), and D\+H\+T\+\_\+save().

\hypertarget{_d_h_t_8c_a5743fd97642ab4b5cc04e9e19c82e0f3}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!G\+E\+T\+\_\+\+N\+O\+D\+E\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L@{G\+E\+T\+\_\+\+N\+O\+D\+E\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L}}
\index{G\+E\+T\+\_\+\+N\+O\+D\+E\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L@{G\+E\+T\+\_\+\+N\+O\+D\+E\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{G\+E\+T\+\_\+\+N\+O\+D\+E\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L}]{\setlength{\rightskip}{0pt plus 5cm}\#define G\+E\+T\+\_\+\+N\+O\+D\+E\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L~20}}\label{_d_h_t_8c_a5743fd97642ab4b5cc04e9e19c82e0f3}


Definition at line 53 of file D\+H\+T.\+c.



Referenced by do\+\_\+ping\+\_\+and\+\_\+sendnode\+\_\+requests().

\hypertarget{_d_h_t_8c_a916b8aad63b31d6308952fa4bf526b09}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!H\+A\+R\+D\+E\+N\+\_\+\+T\+I\+M\+E\+O\+U\+T@{H\+A\+R\+D\+E\+N\+\_\+\+T\+I\+M\+E\+O\+U\+T}}
\index{H\+A\+R\+D\+E\+N\+\_\+\+T\+I\+M\+E\+O\+U\+T@{H\+A\+R\+D\+E\+N\+\_\+\+T\+I\+M\+E\+O\+U\+T}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{H\+A\+R\+D\+E\+N\+\_\+\+T\+I\+M\+E\+O\+U\+T}]{\setlength{\rightskip}{0pt plus 5cm}\#define H\+A\+R\+D\+E\+N\+\_\+\+T\+I\+M\+E\+O\+U\+T~1200}}\label{_d_h_t_8c_a916b8aad63b31d6308952fa4bf526b09}


Definition at line 1971 of file D\+H\+T.\+c.



Referenced by do\+\_\+hardening().

\hypertarget{_d_h_t_8c_a26075b69d14a1c08617bdb49aaf22ade}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!H\+A\+R\+D\+E\+N\+I\+N\+G\+\_\+\+A\+L\+L\+\_\+\+O\+K@{H\+A\+R\+D\+E\+N\+I\+N\+G\+\_\+\+A\+L\+L\+\_\+\+O\+K}}
\index{H\+A\+R\+D\+E\+N\+I\+N\+G\+\_\+\+A\+L\+L\+\_\+\+O\+K@{H\+A\+R\+D\+E\+N\+I\+N\+G\+\_\+\+A\+L\+L\+\_\+\+O\+K}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{H\+A\+R\+D\+E\+N\+I\+N\+G\+\_\+\+A\+L\+L\+\_\+\+O\+K}]{\setlength{\rightskip}{0pt plus 5cm}\#define H\+A\+R\+D\+E\+N\+I\+N\+G\+\_\+\+A\+L\+L\+\_\+\+O\+K~2}}\label{_d_h_t_8c_a26075b69d14a1c08617bdb49aaf22ade}


Definition at line 450 of file D\+H\+T.\+c.



Referenced by cmp\+\_\+dht\+\_\+entry(), get\+\_\+close\+\_\+nodes\+\_\+inner(), and mark\+\_\+good().

\hypertarget{_d_h_t_8c_aa2f9a8d6135222d3875900ba8ef11e11}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!H\+A\+R\+D\+E\+N\+I\+N\+G\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L@{H\+A\+R\+D\+E\+N\+I\+N\+G\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L}}
\index{H\+A\+R\+D\+E\+N\+I\+N\+G\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L@{H\+A\+R\+D\+E\+N\+I\+N\+G\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{H\+A\+R\+D\+E\+N\+I\+N\+G\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L}]{\setlength{\rightskip}{0pt plus 5cm}\#define H\+A\+R\+D\+E\+N\+I\+N\+G\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L~120}}\label{_d_h_t_8c_aa2f9a8d6135222d3875900ba8ef11e11}


Definition at line 1970 of file D\+H\+T.\+c.



Referenced by do\+\_\+hardening(), and handle\+\_\+hardening().

\hypertarget{_d_h_t_8c_a207dfa01a1f5f59c613d2202843bef3c}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!H\+A\+R\+D\+R\+E\+Q\+\_\+\+D\+A\+T\+A\+\_\+\+S\+I\+Z\+E@{H\+A\+R\+D\+R\+E\+Q\+\_\+\+D\+A\+T\+A\+\_\+\+S\+I\+Z\+E}}
\index{H\+A\+R\+D\+R\+E\+Q\+\_\+\+D\+A\+T\+A\+\_\+\+S\+I\+Z\+E@{H\+A\+R\+D\+R\+E\+Q\+\_\+\+D\+A\+T\+A\+\_\+\+S\+I\+Z\+E}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{H\+A\+R\+D\+R\+E\+Q\+\_\+\+D\+A\+T\+A\+\_\+\+S\+I\+Z\+E}]{\setlength{\rightskip}{0pt plus 5cm}\#define H\+A\+R\+D\+R\+E\+Q\+\_\+\+D\+A\+T\+A\+\_\+\+S\+I\+Z\+E~384 /$\ast$ Attempt to prevent amplification/other attacks$\ast$/}}\label{_d_h_t_8c_a207dfa01a1f5f59c613d2202843bef3c}


Definition at line 1867 of file D\+H\+T.\+c.



Referenced by handle\+\_\+hardening(), and send\+\_\+hardening\+\_\+req().

\hypertarget{_d_h_t_8c_af1093baf3868bd51244122ec59316304}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!K\+I\+L\+L\+\_\+\+N\+O\+D\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T@{K\+I\+L\+L\+\_\+\+N\+O\+D\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T}}
\index{K\+I\+L\+L\+\_\+\+N\+O\+D\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T@{K\+I\+L\+L\+\_\+\+N\+O\+D\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{K\+I\+L\+L\+\_\+\+N\+O\+D\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T}]{\setlength{\rightskip}{0pt plus 5cm}\#define K\+I\+L\+L\+\_\+\+N\+O\+D\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T~({\bf B\+A\+D\+\_\+\+N\+O\+D\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T} + {\bf P\+I\+N\+G\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L})}}\label{_d_h_t_8c_af1093baf3868bd51244122ec59316304}


Definition at line 50 of file D\+H\+T.\+c.



Referenced by do\+\_\+ping\+\_\+and\+\_\+sendnode\+\_\+requests().

\hypertarget{_d_h_t_8c_ad54cdfc53c7a3f71e4f5dbfe22e84058}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!M\+A\+X\+\_\+\+B\+O\+O\+T\+S\+T\+R\+A\+P\+\_\+\+T\+I\+M\+E\+S@{M\+A\+X\+\_\+\+B\+O\+O\+T\+S\+T\+R\+A\+P\+\_\+\+T\+I\+M\+E\+S}}
\index{M\+A\+X\+\_\+\+B\+O\+O\+T\+S\+T\+R\+A\+P\+\_\+\+T\+I\+M\+E\+S@{M\+A\+X\+\_\+\+B\+O\+O\+T\+S\+T\+R\+A\+P\+\_\+\+T\+I\+M\+E\+S}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{M\+A\+X\+\_\+\+B\+O\+O\+T\+S\+T\+R\+A\+P\+\_\+\+T\+I\+M\+E\+S}]{\setlength{\rightskip}{0pt plus 5cm}\#define M\+A\+X\+\_\+\+B\+O\+O\+T\+S\+T\+R\+A\+P\+\_\+\+T\+I\+M\+E\+S~10}}\label{_d_h_t_8c_ad54cdfc53c7a3f71e4f5dbfe22e84058}


Definition at line 66 of file D\+H\+T.\+c.



Referenced by do\+\_\+ping\+\_\+and\+\_\+sendnode\+\_\+requests().

\hypertarget{_d_h_t_8c_a47f5811ec6dd12a1a14d7f44c717b5f1}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!M\+A\+X\+\_\+\+N\+O\+R\+M\+A\+L\+\_\+\+P\+U\+N\+C\+H\+I\+N\+G\+\_\+\+T\+R\+I\+E\+S@{M\+A\+X\+\_\+\+N\+O\+R\+M\+A\+L\+\_\+\+P\+U\+N\+C\+H\+I\+N\+G\+\_\+\+T\+R\+I\+E\+S}}
\index{M\+A\+X\+\_\+\+N\+O\+R\+M\+A\+L\+\_\+\+P\+U\+N\+C\+H\+I\+N\+G\+\_\+\+T\+R\+I\+E\+S@{M\+A\+X\+\_\+\+N\+O\+R\+M\+A\+L\+\_\+\+P\+U\+N\+C\+H\+I\+N\+G\+\_\+\+T\+R\+I\+E\+S}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{M\+A\+X\+\_\+\+N\+O\+R\+M\+A\+L\+\_\+\+P\+U\+N\+C\+H\+I\+N\+G\+\_\+\+T\+R\+I\+E\+S}]{\setlength{\rightskip}{0pt plus 5cm}\#define M\+A\+X\+\_\+\+N\+O\+R\+M\+A\+L\+\_\+\+P\+U\+N\+C\+H\+I\+N\+G\+\_\+\+T\+R\+I\+E\+S~5}}\label{_d_h_t_8c_a47f5811ec6dd12a1a14d7f44c717b5f1}


Definition at line 60 of file D\+H\+T.\+c.



Referenced by punch\+\_\+holes().

\hypertarget{_d_h_t_8c_aa26d44826e51b690cac89a8e81b53710}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!M\+A\+X\+\_\+\+P\+U\+N\+C\+H\+I\+N\+G\+\_\+\+P\+O\+R\+T\+S@{M\+A\+X\+\_\+\+P\+U\+N\+C\+H\+I\+N\+G\+\_\+\+P\+O\+R\+T\+S}}
\index{M\+A\+X\+\_\+\+P\+U\+N\+C\+H\+I\+N\+G\+\_\+\+P\+O\+R\+T\+S@{M\+A\+X\+\_\+\+P\+U\+N\+C\+H\+I\+N\+G\+\_\+\+P\+O\+R\+T\+S}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{M\+A\+X\+\_\+\+P\+U\+N\+C\+H\+I\+N\+G\+\_\+\+P\+O\+R\+T\+S}]{\setlength{\rightskip}{0pt plus 5cm}\#define M\+A\+X\+\_\+\+P\+U\+N\+C\+H\+I\+N\+G\+\_\+\+P\+O\+R\+T\+S~48}}\label{_d_h_t_8c_aa26d44826e51b690cac89a8e81b53710}


Definition at line 55 of file D\+H\+T.\+c.



Referenced by punch\+\_\+holes().

\hypertarget{_d_h_t_8c_a4ebd02f5b13bf2d343bef7c55b88ef93}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!M\+A\+X\+\_\+\+S\+A\+V\+E\+D\+\_\+\+D\+H\+T\+\_\+\+N\+O\+D\+E\+S@{M\+A\+X\+\_\+\+S\+A\+V\+E\+D\+\_\+\+D\+H\+T\+\_\+\+N\+O\+D\+E\+S}}
\index{M\+A\+X\+\_\+\+S\+A\+V\+E\+D\+\_\+\+D\+H\+T\+\_\+\+N\+O\+D\+E\+S@{M\+A\+X\+\_\+\+S\+A\+V\+E\+D\+\_\+\+D\+H\+T\+\_\+\+N\+O\+D\+E\+S}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{M\+A\+X\+\_\+\+S\+A\+V\+E\+D\+\_\+\+D\+H\+T\+\_\+\+N\+O\+D\+E\+S}]{\setlength{\rightskip}{0pt plus 5cm}\#define M\+A\+X\+\_\+\+S\+A\+V\+E\+D\+\_\+\+D\+H\+T\+\_\+\+N\+O\+D\+E\+S~((({\bf D\+H\+T\+\_\+\+F\+A\+K\+E\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+N\+U\+M\+B\+E\+R} $\ast$ {\bf M\+A\+X\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+C\+L\+I\+E\+N\+T\+S}) + {\bf L\+C\+L\+I\+E\+N\+T\+\_\+\+L\+I\+S\+T}) $\ast$ 2)}}\label{_d_h_t_8c_a4ebd02f5b13bf2d343bef7c55b88ef93}


Definition at line 2292 of file D\+H\+T.\+c.



Referenced by dht\+\_\+load\+\_\+state\+\_\+callback(), and D\+H\+T\+\_\+save().

\hypertarget{_d_h_t_8c_a2c654c475c840fc796772eef9079930f}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!N\+A\+T\+\_\+\+P\+I\+N\+G\+\_\+\+R\+E\+Q\+U\+E\+S\+T@{N\+A\+T\+\_\+\+P\+I\+N\+G\+\_\+\+R\+E\+Q\+U\+E\+S\+T}}
\index{N\+A\+T\+\_\+\+P\+I\+N\+G\+\_\+\+R\+E\+Q\+U\+E\+S\+T@{N\+A\+T\+\_\+\+P\+I\+N\+G\+\_\+\+R\+E\+Q\+U\+E\+S\+T}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{N\+A\+T\+\_\+\+P\+I\+N\+G\+\_\+\+R\+E\+Q\+U\+E\+S\+T}]{\setlength{\rightskip}{0pt plus 5cm}\#define N\+A\+T\+\_\+\+P\+I\+N\+G\+\_\+\+R\+E\+Q\+U\+E\+S\+T~0}}\label{_d_h_t_8c_a2c654c475c840fc796772eef9079930f}


Definition at line 62 of file D\+H\+T.\+c.



Referenced by do\+\_\+\+N\+A\+T(), and handle\+\_\+\+N\+A\+Tping().

\hypertarget{_d_h_t_8c_a88eacf49971603509097ad0a46d7d9ff}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!N\+A\+T\+\_\+\+P\+I\+N\+G\+\_\+\+R\+E\+S\+P\+O\+N\+S\+E@{N\+A\+T\+\_\+\+P\+I\+N\+G\+\_\+\+R\+E\+S\+P\+O\+N\+S\+E}}
\index{N\+A\+T\+\_\+\+P\+I\+N\+G\+\_\+\+R\+E\+S\+P\+O\+N\+S\+E@{N\+A\+T\+\_\+\+P\+I\+N\+G\+\_\+\+R\+E\+S\+P\+O\+N\+S\+E}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{N\+A\+T\+\_\+\+P\+I\+N\+G\+\_\+\+R\+E\+S\+P\+O\+N\+S\+E}]{\setlength{\rightskip}{0pt plus 5cm}\#define N\+A\+T\+\_\+\+P\+I\+N\+G\+\_\+\+R\+E\+S\+P\+O\+N\+S\+E~1}}\label{_d_h_t_8c_a88eacf49971603509097ad0a46d7d9ff}


Definition at line 63 of file D\+H\+T.\+c.



Referenced by handle\+\_\+\+N\+A\+Tping().

\hypertarget{_d_h_t_8c_a03601baefa220335487dfc838c08d268}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!P\+A\+C\+K\+E\+D\+\_\+\+N\+O\+D\+E\+\_\+\+S\+I\+Z\+E\+\_\+\+I\+P4@{P\+A\+C\+K\+E\+D\+\_\+\+N\+O\+D\+E\+\_\+\+S\+I\+Z\+E\+\_\+\+I\+P4}}
\index{P\+A\+C\+K\+E\+D\+\_\+\+N\+O\+D\+E\+\_\+\+S\+I\+Z\+E\+\_\+\+I\+P4@{P\+A\+C\+K\+E\+D\+\_\+\+N\+O\+D\+E\+\_\+\+S\+I\+Z\+E\+\_\+\+I\+P4}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{P\+A\+C\+K\+E\+D\+\_\+\+N\+O\+D\+E\+\_\+\+S\+I\+Z\+E\+\_\+\+I\+P4}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\+A\+C\+K\+E\+D\+\_\+\+N\+O\+D\+E\+\_\+\+S\+I\+Z\+E\+\_\+\+I\+P4~(1 + {\bf S\+I\+Z\+E\+\_\+\+I\+P4} + sizeof(uint16\+\_\+t) + crypto\+\_\+box\+\_\+\+P\+U\+B\+L\+I\+C\+K\+E\+Y\+B\+Y\+T\+E\+S)}}\label{_d_h_t_8c_a03601baefa220335487dfc838c08d268}


Definition at line 180 of file D\+H\+T.\+c.



Referenced by pack\+\_\+nodes(), packed\+\_\+node\+\_\+size(), and unpack\+\_\+nodes().

\hypertarget{_d_h_t_8c_a9b47e23b0610a17f01902680f55d7963}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!P\+A\+C\+K\+E\+D\+\_\+\+N\+O\+D\+E\+\_\+\+S\+I\+Z\+E\+\_\+\+I\+P6@{P\+A\+C\+K\+E\+D\+\_\+\+N\+O\+D\+E\+\_\+\+S\+I\+Z\+E\+\_\+\+I\+P6}}
\index{P\+A\+C\+K\+E\+D\+\_\+\+N\+O\+D\+E\+\_\+\+S\+I\+Z\+E\+\_\+\+I\+P6@{P\+A\+C\+K\+E\+D\+\_\+\+N\+O\+D\+E\+\_\+\+S\+I\+Z\+E\+\_\+\+I\+P6}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{P\+A\+C\+K\+E\+D\+\_\+\+N\+O\+D\+E\+\_\+\+S\+I\+Z\+E\+\_\+\+I\+P6}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\+A\+C\+K\+E\+D\+\_\+\+N\+O\+D\+E\+\_\+\+S\+I\+Z\+E\+\_\+\+I\+P6~(1 + {\bf S\+I\+Z\+E\+\_\+\+I\+P6} + sizeof(uint16\+\_\+t) + crypto\+\_\+box\+\_\+\+P\+U\+B\+L\+I\+C\+K\+E\+Y\+B\+Y\+T\+E\+S)}}\label{_d_h_t_8c_a9b47e23b0610a17f01902680f55d7963}


Definition at line 181 of file D\+H\+T.\+c.



Referenced by pack\+\_\+nodes(), packed\+\_\+node\+\_\+size(), and unpack\+\_\+nodes().

\hypertarget{_d_h_t_8c_afb88902dba0294dd97d42384ceacafa3}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!P\+U\+N\+C\+H\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L@{P\+U\+N\+C\+H\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L}}
\index{P\+U\+N\+C\+H\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L@{P\+U\+N\+C\+H\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{P\+U\+N\+C\+H\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\+U\+N\+C\+H\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L~3}}\label{_d_h_t_8c_afb88902dba0294dd97d42384ceacafa3}


Definition at line 58 of file D\+H\+T.\+c.



Referenced by do\+\_\+\+N\+A\+T().

\hypertarget{_d_h_t_8c_a696df5fcb740674dfec58340660641be}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!S\+A\+V\+E\+\_\+\+B\+O\+O\+T\+S\+T\+A\+P\+\_\+\+F\+R\+E\+Q\+U\+E\+N\+C\+Y@{S\+A\+V\+E\+\_\+\+B\+O\+O\+T\+S\+T\+A\+P\+\_\+\+F\+R\+E\+Q\+U\+E\+N\+C\+Y}}
\index{S\+A\+V\+E\+\_\+\+B\+O\+O\+T\+S\+T\+A\+P\+\_\+\+F\+R\+E\+Q\+U\+E\+N\+C\+Y@{S\+A\+V\+E\+\_\+\+B\+O\+O\+T\+S\+T\+A\+P\+\_\+\+F\+R\+E\+Q\+U\+E\+N\+C\+Y}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{S\+A\+V\+E\+\_\+\+B\+O\+O\+T\+S\+T\+A\+P\+\_\+\+F\+R\+E\+Q\+U\+E\+N\+C\+Y}]{\setlength{\rightskip}{0pt plus 5cm}\#define S\+A\+V\+E\+\_\+\+B\+O\+O\+T\+S\+T\+A\+P\+\_\+\+F\+R\+E\+Q\+U\+E\+N\+C\+Y~8}}\label{_d_h_t_8c_a696df5fcb740674dfec58340660641be}


Definition at line 2379 of file D\+H\+T.\+c.



Referenced by D\+H\+T\+\_\+connect\+\_\+after\+\_\+load().



\subsection{Function Documentation}
\hypertarget{_d_h_t_8c_a9d898065db0fd4adf26fdb7f80e6d7ac}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!addto\+\_\+lists@{addto\+\_\+lists}}
\index{addto\+\_\+lists@{addto\+\_\+lists}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{addto\+\_\+lists}]{\setlength{\rightskip}{0pt plus 5cm}int addto\+\_\+lists (
\begin{DoxyParamCaption}
\item[{{\bf D\+H\+T} $\ast$}]{dht, }
\item[{{\bf I\+P\+\_\+\+Port}}]{ip\+\_\+port, }
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key}
\end{DoxyParamCaption}
)}}\label{_d_h_t_8c_a9d898065db0fd4adf26fdb7f80e6d7ac}


Definition at line 771 of file D\+H\+T.\+c.



References Assoc\+\_\+add\+\_\+entry(), D\+H\+T\+\_\+\+Friend\+::callbacks, D\+H\+T\+\_\+\+Friend\+::client\+\_\+list, client\+\_\+or\+\_\+ip\+\_\+port\+\_\+in\+\_\+list(), D\+H\+T\+::close\+\_\+clientlist, D\+H\+T\+\_\+\+Friend\+::data, I\+P\+::family, D\+H\+T\+::friends\+\_\+list, i, I\+P\+\_\+\+Port\+::ip, I\+P\+::ip4, I\+P\+::ip6, D\+H\+T\+\_\+\+Friend\+::ip\+\_\+callback, I\+P\+P\+Ts\+::ip\+\_\+port, I\+P\+V6\+\_\+\+I\+P\+V4\+\_\+\+I\+N\+\_\+\+V6, L\+C\+L\+I\+E\+N\+T\+\_\+\+L\+I\+S\+T, D\+H\+T\+\_\+\+Friend\+::lock\+\_\+count, M\+A\+X\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+C\+L\+I\+E\+N\+T\+S, D\+H\+T\+::num\+\_\+friends, D\+H\+T\+\_\+\+Friend\+::number, D\+H\+T\+\_\+\+Friend\+::public\+\_\+key, replace\+\_\+all(), D\+H\+T\+::self\+\_\+public\+\_\+key, I\+P\+P\+Ts\+::timestamp, I\+P4\+::uint32, I\+P6\+::uint32, and unix\+\_\+time().



Referenced by handle\+\_\+ping\+\_\+response(), handle\+\_\+sendnodes\+\_\+core(), test\+\_\+addto\+\_\+lists(), test\+\_\+addto\+\_\+lists\+\_\+bad(), test\+\_\+addto\+\_\+lists\+\_\+good(), test\+\_\+addto\+\_\+lists\+\_\+possible\+\_\+bad(), and test\+\_\+addto\+\_\+lists\+\_\+update().


\begin{DoxyCode}
772 \{
773     uint32\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}, used = 0;
774 
775     \textcolor{comment}{/* convert IPv4-in-IPv6 to IPv4 */}
776     \textcolor{keywordflow}{if} ((ip\_port.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} == AF\_INET6) && \hyperlink{network_8h_aaaf5ca9c91edc4f8a7529206d7799805}{IPV6\_IPV4\_IN\_V6}(ip\_port.
      \hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_a14c606eb5ffb078c38ad854dc4e79507}{ip6})) \{
777         ip\_port.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} = AF\_INET;
778         ip\_port.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_aca19646000f55aa927406e68fc41ecf9}{ip4}.\hyperlink{union_i_p4_a5ad776be1fb768f3399aafcd1b58b3a2}{uint32} = ip\_port.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_a14c606eb5ffb078c38ad854dc4e79507}{ip6}.\hyperlink{union_i_p6_a1d8ab1f6c1da5565bed41e7095610dea}{uint32}[3];
779     \}
780 
781     \textcolor{comment}{/* NOTE: Current behavior if there are two clients with the same id is}
782 \textcolor{comment}{     * to replace the first ip by the second.}
783 \textcolor{comment}{     */}
784     \textcolor{keywordflow}{if} (!\hyperlink{_d_h_t_8c_af6cc6aba68b93656a8fdca733e2ae918}{client\_or\_ip\_port\_in\_list}(dht->
      \hyperlink{struct_d_h_t_a00ef35d5b0e7a791ef08a30b3bacbf9d}{close\_clientlist}, \hyperlink{_d_h_t_8h_a3058f857a8316099e20c95fb07adc7c1}{LCLIENT\_LIST}, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, ip\_port)) \{
785         \textcolor{keywordflow}{if} (\hyperlink{_d_h_t_8c_adfcc072141badf7d1cd04542b3dd26b1}{replace\_all}(dht->\hyperlink{struct_d_h_t_a00ef35d5b0e7a791ef08a30b3bacbf9d}{close\_clientlist}, 
      \hyperlink{_d_h_t_8h_a3058f857a8316099e20c95fb07adc7c1}{LCLIENT\_LIST}, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, ip\_port, dht->\hyperlink{struct_d_h_t_ae726df8bdc26380e5a6c3187a00d6881}{self\_public\_key}))
786             used++;
787     \} \textcolor{keywordflow}{else}
788         used++;
789 
790     \hyperlink{struct_d_h_t___friend}{DHT\_Friend} *friend\_foundip = 0;
791 
792     \textcolor{keywordflow}{for} (i = 0; i < dht->\hyperlink{struct_d_h_t_a8ee1f2d7e543bce350c591a8eaac0cf8}{num\_friends}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
793         \textcolor{keywordflow}{if} (!\hyperlink{_d_h_t_8c_af6cc6aba68b93656a8fdca733e2ae918}{client\_or\_ip\_port\_in\_list}(dht->
      \hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[i].\hyperlink{struct_d_h_t___friend_a49ef2b640a834a77b6e123355a4fea47}{client\_list},
794                                        \hyperlink{_d_h_t_8h_ad50d158518277ca4d19cbe364f3e958c}{MAX\_FRIEND\_CLIENTS}, 
      \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, ip\_port)) \{
795             \textcolor{keywordflow}{if} (\hyperlink{_d_h_t_8c_adfcc072141badf7d1cd04542b3dd26b1}{replace\_all}(dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[i].
      \hyperlink{struct_d_h_t___friend_a49ef2b640a834a77b6e123355a4fea47}{client\_list}, \hyperlink{_d_h_t_8h_ad50d158518277ca4d19cbe364f3e958c}{MAX\_FRIEND\_CLIENTS},
796                             \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, ip\_port, dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[i].
      \hyperlink{struct_d_h_t___friend_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key})) \{
797 
798                 \hyperlink{struct_d_h_t___friend}{DHT\_Friend} *\textcolor{keyword}{friend} = &dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}];
799 
800                 \textcolor{keywordflow}{if} (memcmp(\hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, friend->public\_key, crypto\_box\_PUBLICKEYBYTES) == 0) \{
801                     friend\_foundip = \textcolor{keyword}{friend};
802                 \}
803 
804                 used++;
805             \}
806         \} \textcolor{keywordflow}{else} \{
807             \hyperlink{struct_d_h_t___friend}{DHT\_Friend} *\textcolor{keyword}{friend} = &dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}];
808 
809             \textcolor{keywordflow}{if} (memcmp(\hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, friend->public\_key, crypto\_box\_PUBLICKEYBYTES) == 0) \{
810                 friend\_foundip = \textcolor{keyword}{friend};
811             \}
812 
813             used++;
814         \}
815     \}
816 
817     \textcolor{keywordflow}{if} (friend\_foundip) \{
818         uint32\_t j;
819 
820         \textcolor{keywordflow}{for} (j = 0; j < friend\_foundip->\hyperlink{struct_d_h_t___friend_a712c4c639bfc0f5a8616eead3e24ca4e}{lock\_count}; ++j) \{
821             \textcolor{keywordflow}{if} (friend\_foundip->\hyperlink{struct_d_h_t___friend_a1ef2d93ffeb76ceb01d28ecb1244547c}{callbacks}[j].\hyperlink{struct_d_h_t___friend_abc638e20365d8487c7bc56894c5ef969}{ip\_callback})
822                 friend\_foundip->\hyperlink{struct_d_h_t___friend_a1ef2d93ffeb76ceb01d28ecb1244547c}{callbacks}[j].\hyperlink{struct_d_h_t___friend_abc638e20365d8487c7bc56894c5ef969}{ip\_callback}(friend\_foundip->
      \hyperlink{struct_d_h_t___friend_a1ef2d93ffeb76ceb01d28ecb1244547c}{callbacks}[j].\hyperlink{struct_d_h_t___friend_a735984d41155bc1032e09bece8f8d66d}{data}, friend\_foundip->\hyperlink{struct_d_h_t___friend_a1ef2d93ffeb76ceb01d28ecb1244547c}{callbacks}[j].\hyperlink{struct_d_h_t___friend_a875e6b85754551c9eaea424a5a4c7934}{number},
823                         ip\_port);
824         \}
825     \}
826 
827 \textcolor{preprocessor}{#ifdef ENABLE\_ASSOC\_DHT}
828 
829     \textcolor{keywordflow}{if} (dht->assoc) \{
830         \hyperlink{struct_i_p_p_ts}{IPPTs} ippts;
831 
832         ippts.\hyperlink{struct_i_p_p_ts_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port} = ip\_port;
833         ippts.\hyperlink{struct_i_p_p_ts_a465bef81f6478756e5443025b1f2ddfa}{timestamp} = \hyperlink{util_8c_ac958d9f8847cb8039444bfa3d304233a}{unix\_time}();
834 
835         \hyperlink{assoc_8c_aa0230ae0304fd8540a5bce578d242f30}{Assoc\_add\_entry}(dht->assoc, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, &ippts, NULL, used ? 1 : 0);
836     \}
837 
838 \textcolor{preprocessor}{#endif}
839     \textcolor{keywordflow}{return} used;
840 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a9d898065db0fd4adf26fdb7f80e6d7ac_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a9d898065db0fd4adf26fdb7f80e6d7ac_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_ac2887d26ab67ac2ca1347b0ed8dadbf5}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!client\+\_\+in\+\_\+nodelist@{client\+\_\+in\+\_\+nodelist}}
\index{client\+\_\+in\+\_\+nodelist@{client\+\_\+in\+\_\+nodelist}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{client\+\_\+in\+\_\+nodelist}]{\setlength{\rightskip}{0pt plus 5cm}static int client\+\_\+in\+\_\+nodelist (
\begin{DoxyParamCaption}
\item[{const {\bf Node\+\_\+format} $\ast$}]{list, }
\item[{uint16\+\_\+t}]{length, }
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_d_h_t_8c_ac2887d26ab67ac2ca1347b0ed8dadbf5}


Definition at line 422 of file D\+H\+T.\+c.



References i, and id\+\_\+equal().



Referenced by get\+\_\+close\+\_\+nodes\+\_\+inner().


\begin{DoxyCode}
423 \{
424     uint32\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
425 
426     \textcolor{keywordflow}{for} (i = 0; i < length; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
427         \textcolor{keywordflow}{if} (\hyperlink{util_8c_ada3d44b4f530d3c8c9cb69b732be94b1}{id\_equal}(list[i].\hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, public\_key))
428             \textcolor{keywordflow}{return} 1;
429     \}
430 
431     \textcolor{keywordflow}{return} 0;
432 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=261pt]{dc/dc1/_d_h_t_8c_ac2887d26ab67ac2ca1347b0ed8dadbf5_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_ac2887d26ab67ac2ca1347b0ed8dadbf5_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_af6cc6aba68b93656a8fdca733e2ae918}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!client\+\_\+or\+\_\+ip\+\_\+port\+\_\+in\+\_\+list@{client\+\_\+or\+\_\+ip\+\_\+port\+\_\+in\+\_\+list}}
\index{client\+\_\+or\+\_\+ip\+\_\+port\+\_\+in\+\_\+list@{client\+\_\+or\+\_\+ip\+\_\+port\+\_\+in\+\_\+list}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{client\+\_\+or\+\_\+ip\+\_\+port\+\_\+in\+\_\+list}]{\setlength{\rightskip}{0pt plus 5cm}static int client\+\_\+or\+\_\+ip\+\_\+port\+\_\+in\+\_\+list (
\begin{DoxyParamCaption}
\item[{{\bf Client\+\_\+data} $\ast$}]{list, }
\item[{uint16\+\_\+t}]{length, }
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key, }
\item[{{\bf I\+P\+\_\+\+Port}}]{ip\+\_\+port}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_d_h_t_8c_af6cc6aba68b93656a8fdca733e2ae918}


Definition at line 343 of file D\+H\+T.\+c.



References Client\+\_\+data\+::assoc4, Client\+\_\+data\+::assoc6, I\+P\+::family, i, id\+\_\+equal(), I\+P\+\_\+\+Port\+::ip, I\+P\+P\+Ts\+Png\+::ip\+\_\+port, ipport\+\_\+equal(), L\+A\+N\+\_\+ip(), L\+O\+G\+G\+E\+R\+\_\+\+D\+E\+B\+U\+G, L\+O\+G\+G\+E\+R\+\_\+\+S\+C\+O\+P\+E, I\+P\+P\+Ts\+Png\+::timestamp, and unix\+\_\+time().



Referenced by addto\+\_\+lists().


\begin{DoxyCode}
344 \{
345     uint32\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
346     uint64\_t temp\_time = \hyperlink{util_8c_ac958d9f8847cb8039444bfa3d304233a}{unix\_time}();
347 
348     \textcolor{comment}{/* if public\_key is in list, find it and maybe overwrite ip\_port */}
349     \textcolor{keywordflow}{for} (i = 0; i < length; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i})
350         \textcolor{keywordflow}{if} (\hyperlink{util_8c_ada3d44b4f530d3c8c9cb69b732be94b1}{id\_equal}(list[i].\hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, public\_key)) \{
351             \textcolor{comment}{/* Refresh the client timestamp. */}
352             \textcolor{keywordflow}{if} (ip\_port.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} == AF\_INET) \{
353 
354                 \hyperlink{logger_8h_a3c9976e3ba8401ba5a2117ee6297c669}{LOGGER\_SCOPE}( \textcolor{keywordflow}{if} (!\hyperlink{network_8c_a6913335cf0b2a76303f5f61d18ea2277}{ipport\_equal}(&list[i].assoc4.ip\_port, &ip\_port))
       \{
355                 LOGGER\_TRACE(\textcolor{stringliteral}{"coipil[%u]: switching ipv4 from %s:%u to %s:%u"}, i,
356                              ip\_ntoa(&list[i].assoc4.ip\_port.ip), ntohs(list[i].assoc4.ip\_port.port),
357                              ip\_ntoa(&ip\_port.ip), ntohs(ip\_port.port));
358                 \}
359                             );
360 
361                 \textcolor{keywordflow}{if} (\hyperlink{_l_a_n__discovery_8c_a2d80a53390598eb8ededbc63f4e9c152}{LAN\_ip}(list[i].assoc4.ip\_port.ip) != 0 && \hyperlink{_l_a_n__discovery_8c_a2d80a53390598eb8ededbc63f4e9c152}{LAN\_ip}(ip\_port.
      \hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}) == 0)
362                     \textcolor{keywordflow}{return} 1;
363 
364                 list[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}].\hyperlink{struct_client__data_ac9843379cbcd02bdfa5c180a1474a6c5}{assoc4}.\hyperlink{struct_i_p_p_ts_png_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port} = ip\_port;
365                 list[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}].\hyperlink{struct_client__data_ac9843379cbcd02bdfa5c180a1474a6c5}{assoc4}.\hyperlink{struct_i_p_p_ts_png_a465bef81f6478756e5443025b1f2ddfa}{timestamp} = temp\_time;
366             \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (ip\_port.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} == AF\_INET6) \{
367 
368                 \hyperlink{logger_8h_a3c9976e3ba8401ba5a2117ee6297c669}{LOGGER\_SCOPE}( \textcolor{keywordflow}{if} (!\hyperlink{network_8c_a6913335cf0b2a76303f5f61d18ea2277}{ipport\_equal}(&list[i].assoc4.ip\_port, &ip\_port))
       \{
369                 LOGGER\_TRACE(\textcolor{stringliteral}{"coipil[%u]: switching ipv6 from %s:%u to %s:%u"}, i,
370                              ip\_ntoa(&list[i].assoc6.ip\_port.ip), ntohs(list[i].assoc6.ip\_port.port),
371                              ip\_ntoa(&ip\_port.ip), ntohs(ip\_port.port));
372                 \}
373                             );
374 
375                 \textcolor{keywordflow}{if} (\hyperlink{_l_a_n__discovery_8c_a2d80a53390598eb8ededbc63f4e9c152}{LAN\_ip}(list[i].assoc6.ip\_port.ip) != 0 && \hyperlink{_l_a_n__discovery_8c_a2d80a53390598eb8ededbc63f4e9c152}{LAN\_ip}(ip\_port.
      \hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}) == 0)
376                     \textcolor{keywordflow}{return} 1;
377 
378                 list[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}].\hyperlink{struct_client__data_a87d394929a2604f6f785fec949fac618}{assoc6}.\hyperlink{struct_i_p_p_ts_png_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port} = ip\_port;
379                 list[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}].\hyperlink{struct_client__data_a87d394929a2604f6f785fec949fac618}{assoc6}.\hyperlink{struct_i_p_p_ts_png_a465bef81f6478756e5443025b1f2ddfa}{timestamp} = temp\_time;
380             \}
381 
382             \textcolor{keywordflow}{return} 1;
383         \}
384 
385     \textcolor{comment}{/* public\_key not in list yet: see if we can find an identical ip\_port, in}
386 \textcolor{comment}{     * that case we kill the old public\_key by overwriting it with the new one}
387 \textcolor{comment}{     * TODO: maybe we SHOULDN'T do that if that public\_key is in a friend\_list}
388 \textcolor{comment}{     * and the one who is the actual friend's public\_key/address set? */}
389     \textcolor{keywordflow}{for} (i = 0; i < length; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
390         \textcolor{comment}{/* MAYBE: check the other address, if valid, don't nuke? */}
391         \textcolor{keywordflow}{if} ((ip\_port.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} == AF\_INET) && \hyperlink{network_8c_a6913335cf0b2a76303f5f61d18ea2277}{ipport\_equal}(&list[i].assoc4.ip\_port, &
      ip\_port)) \{
392             \textcolor{comment}{/* Initialize client timestamp. */}
393             list[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}].\hyperlink{struct_client__data_ac9843379cbcd02bdfa5c180a1474a6c5}{assoc4}.\hyperlink{struct_i_p_p_ts_png_a465bef81f6478756e5443025b1f2ddfa}{timestamp} = temp\_time;
394             memcpy(list[i].public\_key, public\_key, crypto\_box\_PUBLICKEYBYTES);
395 
396             \hyperlink{logger_8h_a9885ca09ce5f94d936c91a5b0856a024}{LOGGER\_DEBUG}(\textcolor{stringliteral}{"coipil[%u]: switching public\_key (ipv4)"}, i);
397 
398             \textcolor{comment}{/* kill the other address, if it was set */}
399             memset(&list[i].assoc6, 0, \textcolor{keyword}{sizeof}(list[i].assoc6));
400             \textcolor{keywordflow}{return} 1;
401         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ((ip\_port.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} == AF\_INET6) && \hyperlink{network_8c_a6913335cf0b2a76303f5f61d18ea2277}{ipport\_equal}(&list[i].assoc6.
      ip\_port, &ip\_port)) \{
402             \textcolor{comment}{/* Initialize client timestamp. */}
403             list[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}].\hyperlink{struct_client__data_a87d394929a2604f6f785fec949fac618}{assoc6}.\hyperlink{struct_i_p_p_ts_png_a465bef81f6478756e5443025b1f2ddfa}{timestamp} = temp\_time;
404             memcpy(list[i].public\_key, public\_key, crypto\_box\_PUBLICKEYBYTES);
405 
406             \hyperlink{logger_8h_a9885ca09ce5f94d936c91a5b0856a024}{LOGGER\_DEBUG}(\textcolor{stringliteral}{"coipil[%u]: switching public\_key (ipv6)"}, i);
407 
408             \textcolor{comment}{/* kill the other address, if it was set */}
409             memset(&list[i].assoc4, 0, \textcolor{keyword}{sizeof}(list[i].assoc4));
410             \textcolor{keywordflow}{return} 1;
411         \}
412     \}
413 
414     \textcolor{keywordflow}{return} 0;
415 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_af6cc6aba68b93656a8fdca733e2ae918_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_af6cc6aba68b93656a8fdca733e2ae918_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_a2b03f88384f04514e392abd12ef30140}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!closelist\+\_\+nodes@{closelist\+\_\+nodes}}
\index{closelist\+\_\+nodes@{closelist\+\_\+nodes}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{closelist\+\_\+nodes}]{\setlength{\rightskip}{0pt plus 5cm}uint16\+\_\+t closelist\+\_\+nodes (
\begin{DoxyParamCaption}
\item[{{\bf D\+H\+T} $\ast$}]{dht, }
\item[{{\bf Node\+\_\+format} $\ast$}]{nodes, }
\item[{uint16\+\_\+t}]{max\+\_\+num}
\end{DoxyParamCaption}
)}}\label{_d_h_t_8c_a2b03f88384f04514e392abd12ef30140}


Definition at line 2066 of file D\+H\+T.\+c.



References Client\+\_\+data\+::assoc4, Client\+\_\+data\+::assoc6, B\+A\+D\+\_\+\+N\+O\+D\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T, D\+H\+T\+::close\+\_\+clientlist, i, I\+P\+P\+Ts\+Png\+::ip\+\_\+port, Node\+\_\+format\+::ip\+\_\+port, is\+\_\+timeout(), and L\+C\+L\+I\+E\+N\+T\+\_\+\+L\+I\+S\+T.



Referenced by send\+\_\+dhtpk\+\_\+announce().


\begin{DoxyCode}
2067 \{
2068     \textcolor{keywordflow}{if} (max\_num == 0)
2069         \textcolor{keywordflow}{return} 0;
2070 
2071     uint16\_t count = 0;
2072     \hyperlink{struct_client__data}{Client\_data} *list = dht->\hyperlink{struct_d_h_t_a00ef35d5b0e7a791ef08a30b3bacbf9d}{close\_clientlist};
2073 
2074     uint32\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
2075 
2076     \textcolor{keywordflow}{for} (i = \hyperlink{_d_h_t_8h_a3058f857a8316099e20c95fb07adc7c1}{LCLIENT\_LIST}; i != 0; --\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
2077         \hyperlink{struct_i_p_p_ts_png}{IPPTsPng} *assoc = NULL;
2078 
2079         \textcolor{keywordflow}{if} (!\hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(list[i - 1].assoc4.timestamp, \hyperlink{_d_h_t_8h_a2c542fd03a43f340d1fb281afe54453f}{BAD\_NODE\_TIMEOUT}))
2080             assoc = &list[i - 1].\hyperlink{struct_client__data_ac9843379cbcd02bdfa5c180a1474a6c5}{assoc4};
2081 
2082         \textcolor{keywordflow}{if} (!\hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(list[i - 1].assoc6.timestamp, \hyperlink{_d_h_t_8h_a2c542fd03a43f340d1fb281afe54453f}{BAD\_NODE\_TIMEOUT})) \{
2083             \textcolor{keywordflow}{if} (assoc == NULL)
2084                 assoc = &list[i - 1].\hyperlink{struct_client__data_a87d394929a2604f6f785fec949fac618}{assoc6};
2085             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (rand() % 2)
2086                 assoc = &list[i - 1].\hyperlink{struct_client__data_a87d394929a2604f6f785fec949fac618}{assoc6};
2087         \}
2088 
2089         \textcolor{keywordflow}{if} (assoc != NULL) \{
2090             memcpy(nodes[count].\hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, list[i - 1].public\_key, crypto\_box\_PUBLICKEYBYTES);
2091             nodes[count].\hyperlink{struct_node__format_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port} = assoc->\hyperlink{struct_i_p_p_ts_png_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port};
2092             ++count;
2093 
2094             \textcolor{keywordflow}{if} (count >= max\_num)
2095                 \textcolor{keywordflow}{return} count;
2096         \}
2097     \}
2098 
2099     \textcolor{keywordflow}{return} count;
2100 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a2b03f88384f04514e392abd12ef30140_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a2b03f88384f04514e392abd12ef30140_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_a15d71358ca3e1f937159a7982168bb30}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!cmp\+\_\+dht\+\_\+entry@{cmp\+\_\+dht\+\_\+entry}}
\index{cmp\+\_\+dht\+\_\+entry@{cmp\+\_\+dht\+\_\+entry}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{cmp\+\_\+dht\+\_\+entry}]{\setlength{\rightskip}{0pt plus 5cm}static int cmp\+\_\+dht\+\_\+entry (
\begin{DoxyParamCaption}
\item[{const void $\ast$}]{a, }
\item[{const void $\ast$}]{b}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_d_h_t_8c_a15d71358ca3e1f937159a7982168bb30}


Definition at line 631 of file D\+H\+T.\+c.



References Client\+\_\+data\+::assoc4, Client\+\_\+data\+::assoc6, B\+A\+D\+\_\+\+N\+O\+D\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T, cmp\+\_\+public\+\_\+key, I\+P\+P\+Ts\+Png\+::hardening, H\+A\+R\+D\+E\+N\+I\+N\+G\+\_\+\+A\+L\+L\+\_\+\+O\+K, hardening\+\_\+correct(), id\+\_\+closest(), is\+\_\+timeout(), Client\+\_\+data\+::public\+\_\+key, and I\+P\+P\+Ts\+Png\+::timestamp.



Referenced by replace\+\_\+all().


\begin{DoxyCode}
632 \{
633     \hyperlink{struct_client__data}{Client\_data} entry1, entry2;
634     memcpy(&entry1, a, \textcolor{keyword}{sizeof}(\hyperlink{struct_client__data}{Client\_data}));
635     memcpy(&entry2, b, \textcolor{keyword}{sizeof}(\hyperlink{struct_client__data}{Client\_data}));
636     \textcolor{keywordtype}{int} t1 = \hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(entry1.\hyperlink{struct_client__data_ac9843379cbcd02bdfa5c180a1474a6c5}{assoc4}.\hyperlink{struct_i_p_p_ts_png_a465bef81f6478756e5443025b1f2ddfa}{timestamp}, 
      \hyperlink{_d_h_t_8h_a2c542fd03a43f340d1fb281afe54453f}{BAD\_NODE\_TIMEOUT}) && \hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(entry1.\hyperlink{struct_client__data_a87d394929a2604f6f785fec949fac618}{assoc6}.
      \hyperlink{struct_i_p_p_ts_png_a465bef81f6478756e5443025b1f2ddfa}{timestamp}, \hyperlink{_d_h_t_8h_a2c542fd03a43f340d1fb281afe54453f}{BAD\_NODE\_TIMEOUT});
637     \textcolor{keywordtype}{int} t2 = \hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(entry2.\hyperlink{struct_client__data_ac9843379cbcd02bdfa5c180a1474a6c5}{assoc4}.\hyperlink{struct_i_p_p_ts_png_a465bef81f6478756e5443025b1f2ddfa}{timestamp}, 
      \hyperlink{_d_h_t_8h_a2c542fd03a43f340d1fb281afe54453f}{BAD\_NODE\_TIMEOUT}) && \hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(entry2.\hyperlink{struct_client__data_a87d394929a2604f6f785fec949fac618}{assoc6}.
      \hyperlink{struct_i_p_p_ts_png_a465bef81f6478756e5443025b1f2ddfa}{timestamp}, \hyperlink{_d_h_t_8h_a2c542fd03a43f340d1fb281afe54453f}{BAD\_NODE\_TIMEOUT});
638 
639     \textcolor{keywordflow}{if} (t1 && t2)
640         \textcolor{keywordflow}{return} 0;
641 
642     \textcolor{keywordflow}{if} (t1)
643         \textcolor{keywordflow}{return} -1;
644 
645     \textcolor{keywordflow}{if} (t2)
646         \textcolor{keywordflow}{return} 1;
647 
648     t1 = \hyperlink{_d_h_t_8c_a99cbbcdc9772e5c2b1ff8416074e88c0}{hardening\_correct}(&entry1.\hyperlink{struct_client__data_ac9843379cbcd02bdfa5c180a1474a6c5}{assoc4}.\hyperlink{struct_i_p_p_ts_png_a247a5bc6669d45b7241b58223ce8fd1d}{hardening}) != 
      \hyperlink{_d_h_t_8c_a26075b69d14a1c08617bdb49aaf22ade}{HARDENING\_ALL\_OK}
649          && \hyperlink{_d_h_t_8c_a99cbbcdc9772e5c2b1ff8416074e88c0}{hardening\_correct}(&entry1.\hyperlink{struct_client__data_a87d394929a2604f6f785fec949fac618}{assoc6}.\hyperlink{struct_i_p_p_ts_png_a247a5bc6669d45b7241b58223ce8fd1d}{hardening}) != 
      \hyperlink{_d_h_t_8c_a26075b69d14a1c08617bdb49aaf22ade}{HARDENING\_ALL\_OK};
650     t2 = \hyperlink{_d_h_t_8c_a99cbbcdc9772e5c2b1ff8416074e88c0}{hardening\_correct}(&entry2.\hyperlink{struct_client__data_ac9843379cbcd02bdfa5c180a1474a6c5}{assoc4}.\hyperlink{struct_i_p_p_ts_png_a247a5bc6669d45b7241b58223ce8fd1d}{hardening}) != 
      \hyperlink{_d_h_t_8c_a26075b69d14a1c08617bdb49aaf22ade}{HARDENING\_ALL\_OK}
651          && \hyperlink{_d_h_t_8c_a99cbbcdc9772e5c2b1ff8416074e88c0}{hardening\_correct}(&entry2.\hyperlink{struct_client__data_a87d394929a2604f6f785fec949fac618}{assoc6}.\hyperlink{struct_i_p_p_ts_png_a247a5bc6669d45b7241b58223ce8fd1d}{hardening}) != 
      \hyperlink{_d_h_t_8c_a26075b69d14a1c08617bdb49aaf22ade}{HARDENING\_ALL\_OK};
652 
653     \textcolor{keywordflow}{if} (t1 != t2) \{
654         \textcolor{keywordflow}{if} (t1)
655             \textcolor{keywordflow}{return} -1;
656 
657         \textcolor{keywordflow}{if} (t2)
658             \textcolor{keywordflow}{return} 1;
659     \}
660 
661     \textcolor{keywordtype}{int} close = \hyperlink{_d_h_t_8c_a903a5bc580826fe447adb841b7782333}{id\_closest}(\hyperlink{_d_h_t_8c_a3551f15862efa7b58779722fe9763c45}{cmp\_public\_key}, entry1.
      \hyperlink{struct_client__data_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, entry2.\hyperlink{struct_client__data_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key});
662 
663     \textcolor{keywordflow}{if} (close == 1)
664         \textcolor{keywordflow}{return} 1;
665 
666     \textcolor{keywordflow}{if} (close == 2)
667         \textcolor{keywordflow}{return} -1;
668 
669     \textcolor{keywordflow}{return} 0;
670 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a15d71358ca3e1f937159a7982168bb30_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a15d71358ca3e1f937159a7982168bb30_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_aa8dd9b8abd89728492c0c9c6299c0a8b}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!cryptopacket\+\_\+handle@{cryptopacket\+\_\+handle}}
\index{cryptopacket\+\_\+handle@{cryptopacket\+\_\+handle}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{cryptopacket\+\_\+handle}]{\setlength{\rightskip}{0pt plus 5cm}static int cryptopacket\+\_\+handle (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{object, }
\item[{{\bf I\+P\+\_\+\+Port}}]{source, }
\item[{const uint8\+\_\+t $\ast$}]{packet, }
\item[{uint16\+\_\+t}]{length}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_d_h_t_8c_aa8dd9b8abd89728492c0c9c6299c0a8b}


Definition at line 2160 of file D\+H\+T.\+c.



References D\+H\+T\+::cryptopackethandlers, make-\/funny-\/savefile\+::data, Cryptopacket\+\_\+\+Handles\+::function, handle\+\_\+request(), M\+A\+X\+\_\+\+C\+R\+Y\+P\+T\+O\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+S\+I\+Z\+E, N\+E\+T\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+C\+R\+Y\+P\+T\+O, Cryptopacket\+\_\+\+Handles\+::object, route\+\_\+packet(), D\+H\+T\+::self\+\_\+public\+\_\+key, and D\+H\+T\+::self\+\_\+secret\+\_\+key.



Referenced by new\+\_\+\+D\+H\+T().


\begin{DoxyCode}
2161 \{
2162     \hyperlink{struct_d_h_t}{DHT} *dht = object;
2163 
2164     \textcolor{keywordflow}{if} (packet[0] == \hyperlink{network_8h_aebd9a38e63bac9807d0c2c1cfed68a15}{NET\_PACKET\_CRYPTO}) \{
2165         \textcolor{keywordflow}{if} (length <= crypto\_box\_PUBLICKEYBYTES * 2 + crypto\_box\_NONCEBYTES + 1 + crypto\_box\_MACBYTES ||
2166                 length > \hyperlink{crypto__core_8h_a2c79bc4b1111d42efd5fa7600398afcc}{MAX\_CRYPTO\_REQUEST\_SIZE} + crypto\_box\_MACBYTES)
2167             \textcolor{keywordflow}{return} 1;
2168 
2169         \textcolor{keywordflow}{if} (memcmp(packet + 1, dht->\hyperlink{struct_d_h_t_ae726df8bdc26380e5a6c3187a00d6881}{self\_public\_key}, crypto\_box\_PUBLICKEYBYTES) == 0) \{ \textcolor{comment}{//
       Check if request is for us.}
2170             uint8\_t \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}[crypto\_box\_PUBLICKEYBYTES];
2171             uint8\_t \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[\hyperlink{crypto__core_8h_a2c79bc4b1111d42efd5fa7600398afcc}{MAX\_CRYPTO\_REQUEST\_SIZE}];
2172             uint8\_t number;
2173             \textcolor{keywordtype}{int} len = \hyperlink{crypto__core_8c_a58ee334ab33d4a0283067145d3160a57}{handle\_request}(dht->\hyperlink{struct_d_h_t_ae726df8bdc26380e5a6c3187a00d6881}{self\_public\_key}, dht->
      \hyperlink{struct_d_h_t_aa05050f86513ff53fe9da81f73c72267}{self\_secret\_key}, public\_key, data, &number, packet, length);
2174 
2175             \textcolor{keywordflow}{if} (len == -1 || len == 0)
2176                 \textcolor{keywordflow}{return} 1;
2177 
2178             \textcolor{keywordflow}{if} (!dht->\hyperlink{struct_d_h_t_a461ccd9a581712b103785034f31d0d82}{cryptopackethandlers}[number].\hyperlink{struct_cryptopacket___handles_a9313784040f9666743d9aff915543903}{function}) \textcolor{keywordflow}{return} 1;
2179 
2180             \textcolor{keywordflow}{return} dht->\hyperlink{struct_d_h_t_a461ccd9a581712b103785034f31d0d82}{cryptopackethandlers}[number].
      \hyperlink{struct_cryptopacket___handles_a9313784040f9666743d9aff915543903}{function}(dht->\hyperlink{struct_d_h_t_a461ccd9a581712b103785034f31d0d82}{cryptopackethandlers}[number].\hyperlink{struct_cryptopacket___handles_a077376d12464f945e2414d5499c79b3f}{object}, source, public\_key,
2181                     data, len);
2182 
2183         \} \textcolor{keywordflow}{else} \{ \textcolor{comment}{/* If request is not for us, try routing it. */}
2184             \textcolor{keywordtype}{int} retval = \hyperlink{_d_h_t_8c_a91072d384a61a04ac1e4d679dc7efb3a}{route\_packet}(dht, packet + 1, packet, length);
2185 
2186             \textcolor{keywordflow}{if} ((\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int})retval == length)
2187                 \textcolor{keywordflow}{return} 0;
2188         \}
2189     \}
2190 
2191     \textcolor{keywordflow}{return} 1;
2192 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_aa8dd9b8abd89728492c0c9c6299c0a8b_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_aa8dd9b8abd89728492c0c9c6299c0a8b_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_a097913efd03d5106a66c15eb48b0e104}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!cryptopacket\+\_\+registerhandler@{cryptopacket\+\_\+registerhandler}}
\index{cryptopacket\+\_\+registerhandler@{cryptopacket\+\_\+registerhandler}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{cryptopacket\+\_\+registerhandler}]{\setlength{\rightskip}{0pt plus 5cm}void cryptopacket\+\_\+registerhandler (
\begin{DoxyParamCaption}
\item[{{\bf D\+H\+T} $\ast$}]{dht, }
\item[{uint8\+\_\+t}]{byte, }
\item[{{\bf cryptopacket\+\_\+handler\+\_\+callback}}]{cb, }
\item[{void $\ast$}]{object}
\end{DoxyParamCaption}
)}}\label{_d_h_t_8c_a097913efd03d5106a66c15eb48b0e104}


Definition at line 2154 of file D\+H\+T.\+c.



References D\+H\+T\+::cryptopackethandlers, Cryptopacket\+\_\+\+Handles\+::function, and Cryptopacket\+\_\+\+Handles\+::object.



Referenced by kill\+\_\+\+D\+H\+T(), kill\+\_\+onion\+\_\+client(), new\+\_\+\+D\+H\+T(), and new\+\_\+onion\+\_\+client().


\begin{DoxyCode}
2155 \{
2156     dht->\hyperlink{struct_d_h_t_a461ccd9a581712b103785034f31d0d82}{cryptopackethandlers}[byte].\hyperlink{struct_cryptopacket___handles_a9313784040f9666743d9aff915543903}{function} = cb;
2157     dht->\hyperlink{struct_d_h_t_a461ccd9a581712b103785034f31d0d82}{cryptopackethandlers}[byte].\hyperlink{struct_cryptopacket___handles_a077376d12464f945e2414d5499c79b3f}{object} = object;
2158 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a097913efd03d5106a66c15eb48b0e104_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_a1dac5e05fd07964cb4914c17afeb9d50}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!D\+H\+T\+\_\+addfriend@{D\+H\+T\+\_\+addfriend}}
\index{D\+H\+T\+\_\+addfriend@{D\+H\+T\+\_\+addfriend}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{D\+H\+T\+\_\+addfriend}]{\setlength{\rightskip}{0pt plus 5cm}int D\+H\+T\+\_\+addfriend (
\begin{DoxyParamCaption}
\item[{{\bf D\+H\+T} $\ast$}]{dht, }
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key, }
\item[{void($\ast$)(void $\ast$data, int32\+\_\+t number, {\bf I\+P\+\_\+\+Port})}]{ip\+\_\+callback, }
\item[{void $\ast$}]{data, }
\item[{int32\+\_\+t}]{number, }
\item[{uint16\+\_\+t $\ast$}]{lock\+\_\+count}
\end{DoxyParamCaption}
)}}\label{_d_h_t_8c_a1dac5e05fd07964cb4914c17afeb9d50}


Definition at line 1167 of file D\+H\+T.\+c.



References Client\+\_\+data\+::assoc4, Client\+\_\+data\+::assoc6, Assoc\+\_\+get\+\_\+close\+\_\+entries(), Assoc\+\_\+close\+\_\+entries\+::count, Assoc\+\_\+close\+\_\+entries\+::count\+\_\+good, make-\/funny-\/savefile\+::data, D\+H\+T\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+M\+A\+X\+\_\+\+L\+O\+C\+K\+S, friend\+\_\+number(), D\+H\+T\+::friends\+\_\+list, getnodes(), i, I\+P\+P\+Ts\+Png\+::ip\+\_\+port, ipport\+\_\+isset(), D\+H\+T\+\_\+\+Friend\+::lock\+\_\+count, M\+A\+X\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+C\+L\+I\+E\+N\+T\+S, D\+H\+T\+::num\+\_\+friends, make-\/funny-\/savefile\+::public\+\_\+key, Client\+\_\+data\+::public\+\_\+key, random\+\_\+64b(), Assoc\+\_\+close\+\_\+entries\+::result, and Assoc\+\_\+close\+\_\+entries\+::wanted\+\_\+id.



Referenced by change\+\_\+dht\+\_\+pk(), dht\+\_\+pk\+\_\+callback(), main(), and new\+\_\+\+D\+H\+T().


\begin{DoxyCode}
1169 \{
1170     \textcolor{keywordtype}{int} friend\_num = \hyperlink{_d_h_t_8c_a6cbd0f66d63003cc0def913dc7a4254b}{friend\_number}(dht, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key});
1171 
1172     uint16\_t lock\_num;
1173 
1174     \textcolor{keywordflow}{if} (friend\_num != -1) \{ \textcolor{comment}{/* Is friend already in DHT? */}
1175         \hyperlink{struct_d_h_t___friend}{DHT\_Friend} *\textcolor{keyword}{friend} = &dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[friend\_num];
1176 
1177         \textcolor{keywordflow}{if} (friend->lock\_count == \hyperlink{_d_h_t_8h_a5a2a8d3d5ad30ebd3efec91f27ccf394}{DHT\_FRIEND\_MAX\_LOCKS})
1178             \textcolor{keywordflow}{return} -1;
1179 
1180         lock\_num = \textcolor{keyword}{friend}->\hyperlink{struct_d_h_t___friend_a712c4c639bfc0f5a8616eead3e24ca4e}{lock\_count};
1181         ++\textcolor{keyword}{friend}->lock\_count;
1182         \textcolor{keyword}{friend}->callbacks[lock\_num].ip\_callback = ip\_callback;
1183         \textcolor{keyword}{friend}->callbacks[lock\_num].data = \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data};
1184         \textcolor{keyword}{friend}->callbacks[lock\_num].number = number;
1185 
1186         \textcolor{keywordflow}{if} (lock\_count)
1187             *lock\_count = lock\_num + 1;
1188 
1189         \textcolor{keywordflow}{return} 0;
1190     \}
1191 
1192     \hyperlink{struct_d_h_t___friend}{DHT\_Friend} *temp;
1193     temp = realloc(dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}, \textcolor{keyword}{sizeof}(\hyperlink{struct_d_h_t___friend}{DHT\_Friend}) * (dht->
      \hyperlink{struct_d_h_t_a8ee1f2d7e543bce350c591a8eaac0cf8}{num\_friends} + 1));
1194 
1195     \textcolor{keywordflow}{if} (temp == NULL)
1196         \textcolor{keywordflow}{return} -1;
1197 
1198     dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list} = temp;
1199     \hyperlink{struct_d_h_t___friend}{DHT\_Friend} *\textcolor{keyword}{friend} = &dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[dht->
      \hyperlink{struct_d_h_t_a8ee1f2d7e543bce350c591a8eaac0cf8}{num\_friends}];
1200     memset(\textcolor{keyword}{friend}, 0, \textcolor{keyword}{sizeof}(\hyperlink{struct_d_h_t___friend}{DHT\_Friend}));
1201     memcpy(friend->public\_key, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, crypto\_box\_PUBLICKEYBYTES);
1202 
1203     \textcolor{keyword}{friend}->nat.NATping\_id = \hyperlink{crypto__core_8c_a1ce51b34ab2247e750b9c2a25121eb9e}{random\_64b}();
1204     ++dht->\hyperlink{struct_d_h_t_a8ee1f2d7e543bce350c591a8eaac0cf8}{num\_friends};
1205 
1206     lock\_num = \textcolor{keyword}{friend}->lock\_count;
1207     ++\textcolor{keyword}{friend}->lock\_count;
1208     \textcolor{keyword}{friend}->callbacks[lock\_num].ip\_callback = ip\_callback;
1209     \textcolor{keyword}{friend}->callbacks[lock\_num].data = \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data};
1210     \textcolor{keyword}{friend}->callbacks[lock\_num].number = number;
1211 
1212     \textcolor{keywordflow}{if} (lock\_count)
1213         *lock\_count = lock\_num + 1;
1214 
1215 \textcolor{preprocessor}{#ifdef ENABLE\_ASSOC\_DHT}
1216 
1217     \textcolor{keywordflow}{if} (dht->assoc) \{
1218         \textcolor{comment}{/* get up to MAX\_FRIEND\_CLIENTS connectable nodes */}
1219         \hyperlink{struct_d_h_t___friend}{DHT\_Friend} *\textcolor{keyword}{friend} = &dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[dht->
      \hyperlink{struct_d_h_t_a8ee1f2d7e543bce350c591a8eaac0cf8}{num\_friends} - 1];
1220 
1221         \hyperlink{struct_assoc__close__entries}{Assoc\_close\_entries} close\_entries;
1222         memset(&close\_entries, 0, \textcolor{keyword}{sizeof}(close\_entries));
1223         close\_entries.\hyperlink{struct_assoc__close__entries_a037b65164e78b02017bd4751843037b4}{wanted\_id} = \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key};
1224         close\_entries.\hyperlink{struct_assoc__close__entries_a086e0ce002c9491e4b99956740bb53d4}{count\_good} = \hyperlink{_d_h_t_8h_ad50d158518277ca4d19cbe364f3e958c}{MAX\_FRIEND\_CLIENTS} / 2;
1225         close\_entries.\hyperlink{struct_assoc__close__entries_a20302e2c99a60d3f612dba57e3f6333b}{count} = \hyperlink{_d_h_t_8h_ad50d158518277ca4d19cbe364f3e958c}{MAX\_FRIEND\_CLIENTS};
1226         close\_entries.\hyperlink{struct_assoc__close__entries_a40d6704f891338dadfa89f46b696be4c}{result} = calloc(\hyperlink{_d_h_t_8h_ad50d158518277ca4d19cbe364f3e958c}{MAX\_FRIEND\_CLIENTS}, \textcolor{keyword}{sizeof}(*close\_entries.
      \hyperlink{struct_assoc__close__entries_a40d6704f891338dadfa89f46b696be4c}{result}));
1227 
1228         uint8\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}, found = \hyperlink{assoc_8c_a256dcbfb2174603496ffa30efef90ad2}{Assoc\_get\_close\_entries}(dht->assoc, &close\_entries);
1229 
1230         \textcolor{keywordflow}{for} (i = 0; i < found; i++)
1231             memcpy(&friend->client\_list[i], close\_entries.\hyperlink{struct_assoc__close__entries_a40d6704f891338dadfa89f46b696be4c}{result}[i], \textcolor{keyword}{sizeof}(*close\_entries.
      \hyperlink{struct_assoc__close__entries_a40d6704f891338dadfa89f46b696be4c}{result}[i]));
1232 
1233         \textcolor{keywordflow}{if} (found) \{
1234             \textcolor{comment}{/* send getnodes to the "best" entry */}
1235             \hyperlink{struct_client__data}{Client\_data} *client = &\textcolor{keyword}{friend}->client\_list[0];
1236 
1237             \textcolor{keywordflow}{if} (\hyperlink{network_8c_a8436367218afb29bcf1b5fecd071648e}{ipport\_isset}(&client->\hyperlink{struct_client__data_ac9843379cbcd02bdfa5c180a1474a6c5}{assoc4}.\hyperlink{struct_i_p_p_ts_png_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}))
1238                 \hyperlink{_d_h_t_8c_a7af6c30b12e5cbda1e6d6d824794956e}{getnodes}(dht, client->\hyperlink{struct_client__data_ac9843379cbcd02bdfa5c180a1474a6c5}{assoc4}.\hyperlink{struct_i_p_p_ts_png_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}, client->
      \hyperlink{struct_client__data_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, friend->public\_key, NULL);
1239 
1240             \textcolor{keywordflow}{if} (\hyperlink{network_8c_a8436367218afb29bcf1b5fecd071648e}{ipport\_isset}(&client->\hyperlink{struct_client__data_a87d394929a2604f6f785fec949fac618}{assoc6}.\hyperlink{struct_i_p_p_ts_png_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}))
1241                 \hyperlink{_d_h_t_8c_a7af6c30b12e5cbda1e6d6d824794956e}{getnodes}(dht, client->\hyperlink{struct_client__data_a87d394929a2604f6f785fec949fac618}{assoc6}.\hyperlink{struct_i_p_p_ts_png_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}, client->
      \hyperlink{struct_client__data_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, friend->public\_key, NULL);
1242         \}
1243     \}
1244 
1245 \textcolor{preprocessor}{#endif}
1246 
1247     \textcolor{keywordflow}{return} 0;
1248 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a1dac5e05fd07964cb4914c17afeb9d50_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a1dac5e05fd07964cb4914c17afeb9d50_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_ab6d732074bab2377a7884c41c219cf96}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!D\+H\+T\+\_\+bootstrap@{D\+H\+T\+\_\+bootstrap}}
\index{D\+H\+T\+\_\+bootstrap@{D\+H\+T\+\_\+bootstrap}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{D\+H\+T\+\_\+bootstrap}]{\setlength{\rightskip}{0pt plus 5cm}void D\+H\+T\+\_\+bootstrap (
\begin{DoxyParamCaption}
\item[{{\bf D\+H\+T} $\ast$}]{dht, }
\item[{{\bf I\+P\+\_\+\+Port}}]{ip\+\_\+port, }
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key}
\end{DoxyParamCaption}
)}}\label{_d_h_t_8c_ab6d732074bab2377a7884c41c219cf96}


Definition at line 1420 of file D\+H\+T.\+c.



References getnodes(), and D\+H\+T\+::self\+\_\+public\+\_\+key.



Referenced by D\+H\+T\+\_\+bootstrap\+\_\+from\+\_\+address(), D\+H\+T\+\_\+connect\+\_\+after\+\_\+load(), handle\+\_\+\+L\+A\+Ndiscovery(), S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T(), and tox\+\_\+bootstrap().


\begin{DoxyCode}
1421 \{
1422     \textcolor{comment}{/*#ifdef ENABLE\_ASSOC\_DHT}
1423 \textcolor{comment}{       if (dht->assoc) \{}
1424 \textcolor{comment}{           IPPTs ippts;}
1425 \textcolor{comment}{           ippts.ip\_port = ip\_port;}
1426 \textcolor{comment}{           ippts.timestamp = 0;}
1427 \textcolor{comment}{}
1428 \textcolor{comment}{           Assoc\_add\_entry(dht->assoc, public\_key, &ippts, NULL, 0);}
1429 \textcolor{comment}{       \}}
1430 \textcolor{comment}{       #endif*/}
1431 
1432     \hyperlink{_d_h_t_8c_a7af6c30b12e5cbda1e6d6d824794956e}{getnodes}(dht, ip\_port, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, dht->\hyperlink{struct_d_h_t_ae726df8bdc26380e5a6c3187a00d6881}{self\_public\_key}, NULL);
1433 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_ab6d732074bab2377a7884c41c219cf96_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_ab6d732074bab2377a7884c41c219cf96_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_af342c78837dbed569d4a75a0516455fc}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!D\+H\+T\+\_\+bootstrap\+\_\+from\+\_\+address@{D\+H\+T\+\_\+bootstrap\+\_\+from\+\_\+address}}
\index{D\+H\+T\+\_\+bootstrap\+\_\+from\+\_\+address@{D\+H\+T\+\_\+bootstrap\+\_\+from\+\_\+address}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{D\+H\+T\+\_\+bootstrap\+\_\+from\+\_\+address}]{\setlength{\rightskip}{0pt plus 5cm}int D\+H\+T\+\_\+bootstrap\+\_\+from\+\_\+address (
\begin{DoxyParamCaption}
\item[{{\bf D\+H\+T} $\ast$}]{dht, }
\item[{const char $\ast$}]{address, }
\item[{uint8\+\_\+t}]{ipv6enabled, }
\item[{uint16\+\_\+t}]{port, }
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key}
\end{DoxyParamCaption}
)}}\label{_d_h_t_8c_af342c78837dbed569d4a75a0516455fc}


Definition at line 1434 of file D\+H\+T.\+c.



References addr\+\_\+resolve\+\_\+or\+\_\+parse\+\_\+ip(), D\+H\+T\+\_\+bootstrap(), I\+P\+::family, I\+P\+\_\+\+Port\+::ip, ip\+\_\+init(), ip\+\_\+isset(), ip\+\_\+reset(), port, and I\+P\+\_\+\+Port\+::port.



Referenced by bootstrap\+\_\+from\+\_\+config(), and main().


\begin{DoxyCode}
1436 \{
1437     \hyperlink{struct_i_p___port}{IP\_Port} ip\_port\_v64;
1438     \hyperlink{struct_i_p}{IP} *ip\_extra = NULL;
1439     \hyperlink{struct_i_p___port}{IP\_Port} ip\_port\_v4;
1440     \hyperlink{network_8c_a6aa0dce9c25e370af93bf4a14f79c709}{ip\_init}(&ip\_port\_v64.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}, ipv6enabled);
1441 
1442     \textcolor{keywordflow}{if} (ipv6enabled) \{
1443         \textcolor{comment}{/* setup for getting BOTH: an IPv6 AND an IPv4 address */}
1444         ip\_port\_v64.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} = AF\_UNSPEC;
1445         \hyperlink{network_8c_a2bfd1efbce5b035b10c879a7e85c08df}{ip\_reset}(&ip\_port\_v4.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip});
1446         ip\_extra = &ip\_port\_v4.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip};
1447     \}
1448 
1449     \textcolor{keywordflow}{if} (\hyperlink{network_8c_a1c024648679209a12766fedc7e55d5e4}{addr\_resolve\_or\_parse\_ip}(address, &ip\_port\_v64.
      \hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}, ip\_extra)) \{
1450         ip\_port\_v64.\hyperlink{struct_i_p___port_a8e0798404bf2cf5dabb84c5ba9a4f236}{port} = \hyperlink{irc__syncbot_8c_a8e0798404bf2cf5dabb84c5ba9a4f236}{port};
1451         \hyperlink{_d_h_t_8c_ab6d732074bab2377a7884c41c219cf96}{DHT\_bootstrap}(dht, ip\_port\_v64, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key});
1452 
1453         \textcolor{keywordflow}{if} ((ip\_extra != NULL) && \hyperlink{network_8c_ac56c677f4bc8bf8311370ee105ae7cbb}{ip\_isset}(ip\_extra)) \{
1454             ip\_port\_v4.\hyperlink{struct_i_p___port_a8e0798404bf2cf5dabb84c5ba9a4f236}{port} = \hyperlink{irc__syncbot_8c_a8e0798404bf2cf5dabb84c5ba9a4f236}{port};
1455             \hyperlink{_d_h_t_8c_ab6d732074bab2377a7884c41c219cf96}{DHT\_bootstrap}(dht, ip\_port\_v4, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key});
1456         \}
1457 
1458         \textcolor{keywordflow}{return} 1;
1459     \} \textcolor{keywordflow}{else}
1460         \textcolor{keywordflow}{return} 0;
1461 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_af342c78837dbed569d4a75a0516455fc_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_af342c78837dbed569d4a75a0516455fc_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_ad5df2ff5066cf93898e531d320ddd675}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!D\+H\+T\+\_\+connect\+\_\+after\+\_\+load@{D\+H\+T\+\_\+connect\+\_\+after\+\_\+load}}
\index{D\+H\+T\+\_\+connect\+\_\+after\+\_\+load@{D\+H\+T\+\_\+connect\+\_\+after\+\_\+load}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{D\+H\+T\+\_\+connect\+\_\+after\+\_\+load}]{\setlength{\rightskip}{0pt plus 5cm}int D\+H\+T\+\_\+connect\+\_\+after\+\_\+load (
\begin{DoxyParamCaption}
\item[{{\bf D\+H\+T} $\ast$}]{dht}
\end{DoxyParamCaption}
)}}\label{_d_h_t_8c_ad5df2ff5066cf93898e531d320ddd675}


Definition at line 2382 of file D\+H\+T.\+c.



References D\+H\+T\+\_\+bootstrap(), D\+H\+T\+\_\+non\+\_\+lan\+\_\+connected(), i, Node\+\_\+format\+::ip\+\_\+port, D\+H\+T\+::loaded\+\_\+nodes\+\_\+index, D\+H\+T\+::loaded\+\_\+nodes\+\_\+list, D\+H\+T\+::loaded\+\_\+num\+\_\+nodes, Node\+\_\+format\+::public\+\_\+key, and S\+A\+V\+E\+\_\+\+B\+O\+O\+T\+S\+T\+A\+P\+\_\+\+F\+R\+E\+Q\+U\+E\+N\+C\+Y.



Referenced by do\+\_\+\+D\+H\+T().


\begin{DoxyCode}
2383 \{
2384     \textcolor{keywordflow}{if} (dht == NULL)
2385         \textcolor{keywordflow}{return} -1;
2386 
2387     \textcolor{keywordflow}{if} (!dht->\hyperlink{struct_d_h_t_a3050c21873637c51d8001c807f62fa74}{loaded\_nodes\_list})
2388         \textcolor{keywordflow}{return} -1;
2389 
2390     \textcolor{comment}{/* DHT is connected, stop. */}
2391     \textcolor{keywordflow}{if} (\hyperlink{_d_h_t_8c_a90cd93b83fdec619c4924fd20c4fc005}{DHT\_non\_lan\_connected}(dht)) \{
2392         free(dht->\hyperlink{struct_d_h_t_a3050c21873637c51d8001c807f62fa74}{loaded\_nodes\_list});
2393         dht->\hyperlink{struct_d_h_t_a3050c21873637c51d8001c807f62fa74}{loaded\_nodes\_list} = NULL;
2394         dht->\hyperlink{struct_d_h_t_aef4ce67d5df5f093247c73b3a024b73e}{loaded\_num\_nodes} = 0;
2395         \textcolor{keywordflow}{return} 0;
2396     \}
2397 
2398     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
2399 
2400     \textcolor{keywordflow}{for} (i = 0; i < dht->\hyperlink{struct_d_h_t_aef4ce67d5df5f093247c73b3a024b73e}{loaded\_num\_nodes} && i < 
      \hyperlink{_d_h_t_8c_a696df5fcb740674dfec58340660641be}{SAVE\_BOOTSTAP\_FREQUENCY}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
2401         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} index = dht->\hyperlink{struct_d_h_t_a6525da58097b462adbe2ad9000a6d77d}{loaded\_nodes\_index} % dht->
      \hyperlink{struct_d_h_t_aef4ce67d5df5f093247c73b3a024b73e}{loaded\_num\_nodes};
2402         \hyperlink{_d_h_t_8c_ab6d732074bab2377a7884c41c219cf96}{DHT\_bootstrap}(dht, dht->\hyperlink{struct_d_h_t_a3050c21873637c51d8001c807f62fa74}{loaded\_nodes\_list}[index].
      \hyperlink{struct_node__format_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}, dht->\hyperlink{struct_d_h_t_a3050c21873637c51d8001c807f62fa74}{loaded\_nodes\_list}[index].\hyperlink{struct_node__format_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key});
2403         ++dht->\hyperlink{struct_d_h_t_a6525da58097b462adbe2ad9000a6d77d}{loaded\_nodes\_index};
2404     \}
2405 
2406     \textcolor{keywordflow}{return} 0;
2407 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_ad5df2ff5066cf93898e531d320ddd675_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_ad5df2ff5066cf93898e531d320ddd675_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_a4e70f3fc186c6e459908307c935d00b2}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!D\+H\+T\+\_\+delfriend@{D\+H\+T\+\_\+delfriend}}
\index{D\+H\+T\+\_\+delfriend@{D\+H\+T\+\_\+delfriend}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{D\+H\+T\+\_\+delfriend}]{\setlength{\rightskip}{0pt plus 5cm}int D\+H\+T\+\_\+delfriend (
\begin{DoxyParamCaption}
\item[{{\bf D\+H\+T} $\ast$}]{dht, }
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key, }
\item[{uint16\+\_\+t}]{lock\+\_\+count}
\end{DoxyParamCaption}
)}}\label{_d_h_t_8c_a4e70f3fc186c6e459908307c935d00b2}


Definition at line 1250 of file D\+H\+T.\+c.



References friend\+\_\+number(), D\+H\+T\+::friends\+\_\+list, D\+H\+T\+\_\+\+Friend\+::lock\+\_\+count, and D\+H\+T\+::num\+\_\+friends.



Referenced by change\+\_\+dht\+\_\+pk(), do\+\_\+friend\+\_\+connections(), and kill\+\_\+friend\+\_\+connection().


\begin{DoxyCode}
1251 \{
1252     \textcolor{keywordtype}{int} friend\_num = \hyperlink{_d_h_t_8c_a6cbd0f66d63003cc0def913dc7a4254b}{friend\_number}(dht, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key});
1253 
1254     \textcolor{keywordflow}{if} (friend\_num == -1) \{
1255         \textcolor{keywordflow}{return} -1;
1256     \}
1257 
1258     \hyperlink{struct_d_h_t___friend}{DHT\_Friend} *\textcolor{keyword}{friend} = &dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[friend\_num];
1259     --\textcolor{keyword}{friend}->\hyperlink{struct_d_h_t___friend_a712c4c639bfc0f5a8616eead3e24ca4e}{lock\_count};
1260 
1261     \textcolor{keywordflow}{if} (friend->lock\_count && lock\_count) \{ \textcolor{comment}{/* DHT friend is still in use.*/}
1262         --lock\_count;
1263         \textcolor{keyword}{friend}->callbacks[lock\_count].ip\_callback = NULL;
1264         \textcolor{keyword}{friend}->callbacks[lock\_count].data = NULL;
1265         \textcolor{keyword}{friend}->callbacks[lock\_count].number = 0;
1266         \textcolor{keywordflow}{return} 0;
1267     \}
1268 
1269     \hyperlink{struct_d_h_t___friend}{DHT\_Friend} *temp;
1270 
1271     --dht->\hyperlink{struct_d_h_t_a8ee1f2d7e543bce350c591a8eaac0cf8}{num\_friends};
1272 
1273     \textcolor{keywordflow}{if} (dht->\hyperlink{struct_d_h_t_a8ee1f2d7e543bce350c591a8eaac0cf8}{num\_friends} != friend\_num) \{
1274         memcpy( &dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[friend\_num],
1275                 &dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[dht->\hyperlink{struct_d_h_t_a8ee1f2d7e543bce350c591a8eaac0cf8}{num\_friends}],
1276                 \textcolor{keyword}{sizeof}(\hyperlink{struct_d_h_t___friend}{DHT\_Friend}) );
1277     \}
1278 
1279     \textcolor{keywordflow}{if} (dht->\hyperlink{struct_d_h_t_a8ee1f2d7e543bce350c591a8eaac0cf8}{num\_friends} == 0) \{
1280         free(dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list});
1281         dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list} = NULL;
1282         \textcolor{keywordflow}{return} 0;
1283     \}
1284 
1285     temp = realloc(dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}, \textcolor{keyword}{sizeof}(\hyperlink{struct_d_h_t___friend}{DHT\_Friend}) * (dht->
      \hyperlink{struct_d_h_t_a8ee1f2d7e543bce350c591a8eaac0cf8}{num\_friends}));
1286 
1287     \textcolor{keywordflow}{if} (temp == NULL)
1288         \textcolor{keywordflow}{return} -1;
1289 
1290     dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list} = temp;
1291     \textcolor{keywordflow}{return} 0;
1292 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a4e70f3fc186c6e459908307c935d00b2_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a4e70f3fc186c6e459908307c935d00b2_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_a9e92f7714ab1f2b37b54e8479717cbc7}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!D\+H\+T\+\_\+get\+\_\+shared\+\_\+key\+\_\+recv@{D\+H\+T\+\_\+get\+\_\+shared\+\_\+key\+\_\+recv}}
\index{D\+H\+T\+\_\+get\+\_\+shared\+\_\+key\+\_\+recv@{D\+H\+T\+\_\+get\+\_\+shared\+\_\+key\+\_\+recv}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{D\+H\+T\+\_\+get\+\_\+shared\+\_\+key\+\_\+recv}]{\setlength{\rightskip}{0pt plus 5cm}void D\+H\+T\+\_\+get\+\_\+shared\+\_\+key\+\_\+recv (
\begin{DoxyParamCaption}
\item[{{\bf D\+H\+T} $\ast$}]{dht, }
\item[{uint8\+\_\+t $\ast$}]{shared\+\_\+key, }
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key}
\end{DoxyParamCaption}
)}}\label{_d_h_t_8c_a9e92f7714ab1f2b37b54e8479717cbc7}


Definition at line 146 of file D\+H\+T.\+c.



References get\+\_\+shared\+\_\+key(), D\+H\+T\+::self\+\_\+secret\+\_\+key, and D\+H\+T\+::shared\+\_\+keys\+\_\+recv.



Referenced by handle\+\_\+getnodes(), and handle\+\_\+ping\+\_\+request().


\begin{DoxyCode}
147 \{
148     \hyperlink{_d_h_t_8c_a6cd4aa89d7bfcf6805c5ce6b273d9e9e}{get\_shared\_key}(&dht->\hyperlink{struct_d_h_t_a4c647e235c4b9d2d6d68d760c7cb1b30}{shared\_keys\_recv}, shared\_key, dht->
      \hyperlink{struct_d_h_t_aa05050f86513ff53fe9da81f73c72267}{self\_secret\_key}, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key});
149 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a9e92f7714ab1f2b37b54e8479717cbc7_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a9e92f7714ab1f2b37b54e8479717cbc7_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_a087cceeacc5a14415b651c2980a24d34}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!D\+H\+T\+\_\+get\+\_\+shared\+\_\+key\+\_\+sent@{D\+H\+T\+\_\+get\+\_\+shared\+\_\+key\+\_\+sent}}
\index{D\+H\+T\+\_\+get\+\_\+shared\+\_\+key\+\_\+sent@{D\+H\+T\+\_\+get\+\_\+shared\+\_\+key\+\_\+sent}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{D\+H\+T\+\_\+get\+\_\+shared\+\_\+key\+\_\+sent}]{\setlength{\rightskip}{0pt plus 5cm}void D\+H\+T\+\_\+get\+\_\+shared\+\_\+key\+\_\+sent (
\begin{DoxyParamCaption}
\item[{{\bf D\+H\+T} $\ast$}]{dht, }
\item[{uint8\+\_\+t $\ast$}]{shared\+\_\+key, }
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key}
\end{DoxyParamCaption}
)}}\label{_d_h_t_8c_a087cceeacc5a14415b651c2980a24d34}


Definition at line 154 of file D\+H\+T.\+c.



References get\+\_\+shared\+\_\+key(), D\+H\+T\+::self\+\_\+secret\+\_\+key, and D\+H\+T\+::shared\+\_\+keys\+\_\+sent.



Referenced by create\+\_\+cookie\+\_\+request(), getnodes(), handle\+\_\+cookie\+\_\+request(), handle\+\_\+ping\+\_\+response(), handle\+\_\+sendnodes\+\_\+core(), and send\+\_\+ping\+\_\+request().


\begin{DoxyCode}
155 \{
156     \hyperlink{_d_h_t_8c_a6cd4aa89d7bfcf6805c5ce6b273d9e9e}{get\_shared\_key}(&dht->\hyperlink{struct_d_h_t_a07b2f51891b851ec0cd7dfe729412f77}{shared\_keys\_sent}, shared\_key, dht->
      \hyperlink{struct_d_h_t_aa05050f86513ff53fe9da81f73c72267}{self\_secret\_key}, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key});
157 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a087cceeacc5a14415b651c2980a24d34_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a087cceeacc5a14415b651c2980a24d34_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_a963cf2afd9283277f69a94381e3fc5f0}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!D\+H\+T\+\_\+getfriendip@{D\+H\+T\+\_\+getfriendip}}
\index{D\+H\+T\+\_\+getfriendip@{D\+H\+T\+\_\+getfriendip}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{D\+H\+T\+\_\+getfriendip}]{\setlength{\rightskip}{0pt plus 5cm}int D\+H\+T\+\_\+getfriendip (
\begin{DoxyParamCaption}
\item[{const {\bf D\+H\+T} $\ast$}]{dht, }
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key, }
\item[{{\bf I\+P\+\_\+\+Port} $\ast$}]{ip\+\_\+port}
\end{DoxyParamCaption}
)}}\label{_d_h_t_8c_a963cf2afd9283277f69a94381e3fc5f0}


Definition at line 1295 of file D\+H\+T.\+c.



References Client\+\_\+data\+::assoc6, B\+A\+D\+\_\+\+N\+O\+D\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T, D\+H\+T\+\_\+\+Friend\+::client\+\_\+list, D\+H\+T\+::friends\+\_\+list, i, id\+\_\+equal(), I\+P\+\_\+\+Port\+::ip, I\+P\+P\+Ts\+Png\+::ip\+\_\+port, ip\+\_\+reset(), is\+\_\+timeout(), M\+A\+X\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+C\+L\+I\+E\+N\+T\+S, D\+H\+T\+::num\+\_\+friends, I\+P\+\_\+\+Port\+::port, Client\+\_\+data\+::public\+\_\+key, D\+H\+T\+\_\+\+Friend\+::public\+\_\+key, and I\+P\+P\+Ts\+Png\+::timestamp.



Referenced by onion\+\_\+getfriendip(), and print\+\_\+friendlist().


\begin{DoxyCode}
1296 \{
1297     uint32\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}, j;
1298 
1299     \hyperlink{network_8c_a2bfd1efbce5b035b10c879a7e85c08df}{ip\_reset}(&ip\_port->\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip});
1300     ip\_port->\hyperlink{struct_i_p___port_a8e0798404bf2cf5dabb84c5ba9a4f236}{port} = 0;
1301 
1302     \textcolor{keywordflow}{for} (i = 0; i < dht->\hyperlink{struct_d_h_t_a8ee1f2d7e543bce350c591a8eaac0cf8}{num\_friends}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
1303         \textcolor{comment}{/* Equal */}
1304         \textcolor{keywordflow}{if} (\hyperlink{util_8c_ada3d44b4f530d3c8c9cb69b732be94b1}{id\_equal}(dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[i].\hyperlink{struct_d_h_t___friend_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, 
      \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key})) \{
1305             \textcolor{keywordflow}{for} (j = 0; j < \hyperlink{_d_h_t_8h_ad50d158518277ca4d19cbe364f3e958c}{MAX\_FRIEND\_CLIENTS}; ++j) \{
1306                 \hyperlink{struct_client__data}{Client\_data} *client = &dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[
      \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}].\hyperlink{struct_d_h_t___friend_a49ef2b640a834a77b6e123355a4fea47}{client\_list}[j];
1307 
1308                 \textcolor{keywordflow}{if} (\hyperlink{util_8c_ada3d44b4f530d3c8c9cb69b732be94b1}{id\_equal}(client->\hyperlink{struct_client__data_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key})) \{
1309                     \hyperlink{struct_i_p_p_ts_png}{IPPTsPng} *assoc = NULL;
1310                     uint32\_t a;
1311 
1312                     \textcolor{keywordflow}{for} (a = 0, assoc = &client->\hyperlink{struct_client__data_a87d394929a2604f6f785fec949fac618}{assoc6}; a < 2; a++, assoc = &client->assoc4)
1313                         \textcolor{keywordflow}{if} (!\hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(assoc->\hyperlink{struct_i_p_p_ts_png_a465bef81f6478756e5443025b1f2ddfa}{timestamp}, 
      \hyperlink{_d_h_t_8h_a2c542fd03a43f340d1fb281afe54453f}{BAD\_NODE\_TIMEOUT})) \{
1314                             *ip\_port = assoc->\hyperlink{struct_i_p_p_ts_png_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port};
1315                             \textcolor{keywordflow}{return} 1;
1316                         \}
1317                 \}
1318             \}
1319 
1320             \textcolor{keywordflow}{return} 0;
1321         \}
1322     \}
1323 
1324     \textcolor{keywordflow}{return} -1;
1325 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a963cf2afd9283277f69a94381e3fc5f0_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a963cf2afd9283277f69a94381e3fc5f0_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_a769ef744f969e1b4c55547cb74abee59}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!D\+H\+T\+\_\+getnodes@{D\+H\+T\+\_\+getnodes}}
\index{D\+H\+T\+\_\+getnodes@{D\+H\+T\+\_\+getnodes}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{D\+H\+T\+\_\+getnodes}]{\setlength{\rightskip}{0pt plus 5cm}void D\+H\+T\+\_\+getnodes (
\begin{DoxyParamCaption}
\item[{{\bf D\+H\+T} $\ast$}]{dht, }
\item[{const {\bf I\+P\+\_\+\+Port} $\ast$}]{from\+\_\+ipp, }
\item[{const uint8\+\_\+t $\ast$}]{from\+\_\+id, }
\item[{const uint8\+\_\+t $\ast$}]{which\+\_\+id}
\end{DoxyParamCaption}
)}}\label{_d_h_t_8c_a769ef744f969e1b4c55547cb74abee59}


Definition at line 1415 of file D\+H\+T.\+c.



References getnodes().



Referenced by do\+\_\+\+Assoc(), and handle\+\_\+dhtpk\+\_\+announce().


\begin{DoxyCode}
1416 \{
1417     \hyperlink{_d_h_t_8c_a7af6c30b12e5cbda1e6d6d824794956e}{getnodes}(dht, *from\_ipp, from\_id, which\_id, NULL);
1418 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a769ef744f969e1b4c55547cb74abee59_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a769ef744f969e1b4c55547cb74abee59_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_a93770fe498d41d1c6b420275680967b6}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!D\+H\+T\+\_\+isconnected@{D\+H\+T\+\_\+isconnected}}
\index{D\+H\+T\+\_\+isconnected@{D\+H\+T\+\_\+isconnected}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{D\+H\+T\+\_\+isconnected}]{\setlength{\rightskip}{0pt plus 5cm}int D\+H\+T\+\_\+isconnected (
\begin{DoxyParamCaption}
\item[{const {\bf D\+H\+T} $\ast$}]{dht}
\end{DoxyParamCaption}
)}}\label{_d_h_t_8c_a93770fe498d41d1c6b420275680967b6}


Definition at line 2471 of file D\+H\+T.\+c.



References Client\+\_\+data\+::assoc4, Client\+\_\+data\+::assoc6, B\+A\+D\+\_\+\+N\+O\+D\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T, D\+H\+T\+::close\+\_\+clientlist, i, is\+\_\+timeout(), L\+C\+L\+I\+E\+N\+T\+\_\+\+L\+I\+S\+T, I\+P\+P\+Ts\+Png\+::timestamp, and unix\+\_\+time\+\_\+update().



Referenced by do\+\_\+tox(), main(), random\+\_\+nodes\+\_\+path\+\_\+onion(), and S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T().


\begin{DoxyCode}
2472 \{
2473     uint32\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
2474     \hyperlink{util_8c_a849af10dd491723cf3abdef599846897}{unix\_time\_update}();
2475 
2476     \textcolor{keywordflow}{for} (i = 0; i < \hyperlink{_d_h_t_8h_a3058f857a8316099e20c95fb07adc7c1}{LCLIENT\_LIST}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
2477         \textcolor{keyword}{const} \hyperlink{struct_client__data}{Client\_data} *client = &dht->\hyperlink{struct_d_h_t_a00ef35d5b0e7a791ef08a30b3bacbf9d}{close\_clientlist}[
      \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}];
2478 
2479         \textcolor{keywordflow}{if} (!\hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(client->\hyperlink{struct_client__data_ac9843379cbcd02bdfa5c180a1474a6c5}{assoc4}.\hyperlink{struct_i_p_p_ts_png_a465bef81f6478756e5443025b1f2ddfa}{timestamp}, 
      \hyperlink{_d_h_t_8h_a2c542fd03a43f340d1fb281afe54453f}{BAD\_NODE\_TIMEOUT}) ||
2480                 !\hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(client->\hyperlink{struct_client__data_a87d394929a2604f6f785fec949fac618}{assoc6}.\hyperlink{struct_i_p_p_ts_png_a465bef81f6478756e5443025b1f2ddfa}{timestamp}, 
      \hyperlink{_d_h_t_8h_a2c542fd03a43f340d1fb281afe54453f}{BAD\_NODE\_TIMEOUT}))
2481             \textcolor{keywordflow}{return} 1;
2482     \}
2483 
2484     \textcolor{keywordflow}{return} 0;
2485 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a93770fe498d41d1c6b420275680967b6_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a93770fe498d41d1c6b420275680967b6_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_a36e42ad71b293cd0ada8a7b6de9ad86b}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!D\+H\+T\+\_\+load@{D\+H\+T\+\_\+load}}
\index{D\+H\+T\+\_\+load@{D\+H\+T\+\_\+load}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{D\+H\+T\+\_\+load}]{\setlength{\rightskip}{0pt plus 5cm}int D\+H\+T\+\_\+load (
\begin{DoxyParamCaption}
\item[{{\bf D\+H\+T} $\ast$}]{dht, }
\item[{const uint8\+\_\+t $\ast$}]{data, }
\item[{uint32\+\_\+t}]{length}
\end{DoxyParamCaption}
)}}\label{_d_h_t_8c_a36e42ad71b293cd0ada8a7b6de9ad86b}


Definition at line 2452 of file D\+H\+T.\+c.



References dht\+\_\+load\+\_\+state\+\_\+callback(), D\+H\+T\+\_\+\+S\+T\+A\+T\+E\+\_\+\+C\+O\+O\+K\+I\+E\+\_\+\+G\+L\+O\+B\+A\+L, D\+H\+T\+\_\+\+S\+T\+A\+T\+E\+\_\+\+C\+O\+O\+K\+I\+E\+\_\+\+T\+Y\+P\+E, lendian\+\_\+to\+\_\+host32(), and load\+\_\+state().



Referenced by messenger\+\_\+load\+\_\+state\+\_\+callback(), and S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T().


\begin{DoxyCode}
2453 \{
2454     uint32\_t cookie\_len = \textcolor{keyword}{sizeof}(uint32\_t);
2455 
2456     \textcolor{keywordflow}{if} (length > cookie\_len) \{
2457         uint32\_t data32;
2458         \hyperlink{util_8c_a4a7b1a2d62e6d6842bc0fefece837ad2}{lendian\_to\_host32}(&data32, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data});
2459 
2460         \textcolor{keywordflow}{if} (data32 == \hyperlink{_d_h_t_8c_a6a842db82e30616af13990781cf13ab3}{DHT\_STATE\_COOKIE\_GLOBAL})
2461             \textcolor{keywordflow}{return} \hyperlink{util_8c_a779943554d12b56f6e35e8f5ba2cf7f5}{load\_state}(\hyperlink{_d_h_t_8c_a266c420f5eb745eddcf184e316b157be}{dht\_load\_state\_callback}, dht, 
      \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} + cookie\_len,
2462                               length - cookie\_len, \hyperlink{_d_h_t_8c_a48a9324191a79b2e05af9b6499addba6}{DHT\_STATE\_COOKIE\_TYPE});
2463     \}
2464 
2465     \textcolor{keywordflow}{return} -1;
2466 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a36e42ad71b293cd0ada8a7b6de9ad86b_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a36e42ad71b293cd0ada8a7b6de9ad86b_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_a266c420f5eb745eddcf184e316b157be}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!dht\+\_\+load\+\_\+state\+\_\+callback@{dht\+\_\+load\+\_\+state\+\_\+callback}}
\index{dht\+\_\+load\+\_\+state\+\_\+callback@{dht\+\_\+load\+\_\+state\+\_\+callback}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{dht\+\_\+load\+\_\+state\+\_\+callback}]{\setlength{\rightskip}{0pt plus 5cm}static int dht\+\_\+load\+\_\+state\+\_\+callback (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{outer, }
\item[{const uint8\+\_\+t $\ast$}]{data, }
\item[{uint32\+\_\+t}]{length, }
\item[{uint16\+\_\+t}]{type}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_d_h_t_8c_a266c420f5eb745eddcf184e316b157be}


Definition at line 2409 of file D\+H\+T.\+c.



References D\+H\+T\+\_\+\+S\+T\+A\+T\+E\+\_\+\+T\+Y\+P\+E\+\_\+\+N\+O\+D\+E\+S, D\+H\+T\+::loaded\+\_\+nodes\+\_\+list, D\+H\+T\+::loaded\+\_\+num\+\_\+nodes, M\+A\+X\+\_\+\+S\+A\+V\+E\+D\+\_\+\+D\+H\+T\+\_\+\+N\+O\+D\+E\+S, num, and unpack\+\_\+nodes().



Referenced by D\+H\+T\+\_\+load().


\begin{DoxyCode}
2410 \{
2411     \hyperlink{struct_d_h_t}{DHT} *dht = outer;
2412 
2413     \textcolor{keywordflow}{switch} (type) \{
2414         \textcolor{keywordflow}{case} \hyperlink{_d_h_t_8c_a2244b83e3fbf401e240bb5fa9a576e9e}{DHT\_STATE\_TYPE\_NODES}:
2415             \textcolor{keywordflow}{if} (length == 0)
2416                 \textcolor{keywordflow}{break};
2417 
2418             \{
2419                 free(dht->\hyperlink{struct_d_h_t_a3050c21873637c51d8001c807f62fa74}{loaded\_nodes\_list});
2420                 \textcolor{comment}{// Copy to loaded\_clients\_list}
2421                 dht->\hyperlink{struct_d_h_t_a3050c21873637c51d8001c807f62fa74}{loaded\_nodes\_list} = calloc(
      \hyperlink{_d_h_t_8c_a4ebd02f5b13bf2d343bef7c55b88ef93}{MAX\_SAVED\_DHT\_NODES}, \textcolor{keyword}{sizeof}(\hyperlink{struct_node__format}{Node\_format}));
2422 
2423                 \textcolor{keywordtype}{int} \hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num} = \hyperlink{_d_h_t_8c_a45b33af842c0289c78c70f81e854ed62}{unpack\_nodes}(dht->\hyperlink{struct_d_h_t_a3050c21873637c51d8001c807f62fa74}{loaded\_nodes\_list}, 
      \hyperlink{_d_h_t_8c_a4ebd02f5b13bf2d343bef7c55b88ef93}{MAX\_SAVED\_DHT\_NODES}, NULL, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}, length, 0);
2424 
2425                 \textcolor{keywordflow}{if} (num > 0) \{
2426                     dht->\hyperlink{struct_d_h_t_aef4ce67d5df5f093247c73b3a024b73e}{loaded\_num\_nodes} = \hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num};
2427                 \} \textcolor{keywordflow}{else} \{
2428                     dht->\hyperlink{struct_d_h_t_aef4ce67d5df5f093247c73b3a024b73e}{loaded\_num\_nodes} = 0;
2429                 \}
2430 
2431             \} \textcolor{comment}{/* localize declarations */}
2432 
2433             \textcolor{keywordflow}{break};
2434 
2435 \textcolor{preprocessor}{#ifdef DEBUG}
2436 
2437         \textcolor{keywordflow}{default}:
2438             fprintf(stderr, \textcolor{stringliteral}{"Load state (DHT): contains unrecognized part (len %u, type %u)\(\backslash\)n"},
2439                     length, type);
2440             \textcolor{keywordflow}{break};
2441 \textcolor{preprocessor}{#endif}
2442     \}
2443 
2444     \textcolor{keywordflow}{return} 0;
2445 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=318pt]{dc/dc1/_d_h_t_8c_a266c420f5eb745eddcf184e316b157be_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a266c420f5eb745eddcf184e316b157be_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_a90cd93b83fdec619c4924fd20c4fc005}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!D\+H\+T\+\_\+non\+\_\+lan\+\_\+connected@{D\+H\+T\+\_\+non\+\_\+lan\+\_\+connected}}
\index{D\+H\+T\+\_\+non\+\_\+lan\+\_\+connected@{D\+H\+T\+\_\+non\+\_\+lan\+\_\+connected}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{D\+H\+T\+\_\+non\+\_\+lan\+\_\+connected}]{\setlength{\rightskip}{0pt plus 5cm}int D\+H\+T\+\_\+non\+\_\+lan\+\_\+connected (
\begin{DoxyParamCaption}
\item[{const {\bf D\+H\+T} $\ast$}]{dht}
\end{DoxyParamCaption}
)}}\label{_d_h_t_8c_a90cd93b83fdec619c4924fd20c4fc005}


Definition at line 2490 of file D\+H\+T.\+c.



References Client\+\_\+data\+::assoc4, Client\+\_\+data\+::assoc6, B\+A\+D\+\_\+\+N\+O\+D\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T, D\+H\+T\+::close\+\_\+clientlist, i, I\+P\+\_\+\+Port\+::ip, I\+P\+P\+Ts\+Png\+::ip\+\_\+port, is\+\_\+timeout(), L\+A\+N\+\_\+ip(), L\+C\+L\+I\+E\+N\+T\+\_\+\+L\+I\+S\+T, I\+P\+P\+Ts\+Png\+::timestamp, and unix\+\_\+time\+\_\+update().



Referenced by D\+H\+T\+\_\+connect\+\_\+after\+\_\+load(), and do\+\_\+onion\+\_\+client().


\begin{DoxyCode}
2491 \{
2492     uint32\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
2493     \hyperlink{util_8c_a849af10dd491723cf3abdef599846897}{unix\_time\_update}();
2494 
2495     \textcolor{keywordflow}{for} (i = 0; i < \hyperlink{_d_h_t_8h_a3058f857a8316099e20c95fb07adc7c1}{LCLIENT\_LIST}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
2496         \textcolor{keyword}{const} \hyperlink{struct_client__data}{Client\_data} *client = &dht->\hyperlink{struct_d_h_t_a00ef35d5b0e7a791ef08a30b3bacbf9d}{close\_clientlist}[
      \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}];
2497 
2498         \textcolor{keywordflow}{if} (!\hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(client->\hyperlink{struct_client__data_ac9843379cbcd02bdfa5c180a1474a6c5}{assoc4}.\hyperlink{struct_i_p_p_ts_png_a465bef81f6478756e5443025b1f2ddfa}{timestamp}, 
      \hyperlink{_d_h_t_8h_a2c542fd03a43f340d1fb281afe54453f}{BAD\_NODE\_TIMEOUT}) && \hyperlink{_l_a_n__discovery_8c_a2d80a53390598eb8ededbc63f4e9c152}{LAN\_ip}(client->\hyperlink{struct_client__data_ac9843379cbcd02bdfa5c180a1474a6c5}{assoc4}.\hyperlink{struct_i_p_p_ts_png_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}.
      \hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}) == -1)
2499             \textcolor{keywordflow}{return} 1;
2500 
2501         \textcolor{keywordflow}{if} (!\hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(client->\hyperlink{struct_client__data_a87d394929a2604f6f785fec949fac618}{assoc6}.\hyperlink{struct_i_p_p_ts_png_a465bef81f6478756e5443025b1f2ddfa}{timestamp}, 
      \hyperlink{_d_h_t_8h_a2c542fd03a43f340d1fb281afe54453f}{BAD\_NODE\_TIMEOUT}) && \hyperlink{_l_a_n__discovery_8c_a2d80a53390598eb8ededbc63f4e9c152}{LAN\_ip}(client->\hyperlink{struct_client__data_a87d394929a2604f6f785fec949fac618}{assoc6}.\hyperlink{struct_i_p_p_ts_png_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}.
      \hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}) == -1)
2502             \textcolor{keywordflow}{return} 1;
2503 
2504     \}
2505 
2506     \textcolor{keywordflow}{return} 0;
2507 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a90cd93b83fdec619c4924fd20c4fc005_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a90cd93b83fdec619c4924fd20c4fc005_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_a7510a9fdbacfffb5987590c4e193c40a}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!D\+H\+T\+\_\+save@{D\+H\+T\+\_\+save}}
\index{D\+H\+T\+\_\+save@{D\+H\+T\+\_\+save}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{D\+H\+T\+\_\+save}]{\setlength{\rightskip}{0pt plus 5cm}void D\+H\+T\+\_\+save (
\begin{DoxyParamCaption}
\item[{{\bf D\+H\+T} $\ast$}]{dht, }
\item[{uint8\+\_\+t $\ast$}]{data}
\end{DoxyParamCaption}
)}}\label{_d_h_t_8c_a7510a9fdbacfffb5987590c4e193c40a}


Definition at line 2329 of file D\+H\+T.\+c.



References Client\+\_\+data\+::assoc4, Client\+\_\+data\+::assoc6, D\+H\+T\+\_\+\+Friend\+::client\+\_\+list, D\+H\+T\+::close\+\_\+clientlist, make-\/funny-\/savefile\+::data, D\+H\+T\+\_\+\+F\+A\+K\+E\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+N\+U\+M\+B\+E\+R, D\+H\+T\+\_\+\+S\+T\+A\+T\+E\+\_\+\+C\+O\+O\+K\+I\+E\+\_\+\+G\+L\+O\+B\+A\+L, D\+H\+T\+\_\+\+S\+T\+A\+T\+E\+\_\+\+T\+Y\+P\+E\+\_\+\+N\+O\+D\+E\+S, D\+H\+T\+::friends\+\_\+list, host\+\_\+to\+\_\+lendian32(), i, I\+P\+P\+Ts\+Png\+::ip\+\_\+port, Node\+\_\+format\+::ip\+\_\+port, L\+C\+L\+I\+E\+N\+T\+\_\+\+L\+I\+S\+T, M\+A\+X\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+C\+L\+I\+E\+N\+T\+S, M\+A\+X\+\_\+\+S\+A\+V\+E\+D\+\_\+\+D\+H\+T\+\_\+\+N\+O\+D\+E\+S, num, D\+H\+T\+::num\+\_\+friends, pack\+\_\+nodes(), Client\+\_\+data\+::public\+\_\+key, I\+P\+P\+Ts\+Png\+::timestamp, and z\+\_\+state\+\_\+save\+\_\+subheader().



Referenced by messenger\+\_\+save(), and S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T().


\begin{DoxyCode}
2330 \{
2331     \hyperlink{util_8c_aebd439a002cb183420a08996f7ffdbef}{host\_to\_lendian32}(\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data},  \hyperlink{_d_h_t_8c_a6a842db82e30616af13990781cf13ab3}{DHT\_STATE\_COOKIE\_GLOBAL});
2332     \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} += \textcolor{keyword}{sizeof}(uint32\_t);
2333 
2334     uint32\_t \hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num}, \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}, j;
2335 
2336     uint8\_t *old\_data = \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data};
2337 
2338     \textcolor{comment}{/* get right offset. we write the actual header later. */}
2339     \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} = \hyperlink{_d_h_t_8c_a910e4555ff14d9974e6f1dd227d8dd99}{z\_state\_save\_subheader}(\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}, 0, 0);
2340 
2341     \hyperlink{struct_node__format}{Node\_format} clients[\hyperlink{_d_h_t_8c_a4ebd02f5b13bf2d343bef7c55b88ef93}{MAX\_SAVED\_DHT\_NODES}];
2342 
2343     \textcolor{keywordflow}{for} (num = 0, i = 0; i < \hyperlink{_d_h_t_8h_a3058f857a8316099e20c95fb07adc7c1}{LCLIENT\_LIST}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
2344         \textcolor{keywordflow}{if} (dht->\hyperlink{struct_d_h_t_a00ef35d5b0e7a791ef08a30b3bacbf9d}{close\_clientlist}[i].\hyperlink{struct_client__data_ac9843379cbcd02bdfa5c180a1474a6c5}{assoc4}.\hyperlink{struct_i_p_p_ts_png_a465bef81f6478756e5443025b1f2ddfa}{timestamp} != 0) \{
2345             memcpy(clients[num].\hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, dht->\hyperlink{struct_d_h_t_a00ef35d5b0e7a791ef08a30b3bacbf9d}{close\_clientlist}[i].
      \hyperlink{struct_client__data_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, crypto\_box\_PUBLICKEYBYTES);
2346             clients[\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num}].\hyperlink{struct_node__format_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port} = dht->\hyperlink{struct_d_h_t_a00ef35d5b0e7a791ef08a30b3bacbf9d}{close\_clientlist}[
      \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}].\hyperlink{struct_client__data_ac9843379cbcd02bdfa5c180a1474a6c5}{assoc4}.\hyperlink{struct_i_p_p_ts_png_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port};
2347             ++\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num};
2348         \}
2349 
2350         \textcolor{keywordflow}{if} (dht->\hyperlink{struct_d_h_t_a00ef35d5b0e7a791ef08a30b3bacbf9d}{close\_clientlist}[i].\hyperlink{struct_client__data_a87d394929a2604f6f785fec949fac618}{assoc6}.\hyperlink{struct_i_p_p_ts_png_a465bef81f6478756e5443025b1f2ddfa}{timestamp} != 0) \{
2351             memcpy(clients[num].\hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, dht->\hyperlink{struct_d_h_t_a00ef35d5b0e7a791ef08a30b3bacbf9d}{close\_clientlist}[i].
      \hyperlink{struct_client__data_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, crypto\_box\_PUBLICKEYBYTES);
2352             clients[\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num}].\hyperlink{struct_node__format_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port} = dht->\hyperlink{struct_d_h_t_a00ef35d5b0e7a791ef08a30b3bacbf9d}{close\_clientlist}[
      \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}].\hyperlink{struct_client__data_a87d394929a2604f6f785fec949fac618}{assoc6}.\hyperlink{struct_i_p_p_ts_png_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port};
2353             ++\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num};
2354         \}
2355     \}
2356 
2357     \textcolor{keywordflow}{for} (i = 0; i < \hyperlink{_d_h_t_8h_a09839809f361926e324196bfd9450bb4}{DHT\_FAKE\_FRIEND\_NUMBER} && i < dht->
      \hyperlink{struct_d_h_t_a8ee1f2d7e543bce350c591a8eaac0cf8}{num\_friends}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
2358         \hyperlink{struct_d_h_t___friend}{DHT\_Friend} *fr = &dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}];
2359 
2360         \textcolor{keywordflow}{for} (j = 0; j < \hyperlink{_d_h_t_8h_ad50d158518277ca4d19cbe364f3e958c}{MAX\_FRIEND\_CLIENTS}; ++j) \{
2361             \textcolor{keywordflow}{if} (fr->\hyperlink{struct_d_h_t___friend_a49ef2b640a834a77b6e123355a4fea47}{client\_list}[j].\hyperlink{struct_client__data_ac9843379cbcd02bdfa5c180a1474a6c5}{assoc4}.\hyperlink{struct_i_p_p_ts_png_a465bef81f6478756e5443025b1f2ddfa}{timestamp} != 0) \{
2362                 memcpy(clients[num].\hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, fr->\hyperlink{struct_d_h_t___friend_a49ef2b640a834a77b6e123355a4fea47}{client\_list}[j].
      \hyperlink{struct_client__data_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, crypto\_box\_PUBLICKEYBYTES);
2363                 clients[\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num}].\hyperlink{struct_node__format_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port} = fr->\hyperlink{struct_d_h_t___friend_a49ef2b640a834a77b6e123355a4fea47}{client\_list}[j].
      \hyperlink{struct_client__data_ac9843379cbcd02bdfa5c180a1474a6c5}{assoc4}.\hyperlink{struct_i_p_p_ts_png_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port};
2364                 ++\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num};
2365             \}
2366 
2367             \textcolor{keywordflow}{if} (fr->\hyperlink{struct_d_h_t___friend_a49ef2b640a834a77b6e123355a4fea47}{client\_list}[j].\hyperlink{struct_client__data_a87d394929a2604f6f785fec949fac618}{assoc6}.\hyperlink{struct_i_p_p_ts_png_a465bef81f6478756e5443025b1f2ddfa}{timestamp} != 0) \{
2368                 memcpy(clients[num].\hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, fr->\hyperlink{struct_d_h_t___friend_a49ef2b640a834a77b6e123355a4fea47}{client\_list}[j].
      \hyperlink{struct_client__data_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, crypto\_box\_PUBLICKEYBYTES);
2369                 clients[\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num}].\hyperlink{struct_node__format_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port} = fr->\hyperlink{struct_d_h_t___friend_a49ef2b640a834a77b6e123355a4fea47}{client\_list}[j].
      \hyperlink{struct_client__data_a87d394929a2604f6f785fec949fac618}{assoc6}.\hyperlink{struct_i_p_p_ts_png_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port};
2370                 ++\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num};
2371             \}
2372         \}
2373     \}
2374 
2375     \hyperlink{_d_h_t_8c_a910e4555ff14d9974e6f1dd227d8dd99}{z\_state\_save\_subheader}(old\_data, \hyperlink{_d_h_t_8c_a1d6f2fcb008c989f333ae89e840f94b4}{pack\_nodes}(
      \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}, \textcolor{keyword}{sizeof}(\hyperlink{struct_node__format}{Node\_format}) * num, clients, num), 
      \hyperlink{_d_h_t_8c_a2244b83e3fbf401e240bb5fa9a576e9e}{DHT\_STATE\_TYPE\_NODES});
2376 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a7510a9fdbacfffb5987590c4e193c40a_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a7510a9fdbacfffb5987590c4e193c40a_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_a55d92a2419bf9384e3cbfe0ec5a8f4d6}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!D\+H\+T\+\_\+size@{D\+H\+T\+\_\+size}}
\index{D\+H\+T\+\_\+size@{D\+H\+T\+\_\+size}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{D\+H\+T\+\_\+size}]{\setlength{\rightskip}{0pt plus 5cm}uint32\+\_\+t D\+H\+T\+\_\+size (
\begin{DoxyParamCaption}
\item[{const {\bf D\+H\+T} $\ast$}]{dht}
\end{DoxyParamCaption}
)}}\label{_d_h_t_8c_a55d92a2419bf9384e3cbfe0ec5a8f4d6}


Definition at line 2295 of file D\+H\+T.\+c.



References Client\+\_\+data\+::assoc4, Client\+\_\+data\+::assoc6, D\+H\+T\+\_\+\+Friend\+::client\+\_\+list, D\+H\+T\+::close\+\_\+clientlist, D\+H\+T\+\_\+\+F\+A\+K\+E\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+N\+U\+M\+B\+E\+R, D\+H\+T\+::friends\+\_\+list, i, L\+C\+L\+I\+E\+N\+T\+\_\+\+L\+I\+S\+T, M\+A\+X\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+C\+L\+I\+E\+N\+T\+S, D\+H\+T\+::num\+\_\+friends, packed\+\_\+node\+\_\+size(), and I\+P\+P\+Ts\+Png\+::timestamp.



Referenced by messenger\+\_\+save(), messenger\+\_\+size(), and S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T().


\begin{DoxyCode}
2296 \{
2297     uint32\_t numv4 = 0, numv6 = 0, \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}, j;
2298 
2299     \textcolor{keywordflow}{for} (\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i} = 0; \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i} < \hyperlink{_d_h_t_8h_a3058f857a8316099e20c95fb07adc7c1}{LCLIENT\_LIST}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
2300         numv4 += (dht->\hyperlink{struct_d_h_t_a00ef35d5b0e7a791ef08a30b3bacbf9d}{close\_clientlist}[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}].\hyperlink{struct_client__data_ac9843379cbcd02bdfa5c180a1474a6c5}{assoc4}.
      \hyperlink{struct_i_p_p_ts_png_a465bef81f6478756e5443025b1f2ddfa}{timestamp} != 0);
2301         numv6 += (dht->\hyperlink{struct_d_h_t_a00ef35d5b0e7a791ef08a30b3bacbf9d}{close\_clientlist}[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}].\hyperlink{struct_client__data_a87d394929a2604f6f785fec949fac618}{assoc6}.
      \hyperlink{struct_i_p_p_ts_png_a465bef81f6478756e5443025b1f2ddfa}{timestamp} != 0);
2302     \}
2303 
2304     \textcolor{keywordflow}{for} (\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i} = 0; \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i} < \hyperlink{_d_h_t_8h_a09839809f361926e324196bfd9450bb4}{DHT\_FAKE\_FRIEND\_NUMBER} && \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i} < dht->
      \hyperlink{struct_d_h_t_a8ee1f2d7e543bce350c591a8eaac0cf8}{num\_friends}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
2305         \hyperlink{struct_d_h_t___friend}{DHT\_Friend} *fr = &dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}];
2306 
2307         \textcolor{keywordflow}{for} (j = 0; j < \hyperlink{_d_h_t_8h_ad50d158518277ca4d19cbe364f3e958c}{MAX\_FRIEND\_CLIENTS}; ++j) \{
2308             numv4 += (fr->\hyperlink{struct_d_h_t___friend_a49ef2b640a834a77b6e123355a4fea47}{client\_list}[j].\hyperlink{struct_client__data_ac9843379cbcd02bdfa5c180a1474a6c5}{assoc4}.\hyperlink{struct_i_p_p_ts_png_a465bef81f6478756e5443025b1f2ddfa}{timestamp} != 0);
2309             numv6 += (fr->\hyperlink{struct_d_h_t___friend_a49ef2b640a834a77b6e123355a4fea47}{client\_list}[j].\hyperlink{struct_client__data_a87d394929a2604f6f785fec949fac618}{assoc6}.\hyperlink{struct_i_p_p_ts_png_a465bef81f6478756e5443025b1f2ddfa}{timestamp} != 0);
2310         \}
2311     \}
2312 
2313     uint32\_t size32 = \textcolor{keyword}{sizeof}(uint32\_t), sizesubhead = size32 * 2;
2314 
2315     \textcolor{keywordflow}{return} size32 + sizesubhead + (\hyperlink{_d_h_t_8c_aa980937ac320a4389b726e04da26cb44}{packed\_node\_size}(AF\_INET) * numv4) + (
      \hyperlink{_d_h_t_8c_aa980937ac320a4389b726e04da26cb44}{packed\_node\_size}(AF\_INET6) * numv6);
2316 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=275pt]{dc/dc1/_d_h_t_8c_a55d92a2419bf9384e3cbfe0ec5a8f4d6_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a55d92a2419bf9384e3cbfe0ec5a8f4d6_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_ae05715389aba7cec9083bdf9efad7a78}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!do\+\_\+\+Close@{do\+\_\+\+Close}}
\index{do\+\_\+\+Close@{do\+\_\+\+Close}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{do\+\_\+\+Close}]{\setlength{\rightskip}{0pt plus 5cm}static void do\+\_\+\+Close (
\begin{DoxyParamCaption}
\item[{{\bf D\+H\+T} $\ast$}]{dht}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_d_h_t_8c_ae05715389aba7cec9083bdf9efad7a78}


Definition at line 1389 of file D\+H\+T.\+c.



References Client\+\_\+data\+::assoc4, B\+A\+D\+\_\+\+N\+O\+D\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T, D\+H\+T\+::close\+\_\+bootstrap\+\_\+times, D\+H\+T\+::close\+\_\+clientlist, D\+H\+T\+::close\+\_\+lastgetnodes, do\+\_\+ping\+\_\+and\+\_\+sendnode\+\_\+requests(), i, L\+C\+L\+I\+E\+N\+T\+\_\+\+L\+I\+S\+T, D\+H\+T\+::self\+\_\+public\+\_\+key, I\+P\+P\+Ts\+Png\+::timestamp, and unix\+\_\+time().



Referenced by do\+\_\+\+D\+H\+T().


\begin{DoxyCode}
1390 \{
1391     uint8\_t not\_killed = \hyperlink{_d_h_t_8c_a1d3aa20a7622e95d168e3220f61f6227}{do\_ping\_and\_sendnode\_requests}(dht, &dht->
      \hyperlink{struct_d_h_t_a3ab563f182d86c5bc6322ee416a10a32}{close\_lastgetnodes}, dht->\hyperlink{struct_d_h_t_ae726df8bdc26380e5a6c3187a00d6881}{self\_public\_key},
1392                          dht->\hyperlink{struct_d_h_t_a00ef35d5b0e7a791ef08a30b3bacbf9d}{close\_clientlist}, \hyperlink{_d_h_t_8h_a3058f857a8316099e20c95fb07adc7c1}{LCLIENT\_LIST}, &dht->
      \hyperlink{struct_d_h_t_afacccecf0d2090a9dec8d06f3f119087}{close\_bootstrap\_times});
1393 
1394     \textcolor{keywordflow}{if} (!not\_killed) \{
1395         \textcolor{comment}{/* all existing nodes are at least KILL\_NODE\_TIMEOUT,}
1396 \textcolor{comment}{         * which means we are mute, as we only send packets to}
1397 \textcolor{comment}{         * nodes NOT in KILL\_NODE\_TIMEOUT}
1398 \textcolor{comment}{         *}
1399 \textcolor{comment}{         * so: reset all nodes to be BAD\_NODE\_TIMEOUT, but not}
1400 \textcolor{comment}{         * KILL\_NODE\_TIMEOUT, so we at least keep trying pings */}
1401         uint64\_t badonly = \hyperlink{util_8c_ac958d9f8847cb8039444bfa3d304233a}{unix\_time}() - \hyperlink{_d_h_t_8h_a2c542fd03a43f340d1fb281afe54453f}{BAD\_NODE\_TIMEOUT};
1402         \textcolor{keywordtype}{size\_t} \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}, a;
1403 
1404         \textcolor{keywordflow}{for} (i = 0; i < \hyperlink{_d_h_t_8h_a3058f857a8316099e20c95fb07adc7c1}{LCLIENT\_LIST}; i++) \{
1405             \hyperlink{struct_client__data}{Client\_data} *client = &dht->\hyperlink{struct_d_h_t_a00ef35d5b0e7a791ef08a30b3bacbf9d}{close\_clientlist}[
      \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}];
1406             \hyperlink{struct_i_p_p_ts_png}{IPPTsPng} *assoc;
1407 
1408             \textcolor{keywordflow}{for} (a = 0, assoc = &client->\hyperlink{struct_client__data_ac9843379cbcd02bdfa5c180a1474a6c5}{assoc4}; a < 2; a++, assoc = &client->assoc6)
1409                 \textcolor{keywordflow}{if} (assoc->\hyperlink{struct_i_p_p_ts_png_a465bef81f6478756e5443025b1f2ddfa}{timestamp})
1410                     assoc->\hyperlink{struct_i_p_p_ts_png_a465bef81f6478756e5443025b1f2ddfa}{timestamp} = badonly;
1411         \}
1412     \}
1413 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_ae05715389aba7cec9083bdf9efad7a78_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_ae05715389aba7cec9083bdf9efad7a78_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_a5be9dfb66fbf1fa7c267b016f3357534}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!do\+\_\+\+D\+H\+T@{do\+\_\+\+D\+H\+T}}
\index{do\+\_\+\+D\+H\+T@{do\+\_\+\+D\+H\+T}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{do\+\_\+\+D\+H\+T}]{\setlength{\rightskip}{0pt plus 5cm}void do\+\_\+\+D\+H\+T (
\begin{DoxyParamCaption}
\item[{{\bf D\+H\+T} $\ast$}]{dht}
\end{DoxyParamCaption}
)}}\label{_d_h_t_8c_a5be9dfb66fbf1fa7c267b016f3357534}


Definition at line 2242 of file D\+H\+T.\+c.



References D\+H\+T\+\_\+connect\+\_\+after\+\_\+load(), do\+\_\+\+Assoc(), do\+\_\+\+Close(), do\+\_\+\+D\+H\+T\+\_\+friends(), do\+\_\+hardening(), do\+\_\+\+N\+A\+T(), do\+\_\+to\+\_\+ping(), D\+H\+T\+::last\+\_\+run, D\+H\+T\+::loaded\+\_\+num\+\_\+nodes, D\+H\+T\+::ping, unix\+\_\+time(), and unix\+\_\+time\+\_\+update().



Referenced by do\+\_\+messenger(), do\+\_\+onion(), do\+\_\+onions(), and main().


\begin{DoxyCode}
2243 \{
2244     \hyperlink{util_8c_a849af10dd491723cf3abdef599846897}{unix\_time\_update}();
2245 
2246     \textcolor{keywordflow}{if} (dht->\hyperlink{struct_d_h_t_a73e8197b772061572cb931a378ade3e4}{last\_run} == \hyperlink{util_8c_ac958d9f8847cb8039444bfa3d304233a}{unix\_time}()) \{
2247         \textcolor{keywordflow}{return};
2248     \}
2249 
2250     \textcolor{comment}{// Load friends/clients if first call to do\_DHT}
2251     \textcolor{keywordflow}{if} (dht->\hyperlink{struct_d_h_t_aef4ce67d5df5f093247c73b3a024b73e}{loaded\_num\_nodes}) \{
2252         \hyperlink{_d_h_t_8c_ad5df2ff5066cf93898e531d320ddd675}{DHT\_connect\_after\_load}(dht);
2253     \}
2254 
2255     \hyperlink{_d_h_t_8c_ae05715389aba7cec9083bdf9efad7a78}{do\_Close}(dht);
2256     \hyperlink{_d_h_t_8c_ad1bcb472a3fd0ff8ab579551c4528b62}{do\_DHT\_friends}(dht);
2257     \hyperlink{_d_h_t_8c_a9243f57fde4a9312f11575eb4e7b1275}{do\_NAT}(dht);
2258     \hyperlink{ping_8c_af1ade820101b833a4615cb9fb58bebad}{do\_to\_ping}(dht->\hyperlink{struct_d_h_t_ae3f68e3d55e46726b05717fc88198321}{ping});
2259     \hyperlink{_d_h_t_8c_a9480aac51c9c74c667267ce89a76604a}{do\_hardening}(dht);
2260 \textcolor{preprocessor}{#ifdef ENABLE\_ASSOC\_DHT}
2261 
2262     \textcolor{keywordflow}{if} (dht->assoc)
2263         \hyperlink{assoc_8c_a36aff33785fb0db2565cf4cb5b080327}{do\_Assoc}(dht->assoc, dht);
2264 
2265 \textcolor{preprocessor}{#endif}
2266     dht->\hyperlink{struct_d_h_t_a73e8197b772061572cb931a378ade3e4}{last\_run} = \hyperlink{util_8c_ac958d9f8847cb8039444bfa3d304233a}{unix\_time}();
2267 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a5be9dfb66fbf1fa7c267b016f3357534_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a5be9dfb66fbf1fa7c267b016f3357534_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_ad1bcb472a3fd0ff8ab579551c4528b62}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!do\+\_\+\+D\+H\+T\+\_\+friends@{do\+\_\+\+D\+H\+T\+\_\+friends}}
\index{do\+\_\+\+D\+H\+T\+\_\+friends@{do\+\_\+\+D\+H\+T\+\_\+friends}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{do\+\_\+\+D\+H\+T\+\_\+friends}]{\setlength{\rightskip}{0pt plus 5cm}static void do\+\_\+\+D\+H\+T\+\_\+friends (
\begin{DoxyParamCaption}
\item[{{\bf D\+H\+T} $\ast$}]{dht}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_d_h_t_8c_ad1bcb472a3fd0ff8ab579551c4528b62}


Definition at line 1377 of file D\+H\+T.\+c.



References D\+H\+T\+\_\+\+Friend\+::bootstrap\+\_\+times, D\+H\+T\+\_\+\+Friend\+::client\+\_\+list, do\+\_\+ping\+\_\+and\+\_\+sendnode\+\_\+requests(), D\+H\+T\+::friends\+\_\+list, i, D\+H\+T\+\_\+\+Friend\+::lastgetnode, M\+A\+X\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+C\+L\+I\+E\+N\+T\+S, D\+H\+T\+::num\+\_\+friends, and D\+H\+T\+\_\+\+Friend\+::public\+\_\+key.



Referenced by do\+\_\+\+D\+H\+T().


\begin{DoxyCode}
1378 \{
1379     uint32\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
1380 
1381     \textcolor{keywordflow}{for} (i = 0; i < dht->\hyperlink{struct_d_h_t_a8ee1f2d7e543bce350c591a8eaac0cf8}{num\_friends}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i})
1382         \hyperlink{_d_h_t_8c_a1d3aa20a7622e95d168e3220f61f6227}{do\_ping\_and\_sendnode\_requests}(dht, &dht->
      \hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[i].\hyperlink{struct_d_h_t___friend_acdb8d1d26f42ba99ca73f45cb5643d1e}{lastgetnode}, dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[i].
      \hyperlink{struct_d_h_t___friend_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key},
1383                                       dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[i].
      \hyperlink{struct_d_h_t___friend_a49ef2b640a834a77b6e123355a4fea47}{client\_list}, \hyperlink{_d_h_t_8h_ad50d158518277ca4d19cbe364f3e958c}{MAX\_FRIEND\_CLIENTS}, &dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[i].
      \hyperlink{struct_d_h_t___friend_aae62716bf77c5ba5fca784702d47a5ff}{bootstrap\_times});
1384 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_ad1bcb472a3fd0ff8ab579551c4528b62_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_ad1bcb472a3fd0ff8ab579551c4528b62_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_a9480aac51c9c74c667267ce89a76604a}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!do\+\_\+hardening@{do\+\_\+hardening}}
\index{do\+\_\+hardening@{do\+\_\+hardening}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{do\+\_\+hardening}]{\setlength{\rightskip}{0pt plus 5cm}void do\+\_\+hardening (
\begin{DoxyParamCaption}
\item[{{\bf D\+H\+T} $\ast$}]{dht}
\end{DoxyParamCaption}
)}}\label{_d_h_t_8c_a9480aac51c9c74c667267ce89a76604a}


Definition at line 2102 of file D\+H\+T.\+c.



References Client\+\_\+data\+::assoc4, Client\+\_\+data\+::assoc6, B\+A\+D\+\_\+\+N\+O\+D\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T, D\+H\+T\+::close\+\_\+clientlist, H\+A\+R\+D\+E\+N\+\_\+\+T\+I\+M\+E\+O\+U\+T, I\+P\+P\+Ts\+Png\+::hardening, H\+A\+R\+D\+E\+N\+I\+N\+G\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L, i, id\+\_\+equal(), I\+P\+P\+Ts\+Png\+::ip\+\_\+port, Node\+\_\+format\+::ip\+\_\+port, ipport\+\_\+isset(), is\+\_\+timeout(), L\+C\+L\+I\+E\+N\+T\+\_\+\+L\+I\+S\+T, Client\+\_\+data\+::public\+\_\+key, Node\+\_\+format\+::public\+\_\+key, random\+\_\+node(), D\+H\+T\+::self\+\_\+public\+\_\+key, send\+\_\+hardening\+\_\+getnode\+\_\+req(), Hardening\+::send\+\_\+nodes\+\_\+ok, Hardening\+::send\+\_\+nodes\+\_\+pingedid, Hardening\+::send\+\_\+nodes\+\_\+timestamp, I\+P\+P\+Ts\+Png\+::timestamp, and unix\+\_\+time().



Referenced by do\+\_\+\+D\+H\+T().


\begin{DoxyCode}
2103 \{
2104     uint32\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
2105 
2106     \textcolor{keywordflow}{for} (i = 0; i < \hyperlink{_d_h_t_8h_a3058f857a8316099e20c95fb07adc7c1}{LCLIENT\_LIST} * 2; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
2107         \hyperlink{struct_i_p_p_ts_png}{IPPTsPng}  *cur\_iptspng;
2108         sa\_family\_t sa\_family;
2109         uint8\_t   *\hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key} = dht->\hyperlink{struct_d_h_t_a00ef35d5b0e7a791ef08a30b3bacbf9d}{close\_clientlist}[i / 2].
      \hyperlink{struct_client__data_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key};
2110 
2111         \textcolor{keywordflow}{if} (i % 2 == 0) \{
2112             cur\_iptspng = &dht->\hyperlink{struct_d_h_t_a00ef35d5b0e7a791ef08a30b3bacbf9d}{close\_clientlist}[i / 2].\hyperlink{struct_client__data_ac9843379cbcd02bdfa5c180a1474a6c5}{assoc4};
2113             sa\_family = AF\_INET;
2114         \} \textcolor{keywordflow}{else} \{
2115             cur\_iptspng = &dht->\hyperlink{struct_d_h_t_a00ef35d5b0e7a791ef08a30b3bacbf9d}{close\_clientlist}[i / 2].\hyperlink{struct_client__data_a87d394929a2604f6f785fec949fac618}{assoc6};
2116             sa\_family = AF\_INET6;
2117         \}
2118 
2119         \textcolor{keywordflow}{if} (\hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(cur\_iptspng->\hyperlink{struct_i_p_p_ts_png_a465bef81f6478756e5443025b1f2ddfa}{timestamp}, 
      \hyperlink{_d_h_t_8h_a2c542fd03a43f340d1fb281afe54453f}{BAD\_NODE\_TIMEOUT}))
2120             \textcolor{keywordflow}{continue};
2121 
2122         \textcolor{keywordflow}{if} (cur\_iptspng->\hyperlink{struct_i_p_p_ts_png_a247a5bc6669d45b7241b58223ce8fd1d}{hardening}.\hyperlink{struct_hardening_a11158e002f3685f4044a759680636c08}{send\_nodes\_ok} == 0) \{
2123             \textcolor{keywordflow}{if} (\hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(cur\_iptspng->\hyperlink{struct_i_p_p_ts_png_a247a5bc6669d45b7241b58223ce8fd1d}{hardening}.
      \hyperlink{struct_hardening_ab15e3d8f0b33943a6978fac3cde4d1a2}{send\_nodes\_timestamp}, \hyperlink{_d_h_t_8c_aa2f9a8d6135222d3875900ba8ef11e11}{HARDENING\_INTERVAL})) \{
2124                 \hyperlink{struct_node__format}{Node\_format} rand\_node = \hyperlink{_d_h_t_8c_af89838d6c1c8e0ec82dfadbe2953e06d}{random\_node}(dht, sa\_family);
2125 
2126                 \textcolor{keywordflow}{if} (!\hyperlink{network_8c_a8436367218afb29bcf1b5fecd071648e}{ipport\_isset}(&rand\_node.\hyperlink{struct_node__format_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}))
2127                     \textcolor{keywordflow}{continue};
2128 
2129                 \textcolor{keywordflow}{if} (\hyperlink{util_8c_ada3d44b4f530d3c8c9cb69b732be94b1}{id\_equal}(public\_key, rand\_node.\hyperlink{struct_node__format_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}))
2130                     \textcolor{keywordflow}{continue};
2131 
2132                 \hyperlink{struct_node__format}{Node\_format} to\_test;
2133                 to\_test.\hyperlink{struct_node__format_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port} = cur\_iptspng->\hyperlink{struct_i_p_p_ts_png_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port};
2134                 memcpy(to\_test.\hyperlink{struct_node__format_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, public\_key, crypto\_box\_PUBLICKEYBYTES);
2135 
2136                 \textcolor{comment}{//TODO: The search id should maybe not be ours?}
2137                 \textcolor{keywordflow}{if} (\hyperlink{_d_h_t_8c_a3322fa3865c8dbbcd21b1a9a4955c193}{send\_hardening\_getnode\_req}(dht, &rand\_node, &to\_test, dht->
      \hyperlink{struct_d_h_t_ae726df8bdc26380e5a6c3187a00d6881}{self\_public\_key}) > 0) \{
2138                     memcpy(cur\_iptspng->\hyperlink{struct_i_p_p_ts_png_a247a5bc6669d45b7241b58223ce8fd1d}{hardening}.\hyperlink{struct_hardening_a2c2bfa7e3ff42e353bc44a2183ebc4df}{send\_nodes\_pingedid}, 
      rand\_node.\hyperlink{struct_node__format_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, crypto\_box\_PUBLICKEYBYTES);
2139                     cur\_iptspng->\hyperlink{struct_i_p_p_ts_png_a247a5bc6669d45b7241b58223ce8fd1d}{hardening}.\hyperlink{struct_hardening_ab15e3d8f0b33943a6978fac3cde4d1a2}{send\_nodes\_timestamp} = 
      \hyperlink{util_8c_ac958d9f8847cb8039444bfa3d304233a}{unix\_time}();
2140                 \}
2141             \}
2142         \} \textcolor{keywordflow}{else} \{
2143             \textcolor{keywordflow}{if} (\hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(cur\_iptspng->\hyperlink{struct_i_p_p_ts_png_a247a5bc6669d45b7241b58223ce8fd1d}{hardening}.
      \hyperlink{struct_hardening_ab15e3d8f0b33943a6978fac3cde4d1a2}{send\_nodes\_timestamp}, \hyperlink{_d_h_t_8c_a916b8aad63b31d6308952fa4bf526b09}{HARDEN\_TIMEOUT})) \{
2144                 cur\_iptspng->\hyperlink{struct_i_p_p_ts_png_a247a5bc6669d45b7241b58223ce8fd1d}{hardening}.\hyperlink{struct_hardening_a11158e002f3685f4044a759680636c08}{send\_nodes\_ok} = 0;
2145             \}
2146         \}
2147 
2148         \textcolor{comment}{//TODO: add the 2 other testers.}
2149     \}
2150 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a9480aac51c9c74c667267ce89a76604a_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a9480aac51c9c74c667267ce89a76604a_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_a9243f57fde4a9312f11575eb4e7b1275}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!do\+\_\+\+N\+A\+T@{do\+\_\+\+N\+A\+T}}
\index{do\+\_\+\+N\+A\+T@{do\+\_\+\+N\+A\+T}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{do\+\_\+\+N\+A\+T}]{\setlength{\rightskip}{0pt plus 5cm}static void do\+\_\+\+N\+A\+T (
\begin{DoxyParamCaption}
\item[{{\bf D\+H\+T} $\ast$}]{dht}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_d_h_t_8c_a9243f57fde4a9312f11575eb4e7b1275}


Definition at line 1827 of file D\+H\+T.\+c.



References friend\+\_\+iplist(), D\+H\+T\+::friends\+\_\+list, N\+A\+T\+::hole\+\_\+punching, i, ip, ip\+\_\+isset(), M\+A\+X\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+C\+L\+I\+E\+N\+T\+S, D\+H\+T\+\_\+\+Friend\+::nat, N\+A\+T\+\_\+commonip(), N\+A\+T\+\_\+getports(), N\+A\+T\+\_\+\+P\+I\+N\+G\+\_\+\+R\+E\+Q\+U\+E\+S\+T, N\+A\+T\+::\+N\+A\+Tping\+\_\+id, N\+A\+T\+::\+N\+A\+Tping\+\_\+timestamp, num, D\+H\+T\+::num\+\_\+friends, D\+H\+T\+\_\+\+Friend\+::public\+\_\+key, punch\+\_\+holes(), P\+U\+N\+C\+H\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L, N\+A\+T\+::punching\+\_\+timestamp, N\+A\+T\+::recv\+N\+A\+Tping\+\_\+timestamp, send\+\_\+\+N\+A\+Tping(), and unix\+\_\+time().



Referenced by do\+\_\+\+D\+H\+T().


\begin{DoxyCode}
1828 \{
1829     uint32\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
1830     uint64\_t temp\_time = \hyperlink{util_8c_ac958d9f8847cb8039444bfa3d304233a}{unix\_time}();
1831 
1832     \textcolor{keywordflow}{for} (i = 0; i < dht->\hyperlink{struct_d_h_t_a8ee1f2d7e543bce350c591a8eaac0cf8}{num\_friends}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
1833         \hyperlink{struct_i_p___port}{IP\_Port} ip\_list[\hyperlink{_d_h_t_8h_ad50d158518277ca4d19cbe364f3e958c}{MAX\_FRIEND\_CLIENTS}];
1834         \textcolor{keywordtype}{int} \hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num} = \hyperlink{_d_h_t_8c_a1b3c1814260eace443e6feb13227cc82}{friend\_iplist}(dht, ip\_list, i);
1835 
1836         \textcolor{comment}{/* If already connected or friend is not online don't try to hole punch. */}
1837         \textcolor{keywordflow}{if} (num < \hyperlink{_d_h_t_8h_ad50d158518277ca4d19cbe364f3e958c}{MAX\_FRIEND\_CLIENTS} / 2)
1838             \textcolor{keywordflow}{continue};
1839 
1840         \textcolor{keywordflow}{if} (dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[i].\hyperlink{struct_d_h_t___friend_a96318690475243d010825feb2a67b41c}{nat}.\hyperlink{struct_n_a_t_a20937663f98914b69bb73f938deed531}{NATping\_timestamp} + 
      \hyperlink{_d_h_t_8c_afb88902dba0294dd97d42384ceacafa3}{PUNCH\_INTERVAL} < temp\_time) \{
1841             \hyperlink{_d_h_t_8c_a25f7b3704b34bb8745a0a60939e1f49c}{send\_NATping}(dht, dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[i].
      \hyperlink{struct_d_h_t___friend_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[i].\hyperlink{struct_d_h_t___friend_a96318690475243d010825feb2a67b41c}{nat}.\hyperlink{struct_n_a_t_addd9408d04ff8e05c569651b299f1b1b}{NATping\_id}, 
      \hyperlink{_d_h_t_8c_a2c654c475c840fc796772eef9079930f}{NAT\_PING\_REQUEST});
1842             dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}].\hyperlink{struct_d_h_t___friend_a96318690475243d010825feb2a67b41c}{nat}.\hyperlink{struct_n_a_t_a20937663f98914b69bb73f938deed531}{NATping\_timestamp} = temp\_time;
1843         \}
1844 
1845         \textcolor{keywordflow}{if} (dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[i].\hyperlink{struct_d_h_t___friend_a96318690475243d010825feb2a67b41c}{nat}.\hyperlink{struct_n_a_t_a40495f11f0e91fcea43d57248e202ea3}{hole\_punching} == 1 &&
1846                 dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[i].\hyperlink{struct_d_h_t___friend_a96318690475243d010825feb2a67b41c}{nat}.\hyperlink{struct_n_a_t_ab8cadc230283568e7aeb303691d8e374}{punching\_timestamp} + 
      \hyperlink{_d_h_t_8c_afb88902dba0294dd97d42384ceacafa3}{PUNCH\_INTERVAL} < temp\_time &&
1847                 dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[i].\hyperlink{struct_d_h_t___friend_a96318690475243d010825feb2a67b41c}{nat}.\hyperlink{struct_n_a_t_a237df5177fc9db865722933b5b6468ea}{recvNATping\_timestamp} + 
      \hyperlink{_d_h_t_8c_afb88902dba0294dd97d42384ceacafa3}{PUNCH\_INTERVAL} * 2 >= temp\_time) \{
1848 
1849             \hyperlink{struct_i_p}{IP} \hyperlink{irc__syncbot_8c_ae81515e082f9bc33e8968181945586da}{ip} = \hyperlink{_d_h_t_8c_ae24a26ad9533b87cfbcb0093430bf136}{NAT\_commonip}(ip\_list, num, 
      \hyperlink{_d_h_t_8h_ad50d158518277ca4d19cbe364f3e958c}{MAX\_FRIEND\_CLIENTS} / 2);
1850 
1851             \textcolor{keywordflow}{if} (!\hyperlink{network_8c_ac56c677f4bc8bf8311370ee105ae7cbb}{ip\_isset}(&ip))
1852                 \textcolor{keywordflow}{continue};
1853 
1854             uint16\_t port\_list[\hyperlink{_d_h_t_8h_ad50d158518277ca4d19cbe364f3e958c}{MAX\_FRIEND\_CLIENTS}];
1855             uint16\_t numports = \hyperlink{_d_h_t_8c_a987dbba116d9982c336ea818f05e8c7c}{NAT\_getports}(port\_list, ip\_list, num, ip);
1856             \hyperlink{_d_h_t_8c_a7efc873280e2d502bf49489d3ebacc9c}{punch\_holes}(dht, ip, port\_list, numports, i);
1857 
1858             dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}].\hyperlink{struct_d_h_t___friend_a96318690475243d010825feb2a67b41c}{nat}.\hyperlink{struct_n_a_t_ab8cadc230283568e7aeb303691d8e374}{punching\_timestamp} = temp\_time;
1859             dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}].\hyperlink{struct_d_h_t___friend_a96318690475243d010825feb2a67b41c}{nat}.\hyperlink{struct_n_a_t_a40495f11f0e91fcea43d57248e202ea3}{hole\_punching} = 0;
1860         \}
1861     \}
1862 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a9243f57fde4a9312f11575eb4e7b1275_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a9243f57fde4a9312f11575eb4e7b1275_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_a1d3aa20a7622e95d168e3220f61f6227}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!do\+\_\+ping\+\_\+and\+\_\+sendnode\+\_\+requests@{do\+\_\+ping\+\_\+and\+\_\+sendnode\+\_\+requests}}
\index{do\+\_\+ping\+\_\+and\+\_\+sendnode\+\_\+requests@{do\+\_\+ping\+\_\+and\+\_\+sendnode\+\_\+requests}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{do\+\_\+ping\+\_\+and\+\_\+sendnode\+\_\+requests}]{\setlength{\rightskip}{0pt plus 5cm}static uint8\+\_\+t do\+\_\+ping\+\_\+and\+\_\+sendnode\+\_\+requests (
\begin{DoxyParamCaption}
\item[{{\bf D\+H\+T} $\ast$}]{dht, }
\item[{uint64\+\_\+t $\ast$}]{lastgetnode, }
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key, }
\item[{{\bf Client\+\_\+data} $\ast$}]{list, }
\item[{uint32\+\_\+t}]{list\+\_\+count, }
\item[{uint32\+\_\+t $\ast$}]{bootstrap\+\_\+times}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_d_h_t_8c_a1d3aa20a7622e95d168e3220f61f6227}


Definition at line 1328 of file D\+H\+T.\+c.



References Client\+\_\+data\+::assoc6, B\+A\+D\+\_\+\+N\+O\+D\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T, G\+E\+T\+\_\+\+N\+O\+D\+E\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L, getnodes(), i, I\+P\+P\+Ts\+Png\+::ip\+\_\+port, is\+\_\+timeout(), K\+I\+L\+L\+\_\+\+N\+O\+D\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T, I\+P\+P\+Ts\+Png\+::last\+\_\+pinged, M\+A\+X\+\_\+\+B\+O\+O\+T\+S\+T\+R\+A\+P\+\_\+\+T\+I\+M\+E\+S, D\+H\+T\+::ping, P\+I\+N\+G\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L, Client\+\_\+data\+::public\+\_\+key, send\+\_\+ping\+\_\+request(), I\+P\+P\+Ts\+Png\+::timestamp, and unix\+\_\+time().



Referenced by do\+\_\+\+Close(), and do\+\_\+\+D\+H\+T\+\_\+friends().


\begin{DoxyCode}
1330 \{
1331     uint32\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
1332     uint8\_t not\_kill = 0;
1333     uint64\_t temp\_time = \hyperlink{util_8c_ac958d9f8847cb8039444bfa3d304233a}{unix\_time}();
1334 
1335     uint32\_t num\_nodes = 0;
1336     \hyperlink{struct_client__data}{Client\_data} *client\_list[list\_count * 2];
1337     \hyperlink{struct_i_p_p_ts_png}{IPPTsPng}    *assoc\_list[list\_count * 2];
1338 
1339     \textcolor{keywordflow}{for} (i = 0; i < list\_count; i++) \{
1340         \textcolor{comment}{/* If node is not dead. */}
1341         \hyperlink{struct_client__data}{Client\_data} *client = &list[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}];
1342         \hyperlink{struct_i_p_p_ts_png}{IPPTsPng} *assoc;
1343         uint32\_t a;
1344 
1345         \textcolor{keywordflow}{for} (a = 0, assoc = &client->\hyperlink{struct_client__data_a87d394929a2604f6f785fec949fac618}{assoc6}; a < 2; a++, assoc = &client->assoc4)
1346             \textcolor{keywordflow}{if} (!\hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(assoc->\hyperlink{struct_i_p_p_ts_png_a465bef81f6478756e5443025b1f2ddfa}{timestamp}, 
      \hyperlink{_d_h_t_8c_af1093baf3868bd51244122ec59316304}{KILL\_NODE\_TIMEOUT})) \{
1347                 not\_kill++;
1348 
1349                 \textcolor{keywordflow}{if} (\hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(assoc->\hyperlink{struct_i_p_p_ts_png_a4049204f6c392628d31be6c39f03e031}{last\_pinged}, 
      \hyperlink{_d_h_t_8h_ae138d10c7cd4199e5e96377ff1f8e317}{PING\_INTERVAL})) \{
1350                     \hyperlink{ping_8c_a1b3882fdfddc79be369ff230cd3e7a6a}{send\_ping\_request}(dht->\hyperlink{struct_d_h_t_ae3f68e3d55e46726b05717fc88198321}{ping}, assoc->
      \hyperlink{struct_i_p_p_ts_png_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}, client->\hyperlink{struct_client__data_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key} );
1351                     assoc->\hyperlink{struct_i_p_p_ts_png_a4049204f6c392628d31be6c39f03e031}{last\_pinged} = temp\_time;
1352                 \}
1353 
1354                 \textcolor{comment}{/* If node is good. */}
1355                 \textcolor{keywordflow}{if} (!\hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(assoc->\hyperlink{struct_i_p_p_ts_png_a465bef81f6478756e5443025b1f2ddfa}{timestamp}, 
      \hyperlink{_d_h_t_8h_a2c542fd03a43f340d1fb281afe54453f}{BAD\_NODE\_TIMEOUT})) \{
1356                     client\_list[num\_nodes] = client;
1357                     assoc\_list[num\_nodes] = assoc;
1358                     ++num\_nodes;
1359                 \}
1360             \}
1361     \}
1362 
1363     \textcolor{keywordflow}{if} ((num\_nodes != 0) && (\hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(*lastgetnode, 
      \hyperlink{_d_h_t_8c_a5743fd97642ab4b5cc04e9e19c82e0f3}{GET\_NODE\_INTERVAL}) || *bootstrap\_times < \hyperlink{_d_h_t_8c_ad54cdfc53c7a3f71e4f5dbfe22e84058}{MAX\_BOOTSTRAP\_TIMES})) \{
1364         uint32\_t rand\_node = rand() % num\_nodes;
1365         \hyperlink{_d_h_t_8c_a7af6c30b12e5cbda1e6d6d824794956e}{getnodes}(dht, assoc\_list[rand\_node]->ip\_port, client\_list[rand\_node]->
      \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key},
1366                  \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, NULL);
1367         *lastgetnode = temp\_time;
1368         ++*bootstrap\_times;
1369     \}
1370 
1371     \textcolor{keywordflow}{return} not\_kill;
1372 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a1d3aa20a7622e95d168e3220f61f6227_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a1d3aa20a7622e95d168e3220f61f6227_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_a1b3c1814260eace443e6feb13227cc82}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!friend\+\_\+iplist@{friend\+\_\+iplist}}
\index{friend\+\_\+iplist@{friend\+\_\+iplist}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{friend\+\_\+iplist}]{\setlength{\rightskip}{0pt plus 5cm}static int friend\+\_\+iplist (
\begin{DoxyParamCaption}
\item[{const {\bf D\+H\+T} $\ast$}]{dht, }
\item[{{\bf I\+P\+\_\+\+Port} $\ast$}]{ip\+\_\+portlist, }
\item[{uint16\+\_\+t}]{friend\+\_\+num}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_d_h_t_8c_a1b3c1814260eace443e6feb13227cc82}


Definition at line 1494 of file D\+H\+T.\+c.



References Client\+\_\+data\+::assoc4, Client\+\_\+data\+::assoc6, B\+A\+D\+\_\+\+N\+O\+D\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T, D\+H\+T\+::friends\+\_\+list, i, id\+\_\+equal(), I\+P\+\_\+\+Port\+::ip, ip\+\_\+isset(), is\+\_\+timeout(), M\+A\+X\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+C\+L\+I\+E\+N\+T\+S, D\+H\+T\+::num\+\_\+friends, Client\+\_\+data\+::public\+\_\+key, I\+P\+P\+Ts\+Png\+::ret\+\_\+ip\+\_\+port, I\+P\+P\+Ts\+Png\+::ret\+\_\+timestamp, and I\+P\+P\+Ts\+Png\+::timestamp.



Referenced by do\+\_\+\+N\+A\+T(), and route\+\_\+tofriend().


\begin{DoxyCode}
1495 \{
1496     \textcolor{keywordflow}{if} (friend\_num >= dht->\hyperlink{struct_d_h_t_a8ee1f2d7e543bce350c591a8eaac0cf8}{num\_friends})
1497         \textcolor{keywordflow}{return} -1;
1498 
1499     \hyperlink{struct_d_h_t___friend}{DHT\_Friend} *\textcolor{keyword}{friend} = &dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[friend\_num];
1500     \hyperlink{struct_client__data}{Client\_data} *client;
1501     \hyperlink{struct_i_p___port}{IP\_Port} ipv4s[\hyperlink{_d_h_t_8h_ad50d158518277ca4d19cbe364f3e958c}{MAX\_FRIEND\_CLIENTS}];
1502     \textcolor{keywordtype}{int} num\_ipv4s = 0;
1503     \hyperlink{struct_i_p___port}{IP\_Port} ipv6s[\hyperlink{_d_h_t_8h_ad50d158518277ca4d19cbe364f3e958c}{MAX\_FRIEND\_CLIENTS}];
1504     \textcolor{keywordtype}{int} num\_ipv6s = 0;
1505     \textcolor{keywordtype}{int} \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
1506 
1507     \textcolor{keywordflow}{for} (i = 0; i < \hyperlink{_d_h_t_8h_ad50d158518277ca4d19cbe364f3e958c}{MAX\_FRIEND\_CLIENTS}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
1508         client = &(\textcolor{keyword}{friend}->client\_list[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}]);
1509 
1510         \textcolor{comment}{/* If ip is not zero and node is good. */}
1511         \textcolor{keywordflow}{if} (\hyperlink{network_8c_ac56c677f4bc8bf8311370ee105ae7cbb}{ip\_isset}(&client->\hyperlink{struct_client__data_ac9843379cbcd02bdfa5c180a1474a6c5}{assoc4}.\hyperlink{struct_i_p_p_ts_png_a28f2dcc657352ee4855d05ed42e4a4af}{ret\_ip\_port}.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}) && !
      \hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(client->\hyperlink{struct_client__data_ac9843379cbcd02bdfa5c180a1474a6c5}{assoc4}.\hyperlink{struct_i_p_p_ts_png_a5a40b83400feebb632862f593ad5e4a7}{ret\_timestamp}, 
      \hyperlink{_d_h_t_8h_a2c542fd03a43f340d1fb281afe54453f}{BAD\_NODE\_TIMEOUT})) \{
1512             ipv4s[num\_ipv4s] = client->\hyperlink{struct_client__data_ac9843379cbcd02bdfa5c180a1474a6c5}{assoc4}.\hyperlink{struct_i_p_p_ts_png_a28f2dcc657352ee4855d05ed42e4a4af}{ret\_ip\_port};
1513             ++num\_ipv4s;
1514         \}
1515 
1516         \textcolor{keywordflow}{if} (\hyperlink{network_8c_ac56c677f4bc8bf8311370ee105ae7cbb}{ip\_isset}(&client->\hyperlink{struct_client__data_a87d394929a2604f6f785fec949fac618}{assoc6}.\hyperlink{struct_i_p_p_ts_png_a28f2dcc657352ee4855d05ed42e4a4af}{ret\_ip\_port}.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}) && !
      \hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(client->\hyperlink{struct_client__data_a87d394929a2604f6f785fec949fac618}{assoc6}.\hyperlink{struct_i_p_p_ts_png_a5a40b83400feebb632862f593ad5e4a7}{ret\_timestamp}, 
      \hyperlink{_d_h_t_8h_a2c542fd03a43f340d1fb281afe54453f}{BAD\_NODE\_TIMEOUT})) \{
1517             ipv6s[num\_ipv6s] = client->\hyperlink{struct_client__data_a87d394929a2604f6f785fec949fac618}{assoc6}.\hyperlink{struct_i_p_p_ts_png_a28f2dcc657352ee4855d05ed42e4a4af}{ret\_ip\_port};
1518             ++num\_ipv6s;
1519         \}
1520 
1521         \textcolor{keywordflow}{if} (\hyperlink{util_8c_ada3d44b4f530d3c8c9cb69b732be94b1}{id\_equal}(client->\hyperlink{struct_client__data_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, friend->public\_key))
1522             \textcolor{keywordflow}{if} (!\hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(client->\hyperlink{struct_client__data_a87d394929a2604f6f785fec949fac618}{assoc6}.\hyperlink{struct_i_p_p_ts_png_a465bef81f6478756e5443025b1f2ddfa}{timestamp}, 
      \hyperlink{_d_h_t_8h_a2c542fd03a43f340d1fb281afe54453f}{BAD\_NODE\_TIMEOUT}) || !\hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(client->\hyperlink{struct_client__data_ac9843379cbcd02bdfa5c180a1474a6c5}{assoc4}.
      \hyperlink{struct_i_p_p_ts_png_a465bef81f6478756e5443025b1f2ddfa}{timestamp}, \hyperlink{_d_h_t_8h_a2c542fd03a43f340d1fb281afe54453f}{BAD\_NODE\_TIMEOUT}))
1523                 \textcolor{keywordflow}{return} 0; \textcolor{comment}{/* direct connectivity */}
1524     \}
1525 
1526 \textcolor{preprocessor}{#ifdef FRIEND\_IPLIST\_PAD}
1527     memcpy(ip\_portlist, ipv6s, num\_ipv6s * \textcolor{keyword}{sizeof}(\hyperlink{struct_i_p___port}{IP\_Port}));
1528 
1529     \textcolor{keywordflow}{if} (num\_ipv6s == MAX\_FRIEND\_CLIENTS)
1530         \textcolor{keywordflow}{return} \hyperlink{_d_h_t_8h_ad50d158518277ca4d19cbe364f3e958c}{MAX\_FRIEND\_CLIENTS};
1531 
1532     \textcolor{keywordtype}{int} num\_ipv4s\_used = MAX\_FRIEND\_CLIENTS - num\_ipv6s;
1533 
1534     \textcolor{keywordflow}{if} (num\_ipv4s\_used > num\_ipv4s)
1535         num\_ipv4s\_used = num\_ipv4s;
1536 
1537     memcpy(&ip\_portlist[num\_ipv6s], ipv4s, num\_ipv4s\_used * \textcolor{keyword}{sizeof}(\hyperlink{struct_i_p___port}{IP\_Port}));
1538     \textcolor{keywordflow}{return} num\_ipv6s + num\_ipv4s\_used;
1539 
1540 \textcolor{preprocessor}{#else }\textcolor{comment}{/* !FRIEND\_IPLIST\_PAD */}\textcolor{preprocessor}{}
1541 
1542     \textcolor{comment}{/* there must be some secret reason why we can't pad the longer list}
1543 \textcolor{comment}{     * with the shorter one...}
1544 \textcolor{comment}{     */}
1545     \textcolor{keywordflow}{if} (num\_ipv6s >= num\_ipv4s) \{
1546         memcpy(ip\_portlist, ipv6s, num\_ipv6s * \textcolor{keyword}{sizeof}(\hyperlink{struct_i_p___port}{IP\_Port}));
1547         \textcolor{keywordflow}{return} num\_ipv6s;
1548     \}
1549 
1550     memcpy(ip\_portlist, ipv4s, num\_ipv4s * \textcolor{keyword}{sizeof}(\hyperlink{struct_i_p___port}{IP\_Port}));
1551     \textcolor{keywordflow}{return} num\_ipv4s;
1552 
1553 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* !FRIEND\_IPLIST\_PAD */}\textcolor{preprocessor}{}
1554 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=339pt]{dc/dc1/_d_h_t_8c_a1b3c1814260eace443e6feb13227cc82_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a1b3c1814260eace443e6feb13227cc82_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_a6cbd0f66d63003cc0def913dc7a4254b}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!friend\+\_\+number@{friend\+\_\+number}}
\index{friend\+\_\+number@{friend\+\_\+number}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{friend\+\_\+number}]{\setlength{\rightskip}{0pt plus 5cm}static int friend\+\_\+number (
\begin{DoxyParamCaption}
\item[{const {\bf D\+H\+T} $\ast$}]{dht, }
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_d_h_t_8c_a6cbd0f66d63003cc0def913dc7a4254b}


Definition at line 437 of file D\+H\+T.\+c.



References D\+H\+T\+::friends\+\_\+list, i, id\+\_\+equal(), D\+H\+T\+::num\+\_\+friends, and D\+H\+T\+\_\+\+Friend\+::public\+\_\+key.



Referenced by D\+H\+T\+\_\+addfriend(), D\+H\+T\+\_\+delfriend(), handle\+\_\+\+N\+A\+Tping(), route\+\_\+tofriend(), and routeone\+\_\+tofriend().


\begin{DoxyCode}
438 \{
439     uint32\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
440 
441     \textcolor{keywordflow}{for} (i = 0; i < dht->\hyperlink{struct_d_h_t_a8ee1f2d7e543bce350c591a8eaac0cf8}{num\_friends}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
442         \textcolor{keywordflow}{if} (\hyperlink{util_8c_ada3d44b4f530d3c8c9cb69b732be94b1}{id\_equal}(dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[i].\hyperlink{struct_d_h_t___friend_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, 
      \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}))
443             \textcolor{keywordflow}{return} \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
444     \}
445 
446     \textcolor{keywordflow}{return} -1;
447 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=247pt]{dc/dc1/_d_h_t_8c_a6cbd0f66d63003cc0def913dc7a4254b_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a6cbd0f66d63003cc0def913dc7a4254b_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_a8abfc9cea3784b0cae354670bd4643cd}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!get\+\_\+close\+\_\+nodes@{get\+\_\+close\+\_\+nodes}}
\index{get\+\_\+close\+\_\+nodes@{get\+\_\+close\+\_\+nodes}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{get\+\_\+close\+\_\+nodes}]{\setlength{\rightskip}{0pt plus 5cm}int get\+\_\+close\+\_\+nodes (
\begin{DoxyParamCaption}
\item[{const {\bf D\+H\+T} $\ast$}]{dht, }
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key, }
\item[{{\bf Node\+\_\+format} $\ast$}]{nodes\+\_\+list, }
\item[{sa\+\_\+family\+\_\+t}]{sa\+\_\+family, }
\item[{uint8\+\_\+t}]{is\+\_\+\+L\+A\+N, }
\item[{uint8\+\_\+t}]{want\+\_\+good}
\end{DoxyParamCaption}
)}}\label{_d_h_t_8c_a8abfc9cea3784b0cae354670bd4643cd}


Definition at line 570 of file D\+H\+T.\+c.



References Client\+\_\+data\+::assoc4, Client\+\_\+data\+::assoc6, Assoc\+\_\+get\+\_\+close\+\_\+entries(), Assoc\+\_\+close\+\_\+entries\+::count, Assoc\+\_\+close\+\_\+entries\+::count\+\_\+good, Assoc\+\_\+close\+\_\+entries\+::flags, get\+\_\+somewhat\+\_\+close\+\_\+nodes(), i, id\+\_\+copy(), I\+P\+P\+Ts\+Png\+::ip\+\_\+port, Node\+\_\+format\+::ip\+\_\+port, ipport\+\_\+isset(), L\+A\+N\+Ok, L\+O\+G\+G\+E\+R\+\_\+\+D\+E\+B\+U\+G, M\+A\+X\+\_\+\+S\+E\+N\+T\+\_\+\+N\+O\+D\+E\+S, Proto\+I\+Pv4, Proto\+I\+Pv6, make-\/funny-\/savefile\+::public\+\_\+key, Client\+\_\+data\+::public\+\_\+key, Assoc\+\_\+close\+\_\+entries\+::result, and Assoc\+\_\+close\+\_\+entries\+::wanted\+\_\+id.



Referenced by handle\+\_\+announce\+\_\+request(), populate\+\_\+path\+\_\+nodes(), random\+\_\+node(), and sendnodes\+\_\+ipv6().


\begin{DoxyCode}
572 \{
573     memset(nodes\_list, 0, \hyperlink{_d_h_t_8h_a57f4cf16e79a384d7d59a3cc585ea5a3}{MAX\_SENT\_NODES} * \textcolor{keyword}{sizeof}(\hyperlink{struct_node__format}{Node\_format}));
574 \textcolor{preprocessor}{#ifdef ENABLE\_ASSOC\_DHT}
575 
576     \textcolor{keywordflow}{if} (!dht->assoc)
577 \textcolor{preprocessor}{#endif}
578         \textcolor{keywordflow}{return} \hyperlink{_d_h_t_8c_ab7f89880bce923390748449ef6f60004}{get\_somewhat\_close\_nodes}(dht, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, nodes\_list, 
      sa\_family, is\_LAN, want\_good);
579 
580 \textcolor{preprocessor}{#ifdef ENABLE\_ASSOC\_DHT}
581     \textcolor{comment}{//TODO: assoc, sa\_family 0 (don't care if ipv4 or ipv6) support.}
582     \hyperlink{struct_client__data}{Client\_data} *result[\hyperlink{_d_h_t_8h_a57f4cf16e79a384d7d59a3cc585ea5a3}{MAX\_SENT\_NODES}];
583 
584     \hyperlink{struct_assoc__close__entries}{Assoc\_close\_entries} request;
585     memset(&request, 0, \textcolor{keyword}{sizeof}(request));
586     request.\hyperlink{struct_assoc__close__entries_a20302e2c99a60d3f612dba57e3f6333b}{count} = \hyperlink{_d_h_t_8h_a57f4cf16e79a384d7d59a3cc585ea5a3}{MAX\_SENT\_NODES};
587     request.\hyperlink{struct_assoc__close__entries_a086e0ce002c9491e4b99956740bb53d4}{count\_good} = \hyperlink{_d_h_t_8h_a57f4cf16e79a384d7d59a3cc585ea5a3}{MAX\_SENT\_NODES} - 2; \textcolor{comment}{/* allow 2 'indirect' nodes */}
588     request.\hyperlink{struct_assoc__close__entries_a40d6704f891338dadfa89f46b696be4c}{result} = result;
589     request.\hyperlink{struct_assoc__close__entries_a037b65164e78b02017bd4751843037b4}{wanted\_id} = \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key};
590     request.\hyperlink{struct_assoc__close__entries_aa2585d779da0ab21273a8d92de9a0ebe}{flags} = (is\_LAN ? \hyperlink{assoc_8h_a7b447edde2593107a52acfee89281d2ca8f8f3b5e55e2761eed576314ae2afaf6}{LANOk} : 0) + (sa\_family == AF\_INET ? 
      \hyperlink{assoc_8h_a7b447edde2593107a52acfee89281d2ca8f72d319431bcfbaf2fb152a649d090c}{ProtoIPv4} : \hyperlink{assoc_8h_a7b447edde2593107a52acfee89281d2ca1e654e12e0aea9fe657086a3c3ed9eca}{ProtoIPv6});
591 
592     uint8\_t num\_found = \hyperlink{assoc_8c_a256dcbfb2174603496ffa30efef90ad2}{Assoc\_get\_close\_entries}(dht->assoc, &request);
593 
594     \textcolor{keywordflow}{if} (!num\_found) \{
595         \hyperlink{logger_8h_a9885ca09ce5f94d936c91a5b0856a024}{LOGGER\_DEBUG}(\textcolor{stringliteral}{"get\_close\_nodes(): Assoc\_get\_close\_entries() returned zero nodes"});
596         \textcolor{keywordflow}{return} \hyperlink{_d_h_t_8c_ab7f89880bce923390748449ef6f60004}{get\_somewhat\_close\_nodes}(dht, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, nodes\_list, 
      sa\_family, is\_LAN, want\_good);
597     \}
598 
599     \hyperlink{logger_8h_a9885ca09ce5f94d936c91a5b0856a024}{LOGGER\_DEBUG}(\textcolor{stringliteral}{"get\_close\_nodes(): Assoc\_get\_close\_entries() returned %i 'direct' and %i
       'indirect' nodes"},
600                  request.\hyperlink{struct_assoc__close__entries_a086e0ce002c9491e4b99956740bb53d4}{count\_good}, num\_found - request.\hyperlink{struct_assoc__close__entries_a086e0ce002c9491e4b99956740bb53d4}{count\_good});
601 
602     uint8\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}, num\_returned = 0;
603 
604     \textcolor{keywordflow}{for} (i = 0; i < num\_found; i++) \{
605         \hyperlink{struct_client__data}{Client\_data} *client = result[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}];
606 
607         \textcolor{keywordflow}{if} (client) \{
608             \hyperlink{util_8c_aa30049b8c1d82c280d6d872feea3353b}{id\_copy}(nodes\_list[num\_returned].\hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, client->
      \hyperlink{struct_client__data_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key});
609 
610             \textcolor{keywordflow}{if} (sa\_family == AF\_INET)
611                 \textcolor{keywordflow}{if} (\hyperlink{network_8c_a8436367218afb29bcf1b5fecd071648e}{ipport\_isset}(&client->\hyperlink{struct_client__data_ac9843379cbcd02bdfa5c180a1474a6c5}{assoc4}.\hyperlink{struct_i_p_p_ts_png_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port})) \{
612                     nodes\_list[num\_returned].\hyperlink{struct_node__format_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port} = client->\hyperlink{struct_client__data_ac9843379cbcd02bdfa5c180a1474a6c5}{assoc4}.
      \hyperlink{struct_i_p_p_ts_png_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port};
613                     num\_returned++;
614                     \textcolor{keywordflow}{continue};
615                 \}
616 
617             \textcolor{keywordflow}{if} (sa\_family == AF\_INET6)
618                 \textcolor{keywordflow}{if} (\hyperlink{network_8c_a8436367218afb29bcf1b5fecd071648e}{ipport\_isset}(&client->\hyperlink{struct_client__data_a87d394929a2604f6f785fec949fac618}{assoc6}.\hyperlink{struct_i_p_p_ts_png_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port})) \{
619                     nodes\_list[num\_returned].\hyperlink{struct_node__format_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port} = client->\hyperlink{struct_client__data_a87d394929a2604f6f785fec949fac618}{assoc6}.
      \hyperlink{struct_i_p_p_ts_png_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port};
620                     num\_returned++;
621                     \textcolor{keywordflow}{continue};
622                 \}
623         \}
624     \}
625 
626     \textcolor{keywordflow}{return} num\_returned;
627 \textcolor{preprocessor}{#endif}
628 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a8abfc9cea3784b0cae354670bd4643cd_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a8abfc9cea3784b0cae354670bd4643cd_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_a40b090e4bc0b1280a8689b7931f320c6}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!get\+\_\+close\+\_\+nodes\+\_\+inner@{get\+\_\+close\+\_\+nodes\+\_\+inner}}
\index{get\+\_\+close\+\_\+nodes\+\_\+inner@{get\+\_\+close\+\_\+nodes\+\_\+inner}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{get\+\_\+close\+\_\+nodes\+\_\+inner}]{\setlength{\rightskip}{0pt plus 5cm}static void get\+\_\+close\+\_\+nodes\+\_\+inner (
\begin{DoxyParamCaption}
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key, }
\item[{{\bf Node\+\_\+format} $\ast$}]{nodes\+\_\+list, }
\item[{sa\+\_\+family\+\_\+t}]{sa\+\_\+family, }
\item[{const {\bf Client\+\_\+data} $\ast$}]{client\+\_\+list, }
\item[{uint32\+\_\+t}]{client\+\_\+list\+\_\+length, }
\item[{uint32\+\_\+t $\ast$}]{num\+\_\+nodes\+\_\+ptr, }
\item[{uint8\+\_\+t}]{is\+\_\+\+L\+A\+N, }
\item[{uint8\+\_\+t}]{want\+\_\+good}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_d_h_t_8c_a40b090e4bc0b1280a8689b7931f320c6}


Definition at line 464 of file D\+H\+T.\+c.



References Client\+\_\+data\+::assoc4, Client\+\_\+data\+::assoc6, B\+A\+D\+\_\+\+N\+O\+D\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T, client\+\_\+in\+\_\+nodelist(), I\+P\+P\+Ts\+Png\+::hardening, H\+A\+R\+D\+E\+N\+I\+N\+G\+\_\+\+A\+L\+L\+\_\+\+O\+K, hardening\+\_\+correct(), i, id\+\_\+closest(), id\+\_\+equal(), I\+P\+\_\+\+Port\+::ip, I\+P\+P\+Ts\+Png\+::ip\+\_\+port, Node\+\_\+format\+::ip\+\_\+port, is\+\_\+timeout(), L\+A\+N\+\_\+ip(), M\+A\+X\+\_\+\+S\+E\+N\+T\+\_\+\+N\+O\+D\+E\+S, Client\+\_\+data\+::public\+\_\+key, and I\+P\+P\+Ts\+Png\+::timestamp.



Referenced by get\+\_\+somewhat\+\_\+close\+\_\+nodes().


\begin{DoxyCode}
467 \{
468     \textcolor{keywordflow}{if} ((sa\_family != AF\_INET) && (sa\_family != AF\_INET6) && (sa\_family != 0))
469         \textcolor{keywordflow}{return};
470 
471     uint32\_t num\_nodes = *num\_nodes\_ptr;
472     \textcolor{keywordtype}{int} j, closest;
473     uint32\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
474 
475     \textcolor{keywordflow}{for} (i = 0; i < client\_list\_length; i++) \{
476         \textcolor{keyword}{const} \hyperlink{struct_client__data}{Client\_data} *client = &client\_list[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}];
477 
478         \textcolor{comment}{/* node already in list? */}
479         \textcolor{keywordflow}{if} (\hyperlink{_d_h_t_8c_ac2887d26ab67ac2ca1347b0ed8dadbf5}{client\_in\_nodelist}(nodes\_list, \hyperlink{_d_h_t_8h_a57f4cf16e79a384d7d59a3cc585ea5a3}{MAX\_SENT\_NODES}, client->
      \hyperlink{struct_client__data_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}))
480             \textcolor{keywordflow}{continue};
481 
482         \textcolor{keyword}{const} \hyperlink{struct_i_p_p_ts_png}{IPPTsPng} *ipptp = NULL;
483 
484         \textcolor{keywordflow}{if} (sa\_family == AF\_INET) \{
485             ipptp = &client->\hyperlink{struct_client__data_ac9843379cbcd02bdfa5c180a1474a6c5}{assoc4};
486         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (sa\_family == AF\_INET6) \{
487             ipptp = &client->\hyperlink{struct_client__data_a87d394929a2604f6f785fec949fac618}{assoc6};
488         \} \textcolor{keywordflow}{else} \{
489             \textcolor{keywordflow}{if} (client->\hyperlink{struct_client__data_ac9843379cbcd02bdfa5c180a1474a6c5}{assoc4}.\hyperlink{struct_i_p_p_ts_png_a465bef81f6478756e5443025b1f2ddfa}{timestamp} >= client->\hyperlink{struct_client__data_a87d394929a2604f6f785fec949fac618}{assoc6}.
      \hyperlink{struct_i_p_p_ts_png_a465bef81f6478756e5443025b1f2ddfa}{timestamp}) \{
490                 ipptp = &client->\hyperlink{struct_client__data_ac9843379cbcd02bdfa5c180a1474a6c5}{assoc4};
491             \} \textcolor{keywordflow}{else} \{
492                 ipptp = &client->\hyperlink{struct_client__data_a87d394929a2604f6f785fec949fac618}{assoc6};
493             \}
494         \}
495 
496         \textcolor{comment}{/* node not in a good condition? */}
497         \textcolor{keywordflow}{if} (\hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(ipptp->\hyperlink{struct_i_p_p_ts_png_a465bef81f6478756e5443025b1f2ddfa}{timestamp}, \hyperlink{_d_h_t_8h_a2c542fd03a43f340d1fb281afe54453f}{BAD\_NODE\_TIMEOUT}))
498             \textcolor{keywordflow}{continue};
499 
500         \textcolor{comment}{/* don't send LAN ips to non LAN peers */}
501         \textcolor{keywordflow}{if} (\hyperlink{_l_a_n__discovery_8c_a2d80a53390598eb8ededbc63f4e9c152}{LAN\_ip}(ipptp->\hyperlink{struct_i_p_p_ts_png_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}) == 0 && !is\_LAN)
502             \textcolor{keywordflow}{continue};
503 
504         \textcolor{keywordflow}{if} (\hyperlink{_l_a_n__discovery_8c_a2d80a53390598eb8ededbc63f4e9c152}{LAN\_ip}(ipptp->\hyperlink{struct_i_p_p_ts_png_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}) != 0 && want\_good && 
      \hyperlink{_d_h_t_8c_a99cbbcdc9772e5c2b1ff8416074e88c0}{hardening\_correct}(&ipptp->\hyperlink{struct_i_p_p_ts_png_a247a5bc6669d45b7241b58223ce8fd1d}{hardening}) != 
      \hyperlink{_d_h_t_8c_a26075b69d14a1c08617bdb49aaf22ade}{HARDENING\_ALL\_OK}
505                 && !\hyperlink{util_8c_ada3d44b4f530d3c8c9cb69b732be94b1}{id\_equal}(\hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, client->\hyperlink{struct_client__data_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}))
506             \textcolor{keywordflow}{continue};
507 
508         \textcolor{keywordflow}{if} (num\_nodes < \hyperlink{_d_h_t_8h_a57f4cf16e79a384d7d59a3cc585ea5a3}{MAX\_SENT\_NODES}) \{
509             memcpy(nodes\_list[num\_nodes].\hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key},
510                    client->\hyperlink{struct_client__data_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key},
511                    crypto\_box\_PUBLICKEYBYTES );
512 
513             nodes\_list[num\_nodes].\hyperlink{struct_node__format_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port} = ipptp->\hyperlink{struct_i_p_p_ts_png_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port};
514             num\_nodes++;
515         \} \textcolor{keywordflow}{else} \{
516             \textcolor{comment}{/* see if node\_list contains a public\_key that's "further away"}
517 \textcolor{comment}{             * compared to the one we're looking at at the moment, if there}
518 \textcolor{comment}{             * is, replace it}
519 \textcolor{comment}{             */}
520             \textcolor{keywordflow}{for} (j = 0; j < \hyperlink{_d_h_t_8h_a57f4cf16e79a384d7d59a3cc585ea5a3}{MAX\_SENT\_NODES}; ++j) \{
521                 closest = \hyperlink{_d_h_t_8c_a903a5bc580826fe447adb841b7782333}{id\_closest}(   \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key},
522                                         nodes\_list[j].\hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key},
523                                         client->\hyperlink{struct_client__data_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key} );
524 
525                 \textcolor{comment}{/* second public\_key is closer than current: change to it */}
526                 \textcolor{keywordflow}{if} (closest == 2) \{
527                     memcpy( nodes\_list[j].\hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key},
528                             client->\hyperlink{struct_client__data_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key},
529                             crypto\_box\_PUBLICKEYBYTES);
530 
531                     nodes\_list[j].\hyperlink{struct_node__format_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port} = ipptp->\hyperlink{struct_i_p_p_ts_png_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port};
532                     \textcolor{keywordflow}{break};
533                 \}
534             \}
535         \}
536     \}
537 
538     *num\_nodes\_ptr = num\_nodes;
539 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a40b090e4bc0b1280a8689b7931f320c6_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a40b090e4bc0b1280a8689b7931f320c6_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_a0595b79448a6183eba8b2bcd77afcc8a}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!get\+\_\+closelist\+\_\+\+I\+P\+P\+Ts\+Png@{get\+\_\+closelist\+\_\+\+I\+P\+P\+Ts\+Png}}
\index{get\+\_\+closelist\+\_\+\+I\+P\+P\+Ts\+Png@{get\+\_\+closelist\+\_\+\+I\+P\+P\+Ts\+Png}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{get\+\_\+closelist\+\_\+\+I\+P\+P\+Ts\+Png}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf I\+P\+P\+Ts\+Png}$\ast$ get\+\_\+closelist\+\_\+\+I\+P\+P\+Ts\+Png (
\begin{DoxyParamCaption}
\item[{{\bf D\+H\+T} $\ast$}]{dht, }
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key, }
\item[{sa\+\_\+family\+\_\+t}]{sa\+\_\+family}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_d_h_t_8c_a0595b79448a6183eba8b2bcd77afcc8a}


Definition at line 1925 of file D\+H\+T.\+c.



References Client\+\_\+data\+::assoc4, Client\+\_\+data\+::assoc6, D\+H\+T\+::close\+\_\+clientlist, i, L\+C\+L\+I\+E\+N\+T\+\_\+\+L\+I\+S\+T, and Client\+\_\+data\+::public\+\_\+key.



Referenced by handle\+\_\+hardening(), and have\+\_\+nodes\+\_\+closelist().


\begin{DoxyCode}
1926 \{
1927     uint32\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
1928 
1929     \textcolor{keywordflow}{for} (i = 0; i < \hyperlink{_d_h_t_8h_a3058f857a8316099e20c95fb07adc7c1}{LCLIENT\_LIST}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
1930         \textcolor{keywordflow}{if} (memcmp(dht->\hyperlink{struct_d_h_t_a00ef35d5b0e7a791ef08a30b3bacbf9d}{close\_clientlist}[i].\hyperlink{struct_client__data_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, 
      \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, crypto\_box\_PUBLICKEYBYTES) != 0)
1931             \textcolor{keywordflow}{continue};
1932 
1933         \textcolor{keywordflow}{if} (sa\_family == AF\_INET)
1934             \textcolor{keywordflow}{return} &dht->\hyperlink{struct_d_h_t_a00ef35d5b0e7a791ef08a30b3bacbf9d}{close\_clientlist}[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}].\hyperlink{struct_client__data_ac9843379cbcd02bdfa5c180a1474a6c5}{assoc4};
1935         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (sa\_family == AF\_INET6)
1936             \textcolor{keywordflow}{return} &dht->\hyperlink{struct_d_h_t_a00ef35d5b0e7a791ef08a30b3bacbf9d}{close\_clientlist}[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}].\hyperlink{struct_client__data_a87d394929a2604f6f785fec949fac618}{assoc6};
1937     \}
1938 
1939     \textcolor{keywordflow}{return} NULL;
1940 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a0595b79448a6183eba8b2bcd77afcc8a_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_a6cd4aa89d7bfcf6805c5ce6b273d9e9e}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!get\+\_\+shared\+\_\+key@{get\+\_\+shared\+\_\+key}}
\index{get\+\_\+shared\+\_\+key@{get\+\_\+shared\+\_\+key}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{get\+\_\+shared\+\_\+key}]{\setlength{\rightskip}{0pt plus 5cm}void get\+\_\+shared\+\_\+key (
\begin{DoxyParamCaption}
\item[{{\bf Shared\+\_\+\+Keys} $\ast$}]{shared\+\_\+keys, }
\item[{uint8\+\_\+t $\ast$}]{shared\+\_\+key, }
\item[{const uint8\+\_\+t $\ast$}]{secret\+\_\+key, }
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key}
\end{DoxyParamCaption}
)}}\label{_d_h_t_8c_a6cd4aa89d7bfcf6805c5ce6b273d9e9e}


Definition at line 100 of file D\+H\+T.\+c.



References encrypt\+\_\+precompute(), i, is\+\_\+timeout(), Shared\+\_\+\+Keys\+::keys, K\+E\+Y\+S\+\_\+\+T\+I\+M\+E\+O\+U\+T, M\+A\+X\+\_\+\+K\+E\+Y\+S\+\_\+\+P\+E\+R\+\_\+\+S\+L\+O\+T, num, Shared\+\_\+\+Keys\+::public\+\_\+key, Shared\+\_\+\+Keys\+::shared\+\_\+key, Shared\+\_\+\+Keys\+::stored, Shared\+\_\+\+Keys\+::time\+\_\+last\+\_\+requested, Shared\+\_\+\+Keys\+::times\+\_\+requested, and unix\+\_\+time().



Referenced by D\+H\+T\+\_\+get\+\_\+shared\+\_\+key\+\_\+recv(), D\+H\+T\+\_\+get\+\_\+shared\+\_\+key\+\_\+sent(), handle\+\_\+announce\+\_\+request(), handle\+\_\+send\+\_\+1(), handle\+\_\+send\+\_\+2(), and handle\+\_\+send\+\_\+initial().


\begin{DoxyCode}
101 \{
102     uint32\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}, \hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num} = ~0, curr = 0;
103 
104     \textcolor{keywordflow}{for} (i = 0; i < \hyperlink{_d_h_t_8h_ae5450da86fcf09134330aeef7cd8c35f}{MAX\_KEYS\_PER\_SLOT}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
105         \textcolor{keywordtype}{int} index = \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}[30] * MAX\_KEYS\_PER\_SLOT + \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
106 
107         \textcolor{keywordflow}{if} (shared\_keys->\hyperlink{struct_shared___keys_a15077d043938aa92f7ee5278d0036f7f}{keys}[index].\hyperlink{struct_shared___keys_a252513c1d10b32b19859efae45136a75}{stored}) \{
108             \textcolor{keywordflow}{if} (memcmp(\hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, shared\_keys->\hyperlink{struct_shared___keys_a15077d043938aa92f7ee5278d0036f7f}{keys}[index].
      \hyperlink{struct_shared___keys_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, crypto\_box\_PUBLICKEYBYTES) == 0) \{
109                 memcpy(shared\_key, shared\_keys->\hyperlink{struct_shared___keys_a15077d043938aa92f7ee5278d0036f7f}{keys}[index].\hyperlink{struct_shared___keys_a81ead9fac55a0cedc30a96253a2c5119}{shared\_key}, 
      crypto\_box\_BEFORENMBYTES);
110                 ++shared\_keys->\hyperlink{struct_shared___keys_a15077d043938aa92f7ee5278d0036f7f}{keys}[index].\hyperlink{struct_shared___keys_ae433d486c059f93505368567603c2748}{times\_requested};
111                 shared\_keys->\hyperlink{struct_shared___keys_a15077d043938aa92f7ee5278d0036f7f}{keys}[index].\hyperlink{struct_shared___keys_a682dfdf8b648a40e36dd5865f16da424}{time\_last\_requested} = 
      \hyperlink{util_8c_ac958d9f8847cb8039444bfa3d304233a}{unix\_time}();
112                 \textcolor{keywordflow}{return};
113             \}
114 
115             \textcolor{keywordflow}{if} (num != 0) \{
116                 \textcolor{keywordflow}{if} (\hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(shared\_keys->\hyperlink{struct_shared___keys_a15077d043938aa92f7ee5278d0036f7f}{keys}[index].
      \hyperlink{struct_shared___keys_a682dfdf8b648a40e36dd5865f16da424}{time\_last\_requested}, \hyperlink{_d_h_t_8h_a1b0aff5d0e177e2fe1f826e225223867}{KEYS\_TIMEOUT})) \{
117                     num = 0;
118                     curr = index;
119                 \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (num > shared\_keys->\hyperlink{struct_shared___keys_a15077d043938aa92f7ee5278d0036f7f}{keys}[index].\hyperlink{struct_shared___keys_ae433d486c059f93505368567603c2748}{times\_requested}) \{
120                     num = shared\_keys->\hyperlink{struct_shared___keys_a15077d043938aa92f7ee5278d0036f7f}{keys}[index].\hyperlink{struct_shared___keys_ae433d486c059f93505368567603c2748}{times\_requested};
121                     curr = index;
122                 \}
123             \}
124         \} \textcolor{keywordflow}{else} \{
125             \textcolor{keywordflow}{if} (num != 0) \{
126                 num = 0;
127                 curr = index;
128             \}
129         \}
130     \}
131 
132     \hyperlink{crypto__core_8c_a0d8eaef49981c5dc3ada078866b42f6d}{encrypt\_precompute}(\hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, secret\_key, shared\_key);
133 
134     \textcolor{keywordflow}{if} (num != (uint32\_t)~0) \{
135         shared\_keys->\hyperlink{struct_shared___keys_a15077d043938aa92f7ee5278d0036f7f}{keys}[curr].\hyperlink{struct_shared___keys_a252513c1d10b32b19859efae45136a75}{stored} = 1;
136         shared\_keys->\hyperlink{struct_shared___keys_a15077d043938aa92f7ee5278d0036f7f}{keys}[curr].\hyperlink{struct_shared___keys_ae433d486c059f93505368567603c2748}{times\_requested} = 1;
137         memcpy(shared\_keys->\hyperlink{struct_shared___keys_a15077d043938aa92f7ee5278d0036f7f}{keys}[curr].\hyperlink{struct_shared___keys_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, 
      crypto\_box\_PUBLICKEYBYTES);
138         memcpy(shared\_keys->\hyperlink{struct_shared___keys_a15077d043938aa92f7ee5278d0036f7f}{keys}[curr].\hyperlink{struct_shared___keys_a81ead9fac55a0cedc30a96253a2c5119}{shared\_key}, shared\_key, crypto\_box\_BEFORENMBYTES);
139         shared\_keys->\hyperlink{struct_shared___keys_a15077d043938aa92f7ee5278d0036f7f}{keys}[curr].\hyperlink{struct_shared___keys_a682dfdf8b648a40e36dd5865f16da424}{time\_last\_requested} = 
      \hyperlink{util_8c_ac958d9f8847cb8039444bfa3d304233a}{unix\_time}();
140     \}
141 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a6cd4aa89d7bfcf6805c5ce6b273d9e9e_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a6cd4aa89d7bfcf6805c5ce6b273d9e9e_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_ab7f89880bce923390748449ef6f60004}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!get\+\_\+somewhat\+\_\+close\+\_\+nodes@{get\+\_\+somewhat\+\_\+close\+\_\+nodes}}
\index{get\+\_\+somewhat\+\_\+close\+\_\+nodes@{get\+\_\+somewhat\+\_\+close\+\_\+nodes}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{get\+\_\+somewhat\+\_\+close\+\_\+nodes}]{\setlength{\rightskip}{0pt plus 5cm}static int get\+\_\+somewhat\+\_\+close\+\_\+nodes (
\begin{DoxyParamCaption}
\item[{const {\bf D\+H\+T} $\ast$}]{dht, }
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key, }
\item[{{\bf Node\+\_\+format} $\ast$}]{nodes\+\_\+list, }
\item[{sa\+\_\+family\+\_\+t}]{sa\+\_\+family, }
\item[{uint8\+\_\+t}]{is\+\_\+\+L\+A\+N, }
\item[{uint8\+\_\+t}]{want\+\_\+good}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_d_h_t_8c_ab7f89880bce923390748449ef6f60004}


Definition at line 549 of file D\+H\+T.\+c.



References D\+H\+T\+\_\+\+Friend\+::client\+\_\+list, D\+H\+T\+::close\+\_\+clientlist, D\+H\+T\+::friends\+\_\+list, get\+\_\+close\+\_\+nodes\+\_\+inner(), i, L\+C\+L\+I\+E\+N\+T\+\_\+\+L\+I\+S\+T, M\+A\+X\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+C\+L\+I\+E\+N\+T\+S, and D\+H\+T\+::num\+\_\+friends.



Referenced by get\+\_\+close\+\_\+nodes().


\begin{DoxyCode}
551 \{
552     uint32\_t num\_nodes = 0, \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
553     \hyperlink{_d_h_t_8c_a40b090e4bc0b1280a8689b7931f320c6}{get\_close\_nodes\_inner}(\hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, nodes\_list, sa\_family,
554                           dht->\hyperlink{struct_d_h_t_a00ef35d5b0e7a791ef08a30b3bacbf9d}{close\_clientlist}, \hyperlink{_d_h_t_8h_a3058f857a8316099e20c95fb07adc7c1}{LCLIENT\_LIST}, &num\_nodes, 
      is\_LAN, want\_good);
555 
556     \textcolor{comment}{/*TODO uncomment this when hardening is added to close friend clients}
557 \textcolor{comment}{        for (i = 0; i < dht->num\_friends; ++i)}
558 \textcolor{comment}{            get\_close\_nodes\_inner(dht, public\_key, nodes\_list, sa\_family,}
559 \textcolor{comment}{                                  dht->friends\_list[i].client\_list, MAX\_FRIEND\_CLIENTS,}
560 \textcolor{comment}{                                  &num\_nodes, is\_LAN, want\_good);}
561 \textcolor{comment}{    */}
562     \textcolor{keywordflow}{for} (\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i} = 0; \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i} < dht->\hyperlink{struct_d_h_t_a8ee1f2d7e543bce350c591a8eaac0cf8}{num\_friends}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i})
563         \hyperlink{_d_h_t_8c_a40b090e4bc0b1280a8689b7931f320c6}{get\_close\_nodes\_inner}(\hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, nodes\_list, sa\_family,
564                               dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}].\hyperlink{struct_d_h_t___friend_a49ef2b640a834a77b6e123355a4fea47}{client\_list}, 
      \hyperlink{_d_h_t_8h_ad50d158518277ca4d19cbe364f3e958c}{MAX\_FRIEND\_CLIENTS},
565                               &num\_nodes, is\_LAN, 0);
566 
567     \textcolor{keywordflow}{return} num\_nodes;
568 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_ab7f89880bce923390748449ef6f60004_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_ab7f89880bce923390748449ef6f60004_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_a7af6c30b12e5cbda1e6d6d824794956e}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!getnodes@{getnodes}}
\index{getnodes@{getnodes}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{getnodes}]{\setlength{\rightskip}{0pt plus 5cm}static int getnodes (
\begin{DoxyParamCaption}
\item[{{\bf D\+H\+T} $\ast$}]{dht, }
\item[{{\bf I\+P\+\_\+\+Port}}]{ip\+\_\+port, }
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key, }
\item[{const uint8\+\_\+t $\ast$}]{client\+\_\+id, }
\item[{const {\bf Node\+\_\+format} $\ast$}]{sendback\+\_\+node}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_d_h_t_8c_a7af6c30b12e5cbda1e6d6d824794956e}


Definition at line 912 of file D\+H\+T.\+c.



References make-\/funny-\/savefile\+::data, D\+H\+T\+\_\+get\+\_\+shared\+\_\+key\+\_\+sent(), D\+H\+T\+::dht\+\_\+harden\+\_\+ping\+\_\+array, D\+H\+T\+::dht\+\_\+ping\+\_\+array, encrypt\+\_\+data\+\_\+symmetric(), id\+\_\+equal(), Node\+\_\+format\+::ip\+\_\+port, D\+H\+T\+::net, N\+E\+T\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+G\+E\+T\+\_\+\+N\+O\+D\+E\+S, new\+\_\+nonce(), nonce, ping\+\_\+array\+\_\+add(), Node\+\_\+format\+::public\+\_\+key, D\+H\+T\+::self\+\_\+public\+\_\+key, and sendpacket().



Referenced by D\+H\+T\+\_\+addfriend(), D\+H\+T\+\_\+bootstrap(), D\+H\+T\+\_\+getnodes(), do\+\_\+ping\+\_\+and\+\_\+sendnode\+\_\+requests(), and handle\+\_\+hardening().


\begin{DoxyCode}
914 \{
915     \textcolor{comment}{/* Check if packet is going to be sent to ourself. */}
916     \textcolor{keywordflow}{if} (\hyperlink{util_8c_ada3d44b4f530d3c8c9cb69b732be94b1}{id\_equal}(\hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, dht->\hyperlink{struct_d_h_t_ae726df8bdc26380e5a6c3187a00d6881}{self\_public\_key}))
917         \textcolor{keywordflow}{return} -1;
918 
919     uint8\_t plain\_message[\textcolor{keyword}{sizeof}(\hyperlink{struct_node__format}{Node\_format}) * 2] = \{0\};
920 
921     \hyperlink{struct_node__format}{Node\_format} receiver;
922     memcpy(receiver.\hyperlink{struct_node__format_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, crypto\_box\_PUBLICKEYBYTES);
923     receiver.\hyperlink{struct_node__format_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port} = ip\_port;
924     memcpy(plain\_message, &receiver, \textcolor{keyword}{sizeof}(receiver));
925 
926     uint64\_t ping\_id = 0;
927 
928     \textcolor{keywordflow}{if} (sendback\_node != NULL) \{
929         memcpy(plain\_message + \textcolor{keyword}{sizeof}(receiver), sendback\_node, \textcolor{keyword}{sizeof}(
      \hyperlink{struct_node__format}{Node\_format}));
930         ping\_id = \hyperlink{ping__array_8c_a67470d42ee0e3e61bedfa598f3039266}{ping\_array\_add}(&dht->\hyperlink{struct_d_h_t_a957126e184a8b8001228effc56b9db95}{dht\_harden\_ping\_array}, 
      plain\_message, \textcolor{keyword}{sizeof}(plain\_message));
931     \} \textcolor{keywordflow}{else} \{
932         ping\_id = \hyperlink{ping__array_8c_a67470d42ee0e3e61bedfa598f3039266}{ping\_array\_add}(&dht->\hyperlink{struct_d_h_t_a8432234ba71a00ac9c516cb80a70f29d}{dht\_ping\_array}, plain\_message, \textcolor{keyword}{sizeof}(
      receiver));
933     \}
934 
935     \textcolor{keywordflow}{if} (ping\_id == 0)
936         \textcolor{keywordflow}{return} -1;
937 
938     uint8\_t plain[crypto\_box\_PUBLICKEYBYTES + \textcolor{keyword}{sizeof}(ping\_id)];
939     uint8\_t encrypt[\textcolor{keyword}{sizeof}(plain) + crypto\_box\_MACBYTES];
940     uint8\_t \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[1 + crypto\_box\_PUBLICKEYBYTES + crypto\_box\_NONCEBYTES + \textcolor{keyword}{sizeof}(encrypt)];
941 
942     memcpy(plain, client\_id, crypto\_box\_PUBLICKEYBYTES);
943     memcpy(plain + crypto\_box\_PUBLICKEYBYTES, &ping\_id, \textcolor{keyword}{sizeof}(ping\_id));
944 
945     uint8\_t shared\_key[crypto\_box\_BEFORENMBYTES];
946     \hyperlink{_d_h_t_8c_a087cceeacc5a14415b651c2980a24d34}{DHT\_get\_shared\_key\_sent}(dht, shared\_key, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key});
947 
948     uint8\_t \hyperlink{crypto__test_8c_a7932c523f7065073a396e571319201ce}{nonce}[crypto\_box\_NONCEBYTES];
949     \hyperlink{crypto__core_8c_a8b1033efb47c625779d11be7d8eb9e24}{new\_nonce}(nonce);
950 
951     \textcolor{keywordtype}{int} len = \hyperlink{crypto__core_8c_a81efc0a4a6e0efe372651e26e342a6e5}{encrypt\_data\_symmetric}( shared\_key,
952                                       nonce,
953                                       plain,
954                                       \textcolor{keyword}{sizeof}(plain),
955                                       encrypt );
956 
957     \textcolor{keywordflow}{if} (len != \textcolor{keyword}{sizeof}(encrypt))
958         \textcolor{keywordflow}{return} -1;
959 
960     \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[0] = \hyperlink{network_8h_a861e63c2b32751aa406f11283f5b0925}{NET\_PACKET\_GET\_NODES};
961     memcpy(\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} + 1, dht->\hyperlink{struct_d_h_t_ae726df8bdc26380e5a6c3187a00d6881}{self\_public\_key}, crypto\_box\_PUBLICKEYBYTES);
962     memcpy(\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} + 1 + crypto\_box\_PUBLICKEYBYTES, nonce, crypto\_box\_NONCEBYTES);
963     memcpy(\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} + 1 + crypto\_box\_PUBLICKEYBYTES + crypto\_box\_NONCEBYTES, encrypt, len);
964 
965     \textcolor{keywordflow}{return} \hyperlink{network_8c_a7b90f87f3ba60cc5c66dd6dd77cd5cb1}{sendpacket}(dht->\hyperlink{struct_d_h_t_aa14ea2f67950f57fe4235d7375a2216c}{net}, ip\_port, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}, \textcolor{keyword}{sizeof}(\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}));
966 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a7af6c30b12e5cbda1e6d6d824794956e_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a7af6c30b12e5cbda1e6d6d824794956e_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_afa4f13a29cbe60809f2446267d109383}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!handle\+\_\+getnodes@{handle\+\_\+getnodes}}
\index{handle\+\_\+getnodes@{handle\+\_\+getnodes}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{handle\+\_\+getnodes}]{\setlength{\rightskip}{0pt plus 5cm}static int handle\+\_\+getnodes (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{object, }
\item[{{\bf I\+P\+\_\+\+Port}}]{source, }
\item[{const uint8\+\_\+t $\ast$}]{packet, }
\item[{uint16\+\_\+t}]{length}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_d_h_t_8c_afa4f13a29cbe60809f2446267d109383}


Definition at line 1018 of file D\+H\+T.\+c.



References add\+\_\+to\+\_\+ping(), decrypt\+\_\+data\+\_\+symmetric(), D\+H\+T\+\_\+get\+\_\+shared\+\_\+key\+\_\+recv(), id\+\_\+equal(), D\+H\+T\+::ping, D\+H\+T\+::self\+\_\+public\+\_\+key, and sendnodes\+\_\+ipv6().



Referenced by new\+\_\+\+D\+H\+T().


\begin{DoxyCode}
1019 \{
1020     \textcolor{keywordflow}{if} (length != (1 + crypto\_box\_PUBLICKEYBYTES + crypto\_box\_NONCEBYTES + crypto\_box\_PUBLICKEYBYTES + \textcolor{keyword}{
      sizeof}(
1021                        uint64\_t) + crypto\_box\_MACBYTES))
1022         \textcolor{keywordflow}{return} 1;
1023 
1024     \hyperlink{struct_d_h_t}{DHT} *dht = object;
1025 
1026     \textcolor{comment}{/* Check if packet is from ourself. */}
1027     \textcolor{keywordflow}{if} (\hyperlink{util_8c_ada3d44b4f530d3c8c9cb69b732be94b1}{id\_equal}(packet + 1, dht->\hyperlink{struct_d_h_t_ae726df8bdc26380e5a6c3187a00d6881}{self\_public\_key}))
1028         \textcolor{keywordflow}{return} 1;
1029 
1030     uint8\_t plain[crypto\_box\_PUBLICKEYBYTES + \textcolor{keyword}{sizeof}(uint64\_t)];
1031     uint8\_t shared\_key[crypto\_box\_BEFORENMBYTES];
1032 
1033     \hyperlink{_d_h_t_8c_a9e92f7714ab1f2b37b54e8479717cbc7}{DHT\_get\_shared\_key\_recv}(dht, shared\_key, packet + 1);
1034     \textcolor{keywordtype}{int} len = \hyperlink{crypto__core_8c_a824b257fcff74b9d17c5247223fbed29}{decrypt\_data\_symmetric}( shared\_key,
1035                                       packet + 1 + crypto\_box\_PUBLICKEYBYTES,
1036                                       packet + 1 + crypto\_box\_PUBLICKEYBYTES + crypto\_box\_NONCEBYTES,
1037                                       crypto\_box\_PUBLICKEYBYTES + \textcolor{keyword}{sizeof}(uint64\_t) + crypto\_box\_MACBYTES,
1038                                       plain );
1039 
1040     \textcolor{keywordflow}{if} (len != crypto\_box\_PUBLICKEYBYTES + \textcolor{keyword}{sizeof}(uint64\_t))
1041         \textcolor{keywordflow}{return} 1;
1042 
1043     \hyperlink{_d_h_t_8c_acce043cdc5108edffc35e6e879197d20}{sendnodes\_ipv6}(dht, source, packet + 1, plain, plain + crypto\_box\_PUBLICKEYBYTES, \textcolor{keyword}{sizeof}(
      uint64\_t), shared\_key);
1044 
1045     \hyperlink{ping_8c_a088e8f057d04ba6808f300cde41fa6af}{add\_to\_ping}(dht->\hyperlink{struct_d_h_t_ae3f68e3d55e46726b05717fc88198321}{ping}, packet + 1, source);
1046 
1047     \textcolor{keywordflow}{return} 0;
1048 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_afa4f13a29cbe60809f2446267d109383_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_afa4f13a29cbe60809f2446267d109383_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_aa38b3670da696f600f37989e79ce4966}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!handle\+\_\+hardening@{handle\+\_\+hardening}}
\index{handle\+\_\+hardening@{handle\+\_\+hardening}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{handle\+\_\+hardening}]{\setlength{\rightskip}{0pt plus 5cm}static int handle\+\_\+hardening (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{object, }
\item[{{\bf I\+P\+\_\+\+Port}}]{source, }
\item[{const uint8\+\_\+t $\ast$}]{source\+\_\+pubkey, }
\item[{const uint8\+\_\+t $\ast$}]{packet, }
\item[{uint16\+\_\+t}]{length}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_d_h_t_8c_aa38b3670da696f600f37989e79ce4966}


Definition at line 1974 of file D\+H\+T.\+c.



References C\+H\+E\+C\+K\+\_\+\+T\+Y\+P\+E\+\_\+\+G\+E\+T\+N\+O\+D\+E\+\_\+\+R\+E\+Q, C\+H\+E\+C\+K\+\_\+\+T\+Y\+P\+E\+\_\+\+G\+E\+T\+N\+O\+D\+E\+\_\+\+R\+E\+S, get\+\_\+closelist\+\_\+\+I\+P\+P\+Ts\+Png(), getnodes(), I\+P\+P\+Ts\+Png\+::hardening, H\+A\+R\+D\+E\+N\+I\+N\+G\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L, H\+A\+R\+D\+R\+E\+Q\+\_\+\+D\+A\+T\+A\+\_\+\+S\+I\+Z\+E, have\+\_\+nodes\+\_\+closelist(), Node\+\_\+format\+::ip\+\_\+port, is\+\_\+timeout(), M\+A\+X\+\_\+\+S\+E\+N\+T\+\_\+\+N\+O\+D\+E\+S, Node\+\_\+format\+::public\+\_\+key, Hardening\+::send\+\_\+nodes\+\_\+ok, Hardening\+::send\+\_\+nodes\+\_\+pingedid, Hardening\+::send\+\_\+nodes\+\_\+timestamp, and unpack\+\_\+nodes().



Referenced by new\+\_\+\+D\+H\+T().


\begin{DoxyCode}
1976 \{
1977     \hyperlink{struct_d_h_t}{DHT} *dht = object;
1978 
1979     \textcolor{keywordflow}{if} (length < 2) \{
1980         \textcolor{keywordflow}{return} 1;
1981     \}
1982 
1983     \textcolor{keywordflow}{switch} (packet[0]) \{
1984         \textcolor{keywordflow}{case} \hyperlink{_d_h_t_8c_ac582451ce11946977a1feec8591f7aa1}{CHECK\_TYPE\_GETNODE\_REQ}: \{
1985             \textcolor{keywordflow}{if} (length != \hyperlink{_d_h_t_8c_a207dfa01a1f5f59c613d2202843bef3c}{HARDREQ\_DATA\_SIZE})
1986                 \textcolor{keywordflow}{return} 1;
1987 
1988             \hyperlink{struct_node__format}{Node\_format} node, tocheck\_node;
1989             node.\hyperlink{struct_node__format_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port} = source;
1990             memcpy(node.\hyperlink{struct_node__format_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, source\_pubkey, crypto\_box\_PUBLICKEYBYTES);
1991             memcpy(&tocheck\_node, packet + 1, \textcolor{keyword}{sizeof}(\hyperlink{struct_node__format}{Node\_format}));
1992 
1993             \textcolor{keywordflow}{if} (\hyperlink{_d_h_t_8c_a7af6c30b12e5cbda1e6d6d824794956e}{getnodes}(dht, tocheck\_node.\hyperlink{struct_node__format_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}, tocheck\_node.
      \hyperlink{struct_node__format_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, packet + 1 + \textcolor{keyword}{sizeof}(\hyperlink{struct_node__format}{Node\_format}), &node) == -1)
1994                 \textcolor{keywordflow}{return} 1;
1995 
1996             \textcolor{keywordflow}{return} 0;
1997         \}
1998 
1999         \textcolor{keywordflow}{case} \hyperlink{_d_h_t_8c_a4388a18c5f38b8aa28e413a6762a6444}{CHECK\_TYPE\_GETNODE\_RES}: \{
2000             \textcolor{keywordflow}{if} (length <= crypto\_box\_PUBLICKEYBYTES + 1)
2001                 \textcolor{keywordflow}{return} 1;
2002 
2003             \textcolor{keywordflow}{if} (length > 1 + crypto\_box\_PUBLICKEYBYTES + \textcolor{keyword}{sizeof}(\hyperlink{struct_node__format}{Node\_format}) * 
      \hyperlink{_d_h_t_8h_a57f4cf16e79a384d7d59a3cc585ea5a3}{MAX\_SENT\_NODES})
2004                 \textcolor{keywordflow}{return} 1;
2005 
2006             uint16\_t length\_nodes = length - 1 - crypto\_box\_PUBLICKEYBYTES;
2007             \hyperlink{struct_node__format}{Node\_format} nodes[\hyperlink{_d_h_t_8h_a57f4cf16e79a384d7d59a3cc585ea5a3}{MAX\_SENT\_NODES}];
2008             \textcolor{keywordtype}{int} num\_nodes = \hyperlink{_d_h_t_8c_a45b33af842c0289c78c70f81e854ed62}{unpack\_nodes}(nodes, MAX\_SENT\_NODES, 0, packet + 1 + 
      crypto\_box\_PUBLICKEYBYTES, length\_nodes, 0);
2009 
2010             \textcolor{comment}{/* TODO: MAX\_SENT\_NODES nodes should be returned at all times}
2011 \textcolor{comment}{             (right now we have a small network size so it could cause problems for testing and etc..) */}
2012             \textcolor{keywordflow}{if} (num\_nodes <= 0)
2013                 \textcolor{keywordflow}{return} 1;
2014 
2015             \textcolor{comment}{/* NOTE: This should work for now but should be changed to something better. */}
2016             \textcolor{keywordflow}{if} (\hyperlink{_d_h_t_8c_a014ce120084edcbc79a5fda25820fe1a}{have\_nodes\_closelist}(dht, nodes, num\_nodes) < (uint32\_t)((num\_nodes + 2
      ) / 2))
2017                 \textcolor{keywordflow}{return} 1;
2018 
2019             \hyperlink{struct_i_p_p_ts_png}{IPPTsPng} *temp = \hyperlink{_d_h_t_8c_a0595b79448a6183eba8b2bcd77afcc8a}{get\_closelist\_IPPTsPng}(dht, packet + 1, nodes[0]
      .ip\_port.ip.family);
2020 
2021             \textcolor{keywordflow}{if} (temp == NULL)
2022                 \textcolor{keywordflow}{return} 1;
2023 
2024             \textcolor{keywordflow}{if} (\hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(temp->\hyperlink{struct_i_p_p_ts_png_a247a5bc6669d45b7241b58223ce8fd1d}{hardening}.
      \hyperlink{struct_hardening_ab15e3d8f0b33943a6978fac3cde4d1a2}{send\_nodes\_timestamp}, \hyperlink{_d_h_t_8c_aa2f9a8d6135222d3875900ba8ef11e11}{HARDENING\_INTERVAL}))
2025                 \textcolor{keywordflow}{return} 1;
2026 
2027             \textcolor{keywordflow}{if} (memcmp(temp->\hyperlink{struct_i_p_p_ts_png_a247a5bc6669d45b7241b58223ce8fd1d}{hardening}.\hyperlink{struct_hardening_a2c2bfa7e3ff42e353bc44a2183ebc4df}{send\_nodes\_pingedid}, source\_pubkey, 
      crypto\_box\_PUBLICKEYBYTES) != 0)
2028                 \textcolor{keywordflow}{return} 1;
2029 
2030             \textcolor{comment}{/* If Nodes look good and the request checks out */}
2031             temp->\hyperlink{struct_i_p_p_ts_png_a247a5bc6669d45b7241b58223ce8fd1d}{hardening}.\hyperlink{struct_hardening_a11158e002f3685f4044a759680636c08}{send\_nodes\_ok} = 1;
2032             \textcolor{keywordflow}{return} 0;\textcolor{comment}{/* success*/}
2033         \}
2034     \}
2035 
2036     \textcolor{keywordflow}{return} 1;
2037 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_aa38b3670da696f600f37989e79ce4966_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_aa38b3670da696f600f37989e79ce4966_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_a9684ffd3987f6c79663c1f07eed0c007}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!handle\+\_\+\+N\+A\+Tping@{handle\+\_\+\+N\+A\+Tping}}
\index{handle\+\_\+\+N\+A\+Tping@{handle\+\_\+\+N\+A\+Tping}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{handle\+\_\+\+N\+A\+Tping}]{\setlength{\rightskip}{0pt plus 5cm}static int handle\+\_\+\+N\+A\+Tping (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{object, }
\item[{{\bf I\+P\+\_\+\+Port}}]{source, }
\item[{const uint8\+\_\+t $\ast$}]{source\+\_\+pubkey, }
\item[{const uint8\+\_\+t $\ast$}]{packet, }
\item[{uint16\+\_\+t}]{length}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_d_h_t_8c_a9684ffd3987f6c79663c1f07eed0c007}


Definition at line 1694 of file D\+H\+T.\+c.



References friend\+\_\+number(), D\+H\+T\+::friends\+\_\+list, N\+A\+T\+\_\+\+P\+I\+N\+G\+\_\+\+R\+E\+Q\+U\+E\+S\+T, N\+A\+T\+\_\+\+P\+I\+N\+G\+\_\+\+R\+E\+S\+P\+O\+N\+S\+E, random\+\_\+64b(), send\+\_\+\+N\+A\+Tping(), and unix\+\_\+time().



Referenced by new\+\_\+\+D\+H\+T().


\begin{DoxyCode}
1696 \{
1697     \textcolor{keywordflow}{if} (length != \textcolor{keyword}{sizeof}(uint64\_t) + 1)
1698         \textcolor{keywordflow}{return} 1;
1699 
1700     \hyperlink{struct_d_h_t}{DHT} *dht = object;
1701     uint64\_t ping\_id;
1702     memcpy(&ping\_id, packet + 1, \textcolor{keyword}{sizeof}(uint64\_t));
1703 
1704     \textcolor{keywordtype}{int} friendnumber = \hyperlink{_d_h_t_8c_a6cbd0f66d63003cc0def913dc7a4254b}{friend\_number}(dht, source\_pubkey);
1705 
1706     \textcolor{keywordflow}{if} (friendnumber == -1)
1707         \textcolor{keywordflow}{return} 1;
1708 
1709     \hyperlink{struct_d_h_t___friend}{DHT\_Friend} *\textcolor{keyword}{friend} = &dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[friendnumber];
1710 
1711     \textcolor{keywordflow}{if} (packet[0] == \hyperlink{_d_h_t_8c_a2c654c475c840fc796772eef9079930f}{NAT\_PING\_REQUEST}) \{
1712         \textcolor{comment}{/* 1 is reply */}
1713         \hyperlink{_d_h_t_8c_a25f7b3704b34bb8745a0a60939e1f49c}{send\_NATping}(dht, source\_pubkey, ping\_id, \hyperlink{_d_h_t_8c_a88eacf49971603509097ad0a46d7d9ff}{NAT\_PING\_RESPONSE});
1714         \textcolor{keyword}{friend}->nat.recvNATping\_timestamp = \hyperlink{util_8c_ac958d9f8847cb8039444bfa3d304233a}{unix\_time}();
1715         \textcolor{keywordflow}{return} 0;
1716     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (packet[0] == \hyperlink{_d_h_t_8c_a88eacf49971603509097ad0a46d7d9ff}{NAT\_PING\_RESPONSE}) \{
1717         \textcolor{keywordflow}{if} (friend->nat.NATping\_id == ping\_id) \{
1718             \textcolor{keyword}{friend}->nat.NATping\_id = \hyperlink{crypto__core_8c_a1ce51b34ab2247e750b9c2a25121eb9e}{random\_64b}();
1719             \textcolor{keyword}{friend}->nat.hole\_punching = 1;
1720             \textcolor{keywordflow}{return} 0;
1721         \}
1722     \}
1723 
1724     \textcolor{keywordflow}{return} 1;
1725 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a9684ffd3987f6c79663c1f07eed0c007_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a9684ffd3987f6c79663c1f07eed0c007_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_a4dcc848207b2408def323b8b79b08e4a}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!handle\+\_\+sendnodes\+\_\+core@{handle\+\_\+sendnodes\+\_\+core}}
\index{handle\+\_\+sendnodes\+\_\+core@{handle\+\_\+sendnodes\+\_\+core}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{handle\+\_\+sendnodes\+\_\+core}]{\setlength{\rightskip}{0pt plus 5cm}static int handle\+\_\+sendnodes\+\_\+core (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{object, }
\item[{{\bf I\+P\+\_\+\+Port}}]{source, }
\item[{const uint8\+\_\+t $\ast$}]{packet, }
\item[{uint16\+\_\+t}]{length, }
\item[{{\bf Node\+\_\+format} $\ast$}]{plain\+\_\+nodes, }
\item[{uint16\+\_\+t}]{size\+\_\+plain\+\_\+nodes, }
\item[{uint32\+\_\+t $\ast$}]{num\+\_\+nodes\+\_\+out}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_d_h_t_8c_a4dcc848207b2408def323b8b79b08e4a}


Definition at line 1077 of file D\+H\+T.\+c.



References addto\+\_\+lists(), decrypt\+\_\+data\+\_\+symmetric(), D\+H\+T\+\_\+get\+\_\+shared\+\_\+key\+\_\+sent(), M\+A\+X\+\_\+\+S\+E\+N\+T\+\_\+\+N\+O\+D\+E\+S, send\+\_\+hardening\+\_\+getnode\+\_\+res(), sent\+\_\+getnode\+\_\+to\+\_\+node(), and unpack\+\_\+nodes().



Referenced by handle\+\_\+sendnodes\+\_\+ipv6().


\begin{DoxyCode}
1079 \{
1080     \hyperlink{struct_d_h_t}{DHT} *dht = object;
1081     uint32\_t cid\_size = 1 + crypto\_box\_PUBLICKEYBYTES + crypto\_box\_NONCEBYTES + 1 + \textcolor{keyword}{sizeof}(uint64\_t) + 
      crypto\_box\_MACBYTES;
1082 
1083     \textcolor{keywordflow}{if} (length <= cid\_size) \textcolor{comment}{/* too short */}
1084         \textcolor{keywordflow}{return} 1;
1085 
1086     uint32\_t data\_size = length - cid\_size;
1087 
1088     \textcolor{keywordflow}{if} (data\_size == 0)
1089         \textcolor{keywordflow}{return} 1;
1090 
1091     \textcolor{keywordflow}{if} (data\_size > \textcolor{keyword}{sizeof}(\hyperlink{struct_node__format}{Node\_format}) * \hyperlink{_d_h_t_8h_a57f4cf16e79a384d7d59a3cc585ea5a3}{MAX\_SENT\_NODES}) \textcolor{comment}{/* invalid length */}
1092         \textcolor{keywordflow}{return} 1;
1093 
1094     uint8\_t plain[1 + data\_size + \textcolor{keyword}{sizeof}(uint64\_t)];
1095     uint8\_t shared\_key[crypto\_box\_BEFORENMBYTES];
1096     \hyperlink{_d_h_t_8c_a087cceeacc5a14415b651c2980a24d34}{DHT\_get\_shared\_key\_sent}(dht, shared\_key, packet + 1);
1097     \textcolor{keywordtype}{int} len = \hyperlink{crypto__core_8c_a824b257fcff74b9d17c5247223fbed29}{decrypt\_data\_symmetric}(
1098                   shared\_key,
1099                   packet + 1 + crypto\_box\_PUBLICKEYBYTES,
1100                   packet + 1 + crypto\_box\_PUBLICKEYBYTES + crypto\_box\_NONCEBYTES,
1101                   1 + data\_size + \textcolor{keyword}{sizeof}(uint64\_t) + crypto\_box\_MACBYTES,
1102                   plain);
1103 
1104     \textcolor{keywordflow}{if} ((\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int})len != \textcolor{keyword}{sizeof}(plain))
1105         \textcolor{keywordflow}{return} 1;
1106 
1107     \textcolor{keywordflow}{if} (plain[0] > size\_plain\_nodes || plain[0] == 0)
1108         \textcolor{keywordflow}{return} 1;
1109 
1110     \hyperlink{struct_node__format}{Node\_format} sendback\_node;
1111 
1112     uint64\_t ping\_id;
1113     memcpy(&ping\_id, plain + 1 + data\_size, \textcolor{keyword}{sizeof}(ping\_id));
1114 
1115     \textcolor{keywordflow}{if} (!\hyperlink{_d_h_t_8c_a8def0d75fd95309e03096fbcf5085fe3}{sent\_getnode\_to\_node}(dht, packet + 1, source, ping\_id, &sendback\_node))
1116         \textcolor{keywordflow}{return} 1;
1117 
1118     uint16\_t length\_nodes = 0;
1119     \textcolor{keywordtype}{int} num\_nodes = \hyperlink{_d_h_t_8c_a45b33af842c0289c78c70f81e854ed62}{unpack\_nodes}(plain\_nodes, plain[0], &length\_nodes, plain + 1, data\_size, 0)
      ;
1120 
1121     \textcolor{keywordflow}{if} (length\_nodes != data\_size)
1122         \textcolor{keywordflow}{return} 1;
1123 
1124     \textcolor{keywordflow}{if} (num\_nodes != plain[0])
1125         \textcolor{keywordflow}{return} 1;
1126 
1127     \textcolor{keywordflow}{if} (num\_nodes <= 0)
1128         \textcolor{keywordflow}{return} 1;
1129 
1130     \textcolor{comment}{/* store the address the *request* was sent to */}
1131     \hyperlink{_d_h_t_8c_a9d898065db0fd4adf26fdb7f80e6d7ac}{addto\_lists}(dht, source, packet + 1);
1132 
1133     *num\_nodes\_out = num\_nodes;
1134 
1135     \hyperlink{_d_h_t_8c_ac35510e6bf4c6cfa950de4da3f4d8718}{send\_hardening\_getnode\_res}(dht, &sendback\_node, packet + 1, plain + 1, 
      data\_size);
1136     \textcolor{keywordflow}{return} 0;
1137 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a4dcc848207b2408def323b8b79b08e4a_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a4dcc848207b2408def323b8b79b08e4a_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_ac70b27be10ded8565ffcb94829e40514}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!handle\+\_\+sendnodes\+\_\+ipv6@{handle\+\_\+sendnodes\+\_\+ipv6}}
\index{handle\+\_\+sendnodes\+\_\+ipv6@{handle\+\_\+sendnodes\+\_\+ipv6}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{handle\+\_\+sendnodes\+\_\+ipv6}]{\setlength{\rightskip}{0pt plus 5cm}static int handle\+\_\+sendnodes\+\_\+ipv6 (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{object, }
\item[{{\bf I\+P\+\_\+\+Port}}]{source, }
\item[{const uint8\+\_\+t $\ast$}]{packet, }
\item[{uint16\+\_\+t}]{length}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_d_h_t_8c_ac70b27be10ded8565ffcb94829e40514}


Definition at line 1139 of file D\+H\+T.\+c.



References handle\+\_\+sendnodes\+\_\+core(), i, Node\+\_\+format\+::ip\+\_\+port, ipport\+\_\+isset(), L\+A\+N\+\_\+ip(), M\+A\+X\+\_\+\+S\+E\+N\+T\+\_\+\+N\+O\+D\+E\+S, D\+H\+T\+::ping, ping\+\_\+node\+\_\+from\+\_\+getnodes\+\_\+ok(), make-\/funny-\/savefile\+::public\+\_\+key, Node\+\_\+format\+::public\+\_\+key, returnedip\+\_\+ports(), and send\+\_\+ping\+\_\+request().



Referenced by new\+\_\+\+D\+H\+T().


\begin{DoxyCode}
1140 \{
1141     \hyperlink{struct_d_h_t}{DHT} *dht = object;
1142     \hyperlink{struct_node__format}{Node\_format} plain\_nodes[\hyperlink{_d_h_t_8h_a57f4cf16e79a384d7d59a3cc585ea5a3}{MAX\_SENT\_NODES}];
1143     uint32\_t num\_nodes;
1144 
1145     \textcolor{keywordflow}{if} (\hyperlink{_d_h_t_8c_a4dcc848207b2408def323b8b79b08e4a}{handle\_sendnodes\_core}(\textcolor{keywordtype}{object}, source, packet, length, plain\_nodes, 
      \hyperlink{_d_h_t_8h_a57f4cf16e79a384d7d59a3cc585ea5a3}{MAX\_SENT\_NODES}, &num\_nodes))
1146         \textcolor{keywordflow}{return} 1;
1147 
1148     \textcolor{keywordflow}{if} (num\_nodes == 0)
1149         \textcolor{keywordflow}{return} 0;
1150 
1151     uint32\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
1152 
1153     \textcolor{keywordflow}{for} (i = 0; i < num\_nodes; i++) \{
1154         \textcolor{keywordflow}{if} (\hyperlink{network_8c_a8436367218afb29bcf1b5fecd071648e}{ipport\_isset}(&plain\_nodes[i].ip\_port) && (\hyperlink{_l_a_n__discovery_8c_a2d80a53390598eb8ededbc63f4e9c152}{LAN\_ip}(plain\_nodes[i].ip\_port.ip) 
      == 0
1155                 || \hyperlink{_d_h_t_8c_ac03ed08d34d4135aa259515936209616}{ping\_node\_from\_getnodes\_ok}(dht, plain\_nodes[i].
      \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}))) \{
1156             \hyperlink{ping_8c_a1b3882fdfddc79be369ff230cd3e7a6a}{send\_ping\_request}(dht->\hyperlink{struct_d_h_t_ae3f68e3d55e46726b05717fc88198321}{ping}, plain\_nodes[i].
      \hyperlink{struct_node__format_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}, plain\_nodes[i].\hyperlink{struct_node__format_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key});
1157             \hyperlink{_d_h_t_8c_a8c25b3f909399fff843f905f2ad9615f}{returnedip\_ports}(dht, plain\_nodes[i].ip\_port, plain\_nodes[i].public\_key, packet
       + 1);
1158         \}
1159     \}
1160 
1161     \textcolor{keywordflow}{return} 0;
1162 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_ac70b27be10ded8565ffcb94829e40514_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_ac70b27be10ded8565ffcb94829e40514_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_a99cbbcdc9772e5c2b1ff8416074e88c0}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!hardening\+\_\+correct@{hardening\+\_\+correct}}
\index{hardening\+\_\+correct@{hardening\+\_\+correct}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{hardening\+\_\+correct}]{\setlength{\rightskip}{0pt plus 5cm}static uint8\+\_\+t hardening\+\_\+correct (
\begin{DoxyParamCaption}
\item[{const {\bf Hardening} $\ast$}]{h}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_d_h_t_8c_a99cbbcdc9772e5c2b1ff8416074e88c0}


Definition at line 457 of file D\+H\+T.\+c.



References Hardening\+::routes\+\_\+requests\+\_\+ok, Hardening\+::send\+\_\+nodes\+\_\+ok, and Hardening\+::testing\+\_\+requests.



Referenced by cmp\+\_\+dht\+\_\+entry(), and get\+\_\+close\+\_\+nodes\+\_\+inner().


\begin{DoxyCode}
458 \{
459     \textcolor{keywordflow}{return} h->\hyperlink{struct_hardening_a3bc4c156861571ceca55275d95f6221b}{routes\_requests\_ok} + (h->\hyperlink{struct_hardening_a11158e002f3685f4044a759680636c08}{send\_nodes\_ok} << 1) + (h->
      \hyperlink{struct_hardening_a48c7621d77e824da8df2c8a7caa79d25}{testing\_requests} << 2);
460 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a99cbbcdc9772e5c2b1ff8416074e88c0_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_a014ce120084edcbc79a5fda25820fe1a}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!have\+\_\+nodes\+\_\+closelist@{have\+\_\+nodes\+\_\+closelist}}
\index{have\+\_\+nodes\+\_\+closelist@{have\+\_\+nodes\+\_\+closelist}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{have\+\_\+nodes\+\_\+closelist}]{\setlength{\rightskip}{0pt plus 5cm}static uint32\+\_\+t have\+\_\+nodes\+\_\+closelist (
\begin{DoxyParamCaption}
\item[{{\bf D\+H\+T} $\ast$}]{dht, }
\item[{{\bf Node\+\_\+format} $\ast$}]{nodes, }
\item[{uint16\+\_\+t}]{num}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_d_h_t_8c_a014ce120084edcbc79a5fda25820fe1a}


Definition at line 1946 of file D\+H\+T.\+c.



References B\+A\+D\+\_\+\+N\+O\+D\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T, get\+\_\+closelist\+\_\+\+I\+P\+P\+Ts\+Png(), i, id\+\_\+equal(), is\+\_\+timeout(), num, D\+H\+T\+::self\+\_\+public\+\_\+key, and I\+P\+P\+Ts\+Png\+::timestamp.



Referenced by handle\+\_\+hardening().


\begin{DoxyCode}
1947 \{
1948     uint32\_t counter = 0;
1949     uint32\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
1950 
1951     \textcolor{keywordflow}{for} (i = 0; i < \hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
1952         \textcolor{keywordflow}{if} (\hyperlink{util_8c_ada3d44b4f530d3c8c9cb69b732be94b1}{id\_equal}(nodes[i].\hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, dht->\hyperlink{struct_d_h_t_ae726df8bdc26380e5a6c3187a00d6881}{self\_public\_key})) \{
1953             ++counter;
1954             \textcolor{keywordflow}{continue};
1955         \}
1956 
1957         \hyperlink{struct_i_p_p_ts_png}{IPPTsPng} *temp = \hyperlink{_d_h_t_8c_a0595b79448a6183eba8b2bcd77afcc8a}{get\_closelist\_IPPTsPng}(dht, nodes[i].public\_key, 
      nodes[i].ip\_port.ip.family);
1958 
1959         \textcolor{keywordflow}{if} (temp) \{
1960             \textcolor{keywordflow}{if} (!\hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(temp->\hyperlink{struct_i_p_p_ts_png_a465bef81f6478756e5443025b1f2ddfa}{timestamp}, \hyperlink{_d_h_t_8h_a2c542fd03a43f340d1fb281afe54453f}{BAD\_NODE\_TIMEOUT})) \{
1961                 ++counter;
1962             \}
1963         \}
1964     \}
1965 
1966     \textcolor{keywordflow}{return} counter;
1967 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a014ce120084edcbc79a5fda25820fe1a_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a014ce120084edcbc79a5fda25820fe1a_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_a903a5bc580826fe447adb841b7782333}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!id\+\_\+closest@{id\+\_\+closest}}
\index{id\+\_\+closest@{id\+\_\+closest}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{id\+\_\+closest}]{\setlength{\rightskip}{0pt plus 5cm}int id\+\_\+closest (
\begin{DoxyParamCaption}
\item[{const uint8\+\_\+t $\ast$}]{pk, }
\item[{const uint8\+\_\+t $\ast$}]{pk1, }
\item[{const uint8\+\_\+t $\ast$}]{pk2}
\end{DoxyParamCaption}
)}}\label{_d_h_t_8c_a903a5bc580826fe447adb841b7782333}


Definition at line 74 of file D\+H\+T.\+c.



References i.



Referenced by add\+\_\+to\+\_\+entries(), add\+\_\+to\+\_\+ping(), assoc\+\_\+id\+\_\+closest(), client\+\_\+add\+\_\+to\+\_\+list(), client\+\_\+ping\+\_\+nodes(), cmp\+\_\+dht\+\_\+entry(), cmp\+\_\+entry(), get\+\_\+close\+\_\+nodes\+\_\+inner(), is\+\_\+furthest(), store\+\_\+node\+\_\+ok(), and test\+\_\+addto\+\_\+lists\+\_\+possible\+\_\+bad().


\begin{DoxyCode}
75 \{
76     \textcolor{keywordtype}{size\_t}   \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
77     uint8\_t distance1, distance2;
78 
79     \textcolor{keywordflow}{for} (i = 0; i < crypto\_box\_PUBLICKEYBYTES; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
80 
81         distance1 = pk[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}] ^ pk1[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}];
82         distance2 = pk[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}] ^ pk2[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}];
83 
84         \textcolor{keywordflow}{if} (distance1 < distance2)
85             \textcolor{keywordflow}{return} 1;
86 
87         \textcolor{keywordflow}{if} (distance1 > distance2)
88             \textcolor{keywordflow}{return} 2;
89     \}
90 
91     \textcolor{keywordflow}{return} 0;
92 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a903a5bc580826fe447adb841b7782333_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_a816851e4f0f454c52b93d65544a2b2bb}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!kill\+\_\+\+D\+H\+T@{kill\+\_\+\+D\+H\+T}}
\index{kill\+\_\+\+D\+H\+T@{kill\+\_\+\+D\+H\+T}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{kill\+\_\+\+D\+H\+T}]{\setlength{\rightskip}{0pt plus 5cm}void kill\+\_\+\+D\+H\+T (
\begin{DoxyParamCaption}
\item[{{\bf D\+H\+T} $\ast$}]{dht}
\end{DoxyParamCaption}
)}}\label{_d_h_t_8c_a816851e4f0f454c52b93d65544a2b2bb}


Definition at line 2268 of file D\+H\+T.\+c.



References C\+R\+Y\+P\+T\+O\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+H\+A\+R\+D\+E\+N\+I\+N\+G, C\+R\+Y\+P\+T\+O\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+N\+A\+T\+\_\+\+P\+I\+N\+G, cryptopacket\+\_\+registerhandler(), D\+H\+T\+::dht\+\_\+harden\+\_\+ping\+\_\+array, D\+H\+T\+::dht\+\_\+ping\+\_\+array, D\+H\+T\+::friends\+\_\+list, kill\+\_\+\+Assoc(), kill\+\_\+ping(), D\+H\+T\+::loaded\+\_\+nodes\+\_\+list, D\+H\+T\+::net, N\+E\+T\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+G\+E\+T\+\_\+\+N\+O\+D\+E\+S, N\+E\+T\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+S\+E\+N\+D\+\_\+\+N\+O\+D\+E\+S\+\_\+\+I\+P\+V6, networking\+\_\+registerhandler(), D\+H\+T\+::ping, and ping\+\_\+array\+\_\+free\+\_\+all().



Referenced by kill\+\_\+messenger(), kill\+\_\+onions(), new\+\_\+\+D\+H\+T(), new\+\_\+messenger(), S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T(), and test\+\_\+addto\+\_\+lists().


\begin{DoxyCode}
2269 \{
2270 \textcolor{preprocessor}{#ifdef ENABLE\_ASSOC\_DHT}
2271     \hyperlink{assoc_8c_a26d82e35d047181d0e883a4b91373793}{kill\_Assoc}(dht->assoc);
2272 \textcolor{preprocessor}{#endif}
2273     \hyperlink{network_8c_a230a192ca9463ec4985d4f86de439733}{networking\_registerhandler}(dht->\hyperlink{struct_d_h_t_aa14ea2f67950f57fe4235d7375a2216c}{net}, 
      \hyperlink{network_8h_a861e63c2b32751aa406f11283f5b0925}{NET\_PACKET\_GET\_NODES}, NULL, NULL);
2274     \hyperlink{network_8c_a230a192ca9463ec4985d4f86de439733}{networking\_registerhandler}(dht->\hyperlink{struct_d_h_t_aa14ea2f67950f57fe4235d7375a2216c}{net}, 
      \hyperlink{network_8h_a868cfc97dcb064ca456278fc89f9b512}{NET\_PACKET\_SEND\_NODES\_IPV6}, NULL, NULL);
2275     \hyperlink{_d_h_t_8c_a097913efd03d5106a66c15eb48b0e104}{cryptopacket\_registerhandler}(dht, 
      \hyperlink{crypto__core_8h_accd0074d1bd9133de6460d75b10b1e21}{CRYPTO\_PACKET\_NAT\_PING}, NULL, NULL);
2276     \hyperlink{_d_h_t_8c_a097913efd03d5106a66c15eb48b0e104}{cryptopacket\_registerhandler}(dht, 
      \hyperlink{crypto__core_8h_a703b04f256fec46afbcc98b86c86d5a7}{CRYPTO\_PACKET\_HARDENING}, NULL, NULL);
2277     \hyperlink{ping__array_8c_a7e093974e6d616c5bbcadfd434b49824}{ping\_array\_free\_all}(&dht->\hyperlink{struct_d_h_t_a8432234ba71a00ac9c516cb80a70f29d}{dht\_ping\_array});
2278     \hyperlink{ping__array_8c_a7e093974e6d616c5bbcadfd434b49824}{ping\_array\_free\_all}(&dht->\hyperlink{struct_d_h_t_a957126e184a8b8001228effc56b9db95}{dht\_harden\_ping\_array});
2279     \hyperlink{ping_8c_a9487f04f4bb6ac4be59a4166236ec896}{kill\_ping}(dht->\hyperlink{struct_d_h_t_ae3f68e3d55e46726b05717fc88198321}{ping});
2280     free(dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list});
2281     free(dht->\hyperlink{struct_d_h_t_a3050c21873637c51d8001c807f62fa74}{loaded\_nodes\_list});
2282     free(dht);
2283 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a816851e4f0f454c52b93d65544a2b2bb_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a816851e4f0f454c52b93d65544a2b2bb_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_ae24a26ad9533b87cfbcb0093430bf136}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!N\+A\+T\+\_\+commonip@{N\+A\+T\+\_\+commonip}}
\index{N\+A\+T\+\_\+commonip@{N\+A\+T\+\_\+commonip}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{N\+A\+T\+\_\+commonip}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf I\+P} N\+A\+T\+\_\+commonip (
\begin{DoxyParamCaption}
\item[{{\bf I\+P\+\_\+\+Port} $\ast$}]{ip\+\_\+portlist, }
\item[{uint16\+\_\+t}]{len, }
\item[{uint16\+\_\+t}]{min\+\_\+num}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_d_h_t_8c_ae24a26ad9533b87cfbcb0093430bf136}


Definition at line 1733 of file D\+H\+T.\+c.



References i, ip, I\+P\+\_\+\+Port\+::ip, ip\+\_\+equal(), ip\+\_\+reset(), and M\+A\+X\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+C\+L\+I\+E\+N\+T\+S.



Referenced by do\+\_\+\+N\+A\+T().


\begin{DoxyCode}
1734 \{
1735     \hyperlink{struct_i_p}{IP} zero;
1736     \hyperlink{network_8c_a2bfd1efbce5b035b10c879a7e85c08df}{ip\_reset}(&zero);
1737 
1738     \textcolor{keywordflow}{if} (len > \hyperlink{_d_h_t_8h_ad50d158518277ca4d19cbe364f3e958c}{MAX\_FRIEND\_CLIENTS})
1739         \textcolor{keywordflow}{return} zero;
1740 
1741     uint32\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}, j;
1742     uint16\_t numbers[\hyperlink{_d_h_t_8h_ad50d158518277ca4d19cbe364f3e958c}{MAX\_FRIEND\_CLIENTS}] = \{0\};
1743 
1744     \textcolor{keywordflow}{for} (i = 0; i < len; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
1745         \textcolor{keywordflow}{for} (j = 0; j < len; ++j) \{
1746             \textcolor{keywordflow}{if} (\hyperlink{network_8c_af982256c6d8486349bdc13a920884ef6}{ip\_equal}(&ip\_portlist[i].\hyperlink{irc__syncbot_8c_ae81515e082f9bc33e8968181945586da}{ip}, &ip\_portlist[j].ip))
1747                 ++numbers[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}];
1748         \}
1749 
1750         \textcolor{keywordflow}{if} (numbers[i] >= min\_num)
1751             \textcolor{keywordflow}{return} ip\_portlist[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}].\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip};
1752     \}
1753 
1754     \textcolor{keywordflow}{return} zero;
1755 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=256pt]{dc/dc1/_d_h_t_8c_ae24a26ad9533b87cfbcb0093430bf136_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_ae24a26ad9533b87cfbcb0093430bf136_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_a987dbba116d9982c336ea818f05e8c7c}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!N\+A\+T\+\_\+getports@{N\+A\+T\+\_\+getports}}
\index{N\+A\+T\+\_\+getports@{N\+A\+T\+\_\+getports}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{N\+A\+T\+\_\+getports}]{\setlength{\rightskip}{0pt plus 5cm}static uint16\+\_\+t N\+A\+T\+\_\+getports (
\begin{DoxyParamCaption}
\item[{uint16\+\_\+t $\ast$}]{portlist, }
\item[{{\bf I\+P\+\_\+\+Port} $\ast$}]{ip\+\_\+portlist, }
\item[{uint16\+\_\+t}]{len, }
\item[{{\bf I\+P}}]{ip}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_d_h_t_8c_a987dbba116d9982c336ea818f05e8c7c}


Definition at line 1763 of file D\+H\+T.\+c.



References i, ip\+\_\+equal(), num, and port.



Referenced by do\+\_\+\+N\+A\+T().


\begin{DoxyCode}
1764 \{
1765     uint32\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
1766     uint16\_t \hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num} = 0;
1767 
1768     \textcolor{keywordflow}{for} (i = 0; i < len; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
1769         \textcolor{keywordflow}{if} (\hyperlink{network_8c_af982256c6d8486349bdc13a920884ef6}{ip\_equal}(&ip\_portlist[i].ip, &ip)) \{
1770             portlist[\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num}] = ntohs(ip\_portlist[i].\hyperlink{irc__syncbot_8c_a8e0798404bf2cf5dabb84c5ba9a4f236}{port});
1771             ++\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num};
1772         \}
1773     \}
1774 
1775     \textcolor{keywordflow}{return} \hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num};
1776 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=246pt]{dc/dc1/_d_h_t_8c_a987dbba116d9982c336ea818f05e8c7c_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a987dbba116d9982c336ea818f05e8c7c_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_adad04fa897751b06948a172044bf1c58}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!new\+\_\+\+D\+H\+T@{new\+\_\+\+D\+H\+T}}
\index{new\+\_\+\+D\+H\+T@{new\+\_\+\+D\+H\+T}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{new\+\_\+\+D\+H\+T}]{\setlength{\rightskip}{0pt plus 5cm}{\bf D\+H\+T}$\ast$ new\+\_\+\+D\+H\+T (
\begin{DoxyParamCaption}
\item[{{\bf Networking\+\_\+\+Core} $\ast$}]{net}
\end{DoxyParamCaption}
)}}\label{_d_h_t_8c_adad04fa897751b06948a172044bf1c58}


Definition at line 2196 of file D\+H\+T.\+c.



References C\+R\+Y\+P\+T\+O\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+H\+A\+R\+D\+E\+N\+I\+N\+G, C\+R\+Y\+P\+T\+O\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+N\+A\+T\+\_\+\+P\+I\+N\+G, cryptopacket\+\_\+handle(), cryptopacket\+\_\+registerhandler(), D\+H\+T\+\_\+addfriend(), D\+H\+T\+\_\+\+F\+A\+K\+E\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+N\+U\+M\+B\+E\+R, D\+H\+T\+::dht\+\_\+harden\+\_\+ping\+\_\+array, D\+H\+T\+::dht\+\_\+ping\+\_\+array, D\+H\+T\+\_\+\+P\+I\+N\+G\+\_\+\+A\+R\+R\+A\+Y\+\_\+\+S\+I\+Z\+E, handle\+\_\+getnodes(), handle\+\_\+hardening(), handle\+\_\+\+N\+A\+Tping(), handle\+\_\+sendnodes\+\_\+ipv6(), i, kill\+\_\+\+D\+H\+T(), D\+H\+T\+::net, N\+E\+T\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+C\+R\+Y\+P\+T\+O, N\+E\+T\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+G\+E\+T\+\_\+\+N\+O\+D\+E\+S, N\+E\+T\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+S\+E\+N\+D\+\_\+\+N\+O\+D\+E\+S\+\_\+\+I\+P\+V6, networking\+\_\+registerhandler(), new\+\_\+\+Assoc\+\_\+default(), new\+\_\+ping(), new\+\_\+symmetric\+\_\+key(), D\+H\+T\+::ping, ping\+\_\+array\+\_\+init(), P\+I\+N\+G\+\_\+\+T\+I\+M\+E\+O\+U\+T, D\+H\+T\+::secret\+\_\+symmetric\+\_\+key, D\+H\+T\+::self\+\_\+public\+\_\+key, D\+H\+T\+::self\+\_\+secret\+\_\+key, and unix\+\_\+time\+\_\+update().



Referenced by main(), new\+\_\+messenger(), new\+\_\+onions(), S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T(), and test\+\_\+addto\+\_\+lists().


\begin{DoxyCode}
2197 \{
2198     \textcolor{comment}{/* init time */}
2199     \hyperlink{util_8c_a849af10dd491723cf3abdef599846897}{unix\_time\_update}();
2200 
2201     \textcolor{keywordflow}{if} (net == NULL)
2202         \textcolor{keywordflow}{return} NULL;
2203 
2204     \hyperlink{struct_d_h_t}{DHT} *dht = calloc(1, \textcolor{keyword}{sizeof}(\hyperlink{struct_d_h_t}{DHT}));
2205 
2206     \textcolor{keywordflow}{if} (dht == NULL)
2207         \textcolor{keywordflow}{return} NULL;
2208 
2209     dht->\hyperlink{struct_d_h_t_aa14ea2f67950f57fe4235d7375a2216c}{net} = net;
2210     dht->\hyperlink{struct_d_h_t_ae3f68e3d55e46726b05717fc88198321}{ping} = \hyperlink{ping_8c_a86e9eeead72b88b686ce5b7c0f78c325}{new\_ping}(dht);
2211 
2212     \textcolor{keywordflow}{if} (dht->\hyperlink{struct_d_h_t_ae3f68e3d55e46726b05717fc88198321}{ping} == NULL) \{
2213         \hyperlink{_d_h_t_8c_a816851e4f0f454c52b93d65544a2b2bb}{kill\_DHT}(dht);
2214         \textcolor{keywordflow}{return} NULL;
2215     \}
2216 
2217     \hyperlink{network_8c_a230a192ca9463ec4985d4f86de439733}{networking\_registerhandler}(dht->\hyperlink{struct_d_h_t_aa14ea2f67950f57fe4235d7375a2216c}{net}, 
      \hyperlink{network_8h_a861e63c2b32751aa406f11283f5b0925}{NET\_PACKET\_GET\_NODES}, &\hyperlink{_d_h_t_8c_afa4f13a29cbe60809f2446267d109383}{handle\_getnodes}, dht);
2218     \hyperlink{network_8c_a230a192ca9463ec4985d4f86de439733}{networking\_registerhandler}(dht->\hyperlink{struct_d_h_t_aa14ea2f67950f57fe4235d7375a2216c}{net}, 
      \hyperlink{network_8h_a868cfc97dcb064ca456278fc89f9b512}{NET\_PACKET\_SEND\_NODES\_IPV6}, &\hyperlink{_d_h_t_8c_ac70b27be10ded8565ffcb94829e40514}{handle\_sendnodes\_ipv6}, dht);
2219     \hyperlink{network_8c_a230a192ca9463ec4985d4f86de439733}{networking\_registerhandler}(dht->\hyperlink{struct_d_h_t_aa14ea2f67950f57fe4235d7375a2216c}{net}, 
      \hyperlink{network_8h_aebd9a38e63bac9807d0c2c1cfed68a15}{NET\_PACKET\_CRYPTO}, &\hyperlink{_d_h_t_8c_aa8dd9b8abd89728492c0c9c6299c0a8b}{cryptopacket\_handle}, dht);
2220     \hyperlink{_d_h_t_8c_a097913efd03d5106a66c15eb48b0e104}{cryptopacket\_registerhandler}(dht, 
      \hyperlink{crypto__core_8h_accd0074d1bd9133de6460d75b10b1e21}{CRYPTO\_PACKET\_NAT\_PING}, &\hyperlink{_d_h_t_8c_a9684ffd3987f6c79663c1f07eed0c007}{handle\_NATping}, dht);
2221     \hyperlink{_d_h_t_8c_a097913efd03d5106a66c15eb48b0e104}{cryptopacket\_registerhandler}(dht, 
      \hyperlink{crypto__core_8h_a703b04f256fec46afbcc98b86c86d5a7}{CRYPTO\_PACKET\_HARDENING}, &\hyperlink{_d_h_t_8c_aa38b3670da696f600f37989e79ce4966}{handle\_hardening}, dht);
2222 
2223     \hyperlink{crypto__core_8c_a89b4a1a4a7d8bfabdf0e1b60f074e531}{new\_symmetric\_key}(dht->\hyperlink{struct_d_h_t_ab9f2ff47bc0b1e5110202a6e4be86390}{secret\_symmetric\_key});
2224     crypto\_box\_keypair(dht->\hyperlink{struct_d_h_t_ae726df8bdc26380e5a6c3187a00d6881}{self\_public\_key}, dht->\hyperlink{struct_d_h_t_aa05050f86513ff53fe9da81f73c72267}{self\_secret\_key});
2225 
2226     \hyperlink{ping__array_8c_a2d42b1adf1e6ff6a690fc515b9bb2570}{ping\_array\_init}(&dht->\hyperlink{struct_d_h_t_a8432234ba71a00ac9c516cb80a70f29d}{dht\_ping\_array}, 
      \hyperlink{_d_h_t_8h_aa025d4328dd829fe6d532d3abaf3bc7e}{DHT\_PING\_ARRAY\_SIZE}, \hyperlink{_d_h_t_8h_a733f0d1225f97d8acbd3388e0c0d320f}{PING\_TIMEOUT});
2227     \hyperlink{ping__array_8c_a2d42b1adf1e6ff6a690fc515b9bb2570}{ping\_array\_init}(&dht->\hyperlink{struct_d_h_t_a957126e184a8b8001228effc56b9db95}{dht\_harden\_ping\_array}, 
      \hyperlink{_d_h_t_8h_aa025d4328dd829fe6d532d3abaf3bc7e}{DHT\_PING\_ARRAY\_SIZE}, \hyperlink{_d_h_t_8h_a733f0d1225f97d8acbd3388e0c0d320f}{PING\_TIMEOUT});
2228 \textcolor{preprocessor}{#ifdef ENABLE\_ASSOC\_DHT}
2229     dht->assoc = \hyperlink{assoc_8c_ab7f978008ad6c86ab5063e989fe49d0c}{new\_Assoc\_default}(dht->\hyperlink{struct_d_h_t_ae726df8bdc26380e5a6c3187a00d6881}{self\_public\_key});
2230 \textcolor{preprocessor}{#endif}
2231     uint32\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
2232 
2233     \textcolor{keywordflow}{for} (i = 0; i < \hyperlink{_d_h_t_8h_a09839809f361926e324196bfd9450bb4}{DHT\_FAKE\_FRIEND\_NUMBER}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
2234         uint8\_t random\_key\_bytes[crypto\_box\_PUBLICKEYBYTES];
2235         randombytes(random\_key\_bytes, \textcolor{keyword}{sizeof}(random\_key\_bytes));
2236         \hyperlink{_d_h_t_8c_a1dac5e05fd07964cb4914c17afeb9d50}{DHT\_addfriend}(dht, random\_key\_bytes, 0, 0, 0, 0);
2237     \}
2238 
2239     \textcolor{keywordflow}{return} dht;
2240 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=550pt]{dc/dc1/_d_h_t_8c_adad04fa897751b06948a172044bf1c58_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_adad04fa897751b06948a172044bf1c58_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_a1d6f2fcb008c989f333ae89e840f94b4}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!pack\+\_\+nodes@{pack\+\_\+nodes}}
\index{pack\+\_\+nodes@{pack\+\_\+nodes}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{pack\+\_\+nodes}]{\setlength{\rightskip}{0pt plus 5cm}int pack\+\_\+nodes (
\begin{DoxyParamCaption}
\item[{uint8\+\_\+t $\ast$}]{data, }
\item[{uint16\+\_\+t}]{length, }
\item[{const {\bf Node\+\_\+format} $\ast$}]{nodes, }
\item[{uint16\+\_\+t}]{number}
\end{DoxyParamCaption}
)}}\label{_d_h_t_8c_a1d6f2fcb008c989f333ae89e840f94b4}


Definition at line 207 of file D\+H\+T.\+c.



References i, P\+A\+C\+K\+E\+D\+\_\+\+N\+O\+D\+E\+\_\+\+S\+I\+Z\+E\+\_\+\+I\+P4, P\+A\+C\+K\+E\+D\+\_\+\+N\+O\+D\+E\+\_\+\+S\+I\+Z\+E\+\_\+\+I\+P6, make-\/funny-\/savefile\+::public\+\_\+key, S\+I\+Z\+E\+\_\+\+I\+P4, S\+I\+Z\+E\+\_\+\+I\+P6, T\+C\+P\+\_\+\+I\+N\+E\+T, T\+C\+P\+\_\+\+I\+N\+E\+T6, T\+O\+X\+\_\+\+A\+F\+\_\+\+I\+N\+E\+T, T\+O\+X\+\_\+\+A\+F\+\_\+\+I\+N\+E\+T6, T\+O\+X\+\_\+\+T\+C\+P\+\_\+\+I\+N\+E\+T, and T\+O\+X\+\_\+\+T\+C\+P\+\_\+\+I\+N\+E\+T6.



Referenced by D\+H\+T\+\_\+save(), handle\+\_\+announce\+\_\+request(), messenger\+\_\+save(), send\+\_\+dhtpk\+\_\+announce(), send\+\_\+relays(), and sendnodes\+\_\+ipv6().


\begin{DoxyCode}
208 \{
209     uint32\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}, packed\_length = 0;
210 
211     \textcolor{keywordflow}{for} (i = 0; i < number; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
212         \textcolor{keywordtype}{int} ipv6 = -1;
213         uint8\_t net\_family;
214 
215         \textcolor{keywordflow}{if} (nodes[i].ip\_port.ip.family == AF\_INET) \{
216             ipv6 = 0;
217             net\_family = \hyperlink{_d_h_t_8h_ac35a63082a23b6ced97c0a3a24ba06be}{TOX\_AF\_INET};
218         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (nodes[i].ip\_port.ip.family == \hyperlink{network_8h_a38cdd2f189180d6790d5b181f55ca047}{TCP\_INET}) \{
219             ipv6 = 0;
220             net\_family = \hyperlink{_d_h_t_8h_ab59616c5422ae79ebc665059761879d5}{TOX\_TCP\_INET};
221         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (nodes[i].ip\_port.ip.family == AF\_INET6) \{
222             ipv6 = 1;
223             net\_family = \hyperlink{_d_h_t_8h_a025adcf535ab2c7123fb5ea22fe20bbd}{TOX\_AF\_INET6};
224         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (nodes[i].ip\_port.ip.family == \hyperlink{network_8h_a7cd884776d628ca50049592d963c10cc}{TCP\_INET6}) \{
225             ipv6 = 1;
226             net\_family = \hyperlink{_d_h_t_8h_a30bf86f2e1f87bcbd6a90145943aabac}{TOX\_TCP\_INET6};
227         \} \textcolor{keywordflow}{else} \{
228             \textcolor{keywordflow}{return} -1;
229         \}
230 
231         \textcolor{keywordflow}{if} (ipv6 == 0) \{
232             uint32\_t size = \hyperlink{_d_h_t_8c_a03601baefa220335487dfc838c08d268}{PACKED\_NODE\_SIZE\_IP4};
233 
234             \textcolor{keywordflow}{if} (packed\_length + size > length)
235                 \textcolor{keywordflow}{return} -1;
236 
237             \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[packed\_length] = net\_family;
238             memcpy(\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} + packed\_length + 1, &nodes[i].ip\_port.ip.ip4, 
      \hyperlink{network_8h_af01e75c1c63a39bcd2aacdf3018b18c9}{SIZE\_IP4});
239             memcpy(\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} + packed\_length + 1 + \hyperlink{network_8h_af01e75c1c63a39bcd2aacdf3018b18c9}{SIZE\_IP4}, &nodes[i].ip\_port.port, \textcolor{keyword}{sizeof}(uint16\_t
      ));
240             memcpy(\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} + packed\_length + 1 + \hyperlink{network_8h_af01e75c1c63a39bcd2aacdf3018b18c9}{SIZE\_IP4} + \textcolor{keyword}{sizeof}(uint16\_t), nodes[i].
      \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, crypto\_box\_PUBLICKEYBYTES);
241             packed\_length += size;
242         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (ipv6 == 1) \{
243             uint32\_t size = \hyperlink{_d_h_t_8c_a9b47e23b0610a17f01902680f55d7963}{PACKED\_NODE\_SIZE\_IP6};
244 
245             \textcolor{keywordflow}{if} (packed\_length + size > length)
246                 \textcolor{keywordflow}{return} -1;
247 
248             \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[packed\_length] = net\_family;
249             memcpy(\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} + packed\_length + 1, &nodes[i].ip\_port.ip.ip6, 
      \hyperlink{network_8h_a5d7430ad26f80239b9fe1bbcd51b5ed2}{SIZE\_IP6});
250             memcpy(\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} + packed\_length + 1 + \hyperlink{network_8h_a5d7430ad26f80239b9fe1bbcd51b5ed2}{SIZE\_IP6}, &nodes[i].ip\_port.port, \textcolor{keyword}{sizeof}(uint16\_t
      ));
251             memcpy(\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} + packed\_length + 1 + \hyperlink{network_8h_a5d7430ad26f80239b9fe1bbcd51b5ed2}{SIZE\_IP6} + \textcolor{keyword}{sizeof}(uint16\_t), nodes[i].
      \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, crypto\_box\_PUBLICKEYBYTES);
252             packed\_length += size;
253         \} \textcolor{keywordflow}{else} \{
254             \textcolor{keywordflow}{return} -1;
255         \}
256     \}
257 
258     \textcolor{keywordflow}{return} packed\_length;
259 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a1d6f2fcb008c989f333ae89e840f94b4_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_aa980937ac320a4389b726e04da26cb44}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!packed\+\_\+node\+\_\+size@{packed\+\_\+node\+\_\+size}}
\index{packed\+\_\+node\+\_\+size@{packed\+\_\+node\+\_\+size}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{packed\+\_\+node\+\_\+size}]{\setlength{\rightskip}{0pt plus 5cm}int packed\+\_\+node\+\_\+size (
\begin{DoxyParamCaption}
\item[{uint8\+\_\+t}]{ip\+\_\+family}
\end{DoxyParamCaption}
)}}\label{_d_h_t_8c_aa980937ac320a4389b726e04da26cb44}


Definition at line 186 of file D\+H\+T.\+c.



References P\+A\+C\+K\+E\+D\+\_\+\+N\+O\+D\+E\+\_\+\+S\+I\+Z\+E\+\_\+\+I\+P4, P\+A\+C\+K\+E\+D\+\_\+\+N\+O\+D\+E\+\_\+\+S\+I\+Z\+E\+\_\+\+I\+P6, T\+C\+P\+\_\+\+I\+N\+E\+T, and T\+C\+P\+\_\+\+I\+N\+E\+T6.



Referenced by D\+H\+T\+\_\+size(), messenger\+\_\+save(), and messenger\+\_\+size().


\begin{DoxyCode}
187 \{
188     \textcolor{keywordflow}{if} (ip\_family == AF\_INET) \{
189         \textcolor{keywordflow}{return} \hyperlink{_d_h_t_8c_a03601baefa220335487dfc838c08d268}{PACKED\_NODE\_SIZE\_IP4};
190     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (ip\_family == \hyperlink{network_8h_a38cdd2f189180d6790d5b181f55ca047}{TCP\_INET}) \{
191         \textcolor{keywordflow}{return} \hyperlink{_d_h_t_8c_a03601baefa220335487dfc838c08d268}{PACKED\_NODE\_SIZE\_IP4};
192     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (ip\_family == AF\_INET6) \{
193         \textcolor{keywordflow}{return} \hyperlink{_d_h_t_8c_a9b47e23b0610a17f01902680f55d7963}{PACKED\_NODE\_SIZE\_IP6};
194     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (ip\_family == \hyperlink{network_8h_a7cd884776d628ca50049592d963c10cc}{TCP\_INET6}) \{
195         \textcolor{keywordflow}{return} \hyperlink{_d_h_t_8c_a9b47e23b0610a17f01902680f55d7963}{PACKED\_NODE\_SIZE\_IP6};
196     \} \textcolor{keywordflow}{else} \{
197         \textcolor{keywordflow}{return} -1;
198     \}
199 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_aa980937ac320a4389b726e04da26cb44_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_ac03ed08d34d4135aa259515936209616}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!ping\+\_\+node\+\_\+from\+\_\+getnodes\+\_\+ok@{ping\+\_\+node\+\_\+from\+\_\+getnodes\+\_\+ok}}
\index{ping\+\_\+node\+\_\+from\+\_\+getnodes\+\_\+ok@{ping\+\_\+node\+\_\+from\+\_\+getnodes\+\_\+ok}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{ping\+\_\+node\+\_\+from\+\_\+getnodes\+\_\+ok}]{\setlength{\rightskip}{0pt plus 5cm}static unsigned int ping\+\_\+node\+\_\+from\+\_\+getnodes\+\_\+ok (
\begin{DoxyParamCaption}
\item[{{\bf D\+H\+T} $\ast$}]{dht, }
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_d_h_t_8c_ac03ed08d34d4135aa259515936209616}


Definition at line 749 of file D\+H\+T.\+c.



References D\+H\+T\+\_\+\+Friend\+::client\+\_\+list, D\+H\+T\+::close\+\_\+clientlist, D\+H\+T\+::friends\+\_\+list, i, D\+H\+T\+::num\+\_\+friends, D\+H\+T\+::self\+\_\+public\+\_\+key, and store\+\_\+node\+\_\+ok().



Referenced by handle\+\_\+sendnodes\+\_\+ipv6().


\begin{DoxyCode}
750 \{
751     \textcolor{keywordflow}{if} (\hyperlink{_d_h_t_8c_addb87a718c80bb27e53e8dde5972dfe9}{store\_node\_ok}(&dht->\hyperlink{struct_d_h_t_a00ef35d5b0e7a791ef08a30b3bacbf9d}{close\_clientlist}[0], 
      \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, dht->\hyperlink{struct_d_h_t_ae726df8bdc26380e5a6c3187a00d6881}{self\_public\_key})) \{
752         \textcolor{keywordflow}{return} 1;
753     \}
754 
755     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
756 
757     \textcolor{keywordflow}{for} (i = 0; i < dht->\hyperlink{struct_d_h_t_a8ee1f2d7e543bce350c591a8eaac0cf8}{num\_friends}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
758         \textcolor{keywordflow}{if} (\hyperlink{_d_h_t_8c_addb87a718c80bb27e53e8dde5972dfe9}{store\_node\_ok}(&dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[i].
      \hyperlink{struct_d_h_t___friend_a49ef2b640a834a77b6e123355a4fea47}{client\_list}[0], \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, dht->\hyperlink{struct_d_h_t_ae726df8bdc26380e5a6c3187a00d6881}{self\_public\_key})) \{
759             \textcolor{keywordflow}{return} 1;
760         \}
761     \}
762 
763     \textcolor{keywordflow}{return} 0;
764 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_ac03ed08d34d4135aa259515936209616_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_ac03ed08d34d4135aa259515936209616_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_a7efc873280e2d502bf49489d3ebacc9c}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!punch\+\_\+holes@{punch\+\_\+holes}}
\index{punch\+\_\+holes@{punch\+\_\+holes}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{punch\+\_\+holes}]{\setlength{\rightskip}{0pt plus 5cm}static void punch\+\_\+holes (
\begin{DoxyParamCaption}
\item[{{\bf D\+H\+T} $\ast$}]{dht, }
\item[{{\bf I\+P}}]{ip, }
\item[{uint16\+\_\+t $\ast$}]{port\+\_\+list, }
\item[{uint16\+\_\+t}]{numports, }
\item[{uint16\+\_\+t}]{friend\+\_\+num}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_d_h_t_8c_a7efc873280e2d502bf49489d3ebacc9c}


Definition at line 1778 of file D\+H\+T.\+c.



References D\+H\+T\+::friends\+\_\+list, i, I\+P\+\_\+\+Port\+::ip, ip\+\_\+copy(), M\+A\+X\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+C\+L\+I\+E\+N\+T\+S, M\+A\+X\+\_\+\+N\+O\+R\+M\+A\+L\+\_\+\+P\+U\+N\+C\+H\+I\+N\+G\+\_\+\+T\+R\+I\+E\+S, M\+A\+X\+\_\+\+P\+U\+N\+C\+H\+I\+N\+G\+\_\+\+P\+O\+R\+T\+S, D\+H\+T\+\_\+\+Friend\+::nat, D\+H\+T\+::ping, port, I\+P\+\_\+\+Port\+::port, D\+H\+T\+\_\+\+Friend\+::public\+\_\+key, N\+A\+T\+::punching\+\_\+index, N\+A\+T\+::punching\+\_\+index2, send\+\_\+ping\+\_\+request(), and N\+A\+T\+::tries.



Referenced by do\+\_\+\+N\+A\+T().


\begin{DoxyCode}
1779 \{
1780     \textcolor{keywordflow}{if} (numports > \hyperlink{_d_h_t_8h_ad50d158518277ca4d19cbe364f3e958c}{MAX\_FRIEND\_CLIENTS} || numports == 0)
1781         \textcolor{keywordflow}{return};
1782 
1783     uint32\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
1784     uint32\_t top = dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[friend\_num].\hyperlink{struct_d_h_t___friend_a96318690475243d010825feb2a67b41c}{nat}.
      \hyperlink{struct_n_a_t_aeb4b0f7724adb0857b15e0f34e95ecca}{punching\_index} + \hyperlink{_d_h_t_8c_aa26d44826e51b690cac89a8e81b53710}{MAX\_PUNCHING\_PORTS};
1785     uint16\_t firstport = port\_list[0];
1786 
1787     \textcolor{keywordflow}{for} (i = 0; i < numports; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
1788         \textcolor{keywordflow}{if} (firstport != port\_list[i])
1789             \textcolor{keywordflow}{break};
1790     \}
1791 
1792     \textcolor{keywordflow}{if} (i == numports) \{ \textcolor{comment}{/* If all ports are the same, only try that one port. */}
1793         \hyperlink{struct_i_p___port}{IP\_Port} pinging;
1794         \hyperlink{network_8c_a66563da83f68de4f5e9d7c5f2f72c8f3}{ip\_copy}(&pinging.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}, &ip);
1795         pinging.\hyperlink{struct_i_p___port_a8e0798404bf2cf5dabb84c5ba9a4f236}{port} = htons(firstport);
1796         \hyperlink{ping_8c_a1b3882fdfddc79be369ff230cd3e7a6a}{send\_ping\_request}(dht->\hyperlink{struct_d_h_t_ae3f68e3d55e46726b05717fc88198321}{ping}, pinging, dht->
      \hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[friend\_num].\hyperlink{struct_d_h_t___friend_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key});
1797     \} \textcolor{keywordflow}{else} \{
1798         \textcolor{keywordflow}{for} (i = dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[friend\_num].\hyperlink{struct_d_h_t___friend_a96318690475243d010825feb2a67b41c}{nat}.\hyperlink{struct_n_a_t_aeb4b0f7724adb0857b15e0f34e95ecca}{punching\_index}; i != top; 
      ++i) \{
1799             \textcolor{comment}{/* TODO: Improve port guessing algorithm. */}
1800             uint16\_t \hyperlink{irc__syncbot_8c_a8e0798404bf2cf5dabb84c5ba9a4f236}{port} = port\_list[(i / 2) % numports] + (i / (2 * numports)) * ((i % 2) ? -1 : 1);
1801             \hyperlink{struct_i_p___port}{IP\_Port} pinging;
1802             \hyperlink{network_8c_a66563da83f68de4f5e9d7c5f2f72c8f3}{ip\_copy}(&pinging.ip, &ip);
1803             pinging.port = htons(port);
1804             \hyperlink{ping_8c_a1b3882fdfddc79be369ff230cd3e7a6a}{send\_ping\_request}(dht->\hyperlink{struct_d_h_t_ae3f68e3d55e46726b05717fc88198321}{ping}, pinging, dht->
      \hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[friend\_num].\hyperlink{struct_d_h_t___friend_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key});
1805         \}
1806 
1807         dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[friend\_num].\hyperlink{struct_d_h_t___friend_a96318690475243d010825feb2a67b41c}{nat}.\hyperlink{struct_n_a_t_aeb4b0f7724adb0857b15e0f34e95ecca}{punching\_index} = 
      \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
1808     \}
1809 
1810     \textcolor{keywordflow}{if} (dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[friend\_num].\hyperlink{struct_d_h_t___friend_a96318690475243d010825feb2a67b41c}{nat}.\hyperlink{struct_n_a_t_a852b5b4a6ac0e351887ab6dde3e3fcc5}{tries} > 
      \hyperlink{_d_h_t_8c_a47f5811ec6dd12a1a14d7f44c717b5f1}{MAX\_NORMAL\_PUNCHING\_TRIES}) \{
1811         top = dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[friend\_num].\hyperlink{struct_d_h_t___friend_a96318690475243d010825feb2a67b41c}{nat}.\hyperlink{struct_n_a_t_a1d36817a78a0e261e7ca0982e17aa4ee}{punching\_index2} + 
      \hyperlink{_d_h_t_8c_aa26d44826e51b690cac89a8e81b53710}{MAX\_PUNCHING\_PORTS};
1812         uint16\_t port = 1024;
1813         \hyperlink{struct_i_p___port}{IP\_Port} pinging;
1814         \hyperlink{network_8c_a66563da83f68de4f5e9d7c5f2f72c8f3}{ip\_copy}(&pinging.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}, &ip);
1815 
1816         \textcolor{keywordflow}{for} (i = dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[friend\_num].\hyperlink{struct_d_h_t___friend_a96318690475243d010825feb2a67b41c}{nat}.
      \hyperlink{struct_n_a_t_a1d36817a78a0e261e7ca0982e17aa4ee}{punching\_index2}; i != top; ++i) \{
1817             pinging.\hyperlink{struct_i_p___port_a8e0798404bf2cf5dabb84c5ba9a4f236}{port} = htons(port + i);
1818             \hyperlink{ping_8c_a1b3882fdfddc79be369ff230cd3e7a6a}{send\_ping\_request}(dht->\hyperlink{struct_d_h_t_ae3f68e3d55e46726b05717fc88198321}{ping}, pinging, dht->
      \hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[friend\_num].\hyperlink{struct_d_h_t___friend_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key});
1819         \}
1820 
1821         dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[friend\_num].\hyperlink{struct_d_h_t___friend_a96318690475243d010825feb2a67b41c}{nat}.\hyperlink{struct_n_a_t_a1d36817a78a0e261e7ca0982e17aa4ee}{punching\_index2} = i - (
      \hyperlink{_d_h_t_8c_aa26d44826e51b690cac89a8e81b53710}{MAX\_PUNCHING\_PORTS} / 2);
1822     \}
1823 
1824     ++dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[friend\_num].\hyperlink{struct_d_h_t___friend_a96318690475243d010825feb2a67b41c}{nat}.\hyperlink{struct_n_a_t_a852b5b4a6ac0e351887ab6dde3e3fcc5}{tries};
1825 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a7efc873280e2d502bf49489d3ebacc9c_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a7efc873280e2d502bf49489d3ebacc9c_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_af89838d6c1c8e0ec82dfadbe2953e06d}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!random\+\_\+node@{random\+\_\+node}}
\index{random\+\_\+node@{random\+\_\+node}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{random\+\_\+node}]{\setlength{\rightskip}{0pt plus 5cm}{\bf Node\+\_\+format} random\+\_\+node (
\begin{DoxyParamCaption}
\item[{{\bf D\+H\+T} $\ast$}]{dht, }
\item[{sa\+\_\+family\+\_\+t}]{sa\+\_\+family}
\end{DoxyParamCaption}
)}}\label{_d_h_t_8c_af89838d6c1c8e0ec82dfadbe2953e06d}


Definition at line 2042 of file D\+H\+T.\+c.



References get\+\_\+close\+\_\+nodes(), i, and M\+A\+X\+\_\+\+S\+E\+N\+T\+\_\+\+N\+O\+D\+E\+S.



Referenced by do\+\_\+hardening().


\begin{DoxyCode}
2043 \{
2044     uint8\_t \textcolor{keywordtype}{id}[crypto\_box\_PUBLICKEYBYTES];
2045     uint32\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
2046 
2047     \textcolor{keywordflow}{for} (i = 0; i < crypto\_box\_PUBLICKEYBYTES / 4; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{ \textcolor{comment}{/* populate the id with pseudorandom bytes.*/}
2048         uint32\_t t = rand();
2049         memcpy(\textcolor{keywordtype}{id} + i * \textcolor{keyword}{sizeof}(t), &t, \textcolor{keyword}{sizeof}(t));
2050     \}
2051 
2052     \hyperlink{struct_node__format}{Node\_format} nodes\_list[\hyperlink{_d_h_t_8h_a57f4cf16e79a384d7d59a3cc585ea5a3}{MAX\_SENT\_NODES}];
2053     memset(nodes\_list, 0, \textcolor{keyword}{sizeof}(nodes\_list));
2054     uint32\_t num\_nodes = \hyperlink{_d_h_t_8c_a8abfc9cea3784b0cae354670bd4643cd}{get\_close\_nodes}(dht, \textcolor{keywordtype}{id}, nodes\_list, sa\_family, 1, 0);
2055 
2056     \textcolor{keywordflow}{if} (num\_nodes == 0)
2057         \textcolor{keywordflow}{return} nodes\_list[0];
2058     \textcolor{keywordflow}{else}
2059         \textcolor{keywordflow}{return} nodes\_list[rand() % num\_nodes];
2060 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_af89838d6c1c8e0ec82dfadbe2953e06d_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_af89838d6c1c8e0ec82dfadbe2953e06d_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_adfcc072141badf7d1cd04542b3dd26b1}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!replace\+\_\+all@{replace\+\_\+all}}
\index{replace\+\_\+all@{replace\+\_\+all}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{replace\+\_\+all}]{\setlength{\rightskip}{0pt plus 5cm}static int replace\+\_\+all (
\begin{DoxyParamCaption}
\item[{{\bf Client\+\_\+data} $\ast$}]{list, }
\item[{uint16\+\_\+t}]{length, }
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key, }
\item[{{\bf I\+P\+\_\+\+Port}}]{ip\+\_\+port, }
\item[{const uint8\+\_\+t $\ast$}]{comp\+\_\+public\+\_\+key}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_d_h_t_8c_adfcc072141badf7d1cd04542b3dd26b1}


Definition at line 700 of file D\+H\+T.\+c.



References Client\+\_\+data\+::assoc4, Client\+\_\+data\+::assoc6, cmp\+\_\+dht\+\_\+entry(), cmp\+\_\+public\+\_\+key, I\+P\+::family, id\+\_\+copy(), I\+P\+\_\+\+Port\+::ip, I\+P\+P\+Ts\+Png\+::ip\+\_\+port, ip\+\_\+reset(), I\+P\+\_\+\+Port\+::port, Client\+\_\+data\+::public\+\_\+key, I\+P\+P\+Ts\+Png\+::ret\+\_\+ip\+\_\+port, I\+P\+P\+Ts\+Png\+::ret\+\_\+timestamp, store\+\_\+node\+\_\+ok(), I\+P\+P\+Ts\+Png\+::timestamp, and unix\+\_\+time().



Referenced by addto\+\_\+lists().


\begin{DoxyCode}
705 \{
706     \textcolor{keywordflow}{if} ((ip\_port.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} != AF\_INET) && (ip\_port.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} != AF\_INET6))
707         \textcolor{keywordflow}{return} 0;
708 
709     memcpy(\hyperlink{_d_h_t_8c_a3551f15862efa7b58779722fe9763c45}{cmp\_public\_key}, comp\_public\_key, crypto\_box\_PUBLICKEYBYTES);
710     qsort(list, length, \textcolor{keyword}{sizeof}(\hyperlink{struct_client__data}{Client\_data}), \hyperlink{_d_h_t_8c_a15d71358ca3e1f937159a7982168bb30}{cmp\_dht\_entry});
711 
712     \hyperlink{struct_client__data}{Client\_data} *client = &list[0];
713 
714     \textcolor{keywordflow}{if} (\hyperlink{_d_h_t_8c_addb87a718c80bb27e53e8dde5972dfe9}{store\_node\_ok}(client, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, comp\_public\_key)) \{
715         \hyperlink{struct_i_p_p_ts_png}{IPPTsPng} *ipptp\_write = NULL;
716         \hyperlink{struct_i_p_p_ts_png}{IPPTsPng} *ipptp\_clear = NULL;
717 
718         \textcolor{keywordflow}{if} (ip\_port.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} == AF\_INET) \{
719             ipptp\_write = &client->\hyperlink{struct_client__data_ac9843379cbcd02bdfa5c180a1474a6c5}{assoc4};
720             ipptp\_clear = &client->\hyperlink{struct_client__data_a87d394929a2604f6f785fec949fac618}{assoc6};
721         \} \textcolor{keywordflow}{else} \{
722             ipptp\_write = &client->\hyperlink{struct_client__data_a87d394929a2604f6f785fec949fac618}{assoc6};
723             ipptp\_clear = &client->\hyperlink{struct_client__data_ac9843379cbcd02bdfa5c180a1474a6c5}{assoc4};
724         \}
725 
726         \hyperlink{util_8c_aa30049b8c1d82c280d6d872feea3353b}{id\_copy}(client->\hyperlink{struct_client__data_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key});
727         ipptp\_write->\hyperlink{struct_i_p_p_ts_png_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port} = ip\_port;
728         ipptp\_write->\hyperlink{struct_i_p_p_ts_png_a465bef81f6478756e5443025b1f2ddfa}{timestamp} = \hyperlink{util_8c_ac958d9f8847cb8039444bfa3d304233a}{unix\_time}();
729 
730         \hyperlink{network_8c_a2bfd1efbce5b035b10c879a7e85c08df}{ip\_reset}(&ipptp\_write->\hyperlink{struct_i_p_p_ts_png_a28f2dcc657352ee4855d05ed42e4a4af}{ret\_ip\_port}.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip});
731         ipptp\_write->\hyperlink{struct_i_p_p_ts_png_a28f2dcc657352ee4855d05ed42e4a4af}{ret\_ip\_port}.\hyperlink{struct_i_p___port_a8e0798404bf2cf5dabb84c5ba9a4f236}{port} = 0;
732         ipptp\_write->\hyperlink{struct_i_p_p_ts_png_a5a40b83400feebb632862f593ad5e4a7}{ret\_timestamp} = 0;
733 
734         \textcolor{comment}{/* zero out other address */}
735         memset(ipptp\_clear, 0, \textcolor{keyword}{sizeof}(*ipptp\_clear));
736 
737         \textcolor{keywordflow}{return} 1;
738     \}
739 
740     \textcolor{keywordflow}{return} 0;
741 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_adfcc072141badf7d1cd04542b3dd26b1_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_adfcc072141badf7d1cd04542b3dd26b1_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_a8c25b3f909399fff843f905f2ad9615f}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!returnedip\+\_\+ports@{returnedip\+\_\+ports}}
\index{returnedip\+\_\+ports@{returnedip\+\_\+ports}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{returnedip\+\_\+ports}]{\setlength{\rightskip}{0pt plus 5cm}static int returnedip\+\_\+ports (
\begin{DoxyParamCaption}
\item[{{\bf D\+H\+T} $\ast$}]{dht, }
\item[{{\bf I\+P\+\_\+\+Port}}]{ip\+\_\+port, }
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key, }
\item[{const uint8\+\_\+t $\ast$}]{nodepublic\+\_\+key}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_d_h_t_8c_a8c25b3f909399fff843f905f2ad9615f}


Definition at line 845 of file D\+H\+T.\+c.



References Client\+\_\+data\+::assoc4, Client\+\_\+data\+::assoc6, Assoc\+\_\+add\+\_\+entry(), D\+H\+T\+\_\+\+Friend\+::client\+\_\+list, D\+H\+T\+::close\+\_\+clientlist, end, I\+P\+::family, D\+H\+T\+::friends\+\_\+list, i, id\+\_\+equal(), I\+P\+\_\+\+Port\+::ip, I\+P\+::ip4, I\+P\+::ip6, I\+P\+P\+Ts\+::ip\+\_\+port, I\+P\+V6\+\_\+\+I\+P\+V4\+\_\+\+I\+N\+\_\+\+V6, L\+C\+L\+I\+E\+N\+T\+\_\+\+L\+I\+S\+T, M\+A\+X\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+C\+L\+I\+E\+N\+T\+S, D\+H\+T\+::num\+\_\+friends, Client\+\_\+data\+::public\+\_\+key, D\+H\+T\+\_\+\+Friend\+::public\+\_\+key, I\+P\+P\+Ts\+Png\+::ret\+\_\+ip\+\_\+port, I\+P\+P\+Ts\+Png\+::ret\+\_\+timestamp, D\+H\+T\+::self\+\_\+public\+\_\+key, I\+P\+P\+Ts\+::timestamp, I\+P4\+::uint32, I\+P6\+::uint32, and unix\+\_\+time().



Referenced by handle\+\_\+sendnodes\+\_\+ipv6().


\begin{DoxyCode}
846 \{
847     uint32\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}, j;
848     uint64\_t temp\_time = \hyperlink{util_8c_ac958d9f8847cb8039444bfa3d304233a}{unix\_time}();
849 
850     uint32\_t used = 0;
851 
852     \textcolor{comment}{/* convert IPv4-in-IPv6 to IPv4 */}
853     \textcolor{keywordflow}{if} ((ip\_port.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} == AF\_INET6) && \hyperlink{network_8h_aaaf5ca9c91edc4f8a7529206d7799805}{IPV6\_IPV4\_IN\_V6}(ip\_port.
      \hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_a14c606eb5ffb078c38ad854dc4e79507}{ip6})) \{
854         ip\_port.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} = AF\_INET;
855         ip\_port.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_aca19646000f55aa927406e68fc41ecf9}{ip4}.\hyperlink{union_i_p4_a5ad776be1fb768f3399aafcd1b58b3a2}{uint32} = ip\_port.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_a14c606eb5ffb078c38ad854dc4e79507}{ip6}.\hyperlink{union_i_p6_a1d8ab1f6c1da5565bed41e7095610dea}{uint32}[3];
856     \}
857 
858     \textcolor{keywordflow}{if} (\hyperlink{util_8c_ada3d44b4f530d3c8c9cb69b732be94b1}{id\_equal}(\hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, dht->\hyperlink{struct_d_h_t_ae726df8bdc26380e5a6c3187a00d6881}{self\_public\_key})) \{
859         \textcolor{keywordflow}{for} (i = 0; i < \hyperlink{_d_h_t_8h_a3058f857a8316099e20c95fb07adc7c1}{LCLIENT\_LIST}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
860             \textcolor{keywordflow}{if} (\hyperlink{util_8c_ada3d44b4f530d3c8c9cb69b732be94b1}{id\_equal}(nodepublic\_key, dht->\hyperlink{struct_d_h_t_a00ef35d5b0e7a791ef08a30b3bacbf9d}{close\_clientlist}[i].
      \hyperlink{struct_client__data_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key})) \{
861                 \textcolor{keywordflow}{if} (ip\_port.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} == AF\_INET) \{
862                     dht->\hyperlink{struct_d_h_t_a00ef35d5b0e7a791ef08a30b3bacbf9d}{close\_clientlist}[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}].\hyperlink{struct_client__data_ac9843379cbcd02bdfa5c180a1474a6c5}{assoc4}.
      \hyperlink{struct_i_p_p_ts_png_a28f2dcc657352ee4855d05ed42e4a4af}{ret\_ip\_port} = ip\_port;
863                     dht->\hyperlink{struct_d_h_t_a00ef35d5b0e7a791ef08a30b3bacbf9d}{close\_clientlist}[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}].\hyperlink{struct_client__data_ac9843379cbcd02bdfa5c180a1474a6c5}{assoc4}.
      \hyperlink{struct_i_p_p_ts_png_a5a40b83400feebb632862f593ad5e4a7}{ret\_timestamp} = temp\_time;
864                 \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (ip\_port.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} == AF\_INET6) \{
865                     dht->\hyperlink{struct_d_h_t_a00ef35d5b0e7a791ef08a30b3bacbf9d}{close\_clientlist}[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}].\hyperlink{struct_client__data_a87d394929a2604f6f785fec949fac618}{assoc6}.
      \hyperlink{struct_i_p_p_ts_png_a28f2dcc657352ee4855d05ed42e4a4af}{ret\_ip\_port} = ip\_port;
866                     dht->\hyperlink{struct_d_h_t_a00ef35d5b0e7a791ef08a30b3bacbf9d}{close\_clientlist}[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}].\hyperlink{struct_client__data_a87d394929a2604f6f785fec949fac618}{assoc6}.
      \hyperlink{struct_i_p_p_ts_png_a5a40b83400feebb632862f593ad5e4a7}{ret\_timestamp} = temp\_time;
867                 \}
868 
869                 ++used;
870                 \textcolor{keywordflow}{break};
871             \}
872         \}
873     \} \textcolor{keywordflow}{else} \{
874         \textcolor{keywordflow}{for} (i = 0; i < dht->\hyperlink{struct_d_h_t_a8ee1f2d7e543bce350c591a8eaac0cf8}{num\_friends}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
875             \textcolor{keywordflow}{if} (\hyperlink{util_8c_ada3d44b4f530d3c8c9cb69b732be94b1}{id\_equal}(\hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[i].
      \hyperlink{struct_d_h_t___friend_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key})) \{
876                 \textcolor{keywordflow}{for} (j = 0; j < \hyperlink{_d_h_t_8h_ad50d158518277ca4d19cbe364f3e958c}{MAX\_FRIEND\_CLIENTS}; ++j) \{
877                     \textcolor{keywordflow}{if} (\hyperlink{util_8c_ada3d44b4f530d3c8c9cb69b732be94b1}{id\_equal}(nodepublic\_key, dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[i].
      \hyperlink{struct_d_h_t___friend_a49ef2b640a834a77b6e123355a4fea47}{client\_list}[j].\hyperlink{struct_client__data_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key})) \{
878                         \textcolor{keywordflow}{if} (ip\_port.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} == AF\_INET) \{
879                             dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}].\hyperlink{struct_d_h_t___friend_a49ef2b640a834a77b6e123355a4fea47}{client\_list}[j].
      \hyperlink{struct_client__data_ac9843379cbcd02bdfa5c180a1474a6c5}{assoc4}.\hyperlink{struct_i_p_p_ts_png_a28f2dcc657352ee4855d05ed42e4a4af}{ret\_ip\_port} = ip\_port;
880                             dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}].\hyperlink{struct_d_h_t___friend_a49ef2b640a834a77b6e123355a4fea47}{client\_list}[j].
      \hyperlink{struct_client__data_ac9843379cbcd02bdfa5c180a1474a6c5}{assoc4}.\hyperlink{struct_i_p_p_ts_png_a5a40b83400feebb632862f593ad5e4a7}{ret\_timestamp} = temp\_time;
881                         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (ip\_port.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} == AF\_INET6) \{
882                             dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}].\hyperlink{struct_d_h_t___friend_a49ef2b640a834a77b6e123355a4fea47}{client\_list}[j].
      \hyperlink{struct_client__data_a87d394929a2604f6f785fec949fac618}{assoc6}.\hyperlink{struct_i_p_p_ts_png_a28f2dcc657352ee4855d05ed42e4a4af}{ret\_ip\_port} = ip\_port;
883                             dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}].\hyperlink{struct_d_h_t___friend_a49ef2b640a834a77b6e123355a4fea47}{client\_list}[j].
      \hyperlink{struct_client__data_a87d394929a2604f6f785fec949fac618}{assoc6}.\hyperlink{struct_i_p_p_ts_png_a5a40b83400feebb632862f593ad5e4a7}{ret\_timestamp} = temp\_time;
884                         \}
885 
886                         ++used;
887                         \textcolor{keywordflow}{goto} \hyperlink{msi_8c_ae511d1f1e345bb77cd4120b39679f028a80b1a820e533d7cf0e1715319339e6d0}{end};
888                     \}
889                 \}
890             \}
891         \}
892     \}
893 
894 \hyperlink{msi_8c_ae511d1f1e345bb77cd4120b39679f028a80b1a820e533d7cf0e1715319339e6d0}{end}:
895 \textcolor{preprocessor}{#ifdef ENABLE\_ASSOC\_DHT}
896 
897     \textcolor{keywordflow}{if} (dht->assoc) \{
898         \hyperlink{struct_i_p_p_ts}{IPPTs} ippts;
899         ippts.\hyperlink{struct_i_p_p_ts_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port} = ip\_port;
900         ippts.\hyperlink{struct_i_p_p_ts_a465bef81f6478756e5443025b1f2ddfa}{timestamp} = temp\_time;
901         \textcolor{comment}{/* this is only a hear-say entry, so ret-ipp is NULL, but used is required}
902 \textcolor{comment}{         * to decide how valuable it is ("used" may throw an "unused" entry out) */}
903         \hyperlink{assoc_8c_aa0230ae0304fd8540a5bce578d242f30}{Assoc\_add\_entry}(dht->assoc, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, &ippts, NULL, used ? 1 : 0);
904     \}
905 
906 \textcolor{preprocessor}{#endif}
907     \textcolor{keywordflow}{return} 0;
908 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a8c25b3f909399fff843f905f2ad9615f_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a8c25b3f909399fff843f905f2ad9615f_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_a91072d384a61a04ac1e4d679dc7efb3a}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!route\+\_\+packet@{route\+\_\+packet}}
\index{route\+\_\+packet@{route\+\_\+packet}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{route\+\_\+packet}]{\setlength{\rightskip}{0pt plus 5cm}int route\+\_\+packet (
\begin{DoxyParamCaption}
\item[{const {\bf D\+H\+T} $\ast$}]{dht, }
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key, }
\item[{const uint8\+\_\+t $\ast$}]{packet, }
\item[{uint16\+\_\+t}]{length}
\end{DoxyParamCaption}
)}}\label{_d_h_t_8c_a91072d384a61a04ac1e4d679dc7efb3a}


Definition at line 1467 of file D\+H\+T.\+c.



References Client\+\_\+data\+::assoc4, Client\+\_\+data\+::assoc6, D\+H\+T\+::close\+\_\+clientlist, i, id\+\_\+equal(), I\+P\+\_\+\+Port\+::ip, ip\+\_\+isset(), I\+P\+P\+Ts\+Png\+::ip\+\_\+port, L\+C\+L\+I\+E\+N\+T\+\_\+\+L\+I\+S\+T, D\+H\+T\+::net, Client\+\_\+data\+::public\+\_\+key, and sendpacket().



Referenced by cryptopacket\+\_\+handle().


\begin{DoxyCode}
1468 \{
1469     uint32\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
1470 
1471     \textcolor{keywordflow}{for} (i = 0; i < \hyperlink{_d_h_t_8h_a3058f857a8316099e20c95fb07adc7c1}{LCLIENT\_LIST}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
1472         \textcolor{keywordflow}{if} (\hyperlink{util_8c_ada3d44b4f530d3c8c9cb69b732be94b1}{id\_equal}(\hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, dht->\hyperlink{struct_d_h_t_a00ef35d5b0e7a791ef08a30b3bacbf9d}{close\_clientlist}[i].
      \hyperlink{struct_client__data_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key})) \{
1473             \textcolor{keyword}{const} \hyperlink{struct_client__data}{Client\_data} *client = &dht->\hyperlink{struct_d_h_t_a00ef35d5b0e7a791ef08a30b3bacbf9d}{close\_clientlist}[
      \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}];
1474 
1475             \textcolor{keywordflow}{if} (\hyperlink{network_8c_ac56c677f4bc8bf8311370ee105ae7cbb}{ip\_isset}(&client->\hyperlink{struct_client__data_a87d394929a2604f6f785fec949fac618}{assoc6}.\hyperlink{struct_i_p_p_ts_png_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}))
1476                 \textcolor{keywordflow}{return} \hyperlink{network_8c_a7b90f87f3ba60cc5c66dd6dd77cd5cb1}{sendpacket}(dht->\hyperlink{struct_d_h_t_aa14ea2f67950f57fe4235d7375a2216c}{net}, client->\hyperlink{struct_client__data_a87d394929a2604f6f785fec949fac618}{assoc6}.
      \hyperlink{struct_i_p_p_ts_png_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}, packet, length);
1477             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{network_8c_ac56c677f4bc8bf8311370ee105ae7cbb}{ip\_isset}(&client->\hyperlink{struct_client__data_ac9843379cbcd02bdfa5c180a1474a6c5}{assoc4}.\hyperlink{struct_i_p_p_ts_png_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}))
1478                 \textcolor{keywordflow}{return} \hyperlink{network_8c_a7b90f87f3ba60cc5c66dd6dd77cd5cb1}{sendpacket}(dht->\hyperlink{struct_d_h_t_aa14ea2f67950f57fe4235d7375a2216c}{net}, client->\hyperlink{struct_client__data_ac9843379cbcd02bdfa5c180a1474a6c5}{assoc4}.
      \hyperlink{struct_i_p_p_ts_png_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}, packet, length);
1479             \textcolor{keywordflow}{else}
1480                 \textcolor{keywordflow}{break};
1481         \}
1482     \}
1483 
1484     \textcolor{keywordflow}{return} -1;
1485 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=256pt]{dc/dc1/_d_h_t_8c_a91072d384a61a04ac1e4d679dc7efb3a_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a91072d384a61a04ac1e4d679dc7efb3a_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_aee23d763e291eefd141227cd9e3684ab}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!route\+\_\+tofriend@{route\+\_\+tofriend}}
\index{route\+\_\+tofriend@{route\+\_\+tofriend}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{route\+\_\+tofriend}]{\setlength{\rightskip}{0pt plus 5cm}int route\+\_\+tofriend (
\begin{DoxyParamCaption}
\item[{const {\bf D\+H\+T} $\ast$}]{dht, }
\item[{const uint8\+\_\+t $\ast$}]{friend\+\_\+id, }
\item[{const uint8\+\_\+t $\ast$}]{packet, }
\item[{uint16\+\_\+t}]{length}
\end{DoxyParamCaption}
)}}\label{_d_h_t_8c_aee23d763e291eefd141227cd9e3684ab}


Definition at line 1562 of file D\+H\+T.\+c.



References Client\+\_\+data\+::assoc4, Client\+\_\+data\+::assoc6, B\+A\+D\+\_\+\+N\+O\+D\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T, friend\+\_\+iplist(), friend\+\_\+number(), D\+H\+T\+::friends\+\_\+list, i, I\+P\+\_\+\+Port\+::ip, ip\+\_\+isset(), I\+P\+P\+Ts\+Png\+::ip\+\_\+port, is\+\_\+timeout(), M\+A\+X\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+C\+L\+I\+E\+N\+T\+S, D\+H\+T\+::net, num, I\+P\+P\+Ts\+Png\+::ret\+\_\+ip\+\_\+port, I\+P\+P\+Ts\+Png\+::ret\+\_\+timestamp, and sendpacket().



Referenced by send\+\_\+dht\+\_\+dhtpk(), and send\+\_\+\+N\+A\+Tping().


\begin{DoxyCode}
1563 \{
1564     \textcolor{keywordtype}{int} \hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num} = \hyperlink{_d_h_t_8c_a6cbd0f66d63003cc0def913dc7a4254b}{friend\_number}(dht, \hyperlink{messenger__test_8c_a5d7925718457bca84bda0952f9463a3c}{friend\_id});
1565 
1566     \textcolor{keywordflow}{if} (num == -1)
1567         \textcolor{keywordflow}{return} 0;
1568 
1569     uint32\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}, sent = 0;
1570     uint8\_t friend\_sent[\hyperlink{_d_h_t_8h_ad50d158518277ca4d19cbe364f3e958c}{MAX\_FRIEND\_CLIENTS}] = \{0\};
1571 
1572     \hyperlink{struct_i_p___port}{IP\_Port} ip\_list[\hyperlink{_d_h_t_8h_ad50d158518277ca4d19cbe364f3e958c}{MAX\_FRIEND\_CLIENTS}];
1573     \textcolor{keywordtype}{int} ip\_num = \hyperlink{_d_h_t_8c_a1b3c1814260eace443e6feb13227cc82}{friend\_iplist}(dht, ip\_list, num);
1574 
1575     \textcolor{keywordflow}{if} (ip\_num < (\hyperlink{_d_h_t_8h_ad50d158518277ca4d19cbe364f3e958c}{MAX\_FRIEND\_CLIENTS} / 4))
1576         \textcolor{keywordflow}{return} 0; \textcolor{comment}{/* Reason for that? */}
1577 
1578     \hyperlink{struct_d_h_t___friend}{DHT\_Friend} *\textcolor{keyword}{friend} = &dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num}];
1579     \hyperlink{struct_client__data}{Client\_data} *client;
1580 
1581     \textcolor{comment}{/* extra legwork, because having the outside allocating the space for us}
1582 \textcolor{comment}{     * is *usually* good(tm) (bites us in the behind in this case though) */}
1583     uint32\_t a;
1584 
1585     \textcolor{keywordflow}{for} (a = 0; a < 2; a++)
1586         \textcolor{keywordflow}{for} (i = 0; i < \hyperlink{_d_h_t_8h_ad50d158518277ca4d19cbe364f3e958c}{MAX\_FRIEND\_CLIENTS}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
1587             \textcolor{keywordflow}{if} (friend\_sent[i])\textcolor{comment}{/* Send one packet per client.*/}
1588                 \textcolor{keywordflow}{continue};
1589 
1590             client = &\textcolor{keyword}{friend}->client\_list[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}];
1591             \hyperlink{struct_i_p_p_ts_png}{IPPTsPng} *assoc = NULL;
1592 
1593             \textcolor{keywordflow}{if} (!a)
1594                 assoc = &client->\hyperlink{struct_client__data_ac9843379cbcd02bdfa5c180a1474a6c5}{assoc4};
1595             \textcolor{keywordflow}{else}
1596                 assoc = &client->\hyperlink{struct_client__data_a87d394929a2604f6f785fec949fac618}{assoc6};
1597 
1598             \textcolor{comment}{/* If ip is not zero and node is good. */}
1599             \textcolor{keywordflow}{if} (\hyperlink{network_8c_ac56c677f4bc8bf8311370ee105ae7cbb}{ip\_isset}(&assoc->\hyperlink{struct_i_p_p_ts_png_a28f2dcc657352ee4855d05ed42e4a4af}{ret\_ip\_port}.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}) &&
1600                     !\hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(assoc->\hyperlink{struct_i_p_p_ts_png_a5a40b83400feebb632862f593ad5e4a7}{ret\_timestamp}, 
      \hyperlink{_d_h_t_8h_a2c542fd03a43f340d1fb281afe54453f}{BAD\_NODE\_TIMEOUT})) \{
1601                 \textcolor{keywordtype}{int} retval = \hyperlink{network_8c_a7b90f87f3ba60cc5c66dd6dd77cd5cb1}{sendpacket}(dht->\hyperlink{struct_d_h_t_aa14ea2f67950f57fe4235d7375a2216c}{net}, assoc->\hyperlink{struct_i_p_p_ts_png_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}, packet, length);
1602 
1603                 \textcolor{keywordflow}{if} ((\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int})retval == length) \{
1604                     ++sent;
1605                     friend\_sent[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}] = 1;
1606                 \}
1607             \}
1608         \}
1609 
1610     \textcolor{keywordflow}{return} sent;
1611 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_aee23d763e291eefd141227cd9e3684ab_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_aee23d763e291eefd141227cd9e3684ab_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_ad1a9a37b7cda1411149867eb77070bd1}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!routeone\+\_\+tofriend@{routeone\+\_\+tofriend}}
\index{routeone\+\_\+tofriend@{routeone\+\_\+tofriend}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{routeone\+\_\+tofriend}]{\setlength{\rightskip}{0pt plus 5cm}static int routeone\+\_\+tofriend (
\begin{DoxyParamCaption}
\item[{{\bf D\+H\+T} $\ast$}]{dht, }
\item[{const uint8\+\_\+t $\ast$}]{friend\+\_\+id, }
\item[{const uint8\+\_\+t $\ast$}]{packet, }
\item[{uint16\+\_\+t}]{length}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_d_h_t_8c_ad1a9a37b7cda1411149867eb77070bd1}


Definition at line 1617 of file D\+H\+T.\+c.



References Client\+\_\+data\+::assoc4, Client\+\_\+data\+::assoc6, B\+A\+D\+\_\+\+N\+O\+D\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T, friend\+\_\+number(), D\+H\+T\+::friends\+\_\+list, i, I\+P\+\_\+\+Port\+::ip, ip\+\_\+isset(), I\+P\+P\+Ts\+Png\+::ip\+\_\+port, is\+\_\+timeout(), M\+A\+X\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+C\+L\+I\+E\+N\+T\+S, D\+H\+T\+::net, num, I\+P\+P\+Ts\+Png\+::ret\+\_\+ip\+\_\+port, I\+P\+P\+Ts\+Png\+::ret\+\_\+timestamp, and sendpacket().



Referenced by send\+\_\+\+N\+A\+Tping().


\begin{DoxyCode}
1618 \{
1619     \textcolor{keywordtype}{int} \hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num} = \hyperlink{_d_h_t_8c_a6cbd0f66d63003cc0def913dc7a4254b}{friend\_number}(dht, \hyperlink{messenger__test_8c_a5d7925718457bca84bda0952f9463a3c}{friend\_id});
1620 
1621     \textcolor{keywordflow}{if} (num == -1)
1622         \textcolor{keywordflow}{return} 0;
1623 
1624     \hyperlink{struct_d_h_t___friend}{DHT\_Friend} *\textcolor{keyword}{friend} = &dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num}];
1625     \hyperlink{struct_client__data}{Client\_data} *client;
1626 
1627     \hyperlink{struct_i_p___port}{IP\_Port} ip\_list[\hyperlink{_d_h_t_8h_ad50d158518277ca4d19cbe364f3e958c}{MAX\_FRIEND\_CLIENTS} * 2];
1628     \textcolor{keywordtype}{int} n = 0;
1629     uint32\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
1630 
1631     \textcolor{comment}{/* extra legwork, because having the outside allocating the space for us}
1632 \textcolor{comment}{     * is *usually* good(tm) (bites us in the behind in this case though) */}
1633     uint32\_t a;
1634 
1635     \textcolor{keywordflow}{for} (a = 0; a < 2; a++)
1636         \textcolor{keywordflow}{for} (i = 0; i < \hyperlink{_d_h_t_8h_ad50d158518277ca4d19cbe364f3e958c}{MAX\_FRIEND\_CLIENTS}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
1637             client = &\textcolor{keyword}{friend}->client\_list[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}];
1638             \hyperlink{struct_i_p_p_ts_png}{IPPTsPng} *assoc = NULL;
1639 
1640             \textcolor{keywordflow}{if} (!a)
1641                 assoc = &client->\hyperlink{struct_client__data_ac9843379cbcd02bdfa5c180a1474a6c5}{assoc4};
1642             \textcolor{keywordflow}{else}
1643                 assoc = &client->\hyperlink{struct_client__data_a87d394929a2604f6f785fec949fac618}{assoc6};
1644 
1645             \textcolor{comment}{/* If ip is not zero and node is good. */}
1646             \textcolor{keywordflow}{if} (\hyperlink{network_8c_ac56c677f4bc8bf8311370ee105ae7cbb}{ip\_isset}(&assoc->\hyperlink{struct_i_p_p_ts_png_a28f2dcc657352ee4855d05ed42e4a4af}{ret\_ip\_port}.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}) && !
      \hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(assoc->\hyperlink{struct_i_p_p_ts_png_a5a40b83400feebb632862f593ad5e4a7}{ret\_timestamp}, \hyperlink{_d_h_t_8h_a2c542fd03a43f340d1fb281afe54453f}{BAD\_NODE\_TIMEOUT})) \{
1647                 ip\_list[n] = assoc->\hyperlink{struct_i_p_p_ts_png_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port};
1648                 ++n;
1649             \}
1650         \}
1651 
1652     \textcolor{keywordflow}{if} (n < 1)
1653         \textcolor{keywordflow}{return} 0;
1654 
1655     \textcolor{keywordtype}{int} retval = \hyperlink{network_8c_a7b90f87f3ba60cc5c66dd6dd77cd5cb1}{sendpacket}(dht->\hyperlink{struct_d_h_t_aa14ea2f67950f57fe4235d7375a2216c}{net}, ip\_list[rand() % n], packet, length);
1656 
1657     \textcolor{keywordflow}{if} ((\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int})retval == length)
1658         \textcolor{keywordflow}{return} 1;
1659 
1660     \textcolor{keywordflow}{return} 0;
1661 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_ad1a9a37b7cda1411149867eb77070bd1_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_ad1a9a37b7cda1411149867eb77070bd1_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_a3322fa3865c8dbbcd21b1a9a4955c193}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!send\+\_\+hardening\+\_\+getnode\+\_\+req@{send\+\_\+hardening\+\_\+getnode\+\_\+req}}
\index{send\+\_\+hardening\+\_\+getnode\+\_\+req@{send\+\_\+hardening\+\_\+getnode\+\_\+req}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{send\+\_\+hardening\+\_\+getnode\+\_\+req}]{\setlength{\rightskip}{0pt plus 5cm}static int send\+\_\+hardening\+\_\+getnode\+\_\+req (
\begin{DoxyParamCaption}
\item[{{\bf D\+H\+T} $\ast$}]{dht, }
\item[{{\bf Node\+\_\+format} $\ast$}]{dest, }
\item[{{\bf Node\+\_\+format} $\ast$}]{node\+\_\+totest, }
\item[{uint8\+\_\+t $\ast$}]{search\+\_\+id}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_d_h_t_8c_a3322fa3865c8dbbcd21b1a9a4955c193}


Definition at line 1895 of file D\+H\+T.\+c.



References C\+H\+E\+C\+K\+\_\+\+T\+Y\+P\+E\+\_\+\+G\+E\+T\+N\+O\+D\+E\+\_\+\+R\+E\+Q, make-\/funny-\/savefile\+::data, and send\+\_\+hardening\+\_\+req().



Referenced by do\+\_\+hardening().


\begin{DoxyCode}
1896 \{
1897     uint8\_t \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[\textcolor{keyword}{sizeof}(\hyperlink{struct_node__format}{Node\_format}) + crypto\_box\_PUBLICKEYBYTES];
1898     memcpy(\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}, node\_totest, \textcolor{keyword}{sizeof}(\hyperlink{struct_node__format}{Node\_format}));
1899     memcpy(\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} + \textcolor{keyword}{sizeof}(\hyperlink{struct_node__format}{Node\_format}), search\_id, crypto\_box\_PUBLICKEYBYTES);
1900     \textcolor{keywordflow}{return} \hyperlink{_d_h_t_8c_a6461cdeec360ffa10fa03beb6af29aaf}{send\_hardening\_req}(dht, dest, 
      \hyperlink{_d_h_t_8c_ac582451ce11946977a1feec8591f7aa1}{CHECK\_TYPE\_GETNODE\_REQ}, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}, \textcolor{keyword}{sizeof}(\hyperlink{struct_node__format}{Node\_format}) + 
      crypto\_box\_PUBLICKEYBYTES);
1901 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a3322fa3865c8dbbcd21b1a9a4955c193_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a3322fa3865c8dbbcd21b1a9a4955c193_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_ac35510e6bf4c6cfa950de4da3f4d8718}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!send\+\_\+hardening\+\_\+getnode\+\_\+res@{send\+\_\+hardening\+\_\+getnode\+\_\+res}}
\index{send\+\_\+hardening\+\_\+getnode\+\_\+res@{send\+\_\+hardening\+\_\+getnode\+\_\+res}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{send\+\_\+hardening\+\_\+getnode\+\_\+res}]{\setlength{\rightskip}{0pt plus 5cm}static int send\+\_\+hardening\+\_\+getnode\+\_\+res (
\begin{DoxyParamCaption}
\item[{const {\bf D\+H\+T} $\ast$}]{dht, }
\item[{const {\bf Node\+\_\+format} $\ast$}]{sendto, }
\item[{const uint8\+\_\+t $\ast$}]{queried\+\_\+client\+\_\+id, }
\item[{const uint8\+\_\+t $\ast$}]{nodes\+\_\+data, }
\item[{uint16\+\_\+t}]{nodes\+\_\+data\+\_\+length}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_d_h_t_8c_ac35510e6bf4c6cfa950de4da3f4d8718}


Definition at line 1904 of file D\+H\+T.\+c.



References C\+H\+E\+C\+K\+\_\+\+T\+Y\+P\+E\+\_\+\+G\+E\+T\+N\+O\+D\+E\+\_\+\+R\+E\+S, create\+\_\+request(), C\+R\+Y\+P\+T\+O\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+H\+A\+R\+D\+E\+N\+I\+N\+G, make-\/funny-\/savefile\+::data, I\+P\+\_\+\+Port\+::ip, ip\+\_\+isset(), Node\+\_\+format\+::ip\+\_\+port, M\+A\+X\+\_\+\+C\+R\+Y\+P\+T\+O\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+S\+I\+Z\+E, D\+H\+T\+::net, Node\+\_\+format\+::public\+\_\+key, D\+H\+T\+::self\+\_\+public\+\_\+key, D\+H\+T\+::self\+\_\+secret\+\_\+key, and sendpacket().



Referenced by handle\+\_\+sendnodes\+\_\+core().


\begin{DoxyCode}
1906 \{
1907     \textcolor{keywordflow}{if} (!\hyperlink{network_8c_ac56c677f4bc8bf8311370ee105ae7cbb}{ip\_isset}(&sendto->\hyperlink{struct_node__format_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}))
1908         \textcolor{keywordflow}{return} -1;
1909 
1910     uint8\_t packet[\hyperlink{crypto__core_8h_a2c79bc4b1111d42efd5fa7600398afcc}{MAX\_CRYPTO\_REQUEST\_SIZE}];
1911     uint8\_t \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[1 + crypto\_box\_PUBLICKEYBYTES + nodes\_data\_length];
1912     data[0] = \hyperlink{_d_h_t_8c_a4388a18c5f38b8aa28e413a6762a6444}{CHECK\_TYPE\_GETNODE\_RES};
1913     memcpy(data + 1, queried\_client\_id, crypto\_box\_PUBLICKEYBYTES);
1914     memcpy(data + 1 + crypto\_box\_PUBLICKEYBYTES, nodes\_data, nodes\_data\_length);
1915     \textcolor{keywordtype}{int} len = \hyperlink{crypto__core_8c_a73129647dfd9e436ae6abc908daa4c21}{create\_request}(dht->\hyperlink{struct_d_h_t_ae726df8bdc26380e5a6c3187a00d6881}{self\_public\_key}, dht->
      \hyperlink{struct_d_h_t_aa05050f86513ff53fe9da81f73c72267}{self\_secret\_key}, packet, sendto->\hyperlink{struct_node__format_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, data,
1916                              \textcolor{keyword}{sizeof}(data), \hyperlink{crypto__core_8h_a703b04f256fec46afbcc98b86c86d5a7}{CRYPTO\_PACKET\_HARDENING});
1917 
1918     \textcolor{keywordflow}{if} (len == -1)
1919         \textcolor{keywordflow}{return} -1;
1920 
1921     \textcolor{keywordflow}{return} \hyperlink{network_8c_a7b90f87f3ba60cc5c66dd6dd77cd5cb1}{sendpacket}(dht->\hyperlink{struct_d_h_t_aa14ea2f67950f57fe4235d7375a2216c}{net}, sendto->\hyperlink{struct_node__format_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}, packet, len);
1922 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_ac35510e6bf4c6cfa950de4da3f4d8718_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_ac35510e6bf4c6cfa950de4da3f4d8718_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_a6461cdeec360ffa10fa03beb6af29aaf}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!send\+\_\+hardening\+\_\+req@{send\+\_\+hardening\+\_\+req}}
\index{send\+\_\+hardening\+\_\+req@{send\+\_\+hardening\+\_\+req}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{send\+\_\+hardening\+\_\+req}]{\setlength{\rightskip}{0pt plus 5cm}static int send\+\_\+hardening\+\_\+req (
\begin{DoxyParamCaption}
\item[{{\bf D\+H\+T} $\ast$}]{dht, }
\item[{{\bf Node\+\_\+format} $\ast$}]{sendto, }
\item[{uint8\+\_\+t}]{type, }
\item[{uint8\+\_\+t $\ast$}]{contents, }
\item[{uint16\+\_\+t}]{length}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_d_h_t_8c_a6461cdeec360ffa10fa03beb6af29aaf}


Definition at line 1876 of file D\+H\+T.\+c.



References create\+\_\+request(), C\+R\+Y\+P\+T\+O\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+H\+A\+R\+D\+E\+N\+I\+N\+G, make-\/funny-\/savefile\+::data, H\+A\+R\+D\+R\+E\+Q\+\_\+\+D\+A\+T\+A\+\_\+\+S\+I\+Z\+E, Node\+\_\+format\+::ip\+\_\+port, M\+A\+X\+\_\+\+C\+R\+Y\+P\+T\+O\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+S\+I\+Z\+E, D\+H\+T\+::net, Node\+\_\+format\+::public\+\_\+key, D\+H\+T\+::self\+\_\+public\+\_\+key, D\+H\+T\+::self\+\_\+secret\+\_\+key, and sendpacket().



Referenced by send\+\_\+hardening\+\_\+getnode\+\_\+req().


\begin{DoxyCode}
1877 \{
1878     \textcolor{keywordflow}{if} (length > \hyperlink{_d_h_t_8c_a207dfa01a1f5f59c613d2202843bef3c}{HARDREQ\_DATA\_SIZE} - 1)
1879         \textcolor{keywordflow}{return} -1;
1880 
1881     uint8\_t packet[\hyperlink{crypto__core_8h_a2c79bc4b1111d42efd5fa7600398afcc}{MAX\_CRYPTO\_REQUEST\_SIZE}];
1882     uint8\_t \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[\hyperlink{_d_h_t_8c_a207dfa01a1f5f59c613d2202843bef3c}{HARDREQ\_DATA\_SIZE}] = \{0\};
1883     data[0] = type;
1884     memcpy(data + 1, contents, length);
1885     \textcolor{keywordtype}{int} len = \hyperlink{crypto__core_8c_a73129647dfd9e436ae6abc908daa4c21}{create\_request}(dht->\hyperlink{struct_d_h_t_ae726df8bdc26380e5a6c3187a00d6881}{self\_public\_key}, dht->
      \hyperlink{struct_d_h_t_aa05050f86513ff53fe9da81f73c72267}{self\_secret\_key}, packet, sendto->\hyperlink{struct_node__format_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, data,
1886                              \textcolor{keyword}{sizeof}(data), \hyperlink{crypto__core_8h_a703b04f256fec46afbcc98b86c86d5a7}{CRYPTO\_PACKET\_HARDENING});
1887 
1888     \textcolor{keywordflow}{if} (len == -1)
1889         \textcolor{keywordflow}{return} -1;
1890 
1891     \textcolor{keywordflow}{return} \hyperlink{network_8c_a7b90f87f3ba60cc5c66dd6dd77cd5cb1}{sendpacket}(dht->\hyperlink{struct_d_h_t_aa14ea2f67950f57fe4235d7375a2216c}{net}, sendto->\hyperlink{struct_node__format_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}, packet, len);
1892 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a6461cdeec360ffa10fa03beb6af29aaf_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a6461cdeec360ffa10fa03beb6af29aaf_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_a25f7b3704b34bb8745a0a60939e1f49c}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!send\+\_\+\+N\+A\+Tping@{send\+\_\+\+N\+A\+Tping}}
\index{send\+\_\+\+N\+A\+Tping@{send\+\_\+\+N\+A\+Tping}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{send\+\_\+\+N\+A\+Tping}]{\setlength{\rightskip}{0pt plus 5cm}static int send\+\_\+\+N\+A\+Tping (
\begin{DoxyParamCaption}
\item[{{\bf D\+H\+T} $\ast$}]{dht, }
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key, }
\item[{uint64\+\_\+t}]{ping\+\_\+id, }
\item[{uint8\+\_\+t}]{type}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_d_h_t_8c_a25f7b3704b34bb8745a0a60939e1f49c}


Definition at line 1666 of file D\+H\+T.\+c.



References create\+\_\+request(), C\+R\+Y\+P\+T\+O\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+N\+A\+T\+\_\+\+P\+I\+N\+G, make-\/funny-\/savefile\+::data, M\+A\+X\+\_\+\+C\+R\+Y\+P\+T\+O\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+S\+I\+Z\+E, num, route\+\_\+tofriend(), routeone\+\_\+tofriend(), D\+H\+T\+::self\+\_\+public\+\_\+key, and D\+H\+T\+::self\+\_\+secret\+\_\+key.



Referenced by do\+\_\+\+N\+A\+T(), and handle\+\_\+\+N\+A\+Tping().


\begin{DoxyCode}
1667 \{
1668     uint8\_t \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[\textcolor{keyword}{sizeof}(uint64\_t) + 1];
1669     uint8\_t packet[\hyperlink{crypto__core_8h_a2c79bc4b1111d42efd5fa7600398afcc}{MAX\_CRYPTO\_REQUEST\_SIZE}];
1670 
1671     \textcolor{keywordtype}{int} \hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num} = 0;
1672 
1673     \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[0] = type;
1674     memcpy(\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} + 1, &ping\_id, \textcolor{keyword}{sizeof}(uint64\_t));
1675     \textcolor{comment}{/* 254 is NAT ping request packet id */}
1676     \textcolor{keywordtype}{int} len = \hyperlink{crypto__core_8c_a73129647dfd9e436ae6abc908daa4c21}{create\_request}(dht->\hyperlink{struct_d_h_t_ae726df8bdc26380e5a6c3187a00d6881}{self\_public\_key}, dht->
      \hyperlink{struct_d_h_t_aa05050f86513ff53fe9da81f73c72267}{self\_secret\_key}, packet, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data},
1677                              \textcolor{keyword}{sizeof}(uint64\_t) + 1, \hyperlink{crypto__core_8h_accd0074d1bd9133de6460d75b10b1e21}{CRYPTO\_PACKET\_NAT\_PING});
1678 
1679     \textcolor{keywordflow}{if} (len == -1)
1680         \textcolor{keywordflow}{return} -1;
1681 
1682     \textcolor{keywordflow}{if} (type == 0) \textcolor{comment}{/* If packet is request use many people to route it. */}
1683         num = \hyperlink{_d_h_t_8c_aee23d763e291eefd141227cd9e3684ab}{route\_tofriend}(dht, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, packet, len);
1684     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (type == 1) \textcolor{comment}{/* If packet is response use only one person to route it */}
1685         num = \hyperlink{_d_h_t_8c_ad1a9a37b7cda1411149867eb77070bd1}{routeone\_tofriend}(dht, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, packet, len);
1686 
1687     \textcolor{keywordflow}{if} (num == 0)
1688         \textcolor{keywordflow}{return} -1;
1689 
1690     \textcolor{keywordflow}{return} \hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num};
1691 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a25f7b3704b34bb8745a0a60939e1f49c_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a25f7b3704b34bb8745a0a60939e1f49c_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_acce043cdc5108edffc35e6e879197d20}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!sendnodes\+\_\+ipv6@{sendnodes\+\_\+ipv6}}
\index{sendnodes\+\_\+ipv6@{sendnodes\+\_\+ipv6}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{sendnodes\+\_\+ipv6}]{\setlength{\rightskip}{0pt plus 5cm}static int sendnodes\+\_\+ipv6 (
\begin{DoxyParamCaption}
\item[{const {\bf D\+H\+T} $\ast$}]{dht, }
\item[{{\bf I\+P\+\_\+\+Port}}]{ip\+\_\+port, }
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key, }
\item[{const uint8\+\_\+t $\ast$}]{client\+\_\+id, }
\item[{const uint8\+\_\+t $\ast$}]{sendback\+\_\+data, }
\item[{uint16\+\_\+t}]{length, }
\item[{const uint8\+\_\+t $\ast$}]{shared\+\_\+encryption\+\_\+key}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_d_h_t_8c_acce043cdc5108edffc35e6e879197d20}


Definition at line 969 of file D\+H\+T.\+c.



References make-\/funny-\/savefile\+::data, encrypt\+\_\+data\+\_\+symmetric(), get\+\_\+close\+\_\+nodes(), id\+\_\+equal(), I\+P\+\_\+\+Port\+::ip, L\+A\+N\+\_\+ip(), M\+A\+X\+\_\+\+S\+E\+N\+T\+\_\+\+N\+O\+D\+E\+S, D\+H\+T\+::net, N\+E\+T\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+S\+E\+N\+D\+\_\+\+N\+O\+D\+E\+S\+\_\+\+I\+P\+V6, new\+\_\+nonce(), nonce, pack\+\_\+nodes(), D\+H\+T\+::self\+\_\+public\+\_\+key, and sendpacket().



Referenced by handle\+\_\+getnodes().


\begin{DoxyCode}
971 \{
972     \textcolor{comment}{/* Check if packet is going to be sent to ourself. */}
973     \textcolor{keywordflow}{if} (\hyperlink{util_8c_ada3d44b4f530d3c8c9cb69b732be94b1}{id\_equal}(\hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, dht->\hyperlink{struct_d_h_t_ae726df8bdc26380e5a6c3187a00d6881}{self\_public\_key}))
974         \textcolor{keywordflow}{return} -1;
975 
976     \textcolor{keywordflow}{if} (length != \textcolor{keyword}{sizeof}(uint64\_t))
977         \textcolor{keywordflow}{return} -1;
978 
979     \textcolor{keywordtype}{size\_t} Node\_format\_size = \textcolor{keyword}{sizeof}(\hyperlink{struct_node__format}{Node\_format});
980     uint8\_t \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[1 + crypto\_box\_PUBLICKEYBYTES + crypto\_box\_NONCEBYTES
981                  + Node\_format\_size * \hyperlink{_d_h_t_8h_a57f4cf16e79a384d7d59a3cc585ea5a3}{MAX\_SENT\_NODES} + length + crypto\_box\_MACBYTES];
982 
983     \hyperlink{struct_node__format}{Node\_format} nodes\_list[\hyperlink{_d_h_t_8h_a57f4cf16e79a384d7d59a3cc585ea5a3}{MAX\_SENT\_NODES}];
984     uint32\_t num\_nodes = \hyperlink{_d_h_t_8c_a8abfc9cea3784b0cae354670bd4643cd}{get\_close\_nodes}(dht, client\_id, nodes\_list, 0, 
      \hyperlink{_l_a_n__discovery_8c_a2d80a53390598eb8ededbc63f4e9c152}{LAN\_ip}(ip\_port.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}) == 0, 1);
985 
986     \textcolor{keywordflow}{if} (num\_nodes == 0)
987         \textcolor{keywordflow}{return} 0;
988 
989     uint8\_t plain[1 + Node\_format\_size * \hyperlink{_d_h_t_8h_a57f4cf16e79a384d7d59a3cc585ea5a3}{MAX\_SENT\_NODES} + length];
990     uint8\_t encrypt[\textcolor{keyword}{sizeof}(plain) + crypto\_box\_MACBYTES];
991     uint8\_t \hyperlink{crypto__test_8c_a7932c523f7065073a396e571319201ce}{nonce}[crypto\_box\_NONCEBYTES];
992     \hyperlink{crypto__core_8c_a8b1033efb47c625779d11be7d8eb9e24}{new\_nonce}(nonce);
993 
994     \textcolor{keywordtype}{int} nodes\_length = \hyperlink{_d_h_t_8c_a1d6f2fcb008c989f333ae89e840f94b4}{pack\_nodes}(plain + 1, Node\_format\_size * 
      \hyperlink{_d_h_t_8h_a57f4cf16e79a384d7d59a3cc585ea5a3}{MAX\_SENT\_NODES}, nodes\_list, num\_nodes);
995 
996     \textcolor{keywordflow}{if} (nodes\_length <= 0)
997         \textcolor{keywordflow}{return} -1;
998 
999     plain[0] = num\_nodes;
1000     memcpy(plain + 1 + nodes\_length, sendback\_data, length);
1001     \textcolor{keywordtype}{int} len = \hyperlink{crypto__core_8c_a81efc0a4a6e0efe372651e26e342a6e5}{encrypt\_data\_symmetric}( shared\_encryption\_key,
1002                                       nonce,
1003                                       plain,
1004                                       1 + nodes\_length + length,
1005                                       encrypt );
1006 
1007     \textcolor{keywordflow}{if} (len != 1 + nodes\_length + length + crypto\_box\_MACBYTES)
1008         \textcolor{keywordflow}{return} -1;
1009 
1010     data[0] = \hyperlink{network_8h_a868cfc97dcb064ca456278fc89f9b512}{NET\_PACKET\_SEND\_NODES\_IPV6};
1011     memcpy(data + 1, dht->\hyperlink{struct_d_h_t_ae726df8bdc26380e5a6c3187a00d6881}{self\_public\_key}, crypto\_box\_PUBLICKEYBYTES);
1012     memcpy(data + 1 + crypto\_box\_PUBLICKEYBYTES, nonce, crypto\_box\_NONCEBYTES);
1013     memcpy(data + 1 + crypto\_box\_PUBLICKEYBYTES + crypto\_box\_NONCEBYTES, encrypt, len);
1014 
1015     \textcolor{keywordflow}{return} \hyperlink{network_8c_a7b90f87f3ba60cc5c66dd6dd77cd5cb1}{sendpacket}(dht->\hyperlink{struct_d_h_t_aa14ea2f67950f57fe4235d7375a2216c}{net}, ip\_port, data, 1 + crypto\_box\_PUBLICKEYBYTES + 
      crypto\_box\_NONCEBYTES + len);
1016 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_acce043cdc5108edffc35e6e879197d20_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_acce043cdc5108edffc35e6e879197d20_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_a8def0d75fd95309e03096fbcf5085fe3}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!sent\+\_\+getnode\+\_\+to\+\_\+node@{sent\+\_\+getnode\+\_\+to\+\_\+node}}
\index{sent\+\_\+getnode\+\_\+to\+\_\+node@{sent\+\_\+getnode\+\_\+to\+\_\+node}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{sent\+\_\+getnode\+\_\+to\+\_\+node}]{\setlength{\rightskip}{0pt plus 5cm}static uint8\+\_\+t sent\+\_\+getnode\+\_\+to\+\_\+node (
\begin{DoxyParamCaption}
\item[{{\bf D\+H\+T} $\ast$}]{dht, }
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key, }
\item[{{\bf I\+P\+\_\+\+Port}}]{node\+\_\+ip\+\_\+port, }
\item[{uint64\+\_\+t}]{ping\+\_\+id, }
\item[{{\bf Node\+\_\+format} $\ast$}]{sendback\+\_\+node}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_d_h_t_8c_a8def0d75fd95309e03096fbcf5085fe3}


Definition at line 1051 of file D\+H\+T.\+c.



References make-\/funny-\/savefile\+::data, D\+H\+T\+::dht\+\_\+harden\+\_\+ping\+\_\+array, D\+H\+T\+::dht\+\_\+ping\+\_\+array, Node\+\_\+format\+::ip\+\_\+port, ipport\+\_\+equal(), ping\+\_\+array\+\_\+check(), and Node\+\_\+format\+::public\+\_\+key.



Referenced by handle\+\_\+sendnodes\+\_\+core().


\begin{DoxyCode}
1053 \{
1054     uint8\_t \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[\textcolor{keyword}{sizeof}(\hyperlink{struct_node__format}{Node\_format}) * 2];
1055 
1056     \textcolor{keywordflow}{if} (\hyperlink{ping__array_8c_a3d5c40ba255810816fddd02116ec2d22}{ping\_array\_check}(\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}, \textcolor{keyword}{sizeof}(\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}), &dht->
      \hyperlink{struct_d_h_t_a8432234ba71a00ac9c516cb80a70f29d}{dht\_ping\_array}, ping\_id) == \textcolor{keyword}{sizeof}(\hyperlink{struct_node__format}{Node\_format})) \{
1057         memset(sendback\_node, 0, \textcolor{keyword}{sizeof}(\hyperlink{struct_node__format}{Node\_format}));
1058     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{ping__array_8c_a3d5c40ba255810816fddd02116ec2d22}{ping\_array\_check}(\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}, \textcolor{keyword}{sizeof}(\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}), &dht->
      \hyperlink{struct_d_h_t_a957126e184a8b8001228effc56b9db95}{dht\_harden\_ping\_array}, ping\_id) == \textcolor{keyword}{sizeof}(\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data})) \{
1059         memcpy(sendback\_node, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} + \textcolor{keyword}{sizeof}(\hyperlink{struct_node__format}{Node\_format}), \textcolor{keyword}{sizeof}(
      \hyperlink{struct_node__format}{Node\_format}));
1060     \} \textcolor{keywordflow}{else} \{
1061         \textcolor{keywordflow}{return} 0;
1062     \}
1063 
1064     \hyperlink{struct_node__format}{Node\_format} test;
1065     memcpy(&test, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}, \textcolor{keyword}{sizeof}(\hyperlink{struct_node__format}{Node\_format}));
1066 
1067     \textcolor{keywordflow}{if} (!\hyperlink{network_8c_a6913335cf0b2a76303f5f61d18ea2277}{ipport\_equal}(&test.\hyperlink{struct_node__format_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}, &node\_ip\_port) || memcmp(test.
      \hyperlink{struct_node__format_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, crypto\_box\_PUBLICKEYBYTES) != 0)
1068         \textcolor{keywordflow}{return} 0;
1069 
1070     \textcolor{keywordflow}{return} 1;
1071 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a8def0d75fd95309e03096fbcf5085fe3_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a8def0d75fd95309e03096fbcf5085fe3_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_addb87a718c80bb27e53e8dde5972dfe9}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!store\+\_\+node\+\_\+ok@{store\+\_\+node\+\_\+ok}}
\index{store\+\_\+node\+\_\+ok@{store\+\_\+node\+\_\+ok}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{store\+\_\+node\+\_\+ok}]{\setlength{\rightskip}{0pt plus 5cm}static unsigned int store\+\_\+node\+\_\+ok (
\begin{DoxyParamCaption}
\item[{const {\bf Client\+\_\+data} $\ast$}]{client, }
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key, }
\item[{const uint8\+\_\+t $\ast$}]{comp\+\_\+public\+\_\+key}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_d_h_t_8c_addb87a718c80bb27e53e8dde5972dfe9}


Definition at line 677 of file D\+H\+T.\+c.



References Client\+\_\+data\+::assoc4, Client\+\_\+data\+::assoc6, B\+A\+D\+\_\+\+N\+O\+D\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T, id\+\_\+closest(), is\+\_\+timeout(), Client\+\_\+data\+::public\+\_\+key, and I\+P\+P\+Ts\+Png\+::timestamp.



Referenced by ping\+\_\+node\+\_\+from\+\_\+getnodes\+\_\+ok(), and replace\+\_\+all().


\begin{DoxyCode}
678 \{
679     \textcolor{keywordflow}{if} ((\hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(client->\hyperlink{struct_client__data_ac9843379cbcd02bdfa5c180a1474a6c5}{assoc4}.\hyperlink{struct_i_p_p_ts_png_a465bef81f6478756e5443025b1f2ddfa}{timestamp}, 
      \hyperlink{_d_h_t_8h_a2c542fd03a43f340d1fb281afe54453f}{BAD\_NODE\_TIMEOUT}) && \hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(client->\hyperlink{struct_client__data_a87d394929a2604f6f785fec949fac618}{assoc6}.
      \hyperlink{struct_i_p_p_ts_png_a465bef81f6478756e5443025b1f2ddfa}{timestamp}, \hyperlink{_d_h_t_8h_a2c542fd03a43f340d1fb281afe54453f}{BAD\_NODE\_TIMEOUT}))
680             || (\hyperlink{_d_h_t_8c_a903a5bc580826fe447adb841b7782333}{id\_closest}(comp\_public\_key, client->\hyperlink{struct_client__data_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, 
      \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}) == 2)) \{
681         \textcolor{keywordflow}{return} 1;
682     \} \textcolor{keywordflow}{else} \{
683         \textcolor{keywordflow}{return} 0;
684     \}
685 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_addb87a718c80bb27e53e8dde5972dfe9_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_addb87a718c80bb27e53e8dde5972dfe9_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_a74120ec4fc551572bff2a08436854c97}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!to\+\_\+host\+\_\+family@{to\+\_\+host\+\_\+family}}
\index{to\+\_\+host\+\_\+family@{to\+\_\+host\+\_\+family}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{to\+\_\+host\+\_\+family}]{\setlength{\rightskip}{0pt plus 5cm}int to\+\_\+host\+\_\+family (
\begin{DoxyParamCaption}
\item[{{\bf I\+P} $\ast$}]{ip}
\end{DoxyParamCaption}
)}}\label{_d_h_t_8c_a74120ec4fc551572bff2a08436854c97}


Definition at line 167 of file D\+H\+T.\+c.



References I\+P\+::family, T\+O\+X\+\_\+\+A\+F\+\_\+\+I\+N\+E\+T, and T\+O\+X\+\_\+\+A\+F\+\_\+\+I\+N\+E\+T6.



Referenced by ip\+\_\+unpack().


\begin{DoxyCode}
168 \{
169     \textcolor{keywordflow}{if} (ip->\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} == \hyperlink{_d_h_t_8h_ac35a63082a23b6ced97c0a3a24ba06be}{TOX\_AF\_INET}) \{
170         ip->\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} = AF\_INET;
171         \textcolor{keywordflow}{return} 0;
172     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (ip->\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} == \hyperlink{_d_h_t_8h_a025adcf535ab2c7123fb5ea22fe20bbd}{TOX\_AF\_INET6}) \{
173         ip->\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} = AF\_INET6;
174         \textcolor{keywordflow}{return} 0;
175     \} \textcolor{keywordflow}{else} \{
176         \textcolor{keywordflow}{return} -1;
177     \}
178 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a74120ec4fc551572bff2a08436854c97_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_ae7f65a76f9c4b0093f45fc1777238459}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!to\+\_\+net\+\_\+family@{to\+\_\+net\+\_\+family}}
\index{to\+\_\+net\+\_\+family@{to\+\_\+net\+\_\+family}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{to\+\_\+net\+\_\+family}]{\setlength{\rightskip}{0pt plus 5cm}void to\+\_\+net\+\_\+family (
\begin{DoxyParamCaption}
\item[{{\bf I\+P} $\ast$}]{ip}
\end{DoxyParamCaption}
)}}\label{_d_h_t_8c_ae7f65a76f9c4b0093f45fc1777238459}


Definition at line 159 of file D\+H\+T.\+c.



References I\+P\+::family, T\+O\+X\+\_\+\+A\+F\+\_\+\+I\+N\+E\+T, and T\+O\+X\+\_\+\+A\+F\+\_\+\+I\+N\+E\+T6.



Referenced by ip\+\_\+pack().


\begin{DoxyCode}
160 \{
161     \textcolor{keywordflow}{if} (ip->\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} == AF\_INET)
162         ip->\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} = \hyperlink{_d_h_t_8h_ac35a63082a23b6ced97c0a3a24ba06be}{TOX\_AF\_INET};
163     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (ip->\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} == AF\_INET6)
164         ip->\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} = \hyperlink{_d_h_t_8h_a025adcf535ab2c7123fb5ea22fe20bbd}{TOX\_AF\_INET6};
165 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_ae7f65a76f9c4b0093f45fc1777238459_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_a45b33af842c0289c78c70f81e854ed62}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!unpack\+\_\+nodes@{unpack\+\_\+nodes}}
\index{unpack\+\_\+nodes@{unpack\+\_\+nodes}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{unpack\+\_\+nodes}]{\setlength{\rightskip}{0pt plus 5cm}int unpack\+\_\+nodes (
\begin{DoxyParamCaption}
\item[{{\bf Node\+\_\+format} $\ast$}]{nodes, }
\item[{uint16\+\_\+t}]{max\+\_\+num\+\_\+nodes, }
\item[{uint16\+\_\+t $\ast$}]{processed\+\_\+data\+\_\+len, }
\item[{const uint8\+\_\+t $\ast$}]{data, }
\item[{uint16\+\_\+t}]{length, }
\item[{uint8\+\_\+t}]{tcp\+\_\+enabled}
\end{DoxyParamCaption}
)}}\label{_d_h_t_8c_a45b33af842c0289c78c70f81e854ed62}


Definition at line 268 of file D\+H\+T.\+c.



References I\+P\+::family, I\+P\+\_\+\+Port\+::ip, Node\+\_\+format\+::ip\+\_\+port, num, P\+A\+C\+K\+E\+D\+\_\+\+N\+O\+D\+E\+\_\+\+S\+I\+Z\+E\+\_\+\+I\+P4, P\+A\+C\+K\+E\+D\+\_\+\+N\+O\+D\+E\+\_\+\+S\+I\+Z\+E\+\_\+\+I\+P6, make-\/funny-\/savefile\+::public\+\_\+key, S\+I\+Z\+E\+\_\+\+I\+P4, S\+I\+Z\+E\+\_\+\+I\+P6, T\+C\+P\+\_\+\+I\+N\+E\+T, T\+C\+P\+\_\+\+I\+N\+E\+T6, T\+O\+X\+\_\+\+A\+F\+\_\+\+I\+N\+E\+T, T\+O\+X\+\_\+\+A\+F\+\_\+\+I\+N\+E\+T6, T\+O\+X\+\_\+\+T\+C\+P\+\_\+\+I\+N\+E\+T, and T\+O\+X\+\_\+\+T\+C\+P\+\_\+\+I\+N\+E\+T6.



Referenced by dht\+\_\+load\+\_\+state\+\_\+callback(), handle\+\_\+announce\+\_\+response(), handle\+\_\+dhtpk\+\_\+announce(), handle\+\_\+hardening(), handle\+\_\+packet(), handle\+\_\+sendnodes\+\_\+core(), and messenger\+\_\+load\+\_\+state\+\_\+callback().


\begin{DoxyCode}
270 \{
271     uint32\_t \hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num} = 0, len\_processed = 0;
272 
273     \textcolor{keywordflow}{while} (num < max\_num\_nodes && len\_processed < length) \{
274         \textcolor{keywordtype}{int} ipv6 = -1;
275         uint8\_t host\_family;
276 
277         \textcolor{keywordflow}{if} (\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[len\_processed] == \hyperlink{_d_h_t_8h_ac35a63082a23b6ced97c0a3a24ba06be}{TOX\_AF\_INET}) \{
278             ipv6 = 0;
279             host\_family = AF\_INET;
280         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[len\_processed] == \hyperlink{_d_h_t_8h_ab59616c5422ae79ebc665059761879d5}{TOX\_TCP\_INET}) \{
281             \textcolor{keywordflow}{if} (!tcp\_enabled)
282                 \textcolor{keywordflow}{return} -1;
283 
284             ipv6 = 0;
285             host\_family = \hyperlink{network_8h_a38cdd2f189180d6790d5b181f55ca047}{TCP\_INET};
286         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[len\_processed] == \hyperlink{_d_h_t_8h_a025adcf535ab2c7123fb5ea22fe20bbd}{TOX\_AF\_INET6}) \{
287             ipv6 = 1;
288             host\_family = AF\_INET6;
289         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[len\_processed] == \hyperlink{_d_h_t_8h_a30bf86f2e1f87bcbd6a90145943aabac}{TOX\_TCP\_INET6}) \{
290             \textcolor{keywordflow}{if} (!tcp\_enabled)
291                 \textcolor{keywordflow}{return} -1;
292 
293             ipv6 = 1;
294             host\_family = \hyperlink{network_8h_a7cd884776d628ca50049592d963c10cc}{TCP\_INET6};
295         \} \textcolor{keywordflow}{else} \{
296             \textcolor{keywordflow}{return} -1;
297         \}
298 
299         \textcolor{keywordflow}{if} (ipv6 == 0) \{
300             uint32\_t size = \hyperlink{_d_h_t_8c_a03601baefa220335487dfc838c08d268}{PACKED\_NODE\_SIZE\_IP4};
301 
302             \textcolor{keywordflow}{if} (len\_processed + size > length)
303                 \textcolor{keywordflow}{return} -1;
304 
305             nodes[\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num}].\hyperlink{struct_node__format_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} = host\_family;
306             memcpy(&nodes[num].ip\_port.ip.ip4, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} + len\_processed + 1, 
      \hyperlink{network_8h_af01e75c1c63a39bcd2aacdf3018b18c9}{SIZE\_IP4});
307             memcpy(&nodes[num].ip\_port.port, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} + len\_processed + 1 + 
      \hyperlink{network_8h_af01e75c1c63a39bcd2aacdf3018b18c9}{SIZE\_IP4}, \textcolor{keyword}{sizeof}(uint16\_t));
308             memcpy(nodes[num].\hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} + len\_processed + 1 + 
      \hyperlink{network_8h_af01e75c1c63a39bcd2aacdf3018b18c9}{SIZE\_IP4} + \textcolor{keyword}{sizeof}(uint16\_t), crypto\_box\_PUBLICKEYBYTES);
309             len\_processed += size;
310             ++\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num};
311         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (ipv6 == 1) \{
312             uint32\_t size = \hyperlink{_d_h_t_8c_a9b47e23b0610a17f01902680f55d7963}{PACKED\_NODE\_SIZE\_IP6};
313 
314             \textcolor{keywordflow}{if} (len\_processed + size > length)
315                 \textcolor{keywordflow}{return} -1;
316 
317             nodes[\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num}].\hyperlink{struct_node__format_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} = host\_family;
318             memcpy(&nodes[num].ip\_port.ip.ip6, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} + len\_processed + 1, 
      \hyperlink{network_8h_a5d7430ad26f80239b9fe1bbcd51b5ed2}{SIZE\_IP6});
319             memcpy(&nodes[num].ip\_port.port, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} + len\_processed + 1 + 
      \hyperlink{network_8h_a5d7430ad26f80239b9fe1bbcd51b5ed2}{SIZE\_IP6}, \textcolor{keyword}{sizeof}(uint16\_t));
320             memcpy(nodes[num].\hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} + len\_processed + 1 + 
      \hyperlink{network_8h_a5d7430ad26f80239b9fe1bbcd51b5ed2}{SIZE\_IP6} + \textcolor{keyword}{sizeof}(uint16\_t), crypto\_box\_PUBLICKEYBYTES);
321             len\_processed += size;
322             ++\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num};
323         \} \textcolor{keywordflow}{else} \{
324             \textcolor{keywordflow}{return} -1;
325         \}
326     \}
327 
328     \textcolor{keywordflow}{if} (processed\_data\_len)
329         *processed\_data\_len = len\_processed;
330 
331     \textcolor{keywordflow}{return} \hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num};
332 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a45b33af842c0289c78c70f81e854ed62_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8c_a910e4555ff14d9974e6f1dd227d8dd99}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!z\+\_\+state\+\_\+save\+\_\+subheader@{z\+\_\+state\+\_\+save\+\_\+subheader}}
\index{z\+\_\+state\+\_\+save\+\_\+subheader@{z\+\_\+state\+\_\+save\+\_\+subheader}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{z\+\_\+state\+\_\+save\+\_\+subheader}]{\setlength{\rightskip}{0pt plus 5cm}static uint8\+\_\+t$\ast$ z\+\_\+state\+\_\+save\+\_\+subheader (
\begin{DoxyParamCaption}
\item[{uint8\+\_\+t $\ast$}]{data, }
\item[{uint32\+\_\+t}]{len, }
\item[{uint16\+\_\+t}]{type}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_d_h_t_8c_a910e4555ff14d9974e6f1dd227d8dd99}


Definition at line 2318 of file D\+H\+T.\+c.



References make-\/funny-\/savefile\+::data, D\+H\+T\+\_\+\+S\+T\+A\+T\+E\+\_\+\+C\+O\+O\+K\+I\+E\+\_\+\+T\+Y\+P\+E, host\+\_\+to\+\_\+lendian32(), and host\+\_\+tolendian16.



Referenced by D\+H\+T\+\_\+save().


\begin{DoxyCode}
2319 \{
2320     \hyperlink{util_8c_aebd439a002cb183420a08996f7ffdbef}{host\_to\_lendian32}(\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}, len);
2321     \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} += \textcolor{keyword}{sizeof}(uint32\_t);
2322     \hyperlink{util_8c_aebd439a002cb183420a08996f7ffdbef}{host\_to\_lendian32}(\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}, (\hyperlink{util_8h_afa26187eb0886240d742e14fc39ec70f}{host\_tolendian16}(
      \hyperlink{_d_h_t_8c_a48a9324191a79b2e05af9b6499addba6}{DHT\_STATE\_COOKIE\_TYPE}) << 16) | \hyperlink{util_8h_afa26187eb0886240d742e14fc39ec70f}{host\_tolendian16}(type));
2323     \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} += \textcolor{keyword}{sizeof}(uint32\_t);
2324     \textcolor{keywordflow}{return} \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data};
2325 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=336pt]{dc/dc1/_d_h_t_8c_a910e4555ff14d9974e6f1dd227d8dd99_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dc/dc1/_d_h_t_8c_a910e4555ff14d9974e6f1dd227d8dd99_icgraph}
\end{center}
\end{figure}




\subsection{Variable Documentation}
\hypertarget{_d_h_t_8c_a3551f15862efa7b58779722fe9763c45}{\index{D\+H\+T.\+c@{D\+H\+T.\+c}!cmp\+\_\+public\+\_\+key@{cmp\+\_\+public\+\_\+key}}
\index{cmp\+\_\+public\+\_\+key@{cmp\+\_\+public\+\_\+key}!D\+H\+T.\+c@{D\+H\+T.\+c}}
\subsubsection[{cmp\+\_\+public\+\_\+key}]{\setlength{\rightskip}{0pt plus 5cm}uint8\+\_\+t cmp\+\_\+public\+\_\+key\mbox{[}crypto\+\_\+box\+\_\+\+P\+U\+B\+L\+I\+C\+K\+E\+Y\+B\+Y\+T\+E\+S\mbox{]}\hspace{0.3cm}{\ttfamily [static]}}}\label{_d_h_t_8c_a3551f15862efa7b58779722fe9763c45}


Definition at line 630 of file D\+H\+T.\+c.



Referenced by cmp\+\_\+dht\+\_\+entry(), and replace\+\_\+all().

