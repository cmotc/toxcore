\hypertarget{onion__announce_8c}{\section{toxcore/onion\+\_\+announce.c File Reference}
\label{onion__announce_8c}\index{toxcore/onion\+\_\+announce.\+c@{toxcore/onion\+\_\+announce.\+c}}
}
{\ttfamily \#include \char`\"{}onion\+\_\+announce.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}L\+A\+N\+\_\+discovery.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}util.\+h\char`\"{}}\\*
Include dependency graph for onion\+\_\+announce.\+c\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{de/d6e/onion__announce_8c__incl}
\end{center}
\end{figure}
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{onion__announce_8c_aa99b01f1afd2313072400ff3a506d818}{P\+I\+N\+G\+\_\+\+I\+D\+\_\+\+T\+I\+M\+E\+O\+U\+T}~20
\item 
\#define \hyperlink{onion__announce_8c_aa4bbc416c612b8eb58c4ad4975c7fcc0}{A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+S\+I\+Z\+E\+\_\+\+R\+E\+C\+V}~(\hyperlink{onion__announce_8h_a561fc355e3538d55f7206dea279bb04c}{O\+N\+I\+O\+N\+\_\+\+A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+S\+I\+Z\+E} + \hyperlink{onion_8h_a3a333162e7c23bebfa7554654db9374e}{O\+N\+I\+O\+N\+\_\+\+R\+E\+T\+U\+R\+N\+\_\+3})
\item 
\#define \hyperlink{onion__announce_8c_aef1d98040750dbcb985821c88844b8c4}{D\+A\+T\+A\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+M\+I\+N\+\_\+\+S\+I\+Z\+E}~\hyperlink{onion__announce_8h_ad4e6231c669b86daebf9ac1dfbab2292}{O\+N\+I\+O\+N\+\_\+\+D\+A\+T\+A\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+M\+I\+N\+\_\+\+S\+I\+Z\+E}
\item 
\#define \hyperlink{onion__announce_8c_a145e1d8cd3a09780f45c770d88660c47}{D\+A\+T\+A\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+M\+I\+N\+\_\+\+S\+I\+Z\+E\+\_\+\+R\+E\+C\+V}~(\hyperlink{onion__announce_8c_aef1d98040750dbcb985821c88844b8c4}{D\+A\+T\+A\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+M\+I\+N\+\_\+\+S\+I\+Z\+E} + \hyperlink{onion_8h_a3a333162e7c23bebfa7554654db9374e}{O\+N\+I\+O\+N\+\_\+\+R\+E\+T\+U\+R\+N\+\_\+3})
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{onion__announce_8c_ad4ee12caef533a0866e8a746041c92d8}{create\+\_\+announce\+\_\+request} (uint8\+\_\+t $\ast$packet, uint16\+\_\+t max\+\_\+packet\+\_\+length, const uint8\+\_\+t $\ast$dest\+\_\+client\+\_\+id, const uint8\+\_\+t $\ast$public\+\_\+key, const uint8\+\_\+t $\ast$secret\+\_\+key, const uint8\+\_\+t $\ast$ping\+\_\+id, const uint8\+\_\+t $\ast$client\+\_\+id, const uint8\+\_\+t $\ast$data\+\_\+public\+\_\+key, uint64\+\_\+t sendback\+\_\+data)
\item 
int \hyperlink{onion__announce_8c_a036c483b853b8b14de8d1e4256cc59a7}{create\+\_\+data\+\_\+request} (uint8\+\_\+t $\ast$packet, uint16\+\_\+t max\+\_\+packet\+\_\+length, const uint8\+\_\+t $\ast$public\+\_\+key, const uint8\+\_\+t $\ast$encrypt\+\_\+public\+\_\+key, const uint8\+\_\+t $\ast$\hyperlink{onion__test_8c_af73a4a6ff6a4878d8eae4ec38ffeaac2}{nonce}, const uint8\+\_\+t $\ast$data, uint16\+\_\+t length)
\item 
int \hyperlink{onion__announce_8c_adf4563e859323282731b183ef62cfbcc}{send\+\_\+announce\+\_\+request} (\hyperlink{struct_networking___core}{Networking\+\_\+\+Core} $\ast$net, const \hyperlink{struct_onion___path}{Onion\+\_\+\+Path} $\ast$\hyperlink{tox__sync_8c_a6f50c85874ef8f3405625e5a26febbcb}{path}, \hyperlink{struct_node__format}{Node\+\_\+format} dest, const uint8\+\_\+t $\ast$public\+\_\+key, const uint8\+\_\+t $\ast$secret\+\_\+key, const uint8\+\_\+t $\ast$ping\+\_\+id, const uint8\+\_\+t $\ast$client\+\_\+id, const uint8\+\_\+t $\ast$data\+\_\+public\+\_\+key, uint64\+\_\+t sendback\+\_\+data)
\item 
int \hyperlink{onion__announce_8c_a16a4948e44b16b56b9c0de61d2988082}{send\+\_\+data\+\_\+request} (\hyperlink{struct_networking___core}{Networking\+\_\+\+Core} $\ast$net, const \hyperlink{struct_onion___path}{Onion\+\_\+\+Path} $\ast$\hyperlink{tox__sync_8c_a6f50c85874ef8f3405625e5a26febbcb}{path}, \hyperlink{struct_i_p___port}{I\+P\+\_\+\+Port} dest, const uint8\+\_\+t $\ast$public\+\_\+key, const uint8\+\_\+t $\ast$encrypt\+\_\+public\+\_\+key, const uint8\+\_\+t $\ast$\hyperlink{onion__test_8c_af73a4a6ff6a4878d8eae4ec38ffeaac2}{nonce}, const uint8\+\_\+t $\ast$data, uint16\+\_\+t length)
\item 
static void \hyperlink{onion__announce_8c_a890184a7523e5b05c60244713ba127f2}{generate\+\_\+ping\+\_\+id} (const \hyperlink{struct_onion___announce}{Onion\+\_\+\+Announce} $\ast$onion\+\_\+a, uint64\+\_\+t time, const uint8\+\_\+t $\ast$public\+\_\+key, \hyperlink{struct_i_p___port}{I\+P\+\_\+\+Port} ret\+\_\+ip\+\_\+port, uint8\+\_\+t $\ast$ping\+\_\+id)
\item 
static int \hyperlink{onion__announce_8c_ae515a6c25a90b4f27cfd4fe323b9a570}{in\+\_\+entries} (const \hyperlink{struct_onion___announce}{Onion\+\_\+\+Announce} $\ast$onion\+\_\+a, const uint8\+\_\+t $\ast$public\+\_\+key)
\item 
static int \hyperlink{onion__announce_8c_a8b4a60d685081d29b3b61256241acaf5}{cmp\+\_\+entry} (const void $\ast$a, const void $\ast$b)
\item 
static int \hyperlink{onion__announce_8c_a8a782c6968d8bec9a92dfdd0bd32b00f}{add\+\_\+to\+\_\+entries} (\hyperlink{struct_onion___announce}{Onion\+\_\+\+Announce} $\ast$onion\+\_\+a, \hyperlink{struct_i_p___port}{I\+P\+\_\+\+Port} ret\+\_\+ip\+\_\+port, const uint8\+\_\+t $\ast$public\+\_\+key, const uint8\+\_\+t $\ast$data\+\_\+public\+\_\+key, const uint8\+\_\+t $\ast$ret)
\item 
static int \hyperlink{onion__announce_8c_a5cc40944c42a4e0d1d3d702cf93ac8ad}{handle\+\_\+announce\+\_\+request} (void $\ast$object, \hyperlink{struct_i_p___port}{I\+P\+\_\+\+Port} source, const uint8\+\_\+t $\ast$packet, uint16\+\_\+t length)
\item 
static int \hyperlink{onion__announce_8c_a938e61f5184d72e920e81cab7dc8056a}{handle\+\_\+data\+\_\+request} (void $\ast$object, \hyperlink{struct_i_p___port}{I\+P\+\_\+\+Port} source, const uint8\+\_\+t $\ast$packet, uint16\+\_\+t length)
\item 
\hyperlink{struct_onion___announce}{Onion\+\_\+\+Announce} $\ast$ \hyperlink{onion__announce_8c_a1807a1d99b93e29c2a27648afe3e6c2c}{new\+\_\+onion\+\_\+announce} (\hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht)
\item 
void \hyperlink{onion__announce_8c_ad21ecb14ae7a2a0d11a1d0523a459146}{kill\+\_\+onion\+\_\+announce} (\hyperlink{struct_onion___announce}{Onion\+\_\+\+Announce} $\ast$onion\+\_\+a)
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
static uint8\+\_\+t \hyperlink{onion__announce_8c_a3551f15862efa7b58779722fe9763c45}{cmp\+\_\+public\+\_\+key} \mbox{[}crypto\+\_\+box\+\_\+\+P\+U\+B\+L\+I\+C\+K\+E\+Y\+B\+Y\+T\+E\+S\mbox{]}
\end{DoxyCompactItemize}


\subsection{Macro Definition Documentation}
\hypertarget{onion__announce_8c_aa4bbc416c612b8eb58c4ad4975c7fcc0}{\index{onion\+\_\+announce.\+c@{onion\+\_\+announce.\+c}!A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+S\+I\+Z\+E\+\_\+\+R\+E\+C\+V@{A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+S\+I\+Z\+E\+\_\+\+R\+E\+C\+V}}
\index{A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+S\+I\+Z\+E\+\_\+\+R\+E\+C\+V@{A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+S\+I\+Z\+E\+\_\+\+R\+E\+C\+V}!onion\+\_\+announce.\+c@{onion\+\_\+announce.\+c}}
\subsubsection[{A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+S\+I\+Z\+E\+\_\+\+R\+E\+C\+V}]{\setlength{\rightskip}{0pt plus 5cm}\#define A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+S\+I\+Z\+E\+\_\+\+R\+E\+C\+V~({\bf O\+N\+I\+O\+N\+\_\+\+A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+S\+I\+Z\+E} + {\bf O\+N\+I\+O\+N\+\_\+\+R\+E\+T\+U\+R\+N\+\_\+3})}}\label{onion__announce_8c_aa4bbc416c612b8eb58c4ad4975c7fcc0}


Definition at line 32 of file onion\+\_\+announce.\+c.



Referenced by handle\+\_\+announce\+\_\+request().

\hypertarget{onion__announce_8c_aef1d98040750dbcb985821c88844b8c4}{\index{onion\+\_\+announce.\+c@{onion\+\_\+announce.\+c}!D\+A\+T\+A\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+M\+I\+N\+\_\+\+S\+I\+Z\+E@{D\+A\+T\+A\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+M\+I\+N\+\_\+\+S\+I\+Z\+E}}
\index{D\+A\+T\+A\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+M\+I\+N\+\_\+\+S\+I\+Z\+E@{D\+A\+T\+A\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+M\+I\+N\+\_\+\+S\+I\+Z\+E}!onion\+\_\+announce.\+c@{onion\+\_\+announce.\+c}}
\subsubsection[{D\+A\+T\+A\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+M\+I\+N\+\_\+\+S\+I\+Z\+E}]{\setlength{\rightskip}{0pt plus 5cm}\#define D\+A\+T\+A\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+M\+I\+N\+\_\+\+S\+I\+Z\+E~{\bf O\+N\+I\+O\+N\+\_\+\+D\+A\+T\+A\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+M\+I\+N\+\_\+\+S\+I\+Z\+E}}}\label{onion__announce_8c_aef1d98040750dbcb985821c88844b8c4}


Definition at line 34 of file onion\+\_\+announce.\+c.



Referenced by create\+\_\+data\+\_\+request().

\hypertarget{onion__announce_8c_a145e1d8cd3a09780f45c770d88660c47}{\index{onion\+\_\+announce.\+c@{onion\+\_\+announce.\+c}!D\+A\+T\+A\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+M\+I\+N\+\_\+\+S\+I\+Z\+E\+\_\+\+R\+E\+C\+V@{D\+A\+T\+A\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+M\+I\+N\+\_\+\+S\+I\+Z\+E\+\_\+\+R\+E\+C\+V}}
\index{D\+A\+T\+A\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+M\+I\+N\+\_\+\+S\+I\+Z\+E\+\_\+\+R\+E\+C\+V@{D\+A\+T\+A\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+M\+I\+N\+\_\+\+S\+I\+Z\+E\+\_\+\+R\+E\+C\+V}!onion\+\_\+announce.\+c@{onion\+\_\+announce.\+c}}
\subsubsection[{D\+A\+T\+A\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+M\+I\+N\+\_\+\+S\+I\+Z\+E\+\_\+\+R\+E\+C\+V}]{\setlength{\rightskip}{0pt plus 5cm}\#define D\+A\+T\+A\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+M\+I\+N\+\_\+\+S\+I\+Z\+E\+\_\+\+R\+E\+C\+V~({\bf D\+A\+T\+A\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+M\+I\+N\+\_\+\+S\+I\+Z\+E} + {\bf O\+N\+I\+O\+N\+\_\+\+R\+E\+T\+U\+R\+N\+\_\+3})}}\label{onion__announce_8c_a145e1d8cd3a09780f45c770d88660c47}


Definition at line 35 of file onion\+\_\+announce.\+c.



Referenced by handle\+\_\+data\+\_\+request().

\hypertarget{onion__announce_8c_aa99b01f1afd2313072400ff3a506d818}{\index{onion\+\_\+announce.\+c@{onion\+\_\+announce.\+c}!P\+I\+N\+G\+\_\+\+I\+D\+\_\+\+T\+I\+M\+E\+O\+U\+T@{P\+I\+N\+G\+\_\+\+I\+D\+\_\+\+T\+I\+M\+E\+O\+U\+T}}
\index{P\+I\+N\+G\+\_\+\+I\+D\+\_\+\+T\+I\+M\+E\+O\+U\+T@{P\+I\+N\+G\+\_\+\+I\+D\+\_\+\+T\+I\+M\+E\+O\+U\+T}!onion\+\_\+announce.\+c@{onion\+\_\+announce.\+c}}
\subsubsection[{P\+I\+N\+G\+\_\+\+I\+D\+\_\+\+T\+I\+M\+E\+O\+U\+T}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\+I\+N\+G\+\_\+\+I\+D\+\_\+\+T\+I\+M\+E\+O\+U\+T~20}}\label{onion__announce_8c_aa99b01f1afd2313072400ff3a506d818}


Definition at line 30 of file onion\+\_\+announce.\+c.



Referenced by generate\+\_\+ping\+\_\+id(), and handle\+\_\+announce\+\_\+request().



\subsection{Function Documentation}
\hypertarget{onion__announce_8c_a8a782c6968d8bec9a92dfdd0bd32b00f}{\index{onion\+\_\+announce.\+c@{onion\+\_\+announce.\+c}!add\+\_\+to\+\_\+entries@{add\+\_\+to\+\_\+entries}}
\index{add\+\_\+to\+\_\+entries@{add\+\_\+to\+\_\+entries}!onion\+\_\+announce.\+c@{onion\+\_\+announce.\+c}}
\subsubsection[{add\+\_\+to\+\_\+entries}]{\setlength{\rightskip}{0pt plus 5cm}static int add\+\_\+to\+\_\+entries (
\begin{DoxyParamCaption}
\item[{{\bf Onion\+\_\+\+Announce} $\ast$}]{onion\+\_\+a, }
\item[{{\bf I\+P\+\_\+\+Port}}]{ret\+\_\+ip\+\_\+port, }
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key, }
\item[{const uint8\+\_\+t $\ast$}]{data\+\_\+public\+\_\+key, }
\item[{const uint8\+\_\+t $\ast$}]{ret}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{onion__announce_8c_a8a782c6968d8bec9a92dfdd0bd32b00f}


Definition at line 255 of file onion\+\_\+announce.\+c.



References cmp\+\_\+entry(), cmp\+\_\+public\+\_\+key, Onion\+\_\+\+Announce\+\_\+\+Entry\+::data\+\_\+public\+\_\+key, Onion\+\_\+\+Announce\+::dht, Onion\+\_\+\+Announce\+::entries, i, id\+\_\+closest(), in\+\_\+entries(), is\+\_\+timeout(), O\+N\+I\+O\+N\+\_\+\+A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+M\+A\+X\+\_\+\+E\+N\+T\+R\+I\+E\+S, O\+N\+I\+O\+N\+\_\+\+A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T, O\+N\+I\+O\+N\+\_\+\+R\+E\+T\+U\+R\+N\+\_\+3, Onion\+\_\+\+Announce\+\_\+\+Entry\+::public\+\_\+key, Onion\+\_\+\+Announce\+\_\+\+Entry\+::ret, Onion\+\_\+\+Announce\+\_\+\+Entry\+::ret\+\_\+ip\+\_\+port, D\+H\+T\+::self\+\_\+public\+\_\+key, Onion\+\_\+\+Announce\+\_\+\+Entry\+::time, and unix\+\_\+time().



Referenced by handle\+\_\+announce\+\_\+request().


\begin{DoxyCode}
257 \{
258 
259     \textcolor{keywordtype}{int} pos = \hyperlink{onion__announce_8c_ae515a6c25a90b4f27cfd4fe323b9a570}{in\_entries}(onion\_a, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key});
260 
261     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
262 
263     \textcolor{keywordflow}{if} (pos == -1) \{
264         \textcolor{keywordflow}{for} (i = 0; i < \hyperlink{onion__announce_8h_a829b434f935e7fc358b16e8fe65ea1cc}{ONION\_ANNOUNCE\_MAX\_ENTRIES}; ++
      \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
265             \textcolor{keywordflow}{if} (\hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(onion\_a->\hyperlink{struct_onion___announce_a2de468d0c9db89713f12f2e7bd984023}{entries}[i].\hyperlink{struct_onion___announce___entry_a5d34a8f2dfe25421b2b473a5fd37b0ed}{time}, 
      \hyperlink{onion__announce_8h_ae8ee10069efe2a1c61afda144ed97579}{ONION\_ANNOUNCE\_TIMEOUT}))
266                 pos = \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
267         \}
268     \}
269 
270     \textcolor{keywordflow}{if} (pos == -1) \{
271         \textcolor{keywordflow}{if} (\hyperlink{_d_h_t_8c_a903a5bc580826fe447adb841b7782333}{id\_closest}(onion\_a->\hyperlink{struct_onion___announce_a8b3d6ce8745acc52695e252bdb1531b6}{dht}->\hyperlink{struct_d_h_t_ae726df8bdc26380e5a6c3187a00d6881}{self\_public\_key}, 
      \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, onion\_a->\hyperlink{struct_onion___announce_a2de468d0c9db89713f12f2e7bd984023}{entries}[0].\hyperlink{struct_onion___announce___entry_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}) == 1)
272             pos = 0;
273     \}
274 
275     \textcolor{keywordflow}{if} (pos == -1)
276         \textcolor{keywordflow}{return} -1;
277 
278     memcpy(onion\_a->\hyperlink{struct_onion___announce_a2de468d0c9db89713f12f2e7bd984023}{entries}[pos].\hyperlink{struct_onion___announce___entry_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, 
      crypto\_box\_PUBLICKEYBYTES);
279     onion\_a->\hyperlink{struct_onion___announce_a2de468d0c9db89713f12f2e7bd984023}{entries}[pos].\hyperlink{struct_onion___announce___entry_a28f2dcc657352ee4855d05ed42e4a4af}{ret\_ip\_port} = ret\_ip\_port;
280     memcpy(onion\_a->\hyperlink{struct_onion___announce_a2de468d0c9db89713f12f2e7bd984023}{entries}[pos].\hyperlink{struct_onion___announce___entry_a860a2c4025701999e0d03f73b1863cdd}{ret}, ret, \hyperlink{onion_8h_a3a333162e7c23bebfa7554654db9374e}{ONION\_RETURN\_3});
281     memcpy(onion\_a->\hyperlink{struct_onion___announce_a2de468d0c9db89713f12f2e7bd984023}{entries}[pos].\hyperlink{struct_onion___announce___entry_add8f6d39a7818b6d3ff0fca42a0aadf4}{data\_public\_key}, data\_public\_key, 
      crypto\_box\_PUBLICKEYBYTES);
282     onion\_a->\hyperlink{struct_onion___announce_a2de468d0c9db89713f12f2e7bd984023}{entries}[pos].\hyperlink{struct_onion___announce___entry_a5d34a8f2dfe25421b2b473a5fd37b0ed}{time} = \hyperlink{util_8c_ac958d9f8847cb8039444bfa3d304233a}{unix\_time}();
283 
284     memcpy(\hyperlink{onion__announce_8c_a3551f15862efa7b58779722fe9763c45}{cmp\_public\_key}, onion\_a->\hyperlink{struct_onion___announce_a8b3d6ce8745acc52695e252bdb1531b6}{dht}->\hyperlink{struct_d_h_t_ae726df8bdc26380e5a6c3187a00d6881}{self\_public\_key}, 
      crypto\_box\_PUBLICKEYBYTES);
285     qsort(onion\_a->\hyperlink{struct_onion___announce_a2de468d0c9db89713f12f2e7bd984023}{entries}, ONION\_ANNOUNCE\_MAX\_ENTRIES, \textcolor{keyword}{sizeof}(
      \hyperlink{struct_onion___announce___entry}{Onion\_Announce\_Entry}), \hyperlink{onion__announce_8c_a8b4a60d685081d29b3b61256241acaf5}{cmp\_entry});
286     \textcolor{keywordflow}{return} \hyperlink{onion__announce_8c_ae515a6c25a90b4f27cfd4fe323b9a570}{in\_entries}(onion\_a, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key});
287 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/d75/onion__announce_8c_a8a782c6968d8bec9a92dfdd0bd32b00f_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/d75/onion__announce_8c_a8a782c6968d8bec9a92dfdd0bd32b00f_icgraph}
\end{center}
\end{figure}


\hypertarget{onion__announce_8c_a8b4a60d685081d29b3b61256241acaf5}{\index{onion\+\_\+announce.\+c@{onion\+\_\+announce.\+c}!cmp\+\_\+entry@{cmp\+\_\+entry}}
\index{cmp\+\_\+entry@{cmp\+\_\+entry}!onion\+\_\+announce.\+c@{onion\+\_\+announce.\+c}}
\subsubsection[{cmp\+\_\+entry}]{\setlength{\rightskip}{0pt plus 5cm}static int cmp\+\_\+entry (
\begin{DoxyParamCaption}
\item[{const void $\ast$}]{a, }
\item[{const void $\ast$}]{b}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{onion__announce_8c_a8b4a60d685081d29b3b61256241acaf5}


Definition at line 222 of file onion\+\_\+announce.\+c.



References cmp\+\_\+public\+\_\+key, id\+\_\+closest(), is\+\_\+timeout(), O\+N\+I\+O\+N\+\_\+\+A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T, Onion\+\_\+\+Announce\+\_\+\+Entry\+::public\+\_\+key, and Onion\+\_\+\+Announce\+\_\+\+Entry\+::time.



Referenced by add\+\_\+to\+\_\+entries().


\begin{DoxyCode}
223 \{
224     \hyperlink{struct_onion___announce___entry}{Onion\_Announce\_Entry} entry1, entry2;
225     memcpy(&entry1, a, \textcolor{keyword}{sizeof}(\hyperlink{struct_onion___announce___entry}{Onion\_Announce\_Entry}));
226     memcpy(&entry2, b, \textcolor{keyword}{sizeof}(\hyperlink{struct_onion___announce___entry}{Onion\_Announce\_Entry}));
227     \textcolor{keywordtype}{int} t1 = \hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(entry1.\hyperlink{struct_onion___announce___entry_a5d34a8f2dfe25421b2b473a5fd37b0ed}{time}, \hyperlink{onion__announce_8h_ae8ee10069efe2a1c61afda144ed97579}{ONION\_ANNOUNCE\_TIMEOUT});
228     \textcolor{keywordtype}{int} t2 = \hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(entry2.\hyperlink{struct_onion___announce___entry_a5d34a8f2dfe25421b2b473a5fd37b0ed}{time}, \hyperlink{onion__announce_8h_ae8ee10069efe2a1c61afda144ed97579}{ONION\_ANNOUNCE\_TIMEOUT});
229 
230     \textcolor{keywordflow}{if} (t1 && t2)
231         \textcolor{keywordflow}{return} 0;
232 
233     \textcolor{keywordflow}{if} (t1)
234         \textcolor{keywordflow}{return} -1;
235 
236     \textcolor{keywordflow}{if} (t2)
237         \textcolor{keywordflow}{return} 1;
238 
239     \textcolor{keywordtype}{int} close = \hyperlink{_d_h_t_8c_a903a5bc580826fe447adb841b7782333}{id\_closest}(\hyperlink{onion__announce_8c_a3551f15862efa7b58779722fe9763c45}{cmp\_public\_key}, entry1.
      \hyperlink{struct_onion___announce___entry_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, entry2.\hyperlink{struct_onion___announce___entry_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key});
240 
241     \textcolor{keywordflow}{if} (close == 1)
242         \textcolor{keywordflow}{return} 1;
243 
244     \textcolor{keywordflow}{if} (close == 2)
245         \textcolor{keywordflow}{return} -1;
246 
247     \textcolor{keywordflow}{return} 0;
248 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=335pt]{df/d75/onion__announce_8c_a8b4a60d685081d29b3b61256241acaf5_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/d75/onion__announce_8c_a8b4a60d685081d29b3b61256241acaf5_icgraph}
\end{center}
\end{figure}


\hypertarget{onion__announce_8c_ad4ee12caef533a0866e8a746041c92d8}{\index{onion\+\_\+announce.\+c@{onion\+\_\+announce.\+c}!create\+\_\+announce\+\_\+request@{create\+\_\+announce\+\_\+request}}
\index{create\+\_\+announce\+\_\+request@{create\+\_\+announce\+\_\+request}!onion\+\_\+announce.\+c@{onion\+\_\+announce.\+c}}
\subsubsection[{create\+\_\+announce\+\_\+request}]{\setlength{\rightskip}{0pt plus 5cm}int create\+\_\+announce\+\_\+request (
\begin{DoxyParamCaption}
\item[{uint8\+\_\+t $\ast$}]{packet, }
\item[{uint16\+\_\+t}]{max\+\_\+packet\+\_\+length, }
\item[{const uint8\+\_\+t $\ast$}]{dest\+\_\+client\+\_\+id, }
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key, }
\item[{const uint8\+\_\+t $\ast$}]{secret\+\_\+key, }
\item[{const uint8\+\_\+t $\ast$}]{ping\+\_\+id, }
\item[{const uint8\+\_\+t $\ast$}]{client\+\_\+id, }
\item[{const uint8\+\_\+t $\ast$}]{data\+\_\+public\+\_\+key, }
\item[{uint64\+\_\+t}]{sendback\+\_\+data}
\end{DoxyParamCaption}
)}}\label{onion__announce_8c_ad4ee12caef533a0866e8a746041c92d8}


Definition at line 50 of file onion\+\_\+announce.\+c.



References encrypt\+\_\+data(), N\+E\+T\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+R\+E\+Q\+U\+E\+S\+T, O\+N\+I\+O\+N\+\_\+\+A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+S\+I\+Z\+E, O\+N\+I\+O\+N\+\_\+\+A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+S\+E\+N\+D\+B\+A\+C\+K\+\_\+\+D\+A\+T\+A\+\_\+\+L\+E\+N\+G\+T\+H, O\+N\+I\+O\+N\+\_\+\+P\+I\+N\+G\+\_\+\+I\+D\+\_\+\+S\+I\+Z\+E, and random\+\_\+nonce().



Referenced by client\+\_\+send\+\_\+announce\+\_\+request(), and send\+\_\+announce\+\_\+request().


\begin{DoxyCode}
53 \{
54     \textcolor{keywordflow}{if} (max\_packet\_length < \hyperlink{onion__announce_8h_a561fc355e3538d55f7206dea279bb04c}{ONION\_ANNOUNCE\_REQUEST\_SIZE})
55         \textcolor{keywordflow}{return} -1;
56 
57     uint8\_t plain[\hyperlink{onion__announce_8h_a53426e5a269d092b0b862a3516549716}{ONION\_PING\_ID\_SIZE} + crypto\_box\_PUBLICKEYBYTES + 
      crypto\_box\_PUBLICKEYBYTES +
58                   \hyperlink{onion__announce_8h_ab9b62113adfb38a74f55b0688c7f306b}{ONION\_ANNOUNCE\_SENDBACK\_DATA\_LENGTH}];
59     memcpy(plain, ping\_id, \hyperlink{onion__announce_8h_a53426e5a269d092b0b862a3516549716}{ONION\_PING\_ID\_SIZE});
60     memcpy(plain + \hyperlink{onion__announce_8h_a53426e5a269d092b0b862a3516549716}{ONION\_PING\_ID\_SIZE}, client\_id, crypto\_box\_PUBLICKEYBYTES);
61     memcpy(plain + \hyperlink{onion__announce_8h_a53426e5a269d092b0b862a3516549716}{ONION\_PING\_ID\_SIZE} + crypto\_box\_PUBLICKEYBYTES, data\_public\_key, 
      crypto\_box\_PUBLICKEYBYTES);
62     memcpy(plain + \hyperlink{onion__announce_8h_a53426e5a269d092b0b862a3516549716}{ONION\_PING\_ID\_SIZE} + crypto\_box\_PUBLICKEYBYTES + 
      crypto\_box\_PUBLICKEYBYTES, &sendback\_data,
63            \textcolor{keyword}{sizeof}(sendback\_data));
64 
65     packet[0] = \hyperlink{network_8h_adf1881bdae281c7054982ee4e635e93e}{NET\_PACKET\_ANNOUNCE\_REQUEST};
66     \hyperlink{crypto__core_8c_a15ef255ab026d4881a16b99148b05dd7}{random\_nonce}(packet + 1);
67 
68     \textcolor{keywordtype}{int} len = \hyperlink{crypto__core_8c_a014149333522d211490304255e139ec3}{encrypt\_data}(dest\_client\_id, secret\_key, packet + 1, plain, \textcolor{keyword}{sizeof}(plain),
69                            packet + 1 + crypto\_box\_NONCEBYTES + crypto\_box\_PUBLICKEYBYTES);
70 
71     \textcolor{keywordflow}{if} ((uint32\_t)len + 1 + crypto\_box\_NONCEBYTES + crypto\_box\_PUBLICKEYBYTES != 
      \hyperlink{onion__announce_8h_a561fc355e3538d55f7206dea279bb04c}{ONION\_ANNOUNCE\_REQUEST\_SIZE})
72         \textcolor{keywordflow}{return} -1;
73 
74     memcpy(packet + 1 + crypto\_box\_NONCEBYTES, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, crypto\_box\_PUBLICKEYBYTES);
75 
76     \textcolor{keywordflow}{return} \hyperlink{onion__announce_8h_a561fc355e3538d55f7206dea279bb04c}{ONION\_ANNOUNCE\_REQUEST\_SIZE};
77 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/d75/onion__announce_8c_ad4ee12caef533a0866e8a746041c92d8_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/d75/onion__announce_8c_ad4ee12caef533a0866e8a746041c92d8_icgraph}
\end{center}
\end{figure}


\hypertarget{onion__announce_8c_a036c483b853b8b14de8d1e4256cc59a7}{\index{onion\+\_\+announce.\+c@{onion\+\_\+announce.\+c}!create\+\_\+data\+\_\+request@{create\+\_\+data\+\_\+request}}
\index{create\+\_\+data\+\_\+request@{create\+\_\+data\+\_\+request}!onion\+\_\+announce.\+c@{onion\+\_\+announce.\+c}}
\subsubsection[{create\+\_\+data\+\_\+request}]{\setlength{\rightskip}{0pt plus 5cm}int create\+\_\+data\+\_\+request (
\begin{DoxyParamCaption}
\item[{uint8\+\_\+t $\ast$}]{packet, }
\item[{uint16\+\_\+t}]{max\+\_\+packet\+\_\+length, }
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key, }
\item[{const uint8\+\_\+t $\ast$}]{encrypt\+\_\+public\+\_\+key, }
\item[{const uint8\+\_\+t $\ast$}]{nonce, }
\item[{const uint8\+\_\+t $\ast$}]{data, }
\item[{uint16\+\_\+t}]{length}
\end{DoxyParamCaption}
)}}\label{onion__announce_8c_a036c483b853b8b14de8d1e4256cc59a7}


Definition at line 89 of file onion\+\_\+announce.\+c.



References D\+A\+T\+A\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+M\+I\+N\+\_\+\+S\+I\+Z\+E, encrypt\+\_\+data(), N\+E\+T\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+O\+N\+I\+O\+N\+\_\+\+D\+A\+T\+A\+\_\+\+R\+E\+Q\+U\+E\+S\+T, and O\+N\+I\+O\+N\+\_\+\+M\+A\+X\+\_\+\+D\+A\+T\+A\+\_\+\+S\+I\+Z\+E.



Referenced by send\+\_\+data\+\_\+request(), and send\+\_\+onion\+\_\+data().


\begin{DoxyCode}
91 \{
92     \textcolor{keywordflow}{if} (\hyperlink{onion__announce_8c_aef1d98040750dbcb985821c88844b8c4}{DATA\_REQUEST\_MIN\_SIZE} + length > max\_packet\_length)
93         \textcolor{keywordflow}{return} -1;
94 
95     \textcolor{keywordflow}{if} ((\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int})\hyperlink{onion__announce_8c_aef1d98040750dbcb985821c88844b8c4}{DATA\_REQUEST\_MIN\_SIZE} + length > 
      \hyperlink{onion_8h_a6a19b54ee0c1699e0c6e76820efbce18}{ONION\_MAX\_DATA\_SIZE})
96         \textcolor{keywordflow}{return} -1;
97 
98     packet[0] = \hyperlink{network_8h_a481421a510d0e74f0a14180ac52213fd}{NET\_PACKET\_ONION\_DATA\_REQUEST};
99     memcpy(packet + 1, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, crypto\_box\_PUBLICKEYBYTES);
100     memcpy(packet + 1 + crypto\_box\_PUBLICKEYBYTES, \hyperlink{crypto__test_8c_a7932c523f7065073a396e571319201ce}{nonce}, crypto\_box\_NONCEBYTES);
101 
102     uint8\_t random\_public\_key[crypto\_box\_PUBLICKEYBYTES];
103     uint8\_t random\_secret\_key[crypto\_box\_SECRETKEYBYTES];
104     crypto\_box\_keypair(random\_public\_key, random\_secret\_key);
105 
106     memcpy(packet + 1 + crypto\_box\_PUBLICKEYBYTES + crypto\_box\_NONCEBYTES, random\_public\_key, 
      crypto\_box\_PUBLICKEYBYTES);
107 
108     \textcolor{keywordtype}{int} len = \hyperlink{crypto__core_8c_a014149333522d211490304255e139ec3}{encrypt\_data}(encrypt\_public\_key, random\_secret\_key, packet + 1 + 
      crypto\_box\_PUBLICKEYBYTES, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}, length,
109                            packet + 1 + crypto\_box\_PUBLICKEYBYTES + crypto\_box\_NONCEBYTES + 
      crypto\_box\_PUBLICKEYBYTES);
110 
111     \textcolor{keywordflow}{if} (1 + crypto\_box\_PUBLICKEYBYTES + crypto\_box\_NONCEBYTES + crypto\_box\_PUBLICKEYBYTES + len != 
      \hyperlink{onion__announce_8c_aef1d98040750dbcb985821c88844b8c4}{DATA\_REQUEST\_MIN\_SIZE} +
112             length)
113         \textcolor{keywordflow}{return} -1;
114 
115     \textcolor{keywordflow}{return} \hyperlink{onion__announce_8c_aef1d98040750dbcb985821c88844b8c4}{DATA\_REQUEST\_MIN\_SIZE} + length;
116 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/d75/onion__announce_8c_a036c483b853b8b14de8d1e4256cc59a7_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/d75/onion__announce_8c_a036c483b853b8b14de8d1e4256cc59a7_icgraph}
\end{center}
\end{figure}


\hypertarget{onion__announce_8c_a890184a7523e5b05c60244713ba127f2}{\index{onion\+\_\+announce.\+c@{onion\+\_\+announce.\+c}!generate\+\_\+ping\+\_\+id@{generate\+\_\+ping\+\_\+id}}
\index{generate\+\_\+ping\+\_\+id@{generate\+\_\+ping\+\_\+id}!onion\+\_\+announce.\+c@{onion\+\_\+announce.\+c}}
\subsubsection[{generate\+\_\+ping\+\_\+id}]{\setlength{\rightskip}{0pt plus 5cm}static void generate\+\_\+ping\+\_\+id (
\begin{DoxyParamCaption}
\item[{const {\bf Onion\+\_\+\+Announce} $\ast$}]{onion\+\_\+a, }
\item[{uint64\+\_\+t}]{time, }
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key, }
\item[{{\bf I\+P\+\_\+\+Port}}]{ret\+\_\+ip\+\_\+port, }
\item[{uint8\+\_\+t $\ast$}]{ping\+\_\+id}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{onion__announce_8c_a890184a7523e5b05c60244713ba127f2}


Definition at line 191 of file onion\+\_\+announce.\+c.



References crypto\+\_\+box\+\_\+\+K\+E\+Y\+B\+Y\+T\+E\+S, make-\/funny-\/savefile\+::data, P\+I\+N\+G\+\_\+\+I\+D\+\_\+\+T\+I\+M\+E\+O\+U\+T, and Onion\+\_\+\+Announce\+::secret\+\_\+bytes.



Referenced by handle\+\_\+announce\+\_\+request().


\begin{DoxyCode}
193 \{
194     time /= \hyperlink{onion__announce_8c_aa99b01f1afd2313072400ff3a506d818}{PING\_ID\_TIMEOUT};
195     uint8\_t \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[\hyperlink{crypto__core_8h_aade7cd33abc5668970c55ed009ab00c8}{crypto\_box\_KEYBYTES} + \textcolor{keyword}{sizeof}(time) + crypto\_box\_PUBLICKEYBYTES + \textcolor{keyword}{
      sizeof}(ret\_ip\_port)];
196     memcpy(data, onion\_a->\hyperlink{struct_onion___announce_ad4bfea97df71f88d6de4cbf53f301928}{secret\_bytes}, \hyperlink{crypto__core_8h_aade7cd33abc5668970c55ed009ab00c8}{crypto\_box\_KEYBYTES});
197     memcpy(data + \hyperlink{crypto__core_8h_aade7cd33abc5668970c55ed009ab00c8}{crypto\_box\_KEYBYTES}, &time, \textcolor{keyword}{sizeof}(time));
198     memcpy(data + \hyperlink{crypto__core_8h_aade7cd33abc5668970c55ed009ab00c8}{crypto\_box\_KEYBYTES} + \textcolor{keyword}{sizeof}(time), 
      \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, crypto\_box\_PUBLICKEYBYTES);
199     memcpy(data + \hyperlink{crypto__core_8h_aade7cd33abc5668970c55ed009ab00c8}{crypto\_box\_KEYBYTES} + \textcolor{keyword}{sizeof}(time) + crypto\_box\_PUBLICKEYBYTES, &
      ret\_ip\_port, \textcolor{keyword}{sizeof}(ret\_ip\_port));
200     crypto\_hash\_sha256(ping\_id, data, \textcolor{keyword}{sizeof}(data));
201 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/d75/onion__announce_8c_a890184a7523e5b05c60244713ba127f2_icgraph}
\end{center}
\end{figure}


\hypertarget{onion__announce_8c_a5cc40944c42a4e0d1d3d702cf93ac8ad}{\index{onion\+\_\+announce.\+c@{onion\+\_\+announce.\+c}!handle\+\_\+announce\+\_\+request@{handle\+\_\+announce\+\_\+request}}
\index{handle\+\_\+announce\+\_\+request@{handle\+\_\+announce\+\_\+request}!onion\+\_\+announce.\+c@{onion\+\_\+announce.\+c}}
\subsubsection[{handle\+\_\+announce\+\_\+request}]{\setlength{\rightskip}{0pt plus 5cm}static int handle\+\_\+announce\+\_\+request (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{object, }
\item[{{\bf I\+P\+\_\+\+Port}}]{source, }
\item[{const uint8\+\_\+t $\ast$}]{packet, }
\item[{uint16\+\_\+t}]{length}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{onion__announce_8c_a5cc40944c42a4e0d1d3d702cf93ac8ad}


Definition at line 289 of file onion\+\_\+announce.\+c.



References add\+\_\+to\+\_\+entries(), A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+S\+I\+Z\+E\+\_\+\+R\+E\+C\+V, make-\/funny-\/savefile\+::data, Onion\+\_\+\+Announce\+\_\+\+Entry\+::data\+\_\+public\+\_\+key, decrypt\+\_\+data\+\_\+symmetric(), Onion\+\_\+\+Announce\+::dht, encrypt\+\_\+data\+\_\+symmetric(), Onion\+\_\+\+Announce\+::entries, generate\+\_\+ping\+\_\+id(), get\+\_\+close\+\_\+nodes(), get\+\_\+shared\+\_\+key(), in\+\_\+entries(), I\+P\+\_\+\+Port\+::ip, L\+A\+N\+\_\+ip(), M\+A\+X\+\_\+\+S\+E\+N\+T\+\_\+\+N\+O\+D\+E\+S, Onion\+\_\+\+Announce\+::net, N\+E\+T\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+R\+E\+S\+P\+O\+N\+S\+E, nonce, O\+N\+I\+O\+N\+\_\+\+A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+R\+E\+S\+P\+O\+N\+S\+E\+\_\+\+M\+A\+X\+\_\+\+S\+I\+Z\+E, O\+N\+I\+O\+N\+\_\+\+A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+S\+E\+N\+D\+B\+A\+C\+K\+\_\+\+D\+A\+T\+A\+\_\+\+L\+E\+N\+G\+T\+H, O\+N\+I\+O\+N\+\_\+\+P\+I\+N\+G\+\_\+\+I\+D\+\_\+\+S\+I\+Z\+E, O\+N\+I\+O\+N\+\_\+\+R\+E\+T\+U\+R\+N\+\_\+3, pack\+\_\+nodes(), P\+I\+N\+G\+\_\+\+I\+D\+\_\+\+T\+I\+M\+E\+O\+U\+T, Onion\+\_\+\+Announce\+\_\+\+Entry\+::public\+\_\+key, random\+\_\+nonce(), D\+H\+T\+::self\+\_\+secret\+\_\+key, send\+\_\+onion\+\_\+response(), Onion\+\_\+\+Announce\+::shared\+\_\+keys\+\_\+recv, and unix\+\_\+time().



Referenced by new\+\_\+onion\+\_\+announce().


\begin{DoxyCode}
290 \{
291     \hyperlink{struct_onion___announce}{Onion\_Announce} *onion\_a = object;
292 
293     \textcolor{keywordflow}{if} (length != \hyperlink{onion__announce_8c_aa4bbc416c612b8eb58c4ad4975c7fcc0}{ANNOUNCE\_REQUEST\_SIZE\_RECV})
294         \textcolor{keywordflow}{return} 1;
295 
296     \textcolor{keyword}{const} uint8\_t *packet\_public\_key = packet + 1 + crypto\_box\_NONCEBYTES;
297     uint8\_t shared\_key[crypto\_box\_BEFORENMBYTES];
298     \hyperlink{_d_h_t_8c_a6cd4aa89d7bfcf6805c5ce6b273d9e9e}{get\_shared\_key}(&onion\_a->\hyperlink{struct_onion___announce_a4c647e235c4b9d2d6d68d760c7cb1b30}{shared\_keys\_recv}, shared\_key, onion\_a->
      \hyperlink{struct_onion___announce_a8b3d6ce8745acc52695e252bdb1531b6}{dht}->\hyperlink{struct_d_h_t_aa05050f86513ff53fe9da81f73c72267}{self\_secret\_key}, packet\_public\_key);
299 
300     uint8\_t plain[\hyperlink{onion__announce_8h_a53426e5a269d092b0b862a3516549716}{ONION\_PING\_ID\_SIZE} + crypto\_box\_PUBLICKEYBYTES + 
      crypto\_box\_PUBLICKEYBYTES +
301                   \hyperlink{onion__announce_8h_ab9b62113adfb38a74f55b0688c7f306b}{ONION\_ANNOUNCE\_SENDBACK\_DATA\_LENGTH}];
302     \textcolor{keywordtype}{int} len = \hyperlink{crypto__core_8c_a824b257fcff74b9d17c5247223fbed29}{decrypt\_data\_symmetric}(shared\_key, packet + 1, packet + 1 + 
      crypto\_box\_NONCEBYTES + crypto\_box\_PUBLICKEYBYTES,
303                                      \hyperlink{onion__announce_8h_a53426e5a269d092b0b862a3516549716}{ONION\_PING\_ID\_SIZE} + crypto\_box\_PUBLICKEYBYTES + 
      crypto\_box\_PUBLICKEYBYTES + \hyperlink{onion__announce_8h_ab9b62113adfb38a74f55b0688c7f306b}{ONION\_ANNOUNCE\_SENDBACK\_DATA\_LENGTH} +
304                                      crypto\_box\_MACBYTES, plain);
305 
306     \textcolor{keywordflow}{if} ((uint32\_t)len != \textcolor{keyword}{sizeof}(plain))
307         \textcolor{keywordflow}{return} 1;
308 
309     uint8\_t ping\_id1[\hyperlink{onion__announce_8h_a53426e5a269d092b0b862a3516549716}{ONION\_PING\_ID\_SIZE}];
310     \hyperlink{onion__announce_8c_a890184a7523e5b05c60244713ba127f2}{generate\_ping\_id}(onion\_a, \hyperlink{util_8c_ac958d9f8847cb8039444bfa3d304233a}{unix\_time}(), packet\_public\_key, source, ping\_id1);
311 
312     uint8\_t ping\_id2[\hyperlink{onion__announce_8h_a53426e5a269d092b0b862a3516549716}{ONION\_PING\_ID\_SIZE}];
313     \hyperlink{onion__announce_8c_a890184a7523e5b05c60244713ba127f2}{generate\_ping\_id}(onion\_a, \hyperlink{util_8c_ac958d9f8847cb8039444bfa3d304233a}{unix\_time}() + 
      \hyperlink{onion__announce_8c_aa99b01f1afd2313072400ff3a506d818}{PING\_ID\_TIMEOUT}, packet\_public\_key, source, ping\_id2);
314 
315     \textcolor{keywordtype}{int} index = -1;
316 
317     uint8\_t *data\_public\_key = plain + \hyperlink{onion__announce_8h_a53426e5a269d092b0b862a3516549716}{ONION\_PING\_ID\_SIZE} + crypto\_box\_PUBLICKEYBYTES;
318 
319     \textcolor{keywordflow}{if} (memcmp(ping\_id1, plain, \hyperlink{onion__announce_8h_a53426e5a269d092b0b862a3516549716}{ONION\_PING\_ID\_SIZE}) == 0 || memcmp(ping\_id2, plain, 
      \hyperlink{onion__announce_8h_a53426e5a269d092b0b862a3516549716}{ONION\_PING\_ID\_SIZE}) == 0) \{
320         index = \hyperlink{onion__announce_8c_a8a782c6968d8bec9a92dfdd0bd32b00f}{add\_to\_entries}(onion\_a, source, packet\_public\_key, data\_public\_key,
321                                packet + (\hyperlink{onion__announce_8c_aa4bbc416c612b8eb58c4ad4975c7fcc0}{ANNOUNCE\_REQUEST\_SIZE\_RECV} - 
      \hyperlink{onion_8h_a3a333162e7c23bebfa7554654db9374e}{ONION\_RETURN\_3}));
322     \} \textcolor{keywordflow}{else} \{
323         index = \hyperlink{onion__announce_8c_ae515a6c25a90b4f27cfd4fe323b9a570}{in\_entries}(onion\_a, plain + \hyperlink{onion__announce_8h_a53426e5a269d092b0b862a3516549716}{ONION\_PING\_ID\_SIZE});
324     \}
325 
326     \textcolor{comment}{/*Respond with a announce response packet*/}
327     \hyperlink{struct_node__format}{Node\_format} nodes\_list[\hyperlink{_d_h_t_8h_a57f4cf16e79a384d7d59a3cc585ea5a3}{MAX\_SENT\_NODES}];
328     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} num\_nodes = \hyperlink{_d_h_t_8c_a8abfc9cea3784b0cae354670bd4643cd}{get\_close\_nodes}(onion\_a->\hyperlink{struct_onion___announce_a8b3d6ce8745acc52695e252bdb1531b6}{dht}, plain + 
      \hyperlink{onion__announce_8h_a53426e5a269d092b0b862a3516549716}{ONION\_PING\_ID\_SIZE}, nodes\_list, 0,
329                              \hyperlink{_l_a_n__discovery_8c_a2d80a53390598eb8ededbc63f4e9c152}{LAN\_ip}(source.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}) == 0, 1);
330     uint8\_t \hyperlink{crypto__test_8c_a7932c523f7065073a396e571319201ce}{nonce}[crypto\_box\_NONCEBYTES];
331     \hyperlink{crypto__core_8c_a15ef255ab026d4881a16b99148b05dd7}{random\_nonce}(nonce);
332 
333     uint8\_t pl[1 + \hyperlink{onion__announce_8h_a53426e5a269d092b0b862a3516549716}{ONION\_PING\_ID\_SIZE} + \textcolor{keyword}{sizeof}(nodes\_list)];
334 
335     \textcolor{keywordflow}{if} (index == -1) \{
336         pl[0] = 0;
337         memcpy(pl + 1, ping\_id2, \hyperlink{onion__announce_8h_a53426e5a269d092b0b862a3516549716}{ONION\_PING\_ID\_SIZE});
338     \} \textcolor{keywordflow}{else} \{
339         \textcolor{keywordflow}{if} (memcmp(onion\_a->\hyperlink{struct_onion___announce_a2de468d0c9db89713f12f2e7bd984023}{entries}[index].\hyperlink{struct_onion___announce___entry_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, packet\_public\_key, 
      crypto\_box\_PUBLICKEYBYTES) == 0) \{
340             \textcolor{keywordflow}{if} (memcmp(onion\_a->\hyperlink{struct_onion___announce_a2de468d0c9db89713f12f2e7bd984023}{entries}[index].\hyperlink{struct_onion___announce___entry_add8f6d39a7818b6d3ff0fca42a0aadf4}{data\_public\_key}, data\_public\_key, 
      crypto\_box\_PUBLICKEYBYTES) != 0) \{
341                 pl[0] = 0;
342                 memcpy(pl + 1, ping\_id2, \hyperlink{onion__announce_8h_a53426e5a269d092b0b862a3516549716}{ONION\_PING\_ID\_SIZE});
343             \} \textcolor{keywordflow}{else} \{
344                 pl[0] = 2;
345                 memcpy(pl + 1, ping\_id2, \hyperlink{onion__announce_8h_a53426e5a269d092b0b862a3516549716}{ONION\_PING\_ID\_SIZE});
346             \}
347         \} \textcolor{keywordflow}{else} \{
348             pl[0] = 1;
349             memcpy(pl + 1, onion\_a->\hyperlink{struct_onion___announce_a2de468d0c9db89713f12f2e7bd984023}{entries}[index].\hyperlink{struct_onion___announce___entry_add8f6d39a7818b6d3ff0fca42a0aadf4}{data\_public\_key}, 
      crypto\_box\_PUBLICKEYBYTES);
350         \}
351     \}
352 
353     \textcolor{keywordtype}{int} nodes\_length = 0;
354 
355     \textcolor{keywordflow}{if} (num\_nodes != 0) \{
356         nodes\_length = \hyperlink{_d_h_t_8c_a1d6f2fcb008c989f333ae89e840f94b4}{pack\_nodes}(pl + 1 + \hyperlink{onion__announce_8h_a53426e5a269d092b0b862a3516549716}{ONION\_PING\_ID\_SIZE}, \textcolor{keyword}{sizeof}(
      nodes\_list), nodes\_list, num\_nodes);
357 
358         \textcolor{keywordflow}{if} (nodes\_length <= 0)
359             \textcolor{keywordflow}{return} 1;
360     \}
361 
362     uint8\_t \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[\hyperlink{onion__announce_8h_ab13ab0a532ac4dbc33d3e927f7a86aff}{ONION\_ANNOUNCE\_RESPONSE\_MAX\_SIZE}];
363     len = \hyperlink{crypto__core_8c_a81efc0a4a6e0efe372651e26e342a6e5}{encrypt\_data\_symmetric}(shared\_key, nonce, pl, 1 + 
      \hyperlink{onion__announce_8h_a53426e5a269d092b0b862a3516549716}{ONION\_PING\_ID\_SIZE} + nodes\_length,
364                                  data + 1 + \hyperlink{onion__announce_8h_ab9b62113adfb38a74f55b0688c7f306b}{ONION\_ANNOUNCE\_SENDBACK\_DATA\_LENGTH}
       + crypto\_box\_NONCEBYTES);
365 
366     \textcolor{keywordflow}{if} (len != 1 + \hyperlink{onion__announce_8h_a53426e5a269d092b0b862a3516549716}{ONION\_PING\_ID\_SIZE} + nodes\_length + crypto\_box\_MACBYTES)
367         \textcolor{keywordflow}{return} 1;
368 
369     data[0] = \hyperlink{network_8h_af56fecaf9aa0b3c4741474e20d0ec43d}{NET\_PACKET\_ANNOUNCE\_RESPONSE};
370     memcpy(data + 1, plain + \hyperlink{onion__announce_8h_a53426e5a269d092b0b862a3516549716}{ONION\_PING\_ID\_SIZE} + crypto\_box\_PUBLICKEYBYTES + 
      crypto\_box\_PUBLICKEYBYTES,
371            \hyperlink{onion__announce_8h_ab9b62113adfb38a74f55b0688c7f306b}{ONION\_ANNOUNCE\_SENDBACK\_DATA\_LENGTH});
372     memcpy(data + 1 + \hyperlink{onion__announce_8h_ab9b62113adfb38a74f55b0688c7f306b}{ONION\_ANNOUNCE\_SENDBACK\_DATA\_LENGTH}, nonce, 
      crypto\_box\_NONCEBYTES);
373 
374     \textcolor{keywordflow}{if} (\hyperlink{onion_8c_a8d81f915fcff64bfe2508296d325f7d4}{send\_onion\_response}(onion\_a->\hyperlink{struct_onion___announce_aa14ea2f67950f57fe4235d7375a2216c}{net}, source, data,
375                             1 + \hyperlink{onion__announce_8h_ab9b62113adfb38a74f55b0688c7f306b}{ONION\_ANNOUNCE\_SENDBACK\_DATA\_LENGTH} + 
      crypto\_box\_NONCEBYTES + len,
376                             packet + (\hyperlink{onion__announce_8c_aa4bbc416c612b8eb58c4ad4975c7fcc0}{ANNOUNCE\_REQUEST\_SIZE\_RECV} - 
      \hyperlink{onion_8h_a3a333162e7c23bebfa7554654db9374e}{ONION\_RETURN\_3})) == -1)
377         \textcolor{keywordflow}{return} 1;
378 
379     \textcolor{keywordflow}{return} 0;
380 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/d75/onion__announce_8c_a5cc40944c42a4e0d1d3d702cf93ac8ad_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/d75/onion__announce_8c_a5cc40944c42a4e0d1d3d702cf93ac8ad_icgraph}
\end{center}
\end{figure}


\hypertarget{onion__announce_8c_a938e61f5184d72e920e81cab7dc8056a}{\index{onion\+\_\+announce.\+c@{onion\+\_\+announce.\+c}!handle\+\_\+data\+\_\+request@{handle\+\_\+data\+\_\+request}}
\index{handle\+\_\+data\+\_\+request@{handle\+\_\+data\+\_\+request}!onion\+\_\+announce.\+c@{onion\+\_\+announce.\+c}}
\subsubsection[{handle\+\_\+data\+\_\+request}]{\setlength{\rightskip}{0pt plus 5cm}static int handle\+\_\+data\+\_\+request (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{object, }
\item[{{\bf I\+P\+\_\+\+Port}}]{source, }
\item[{const uint8\+\_\+t $\ast$}]{packet, }
\item[{uint16\+\_\+t}]{length}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{onion__announce_8c_a938e61f5184d72e920e81cab7dc8056a}


Definition at line 382 of file onion\+\_\+announce.\+c.



References make-\/funny-\/savefile\+::data, D\+A\+T\+A\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+M\+I\+N\+\_\+\+S\+I\+Z\+E\+\_\+\+R\+E\+C\+V, Onion\+\_\+\+Announce\+::entries, in\+\_\+entries(), Onion\+\_\+\+Announce\+::net, N\+E\+T\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+O\+N\+I\+O\+N\+\_\+\+D\+A\+T\+A\+\_\+\+R\+E\+S\+P\+O\+N\+S\+E, O\+N\+I\+O\+N\+\_\+\+M\+A\+X\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+S\+I\+Z\+E, O\+N\+I\+O\+N\+\_\+\+R\+E\+T\+U\+R\+N\+\_\+3, Onion\+\_\+\+Announce\+\_\+\+Entry\+::ret, Onion\+\_\+\+Announce\+\_\+\+Entry\+::ret\+\_\+ip\+\_\+port, and send\+\_\+onion\+\_\+response().



Referenced by new\+\_\+onion\+\_\+announce().


\begin{DoxyCode}
383 \{
384     \hyperlink{struct_onion___announce}{Onion\_Announce} *onion\_a = object;
385 
386     \textcolor{keywordflow}{if} (length <= \hyperlink{onion__announce_8c_a145e1d8cd3a09780f45c770d88660c47}{DATA\_REQUEST\_MIN\_SIZE\_RECV})
387         \textcolor{keywordflow}{return} 1;
388 
389     \textcolor{keywordflow}{if} (length > \hyperlink{onion_8h_a48fdc4b34dbecf0a3417a557b83a4ff4}{ONION\_MAX\_PACKET\_SIZE})
390         \textcolor{keywordflow}{return} 1;
391 
392     \textcolor{keywordtype}{int} index = \hyperlink{onion__announce_8c_ae515a6c25a90b4f27cfd4fe323b9a570}{in\_entries}(onion\_a, packet + 1);
393 
394     \textcolor{keywordflow}{if} (index == -1)
395         \textcolor{keywordflow}{return} 1;
396 
397     uint8\_t \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[length - (crypto\_box\_PUBLICKEYBYTES + \hyperlink{onion_8h_a3a333162e7c23bebfa7554654db9374e}{ONION\_RETURN\_3})];
398     \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[0] = \hyperlink{network_8h_acc89dafa34d1a75935fb4cdef938d424}{NET\_PACKET\_ONION\_DATA\_RESPONSE};
399     memcpy(data + 1, packet + 1 + crypto\_box\_PUBLICKEYBYTES, length - (1 + crypto\_box\_PUBLICKEYBYTES + 
      \hyperlink{onion_8h_a3a333162e7c23bebfa7554654db9374e}{ONION\_RETURN\_3}));
400 
401     \textcolor{keywordflow}{if} (\hyperlink{onion_8c_a8d81f915fcff64bfe2508296d325f7d4}{send\_onion\_response}(onion\_a->\hyperlink{struct_onion___announce_aa14ea2f67950f57fe4235d7375a2216c}{net}, onion\_a->\hyperlink{struct_onion___announce_a2de468d0c9db89713f12f2e7bd984023}{entries}[index].
      \hyperlink{struct_onion___announce___entry_a28f2dcc657352ee4855d05ed42e4a4af}{ret\_ip\_port}, data, \textcolor{keyword}{sizeof}(data),
402                             onion\_a->\hyperlink{struct_onion___announce_a2de468d0c9db89713f12f2e7bd984023}{entries}[index].\hyperlink{struct_onion___announce___entry_a860a2c4025701999e0d03f73b1863cdd}{ret}) == -1)
403         \textcolor{keywordflow}{return} 1;
404 
405     \textcolor{keywordflow}{return} 0;
406 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/d75/onion__announce_8c_a938e61f5184d72e920e81cab7dc8056a_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/d75/onion__announce_8c_a938e61f5184d72e920e81cab7dc8056a_icgraph}
\end{center}
\end{figure}


\hypertarget{onion__announce_8c_ae515a6c25a90b4f27cfd4fe323b9a570}{\index{onion\+\_\+announce.\+c@{onion\+\_\+announce.\+c}!in\+\_\+entries@{in\+\_\+entries}}
\index{in\+\_\+entries@{in\+\_\+entries}!onion\+\_\+announce.\+c@{onion\+\_\+announce.\+c}}
\subsubsection[{in\+\_\+entries}]{\setlength{\rightskip}{0pt plus 5cm}static int in\+\_\+entries (
\begin{DoxyParamCaption}
\item[{const {\bf Onion\+\_\+\+Announce} $\ast$}]{onion\+\_\+a, }
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{onion__announce_8c_ae515a6c25a90b4f27cfd4fe323b9a570}


Definition at line 208 of file onion\+\_\+announce.\+c.



References Onion\+\_\+\+Announce\+::entries, i, is\+\_\+timeout(), O\+N\+I\+O\+N\+\_\+\+A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+M\+A\+X\+\_\+\+E\+N\+T\+R\+I\+E\+S, O\+N\+I\+O\+N\+\_\+\+A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T, Onion\+\_\+\+Announce\+\_\+\+Entry\+::public\+\_\+key, and Onion\+\_\+\+Announce\+\_\+\+Entry\+::time.



Referenced by add\+\_\+to\+\_\+entries(), handle\+\_\+announce\+\_\+request(), and handle\+\_\+data\+\_\+request().


\begin{DoxyCode}
209 \{
210     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
211 
212     \textcolor{keywordflow}{for} (i = 0; i < \hyperlink{onion__announce_8h_a829b434f935e7fc358b16e8fe65ea1cc}{ONION\_ANNOUNCE\_MAX\_ENTRIES}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
213         \textcolor{keywordflow}{if} (!\hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(onion\_a->\hyperlink{struct_onion___announce_a2de468d0c9db89713f12f2e7bd984023}{entries}[i].\hyperlink{struct_onion___announce___entry_a5d34a8f2dfe25421b2b473a5fd37b0ed}{time}, 
      \hyperlink{onion__announce_8h_ae8ee10069efe2a1c61afda144ed97579}{ONION\_ANNOUNCE\_TIMEOUT})
214                 && memcmp(onion\_a->\hyperlink{struct_onion___announce_a2de468d0c9db89713f12f2e7bd984023}{entries}[i].\hyperlink{struct_onion___announce___entry_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, 
      \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, crypto\_box\_PUBLICKEYBYTES) == 0)
215             \textcolor{keywordflow}{return} \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
216     \}
217 
218     \textcolor{keywordflow}{return} -1;
219 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=332pt]{df/d75/onion__announce_8c_ae515a6c25a90b4f27cfd4fe323b9a570_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/d75/onion__announce_8c_ae515a6c25a90b4f27cfd4fe323b9a570_icgraph}
\end{center}
\end{figure}


\hypertarget{onion__announce_8c_ad21ecb14ae7a2a0d11a1d0523a459146}{\index{onion\+\_\+announce.\+c@{onion\+\_\+announce.\+c}!kill\+\_\+onion\+\_\+announce@{kill\+\_\+onion\+\_\+announce}}
\index{kill\+\_\+onion\+\_\+announce@{kill\+\_\+onion\+\_\+announce}!onion\+\_\+announce.\+c@{onion\+\_\+announce.\+c}}
\subsubsection[{kill\+\_\+onion\+\_\+announce}]{\setlength{\rightskip}{0pt plus 5cm}void kill\+\_\+onion\+\_\+announce (
\begin{DoxyParamCaption}
\item[{{\bf Onion\+\_\+\+Announce} $\ast$}]{onion\+\_\+a}
\end{DoxyParamCaption}
)}}\label{onion__announce_8c_ad21ecb14ae7a2a0d11a1d0523a459146}


Definition at line 428 of file onion\+\_\+announce.\+c.



References Onion\+\_\+\+Announce\+::net, N\+E\+T\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+R\+E\+Q\+U\+E\+S\+T, N\+E\+T\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+O\+N\+I\+O\+N\+\_\+\+D\+A\+T\+A\+\_\+\+R\+E\+Q\+U\+E\+S\+T, and networking\+\_\+registerhandler().



Referenced by kill\+\_\+messenger(), kill\+\_\+onions(), new\+\_\+messenger(), and S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T().


\begin{DoxyCode}
429 \{
430     \textcolor{keywordflow}{if} (onion\_a == NULL)
431         \textcolor{keywordflow}{return};
432 
433     \hyperlink{network_8c_a230a192ca9463ec4985d4f86de439733}{networking\_registerhandler}(onion\_a->\hyperlink{struct_onion___announce_aa14ea2f67950f57fe4235d7375a2216c}{net}, 
      \hyperlink{network_8h_adf1881bdae281c7054982ee4e635e93e}{NET\_PACKET\_ANNOUNCE\_REQUEST}, NULL, NULL);
434     \hyperlink{network_8c_a230a192ca9463ec4985d4f86de439733}{networking\_registerhandler}(onion\_a->\hyperlink{struct_onion___announce_aa14ea2f67950f57fe4235d7375a2216c}{net}, 
      \hyperlink{network_8h_a481421a510d0e74f0a14180ac52213fd}{NET\_PACKET\_ONION\_DATA\_REQUEST}, NULL, NULL);
435     free(onion\_a);
436 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/d75/onion__announce_8c_ad21ecb14ae7a2a0d11a1d0523a459146_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/d75/onion__announce_8c_ad21ecb14ae7a2a0d11a1d0523a459146_icgraph}
\end{center}
\end{figure}


\hypertarget{onion__announce_8c_a1807a1d99b93e29c2a27648afe3e6c2c}{\index{onion\+\_\+announce.\+c@{onion\+\_\+announce.\+c}!new\+\_\+onion\+\_\+announce@{new\+\_\+onion\+\_\+announce}}
\index{new\+\_\+onion\+\_\+announce@{new\+\_\+onion\+\_\+announce}!onion\+\_\+announce.\+c@{onion\+\_\+announce.\+c}}
\subsubsection[{new\+\_\+onion\+\_\+announce}]{\setlength{\rightskip}{0pt plus 5cm}{\bf Onion\+\_\+\+Announce}$\ast$ new\+\_\+onion\+\_\+announce (
\begin{DoxyParamCaption}
\item[{{\bf D\+H\+T} $\ast$}]{dht}
\end{DoxyParamCaption}
)}}\label{onion__announce_8c_a1807a1d99b93e29c2a27648afe3e6c2c}


Definition at line 408 of file onion\+\_\+announce.\+c.



References Onion\+\_\+\+Announce\+::dht, handle\+\_\+announce\+\_\+request(), handle\+\_\+data\+\_\+request(), Onion\+\_\+\+Announce\+::net, D\+H\+T\+::net, N\+E\+T\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+R\+E\+Q\+U\+E\+S\+T, N\+E\+T\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+O\+N\+I\+O\+N\+\_\+\+D\+A\+T\+A\+\_\+\+R\+E\+Q\+U\+E\+S\+T, networking\+\_\+registerhandler(), new\+\_\+symmetric\+\_\+key(), and Onion\+\_\+\+Announce\+::secret\+\_\+bytes.



Referenced by main(), new\+\_\+messenger(), new\+\_\+onions(), and S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T().


\begin{DoxyCode}
409 \{
410     \textcolor{keywordflow}{if} (dht == NULL)
411         \textcolor{keywordflow}{return} NULL;
412 
413     \hyperlink{struct_onion___announce}{Onion\_Announce} *onion\_a = calloc(1, \textcolor{keyword}{sizeof}(\hyperlink{struct_onion___announce}{Onion\_Announce}));
414 
415     \textcolor{keywordflow}{if} (onion\_a == NULL)
416         \textcolor{keywordflow}{return} NULL;
417 
418     onion\_a->\hyperlink{struct_onion___announce_a8b3d6ce8745acc52695e252bdb1531b6}{dht} = dht;
419     onion\_a->\hyperlink{struct_onion___announce_aa14ea2f67950f57fe4235d7375a2216c}{net} = dht->\hyperlink{struct_d_h_t_aa14ea2f67950f57fe4235d7375a2216c}{net};
420     \hyperlink{crypto__core_8c_a89b4a1a4a7d8bfabdf0e1b60f074e531}{new\_symmetric\_key}(onion\_a->\hyperlink{struct_onion___announce_ad4bfea97df71f88d6de4cbf53f301928}{secret\_bytes});
421 
422     \hyperlink{network_8c_a230a192ca9463ec4985d4f86de439733}{networking\_registerhandler}(onion\_a->\hyperlink{struct_onion___announce_aa14ea2f67950f57fe4235d7375a2216c}{net}, 
      \hyperlink{network_8h_adf1881bdae281c7054982ee4e635e93e}{NET\_PACKET\_ANNOUNCE\_REQUEST}, &\hyperlink{onion__announce_8c_a5cc40944c42a4e0d1d3d702cf93ac8ad}{handle\_announce\_request}, 
      onion\_a);
423     \hyperlink{network_8c_a230a192ca9463ec4985d4f86de439733}{networking\_registerhandler}(onion\_a->\hyperlink{struct_onion___announce_aa14ea2f67950f57fe4235d7375a2216c}{net}, 
      \hyperlink{network_8h_a481421a510d0e74f0a14180ac52213fd}{NET\_PACKET\_ONION\_DATA\_REQUEST}, &\hyperlink{onion__announce_8c_a938e61f5184d72e920e81cab7dc8056a}{handle\_data\_request}, 
      onion\_a);
424 
425     \textcolor{keywordflow}{return} onion\_a;
426 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/d75/onion__announce_8c_a1807a1d99b93e29c2a27648afe3e6c2c_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/d75/onion__announce_8c_a1807a1d99b93e29c2a27648afe3e6c2c_icgraph}
\end{center}
\end{figure}


\hypertarget{onion__announce_8c_adf4563e859323282731b183ef62cfbcc}{\index{onion\+\_\+announce.\+c@{onion\+\_\+announce.\+c}!send\+\_\+announce\+\_\+request@{send\+\_\+announce\+\_\+request}}
\index{send\+\_\+announce\+\_\+request@{send\+\_\+announce\+\_\+request}!onion\+\_\+announce.\+c@{onion\+\_\+announce.\+c}}
\subsubsection[{send\+\_\+announce\+\_\+request}]{\setlength{\rightskip}{0pt plus 5cm}int send\+\_\+announce\+\_\+request (
\begin{DoxyParamCaption}
\item[{{\bf Networking\+\_\+\+Core} $\ast$}]{net, }
\item[{const {\bf Onion\+\_\+\+Path} $\ast$}]{path, }
\item[{{\bf Node\+\_\+format}}]{dest, }
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key, }
\item[{const uint8\+\_\+t $\ast$}]{secret\+\_\+key, }
\item[{const uint8\+\_\+t $\ast$}]{ping\+\_\+id, }
\item[{const uint8\+\_\+t $\ast$}]{client\+\_\+id, }
\item[{const uint8\+\_\+t $\ast$}]{data\+\_\+public\+\_\+key, }
\item[{uint64\+\_\+t}]{sendback\+\_\+data}
\end{DoxyParamCaption}
)}}\label{onion__announce_8c_adf4563e859323282731b183ef62cfbcc}


Definition at line 132 of file onion\+\_\+announce.\+c.



References create\+\_\+announce\+\_\+request(), create\+\_\+onion\+\_\+packet(), Node\+\_\+format\+::ip\+\_\+port, Onion\+\_\+\+Path\+::ip\+\_\+port1, O\+N\+I\+O\+N\+\_\+\+A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+S\+I\+Z\+E, O\+N\+I\+O\+N\+\_\+\+M\+A\+X\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+S\+I\+Z\+E, Node\+\_\+format\+::public\+\_\+key, and sendpacket().



Referenced by S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T().


\begin{DoxyCode}
135 \{
136     uint8\_t request[\hyperlink{onion__announce_8h_a561fc355e3538d55f7206dea279bb04c}{ONION\_ANNOUNCE\_REQUEST\_SIZE}];
137     \textcolor{keywordtype}{int} len = \hyperlink{onion__announce_8c_ad4ee12caef533a0866e8a746041c92d8}{create\_announce\_request}(request, \textcolor{keyword}{sizeof}(request), dest.
      \hyperlink{struct_node__format_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, secret\_key, ping\_id, client\_id,
138                                       data\_public\_key, sendback\_data);
139 
140     \textcolor{keywordflow}{if} (len != \textcolor{keyword}{sizeof}(request))
141         \textcolor{keywordflow}{return} -1;
142 
143     uint8\_t packet[\hyperlink{onion_8h_a48fdc4b34dbecf0a3417a557b83a4ff4}{ONION\_MAX\_PACKET\_SIZE}];
144     len = \hyperlink{onion_8c_a34cf7934690ab5336b99844383a445a8}{create\_onion\_packet}(packet, \textcolor{keyword}{sizeof}(packet), path, dest.
      \hyperlink{struct_node__format_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}, request, \textcolor{keyword}{sizeof}(request));
145 
146     \textcolor{keywordflow}{if} (len == -1)
147         \textcolor{keywordflow}{return} -1;
148 
149     \textcolor{keywordflow}{if} (\hyperlink{network_8c_a7b90f87f3ba60cc5c66dd6dd77cd5cb1}{sendpacket}(net, path->\hyperlink{struct_onion___path_ad7670c0a1a9d05b2a807a9c1a7950b79}{ip\_port1}, packet, len) != len)
150         \textcolor{keywordflow}{return} -1;
151 
152     \textcolor{keywordflow}{return} 0;
153 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/d75/onion__announce_8c_adf4563e859323282731b183ef62cfbcc_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=318pt]{df/d75/onion__announce_8c_adf4563e859323282731b183ef62cfbcc_icgraph}
\end{center}
\end{figure}


\hypertarget{onion__announce_8c_a16a4948e44b16b56b9c0de61d2988082}{\index{onion\+\_\+announce.\+c@{onion\+\_\+announce.\+c}!send\+\_\+data\+\_\+request@{send\+\_\+data\+\_\+request}}
\index{send\+\_\+data\+\_\+request@{send\+\_\+data\+\_\+request}!onion\+\_\+announce.\+c@{onion\+\_\+announce.\+c}}
\subsubsection[{send\+\_\+data\+\_\+request}]{\setlength{\rightskip}{0pt plus 5cm}int send\+\_\+data\+\_\+request (
\begin{DoxyParamCaption}
\item[{{\bf Networking\+\_\+\+Core} $\ast$}]{net, }
\item[{const {\bf Onion\+\_\+\+Path} $\ast$}]{path, }
\item[{{\bf I\+P\+\_\+\+Port}}]{dest, }
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key, }
\item[{const uint8\+\_\+t $\ast$}]{encrypt\+\_\+public\+\_\+key, }
\item[{const uint8\+\_\+t $\ast$}]{nonce, }
\item[{const uint8\+\_\+t $\ast$}]{data, }
\item[{uint16\+\_\+t}]{length}
\end{DoxyParamCaption}
)}}\label{onion__announce_8c_a16a4948e44b16b56b9c0de61d2988082}


Definition at line 169 of file onion\+\_\+announce.\+c.



References create\+\_\+data\+\_\+request(), create\+\_\+onion\+\_\+packet(), Onion\+\_\+\+Path\+::ip\+\_\+port1, O\+N\+I\+O\+N\+\_\+\+M\+A\+X\+\_\+\+D\+A\+T\+A\+\_\+\+S\+I\+Z\+E, O\+N\+I\+O\+N\+\_\+\+M\+A\+X\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+S\+I\+Z\+E, and sendpacket().



Referenced by S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T().


\begin{DoxyCode}
171 \{
172     uint8\_t request[\hyperlink{onion_8h_a6a19b54ee0c1699e0c6e76820efbce18}{ONION\_MAX\_DATA\_SIZE}];
173     \textcolor{keywordtype}{int} len = \hyperlink{onion__announce_8c_a036c483b853b8b14de8d1e4256cc59a7}{create\_data\_request}(request, \textcolor{keyword}{sizeof}(request), 
      \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, encrypt\_public\_key, \hyperlink{crypto__test_8c_a7932c523f7065073a396e571319201ce}{nonce}, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}, length);
174 
175     \textcolor{keywordflow}{if} (len == -1)
176         \textcolor{keywordflow}{return} -1;
177 
178     uint8\_t packet[\hyperlink{onion_8h_a48fdc4b34dbecf0a3417a557b83a4ff4}{ONION\_MAX\_PACKET\_SIZE}];
179     len = \hyperlink{onion_8c_a34cf7934690ab5336b99844383a445a8}{create\_onion\_packet}(packet, \textcolor{keyword}{sizeof}(packet), path, dest, request, len);
180 
181     \textcolor{keywordflow}{if} (len == -1)
182         \textcolor{keywordflow}{return} -1;
183 
184     \textcolor{keywordflow}{if} (\hyperlink{network_8c_a7b90f87f3ba60cc5c66dd6dd77cd5cb1}{sendpacket}(net, path->\hyperlink{struct_onion___path_ad7670c0a1a9d05b2a807a9c1a7950b79}{ip\_port1}, packet, len) != len)
185         \textcolor{keywordflow}{return} -1;
186 
187     \textcolor{keywordflow}{return} 0;
188 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/d75/onion__announce_8c_a16a4948e44b16b56b9c0de61d2988082_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=295pt]{df/d75/onion__announce_8c_a16a4948e44b16b56b9c0de61d2988082_icgraph}
\end{center}
\end{figure}




\subsection{Variable Documentation}
\hypertarget{onion__announce_8c_a3551f15862efa7b58779722fe9763c45}{\index{onion\+\_\+announce.\+c@{onion\+\_\+announce.\+c}!cmp\+\_\+public\+\_\+key@{cmp\+\_\+public\+\_\+key}}
\index{cmp\+\_\+public\+\_\+key@{cmp\+\_\+public\+\_\+key}!onion\+\_\+announce.\+c@{onion\+\_\+announce.\+c}}
\subsubsection[{cmp\+\_\+public\+\_\+key}]{\setlength{\rightskip}{0pt plus 5cm}uint8\+\_\+t cmp\+\_\+public\+\_\+key\mbox{[}crypto\+\_\+box\+\_\+\+P\+U\+B\+L\+I\+C\+K\+E\+Y\+B\+Y\+T\+E\+S\mbox{]}\hspace{0.3cm}{\ttfamily [static]}}}\label{onion__announce_8c_a3551f15862efa7b58779722fe9763c45}


Definition at line 221 of file onion\+\_\+announce.\+c.



Referenced by add\+\_\+to\+\_\+entries(), and cmp\+\_\+entry().

