\hypertarget{_d_h_t_8h}{\section{toxcore/\+D\+H\+T.h File Reference}
\label{_d_h_t_8h}\index{toxcore/\+D\+H\+T.\+h@{toxcore/\+D\+H\+T.\+h}}
}
{\ttfamily \#include \char`\"{}crypto\+\_\+core.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}network.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}ping\+\_\+array.\+h\char`\"{}}\\*
Include dependency graph for D\+H\+T.\+h\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/da0/_d_h_t_8h__incl}
\end{center}
\end{figure}
This graph shows which files directly or indirectly include this file\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d66/_d_h_t_8h__dep__incl}
\end{center}
\end{figure}
\subsection*{Data Structures}
\begin{DoxyCompactItemize}
\item 
struct \hyperlink{struct_i_p_p_ts}{I\+P\+P\+Ts}
\item 
struct \hyperlink{struct_hardening}{Hardening}
\item 
struct \hyperlink{struct_i_p_p_ts_png}{I\+P\+P\+Ts\+Png}
\item 
struct \hyperlink{struct_client__data}{Client\+\_\+data}
\item 
struct \hyperlink{struct_n_a_t}{N\+A\+T}
\item 
struct \hyperlink{struct_d_h_t___friend}{D\+H\+T\+\_\+\+Friend}
\item 
struct \hyperlink{struct_node__format}{Node\+\_\+format}
\item 
struct \hyperlink{struct_shared___keys}{Shared\+\_\+\+Keys}
\item 
struct \hyperlink{struct_cryptopacket___handles}{Cryptopacket\+\_\+\+Handles}
\item 
struct \hyperlink{struct_d_h_t}{D\+H\+T}
\end{DoxyCompactItemize}
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{_d_h_t_8h_ad50d158518277ca4d19cbe364f3e958c}{M\+A\+X\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+C\+L\+I\+E\+N\+T\+S}~8
\item 
\#define \hyperlink{_d_h_t_8h_a3058f857a8316099e20c95fb07adc7c1}{L\+C\+L\+I\+E\+N\+T\+\_\+\+L\+I\+S\+T}~32
\item 
\#define \hyperlink{_d_h_t_8h_a57f4cf16e79a384d7d59a3cc585ea5a3}{M\+A\+X\+\_\+\+S\+E\+N\+T\+\_\+\+N\+O\+D\+E\+S}~4
\item 
\#define \hyperlink{_d_h_t_8h_a733f0d1225f97d8acbd3388e0c0d320f}{P\+I\+N\+G\+\_\+\+T\+I\+M\+E\+O\+U\+T}~3
\item 
\#define \hyperlink{_d_h_t_8h_aa025d4328dd829fe6d532d3abaf3bc7e}{D\+H\+T\+\_\+\+P\+I\+N\+G\+\_\+\+A\+R\+R\+A\+Y\+\_\+\+S\+I\+Z\+E}~512
\item 
\#define \hyperlink{_d_h_t_8h_ae138d10c7cd4199e5e96377ff1f8e317}{P\+I\+N\+G\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L}~60
\item 
\#define \hyperlink{_d_h_t_8h_ab913d567642bd6e0575d300f2a46867f}{P\+I\+N\+G\+S\+\_\+\+M\+I\+S\+S\+E\+D\+\_\+\+N\+O\+D\+E\+\_\+\+G\+O\+E\+S\+\_\+\+B\+A\+D}~1
\item 
\#define \hyperlink{_d_h_t_8h_ab25f73f46016db9ae16581ab70e911a2}{P\+I\+N\+G\+\_\+\+R\+O\+U\+N\+D\+T\+R\+I\+P}~2
\item 
\#define \hyperlink{_d_h_t_8h_a2c542fd03a43f340d1fb281afe54453f}{B\+A\+D\+\_\+\+N\+O\+D\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T}~(\hyperlink{_d_h_t_8h_ae138d10c7cd4199e5e96377ff1f8e317}{P\+I\+N\+G\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L} + \hyperlink{_d_h_t_8h_ab913d567642bd6e0575d300f2a46867f}{P\+I\+N\+G\+S\+\_\+\+M\+I\+S\+S\+E\+D\+\_\+\+N\+O\+D\+E\+\_\+\+G\+O\+E\+S\+\_\+\+B\+A\+D} $\ast$ (\hyperlink{_d_h_t_8h_ae138d10c7cd4199e5e96377ff1f8e317}{P\+I\+N\+G\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L} + \hyperlink{_d_h_t_8h_ab25f73f46016db9ae16581ab70e911a2}{P\+I\+N\+G\+\_\+\+R\+O\+U\+N\+D\+T\+R\+I\+P}))
\item 
\#define \hyperlink{_d_h_t_8h_ac35a63082a23b6ced97c0a3a24ba06be}{T\+O\+X\+\_\+\+A\+F\+\_\+\+I\+N\+E\+T}~2
\item 
\#define \hyperlink{_d_h_t_8h_a025adcf535ab2c7123fb5ea22fe20bbd}{T\+O\+X\+\_\+\+A\+F\+\_\+\+I\+N\+E\+T6}~10
\item 
\#define \hyperlink{_d_h_t_8h_ab59616c5422ae79ebc665059761879d5}{T\+O\+X\+\_\+\+T\+C\+P\+\_\+\+I\+N\+E\+T}~130
\item 
\#define \hyperlink{_d_h_t_8h_a30bf86f2e1f87bcbd6a90145943aabac}{T\+O\+X\+\_\+\+T\+C\+P\+\_\+\+I\+N\+E\+T6}~138
\item 
\#define \hyperlink{_d_h_t_8h_a09839809f361926e324196bfd9450bb4}{D\+H\+T\+\_\+\+F\+A\+K\+E\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+N\+U\+M\+B\+E\+R}~4
\item 
\#define \hyperlink{_d_h_t_8h_a5a2a8d3d5ad30ebd3efec91f27ccf394}{D\+H\+T\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+M\+A\+X\+\_\+\+L\+O\+C\+K\+S}~32
\item 
\#define \hyperlink{_d_h_t_8h_ae5450da86fcf09134330aeef7cd8c35f}{M\+A\+X\+\_\+\+K\+E\+Y\+S\+\_\+\+P\+E\+R\+\_\+\+S\+L\+O\+T}~4
\item 
\#define \hyperlink{_d_h_t_8h_a1b0aff5d0e177e2fe1f826e225223867}{K\+E\+Y\+S\+\_\+\+T\+I\+M\+E\+O\+U\+T}~600
\end{DoxyCompactItemize}
\subsection*{Typedefs}
\begin{DoxyCompactItemize}
\item 
typedef int($\ast$ \hyperlink{_d_h_t_8h_abf840e82128d3aee3c9fc5ff51e83a14}{cryptopacket\+\_\+handler\+\_\+callback} )(void $\ast$object, \hyperlink{struct_i_p___port}{I\+P\+\_\+\+Port} ip\+\_\+port, const uint8\+\_\+t $\ast$source\+\_\+pubkey, const uint8\+\_\+t $\ast$data, uint16\+\_\+t len)
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{_d_h_t_8h_ae7f65a76f9c4b0093f45fc1777238459}{to\+\_\+net\+\_\+family} (\hyperlink{struct_i_p}{I\+P} $\ast$\hyperlink{irc__syncbot_8c_ae81515e082f9bc33e8968181945586da}{ip})
\item 
int \hyperlink{_d_h_t_8h_a74120ec4fc551572bff2a08436854c97}{to\+\_\+host\+\_\+family} (\hyperlink{struct_i_p}{I\+P} $\ast$\hyperlink{irc__syncbot_8c_ae81515e082f9bc33e8968181945586da}{ip})
\item 
int \hyperlink{_d_h_t_8h_aa980937ac320a4389b726e04da26cb44}{packed\+\_\+node\+\_\+size} (uint8\+\_\+t ip\+\_\+family)
\item 
int \hyperlink{_d_h_t_8h_a1d6f2fcb008c989f333ae89e840f94b4}{pack\+\_\+nodes} (uint8\+\_\+t $\ast$data, uint16\+\_\+t length, const \hyperlink{struct_node__format}{Node\+\_\+format} $\ast$nodes, uint16\+\_\+t number)
\item 
int \hyperlink{_d_h_t_8h_a45b33af842c0289c78c70f81e854ed62}{unpack\+\_\+nodes} (\hyperlink{struct_node__format}{Node\+\_\+format} $\ast$nodes, uint16\+\_\+t max\+\_\+num\+\_\+nodes, uint16\+\_\+t $\ast$processed\+\_\+data\+\_\+len, const uint8\+\_\+t $\ast$data, uint16\+\_\+t length, uint8\+\_\+t tcp\+\_\+enabled)
\item 
void \hyperlink{_d_h_t_8h_a6cd4aa89d7bfcf6805c5ce6b273d9e9e}{get\+\_\+shared\+\_\+key} (\hyperlink{struct_shared___keys}{Shared\+\_\+\+Keys} $\ast$shared\+\_\+keys, uint8\+\_\+t $\ast$shared\+\_\+key, const uint8\+\_\+t $\ast$secret\+\_\+key, const uint8\+\_\+t $\ast$public\+\_\+key)
\item 
void \hyperlink{_d_h_t_8h_a9e92f7714ab1f2b37b54e8479717cbc7}{D\+H\+T\+\_\+get\+\_\+shared\+\_\+key\+\_\+recv} (\hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht, uint8\+\_\+t $\ast$shared\+\_\+key, const uint8\+\_\+t $\ast$public\+\_\+key)
\item 
void \hyperlink{_d_h_t_8h_a087cceeacc5a14415b651c2980a24d34}{D\+H\+T\+\_\+get\+\_\+shared\+\_\+key\+\_\+sent} (\hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht, uint8\+\_\+t $\ast$shared\+\_\+key, const uint8\+\_\+t $\ast$public\+\_\+key)
\item 
void \hyperlink{_d_h_t_8h_a769ef744f969e1b4c55547cb74abee59}{D\+H\+T\+\_\+getnodes} (\hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht, const \hyperlink{struct_i_p___port}{I\+P\+\_\+\+Port} $\ast$from\+\_\+ipp, const uint8\+\_\+t $\ast$from\+\_\+id, const uint8\+\_\+t $\ast$which\+\_\+id)
\item 
int \hyperlink{_d_h_t_8h_a1dac5e05fd07964cb4914c17afeb9d50}{D\+H\+T\+\_\+addfriend} (\hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht, const uint8\+\_\+t $\ast$public\+\_\+key, void($\ast$ip\+\_\+callback)(void $\ast$data, int32\+\_\+t number, \hyperlink{struct_i_p___port}{I\+P\+\_\+\+Port}), void $\ast$data, int32\+\_\+t number, uint16\+\_\+t $\ast$lock\+\_\+count)
\item 
int \hyperlink{_d_h_t_8h_a4e70f3fc186c6e459908307c935d00b2}{D\+H\+T\+\_\+delfriend} (\hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht, const uint8\+\_\+t $\ast$public\+\_\+key, uint16\+\_\+t lock\+\_\+count)
\item 
int \hyperlink{_d_h_t_8h_a963cf2afd9283277f69a94381e3fc5f0}{D\+H\+T\+\_\+getfriendip} (const \hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht, const uint8\+\_\+t $\ast$public\+\_\+key, \hyperlink{struct_i_p___port}{I\+P\+\_\+\+Port} $\ast$ip\+\_\+port)
\item 
int \hyperlink{_d_h_t_8h_a903a5bc580826fe447adb841b7782333}{id\+\_\+closest} (const uint8\+\_\+t $\ast$pk, const uint8\+\_\+t $\ast$pk1, const uint8\+\_\+t $\ast$pk2)
\item 
int \hyperlink{_d_h_t_8h_a8abfc9cea3784b0cae354670bd4643cd}{get\+\_\+close\+\_\+nodes} (const \hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht, const uint8\+\_\+t $\ast$public\+\_\+key, \hyperlink{struct_node__format}{Node\+\_\+format} $\ast$nodes\+\_\+list, sa\+\_\+family\+\_\+t sa\+\_\+family, uint8\+\_\+t is\+\_\+\+L\+A\+N, uint8\+\_\+t want\+\_\+good)
\item 
uint16\+\_\+t \hyperlink{_d_h_t_8h_a2b03f88384f04514e392abd12ef30140}{closelist\+\_\+nodes} (\hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht, \hyperlink{struct_node__format}{Node\+\_\+format} $\ast$nodes, uint16\+\_\+t max\+\_\+num)
\item 
void \hyperlink{_d_h_t_8h_a5be9dfb66fbf1fa7c267b016f3357534}{do\+\_\+\+D\+H\+T} (\hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht)
\item 
void \hyperlink{_d_h_t_8h_ab6d732074bab2377a7884c41c219cf96}{D\+H\+T\+\_\+bootstrap} (\hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht, \hyperlink{struct_i_p___port}{I\+P\+\_\+\+Port} ip\+\_\+port, const uint8\+\_\+t $\ast$public\+\_\+key)
\item 
int \hyperlink{_d_h_t_8h_af342c78837dbed569d4a75a0516455fc}{D\+H\+T\+\_\+bootstrap\+\_\+from\+\_\+address} (\hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht, const char $\ast$address, uint8\+\_\+t ipv6enabled, uint16\+\_\+t \hyperlink{irc__syncbot_8c_a8e0798404bf2cf5dabb84c5ba9a4f236}{port}, const uint8\+\_\+t $\ast$public\+\_\+key)
\item 
int \hyperlink{_d_h_t_8h_ad5df2ff5066cf93898e531d320ddd675}{D\+H\+T\+\_\+connect\+\_\+after\+\_\+load} (\hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht)
\item 
int \hyperlink{_d_h_t_8h_a91072d384a61a04ac1e4d679dc7efb3a}{route\+\_\+packet} (const \hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht, const uint8\+\_\+t $\ast$public\+\_\+key, const uint8\+\_\+t $\ast$packet, uint16\+\_\+t length)
\item 
int \hyperlink{_d_h_t_8h_aee23d763e291eefd141227cd9e3684ab}{route\+\_\+tofriend} (const \hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht, const uint8\+\_\+t $\ast$\hyperlink{messenger__test_8c_a5d7925718457bca84bda0952f9463a3c}{friend\+\_\+id}, const uint8\+\_\+t $\ast$packet, uint16\+\_\+t length)
\item 
void \hyperlink{_d_h_t_8h_a097913efd03d5106a66c15eb48b0e104}{cryptopacket\+\_\+registerhandler} (\hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht, uint8\+\_\+t byte, \hyperlink{_d_h_t_8h_abf840e82128d3aee3c9fc5ff51e83a14}{cryptopacket\+\_\+handler\+\_\+callback} cb, void $\ast$object)
\item 
uint32\+\_\+t \hyperlink{_d_h_t_8h_a55d92a2419bf9384e3cbfe0ec5a8f4d6}{D\+H\+T\+\_\+size} (const \hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht)
\item 
void \hyperlink{_d_h_t_8h_a7510a9fdbacfffb5987590c4e193c40a}{D\+H\+T\+\_\+save} (\hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht, uint8\+\_\+t $\ast$data)
\item 
int \hyperlink{_d_h_t_8h_a36e42ad71b293cd0ada8a7b6de9ad86b}{D\+H\+T\+\_\+load} (\hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht, const uint8\+\_\+t $\ast$data, uint32\+\_\+t length)
\item 
\hyperlink{struct_d_h_t}{D\+H\+T} $\ast$ \hyperlink{_d_h_t_8h_adad04fa897751b06948a172044bf1c58}{new\+\_\+\+D\+H\+T} (\hyperlink{struct_networking___core}{Networking\+\_\+\+Core} $\ast$net)
\item 
void \hyperlink{_d_h_t_8h_a816851e4f0f454c52b93d65544a2b2bb}{kill\+\_\+\+D\+H\+T} (\hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht)
\item 
int \hyperlink{_d_h_t_8h_a93770fe498d41d1c6b420275680967b6}{D\+H\+T\+\_\+isconnected} (const \hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht)
\item 
int \hyperlink{_d_h_t_8h_a90cd93b83fdec619c4924fd20c4fc005}{D\+H\+T\+\_\+non\+\_\+lan\+\_\+connected} (const \hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht)
\item 
int \hyperlink{_d_h_t_8h_a9d898065db0fd4adf26fdb7f80e6d7ac}{addto\+\_\+lists} (\hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht, \hyperlink{struct_i_p___port}{I\+P\+\_\+\+Port} ip\+\_\+port, const uint8\+\_\+t $\ast$public\+\_\+key)
\end{DoxyCompactItemize}


\subsection{Macro Definition Documentation}
\hypertarget{_d_h_t_8h_a2c542fd03a43f340d1fb281afe54453f}{\index{D\+H\+T.\+h@{D\+H\+T.\+h}!B\+A\+D\+\_\+\+N\+O\+D\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T@{B\+A\+D\+\_\+\+N\+O\+D\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T}}
\index{B\+A\+D\+\_\+\+N\+O\+D\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T@{B\+A\+D\+\_\+\+N\+O\+D\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T}!D\+H\+T.\+h@{D\+H\+T.\+h}}
\subsubsection[{B\+A\+D\+\_\+\+N\+O\+D\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T}]{\setlength{\rightskip}{0pt plus 5cm}\#define B\+A\+D\+\_\+\+N\+O\+D\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T~({\bf P\+I\+N\+G\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L} + {\bf P\+I\+N\+G\+S\+\_\+\+M\+I\+S\+S\+E\+D\+\_\+\+N\+O\+D\+E\+\_\+\+G\+O\+E\+S\+\_\+\+B\+A\+D} $\ast$ ({\bf P\+I\+N\+G\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L} + {\bf P\+I\+N\+G\+\_\+\+R\+O\+U\+N\+D\+T\+R\+I\+P}))}}\label{_d_h_t_8h_a2c542fd03a43f340d1fb281afe54453f}


Definition at line 52 of file D\+H\+T.\+h.



Referenced by Assoc\+\_\+get\+\_\+close\+\_\+entries(), candidates\+\_\+create\+\_\+internal(), closelist\+\_\+nodes(), cmp\+\_\+dht\+\_\+entry(), D\+H\+T\+\_\+getfriendip(), D\+H\+T\+\_\+isconnected(), D\+H\+T\+\_\+non\+\_\+lan\+\_\+connected(), do\+\_\+\+Close(), do\+\_\+hardening(), do\+\_\+ping\+\_\+and\+\_\+sendnode\+\_\+requests(), friend\+\_\+iplist(), get\+\_\+close\+\_\+nodes\+\_\+inner(), have\+\_\+nodes\+\_\+closelist(), in\+\_\+list(), mark\+\_\+bad(), route\+\_\+tofriend(), routeone\+\_\+tofriend(), and store\+\_\+node\+\_\+ok().

\hypertarget{_d_h_t_8h_a09839809f361926e324196bfd9450bb4}{\index{D\+H\+T.\+h@{D\+H\+T.\+h}!D\+H\+T\+\_\+\+F\+A\+K\+E\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+N\+U\+M\+B\+E\+R@{D\+H\+T\+\_\+\+F\+A\+K\+E\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+N\+U\+M\+B\+E\+R}}
\index{D\+H\+T\+\_\+\+F\+A\+K\+E\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+N\+U\+M\+B\+E\+R@{D\+H\+T\+\_\+\+F\+A\+K\+E\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+N\+U\+M\+B\+E\+R}!D\+H\+T.\+h@{D\+H\+T.\+h}}
\subsubsection[{D\+H\+T\+\_\+\+F\+A\+K\+E\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+N\+U\+M\+B\+E\+R}]{\setlength{\rightskip}{0pt plus 5cm}\#define D\+H\+T\+\_\+\+F\+A\+K\+E\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+N\+U\+M\+B\+E\+R~4}}\label{_d_h_t_8h_a09839809f361926e324196bfd9450bb4}


Definition at line 61 of file D\+H\+T.\+h.



Referenced by D\+H\+T\+\_\+save(), D\+H\+T\+\_\+size(), and new\+\_\+\+D\+H\+T().

\hypertarget{_d_h_t_8h_a5a2a8d3d5ad30ebd3efec91f27ccf394}{\index{D\+H\+T.\+h@{D\+H\+T.\+h}!D\+H\+T\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+M\+A\+X\+\_\+\+L\+O\+C\+K\+S@{D\+H\+T\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+M\+A\+X\+\_\+\+L\+O\+C\+K\+S}}
\index{D\+H\+T\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+M\+A\+X\+\_\+\+L\+O\+C\+K\+S@{D\+H\+T\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+M\+A\+X\+\_\+\+L\+O\+C\+K\+S}!D\+H\+T.\+h@{D\+H\+T.\+h}}
\subsubsection[{D\+H\+T\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+M\+A\+X\+\_\+\+L\+O\+C\+K\+S}]{\setlength{\rightskip}{0pt plus 5cm}\#define D\+H\+T\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+M\+A\+X\+\_\+\+L\+O\+C\+K\+S~32}}\label{_d_h_t_8h_a5a2a8d3d5ad30ebd3efec91f27ccf394}


Definition at line 124 of file D\+H\+T.\+h.



Referenced by D\+H\+T\+\_\+addfriend().

\hypertarget{_d_h_t_8h_aa025d4328dd829fe6d532d3abaf3bc7e}{\index{D\+H\+T.\+h@{D\+H\+T.\+h}!D\+H\+T\+\_\+\+P\+I\+N\+G\+\_\+\+A\+R\+R\+A\+Y\+\_\+\+S\+I\+Z\+E@{D\+H\+T\+\_\+\+P\+I\+N\+G\+\_\+\+A\+R\+R\+A\+Y\+\_\+\+S\+I\+Z\+E}}
\index{D\+H\+T\+\_\+\+P\+I\+N\+G\+\_\+\+A\+R\+R\+A\+Y\+\_\+\+S\+I\+Z\+E@{D\+H\+T\+\_\+\+P\+I\+N\+G\+\_\+\+A\+R\+R\+A\+Y\+\_\+\+S\+I\+Z\+E}!D\+H\+T.\+h@{D\+H\+T.\+h}}
\subsubsection[{D\+H\+T\+\_\+\+P\+I\+N\+G\+\_\+\+A\+R\+R\+A\+Y\+\_\+\+S\+I\+Z\+E}]{\setlength{\rightskip}{0pt plus 5cm}\#define D\+H\+T\+\_\+\+P\+I\+N\+G\+\_\+\+A\+R\+R\+A\+Y\+\_\+\+S\+I\+Z\+E~512}}\label{_d_h_t_8h_aa025d4328dd829fe6d532d3abaf3bc7e}


Definition at line 44 of file D\+H\+T.\+h.



Referenced by new\+\_\+\+D\+H\+T().

\hypertarget{_d_h_t_8h_a1b0aff5d0e177e2fe1f826e225223867}{\index{D\+H\+T.\+h@{D\+H\+T.\+h}!K\+E\+Y\+S\+\_\+\+T\+I\+M\+E\+O\+U\+T@{K\+E\+Y\+S\+\_\+\+T\+I\+M\+E\+O\+U\+T}}
\index{K\+E\+Y\+S\+\_\+\+T\+I\+M\+E\+O\+U\+T@{K\+E\+Y\+S\+\_\+\+T\+I\+M\+E\+O\+U\+T}!D\+H\+T.\+h@{D\+H\+T.\+h}}
\subsubsection[{K\+E\+Y\+S\+\_\+\+T\+I\+M\+E\+O\+U\+T}]{\setlength{\rightskip}{0pt plus 5cm}\#define K\+E\+Y\+S\+\_\+\+T\+I\+M\+E\+O\+U\+T~600}}\label{_d_h_t_8h_a1b0aff5d0e177e2fe1f826e225223867}


Definition at line 179 of file D\+H\+T.\+h.



Referenced by get\+\_\+shared\+\_\+key().

\hypertarget{_d_h_t_8h_a3058f857a8316099e20c95fb07adc7c1}{\index{D\+H\+T.\+h@{D\+H\+T.\+h}!L\+C\+L\+I\+E\+N\+T\+\_\+\+L\+I\+S\+T@{L\+C\+L\+I\+E\+N\+T\+\_\+\+L\+I\+S\+T}}
\index{L\+C\+L\+I\+E\+N\+T\+\_\+\+L\+I\+S\+T@{L\+C\+L\+I\+E\+N\+T\+\_\+\+L\+I\+S\+T}!D\+H\+T.\+h@{D\+H\+T.\+h}}
\subsubsection[{L\+C\+L\+I\+E\+N\+T\+\_\+\+L\+I\+S\+T}]{\setlength{\rightskip}{0pt plus 5cm}\#define L\+C\+L\+I\+E\+N\+T\+\_\+\+L\+I\+S\+T~32}}\label{_d_h_t_8h_a3058f857a8316099e20c95fb07adc7c1}


Definition at line 35 of file D\+H\+T.\+h.



Referenced by add\+\_\+to\+\_\+ping(), addto\+\_\+lists(), closelist\+\_\+nodes(), D\+H\+T\+\_\+isconnected(), D\+H\+T\+\_\+non\+\_\+lan\+\_\+connected(), D\+H\+T\+\_\+save(), D\+H\+T\+\_\+size(), do\+\_\+\+Close(), do\+\_\+hardening(), do\+\_\+messenger(), get\+\_\+closelist\+\_\+\+I\+P\+P\+Ts\+Png(), get\+\_\+somewhat\+\_\+close\+\_\+nodes(), print\+\_\+clientlist(), returnedip\+\_\+ports(), route\+\_\+packet(), and test\+\_\+addto\+\_\+lists().

\hypertarget{_d_h_t_8h_ad50d158518277ca4d19cbe364f3e958c}{\index{D\+H\+T.\+h@{D\+H\+T.\+h}!M\+A\+X\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+C\+L\+I\+E\+N\+T\+S@{M\+A\+X\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+C\+L\+I\+E\+N\+T\+S}}
\index{M\+A\+X\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+C\+L\+I\+E\+N\+T\+S@{M\+A\+X\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+C\+L\+I\+E\+N\+T\+S}!D\+H\+T.\+h@{D\+H\+T.\+h}}
\subsubsection[{M\+A\+X\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+C\+L\+I\+E\+N\+T\+S}]{\setlength{\rightskip}{0pt plus 5cm}\#define M\+A\+X\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+C\+L\+I\+E\+N\+T\+S~8}}\label{_d_h_t_8h_ad50d158518277ca4d19cbe364f3e958c}


Definition at line 32 of file D\+H\+T.\+h.



Referenced by addto\+\_\+lists(), D\+H\+T\+\_\+addfriend(), D\+H\+T\+\_\+getfriendip(), D\+H\+T\+\_\+save(), D\+H\+T\+\_\+size(), do\+\_\+\+D\+H\+T\+\_\+friends(), do\+\_\+messenger(), do\+\_\+\+N\+A\+T(), friend\+\_\+iplist(), get\+\_\+somewhat\+\_\+close\+\_\+nodes(), N\+A\+T\+\_\+commonip(), print\+\_\+friendlist(), punch\+\_\+holes(), returnedip\+\_\+ports(), route\+\_\+tofriend(), routeone\+\_\+tofriend(), and test\+\_\+addto\+\_\+lists().

\hypertarget{_d_h_t_8h_ae5450da86fcf09134330aeef7cd8c35f}{\index{D\+H\+T.\+h@{D\+H\+T.\+h}!M\+A\+X\+\_\+\+K\+E\+Y\+S\+\_\+\+P\+E\+R\+\_\+\+S\+L\+O\+T@{M\+A\+X\+\_\+\+K\+E\+Y\+S\+\_\+\+P\+E\+R\+\_\+\+S\+L\+O\+T}}
\index{M\+A\+X\+\_\+\+K\+E\+Y\+S\+\_\+\+P\+E\+R\+\_\+\+S\+L\+O\+T@{M\+A\+X\+\_\+\+K\+E\+Y\+S\+\_\+\+P\+E\+R\+\_\+\+S\+L\+O\+T}!D\+H\+T.\+h@{D\+H\+T.\+h}}
\subsubsection[{M\+A\+X\+\_\+\+K\+E\+Y\+S\+\_\+\+P\+E\+R\+\_\+\+S\+L\+O\+T}]{\setlength{\rightskip}{0pt plus 5cm}\#define M\+A\+X\+\_\+\+K\+E\+Y\+S\+\_\+\+P\+E\+R\+\_\+\+S\+L\+O\+T~4}}\label{_d_h_t_8h_ae5450da86fcf09134330aeef7cd8c35f}


Definition at line 178 of file D\+H\+T.\+h.



Referenced by get\+\_\+shared\+\_\+key().

\hypertarget{_d_h_t_8h_a57f4cf16e79a384d7d59a3cc585ea5a3}{\index{D\+H\+T.\+h@{D\+H\+T.\+h}!M\+A\+X\+\_\+\+S\+E\+N\+T\+\_\+\+N\+O\+D\+E\+S@{M\+A\+X\+\_\+\+S\+E\+N\+T\+\_\+\+N\+O\+D\+E\+S}}
\index{M\+A\+X\+\_\+\+S\+E\+N\+T\+\_\+\+N\+O\+D\+E\+S@{M\+A\+X\+\_\+\+S\+E\+N\+T\+\_\+\+N\+O\+D\+E\+S}!D\+H\+T.\+h@{D\+H\+T.\+h}}
\subsubsection[{M\+A\+X\+\_\+\+S\+E\+N\+T\+\_\+\+N\+O\+D\+E\+S}]{\setlength{\rightskip}{0pt plus 5cm}\#define M\+A\+X\+\_\+\+S\+E\+N\+T\+\_\+\+N\+O\+D\+E\+S~4}}\label{_d_h_t_8h_a57f4cf16e79a384d7d59a3cc585ea5a3}


Definition at line 38 of file D\+H\+T.\+h.



Referenced by get\+\_\+close\+\_\+nodes(), get\+\_\+close\+\_\+nodes\+\_\+inner(), handle\+\_\+announce\+\_\+request(), handle\+\_\+announce\+\_\+response(), handle\+\_\+dhtpk\+\_\+announce(), handle\+\_\+hardening(), handle\+\_\+sendnodes\+\_\+core(), handle\+\_\+sendnodes\+\_\+ipv6(), populate\+\_\+path\+\_\+nodes(), populate\+\_\+path\+\_\+nodes\+\_\+tcp(), random\+\_\+node(), send\+\_\+dhtpk\+\_\+announce(), and sendnodes\+\_\+ipv6().

\hypertarget{_d_h_t_8h_ae138d10c7cd4199e5e96377ff1f8e317}{\index{D\+H\+T.\+h@{D\+H\+T.\+h}!P\+I\+N\+G\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L@{P\+I\+N\+G\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L}}
\index{P\+I\+N\+G\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L@{P\+I\+N\+G\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L}!D\+H\+T.\+h@{D\+H\+T.\+h}}
\subsubsection[{P\+I\+N\+G\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\+I\+N\+G\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L~60}}\label{_d_h_t_8h_ae138d10c7cd4199e5e96377ff1f8e317}


Definition at line 47 of file D\+H\+T.\+h.



Referenced by do\+\_\+ping\+\_\+and\+\_\+sendnode\+\_\+requests().

\hypertarget{_d_h_t_8h_ab25f73f46016db9ae16581ab70e911a2}{\index{D\+H\+T.\+h@{D\+H\+T.\+h}!P\+I\+N\+G\+\_\+\+R\+O\+U\+N\+D\+T\+R\+I\+P@{P\+I\+N\+G\+\_\+\+R\+O\+U\+N\+D\+T\+R\+I\+P}}
\index{P\+I\+N\+G\+\_\+\+R\+O\+U\+N\+D\+T\+R\+I\+P@{P\+I\+N\+G\+\_\+\+R\+O\+U\+N\+D\+T\+R\+I\+P}!D\+H\+T.\+h@{D\+H\+T.\+h}}
\subsubsection[{P\+I\+N\+G\+\_\+\+R\+O\+U\+N\+D\+T\+R\+I\+P}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\+I\+N\+G\+\_\+\+R\+O\+U\+N\+D\+T\+R\+I\+P~2}}\label{_d_h_t_8h_ab25f73f46016db9ae16581ab70e911a2}


Definition at line 51 of file D\+H\+T.\+h.

\hypertarget{_d_h_t_8h_a733f0d1225f97d8acbd3388e0c0d320f}{\index{D\+H\+T.\+h@{D\+H\+T.\+h}!P\+I\+N\+G\+\_\+\+T\+I\+M\+E\+O\+U\+T@{P\+I\+N\+G\+\_\+\+T\+I\+M\+E\+O\+U\+T}}
\index{P\+I\+N\+G\+\_\+\+T\+I\+M\+E\+O\+U\+T@{P\+I\+N\+G\+\_\+\+T\+I\+M\+E\+O\+U\+T}!D\+H\+T.\+h@{D\+H\+T.\+h}}
\subsubsection[{P\+I\+N\+G\+\_\+\+T\+I\+M\+E\+O\+U\+T}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\+I\+N\+G\+\_\+\+T\+I\+M\+E\+O\+U\+T~3}}\label{_d_h_t_8h_a733f0d1225f97d8acbd3388e0c0d320f}


Definition at line 41 of file D\+H\+T.\+h.



Referenced by new\+\_\+\+D\+H\+T(), and new\+\_\+ping().

\hypertarget{_d_h_t_8h_ab913d567642bd6e0575d300f2a46867f}{\index{D\+H\+T.\+h@{D\+H\+T.\+h}!P\+I\+N\+G\+S\+\_\+\+M\+I\+S\+S\+E\+D\+\_\+\+N\+O\+D\+E\+\_\+\+G\+O\+E\+S\+\_\+\+B\+A\+D@{P\+I\+N\+G\+S\+\_\+\+M\+I\+S\+S\+E\+D\+\_\+\+N\+O\+D\+E\+\_\+\+G\+O\+E\+S\+\_\+\+B\+A\+D}}
\index{P\+I\+N\+G\+S\+\_\+\+M\+I\+S\+S\+E\+D\+\_\+\+N\+O\+D\+E\+\_\+\+G\+O\+E\+S\+\_\+\+B\+A\+D@{P\+I\+N\+G\+S\+\_\+\+M\+I\+S\+S\+E\+D\+\_\+\+N\+O\+D\+E\+\_\+\+G\+O\+E\+S\+\_\+\+B\+A\+D}!D\+H\+T.\+h@{D\+H\+T.\+h}}
\subsubsection[{P\+I\+N\+G\+S\+\_\+\+M\+I\+S\+S\+E\+D\+\_\+\+N\+O\+D\+E\+\_\+\+G\+O\+E\+S\+\_\+\+B\+A\+D}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\+I\+N\+G\+S\+\_\+\+M\+I\+S\+S\+E\+D\+\_\+\+N\+O\+D\+E\+\_\+\+G\+O\+E\+S\+\_\+\+B\+A\+D~1}}\label{_d_h_t_8h_ab913d567642bd6e0575d300f2a46867f}


Definition at line 50 of file D\+H\+T.\+h.

\hypertarget{_d_h_t_8h_ac35a63082a23b6ced97c0a3a24ba06be}{\index{D\+H\+T.\+h@{D\+H\+T.\+h}!T\+O\+X\+\_\+\+A\+F\+\_\+\+I\+N\+E\+T@{T\+O\+X\+\_\+\+A\+F\+\_\+\+I\+N\+E\+T}}
\index{T\+O\+X\+\_\+\+A\+F\+\_\+\+I\+N\+E\+T@{T\+O\+X\+\_\+\+A\+F\+\_\+\+I\+N\+E\+T}!D\+H\+T.\+h@{D\+H\+T.\+h}}
\subsubsection[{T\+O\+X\+\_\+\+A\+F\+\_\+\+I\+N\+E\+T}]{\setlength{\rightskip}{0pt plus 5cm}\#define T\+O\+X\+\_\+\+A\+F\+\_\+\+I\+N\+E\+T~2}}\label{_d_h_t_8h_ac35a63082a23b6ced97c0a3a24ba06be}


Definition at line 55 of file D\+H\+T.\+h.



Referenced by ip\+\_\+pack(), ip\+\_\+unpack(), pack\+\_\+nodes(), to\+\_\+host\+\_\+family(), to\+\_\+net\+\_\+family(), and unpack\+\_\+nodes().

\hypertarget{_d_h_t_8h_a025adcf535ab2c7123fb5ea22fe20bbd}{\index{D\+H\+T.\+h@{D\+H\+T.\+h}!T\+O\+X\+\_\+\+A\+F\+\_\+\+I\+N\+E\+T6@{T\+O\+X\+\_\+\+A\+F\+\_\+\+I\+N\+E\+T6}}
\index{T\+O\+X\+\_\+\+A\+F\+\_\+\+I\+N\+E\+T6@{T\+O\+X\+\_\+\+A\+F\+\_\+\+I\+N\+E\+T6}!D\+H\+T.\+h@{D\+H\+T.\+h}}
\subsubsection[{T\+O\+X\+\_\+\+A\+F\+\_\+\+I\+N\+E\+T6}]{\setlength{\rightskip}{0pt plus 5cm}\#define T\+O\+X\+\_\+\+A\+F\+\_\+\+I\+N\+E\+T6~10}}\label{_d_h_t_8h_a025adcf535ab2c7123fb5ea22fe20bbd}


Definition at line 56 of file D\+H\+T.\+h.



Referenced by pack\+\_\+nodes(), to\+\_\+host\+\_\+family(), to\+\_\+net\+\_\+family(), and unpack\+\_\+nodes().

\hypertarget{_d_h_t_8h_ab59616c5422ae79ebc665059761879d5}{\index{D\+H\+T.\+h@{D\+H\+T.\+h}!T\+O\+X\+\_\+\+T\+C\+P\+\_\+\+I\+N\+E\+T@{T\+O\+X\+\_\+\+T\+C\+P\+\_\+\+I\+N\+E\+T}}
\index{T\+O\+X\+\_\+\+T\+C\+P\+\_\+\+I\+N\+E\+T@{T\+O\+X\+\_\+\+T\+C\+P\+\_\+\+I\+N\+E\+T}!D\+H\+T.\+h@{D\+H\+T.\+h}}
\subsubsection[{T\+O\+X\+\_\+\+T\+C\+P\+\_\+\+I\+N\+E\+T}]{\setlength{\rightskip}{0pt plus 5cm}\#define T\+O\+X\+\_\+\+T\+C\+P\+\_\+\+I\+N\+E\+T~130}}\label{_d_h_t_8h_ab59616c5422ae79ebc665059761879d5}


Definition at line 57 of file D\+H\+T.\+h.



Referenced by ip\+\_\+pack(), ip\+\_\+unpack(), pack\+\_\+nodes(), and unpack\+\_\+nodes().

\hypertarget{_d_h_t_8h_a30bf86f2e1f87bcbd6a90145943aabac}{\index{D\+H\+T.\+h@{D\+H\+T.\+h}!T\+O\+X\+\_\+\+T\+C\+P\+\_\+\+I\+N\+E\+T6@{T\+O\+X\+\_\+\+T\+C\+P\+\_\+\+I\+N\+E\+T6}}
\index{T\+O\+X\+\_\+\+T\+C\+P\+\_\+\+I\+N\+E\+T6@{T\+O\+X\+\_\+\+T\+C\+P\+\_\+\+I\+N\+E\+T6}!D\+H\+T.\+h@{D\+H\+T.\+h}}
\subsubsection[{T\+O\+X\+\_\+\+T\+C\+P\+\_\+\+I\+N\+E\+T6}]{\setlength{\rightskip}{0pt plus 5cm}\#define T\+O\+X\+\_\+\+T\+C\+P\+\_\+\+I\+N\+E\+T6~138}}\label{_d_h_t_8h_a30bf86f2e1f87bcbd6a90145943aabac}


Definition at line 58 of file D\+H\+T.\+h.



Referenced by pack\+\_\+nodes(), and unpack\+\_\+nodes().



\subsection{Typedef Documentation}
\hypertarget{_d_h_t_8h_abf840e82128d3aee3c9fc5ff51e83a14}{\index{D\+H\+T.\+h@{D\+H\+T.\+h}!cryptopacket\+\_\+handler\+\_\+callback@{cryptopacket\+\_\+handler\+\_\+callback}}
\index{cryptopacket\+\_\+handler\+\_\+callback@{cryptopacket\+\_\+handler\+\_\+callback}!D\+H\+T.\+h@{D\+H\+T.\+h}}
\subsubsection[{cryptopacket\+\_\+handler\+\_\+callback}]{\setlength{\rightskip}{0pt plus 5cm}typedef int($\ast$ cryptopacket\+\_\+handler\+\_\+callback)(void $\ast$object, {\bf I\+P\+\_\+\+Port} ip\+\_\+port, const uint8\+\_\+t $\ast$source\+\_\+pubkey, const uint8\+\_\+t $\ast$data, uint16\+\_\+t len)}}\label{_d_h_t_8h_abf840e82128d3aee3c9fc5ff51e83a14}


Definition at line 192 of file D\+H\+T.\+h.



\subsection{Function Documentation}
\hypertarget{_d_h_t_8h_a9d898065db0fd4adf26fdb7f80e6d7ac}{\index{D\+H\+T.\+h@{D\+H\+T.\+h}!addto\+\_\+lists@{addto\+\_\+lists}}
\index{addto\+\_\+lists@{addto\+\_\+lists}!D\+H\+T.\+h@{D\+H\+T.\+h}}
\subsubsection[{addto\+\_\+lists}]{\setlength{\rightskip}{0pt plus 5cm}int addto\+\_\+lists (
\begin{DoxyParamCaption}
\item[{{\bf D\+H\+T} $\ast$}]{dht, }
\item[{{\bf I\+P\+\_\+\+Port}}]{ip\+\_\+port, }
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key}
\end{DoxyParamCaption}
)}}\label{_d_h_t_8h_a9d898065db0fd4adf26fdb7f80e6d7ac}


Definition at line 771 of file D\+H\+T.\+c.



References Assoc\+\_\+add\+\_\+entry(), D\+H\+T\+\_\+\+Friend\+::callbacks, D\+H\+T\+\_\+\+Friend\+::client\+\_\+list, client\+\_\+or\+\_\+ip\+\_\+port\+\_\+in\+\_\+list(), D\+H\+T\+::close\+\_\+clientlist, D\+H\+T\+\_\+\+Friend\+::data, I\+P\+::family, D\+H\+T\+::friends\+\_\+list, i, I\+P\+\_\+\+Port\+::ip, I\+P\+::ip4, I\+P\+::ip6, D\+H\+T\+\_\+\+Friend\+::ip\+\_\+callback, I\+P\+P\+Ts\+::ip\+\_\+port, I\+P\+V6\+\_\+\+I\+P\+V4\+\_\+\+I\+N\+\_\+\+V6, L\+C\+L\+I\+E\+N\+T\+\_\+\+L\+I\+S\+T, D\+H\+T\+\_\+\+Friend\+::lock\+\_\+count, M\+A\+X\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+C\+L\+I\+E\+N\+T\+S, D\+H\+T\+::num\+\_\+friends, D\+H\+T\+\_\+\+Friend\+::number, D\+H\+T\+\_\+\+Friend\+::public\+\_\+key, replace\+\_\+all(), D\+H\+T\+::self\+\_\+public\+\_\+key, I\+P\+P\+Ts\+::timestamp, I\+P4\+::uint32, I\+P6\+::uint32, and unix\+\_\+time().



Referenced by handle\+\_\+ping\+\_\+response(), handle\+\_\+sendnodes\+\_\+core(), test\+\_\+addto\+\_\+lists(), test\+\_\+addto\+\_\+lists\+\_\+bad(), test\+\_\+addto\+\_\+lists\+\_\+good(), test\+\_\+addto\+\_\+lists\+\_\+possible\+\_\+bad(), and test\+\_\+addto\+\_\+lists\+\_\+update().


\begin{DoxyCode}
772 \{
773     uint32\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}, used = 0;
774 
775     \textcolor{comment}{/* convert IPv4-in-IPv6 to IPv4 */}
776     \textcolor{keywordflow}{if} ((ip\_port.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} == AF\_INET6) && \hyperlink{network_8h_aaaf5ca9c91edc4f8a7529206d7799805}{IPV6\_IPV4\_IN\_V6}(ip\_port.
      \hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_a14c606eb5ffb078c38ad854dc4e79507}{ip6})) \{
777         ip\_port.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} = AF\_INET;
778         ip\_port.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_aca19646000f55aa927406e68fc41ecf9}{ip4}.\hyperlink{union_i_p4_a5ad776be1fb768f3399aafcd1b58b3a2}{uint32} = ip\_port.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_a14c606eb5ffb078c38ad854dc4e79507}{ip6}.\hyperlink{union_i_p6_a1d8ab1f6c1da5565bed41e7095610dea}{uint32}[3];
779     \}
780 
781     \textcolor{comment}{/* NOTE: Current behavior if there are two clients with the same id is}
782 \textcolor{comment}{     * to replace the first ip by the second.}
783 \textcolor{comment}{     */}
784     \textcolor{keywordflow}{if} (!\hyperlink{_d_h_t_8c_af6cc6aba68b93656a8fdca733e2ae918}{client\_or\_ip\_port\_in\_list}(dht->
      \hyperlink{struct_d_h_t_a00ef35d5b0e7a791ef08a30b3bacbf9d}{close\_clientlist}, \hyperlink{_d_h_t_8h_a3058f857a8316099e20c95fb07adc7c1}{LCLIENT\_LIST}, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, ip\_port)) \{
785         \textcolor{keywordflow}{if} (\hyperlink{_d_h_t_8c_adfcc072141badf7d1cd04542b3dd26b1}{replace\_all}(dht->\hyperlink{struct_d_h_t_a00ef35d5b0e7a791ef08a30b3bacbf9d}{close\_clientlist}, 
      \hyperlink{_d_h_t_8h_a3058f857a8316099e20c95fb07adc7c1}{LCLIENT\_LIST}, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, ip\_port, dht->\hyperlink{struct_d_h_t_ae726df8bdc26380e5a6c3187a00d6881}{self\_public\_key}))
786             used++;
787     \} \textcolor{keywordflow}{else}
788         used++;
789 
790     \hyperlink{struct_d_h_t___friend}{DHT\_Friend} *friend\_foundip = 0;
791 
792     \textcolor{keywordflow}{for} (i = 0; i < dht->\hyperlink{struct_d_h_t_a8ee1f2d7e543bce350c591a8eaac0cf8}{num\_friends}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
793         \textcolor{keywordflow}{if} (!\hyperlink{_d_h_t_8c_af6cc6aba68b93656a8fdca733e2ae918}{client\_or\_ip\_port\_in\_list}(dht->
      \hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[i].\hyperlink{struct_d_h_t___friend_a49ef2b640a834a77b6e123355a4fea47}{client\_list},
794                                        \hyperlink{_d_h_t_8h_ad50d158518277ca4d19cbe364f3e958c}{MAX\_FRIEND\_CLIENTS}, 
      \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, ip\_port)) \{
795             \textcolor{keywordflow}{if} (\hyperlink{_d_h_t_8c_adfcc072141badf7d1cd04542b3dd26b1}{replace\_all}(dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[i].
      \hyperlink{struct_d_h_t___friend_a49ef2b640a834a77b6e123355a4fea47}{client\_list}, \hyperlink{_d_h_t_8h_ad50d158518277ca4d19cbe364f3e958c}{MAX\_FRIEND\_CLIENTS},
796                             \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, ip\_port, dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[i].
      \hyperlink{struct_d_h_t___friend_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key})) \{
797 
798                 \hyperlink{struct_d_h_t___friend}{DHT\_Friend} *\textcolor{keyword}{friend} = &dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}];
799 
800                 \textcolor{keywordflow}{if} (memcmp(\hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, friend->public\_key, crypto\_box\_PUBLICKEYBYTES) == 0) \{
801                     friend\_foundip = \textcolor{keyword}{friend};
802                 \}
803 
804                 used++;
805             \}
806         \} \textcolor{keywordflow}{else} \{
807             \hyperlink{struct_d_h_t___friend}{DHT\_Friend} *\textcolor{keyword}{friend} = &dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}];
808 
809             \textcolor{keywordflow}{if} (memcmp(\hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, friend->public\_key, crypto\_box\_PUBLICKEYBYTES) == 0) \{
810                 friend\_foundip = \textcolor{keyword}{friend};
811             \}
812 
813             used++;
814         \}
815     \}
816 
817     \textcolor{keywordflow}{if} (friend\_foundip) \{
818         uint32\_t j;
819 
820         \textcolor{keywordflow}{for} (j = 0; j < friend\_foundip->\hyperlink{struct_d_h_t___friend_a712c4c639bfc0f5a8616eead3e24ca4e}{lock\_count}; ++j) \{
821             \textcolor{keywordflow}{if} (friend\_foundip->\hyperlink{struct_d_h_t___friend_a1ef2d93ffeb76ceb01d28ecb1244547c}{callbacks}[j].\hyperlink{struct_d_h_t___friend_abc638e20365d8487c7bc56894c5ef969}{ip\_callback})
822                 friend\_foundip->\hyperlink{struct_d_h_t___friend_a1ef2d93ffeb76ceb01d28ecb1244547c}{callbacks}[j].\hyperlink{struct_d_h_t___friend_abc638e20365d8487c7bc56894c5ef969}{ip\_callback}(friend\_foundip->
      \hyperlink{struct_d_h_t___friend_a1ef2d93ffeb76ceb01d28ecb1244547c}{callbacks}[j].\hyperlink{struct_d_h_t___friend_a735984d41155bc1032e09bece8f8d66d}{data}, friend\_foundip->\hyperlink{struct_d_h_t___friend_a1ef2d93ffeb76ceb01d28ecb1244547c}{callbacks}[j].\hyperlink{struct_d_h_t___friend_a875e6b85754551c9eaea424a5a4c7934}{number},
823                         ip\_port);
824         \}
825     \}
826 
827 \textcolor{preprocessor}{#ifdef ENABLE\_ASSOC\_DHT}
828 
829     \textcolor{keywordflow}{if} (dht->assoc) \{
830         \hyperlink{struct_i_p_p_ts}{IPPTs} ippts;
831 
832         ippts.\hyperlink{struct_i_p_p_ts_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port} = ip\_port;
833         ippts.\hyperlink{struct_i_p_p_ts_a465bef81f6478756e5443025b1f2ddfa}{timestamp} = \hyperlink{util_8c_ac958d9f8847cb8039444bfa3d304233a}{unix\_time}();
834 
835         \hyperlink{assoc_8c_aa0230ae0304fd8540a5bce578d242f30}{Assoc\_add\_entry}(dht->assoc, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, &ippts, NULL, used ? 1 : 0);
836     \}
837 
838 \textcolor{preprocessor}{#endif}
839     \textcolor{keywordflow}{return} used;
840 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/dad/_d_h_t_8h_a9d898065db0fd4adf26fdb7f80e6d7ac_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/dad/_d_h_t_8h_a9d898065db0fd4adf26fdb7f80e6d7ac_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8h_a2b03f88384f04514e392abd12ef30140}{\index{D\+H\+T.\+h@{D\+H\+T.\+h}!closelist\+\_\+nodes@{closelist\+\_\+nodes}}
\index{closelist\+\_\+nodes@{closelist\+\_\+nodes}!D\+H\+T.\+h@{D\+H\+T.\+h}}
\subsubsection[{closelist\+\_\+nodes}]{\setlength{\rightskip}{0pt plus 5cm}uint16\+\_\+t closelist\+\_\+nodes (
\begin{DoxyParamCaption}
\item[{{\bf D\+H\+T} $\ast$}]{dht, }
\item[{{\bf Node\+\_\+format} $\ast$}]{nodes, }
\item[{uint16\+\_\+t}]{max\+\_\+num}
\end{DoxyParamCaption}
)}}\label{_d_h_t_8h_a2b03f88384f04514e392abd12ef30140}


Definition at line 2066 of file D\+H\+T.\+c.



References Client\+\_\+data\+::assoc4, Client\+\_\+data\+::assoc6, B\+A\+D\+\_\+\+N\+O\+D\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T, D\+H\+T\+::close\+\_\+clientlist, i, I\+P\+P\+Ts\+Png\+::ip\+\_\+port, Node\+\_\+format\+::ip\+\_\+port, is\+\_\+timeout(), and L\+C\+L\+I\+E\+N\+T\+\_\+\+L\+I\+S\+T.



Referenced by send\+\_\+dhtpk\+\_\+announce().


\begin{DoxyCode}
2067 \{
2068     \textcolor{keywordflow}{if} (max\_num == 0)
2069         \textcolor{keywordflow}{return} 0;
2070 
2071     uint16\_t count = 0;
2072     \hyperlink{struct_client__data}{Client\_data} *list = dht->\hyperlink{struct_d_h_t_a00ef35d5b0e7a791ef08a30b3bacbf9d}{close\_clientlist};
2073 
2074     uint32\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
2075 
2076     \textcolor{keywordflow}{for} (i = \hyperlink{_d_h_t_8h_a3058f857a8316099e20c95fb07adc7c1}{LCLIENT\_LIST}; i != 0; --\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
2077         \hyperlink{struct_i_p_p_ts_png}{IPPTsPng} *assoc = NULL;
2078 
2079         \textcolor{keywordflow}{if} (!\hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(list[i - 1].assoc4.timestamp, \hyperlink{_d_h_t_8h_a2c542fd03a43f340d1fb281afe54453f}{BAD\_NODE\_TIMEOUT}))
2080             assoc = &list[i - 1].\hyperlink{struct_client__data_ac9843379cbcd02bdfa5c180a1474a6c5}{assoc4};
2081 
2082         \textcolor{keywordflow}{if} (!\hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(list[i - 1].assoc6.timestamp, \hyperlink{_d_h_t_8h_a2c542fd03a43f340d1fb281afe54453f}{BAD\_NODE\_TIMEOUT})) \{
2083             \textcolor{keywordflow}{if} (assoc == NULL)
2084                 assoc = &list[i - 1].\hyperlink{struct_client__data_a87d394929a2604f6f785fec949fac618}{assoc6};
2085             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (rand() % 2)
2086                 assoc = &list[i - 1].\hyperlink{struct_client__data_a87d394929a2604f6f785fec949fac618}{assoc6};
2087         \}
2088 
2089         \textcolor{keywordflow}{if} (assoc != NULL) \{
2090             memcpy(nodes[count].\hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, list[i - 1].public\_key, crypto\_box\_PUBLICKEYBYTES);
2091             nodes[count].\hyperlink{struct_node__format_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port} = assoc->\hyperlink{struct_i_p_p_ts_png_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port};
2092             ++count;
2093 
2094             \textcolor{keywordflow}{if} (count >= max\_num)
2095                 \textcolor{keywordflow}{return} count;
2096         \}
2097     \}
2098 
2099     \textcolor{keywordflow}{return} count;
2100 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/dad/_d_h_t_8h_a2b03f88384f04514e392abd12ef30140_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/dad/_d_h_t_8h_a2b03f88384f04514e392abd12ef30140_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8h_a097913efd03d5106a66c15eb48b0e104}{\index{D\+H\+T.\+h@{D\+H\+T.\+h}!cryptopacket\+\_\+registerhandler@{cryptopacket\+\_\+registerhandler}}
\index{cryptopacket\+\_\+registerhandler@{cryptopacket\+\_\+registerhandler}!D\+H\+T.\+h@{D\+H\+T.\+h}}
\subsubsection[{cryptopacket\+\_\+registerhandler}]{\setlength{\rightskip}{0pt plus 5cm}void cryptopacket\+\_\+registerhandler (
\begin{DoxyParamCaption}
\item[{{\bf D\+H\+T} $\ast$}]{dht, }
\item[{uint8\+\_\+t}]{byte, }
\item[{{\bf cryptopacket\+\_\+handler\+\_\+callback}}]{cb, }
\item[{void $\ast$}]{object}
\end{DoxyParamCaption}
)}}\label{_d_h_t_8h_a097913efd03d5106a66c15eb48b0e104}


Definition at line 2154 of file D\+H\+T.\+c.



References D\+H\+T\+::cryptopackethandlers, Cryptopacket\+\_\+\+Handles\+::function, and Cryptopacket\+\_\+\+Handles\+::object.



Referenced by kill\+\_\+\+D\+H\+T(), kill\+\_\+onion\+\_\+client(), new\+\_\+\+D\+H\+T(), and new\+\_\+onion\+\_\+client().


\begin{DoxyCode}
2155 \{
2156     dht->\hyperlink{struct_d_h_t_a461ccd9a581712b103785034f31d0d82}{cryptopackethandlers}[byte].\hyperlink{struct_cryptopacket___handles_a9313784040f9666743d9aff915543903}{function} = cb;
2157     dht->\hyperlink{struct_d_h_t_a461ccd9a581712b103785034f31d0d82}{cryptopackethandlers}[byte].\hyperlink{struct_cryptopacket___handles_a077376d12464f945e2414d5499c79b3f}{object} = object;
2158 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/dad/_d_h_t_8h_a097913efd03d5106a66c15eb48b0e104_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8h_a1dac5e05fd07964cb4914c17afeb9d50}{\index{D\+H\+T.\+h@{D\+H\+T.\+h}!D\+H\+T\+\_\+addfriend@{D\+H\+T\+\_\+addfriend}}
\index{D\+H\+T\+\_\+addfriend@{D\+H\+T\+\_\+addfriend}!D\+H\+T.\+h@{D\+H\+T.\+h}}
\subsubsection[{D\+H\+T\+\_\+addfriend}]{\setlength{\rightskip}{0pt plus 5cm}int D\+H\+T\+\_\+addfriend (
\begin{DoxyParamCaption}
\item[{{\bf D\+H\+T} $\ast$}]{dht, }
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key, }
\item[{void($\ast$)(void $\ast$data, int32\+\_\+t number, {\bf I\+P\+\_\+\+Port})}]{ip\+\_\+callback, }
\item[{void $\ast$}]{data, }
\item[{int32\+\_\+t}]{number, }
\item[{uint16\+\_\+t $\ast$}]{lock\+\_\+count}
\end{DoxyParamCaption}
)}}\label{_d_h_t_8h_a1dac5e05fd07964cb4914c17afeb9d50}


Definition at line 1167 of file D\+H\+T.\+c.



References Client\+\_\+data\+::assoc4, Client\+\_\+data\+::assoc6, Assoc\+\_\+get\+\_\+close\+\_\+entries(), Assoc\+\_\+close\+\_\+entries\+::count, Assoc\+\_\+close\+\_\+entries\+::count\+\_\+good, make-\/funny-\/savefile\+::data, D\+H\+T\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+M\+A\+X\+\_\+\+L\+O\+C\+K\+S, friend\+\_\+number(), D\+H\+T\+::friends\+\_\+list, getnodes(), i, I\+P\+P\+Ts\+Png\+::ip\+\_\+port, ipport\+\_\+isset(), D\+H\+T\+\_\+\+Friend\+::lock\+\_\+count, M\+A\+X\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+C\+L\+I\+E\+N\+T\+S, D\+H\+T\+::num\+\_\+friends, make-\/funny-\/savefile\+::public\+\_\+key, Client\+\_\+data\+::public\+\_\+key, random\+\_\+64b(), Assoc\+\_\+close\+\_\+entries\+::result, and Assoc\+\_\+close\+\_\+entries\+::wanted\+\_\+id.



Referenced by change\+\_\+dht\+\_\+pk(), dht\+\_\+pk\+\_\+callback(), main(), and new\+\_\+\+D\+H\+T().


\begin{DoxyCode}
1169 \{
1170     \textcolor{keywordtype}{int} friend\_num = \hyperlink{_d_h_t_8c_a6cbd0f66d63003cc0def913dc7a4254b}{friend\_number}(dht, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key});
1171 
1172     uint16\_t lock\_num;
1173 
1174     \textcolor{keywordflow}{if} (friend\_num != -1) \{ \textcolor{comment}{/* Is friend already in DHT? */}
1175         \hyperlink{struct_d_h_t___friend}{DHT\_Friend} *\textcolor{keyword}{friend} = &dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[friend\_num];
1176 
1177         \textcolor{keywordflow}{if} (friend->lock\_count == \hyperlink{_d_h_t_8h_a5a2a8d3d5ad30ebd3efec91f27ccf394}{DHT\_FRIEND\_MAX\_LOCKS})
1178             \textcolor{keywordflow}{return} -1;
1179 
1180         lock\_num = \textcolor{keyword}{friend}->\hyperlink{struct_d_h_t___friend_a712c4c639bfc0f5a8616eead3e24ca4e}{lock\_count};
1181         ++\textcolor{keyword}{friend}->lock\_count;
1182         \textcolor{keyword}{friend}->callbacks[lock\_num].ip\_callback = ip\_callback;
1183         \textcolor{keyword}{friend}->callbacks[lock\_num].data = \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data};
1184         \textcolor{keyword}{friend}->callbacks[lock\_num].number = number;
1185 
1186         \textcolor{keywordflow}{if} (lock\_count)
1187             *lock\_count = lock\_num + 1;
1188 
1189         \textcolor{keywordflow}{return} 0;
1190     \}
1191 
1192     \hyperlink{struct_d_h_t___friend}{DHT\_Friend} *temp;
1193     temp = realloc(dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}, \textcolor{keyword}{sizeof}(\hyperlink{struct_d_h_t___friend}{DHT\_Friend}) * (dht->
      \hyperlink{struct_d_h_t_a8ee1f2d7e543bce350c591a8eaac0cf8}{num\_friends} + 1));
1194 
1195     \textcolor{keywordflow}{if} (temp == NULL)
1196         \textcolor{keywordflow}{return} -1;
1197 
1198     dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list} = temp;
1199     \hyperlink{struct_d_h_t___friend}{DHT\_Friend} *\textcolor{keyword}{friend} = &dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[dht->
      \hyperlink{struct_d_h_t_a8ee1f2d7e543bce350c591a8eaac0cf8}{num\_friends}];
1200     memset(\textcolor{keyword}{friend}, 0, \textcolor{keyword}{sizeof}(\hyperlink{struct_d_h_t___friend}{DHT\_Friend}));
1201     memcpy(friend->public\_key, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, crypto\_box\_PUBLICKEYBYTES);
1202 
1203     \textcolor{keyword}{friend}->nat.NATping\_id = \hyperlink{crypto__core_8c_a1ce51b34ab2247e750b9c2a25121eb9e}{random\_64b}();
1204     ++dht->\hyperlink{struct_d_h_t_a8ee1f2d7e543bce350c591a8eaac0cf8}{num\_friends};
1205 
1206     lock\_num = \textcolor{keyword}{friend}->lock\_count;
1207     ++\textcolor{keyword}{friend}->lock\_count;
1208     \textcolor{keyword}{friend}->callbacks[lock\_num].ip\_callback = ip\_callback;
1209     \textcolor{keyword}{friend}->callbacks[lock\_num].data = \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data};
1210     \textcolor{keyword}{friend}->callbacks[lock\_num].number = number;
1211 
1212     \textcolor{keywordflow}{if} (lock\_count)
1213         *lock\_count = lock\_num + 1;
1214 
1215 \textcolor{preprocessor}{#ifdef ENABLE\_ASSOC\_DHT}
1216 
1217     \textcolor{keywordflow}{if} (dht->assoc) \{
1218         \textcolor{comment}{/* get up to MAX\_FRIEND\_CLIENTS connectable nodes */}
1219         \hyperlink{struct_d_h_t___friend}{DHT\_Friend} *\textcolor{keyword}{friend} = &dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[dht->
      \hyperlink{struct_d_h_t_a8ee1f2d7e543bce350c591a8eaac0cf8}{num\_friends} - 1];
1220 
1221         \hyperlink{struct_assoc__close__entries}{Assoc\_close\_entries} close\_entries;
1222         memset(&close\_entries, 0, \textcolor{keyword}{sizeof}(close\_entries));
1223         close\_entries.\hyperlink{struct_assoc__close__entries_a037b65164e78b02017bd4751843037b4}{wanted\_id} = \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key};
1224         close\_entries.\hyperlink{struct_assoc__close__entries_a086e0ce002c9491e4b99956740bb53d4}{count\_good} = \hyperlink{_d_h_t_8h_ad50d158518277ca4d19cbe364f3e958c}{MAX\_FRIEND\_CLIENTS} / 2;
1225         close\_entries.\hyperlink{struct_assoc__close__entries_a20302e2c99a60d3f612dba57e3f6333b}{count} = \hyperlink{_d_h_t_8h_ad50d158518277ca4d19cbe364f3e958c}{MAX\_FRIEND\_CLIENTS};
1226         close\_entries.\hyperlink{struct_assoc__close__entries_a40d6704f891338dadfa89f46b696be4c}{result} = calloc(\hyperlink{_d_h_t_8h_ad50d158518277ca4d19cbe364f3e958c}{MAX\_FRIEND\_CLIENTS}, \textcolor{keyword}{sizeof}(*close\_entries.
      \hyperlink{struct_assoc__close__entries_a40d6704f891338dadfa89f46b696be4c}{result}));
1227 
1228         uint8\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}, found = \hyperlink{assoc_8c_a256dcbfb2174603496ffa30efef90ad2}{Assoc\_get\_close\_entries}(dht->assoc, &close\_entries);
1229 
1230         \textcolor{keywordflow}{for} (i = 0; i < found; i++)
1231             memcpy(&friend->client\_list[i], close\_entries.\hyperlink{struct_assoc__close__entries_a40d6704f891338dadfa89f46b696be4c}{result}[i], \textcolor{keyword}{sizeof}(*close\_entries.
      \hyperlink{struct_assoc__close__entries_a40d6704f891338dadfa89f46b696be4c}{result}[i]));
1232 
1233         \textcolor{keywordflow}{if} (found) \{
1234             \textcolor{comment}{/* send getnodes to the "best" entry */}
1235             \hyperlink{struct_client__data}{Client\_data} *client = &\textcolor{keyword}{friend}->client\_list[0];
1236 
1237             \textcolor{keywordflow}{if} (\hyperlink{network_8c_a8436367218afb29bcf1b5fecd071648e}{ipport\_isset}(&client->\hyperlink{struct_client__data_ac9843379cbcd02bdfa5c180a1474a6c5}{assoc4}.\hyperlink{struct_i_p_p_ts_png_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}))
1238                 \hyperlink{_d_h_t_8c_a7af6c30b12e5cbda1e6d6d824794956e}{getnodes}(dht, client->\hyperlink{struct_client__data_ac9843379cbcd02bdfa5c180a1474a6c5}{assoc4}.\hyperlink{struct_i_p_p_ts_png_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}, client->
      \hyperlink{struct_client__data_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, friend->public\_key, NULL);
1239 
1240             \textcolor{keywordflow}{if} (\hyperlink{network_8c_a8436367218afb29bcf1b5fecd071648e}{ipport\_isset}(&client->\hyperlink{struct_client__data_a87d394929a2604f6f785fec949fac618}{assoc6}.\hyperlink{struct_i_p_p_ts_png_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}))
1241                 \hyperlink{_d_h_t_8c_a7af6c30b12e5cbda1e6d6d824794956e}{getnodes}(dht, client->\hyperlink{struct_client__data_a87d394929a2604f6f785fec949fac618}{assoc6}.\hyperlink{struct_i_p_p_ts_png_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}, client->
      \hyperlink{struct_client__data_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, friend->public\_key, NULL);
1242         \}
1243     \}
1244 
1245 \textcolor{preprocessor}{#endif}
1246 
1247     \textcolor{keywordflow}{return} 0;
1248 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/dad/_d_h_t_8h_a1dac5e05fd07964cb4914c17afeb9d50_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/dad/_d_h_t_8h_a1dac5e05fd07964cb4914c17afeb9d50_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8h_ab6d732074bab2377a7884c41c219cf96}{\index{D\+H\+T.\+h@{D\+H\+T.\+h}!D\+H\+T\+\_\+bootstrap@{D\+H\+T\+\_\+bootstrap}}
\index{D\+H\+T\+\_\+bootstrap@{D\+H\+T\+\_\+bootstrap}!D\+H\+T.\+h@{D\+H\+T.\+h}}
\subsubsection[{D\+H\+T\+\_\+bootstrap}]{\setlength{\rightskip}{0pt plus 5cm}void D\+H\+T\+\_\+bootstrap (
\begin{DoxyParamCaption}
\item[{{\bf D\+H\+T} $\ast$}]{dht, }
\item[{{\bf I\+P\+\_\+\+Port}}]{ip\+\_\+port, }
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key}
\end{DoxyParamCaption}
)}}\label{_d_h_t_8h_ab6d732074bab2377a7884c41c219cf96}


Definition at line 1420 of file D\+H\+T.\+c.



References getnodes(), and D\+H\+T\+::self\+\_\+public\+\_\+key.



Referenced by D\+H\+T\+\_\+bootstrap\+\_\+from\+\_\+address(), D\+H\+T\+\_\+connect\+\_\+after\+\_\+load(), handle\+\_\+\+L\+A\+Ndiscovery(), S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T(), and tox\+\_\+bootstrap().


\begin{DoxyCode}
1421 \{
1422     \textcolor{comment}{/*#ifdef ENABLE\_ASSOC\_DHT}
1423 \textcolor{comment}{       if (dht->assoc) \{}
1424 \textcolor{comment}{           IPPTs ippts;}
1425 \textcolor{comment}{           ippts.ip\_port = ip\_port;}
1426 \textcolor{comment}{           ippts.timestamp = 0;}
1427 \textcolor{comment}{}
1428 \textcolor{comment}{           Assoc\_add\_entry(dht->assoc, public\_key, &ippts, NULL, 0);}
1429 \textcolor{comment}{       \}}
1430 \textcolor{comment}{       #endif*/}
1431 
1432     \hyperlink{_d_h_t_8c_a7af6c30b12e5cbda1e6d6d824794956e}{getnodes}(dht, ip\_port, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, dht->\hyperlink{struct_d_h_t_ae726df8bdc26380e5a6c3187a00d6881}{self\_public\_key}, NULL);
1433 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/dad/_d_h_t_8h_ab6d732074bab2377a7884c41c219cf96_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/dad/_d_h_t_8h_ab6d732074bab2377a7884c41c219cf96_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8h_af342c78837dbed569d4a75a0516455fc}{\index{D\+H\+T.\+h@{D\+H\+T.\+h}!D\+H\+T\+\_\+bootstrap\+\_\+from\+\_\+address@{D\+H\+T\+\_\+bootstrap\+\_\+from\+\_\+address}}
\index{D\+H\+T\+\_\+bootstrap\+\_\+from\+\_\+address@{D\+H\+T\+\_\+bootstrap\+\_\+from\+\_\+address}!D\+H\+T.\+h@{D\+H\+T.\+h}}
\subsubsection[{D\+H\+T\+\_\+bootstrap\+\_\+from\+\_\+address}]{\setlength{\rightskip}{0pt plus 5cm}int D\+H\+T\+\_\+bootstrap\+\_\+from\+\_\+address (
\begin{DoxyParamCaption}
\item[{{\bf D\+H\+T} $\ast$}]{dht, }
\item[{const char $\ast$}]{address, }
\item[{uint8\+\_\+t}]{ipv6enabled, }
\item[{uint16\+\_\+t}]{port, }
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key}
\end{DoxyParamCaption}
)}}\label{_d_h_t_8h_af342c78837dbed569d4a75a0516455fc}


Definition at line 1434 of file D\+H\+T.\+c.



References addr\+\_\+resolve\+\_\+or\+\_\+parse\+\_\+ip(), D\+H\+T\+\_\+bootstrap(), I\+P\+::family, I\+P\+\_\+\+Port\+::ip, ip\+\_\+init(), ip\+\_\+isset(), ip\+\_\+reset(), port, and I\+P\+\_\+\+Port\+::port.



Referenced by bootstrap\+\_\+from\+\_\+config(), and main().


\begin{DoxyCode}
1436 \{
1437     \hyperlink{struct_i_p___port}{IP\_Port} ip\_port\_v64;
1438     \hyperlink{struct_i_p}{IP} *ip\_extra = NULL;
1439     \hyperlink{struct_i_p___port}{IP\_Port} ip\_port\_v4;
1440     \hyperlink{network_8c_a6aa0dce9c25e370af93bf4a14f79c709}{ip\_init}(&ip\_port\_v64.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}, ipv6enabled);
1441 
1442     \textcolor{keywordflow}{if} (ipv6enabled) \{
1443         \textcolor{comment}{/* setup for getting BOTH: an IPv6 AND an IPv4 address */}
1444         ip\_port\_v64.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} = AF\_UNSPEC;
1445         \hyperlink{network_8c_a2bfd1efbce5b035b10c879a7e85c08df}{ip\_reset}(&ip\_port\_v4.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip});
1446         ip\_extra = &ip\_port\_v4.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip};
1447     \}
1448 
1449     \textcolor{keywordflow}{if} (\hyperlink{network_8c_a1c024648679209a12766fedc7e55d5e4}{addr\_resolve\_or\_parse\_ip}(address, &ip\_port\_v64.
      \hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}, ip\_extra)) \{
1450         ip\_port\_v64.\hyperlink{struct_i_p___port_a8e0798404bf2cf5dabb84c5ba9a4f236}{port} = \hyperlink{irc__syncbot_8c_a8e0798404bf2cf5dabb84c5ba9a4f236}{port};
1451         \hyperlink{_d_h_t_8c_ab6d732074bab2377a7884c41c219cf96}{DHT\_bootstrap}(dht, ip\_port\_v64, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key});
1452 
1453         \textcolor{keywordflow}{if} ((ip\_extra != NULL) && \hyperlink{network_8c_ac56c677f4bc8bf8311370ee105ae7cbb}{ip\_isset}(ip\_extra)) \{
1454             ip\_port\_v4.\hyperlink{struct_i_p___port_a8e0798404bf2cf5dabb84c5ba9a4f236}{port} = \hyperlink{irc__syncbot_8c_a8e0798404bf2cf5dabb84c5ba9a4f236}{port};
1455             \hyperlink{_d_h_t_8c_ab6d732074bab2377a7884c41c219cf96}{DHT\_bootstrap}(dht, ip\_port\_v4, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key});
1456         \}
1457 
1458         \textcolor{keywordflow}{return} 1;
1459     \} \textcolor{keywordflow}{else}
1460         \textcolor{keywordflow}{return} 0;
1461 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/dad/_d_h_t_8h_af342c78837dbed569d4a75a0516455fc_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/dad/_d_h_t_8h_af342c78837dbed569d4a75a0516455fc_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8h_ad5df2ff5066cf93898e531d320ddd675}{\index{D\+H\+T.\+h@{D\+H\+T.\+h}!D\+H\+T\+\_\+connect\+\_\+after\+\_\+load@{D\+H\+T\+\_\+connect\+\_\+after\+\_\+load}}
\index{D\+H\+T\+\_\+connect\+\_\+after\+\_\+load@{D\+H\+T\+\_\+connect\+\_\+after\+\_\+load}!D\+H\+T.\+h@{D\+H\+T.\+h}}
\subsubsection[{D\+H\+T\+\_\+connect\+\_\+after\+\_\+load}]{\setlength{\rightskip}{0pt plus 5cm}int D\+H\+T\+\_\+connect\+\_\+after\+\_\+load (
\begin{DoxyParamCaption}
\item[{{\bf D\+H\+T} $\ast$}]{dht}
\end{DoxyParamCaption}
)}}\label{_d_h_t_8h_ad5df2ff5066cf93898e531d320ddd675}


Definition at line 2382 of file D\+H\+T.\+c.



References D\+H\+T\+\_\+bootstrap(), D\+H\+T\+\_\+non\+\_\+lan\+\_\+connected(), i, Node\+\_\+format\+::ip\+\_\+port, D\+H\+T\+::loaded\+\_\+nodes\+\_\+index, D\+H\+T\+::loaded\+\_\+nodes\+\_\+list, D\+H\+T\+::loaded\+\_\+num\+\_\+nodes, Node\+\_\+format\+::public\+\_\+key, and S\+A\+V\+E\+\_\+\+B\+O\+O\+T\+S\+T\+A\+P\+\_\+\+F\+R\+E\+Q\+U\+E\+N\+C\+Y.



Referenced by do\+\_\+\+D\+H\+T().


\begin{DoxyCode}
2383 \{
2384     \textcolor{keywordflow}{if} (dht == NULL)
2385         \textcolor{keywordflow}{return} -1;
2386 
2387     \textcolor{keywordflow}{if} (!dht->\hyperlink{struct_d_h_t_a3050c21873637c51d8001c807f62fa74}{loaded\_nodes\_list})
2388         \textcolor{keywordflow}{return} -1;
2389 
2390     \textcolor{comment}{/* DHT is connected, stop. */}
2391     \textcolor{keywordflow}{if} (\hyperlink{_d_h_t_8c_a90cd93b83fdec619c4924fd20c4fc005}{DHT\_non\_lan\_connected}(dht)) \{
2392         free(dht->\hyperlink{struct_d_h_t_a3050c21873637c51d8001c807f62fa74}{loaded\_nodes\_list});
2393         dht->\hyperlink{struct_d_h_t_a3050c21873637c51d8001c807f62fa74}{loaded\_nodes\_list} = NULL;
2394         dht->\hyperlink{struct_d_h_t_aef4ce67d5df5f093247c73b3a024b73e}{loaded\_num\_nodes} = 0;
2395         \textcolor{keywordflow}{return} 0;
2396     \}
2397 
2398     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
2399 
2400     \textcolor{keywordflow}{for} (i = 0; i < dht->\hyperlink{struct_d_h_t_aef4ce67d5df5f093247c73b3a024b73e}{loaded\_num\_nodes} && i < 
      \hyperlink{_d_h_t_8c_a696df5fcb740674dfec58340660641be}{SAVE\_BOOTSTAP\_FREQUENCY}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
2401         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} index = dht->\hyperlink{struct_d_h_t_a6525da58097b462adbe2ad9000a6d77d}{loaded\_nodes\_index} % dht->
      \hyperlink{struct_d_h_t_aef4ce67d5df5f093247c73b3a024b73e}{loaded\_num\_nodes};
2402         \hyperlink{_d_h_t_8c_ab6d732074bab2377a7884c41c219cf96}{DHT\_bootstrap}(dht, dht->\hyperlink{struct_d_h_t_a3050c21873637c51d8001c807f62fa74}{loaded\_nodes\_list}[index].
      \hyperlink{struct_node__format_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}, dht->\hyperlink{struct_d_h_t_a3050c21873637c51d8001c807f62fa74}{loaded\_nodes\_list}[index].\hyperlink{struct_node__format_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key});
2403         ++dht->\hyperlink{struct_d_h_t_a6525da58097b462adbe2ad9000a6d77d}{loaded\_nodes\_index};
2404     \}
2405 
2406     \textcolor{keywordflow}{return} 0;
2407 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/dad/_d_h_t_8h_ad5df2ff5066cf93898e531d320ddd675_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/dad/_d_h_t_8h_ad5df2ff5066cf93898e531d320ddd675_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8h_a4e70f3fc186c6e459908307c935d00b2}{\index{D\+H\+T.\+h@{D\+H\+T.\+h}!D\+H\+T\+\_\+delfriend@{D\+H\+T\+\_\+delfriend}}
\index{D\+H\+T\+\_\+delfriend@{D\+H\+T\+\_\+delfriend}!D\+H\+T.\+h@{D\+H\+T.\+h}}
\subsubsection[{D\+H\+T\+\_\+delfriend}]{\setlength{\rightskip}{0pt plus 5cm}int D\+H\+T\+\_\+delfriend (
\begin{DoxyParamCaption}
\item[{{\bf D\+H\+T} $\ast$}]{dht, }
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key, }
\item[{uint16\+\_\+t}]{lock\+\_\+count}
\end{DoxyParamCaption}
)}}\label{_d_h_t_8h_a4e70f3fc186c6e459908307c935d00b2}


Definition at line 1250 of file D\+H\+T.\+c.



References friend\+\_\+number(), D\+H\+T\+::friends\+\_\+list, D\+H\+T\+\_\+\+Friend\+::lock\+\_\+count, and D\+H\+T\+::num\+\_\+friends.



Referenced by change\+\_\+dht\+\_\+pk(), do\+\_\+friend\+\_\+connections(), and kill\+\_\+friend\+\_\+connection().


\begin{DoxyCode}
1251 \{
1252     \textcolor{keywordtype}{int} friend\_num = \hyperlink{_d_h_t_8c_a6cbd0f66d63003cc0def913dc7a4254b}{friend\_number}(dht, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key});
1253 
1254     \textcolor{keywordflow}{if} (friend\_num == -1) \{
1255         \textcolor{keywordflow}{return} -1;
1256     \}
1257 
1258     \hyperlink{struct_d_h_t___friend}{DHT\_Friend} *\textcolor{keyword}{friend} = &dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[friend\_num];
1259     --\textcolor{keyword}{friend}->\hyperlink{struct_d_h_t___friend_a712c4c639bfc0f5a8616eead3e24ca4e}{lock\_count};
1260 
1261     \textcolor{keywordflow}{if} (friend->lock\_count && lock\_count) \{ \textcolor{comment}{/* DHT friend is still in use.*/}
1262         --lock\_count;
1263         \textcolor{keyword}{friend}->callbacks[lock\_count].ip\_callback = NULL;
1264         \textcolor{keyword}{friend}->callbacks[lock\_count].data = NULL;
1265         \textcolor{keyword}{friend}->callbacks[lock\_count].number = 0;
1266         \textcolor{keywordflow}{return} 0;
1267     \}
1268 
1269     \hyperlink{struct_d_h_t___friend}{DHT\_Friend} *temp;
1270 
1271     --dht->\hyperlink{struct_d_h_t_a8ee1f2d7e543bce350c591a8eaac0cf8}{num\_friends};
1272 
1273     \textcolor{keywordflow}{if} (dht->\hyperlink{struct_d_h_t_a8ee1f2d7e543bce350c591a8eaac0cf8}{num\_friends} != friend\_num) \{
1274         memcpy( &dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[friend\_num],
1275                 &dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[dht->\hyperlink{struct_d_h_t_a8ee1f2d7e543bce350c591a8eaac0cf8}{num\_friends}],
1276                 \textcolor{keyword}{sizeof}(\hyperlink{struct_d_h_t___friend}{DHT\_Friend}) );
1277     \}
1278 
1279     \textcolor{keywordflow}{if} (dht->\hyperlink{struct_d_h_t_a8ee1f2d7e543bce350c591a8eaac0cf8}{num\_friends} == 0) \{
1280         free(dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list});
1281         dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list} = NULL;
1282         \textcolor{keywordflow}{return} 0;
1283     \}
1284 
1285     temp = realloc(dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}, \textcolor{keyword}{sizeof}(\hyperlink{struct_d_h_t___friend}{DHT\_Friend}) * (dht->
      \hyperlink{struct_d_h_t_a8ee1f2d7e543bce350c591a8eaac0cf8}{num\_friends}));
1286 
1287     \textcolor{keywordflow}{if} (temp == NULL)
1288         \textcolor{keywordflow}{return} -1;
1289 
1290     dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list} = temp;
1291     \textcolor{keywordflow}{return} 0;
1292 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/dad/_d_h_t_8h_a4e70f3fc186c6e459908307c935d00b2_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/dad/_d_h_t_8h_a4e70f3fc186c6e459908307c935d00b2_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8h_a9e92f7714ab1f2b37b54e8479717cbc7}{\index{D\+H\+T.\+h@{D\+H\+T.\+h}!D\+H\+T\+\_\+get\+\_\+shared\+\_\+key\+\_\+recv@{D\+H\+T\+\_\+get\+\_\+shared\+\_\+key\+\_\+recv}}
\index{D\+H\+T\+\_\+get\+\_\+shared\+\_\+key\+\_\+recv@{D\+H\+T\+\_\+get\+\_\+shared\+\_\+key\+\_\+recv}!D\+H\+T.\+h@{D\+H\+T.\+h}}
\subsubsection[{D\+H\+T\+\_\+get\+\_\+shared\+\_\+key\+\_\+recv}]{\setlength{\rightskip}{0pt plus 5cm}void D\+H\+T\+\_\+get\+\_\+shared\+\_\+key\+\_\+recv (
\begin{DoxyParamCaption}
\item[{{\bf D\+H\+T} $\ast$}]{dht, }
\item[{uint8\+\_\+t $\ast$}]{shared\+\_\+key, }
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key}
\end{DoxyParamCaption}
)}}\label{_d_h_t_8h_a9e92f7714ab1f2b37b54e8479717cbc7}


Definition at line 146 of file D\+H\+T.\+c.



References get\+\_\+shared\+\_\+key(), D\+H\+T\+::self\+\_\+secret\+\_\+key, and D\+H\+T\+::shared\+\_\+keys\+\_\+recv.



Referenced by handle\+\_\+getnodes(), and handle\+\_\+ping\+\_\+request().


\begin{DoxyCode}
147 \{
148     \hyperlink{_d_h_t_8c_a6cd4aa89d7bfcf6805c5ce6b273d9e9e}{get\_shared\_key}(&dht->\hyperlink{struct_d_h_t_a4c647e235c4b9d2d6d68d760c7cb1b30}{shared\_keys\_recv}, shared\_key, dht->
      \hyperlink{struct_d_h_t_aa05050f86513ff53fe9da81f73c72267}{self\_secret\_key}, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key});
149 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/dad/_d_h_t_8h_a9e92f7714ab1f2b37b54e8479717cbc7_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/dad/_d_h_t_8h_a9e92f7714ab1f2b37b54e8479717cbc7_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8h_a087cceeacc5a14415b651c2980a24d34}{\index{D\+H\+T.\+h@{D\+H\+T.\+h}!D\+H\+T\+\_\+get\+\_\+shared\+\_\+key\+\_\+sent@{D\+H\+T\+\_\+get\+\_\+shared\+\_\+key\+\_\+sent}}
\index{D\+H\+T\+\_\+get\+\_\+shared\+\_\+key\+\_\+sent@{D\+H\+T\+\_\+get\+\_\+shared\+\_\+key\+\_\+sent}!D\+H\+T.\+h@{D\+H\+T.\+h}}
\subsubsection[{D\+H\+T\+\_\+get\+\_\+shared\+\_\+key\+\_\+sent}]{\setlength{\rightskip}{0pt plus 5cm}void D\+H\+T\+\_\+get\+\_\+shared\+\_\+key\+\_\+sent (
\begin{DoxyParamCaption}
\item[{{\bf D\+H\+T} $\ast$}]{dht, }
\item[{uint8\+\_\+t $\ast$}]{shared\+\_\+key, }
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key}
\end{DoxyParamCaption}
)}}\label{_d_h_t_8h_a087cceeacc5a14415b651c2980a24d34}


Definition at line 154 of file D\+H\+T.\+c.



References get\+\_\+shared\+\_\+key(), D\+H\+T\+::self\+\_\+secret\+\_\+key, and D\+H\+T\+::shared\+\_\+keys\+\_\+sent.



Referenced by create\+\_\+cookie\+\_\+request(), getnodes(), handle\+\_\+cookie\+\_\+request(), handle\+\_\+ping\+\_\+response(), handle\+\_\+sendnodes\+\_\+core(), and send\+\_\+ping\+\_\+request().


\begin{DoxyCode}
155 \{
156     \hyperlink{_d_h_t_8c_a6cd4aa89d7bfcf6805c5ce6b273d9e9e}{get\_shared\_key}(&dht->\hyperlink{struct_d_h_t_a07b2f51891b851ec0cd7dfe729412f77}{shared\_keys\_sent}, shared\_key, dht->
      \hyperlink{struct_d_h_t_aa05050f86513ff53fe9da81f73c72267}{self\_secret\_key}, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key});
157 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/dad/_d_h_t_8h_a087cceeacc5a14415b651c2980a24d34_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/dad/_d_h_t_8h_a087cceeacc5a14415b651c2980a24d34_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8h_a963cf2afd9283277f69a94381e3fc5f0}{\index{D\+H\+T.\+h@{D\+H\+T.\+h}!D\+H\+T\+\_\+getfriendip@{D\+H\+T\+\_\+getfriendip}}
\index{D\+H\+T\+\_\+getfriendip@{D\+H\+T\+\_\+getfriendip}!D\+H\+T.\+h@{D\+H\+T.\+h}}
\subsubsection[{D\+H\+T\+\_\+getfriendip}]{\setlength{\rightskip}{0pt plus 5cm}int D\+H\+T\+\_\+getfriendip (
\begin{DoxyParamCaption}
\item[{const {\bf D\+H\+T} $\ast$}]{dht, }
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key, }
\item[{{\bf I\+P\+\_\+\+Port} $\ast$}]{ip\+\_\+port}
\end{DoxyParamCaption}
)}}\label{_d_h_t_8h_a963cf2afd9283277f69a94381e3fc5f0}


Definition at line 1295 of file D\+H\+T.\+c.



References Client\+\_\+data\+::assoc6, B\+A\+D\+\_\+\+N\+O\+D\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T, D\+H\+T\+\_\+\+Friend\+::client\+\_\+list, D\+H\+T\+::friends\+\_\+list, i, id\+\_\+equal(), I\+P\+\_\+\+Port\+::ip, I\+P\+P\+Ts\+Png\+::ip\+\_\+port, ip\+\_\+reset(), is\+\_\+timeout(), M\+A\+X\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+C\+L\+I\+E\+N\+T\+S, D\+H\+T\+::num\+\_\+friends, I\+P\+\_\+\+Port\+::port, Client\+\_\+data\+::public\+\_\+key, D\+H\+T\+\_\+\+Friend\+::public\+\_\+key, and I\+P\+P\+Ts\+Png\+::timestamp.



Referenced by onion\+\_\+getfriendip(), and print\+\_\+friendlist().


\begin{DoxyCode}
1296 \{
1297     uint32\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}, j;
1298 
1299     \hyperlink{network_8c_a2bfd1efbce5b035b10c879a7e85c08df}{ip\_reset}(&ip\_port->\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip});
1300     ip\_port->\hyperlink{struct_i_p___port_a8e0798404bf2cf5dabb84c5ba9a4f236}{port} = 0;
1301 
1302     \textcolor{keywordflow}{for} (i = 0; i < dht->\hyperlink{struct_d_h_t_a8ee1f2d7e543bce350c591a8eaac0cf8}{num\_friends}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
1303         \textcolor{comment}{/* Equal */}
1304         \textcolor{keywordflow}{if} (\hyperlink{util_8c_ada3d44b4f530d3c8c9cb69b732be94b1}{id\_equal}(dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[i].\hyperlink{struct_d_h_t___friend_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, 
      \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key})) \{
1305             \textcolor{keywordflow}{for} (j = 0; j < \hyperlink{_d_h_t_8h_ad50d158518277ca4d19cbe364f3e958c}{MAX\_FRIEND\_CLIENTS}; ++j) \{
1306                 \hyperlink{struct_client__data}{Client\_data} *client = &dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[
      \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}].\hyperlink{struct_d_h_t___friend_a49ef2b640a834a77b6e123355a4fea47}{client\_list}[j];
1307 
1308                 \textcolor{keywordflow}{if} (\hyperlink{util_8c_ada3d44b4f530d3c8c9cb69b732be94b1}{id\_equal}(client->\hyperlink{struct_client__data_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key})) \{
1309                     \hyperlink{struct_i_p_p_ts_png}{IPPTsPng} *assoc = NULL;
1310                     uint32\_t a;
1311 
1312                     \textcolor{keywordflow}{for} (a = 0, assoc = &client->\hyperlink{struct_client__data_a87d394929a2604f6f785fec949fac618}{assoc6}; a < 2; a++, assoc = &client->assoc4)
1313                         \textcolor{keywordflow}{if} (!\hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(assoc->\hyperlink{struct_i_p_p_ts_png_a465bef81f6478756e5443025b1f2ddfa}{timestamp}, 
      \hyperlink{_d_h_t_8h_a2c542fd03a43f340d1fb281afe54453f}{BAD\_NODE\_TIMEOUT})) \{
1314                             *ip\_port = assoc->\hyperlink{struct_i_p_p_ts_png_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port};
1315                             \textcolor{keywordflow}{return} 1;
1316                         \}
1317                 \}
1318             \}
1319 
1320             \textcolor{keywordflow}{return} 0;
1321         \}
1322     \}
1323 
1324     \textcolor{keywordflow}{return} -1;
1325 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/dad/_d_h_t_8h_a963cf2afd9283277f69a94381e3fc5f0_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/dad/_d_h_t_8h_a963cf2afd9283277f69a94381e3fc5f0_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8h_a769ef744f969e1b4c55547cb74abee59}{\index{D\+H\+T.\+h@{D\+H\+T.\+h}!D\+H\+T\+\_\+getnodes@{D\+H\+T\+\_\+getnodes}}
\index{D\+H\+T\+\_\+getnodes@{D\+H\+T\+\_\+getnodes}!D\+H\+T.\+h@{D\+H\+T.\+h}}
\subsubsection[{D\+H\+T\+\_\+getnodes}]{\setlength{\rightskip}{0pt plus 5cm}void D\+H\+T\+\_\+getnodes (
\begin{DoxyParamCaption}
\item[{{\bf D\+H\+T} $\ast$}]{dht, }
\item[{const {\bf I\+P\+\_\+\+Port} $\ast$}]{from\+\_\+ipp, }
\item[{const uint8\+\_\+t $\ast$}]{from\+\_\+id, }
\item[{const uint8\+\_\+t $\ast$}]{which\+\_\+id}
\end{DoxyParamCaption}
)}}\label{_d_h_t_8h_a769ef744f969e1b4c55547cb74abee59}


Definition at line 1415 of file D\+H\+T.\+c.



References getnodes().



Referenced by do\+\_\+\+Assoc(), and handle\+\_\+dhtpk\+\_\+announce().


\begin{DoxyCode}
1416 \{
1417     \hyperlink{_d_h_t_8c_a7af6c30b12e5cbda1e6d6d824794956e}{getnodes}(dht, *from\_ipp, from\_id, which\_id, NULL);
1418 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/dad/_d_h_t_8h_a769ef744f969e1b4c55547cb74abee59_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/dad/_d_h_t_8h_a769ef744f969e1b4c55547cb74abee59_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8h_a93770fe498d41d1c6b420275680967b6}{\index{D\+H\+T.\+h@{D\+H\+T.\+h}!D\+H\+T\+\_\+isconnected@{D\+H\+T\+\_\+isconnected}}
\index{D\+H\+T\+\_\+isconnected@{D\+H\+T\+\_\+isconnected}!D\+H\+T.\+h@{D\+H\+T.\+h}}
\subsubsection[{D\+H\+T\+\_\+isconnected}]{\setlength{\rightskip}{0pt plus 5cm}int D\+H\+T\+\_\+isconnected (
\begin{DoxyParamCaption}
\item[{const {\bf D\+H\+T} $\ast$}]{dht}
\end{DoxyParamCaption}
)}}\label{_d_h_t_8h_a93770fe498d41d1c6b420275680967b6}


Definition at line 2471 of file D\+H\+T.\+c.



References Client\+\_\+data\+::assoc4, Client\+\_\+data\+::assoc6, B\+A\+D\+\_\+\+N\+O\+D\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T, D\+H\+T\+::close\+\_\+clientlist, i, is\+\_\+timeout(), L\+C\+L\+I\+E\+N\+T\+\_\+\+L\+I\+S\+T, I\+P\+P\+Ts\+Png\+::timestamp, and unix\+\_\+time\+\_\+update().



Referenced by do\+\_\+tox(), main(), random\+\_\+nodes\+\_\+path\+\_\+onion(), and S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T().


\begin{DoxyCode}
2472 \{
2473     uint32\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
2474     \hyperlink{util_8c_a849af10dd491723cf3abdef599846897}{unix\_time\_update}();
2475 
2476     \textcolor{keywordflow}{for} (i = 0; i < \hyperlink{_d_h_t_8h_a3058f857a8316099e20c95fb07adc7c1}{LCLIENT\_LIST}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
2477         \textcolor{keyword}{const} \hyperlink{struct_client__data}{Client\_data} *client = &dht->\hyperlink{struct_d_h_t_a00ef35d5b0e7a791ef08a30b3bacbf9d}{close\_clientlist}[
      \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}];
2478 
2479         \textcolor{keywordflow}{if} (!\hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(client->\hyperlink{struct_client__data_ac9843379cbcd02bdfa5c180a1474a6c5}{assoc4}.\hyperlink{struct_i_p_p_ts_png_a465bef81f6478756e5443025b1f2ddfa}{timestamp}, 
      \hyperlink{_d_h_t_8h_a2c542fd03a43f340d1fb281afe54453f}{BAD\_NODE\_TIMEOUT}) ||
2480                 !\hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(client->\hyperlink{struct_client__data_a87d394929a2604f6f785fec949fac618}{assoc6}.\hyperlink{struct_i_p_p_ts_png_a465bef81f6478756e5443025b1f2ddfa}{timestamp}, 
      \hyperlink{_d_h_t_8h_a2c542fd03a43f340d1fb281afe54453f}{BAD\_NODE\_TIMEOUT}))
2481             \textcolor{keywordflow}{return} 1;
2482     \}
2483 
2484     \textcolor{keywordflow}{return} 0;
2485 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/dad/_d_h_t_8h_a93770fe498d41d1c6b420275680967b6_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/dad/_d_h_t_8h_a93770fe498d41d1c6b420275680967b6_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8h_a36e42ad71b293cd0ada8a7b6de9ad86b}{\index{D\+H\+T.\+h@{D\+H\+T.\+h}!D\+H\+T\+\_\+load@{D\+H\+T\+\_\+load}}
\index{D\+H\+T\+\_\+load@{D\+H\+T\+\_\+load}!D\+H\+T.\+h@{D\+H\+T.\+h}}
\subsubsection[{D\+H\+T\+\_\+load}]{\setlength{\rightskip}{0pt plus 5cm}int D\+H\+T\+\_\+load (
\begin{DoxyParamCaption}
\item[{{\bf D\+H\+T} $\ast$}]{dht, }
\item[{const uint8\+\_\+t $\ast$}]{data, }
\item[{uint32\+\_\+t}]{length}
\end{DoxyParamCaption}
)}}\label{_d_h_t_8h_a36e42ad71b293cd0ada8a7b6de9ad86b}


Definition at line 2452 of file D\+H\+T.\+c.



References dht\+\_\+load\+\_\+state\+\_\+callback(), D\+H\+T\+\_\+\+S\+T\+A\+T\+E\+\_\+\+C\+O\+O\+K\+I\+E\+\_\+\+G\+L\+O\+B\+A\+L, D\+H\+T\+\_\+\+S\+T\+A\+T\+E\+\_\+\+C\+O\+O\+K\+I\+E\+\_\+\+T\+Y\+P\+E, lendian\+\_\+to\+\_\+host32(), and load\+\_\+state().



Referenced by messenger\+\_\+load\+\_\+state\+\_\+callback(), and S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T().


\begin{DoxyCode}
2453 \{
2454     uint32\_t cookie\_len = \textcolor{keyword}{sizeof}(uint32\_t);
2455 
2456     \textcolor{keywordflow}{if} (length > cookie\_len) \{
2457         uint32\_t data32;
2458         \hyperlink{util_8c_a4a7b1a2d62e6d6842bc0fefece837ad2}{lendian\_to\_host32}(&data32, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data});
2459 
2460         \textcolor{keywordflow}{if} (data32 == \hyperlink{_d_h_t_8c_a6a842db82e30616af13990781cf13ab3}{DHT\_STATE\_COOKIE\_GLOBAL})
2461             \textcolor{keywordflow}{return} \hyperlink{util_8c_a779943554d12b56f6e35e8f5ba2cf7f5}{load\_state}(\hyperlink{_d_h_t_8c_a266c420f5eb745eddcf184e316b157be}{dht\_load\_state\_callback}, dht, 
      \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} + cookie\_len,
2462                               length - cookie\_len, \hyperlink{_d_h_t_8c_a48a9324191a79b2e05af9b6499addba6}{DHT\_STATE\_COOKIE\_TYPE});
2463     \}
2464 
2465     \textcolor{keywordflow}{return} -1;
2466 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/dad/_d_h_t_8h_a36e42ad71b293cd0ada8a7b6de9ad86b_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/dad/_d_h_t_8h_a36e42ad71b293cd0ada8a7b6de9ad86b_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8h_a90cd93b83fdec619c4924fd20c4fc005}{\index{D\+H\+T.\+h@{D\+H\+T.\+h}!D\+H\+T\+\_\+non\+\_\+lan\+\_\+connected@{D\+H\+T\+\_\+non\+\_\+lan\+\_\+connected}}
\index{D\+H\+T\+\_\+non\+\_\+lan\+\_\+connected@{D\+H\+T\+\_\+non\+\_\+lan\+\_\+connected}!D\+H\+T.\+h@{D\+H\+T.\+h}}
\subsubsection[{D\+H\+T\+\_\+non\+\_\+lan\+\_\+connected}]{\setlength{\rightskip}{0pt plus 5cm}int D\+H\+T\+\_\+non\+\_\+lan\+\_\+connected (
\begin{DoxyParamCaption}
\item[{const {\bf D\+H\+T} $\ast$}]{dht}
\end{DoxyParamCaption}
)}}\label{_d_h_t_8h_a90cd93b83fdec619c4924fd20c4fc005}


Definition at line 2490 of file D\+H\+T.\+c.



References Client\+\_\+data\+::assoc4, Client\+\_\+data\+::assoc6, B\+A\+D\+\_\+\+N\+O\+D\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T, D\+H\+T\+::close\+\_\+clientlist, i, I\+P\+\_\+\+Port\+::ip, I\+P\+P\+Ts\+Png\+::ip\+\_\+port, is\+\_\+timeout(), L\+A\+N\+\_\+ip(), L\+C\+L\+I\+E\+N\+T\+\_\+\+L\+I\+S\+T, I\+P\+P\+Ts\+Png\+::timestamp, and unix\+\_\+time\+\_\+update().



Referenced by D\+H\+T\+\_\+connect\+\_\+after\+\_\+load(), and do\+\_\+onion\+\_\+client().


\begin{DoxyCode}
2491 \{
2492     uint32\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
2493     \hyperlink{util_8c_a849af10dd491723cf3abdef599846897}{unix\_time\_update}();
2494 
2495     \textcolor{keywordflow}{for} (i = 0; i < \hyperlink{_d_h_t_8h_a3058f857a8316099e20c95fb07adc7c1}{LCLIENT\_LIST}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
2496         \textcolor{keyword}{const} \hyperlink{struct_client__data}{Client\_data} *client = &dht->\hyperlink{struct_d_h_t_a00ef35d5b0e7a791ef08a30b3bacbf9d}{close\_clientlist}[
      \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}];
2497 
2498         \textcolor{keywordflow}{if} (!\hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(client->\hyperlink{struct_client__data_ac9843379cbcd02bdfa5c180a1474a6c5}{assoc4}.\hyperlink{struct_i_p_p_ts_png_a465bef81f6478756e5443025b1f2ddfa}{timestamp}, 
      \hyperlink{_d_h_t_8h_a2c542fd03a43f340d1fb281afe54453f}{BAD\_NODE\_TIMEOUT}) && \hyperlink{_l_a_n__discovery_8c_a2d80a53390598eb8ededbc63f4e9c152}{LAN\_ip}(client->\hyperlink{struct_client__data_ac9843379cbcd02bdfa5c180a1474a6c5}{assoc4}.\hyperlink{struct_i_p_p_ts_png_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}.
      \hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}) == -1)
2499             \textcolor{keywordflow}{return} 1;
2500 
2501         \textcolor{keywordflow}{if} (!\hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(client->\hyperlink{struct_client__data_a87d394929a2604f6f785fec949fac618}{assoc6}.\hyperlink{struct_i_p_p_ts_png_a465bef81f6478756e5443025b1f2ddfa}{timestamp}, 
      \hyperlink{_d_h_t_8h_a2c542fd03a43f340d1fb281afe54453f}{BAD\_NODE\_TIMEOUT}) && \hyperlink{_l_a_n__discovery_8c_a2d80a53390598eb8ededbc63f4e9c152}{LAN\_ip}(client->\hyperlink{struct_client__data_a87d394929a2604f6f785fec949fac618}{assoc6}.\hyperlink{struct_i_p_p_ts_png_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}.
      \hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}) == -1)
2502             \textcolor{keywordflow}{return} 1;
2503 
2504     \}
2505 
2506     \textcolor{keywordflow}{return} 0;
2507 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/dad/_d_h_t_8h_a90cd93b83fdec619c4924fd20c4fc005_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/dad/_d_h_t_8h_a90cd93b83fdec619c4924fd20c4fc005_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8h_a7510a9fdbacfffb5987590c4e193c40a}{\index{D\+H\+T.\+h@{D\+H\+T.\+h}!D\+H\+T\+\_\+save@{D\+H\+T\+\_\+save}}
\index{D\+H\+T\+\_\+save@{D\+H\+T\+\_\+save}!D\+H\+T.\+h@{D\+H\+T.\+h}}
\subsubsection[{D\+H\+T\+\_\+save}]{\setlength{\rightskip}{0pt plus 5cm}void D\+H\+T\+\_\+save (
\begin{DoxyParamCaption}
\item[{{\bf D\+H\+T} $\ast$}]{dht, }
\item[{uint8\+\_\+t $\ast$}]{data}
\end{DoxyParamCaption}
)}}\label{_d_h_t_8h_a7510a9fdbacfffb5987590c4e193c40a}


Definition at line 2329 of file D\+H\+T.\+c.



References Client\+\_\+data\+::assoc4, Client\+\_\+data\+::assoc6, D\+H\+T\+\_\+\+Friend\+::client\+\_\+list, D\+H\+T\+::close\+\_\+clientlist, make-\/funny-\/savefile\+::data, D\+H\+T\+\_\+\+F\+A\+K\+E\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+N\+U\+M\+B\+E\+R, D\+H\+T\+\_\+\+S\+T\+A\+T\+E\+\_\+\+C\+O\+O\+K\+I\+E\+\_\+\+G\+L\+O\+B\+A\+L, D\+H\+T\+\_\+\+S\+T\+A\+T\+E\+\_\+\+T\+Y\+P\+E\+\_\+\+N\+O\+D\+E\+S, D\+H\+T\+::friends\+\_\+list, host\+\_\+to\+\_\+lendian32(), i, I\+P\+P\+Ts\+Png\+::ip\+\_\+port, Node\+\_\+format\+::ip\+\_\+port, L\+C\+L\+I\+E\+N\+T\+\_\+\+L\+I\+S\+T, M\+A\+X\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+C\+L\+I\+E\+N\+T\+S, M\+A\+X\+\_\+\+S\+A\+V\+E\+D\+\_\+\+D\+H\+T\+\_\+\+N\+O\+D\+E\+S, num, D\+H\+T\+::num\+\_\+friends, pack\+\_\+nodes(), Client\+\_\+data\+::public\+\_\+key, I\+P\+P\+Ts\+Png\+::timestamp, and z\+\_\+state\+\_\+save\+\_\+subheader().



Referenced by messenger\+\_\+save(), and S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T().


\begin{DoxyCode}
2330 \{
2331     \hyperlink{util_8c_aebd439a002cb183420a08996f7ffdbef}{host\_to\_lendian32}(\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data},  \hyperlink{_d_h_t_8c_a6a842db82e30616af13990781cf13ab3}{DHT\_STATE\_COOKIE\_GLOBAL});
2332     \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} += \textcolor{keyword}{sizeof}(uint32\_t);
2333 
2334     uint32\_t \hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num}, \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}, j;
2335 
2336     uint8\_t *old\_data = \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data};
2337 
2338     \textcolor{comment}{/* get right offset. we write the actual header later. */}
2339     \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} = \hyperlink{_d_h_t_8c_a910e4555ff14d9974e6f1dd227d8dd99}{z\_state\_save\_subheader}(\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}, 0, 0);
2340 
2341     \hyperlink{struct_node__format}{Node\_format} clients[\hyperlink{_d_h_t_8c_a4ebd02f5b13bf2d343bef7c55b88ef93}{MAX\_SAVED\_DHT\_NODES}];
2342 
2343     \textcolor{keywordflow}{for} (num = 0, i = 0; i < \hyperlink{_d_h_t_8h_a3058f857a8316099e20c95fb07adc7c1}{LCLIENT\_LIST}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
2344         \textcolor{keywordflow}{if} (dht->\hyperlink{struct_d_h_t_a00ef35d5b0e7a791ef08a30b3bacbf9d}{close\_clientlist}[i].\hyperlink{struct_client__data_ac9843379cbcd02bdfa5c180a1474a6c5}{assoc4}.\hyperlink{struct_i_p_p_ts_png_a465bef81f6478756e5443025b1f2ddfa}{timestamp} != 0) \{
2345             memcpy(clients[num].\hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, dht->\hyperlink{struct_d_h_t_a00ef35d5b0e7a791ef08a30b3bacbf9d}{close\_clientlist}[i].
      \hyperlink{struct_client__data_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, crypto\_box\_PUBLICKEYBYTES);
2346             clients[\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num}].\hyperlink{struct_node__format_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port} = dht->\hyperlink{struct_d_h_t_a00ef35d5b0e7a791ef08a30b3bacbf9d}{close\_clientlist}[
      \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}].\hyperlink{struct_client__data_ac9843379cbcd02bdfa5c180a1474a6c5}{assoc4}.\hyperlink{struct_i_p_p_ts_png_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port};
2347             ++\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num};
2348         \}
2349 
2350         \textcolor{keywordflow}{if} (dht->\hyperlink{struct_d_h_t_a00ef35d5b0e7a791ef08a30b3bacbf9d}{close\_clientlist}[i].\hyperlink{struct_client__data_a87d394929a2604f6f785fec949fac618}{assoc6}.\hyperlink{struct_i_p_p_ts_png_a465bef81f6478756e5443025b1f2ddfa}{timestamp} != 0) \{
2351             memcpy(clients[num].\hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, dht->\hyperlink{struct_d_h_t_a00ef35d5b0e7a791ef08a30b3bacbf9d}{close\_clientlist}[i].
      \hyperlink{struct_client__data_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, crypto\_box\_PUBLICKEYBYTES);
2352             clients[\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num}].\hyperlink{struct_node__format_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port} = dht->\hyperlink{struct_d_h_t_a00ef35d5b0e7a791ef08a30b3bacbf9d}{close\_clientlist}[
      \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}].\hyperlink{struct_client__data_a87d394929a2604f6f785fec949fac618}{assoc6}.\hyperlink{struct_i_p_p_ts_png_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port};
2353             ++\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num};
2354         \}
2355     \}
2356 
2357     \textcolor{keywordflow}{for} (i = 0; i < \hyperlink{_d_h_t_8h_a09839809f361926e324196bfd9450bb4}{DHT\_FAKE\_FRIEND\_NUMBER} && i < dht->
      \hyperlink{struct_d_h_t_a8ee1f2d7e543bce350c591a8eaac0cf8}{num\_friends}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
2358         \hyperlink{struct_d_h_t___friend}{DHT\_Friend} *fr = &dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}];
2359 
2360         \textcolor{keywordflow}{for} (j = 0; j < \hyperlink{_d_h_t_8h_ad50d158518277ca4d19cbe364f3e958c}{MAX\_FRIEND\_CLIENTS}; ++j) \{
2361             \textcolor{keywordflow}{if} (fr->\hyperlink{struct_d_h_t___friend_a49ef2b640a834a77b6e123355a4fea47}{client\_list}[j].\hyperlink{struct_client__data_ac9843379cbcd02bdfa5c180a1474a6c5}{assoc4}.\hyperlink{struct_i_p_p_ts_png_a465bef81f6478756e5443025b1f2ddfa}{timestamp} != 0) \{
2362                 memcpy(clients[num].\hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, fr->\hyperlink{struct_d_h_t___friend_a49ef2b640a834a77b6e123355a4fea47}{client\_list}[j].
      \hyperlink{struct_client__data_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, crypto\_box\_PUBLICKEYBYTES);
2363                 clients[\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num}].\hyperlink{struct_node__format_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port} = fr->\hyperlink{struct_d_h_t___friend_a49ef2b640a834a77b6e123355a4fea47}{client\_list}[j].
      \hyperlink{struct_client__data_ac9843379cbcd02bdfa5c180a1474a6c5}{assoc4}.\hyperlink{struct_i_p_p_ts_png_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port};
2364                 ++\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num};
2365             \}
2366 
2367             \textcolor{keywordflow}{if} (fr->\hyperlink{struct_d_h_t___friend_a49ef2b640a834a77b6e123355a4fea47}{client\_list}[j].\hyperlink{struct_client__data_a87d394929a2604f6f785fec949fac618}{assoc6}.\hyperlink{struct_i_p_p_ts_png_a465bef81f6478756e5443025b1f2ddfa}{timestamp} != 0) \{
2368                 memcpy(clients[num].\hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, fr->\hyperlink{struct_d_h_t___friend_a49ef2b640a834a77b6e123355a4fea47}{client\_list}[j].
      \hyperlink{struct_client__data_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, crypto\_box\_PUBLICKEYBYTES);
2369                 clients[\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num}].\hyperlink{struct_node__format_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port} = fr->\hyperlink{struct_d_h_t___friend_a49ef2b640a834a77b6e123355a4fea47}{client\_list}[j].
      \hyperlink{struct_client__data_a87d394929a2604f6f785fec949fac618}{assoc6}.\hyperlink{struct_i_p_p_ts_png_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port};
2370                 ++\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num};
2371             \}
2372         \}
2373     \}
2374 
2375     \hyperlink{_d_h_t_8c_a910e4555ff14d9974e6f1dd227d8dd99}{z\_state\_save\_subheader}(old\_data, \hyperlink{_d_h_t_8c_a1d6f2fcb008c989f333ae89e840f94b4}{pack\_nodes}(
      \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}, \textcolor{keyword}{sizeof}(\hyperlink{struct_node__format}{Node\_format}) * num, clients, num), 
      \hyperlink{_d_h_t_8c_a2244b83e3fbf401e240bb5fa9a576e9e}{DHT\_STATE\_TYPE\_NODES});
2376 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/dad/_d_h_t_8h_a7510a9fdbacfffb5987590c4e193c40a_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/dad/_d_h_t_8h_a7510a9fdbacfffb5987590c4e193c40a_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8h_a55d92a2419bf9384e3cbfe0ec5a8f4d6}{\index{D\+H\+T.\+h@{D\+H\+T.\+h}!D\+H\+T\+\_\+size@{D\+H\+T\+\_\+size}}
\index{D\+H\+T\+\_\+size@{D\+H\+T\+\_\+size}!D\+H\+T.\+h@{D\+H\+T.\+h}}
\subsubsection[{D\+H\+T\+\_\+size}]{\setlength{\rightskip}{0pt plus 5cm}uint32\+\_\+t D\+H\+T\+\_\+size (
\begin{DoxyParamCaption}
\item[{const {\bf D\+H\+T} $\ast$}]{dht}
\end{DoxyParamCaption}
)}}\label{_d_h_t_8h_a55d92a2419bf9384e3cbfe0ec5a8f4d6}


Definition at line 2295 of file D\+H\+T.\+c.



References Client\+\_\+data\+::assoc4, Client\+\_\+data\+::assoc6, D\+H\+T\+\_\+\+Friend\+::client\+\_\+list, D\+H\+T\+::close\+\_\+clientlist, D\+H\+T\+\_\+\+F\+A\+K\+E\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+N\+U\+M\+B\+E\+R, D\+H\+T\+::friends\+\_\+list, i, L\+C\+L\+I\+E\+N\+T\+\_\+\+L\+I\+S\+T, M\+A\+X\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+C\+L\+I\+E\+N\+T\+S, D\+H\+T\+::num\+\_\+friends, packed\+\_\+node\+\_\+size(), and I\+P\+P\+Ts\+Png\+::timestamp.



Referenced by messenger\+\_\+save(), messenger\+\_\+size(), and S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T().


\begin{DoxyCode}
2296 \{
2297     uint32\_t numv4 = 0, numv6 = 0, \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}, j;
2298 
2299     \textcolor{keywordflow}{for} (\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i} = 0; \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i} < \hyperlink{_d_h_t_8h_a3058f857a8316099e20c95fb07adc7c1}{LCLIENT\_LIST}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
2300         numv4 += (dht->\hyperlink{struct_d_h_t_a00ef35d5b0e7a791ef08a30b3bacbf9d}{close\_clientlist}[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}].\hyperlink{struct_client__data_ac9843379cbcd02bdfa5c180a1474a6c5}{assoc4}.
      \hyperlink{struct_i_p_p_ts_png_a465bef81f6478756e5443025b1f2ddfa}{timestamp} != 0);
2301         numv6 += (dht->\hyperlink{struct_d_h_t_a00ef35d5b0e7a791ef08a30b3bacbf9d}{close\_clientlist}[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}].\hyperlink{struct_client__data_a87d394929a2604f6f785fec949fac618}{assoc6}.
      \hyperlink{struct_i_p_p_ts_png_a465bef81f6478756e5443025b1f2ddfa}{timestamp} != 0);
2302     \}
2303 
2304     \textcolor{keywordflow}{for} (\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i} = 0; \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i} < \hyperlink{_d_h_t_8h_a09839809f361926e324196bfd9450bb4}{DHT\_FAKE\_FRIEND\_NUMBER} && \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i} < dht->
      \hyperlink{struct_d_h_t_a8ee1f2d7e543bce350c591a8eaac0cf8}{num\_friends}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
2305         \hyperlink{struct_d_h_t___friend}{DHT\_Friend} *fr = &dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}];
2306 
2307         \textcolor{keywordflow}{for} (j = 0; j < \hyperlink{_d_h_t_8h_ad50d158518277ca4d19cbe364f3e958c}{MAX\_FRIEND\_CLIENTS}; ++j) \{
2308             numv4 += (fr->\hyperlink{struct_d_h_t___friend_a49ef2b640a834a77b6e123355a4fea47}{client\_list}[j].\hyperlink{struct_client__data_ac9843379cbcd02bdfa5c180a1474a6c5}{assoc4}.\hyperlink{struct_i_p_p_ts_png_a465bef81f6478756e5443025b1f2ddfa}{timestamp} != 0);
2309             numv6 += (fr->\hyperlink{struct_d_h_t___friend_a49ef2b640a834a77b6e123355a4fea47}{client\_list}[j].\hyperlink{struct_client__data_a87d394929a2604f6f785fec949fac618}{assoc6}.\hyperlink{struct_i_p_p_ts_png_a465bef81f6478756e5443025b1f2ddfa}{timestamp} != 0);
2310         \}
2311     \}
2312 
2313     uint32\_t size32 = \textcolor{keyword}{sizeof}(uint32\_t), sizesubhead = size32 * 2;
2314 
2315     \textcolor{keywordflow}{return} size32 + sizesubhead + (\hyperlink{_d_h_t_8c_aa980937ac320a4389b726e04da26cb44}{packed\_node\_size}(AF\_INET) * numv4) + (
      \hyperlink{_d_h_t_8c_aa980937ac320a4389b726e04da26cb44}{packed\_node\_size}(AF\_INET6) * numv6);
2316 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=275pt]{df/dad/_d_h_t_8h_a55d92a2419bf9384e3cbfe0ec5a8f4d6_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/dad/_d_h_t_8h_a55d92a2419bf9384e3cbfe0ec5a8f4d6_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8h_a5be9dfb66fbf1fa7c267b016f3357534}{\index{D\+H\+T.\+h@{D\+H\+T.\+h}!do\+\_\+\+D\+H\+T@{do\+\_\+\+D\+H\+T}}
\index{do\+\_\+\+D\+H\+T@{do\+\_\+\+D\+H\+T}!D\+H\+T.\+h@{D\+H\+T.\+h}}
\subsubsection[{do\+\_\+\+D\+H\+T}]{\setlength{\rightskip}{0pt plus 5cm}void do\+\_\+\+D\+H\+T (
\begin{DoxyParamCaption}
\item[{{\bf D\+H\+T} $\ast$}]{dht}
\end{DoxyParamCaption}
)}}\label{_d_h_t_8h_a5be9dfb66fbf1fa7c267b016f3357534}


Definition at line 2242 of file D\+H\+T.\+c.



References D\+H\+T\+\_\+connect\+\_\+after\+\_\+load(), do\+\_\+\+Assoc(), do\+\_\+\+Close(), do\+\_\+\+D\+H\+T\+\_\+friends(), do\+\_\+hardening(), do\+\_\+\+N\+A\+T(), do\+\_\+to\+\_\+ping(), D\+H\+T\+::last\+\_\+run, D\+H\+T\+::loaded\+\_\+num\+\_\+nodes, D\+H\+T\+::ping, unix\+\_\+time(), and unix\+\_\+time\+\_\+update().



Referenced by do\+\_\+messenger(), do\+\_\+onion(), do\+\_\+onions(), and main().


\begin{DoxyCode}
2243 \{
2244     \hyperlink{util_8c_a849af10dd491723cf3abdef599846897}{unix\_time\_update}();
2245 
2246     \textcolor{keywordflow}{if} (dht->\hyperlink{struct_d_h_t_a73e8197b772061572cb931a378ade3e4}{last\_run} == \hyperlink{util_8c_ac958d9f8847cb8039444bfa3d304233a}{unix\_time}()) \{
2247         \textcolor{keywordflow}{return};
2248     \}
2249 
2250     \textcolor{comment}{// Load friends/clients if first call to do\_DHT}
2251     \textcolor{keywordflow}{if} (dht->\hyperlink{struct_d_h_t_aef4ce67d5df5f093247c73b3a024b73e}{loaded\_num\_nodes}) \{
2252         \hyperlink{_d_h_t_8c_ad5df2ff5066cf93898e531d320ddd675}{DHT\_connect\_after\_load}(dht);
2253     \}
2254 
2255     \hyperlink{_d_h_t_8c_ae05715389aba7cec9083bdf9efad7a78}{do\_Close}(dht);
2256     \hyperlink{_d_h_t_8c_ad1bcb472a3fd0ff8ab579551c4528b62}{do\_DHT\_friends}(dht);
2257     \hyperlink{_d_h_t_8c_a9243f57fde4a9312f11575eb4e7b1275}{do\_NAT}(dht);
2258     \hyperlink{ping_8c_af1ade820101b833a4615cb9fb58bebad}{do\_to\_ping}(dht->\hyperlink{struct_d_h_t_ae3f68e3d55e46726b05717fc88198321}{ping});
2259     \hyperlink{_d_h_t_8c_a9480aac51c9c74c667267ce89a76604a}{do\_hardening}(dht);
2260 \textcolor{preprocessor}{#ifdef ENABLE\_ASSOC\_DHT}
2261 
2262     \textcolor{keywordflow}{if} (dht->assoc)
2263         \hyperlink{assoc_8c_a36aff33785fb0db2565cf4cb5b080327}{do\_Assoc}(dht->assoc, dht);
2264 
2265 \textcolor{preprocessor}{#endif}
2266     dht->\hyperlink{struct_d_h_t_a73e8197b772061572cb931a378ade3e4}{last\_run} = \hyperlink{util_8c_ac958d9f8847cb8039444bfa3d304233a}{unix\_time}();
2267 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/dad/_d_h_t_8h_a5be9dfb66fbf1fa7c267b016f3357534_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/dad/_d_h_t_8h_a5be9dfb66fbf1fa7c267b016f3357534_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8h_a8abfc9cea3784b0cae354670bd4643cd}{\index{D\+H\+T.\+h@{D\+H\+T.\+h}!get\+\_\+close\+\_\+nodes@{get\+\_\+close\+\_\+nodes}}
\index{get\+\_\+close\+\_\+nodes@{get\+\_\+close\+\_\+nodes}!D\+H\+T.\+h@{D\+H\+T.\+h}}
\subsubsection[{get\+\_\+close\+\_\+nodes}]{\setlength{\rightskip}{0pt plus 5cm}int get\+\_\+close\+\_\+nodes (
\begin{DoxyParamCaption}
\item[{const {\bf D\+H\+T} $\ast$}]{dht, }
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key, }
\item[{{\bf Node\+\_\+format} $\ast$}]{nodes\+\_\+list, }
\item[{sa\+\_\+family\+\_\+t}]{sa\+\_\+family, }
\item[{uint8\+\_\+t}]{is\+\_\+\+L\+A\+N, }
\item[{uint8\+\_\+t}]{want\+\_\+good}
\end{DoxyParamCaption}
)}}\label{_d_h_t_8h_a8abfc9cea3784b0cae354670bd4643cd}


Definition at line 570 of file D\+H\+T.\+c.



References Client\+\_\+data\+::assoc4, Client\+\_\+data\+::assoc6, Assoc\+\_\+get\+\_\+close\+\_\+entries(), Assoc\+\_\+close\+\_\+entries\+::count, Assoc\+\_\+close\+\_\+entries\+::count\+\_\+good, Assoc\+\_\+close\+\_\+entries\+::flags, get\+\_\+somewhat\+\_\+close\+\_\+nodes(), i, id\+\_\+copy(), I\+P\+P\+Ts\+Png\+::ip\+\_\+port, Node\+\_\+format\+::ip\+\_\+port, ipport\+\_\+isset(), L\+A\+N\+Ok, L\+O\+G\+G\+E\+R\+\_\+\+D\+E\+B\+U\+G, M\+A\+X\+\_\+\+S\+E\+N\+T\+\_\+\+N\+O\+D\+E\+S, Proto\+I\+Pv4, Proto\+I\+Pv6, make-\/funny-\/savefile\+::public\+\_\+key, Client\+\_\+data\+::public\+\_\+key, Assoc\+\_\+close\+\_\+entries\+::result, and Assoc\+\_\+close\+\_\+entries\+::wanted\+\_\+id.



Referenced by handle\+\_\+announce\+\_\+request(), populate\+\_\+path\+\_\+nodes(), random\+\_\+node(), and sendnodes\+\_\+ipv6().


\begin{DoxyCode}
572 \{
573     memset(nodes\_list, 0, \hyperlink{_d_h_t_8h_a57f4cf16e79a384d7d59a3cc585ea5a3}{MAX\_SENT\_NODES} * \textcolor{keyword}{sizeof}(\hyperlink{struct_node__format}{Node\_format}));
574 \textcolor{preprocessor}{#ifdef ENABLE\_ASSOC\_DHT}
575 
576     \textcolor{keywordflow}{if} (!dht->assoc)
577 \textcolor{preprocessor}{#endif}
578         \textcolor{keywordflow}{return} \hyperlink{_d_h_t_8c_ab7f89880bce923390748449ef6f60004}{get\_somewhat\_close\_nodes}(dht, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, nodes\_list, 
      sa\_family, is\_LAN, want\_good);
579 
580 \textcolor{preprocessor}{#ifdef ENABLE\_ASSOC\_DHT}
581     \textcolor{comment}{//TODO: assoc, sa\_family 0 (don't care if ipv4 or ipv6) support.}
582     \hyperlink{struct_client__data}{Client\_data} *result[\hyperlink{_d_h_t_8h_a57f4cf16e79a384d7d59a3cc585ea5a3}{MAX\_SENT\_NODES}];
583 
584     \hyperlink{struct_assoc__close__entries}{Assoc\_close\_entries} request;
585     memset(&request, 0, \textcolor{keyword}{sizeof}(request));
586     request.\hyperlink{struct_assoc__close__entries_a20302e2c99a60d3f612dba57e3f6333b}{count} = \hyperlink{_d_h_t_8h_a57f4cf16e79a384d7d59a3cc585ea5a3}{MAX\_SENT\_NODES};
587     request.\hyperlink{struct_assoc__close__entries_a086e0ce002c9491e4b99956740bb53d4}{count\_good} = \hyperlink{_d_h_t_8h_a57f4cf16e79a384d7d59a3cc585ea5a3}{MAX\_SENT\_NODES} - 2; \textcolor{comment}{/* allow 2 'indirect' nodes */}
588     request.\hyperlink{struct_assoc__close__entries_a40d6704f891338dadfa89f46b696be4c}{result} = result;
589     request.\hyperlink{struct_assoc__close__entries_a037b65164e78b02017bd4751843037b4}{wanted\_id} = \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key};
590     request.\hyperlink{struct_assoc__close__entries_aa2585d779da0ab21273a8d92de9a0ebe}{flags} = (is\_LAN ? \hyperlink{assoc_8h_a7b447edde2593107a52acfee89281d2ca8f8f3b5e55e2761eed576314ae2afaf6}{LANOk} : 0) + (sa\_family == AF\_INET ? 
      \hyperlink{assoc_8h_a7b447edde2593107a52acfee89281d2ca8f72d319431bcfbaf2fb152a649d090c}{ProtoIPv4} : \hyperlink{assoc_8h_a7b447edde2593107a52acfee89281d2ca1e654e12e0aea9fe657086a3c3ed9eca}{ProtoIPv6});
591 
592     uint8\_t num\_found = \hyperlink{assoc_8c_a256dcbfb2174603496ffa30efef90ad2}{Assoc\_get\_close\_entries}(dht->assoc, &request);
593 
594     \textcolor{keywordflow}{if} (!num\_found) \{
595         \hyperlink{logger_8h_a9885ca09ce5f94d936c91a5b0856a024}{LOGGER\_DEBUG}(\textcolor{stringliteral}{"get\_close\_nodes(): Assoc\_get\_close\_entries() returned zero nodes"});
596         \textcolor{keywordflow}{return} \hyperlink{_d_h_t_8c_ab7f89880bce923390748449ef6f60004}{get\_somewhat\_close\_nodes}(dht, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, nodes\_list, 
      sa\_family, is\_LAN, want\_good);
597     \}
598 
599     \hyperlink{logger_8h_a9885ca09ce5f94d936c91a5b0856a024}{LOGGER\_DEBUG}(\textcolor{stringliteral}{"get\_close\_nodes(): Assoc\_get\_close\_entries() returned %i 'direct' and %i
       'indirect' nodes"},
600                  request.\hyperlink{struct_assoc__close__entries_a086e0ce002c9491e4b99956740bb53d4}{count\_good}, num\_found - request.\hyperlink{struct_assoc__close__entries_a086e0ce002c9491e4b99956740bb53d4}{count\_good});
601 
602     uint8\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}, num\_returned = 0;
603 
604     \textcolor{keywordflow}{for} (i = 0; i < num\_found; i++) \{
605         \hyperlink{struct_client__data}{Client\_data} *client = result[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}];
606 
607         \textcolor{keywordflow}{if} (client) \{
608             \hyperlink{util_8c_aa30049b8c1d82c280d6d872feea3353b}{id\_copy}(nodes\_list[num\_returned].\hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, client->
      \hyperlink{struct_client__data_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key});
609 
610             \textcolor{keywordflow}{if} (sa\_family == AF\_INET)
611                 \textcolor{keywordflow}{if} (\hyperlink{network_8c_a8436367218afb29bcf1b5fecd071648e}{ipport\_isset}(&client->\hyperlink{struct_client__data_ac9843379cbcd02bdfa5c180a1474a6c5}{assoc4}.\hyperlink{struct_i_p_p_ts_png_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port})) \{
612                     nodes\_list[num\_returned].\hyperlink{struct_node__format_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port} = client->\hyperlink{struct_client__data_ac9843379cbcd02bdfa5c180a1474a6c5}{assoc4}.
      \hyperlink{struct_i_p_p_ts_png_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port};
613                     num\_returned++;
614                     \textcolor{keywordflow}{continue};
615                 \}
616 
617             \textcolor{keywordflow}{if} (sa\_family == AF\_INET6)
618                 \textcolor{keywordflow}{if} (\hyperlink{network_8c_a8436367218afb29bcf1b5fecd071648e}{ipport\_isset}(&client->\hyperlink{struct_client__data_a87d394929a2604f6f785fec949fac618}{assoc6}.\hyperlink{struct_i_p_p_ts_png_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port})) \{
619                     nodes\_list[num\_returned].\hyperlink{struct_node__format_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port} = client->\hyperlink{struct_client__data_a87d394929a2604f6f785fec949fac618}{assoc6}.
      \hyperlink{struct_i_p_p_ts_png_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port};
620                     num\_returned++;
621                     \textcolor{keywordflow}{continue};
622                 \}
623         \}
624     \}
625 
626     \textcolor{keywordflow}{return} num\_returned;
627 \textcolor{preprocessor}{#endif}
628 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/dad/_d_h_t_8h_a8abfc9cea3784b0cae354670bd4643cd_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/dad/_d_h_t_8h_a8abfc9cea3784b0cae354670bd4643cd_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8h_a6cd4aa89d7bfcf6805c5ce6b273d9e9e}{\index{D\+H\+T.\+h@{D\+H\+T.\+h}!get\+\_\+shared\+\_\+key@{get\+\_\+shared\+\_\+key}}
\index{get\+\_\+shared\+\_\+key@{get\+\_\+shared\+\_\+key}!D\+H\+T.\+h@{D\+H\+T.\+h}}
\subsubsection[{get\+\_\+shared\+\_\+key}]{\setlength{\rightskip}{0pt plus 5cm}void get\+\_\+shared\+\_\+key (
\begin{DoxyParamCaption}
\item[{{\bf Shared\+\_\+\+Keys} $\ast$}]{shared\+\_\+keys, }
\item[{uint8\+\_\+t $\ast$}]{shared\+\_\+key, }
\item[{const uint8\+\_\+t $\ast$}]{secret\+\_\+key, }
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key}
\end{DoxyParamCaption}
)}}\label{_d_h_t_8h_a6cd4aa89d7bfcf6805c5ce6b273d9e9e}


Definition at line 100 of file D\+H\+T.\+c.



References encrypt\+\_\+precompute(), i, is\+\_\+timeout(), Shared\+\_\+\+Keys\+::keys, K\+E\+Y\+S\+\_\+\+T\+I\+M\+E\+O\+U\+T, M\+A\+X\+\_\+\+K\+E\+Y\+S\+\_\+\+P\+E\+R\+\_\+\+S\+L\+O\+T, num, Shared\+\_\+\+Keys\+::public\+\_\+key, Shared\+\_\+\+Keys\+::shared\+\_\+key, Shared\+\_\+\+Keys\+::stored, Shared\+\_\+\+Keys\+::time\+\_\+last\+\_\+requested, Shared\+\_\+\+Keys\+::times\+\_\+requested, and unix\+\_\+time().



Referenced by D\+H\+T\+\_\+get\+\_\+shared\+\_\+key\+\_\+recv(), D\+H\+T\+\_\+get\+\_\+shared\+\_\+key\+\_\+sent(), handle\+\_\+announce\+\_\+request(), handle\+\_\+send\+\_\+1(), handle\+\_\+send\+\_\+2(), and handle\+\_\+send\+\_\+initial().


\begin{DoxyCode}
101 \{
102     uint32\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}, \hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num} = ~0, curr = 0;
103 
104     \textcolor{keywordflow}{for} (i = 0; i < \hyperlink{_d_h_t_8h_ae5450da86fcf09134330aeef7cd8c35f}{MAX\_KEYS\_PER\_SLOT}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
105         \textcolor{keywordtype}{int} index = \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}[30] * MAX\_KEYS\_PER\_SLOT + \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
106 
107         \textcolor{keywordflow}{if} (shared\_keys->\hyperlink{struct_shared___keys_a15077d043938aa92f7ee5278d0036f7f}{keys}[index].\hyperlink{struct_shared___keys_a252513c1d10b32b19859efae45136a75}{stored}) \{
108             \textcolor{keywordflow}{if} (memcmp(\hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, shared\_keys->\hyperlink{struct_shared___keys_a15077d043938aa92f7ee5278d0036f7f}{keys}[index].
      \hyperlink{struct_shared___keys_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, crypto\_box\_PUBLICKEYBYTES) == 0) \{
109                 memcpy(shared\_key, shared\_keys->\hyperlink{struct_shared___keys_a15077d043938aa92f7ee5278d0036f7f}{keys}[index].\hyperlink{struct_shared___keys_a81ead9fac55a0cedc30a96253a2c5119}{shared\_key}, 
      crypto\_box\_BEFORENMBYTES);
110                 ++shared\_keys->\hyperlink{struct_shared___keys_a15077d043938aa92f7ee5278d0036f7f}{keys}[index].\hyperlink{struct_shared___keys_ae433d486c059f93505368567603c2748}{times\_requested};
111                 shared\_keys->\hyperlink{struct_shared___keys_a15077d043938aa92f7ee5278d0036f7f}{keys}[index].\hyperlink{struct_shared___keys_a682dfdf8b648a40e36dd5865f16da424}{time\_last\_requested} = 
      \hyperlink{util_8c_ac958d9f8847cb8039444bfa3d304233a}{unix\_time}();
112                 \textcolor{keywordflow}{return};
113             \}
114 
115             \textcolor{keywordflow}{if} (num != 0) \{
116                 \textcolor{keywordflow}{if} (\hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(shared\_keys->\hyperlink{struct_shared___keys_a15077d043938aa92f7ee5278d0036f7f}{keys}[index].
      \hyperlink{struct_shared___keys_a682dfdf8b648a40e36dd5865f16da424}{time\_last\_requested}, \hyperlink{_d_h_t_8h_a1b0aff5d0e177e2fe1f826e225223867}{KEYS\_TIMEOUT})) \{
117                     num = 0;
118                     curr = index;
119                 \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (num > shared\_keys->\hyperlink{struct_shared___keys_a15077d043938aa92f7ee5278d0036f7f}{keys}[index].\hyperlink{struct_shared___keys_ae433d486c059f93505368567603c2748}{times\_requested}) \{
120                     num = shared\_keys->\hyperlink{struct_shared___keys_a15077d043938aa92f7ee5278d0036f7f}{keys}[index].\hyperlink{struct_shared___keys_ae433d486c059f93505368567603c2748}{times\_requested};
121                     curr = index;
122                 \}
123             \}
124         \} \textcolor{keywordflow}{else} \{
125             \textcolor{keywordflow}{if} (num != 0) \{
126                 num = 0;
127                 curr = index;
128             \}
129         \}
130     \}
131 
132     \hyperlink{crypto__core_8c_a0d8eaef49981c5dc3ada078866b42f6d}{encrypt\_precompute}(\hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, secret\_key, shared\_key);
133 
134     \textcolor{keywordflow}{if} (num != (uint32\_t)~0) \{
135         shared\_keys->\hyperlink{struct_shared___keys_a15077d043938aa92f7ee5278d0036f7f}{keys}[curr].\hyperlink{struct_shared___keys_a252513c1d10b32b19859efae45136a75}{stored} = 1;
136         shared\_keys->\hyperlink{struct_shared___keys_a15077d043938aa92f7ee5278d0036f7f}{keys}[curr].\hyperlink{struct_shared___keys_ae433d486c059f93505368567603c2748}{times\_requested} = 1;
137         memcpy(shared\_keys->\hyperlink{struct_shared___keys_a15077d043938aa92f7ee5278d0036f7f}{keys}[curr].\hyperlink{struct_shared___keys_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, 
      crypto\_box\_PUBLICKEYBYTES);
138         memcpy(shared\_keys->\hyperlink{struct_shared___keys_a15077d043938aa92f7ee5278d0036f7f}{keys}[curr].\hyperlink{struct_shared___keys_a81ead9fac55a0cedc30a96253a2c5119}{shared\_key}, shared\_key, crypto\_box\_BEFORENMBYTES);
139         shared\_keys->\hyperlink{struct_shared___keys_a15077d043938aa92f7ee5278d0036f7f}{keys}[curr].\hyperlink{struct_shared___keys_a682dfdf8b648a40e36dd5865f16da424}{time\_last\_requested} = 
      \hyperlink{util_8c_ac958d9f8847cb8039444bfa3d304233a}{unix\_time}();
140     \}
141 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/dad/_d_h_t_8h_a6cd4aa89d7bfcf6805c5ce6b273d9e9e_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/dad/_d_h_t_8h_a6cd4aa89d7bfcf6805c5ce6b273d9e9e_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8h_a903a5bc580826fe447adb841b7782333}{\index{D\+H\+T.\+h@{D\+H\+T.\+h}!id\+\_\+closest@{id\+\_\+closest}}
\index{id\+\_\+closest@{id\+\_\+closest}!D\+H\+T.\+h@{D\+H\+T.\+h}}
\subsubsection[{id\+\_\+closest}]{\setlength{\rightskip}{0pt plus 5cm}int id\+\_\+closest (
\begin{DoxyParamCaption}
\item[{const uint8\+\_\+t $\ast$}]{pk, }
\item[{const uint8\+\_\+t $\ast$}]{pk1, }
\item[{const uint8\+\_\+t $\ast$}]{pk2}
\end{DoxyParamCaption}
)}}\label{_d_h_t_8h_a903a5bc580826fe447adb841b7782333}


Definition at line 74 of file D\+H\+T.\+c.



References i.



Referenced by add\+\_\+to\+\_\+entries(), add\+\_\+to\+\_\+ping(), assoc\+\_\+id\+\_\+closest(), client\+\_\+add\+\_\+to\+\_\+list(), client\+\_\+ping\+\_\+nodes(), cmp\+\_\+dht\+\_\+entry(), cmp\+\_\+entry(), get\+\_\+close\+\_\+nodes\+\_\+inner(), is\+\_\+furthest(), store\+\_\+node\+\_\+ok(), and test\+\_\+addto\+\_\+lists\+\_\+possible\+\_\+bad().


\begin{DoxyCode}
75 \{
76     \textcolor{keywordtype}{size\_t}   \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
77     uint8\_t distance1, distance2;
78 
79     \textcolor{keywordflow}{for} (i = 0; i < crypto\_box\_PUBLICKEYBYTES; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
80 
81         distance1 = pk[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}] ^ pk1[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}];
82         distance2 = pk[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}] ^ pk2[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}];
83 
84         \textcolor{keywordflow}{if} (distance1 < distance2)
85             \textcolor{keywordflow}{return} 1;
86 
87         \textcolor{keywordflow}{if} (distance1 > distance2)
88             \textcolor{keywordflow}{return} 2;
89     \}
90 
91     \textcolor{keywordflow}{return} 0;
92 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/dad/_d_h_t_8h_a903a5bc580826fe447adb841b7782333_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8h_a816851e4f0f454c52b93d65544a2b2bb}{\index{D\+H\+T.\+h@{D\+H\+T.\+h}!kill\+\_\+\+D\+H\+T@{kill\+\_\+\+D\+H\+T}}
\index{kill\+\_\+\+D\+H\+T@{kill\+\_\+\+D\+H\+T}!D\+H\+T.\+h@{D\+H\+T.\+h}}
\subsubsection[{kill\+\_\+\+D\+H\+T}]{\setlength{\rightskip}{0pt plus 5cm}void kill\+\_\+\+D\+H\+T (
\begin{DoxyParamCaption}
\item[{{\bf D\+H\+T} $\ast$}]{dht}
\end{DoxyParamCaption}
)}}\label{_d_h_t_8h_a816851e4f0f454c52b93d65544a2b2bb}


Definition at line 2268 of file D\+H\+T.\+c.



References C\+R\+Y\+P\+T\+O\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+H\+A\+R\+D\+E\+N\+I\+N\+G, C\+R\+Y\+P\+T\+O\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+N\+A\+T\+\_\+\+P\+I\+N\+G, cryptopacket\+\_\+registerhandler(), D\+H\+T\+::dht\+\_\+harden\+\_\+ping\+\_\+array, D\+H\+T\+::dht\+\_\+ping\+\_\+array, D\+H\+T\+::friends\+\_\+list, kill\+\_\+\+Assoc(), kill\+\_\+ping(), D\+H\+T\+::loaded\+\_\+nodes\+\_\+list, D\+H\+T\+::net, N\+E\+T\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+G\+E\+T\+\_\+\+N\+O\+D\+E\+S, N\+E\+T\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+S\+E\+N\+D\+\_\+\+N\+O\+D\+E\+S\+\_\+\+I\+P\+V6, networking\+\_\+registerhandler(), D\+H\+T\+::ping, and ping\+\_\+array\+\_\+free\+\_\+all().



Referenced by kill\+\_\+messenger(), kill\+\_\+onions(), new\+\_\+\+D\+H\+T(), new\+\_\+messenger(), S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T(), and test\+\_\+addto\+\_\+lists().


\begin{DoxyCode}
2269 \{
2270 \textcolor{preprocessor}{#ifdef ENABLE\_ASSOC\_DHT}
2271     \hyperlink{assoc_8c_a26d82e35d047181d0e883a4b91373793}{kill\_Assoc}(dht->assoc);
2272 \textcolor{preprocessor}{#endif}
2273     \hyperlink{network_8c_a230a192ca9463ec4985d4f86de439733}{networking\_registerhandler}(dht->\hyperlink{struct_d_h_t_aa14ea2f67950f57fe4235d7375a2216c}{net}, 
      \hyperlink{network_8h_a861e63c2b32751aa406f11283f5b0925}{NET\_PACKET\_GET\_NODES}, NULL, NULL);
2274     \hyperlink{network_8c_a230a192ca9463ec4985d4f86de439733}{networking\_registerhandler}(dht->\hyperlink{struct_d_h_t_aa14ea2f67950f57fe4235d7375a2216c}{net}, 
      \hyperlink{network_8h_a868cfc97dcb064ca456278fc89f9b512}{NET\_PACKET\_SEND\_NODES\_IPV6}, NULL, NULL);
2275     \hyperlink{_d_h_t_8c_a097913efd03d5106a66c15eb48b0e104}{cryptopacket\_registerhandler}(dht, 
      \hyperlink{crypto__core_8h_accd0074d1bd9133de6460d75b10b1e21}{CRYPTO\_PACKET\_NAT\_PING}, NULL, NULL);
2276     \hyperlink{_d_h_t_8c_a097913efd03d5106a66c15eb48b0e104}{cryptopacket\_registerhandler}(dht, 
      \hyperlink{crypto__core_8h_a703b04f256fec46afbcc98b86c86d5a7}{CRYPTO\_PACKET\_HARDENING}, NULL, NULL);
2277     \hyperlink{ping__array_8c_a7e093974e6d616c5bbcadfd434b49824}{ping\_array\_free\_all}(&dht->\hyperlink{struct_d_h_t_a8432234ba71a00ac9c516cb80a70f29d}{dht\_ping\_array});
2278     \hyperlink{ping__array_8c_a7e093974e6d616c5bbcadfd434b49824}{ping\_array\_free\_all}(&dht->\hyperlink{struct_d_h_t_a957126e184a8b8001228effc56b9db95}{dht\_harden\_ping\_array});
2279     \hyperlink{ping_8c_a9487f04f4bb6ac4be59a4166236ec896}{kill\_ping}(dht->\hyperlink{struct_d_h_t_ae3f68e3d55e46726b05717fc88198321}{ping});
2280     free(dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list});
2281     free(dht->\hyperlink{struct_d_h_t_a3050c21873637c51d8001c807f62fa74}{loaded\_nodes\_list});
2282     free(dht);
2283 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/dad/_d_h_t_8h_a816851e4f0f454c52b93d65544a2b2bb_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/dad/_d_h_t_8h_a816851e4f0f454c52b93d65544a2b2bb_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8h_adad04fa897751b06948a172044bf1c58}{\index{D\+H\+T.\+h@{D\+H\+T.\+h}!new\+\_\+\+D\+H\+T@{new\+\_\+\+D\+H\+T}}
\index{new\+\_\+\+D\+H\+T@{new\+\_\+\+D\+H\+T}!D\+H\+T.\+h@{D\+H\+T.\+h}}
\subsubsection[{new\+\_\+\+D\+H\+T}]{\setlength{\rightskip}{0pt plus 5cm}{\bf D\+H\+T}$\ast$ new\+\_\+\+D\+H\+T (
\begin{DoxyParamCaption}
\item[{{\bf Networking\+\_\+\+Core} $\ast$}]{net}
\end{DoxyParamCaption}
)}}\label{_d_h_t_8h_adad04fa897751b06948a172044bf1c58}


Definition at line 2196 of file D\+H\+T.\+c.



References C\+R\+Y\+P\+T\+O\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+H\+A\+R\+D\+E\+N\+I\+N\+G, C\+R\+Y\+P\+T\+O\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+N\+A\+T\+\_\+\+P\+I\+N\+G, cryptopacket\+\_\+handle(), cryptopacket\+\_\+registerhandler(), D\+H\+T\+\_\+addfriend(), D\+H\+T\+\_\+\+F\+A\+K\+E\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+N\+U\+M\+B\+E\+R, D\+H\+T\+::dht\+\_\+harden\+\_\+ping\+\_\+array, D\+H\+T\+::dht\+\_\+ping\+\_\+array, D\+H\+T\+\_\+\+P\+I\+N\+G\+\_\+\+A\+R\+R\+A\+Y\+\_\+\+S\+I\+Z\+E, handle\+\_\+getnodes(), handle\+\_\+hardening(), handle\+\_\+\+N\+A\+Tping(), handle\+\_\+sendnodes\+\_\+ipv6(), i, kill\+\_\+\+D\+H\+T(), D\+H\+T\+::net, N\+E\+T\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+C\+R\+Y\+P\+T\+O, N\+E\+T\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+G\+E\+T\+\_\+\+N\+O\+D\+E\+S, N\+E\+T\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+S\+E\+N\+D\+\_\+\+N\+O\+D\+E\+S\+\_\+\+I\+P\+V6, networking\+\_\+registerhandler(), new\+\_\+\+Assoc\+\_\+default(), new\+\_\+ping(), new\+\_\+symmetric\+\_\+key(), D\+H\+T\+::ping, ping\+\_\+array\+\_\+init(), P\+I\+N\+G\+\_\+\+T\+I\+M\+E\+O\+U\+T, D\+H\+T\+::secret\+\_\+symmetric\+\_\+key, D\+H\+T\+::self\+\_\+public\+\_\+key, D\+H\+T\+::self\+\_\+secret\+\_\+key, and unix\+\_\+time\+\_\+update().



Referenced by main(), new\+\_\+messenger(), new\+\_\+onions(), S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T(), and test\+\_\+addto\+\_\+lists().


\begin{DoxyCode}
2197 \{
2198     \textcolor{comment}{/* init time */}
2199     \hyperlink{util_8c_a849af10dd491723cf3abdef599846897}{unix\_time\_update}();
2200 
2201     \textcolor{keywordflow}{if} (net == NULL)
2202         \textcolor{keywordflow}{return} NULL;
2203 
2204     \hyperlink{struct_d_h_t}{DHT} *dht = calloc(1, \textcolor{keyword}{sizeof}(\hyperlink{struct_d_h_t}{DHT}));
2205 
2206     \textcolor{keywordflow}{if} (dht == NULL)
2207         \textcolor{keywordflow}{return} NULL;
2208 
2209     dht->\hyperlink{struct_d_h_t_aa14ea2f67950f57fe4235d7375a2216c}{net} = net;
2210     dht->\hyperlink{struct_d_h_t_ae3f68e3d55e46726b05717fc88198321}{ping} = \hyperlink{ping_8c_a86e9eeead72b88b686ce5b7c0f78c325}{new\_ping}(dht);
2211 
2212     \textcolor{keywordflow}{if} (dht->\hyperlink{struct_d_h_t_ae3f68e3d55e46726b05717fc88198321}{ping} == NULL) \{
2213         \hyperlink{_d_h_t_8c_a816851e4f0f454c52b93d65544a2b2bb}{kill\_DHT}(dht);
2214         \textcolor{keywordflow}{return} NULL;
2215     \}
2216 
2217     \hyperlink{network_8c_a230a192ca9463ec4985d4f86de439733}{networking\_registerhandler}(dht->\hyperlink{struct_d_h_t_aa14ea2f67950f57fe4235d7375a2216c}{net}, 
      \hyperlink{network_8h_a861e63c2b32751aa406f11283f5b0925}{NET\_PACKET\_GET\_NODES}, &\hyperlink{_d_h_t_8c_afa4f13a29cbe60809f2446267d109383}{handle\_getnodes}, dht);
2218     \hyperlink{network_8c_a230a192ca9463ec4985d4f86de439733}{networking\_registerhandler}(dht->\hyperlink{struct_d_h_t_aa14ea2f67950f57fe4235d7375a2216c}{net}, 
      \hyperlink{network_8h_a868cfc97dcb064ca456278fc89f9b512}{NET\_PACKET\_SEND\_NODES\_IPV6}, &\hyperlink{_d_h_t_8c_ac70b27be10ded8565ffcb94829e40514}{handle\_sendnodes\_ipv6}, dht);
2219     \hyperlink{network_8c_a230a192ca9463ec4985d4f86de439733}{networking\_registerhandler}(dht->\hyperlink{struct_d_h_t_aa14ea2f67950f57fe4235d7375a2216c}{net}, 
      \hyperlink{network_8h_aebd9a38e63bac9807d0c2c1cfed68a15}{NET\_PACKET\_CRYPTO}, &\hyperlink{_d_h_t_8c_aa8dd9b8abd89728492c0c9c6299c0a8b}{cryptopacket\_handle}, dht);
2220     \hyperlink{_d_h_t_8c_a097913efd03d5106a66c15eb48b0e104}{cryptopacket\_registerhandler}(dht, 
      \hyperlink{crypto__core_8h_accd0074d1bd9133de6460d75b10b1e21}{CRYPTO\_PACKET\_NAT\_PING}, &\hyperlink{_d_h_t_8c_a9684ffd3987f6c79663c1f07eed0c007}{handle\_NATping}, dht);
2221     \hyperlink{_d_h_t_8c_a097913efd03d5106a66c15eb48b0e104}{cryptopacket\_registerhandler}(dht, 
      \hyperlink{crypto__core_8h_a703b04f256fec46afbcc98b86c86d5a7}{CRYPTO\_PACKET\_HARDENING}, &\hyperlink{_d_h_t_8c_aa38b3670da696f600f37989e79ce4966}{handle\_hardening}, dht);
2222 
2223     \hyperlink{crypto__core_8c_a89b4a1a4a7d8bfabdf0e1b60f074e531}{new\_symmetric\_key}(dht->\hyperlink{struct_d_h_t_ab9f2ff47bc0b1e5110202a6e4be86390}{secret\_symmetric\_key});
2224     crypto\_box\_keypair(dht->\hyperlink{struct_d_h_t_ae726df8bdc26380e5a6c3187a00d6881}{self\_public\_key}, dht->\hyperlink{struct_d_h_t_aa05050f86513ff53fe9da81f73c72267}{self\_secret\_key});
2225 
2226     \hyperlink{ping__array_8c_a2d42b1adf1e6ff6a690fc515b9bb2570}{ping\_array\_init}(&dht->\hyperlink{struct_d_h_t_a8432234ba71a00ac9c516cb80a70f29d}{dht\_ping\_array}, 
      \hyperlink{_d_h_t_8h_aa025d4328dd829fe6d532d3abaf3bc7e}{DHT\_PING\_ARRAY\_SIZE}, \hyperlink{_d_h_t_8h_a733f0d1225f97d8acbd3388e0c0d320f}{PING\_TIMEOUT});
2227     \hyperlink{ping__array_8c_a2d42b1adf1e6ff6a690fc515b9bb2570}{ping\_array\_init}(&dht->\hyperlink{struct_d_h_t_a957126e184a8b8001228effc56b9db95}{dht\_harden\_ping\_array}, 
      \hyperlink{_d_h_t_8h_aa025d4328dd829fe6d532d3abaf3bc7e}{DHT\_PING\_ARRAY\_SIZE}, \hyperlink{_d_h_t_8h_a733f0d1225f97d8acbd3388e0c0d320f}{PING\_TIMEOUT});
2228 \textcolor{preprocessor}{#ifdef ENABLE\_ASSOC\_DHT}
2229     dht->assoc = \hyperlink{assoc_8c_ab7f978008ad6c86ab5063e989fe49d0c}{new\_Assoc\_default}(dht->\hyperlink{struct_d_h_t_ae726df8bdc26380e5a6c3187a00d6881}{self\_public\_key});
2230 \textcolor{preprocessor}{#endif}
2231     uint32\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
2232 
2233     \textcolor{keywordflow}{for} (i = 0; i < \hyperlink{_d_h_t_8h_a09839809f361926e324196bfd9450bb4}{DHT\_FAKE\_FRIEND\_NUMBER}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
2234         uint8\_t random\_key\_bytes[crypto\_box\_PUBLICKEYBYTES];
2235         randombytes(random\_key\_bytes, \textcolor{keyword}{sizeof}(random\_key\_bytes));
2236         \hyperlink{_d_h_t_8c_a1dac5e05fd07964cb4914c17afeb9d50}{DHT\_addfriend}(dht, random\_key\_bytes, 0, 0, 0, 0);
2237     \}
2238 
2239     \textcolor{keywordflow}{return} dht;
2240 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=550pt]{df/dad/_d_h_t_8h_adad04fa897751b06948a172044bf1c58_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/dad/_d_h_t_8h_adad04fa897751b06948a172044bf1c58_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8h_a1d6f2fcb008c989f333ae89e840f94b4}{\index{D\+H\+T.\+h@{D\+H\+T.\+h}!pack\+\_\+nodes@{pack\+\_\+nodes}}
\index{pack\+\_\+nodes@{pack\+\_\+nodes}!D\+H\+T.\+h@{D\+H\+T.\+h}}
\subsubsection[{pack\+\_\+nodes}]{\setlength{\rightskip}{0pt plus 5cm}int pack\+\_\+nodes (
\begin{DoxyParamCaption}
\item[{uint8\+\_\+t $\ast$}]{data, }
\item[{uint16\+\_\+t}]{length, }
\item[{const {\bf Node\+\_\+format} $\ast$}]{nodes, }
\item[{uint16\+\_\+t}]{number}
\end{DoxyParamCaption}
)}}\label{_d_h_t_8h_a1d6f2fcb008c989f333ae89e840f94b4}


Definition at line 207 of file D\+H\+T.\+c.



References i, P\+A\+C\+K\+E\+D\+\_\+\+N\+O\+D\+E\+\_\+\+S\+I\+Z\+E\+\_\+\+I\+P4, P\+A\+C\+K\+E\+D\+\_\+\+N\+O\+D\+E\+\_\+\+S\+I\+Z\+E\+\_\+\+I\+P6, make-\/funny-\/savefile\+::public\+\_\+key, S\+I\+Z\+E\+\_\+\+I\+P4, S\+I\+Z\+E\+\_\+\+I\+P6, T\+C\+P\+\_\+\+I\+N\+E\+T, T\+C\+P\+\_\+\+I\+N\+E\+T6, T\+O\+X\+\_\+\+A\+F\+\_\+\+I\+N\+E\+T, T\+O\+X\+\_\+\+A\+F\+\_\+\+I\+N\+E\+T6, T\+O\+X\+\_\+\+T\+C\+P\+\_\+\+I\+N\+E\+T, and T\+O\+X\+\_\+\+T\+C\+P\+\_\+\+I\+N\+E\+T6.



Referenced by D\+H\+T\+\_\+save(), handle\+\_\+announce\+\_\+request(), messenger\+\_\+save(), send\+\_\+dhtpk\+\_\+announce(), send\+\_\+relays(), and sendnodes\+\_\+ipv6().


\begin{DoxyCode}
208 \{
209     uint32\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}, packed\_length = 0;
210 
211     \textcolor{keywordflow}{for} (i = 0; i < number; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
212         \textcolor{keywordtype}{int} ipv6 = -1;
213         uint8\_t net\_family;
214 
215         \textcolor{keywordflow}{if} (nodes[i].ip\_port.ip.family == AF\_INET) \{
216             ipv6 = 0;
217             net\_family = \hyperlink{_d_h_t_8h_ac35a63082a23b6ced97c0a3a24ba06be}{TOX\_AF\_INET};
218         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (nodes[i].ip\_port.ip.family == \hyperlink{network_8h_a38cdd2f189180d6790d5b181f55ca047}{TCP\_INET}) \{
219             ipv6 = 0;
220             net\_family = \hyperlink{_d_h_t_8h_ab59616c5422ae79ebc665059761879d5}{TOX\_TCP\_INET};
221         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (nodes[i].ip\_port.ip.family == AF\_INET6) \{
222             ipv6 = 1;
223             net\_family = \hyperlink{_d_h_t_8h_a025adcf535ab2c7123fb5ea22fe20bbd}{TOX\_AF\_INET6};
224         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (nodes[i].ip\_port.ip.family == \hyperlink{network_8h_a7cd884776d628ca50049592d963c10cc}{TCP\_INET6}) \{
225             ipv6 = 1;
226             net\_family = \hyperlink{_d_h_t_8h_a30bf86f2e1f87bcbd6a90145943aabac}{TOX\_TCP\_INET6};
227         \} \textcolor{keywordflow}{else} \{
228             \textcolor{keywordflow}{return} -1;
229         \}
230 
231         \textcolor{keywordflow}{if} (ipv6 == 0) \{
232             uint32\_t size = \hyperlink{_d_h_t_8c_a03601baefa220335487dfc838c08d268}{PACKED\_NODE\_SIZE\_IP4};
233 
234             \textcolor{keywordflow}{if} (packed\_length + size > length)
235                 \textcolor{keywordflow}{return} -1;
236 
237             \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[packed\_length] = net\_family;
238             memcpy(\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} + packed\_length + 1, &nodes[i].ip\_port.ip.ip4, 
      \hyperlink{network_8h_af01e75c1c63a39bcd2aacdf3018b18c9}{SIZE\_IP4});
239             memcpy(\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} + packed\_length + 1 + \hyperlink{network_8h_af01e75c1c63a39bcd2aacdf3018b18c9}{SIZE\_IP4}, &nodes[i].ip\_port.port, \textcolor{keyword}{sizeof}(uint16\_t
      ));
240             memcpy(\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} + packed\_length + 1 + \hyperlink{network_8h_af01e75c1c63a39bcd2aacdf3018b18c9}{SIZE\_IP4} + \textcolor{keyword}{sizeof}(uint16\_t), nodes[i].
      \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, crypto\_box\_PUBLICKEYBYTES);
241             packed\_length += size;
242         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (ipv6 == 1) \{
243             uint32\_t size = \hyperlink{_d_h_t_8c_a9b47e23b0610a17f01902680f55d7963}{PACKED\_NODE\_SIZE\_IP6};
244 
245             \textcolor{keywordflow}{if} (packed\_length + size > length)
246                 \textcolor{keywordflow}{return} -1;
247 
248             \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[packed\_length] = net\_family;
249             memcpy(\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} + packed\_length + 1, &nodes[i].ip\_port.ip.ip6, 
      \hyperlink{network_8h_a5d7430ad26f80239b9fe1bbcd51b5ed2}{SIZE\_IP6});
250             memcpy(\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} + packed\_length + 1 + \hyperlink{network_8h_a5d7430ad26f80239b9fe1bbcd51b5ed2}{SIZE\_IP6}, &nodes[i].ip\_port.port, \textcolor{keyword}{sizeof}(uint16\_t
      ));
251             memcpy(\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} + packed\_length + 1 + \hyperlink{network_8h_a5d7430ad26f80239b9fe1bbcd51b5ed2}{SIZE\_IP6} + \textcolor{keyword}{sizeof}(uint16\_t), nodes[i].
      \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, crypto\_box\_PUBLICKEYBYTES);
252             packed\_length += size;
253         \} \textcolor{keywordflow}{else} \{
254             \textcolor{keywordflow}{return} -1;
255         \}
256     \}
257 
258     \textcolor{keywordflow}{return} packed\_length;
259 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/dad/_d_h_t_8h_a1d6f2fcb008c989f333ae89e840f94b4_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8h_aa980937ac320a4389b726e04da26cb44}{\index{D\+H\+T.\+h@{D\+H\+T.\+h}!packed\+\_\+node\+\_\+size@{packed\+\_\+node\+\_\+size}}
\index{packed\+\_\+node\+\_\+size@{packed\+\_\+node\+\_\+size}!D\+H\+T.\+h@{D\+H\+T.\+h}}
\subsubsection[{packed\+\_\+node\+\_\+size}]{\setlength{\rightskip}{0pt plus 5cm}int packed\+\_\+node\+\_\+size (
\begin{DoxyParamCaption}
\item[{uint8\+\_\+t}]{ip\+\_\+family}
\end{DoxyParamCaption}
)}}\label{_d_h_t_8h_aa980937ac320a4389b726e04da26cb44}


Definition at line 186 of file D\+H\+T.\+c.



References P\+A\+C\+K\+E\+D\+\_\+\+N\+O\+D\+E\+\_\+\+S\+I\+Z\+E\+\_\+\+I\+P4, P\+A\+C\+K\+E\+D\+\_\+\+N\+O\+D\+E\+\_\+\+S\+I\+Z\+E\+\_\+\+I\+P6, T\+C\+P\+\_\+\+I\+N\+E\+T, and T\+C\+P\+\_\+\+I\+N\+E\+T6.



Referenced by D\+H\+T\+\_\+size(), messenger\+\_\+save(), and messenger\+\_\+size().


\begin{DoxyCode}
187 \{
188     \textcolor{keywordflow}{if} (ip\_family == AF\_INET) \{
189         \textcolor{keywordflow}{return} \hyperlink{_d_h_t_8c_a03601baefa220335487dfc838c08d268}{PACKED\_NODE\_SIZE\_IP4};
190     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (ip\_family == \hyperlink{network_8h_a38cdd2f189180d6790d5b181f55ca047}{TCP\_INET}) \{
191         \textcolor{keywordflow}{return} \hyperlink{_d_h_t_8c_a03601baefa220335487dfc838c08d268}{PACKED\_NODE\_SIZE\_IP4};
192     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (ip\_family == AF\_INET6) \{
193         \textcolor{keywordflow}{return} \hyperlink{_d_h_t_8c_a9b47e23b0610a17f01902680f55d7963}{PACKED\_NODE\_SIZE\_IP6};
194     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (ip\_family == \hyperlink{network_8h_a7cd884776d628ca50049592d963c10cc}{TCP\_INET6}) \{
195         \textcolor{keywordflow}{return} \hyperlink{_d_h_t_8c_a9b47e23b0610a17f01902680f55d7963}{PACKED\_NODE\_SIZE\_IP6};
196     \} \textcolor{keywordflow}{else} \{
197         \textcolor{keywordflow}{return} -1;
198     \}
199 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/dad/_d_h_t_8h_aa980937ac320a4389b726e04da26cb44_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8h_a91072d384a61a04ac1e4d679dc7efb3a}{\index{D\+H\+T.\+h@{D\+H\+T.\+h}!route\+\_\+packet@{route\+\_\+packet}}
\index{route\+\_\+packet@{route\+\_\+packet}!D\+H\+T.\+h@{D\+H\+T.\+h}}
\subsubsection[{route\+\_\+packet}]{\setlength{\rightskip}{0pt plus 5cm}int route\+\_\+packet (
\begin{DoxyParamCaption}
\item[{const {\bf D\+H\+T} $\ast$}]{dht, }
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key, }
\item[{const uint8\+\_\+t $\ast$}]{packet, }
\item[{uint16\+\_\+t}]{length}
\end{DoxyParamCaption}
)}}\label{_d_h_t_8h_a91072d384a61a04ac1e4d679dc7efb3a}


Definition at line 1467 of file D\+H\+T.\+c.



References Client\+\_\+data\+::assoc4, Client\+\_\+data\+::assoc6, D\+H\+T\+::close\+\_\+clientlist, i, id\+\_\+equal(), I\+P\+\_\+\+Port\+::ip, ip\+\_\+isset(), I\+P\+P\+Ts\+Png\+::ip\+\_\+port, L\+C\+L\+I\+E\+N\+T\+\_\+\+L\+I\+S\+T, D\+H\+T\+::net, Client\+\_\+data\+::public\+\_\+key, and sendpacket().



Referenced by cryptopacket\+\_\+handle().


\begin{DoxyCode}
1468 \{
1469     uint32\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
1470 
1471     \textcolor{keywordflow}{for} (i = 0; i < \hyperlink{_d_h_t_8h_a3058f857a8316099e20c95fb07adc7c1}{LCLIENT\_LIST}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
1472         \textcolor{keywordflow}{if} (\hyperlink{util_8c_ada3d44b4f530d3c8c9cb69b732be94b1}{id\_equal}(\hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, dht->\hyperlink{struct_d_h_t_a00ef35d5b0e7a791ef08a30b3bacbf9d}{close\_clientlist}[i].
      \hyperlink{struct_client__data_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key})) \{
1473             \textcolor{keyword}{const} \hyperlink{struct_client__data}{Client\_data} *client = &dht->\hyperlink{struct_d_h_t_a00ef35d5b0e7a791ef08a30b3bacbf9d}{close\_clientlist}[
      \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}];
1474 
1475             \textcolor{keywordflow}{if} (\hyperlink{network_8c_ac56c677f4bc8bf8311370ee105ae7cbb}{ip\_isset}(&client->\hyperlink{struct_client__data_a87d394929a2604f6f785fec949fac618}{assoc6}.\hyperlink{struct_i_p_p_ts_png_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}))
1476                 \textcolor{keywordflow}{return} \hyperlink{network_8c_a7b90f87f3ba60cc5c66dd6dd77cd5cb1}{sendpacket}(dht->\hyperlink{struct_d_h_t_aa14ea2f67950f57fe4235d7375a2216c}{net}, client->\hyperlink{struct_client__data_a87d394929a2604f6f785fec949fac618}{assoc6}.
      \hyperlink{struct_i_p_p_ts_png_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}, packet, length);
1477             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{network_8c_ac56c677f4bc8bf8311370ee105ae7cbb}{ip\_isset}(&client->\hyperlink{struct_client__data_ac9843379cbcd02bdfa5c180a1474a6c5}{assoc4}.\hyperlink{struct_i_p_p_ts_png_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}))
1478                 \textcolor{keywordflow}{return} \hyperlink{network_8c_a7b90f87f3ba60cc5c66dd6dd77cd5cb1}{sendpacket}(dht->\hyperlink{struct_d_h_t_aa14ea2f67950f57fe4235d7375a2216c}{net}, client->\hyperlink{struct_client__data_ac9843379cbcd02bdfa5c180a1474a6c5}{assoc4}.
      \hyperlink{struct_i_p_p_ts_png_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}, packet, length);
1479             \textcolor{keywordflow}{else}
1480                 \textcolor{keywordflow}{break};
1481         \}
1482     \}
1483 
1484     \textcolor{keywordflow}{return} -1;
1485 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=256pt]{df/dad/_d_h_t_8h_a91072d384a61a04ac1e4d679dc7efb3a_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/dad/_d_h_t_8h_a91072d384a61a04ac1e4d679dc7efb3a_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8h_aee23d763e291eefd141227cd9e3684ab}{\index{D\+H\+T.\+h@{D\+H\+T.\+h}!route\+\_\+tofriend@{route\+\_\+tofriend}}
\index{route\+\_\+tofriend@{route\+\_\+tofriend}!D\+H\+T.\+h@{D\+H\+T.\+h}}
\subsubsection[{route\+\_\+tofriend}]{\setlength{\rightskip}{0pt plus 5cm}int route\+\_\+tofriend (
\begin{DoxyParamCaption}
\item[{const {\bf D\+H\+T} $\ast$}]{dht, }
\item[{const uint8\+\_\+t $\ast$}]{friend\+\_\+id, }
\item[{const uint8\+\_\+t $\ast$}]{packet, }
\item[{uint16\+\_\+t}]{length}
\end{DoxyParamCaption}
)}}\label{_d_h_t_8h_aee23d763e291eefd141227cd9e3684ab}


Definition at line 1562 of file D\+H\+T.\+c.



References Client\+\_\+data\+::assoc4, Client\+\_\+data\+::assoc6, B\+A\+D\+\_\+\+N\+O\+D\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T, friend\+\_\+iplist(), friend\+\_\+number(), D\+H\+T\+::friends\+\_\+list, i, I\+P\+\_\+\+Port\+::ip, ip\+\_\+isset(), I\+P\+P\+Ts\+Png\+::ip\+\_\+port, is\+\_\+timeout(), M\+A\+X\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+C\+L\+I\+E\+N\+T\+S, D\+H\+T\+::net, num, I\+P\+P\+Ts\+Png\+::ret\+\_\+ip\+\_\+port, I\+P\+P\+Ts\+Png\+::ret\+\_\+timestamp, and sendpacket().



Referenced by send\+\_\+dht\+\_\+dhtpk(), and send\+\_\+\+N\+A\+Tping().


\begin{DoxyCode}
1563 \{
1564     \textcolor{keywordtype}{int} \hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num} = \hyperlink{_d_h_t_8c_a6cbd0f66d63003cc0def913dc7a4254b}{friend\_number}(dht, \hyperlink{messenger__test_8c_a5d7925718457bca84bda0952f9463a3c}{friend\_id});
1565 
1566     \textcolor{keywordflow}{if} (num == -1)
1567         \textcolor{keywordflow}{return} 0;
1568 
1569     uint32\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}, sent = 0;
1570     uint8\_t friend\_sent[\hyperlink{_d_h_t_8h_ad50d158518277ca4d19cbe364f3e958c}{MAX\_FRIEND\_CLIENTS}] = \{0\};
1571 
1572     \hyperlink{struct_i_p___port}{IP\_Port} ip\_list[\hyperlink{_d_h_t_8h_ad50d158518277ca4d19cbe364f3e958c}{MAX\_FRIEND\_CLIENTS}];
1573     \textcolor{keywordtype}{int} ip\_num = \hyperlink{_d_h_t_8c_a1b3c1814260eace443e6feb13227cc82}{friend\_iplist}(dht, ip\_list, num);
1574 
1575     \textcolor{keywordflow}{if} (ip\_num < (\hyperlink{_d_h_t_8h_ad50d158518277ca4d19cbe364f3e958c}{MAX\_FRIEND\_CLIENTS} / 4))
1576         \textcolor{keywordflow}{return} 0; \textcolor{comment}{/* Reason for that? */}
1577 
1578     \hyperlink{struct_d_h_t___friend}{DHT\_Friend} *\textcolor{keyword}{friend} = &dht->\hyperlink{struct_d_h_t_ae97c6b057d770e7c4f3905cbe33b188b}{friends\_list}[\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num}];
1579     \hyperlink{struct_client__data}{Client\_data} *client;
1580 
1581     \textcolor{comment}{/* extra legwork, because having the outside allocating the space for us}
1582 \textcolor{comment}{     * is *usually* good(tm) (bites us in the behind in this case though) */}
1583     uint32\_t a;
1584 
1585     \textcolor{keywordflow}{for} (a = 0; a < 2; a++)
1586         \textcolor{keywordflow}{for} (i = 0; i < \hyperlink{_d_h_t_8h_ad50d158518277ca4d19cbe364f3e958c}{MAX\_FRIEND\_CLIENTS}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
1587             \textcolor{keywordflow}{if} (friend\_sent[i])\textcolor{comment}{/* Send one packet per client.*/}
1588                 \textcolor{keywordflow}{continue};
1589 
1590             client = &\textcolor{keyword}{friend}->client\_list[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}];
1591             \hyperlink{struct_i_p_p_ts_png}{IPPTsPng} *assoc = NULL;
1592 
1593             \textcolor{keywordflow}{if} (!a)
1594                 assoc = &client->\hyperlink{struct_client__data_ac9843379cbcd02bdfa5c180a1474a6c5}{assoc4};
1595             \textcolor{keywordflow}{else}
1596                 assoc = &client->\hyperlink{struct_client__data_a87d394929a2604f6f785fec949fac618}{assoc6};
1597 
1598             \textcolor{comment}{/* If ip is not zero and node is good. */}
1599             \textcolor{keywordflow}{if} (\hyperlink{network_8c_ac56c677f4bc8bf8311370ee105ae7cbb}{ip\_isset}(&assoc->\hyperlink{struct_i_p_p_ts_png_a28f2dcc657352ee4855d05ed42e4a4af}{ret\_ip\_port}.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}) &&
1600                     !\hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(assoc->\hyperlink{struct_i_p_p_ts_png_a5a40b83400feebb632862f593ad5e4a7}{ret\_timestamp}, 
      \hyperlink{_d_h_t_8h_a2c542fd03a43f340d1fb281afe54453f}{BAD\_NODE\_TIMEOUT})) \{
1601                 \textcolor{keywordtype}{int} retval = \hyperlink{network_8c_a7b90f87f3ba60cc5c66dd6dd77cd5cb1}{sendpacket}(dht->\hyperlink{struct_d_h_t_aa14ea2f67950f57fe4235d7375a2216c}{net}, assoc->\hyperlink{struct_i_p_p_ts_png_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}, packet, length);
1602 
1603                 \textcolor{keywordflow}{if} ((\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int})retval == length) \{
1604                     ++sent;
1605                     friend\_sent[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}] = 1;
1606                 \}
1607             \}
1608         \}
1609 
1610     \textcolor{keywordflow}{return} sent;
1611 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/dad/_d_h_t_8h_aee23d763e291eefd141227cd9e3684ab_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/dad/_d_h_t_8h_aee23d763e291eefd141227cd9e3684ab_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8h_a74120ec4fc551572bff2a08436854c97}{\index{D\+H\+T.\+h@{D\+H\+T.\+h}!to\+\_\+host\+\_\+family@{to\+\_\+host\+\_\+family}}
\index{to\+\_\+host\+\_\+family@{to\+\_\+host\+\_\+family}!D\+H\+T.\+h@{D\+H\+T.\+h}}
\subsubsection[{to\+\_\+host\+\_\+family}]{\setlength{\rightskip}{0pt plus 5cm}int to\+\_\+host\+\_\+family (
\begin{DoxyParamCaption}
\item[{{\bf I\+P} $\ast$}]{ip}
\end{DoxyParamCaption}
)}}\label{_d_h_t_8h_a74120ec4fc551572bff2a08436854c97}


Definition at line 167 of file D\+H\+T.\+c.



References I\+P\+::family, T\+O\+X\+\_\+\+A\+F\+\_\+\+I\+N\+E\+T, and T\+O\+X\+\_\+\+A\+F\+\_\+\+I\+N\+E\+T6.



Referenced by ip\+\_\+unpack().


\begin{DoxyCode}
168 \{
169     \textcolor{keywordflow}{if} (ip->\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} == \hyperlink{_d_h_t_8h_ac35a63082a23b6ced97c0a3a24ba06be}{TOX\_AF\_INET}) \{
170         ip->\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} = AF\_INET;
171         \textcolor{keywordflow}{return} 0;
172     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (ip->\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} == \hyperlink{_d_h_t_8h_a025adcf535ab2c7123fb5ea22fe20bbd}{TOX\_AF\_INET6}) \{
173         ip->\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} = AF\_INET6;
174         \textcolor{keywordflow}{return} 0;
175     \} \textcolor{keywordflow}{else} \{
176         \textcolor{keywordflow}{return} -1;
177     \}
178 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/dad/_d_h_t_8h_a74120ec4fc551572bff2a08436854c97_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8h_ae7f65a76f9c4b0093f45fc1777238459}{\index{D\+H\+T.\+h@{D\+H\+T.\+h}!to\+\_\+net\+\_\+family@{to\+\_\+net\+\_\+family}}
\index{to\+\_\+net\+\_\+family@{to\+\_\+net\+\_\+family}!D\+H\+T.\+h@{D\+H\+T.\+h}}
\subsubsection[{to\+\_\+net\+\_\+family}]{\setlength{\rightskip}{0pt plus 5cm}void to\+\_\+net\+\_\+family (
\begin{DoxyParamCaption}
\item[{{\bf I\+P} $\ast$}]{ip}
\end{DoxyParamCaption}
)}}\label{_d_h_t_8h_ae7f65a76f9c4b0093f45fc1777238459}


Definition at line 159 of file D\+H\+T.\+c.



References I\+P\+::family, T\+O\+X\+\_\+\+A\+F\+\_\+\+I\+N\+E\+T, and T\+O\+X\+\_\+\+A\+F\+\_\+\+I\+N\+E\+T6.



Referenced by ip\+\_\+pack().


\begin{DoxyCode}
160 \{
161     \textcolor{keywordflow}{if} (ip->\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} == AF\_INET)
162         ip->\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} = \hyperlink{_d_h_t_8h_ac35a63082a23b6ced97c0a3a24ba06be}{TOX\_AF\_INET};
163     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (ip->\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} == AF\_INET6)
164         ip->\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} = \hyperlink{_d_h_t_8h_a025adcf535ab2c7123fb5ea22fe20bbd}{TOX\_AF\_INET6};
165 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/dad/_d_h_t_8h_ae7f65a76f9c4b0093f45fc1777238459_icgraph}
\end{center}
\end{figure}


\hypertarget{_d_h_t_8h_a45b33af842c0289c78c70f81e854ed62}{\index{D\+H\+T.\+h@{D\+H\+T.\+h}!unpack\+\_\+nodes@{unpack\+\_\+nodes}}
\index{unpack\+\_\+nodes@{unpack\+\_\+nodes}!D\+H\+T.\+h@{D\+H\+T.\+h}}
\subsubsection[{unpack\+\_\+nodes}]{\setlength{\rightskip}{0pt plus 5cm}int unpack\+\_\+nodes (
\begin{DoxyParamCaption}
\item[{{\bf Node\+\_\+format} $\ast$}]{nodes, }
\item[{uint16\+\_\+t}]{max\+\_\+num\+\_\+nodes, }
\item[{uint16\+\_\+t $\ast$}]{processed\+\_\+data\+\_\+len, }
\item[{const uint8\+\_\+t $\ast$}]{data, }
\item[{uint16\+\_\+t}]{length, }
\item[{uint8\+\_\+t}]{tcp\+\_\+enabled}
\end{DoxyParamCaption}
)}}\label{_d_h_t_8h_a45b33af842c0289c78c70f81e854ed62}


Definition at line 268 of file D\+H\+T.\+c.



References I\+P\+::family, I\+P\+\_\+\+Port\+::ip, Node\+\_\+format\+::ip\+\_\+port, num, P\+A\+C\+K\+E\+D\+\_\+\+N\+O\+D\+E\+\_\+\+S\+I\+Z\+E\+\_\+\+I\+P4, P\+A\+C\+K\+E\+D\+\_\+\+N\+O\+D\+E\+\_\+\+S\+I\+Z\+E\+\_\+\+I\+P6, make-\/funny-\/savefile\+::public\+\_\+key, S\+I\+Z\+E\+\_\+\+I\+P4, S\+I\+Z\+E\+\_\+\+I\+P6, T\+C\+P\+\_\+\+I\+N\+E\+T, T\+C\+P\+\_\+\+I\+N\+E\+T6, T\+O\+X\+\_\+\+A\+F\+\_\+\+I\+N\+E\+T, T\+O\+X\+\_\+\+A\+F\+\_\+\+I\+N\+E\+T6, T\+O\+X\+\_\+\+T\+C\+P\+\_\+\+I\+N\+E\+T, and T\+O\+X\+\_\+\+T\+C\+P\+\_\+\+I\+N\+E\+T6.



Referenced by dht\+\_\+load\+\_\+state\+\_\+callback(), handle\+\_\+announce\+\_\+response(), handle\+\_\+dhtpk\+\_\+announce(), handle\+\_\+hardening(), handle\+\_\+packet(), handle\+\_\+sendnodes\+\_\+core(), and messenger\+\_\+load\+\_\+state\+\_\+callback().


\begin{DoxyCode}
270 \{
271     uint32\_t \hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num} = 0, len\_processed = 0;
272 
273     \textcolor{keywordflow}{while} (num < max\_num\_nodes && len\_processed < length) \{
274         \textcolor{keywordtype}{int} ipv6 = -1;
275         uint8\_t host\_family;
276 
277         \textcolor{keywordflow}{if} (\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[len\_processed] == \hyperlink{_d_h_t_8h_ac35a63082a23b6ced97c0a3a24ba06be}{TOX\_AF\_INET}) \{
278             ipv6 = 0;
279             host\_family = AF\_INET;
280         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[len\_processed] == \hyperlink{_d_h_t_8h_ab59616c5422ae79ebc665059761879d5}{TOX\_TCP\_INET}) \{
281             \textcolor{keywordflow}{if} (!tcp\_enabled)
282                 \textcolor{keywordflow}{return} -1;
283 
284             ipv6 = 0;
285             host\_family = \hyperlink{network_8h_a38cdd2f189180d6790d5b181f55ca047}{TCP\_INET};
286         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[len\_processed] == \hyperlink{_d_h_t_8h_a025adcf535ab2c7123fb5ea22fe20bbd}{TOX\_AF\_INET6}) \{
287             ipv6 = 1;
288             host\_family = AF\_INET6;
289         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[len\_processed] == \hyperlink{_d_h_t_8h_a30bf86f2e1f87bcbd6a90145943aabac}{TOX\_TCP\_INET6}) \{
290             \textcolor{keywordflow}{if} (!tcp\_enabled)
291                 \textcolor{keywordflow}{return} -1;
292 
293             ipv6 = 1;
294             host\_family = \hyperlink{network_8h_a7cd884776d628ca50049592d963c10cc}{TCP\_INET6};
295         \} \textcolor{keywordflow}{else} \{
296             \textcolor{keywordflow}{return} -1;
297         \}
298 
299         \textcolor{keywordflow}{if} (ipv6 == 0) \{
300             uint32\_t size = \hyperlink{_d_h_t_8c_a03601baefa220335487dfc838c08d268}{PACKED\_NODE\_SIZE\_IP4};
301 
302             \textcolor{keywordflow}{if} (len\_processed + size > length)
303                 \textcolor{keywordflow}{return} -1;
304 
305             nodes[\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num}].\hyperlink{struct_node__format_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} = host\_family;
306             memcpy(&nodes[num].ip\_port.ip.ip4, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} + len\_processed + 1, 
      \hyperlink{network_8h_af01e75c1c63a39bcd2aacdf3018b18c9}{SIZE\_IP4});
307             memcpy(&nodes[num].ip\_port.port, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} + len\_processed + 1 + 
      \hyperlink{network_8h_af01e75c1c63a39bcd2aacdf3018b18c9}{SIZE\_IP4}, \textcolor{keyword}{sizeof}(uint16\_t));
308             memcpy(nodes[num].\hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} + len\_processed + 1 + 
      \hyperlink{network_8h_af01e75c1c63a39bcd2aacdf3018b18c9}{SIZE\_IP4} + \textcolor{keyword}{sizeof}(uint16\_t), crypto\_box\_PUBLICKEYBYTES);
309             len\_processed += size;
310             ++\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num};
311         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (ipv6 == 1) \{
312             uint32\_t size = \hyperlink{_d_h_t_8c_a9b47e23b0610a17f01902680f55d7963}{PACKED\_NODE\_SIZE\_IP6};
313 
314             \textcolor{keywordflow}{if} (len\_processed + size > length)
315                 \textcolor{keywordflow}{return} -1;
316 
317             nodes[\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num}].\hyperlink{struct_node__format_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} = host\_family;
318             memcpy(&nodes[num].ip\_port.ip.ip6, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} + len\_processed + 1, 
      \hyperlink{network_8h_a5d7430ad26f80239b9fe1bbcd51b5ed2}{SIZE\_IP6});
319             memcpy(&nodes[num].ip\_port.port, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} + len\_processed + 1 + 
      \hyperlink{network_8h_a5d7430ad26f80239b9fe1bbcd51b5ed2}{SIZE\_IP6}, \textcolor{keyword}{sizeof}(uint16\_t));
320             memcpy(nodes[num].\hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} + len\_processed + 1 + 
      \hyperlink{network_8h_a5d7430ad26f80239b9fe1bbcd51b5ed2}{SIZE\_IP6} + \textcolor{keyword}{sizeof}(uint16\_t), crypto\_box\_PUBLICKEYBYTES);
321             len\_processed += size;
322             ++\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num};
323         \} \textcolor{keywordflow}{else} \{
324             \textcolor{keywordflow}{return} -1;
325         \}
326     \}
327 
328     \textcolor{keywordflow}{if} (processed\_data\_len)
329         *processed\_data\_len = len\_processed;
330 
331     \textcolor{keywordflow}{return} \hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num};
332 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/dad/_d_h_t_8h_a45b33af842c0289c78c70f81e854ed62_icgraph}
\end{center}
\end{figure}


