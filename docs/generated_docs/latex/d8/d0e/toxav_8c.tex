\hypertarget{toxav_8c}{\section{toxav/toxav.c File Reference}
\label{toxav_8c}\index{toxav/toxav.\+c@{toxav/toxav.\+c}}
}
{\ttfamily \#include \char`\"{}codec.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}msi.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}group.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}../toxcore/logger.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}../toxcore/util.\+h\char`\"{}}\\*
{\ttfamily \#include $<$assert.\+h$>$}\\*
{\ttfamily \#include $<$stdlib.\+h$>$}\\*
{\ttfamily \#include $<$string.\+h$>$}\\*
Include dependency graph for toxav.\+c\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d0/d76/toxav_8c__incl}
\end{center}
\end{figure}
\subsection*{Data Structures}
\begin{DoxyCompactItemize}
\item 
struct \hyperlink{struct___tox_av_call}{\+\_\+\+Tox\+Av\+Call}
\item 
struct \hyperlink{struct___tox_av}{\+\_\+\+Tox\+Av}
\end{DoxyCompactItemize}
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{toxav_8c_af80a3c50ad465fbd07df3d5fc144aa1b}{T\+O\+X\+\_\+\+D\+E\+F\+I\+N\+E\+D}
\item 
\#define \hyperlink{toxav_8c_a369266c24eacffb87046522897a570d5}{\+\_\+\+G\+N\+U\+\_\+\+S\+O\+U\+R\+C\+E}~/$\ast$ implicit declaration warning $\ast$/
\item 
\#define \hyperlink{toxav_8c_ae1b44adfa4b1d57de2dd1d9ba055d816}{M\+A\+X\+\_\+\+E\+N\+C\+O\+D\+E\+\_\+\+T\+I\+M\+E\+\_\+\+U\+S}~((1000 / 24) $\ast$ 1000)
\item 
\#define \hyperlink{toxav_8c_a9b51ecd9e898c75b7ed6cf9cd5596d1b}{C\+A\+L\+L\+\_\+\+I\+N\+V\+A\+L\+I\+D\+\_\+\+I\+N\+D\+E\+X}(idx, max)~(idx $<$ 0 $\vert$$\vert$ idx $>$= max)
\end{DoxyCompactItemize}
\subsection*{Typedefs}
\begin{DoxyCompactItemize}
\item 
typedef struct \hyperlink{struct_messenger}{Messenger} \hyperlink{toxav_8c_a9e678c08e286eb1f36ebc7f770354e82}{Tox}
\item 
typedef struct \hyperlink{struct___tox_av_call}{\+\_\+\+Tox\+Av\+Call} \hyperlink{toxav_8c_aec40f142d19ca255ccdf4097b03ef51e}{Tox\+Av\+Call}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
static const \hyperlink{msi_8h_abe548d26a24458ebf9ab33310ee19600}{M\+S\+I\+C\+Settings} $\ast$ \hyperlink{toxav_8c_ac5cf7284cc2e32780c71a7f5f80e3f9b}{msicsettings\+\_\+cast} (const \hyperlink{toxav_8h_ae30c65d2804a20349b0ea2ae240b209e}{Tox\+Av\+C\+Settings} $\ast$from)
\item 
static const \hyperlink{toxav_8h_ae30c65d2804a20349b0ea2ae240b209e}{Tox\+Av\+C\+Settings} $\ast$ \hyperlink{toxav_8c_a8eb45d94b5ed002925b58f36c66426b1}{toxavcsettings\+\_\+cast} (const \hyperlink{msi_8h_abe548d26a24458ebf9ab33310ee19600}{M\+S\+I\+C\+Settings} $\ast$from)
\item 
\hyperlink{toxav_8h_abdf4715f7de98af6ebe4c599cad42908}{Tox\+Av} $\ast$ \hyperlink{toxav_8c_ab5565a6110643c428b28b2c79fb47b08}{toxav\+\_\+new} (\hyperlink{toxav_8c_a9e678c08e286eb1f36ebc7f770354e82}{Tox} $\ast$messenger, int32\+\_\+t max\+\_\+calls)
\item 
void \hyperlink{toxav_8c_a10c356c3264067f4e8ebdc1cc7c6d545}{toxav\+\_\+kill} (\hyperlink{toxav_8h_abdf4715f7de98af6ebe4c599cad42908}{Tox\+Av} $\ast$av)
\item 
uint32\+\_\+t \hyperlink{toxav_8c_a552b5f2c515a0162c7f44e66db707be5}{toxav\+\_\+do\+\_\+interval} (\hyperlink{toxav_8h_abdf4715f7de98af6ebe4c599cad42908}{Tox\+Av} $\ast$av)
\item 
void \hyperlink{toxav_8c_a78b4ac618a3683f06432c06594846121}{toxav\+\_\+do} (\hyperlink{toxav_8h_abdf4715f7de98af6ebe4c599cad42908}{Tox\+Av} $\ast$av)
\item 
void \hyperlink{toxav_8c_a9abb9d72d8ce906d4bfc5b472b617017}{toxav\+\_\+register\+\_\+callstate\+\_\+callback} (\hyperlink{toxav_8h_abdf4715f7de98af6ebe4c599cad42908}{Tox\+Av} $\ast$av, \hyperlink{toxav_8h_ad6ce886c46b3de9e6780013cf8c86c6c}{Tox\+A\+V\+Callback} cb, \hyperlink{toxav_8h_a67e2b4baef8db67a8e1d00618ad0f9a1}{Tox\+Av\+Callback\+I\+D} id, void $\ast$userdata)
\item 
void \hyperlink{toxav_8c_a61dbbb75f2337c5c7c77acd83fffe639}{toxav\+\_\+register\+\_\+audio\+\_\+callback} (\hyperlink{toxav_8h_abdf4715f7de98af6ebe4c599cad42908}{Tox\+Av} $\ast$av, \hyperlink{toxav_8h_a92a2e7e1f30f65c5a1cac3f8969e3254}{Tox\+Av\+Audio\+Callback} cb, void $\ast$userdata)
\item 
void \hyperlink{toxav_8c_a22179185a68fe2a2f126b2c328670f73}{toxav\+\_\+register\+\_\+video\+\_\+callback} (\hyperlink{toxav_8h_abdf4715f7de98af6ebe4c599cad42908}{Tox\+Av} $\ast$av, \hyperlink{toxav_8h_a17935d23b920a53df6e7f3d7679ffed0}{Tox\+Av\+Video\+Callback} cb, void $\ast$userdata)
\item 
int \hyperlink{toxav_8c_a4fde8db9bc925b8b5c4b974d8935daac}{toxav\+\_\+call} (\hyperlink{toxav_8h_abdf4715f7de98af6ebe4c599cad42908}{Tox\+Av} $\ast$av, int32\+\_\+t $\ast$call\+\_\+index, int user, const \hyperlink{toxav_8h_ae30c65d2804a20349b0ea2ae240b209e}{Tox\+Av\+C\+Settings} $\ast$csettings, int ringing\+\_\+seconds)
\item 
int \hyperlink{toxav_8c_a225958005e20091600e798e9827a5639}{toxav\+\_\+hangup} (\hyperlink{toxav_8h_abdf4715f7de98af6ebe4c599cad42908}{Tox\+Av} $\ast$av, int32\+\_\+t call\+\_\+index)
\item 
int \hyperlink{toxav_8c_a71ea4cbf449462254bc5982b810dfe20}{toxav\+\_\+answer} (\hyperlink{toxav_8h_abdf4715f7de98af6ebe4c599cad42908}{Tox\+Av} $\ast$av, int32\+\_\+t call\+\_\+index, const \hyperlink{toxav_8h_ae30c65d2804a20349b0ea2ae240b209e}{Tox\+Av\+C\+Settings} $\ast$csettings)
\item 
int \hyperlink{toxav_8c_ad783f1a19a2765ff6924723193d05d07}{toxav\+\_\+reject} (\hyperlink{toxav_8h_abdf4715f7de98af6ebe4c599cad42908}{Tox\+Av} $\ast$av, int32\+\_\+t call\+\_\+index, const char $\ast$reason)
\item 
int \hyperlink{toxav_8c_ae0d14b853f586b2e07d2d0ef62efc4eb}{toxav\+\_\+cancel} (\hyperlink{toxav_8h_abdf4715f7de98af6ebe4c599cad42908}{Tox\+Av} $\ast$av, int32\+\_\+t call\+\_\+index, int peer\+\_\+id, const char $\ast$reason)
\item 
int \hyperlink{toxav_8c_a2ad323fd957032a11b1fadd4668f41ee}{toxav\+\_\+change\+\_\+settings} (\hyperlink{toxav_8h_abdf4715f7de98af6ebe4c599cad42908}{Tox\+Av} $\ast$av, int32\+\_\+t call\+\_\+index, const \hyperlink{toxav_8h_ae30c65d2804a20349b0ea2ae240b209e}{Tox\+Av\+C\+Settings} $\ast$csettings)
\item 
int \hyperlink{toxav_8c_a7f5a8786bb985cdcdae0cc42a442b23e}{toxav\+\_\+stop\+\_\+call} (\hyperlink{toxav_8h_abdf4715f7de98af6ebe4c599cad42908}{Tox\+Av} $\ast$av, int32\+\_\+t call\+\_\+index)
\item 
int \hyperlink{toxav_8c_a9f2a69dda0bfe14d2a2bcf2497967f31}{toxav\+\_\+prepare\+\_\+transmission} (\hyperlink{toxav_8h_abdf4715f7de98af6ebe4c599cad42908}{Tox\+Av} $\ast$av, int32\+\_\+t call\+\_\+index, int support\+\_\+video)
\item 
int \hyperlink{toxav_8c_aeef2a0ed5e716e7449d3f1c6053e31af}{toxav\+\_\+kill\+\_\+transmission} (\hyperlink{toxav_8h_abdf4715f7de98af6ebe4c599cad42908}{Tox\+Av} $\ast$av, int32\+\_\+t call\+\_\+index)
\item 
static int \hyperlink{toxav_8c_aa03b009616ed838e27caded4f69483d1}{toxav\+\_\+send\+\_\+rtp\+\_\+payload} (\hyperlink{toxav_8h_abdf4715f7de98af6ebe4c599cad42908}{Tox\+Av} $\ast$av, \hyperlink{toxav_8c_aec40f142d19ca255ccdf4097b03ef51e}{Tox\+Av\+Call} $\ast$call, \hyperlink{toxav_8h_aa735e8f3c71af6a841c2ffc3650bb802}{Tox\+Av\+Call\+Type} type, const uint8\+\_\+t $\ast$payload, unsigned int length)
\item 
int \hyperlink{toxav_8c_ac15e39782145d25bf6ba397aaf910071}{toxav\+\_\+prepare\+\_\+video\+\_\+frame} (\hyperlink{toxav_8h_abdf4715f7de98af6ebe4c599cad42908}{Tox\+Av} $\ast$av, int32\+\_\+t call\+\_\+index, uint8\+\_\+t $\ast$dest, int dest\+\_\+max, vpx\+\_\+image\+\_\+t $\ast$input)
\item 
int \hyperlink{toxav_8c_a4aa0876a176b4e5e7abea2f72059a502}{toxav\+\_\+send\+\_\+video} (\hyperlink{toxav_8h_abdf4715f7de98af6ebe4c599cad42908}{Tox\+Av} $\ast$av, int32\+\_\+t call\+\_\+index, const uint8\+\_\+t $\ast$frame, unsigned int frame\+\_\+size)
\item 
int \hyperlink{toxav_8c_a64caf285a2ad7cadf24263e0f8f7a507}{toxav\+\_\+prepare\+\_\+audio\+\_\+frame} (\hyperlink{toxav_8h_abdf4715f7de98af6ebe4c599cad42908}{Tox\+Av} $\ast$av, int32\+\_\+t call\+\_\+index, uint8\+\_\+t $\ast$dest, int dest\+\_\+max, const int16\+\_\+t $\ast$frame, int frame\+\_\+size)
\item 
int \hyperlink{toxav_8c_abd49d9a595a87814f54eeaa17d7ad833}{toxav\+\_\+send\+\_\+audio} (\hyperlink{toxav_8h_abdf4715f7de98af6ebe4c599cad42908}{Tox\+Av} $\ast$av, int32\+\_\+t call\+\_\+index, const uint8\+\_\+t $\ast$data, unsigned int size)
\item 
int \hyperlink{toxav_8c_aaa65fd5f05a94ed9abf63c42f5e10ed4}{toxav\+\_\+get\+\_\+peer\+\_\+csettings} (\hyperlink{toxav_8h_abdf4715f7de98af6ebe4c599cad42908}{Tox\+Av} $\ast$av, int32\+\_\+t call\+\_\+index, int peer, \hyperlink{toxav_8h_ae30c65d2804a20349b0ea2ae240b209e}{Tox\+Av\+C\+Settings} $\ast$dest)
\item 
int \hyperlink{toxav_8c_a7de9b3c23c1d6b46b3ed0f2ea3385a7b}{toxav\+\_\+get\+\_\+peer\+\_\+id} (\hyperlink{toxav_8h_abdf4715f7de98af6ebe4c599cad42908}{Tox\+Av} $\ast$av, int32\+\_\+t call\+\_\+index, int peer)
\item 
\hyperlink{toxav_8h_ab2667961717e3fa3f2e13c69d2fec01d}{Tox\+Av\+Call\+State} \hyperlink{toxav_8c_a6217a5aaff6ccbb8768080466613208b}{toxav\+\_\+get\+\_\+call\+\_\+state} (\hyperlink{toxav_8h_abdf4715f7de98af6ebe4c599cad42908}{Tox\+Av} $\ast$av, int32\+\_\+t call\+\_\+index)
\item 
int \hyperlink{toxav_8c_aa0c1199d6c03b979810a27ce82751e7d}{toxav\+\_\+capability\+\_\+supported} (\hyperlink{toxav_8h_abdf4715f7de98af6ebe4c599cad42908}{Tox\+Av} $\ast$av, int32\+\_\+t call\+\_\+index, \hyperlink{toxav_8h_a74db561fc75b482ab0f045a6dd1ac265}{Tox\+Av\+Capabilities} capability)
\item 
\hyperlink{toxav_8c_a9e678c08e286eb1f36ebc7f770354e82}{Tox} $\ast$ \hyperlink{toxav_8c_abef2e18b8445840844cb411fa3cd4a49}{toxav\+\_\+get\+\_\+tox} (\hyperlink{toxav_8h_abdf4715f7de98af6ebe4c599cad42908}{Tox\+Av} $\ast$av)
\item 
int \hyperlink{toxav_8c_a45828173fc8cd78ee9c50390a98ce10d}{toxav\+\_\+get\+\_\+active\+\_\+count} (\hyperlink{toxav_8h_abdf4715f7de98af6ebe4c599cad42908}{Tox\+Av} $\ast$av)
\item 
int \hyperlink{toxav_8c_a593b4b2a8f14139b452f53f9543a18e0}{toxav\+\_\+add\+\_\+av\+\_\+groupchat} (\hyperlink{toxav_8c_a9e678c08e286eb1f36ebc7f770354e82}{Tox} $\ast$tox, void($\ast$audio\+\_\+callback)(\hyperlink{struct_messenger}{Messenger} $\ast$, int, int, const int16\+\_\+t $\ast$, unsigned int, uint8\+\_\+t, unsigned int, void $\ast$), void $\ast$userdata)
\item 
int \hyperlink{toxav_8c_a72a9a86105538f4f702d006185ce0b7e}{toxav\+\_\+join\+\_\+av\+\_\+groupchat} (\hyperlink{toxav_8c_a9e678c08e286eb1f36ebc7f770354e82}{Tox} $\ast$tox, int32\+\_\+t friendnumber, const uint8\+\_\+t $\ast$data, uint16\+\_\+t length, void($\ast$audio\+\_\+callback)(\hyperlink{struct_messenger}{Messenger} $\ast$, int, int, const int16\+\_\+t $\ast$, unsigned int, uint8\+\_\+t, unsigned int, void $\ast$), void $\ast$userdata)
\item 
int \hyperlink{toxav_8c_ad78d09fb2b5ac7b1bd5c2395a7bdb5c6}{toxav\+\_\+group\+\_\+send\+\_\+audio} (\hyperlink{toxav_8c_a9e678c08e286eb1f36ebc7f770354e82}{Tox} $\ast$tox, int groupnumber, const int16\+\_\+t $\ast$pcm, unsigned int samples, uint8\+\_\+t channels, unsigned int sample\+\_\+rate)
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
const \hyperlink{toxav_8h_ae30c65d2804a20349b0ea2ae240b209e}{Tox\+Av\+C\+Settings} \hyperlink{toxav_8c_aff13faf6b338ca682c4c206b9fdde7fc}{av\+\_\+\+Default\+Settings}
\item 
static const uint32\+\_\+t \hyperlink{toxav_8c_a6a7e054aaa660429cbca3c5b0e6c83df}{jbuf\+\_\+capacity} = 6
\item 
static const uint8\+\_\+t \hyperlink{toxav_8c_adf973963a7840ccbd70ca8f958a8d8fa}{audio\+\_\+index} = 0
\item 
static const uint8\+\_\+t \hyperlink{toxav_8c_a8aac960ea1e1579b3d90c1ab4a3dfe79}{video\+\_\+index} = 1
\end{DoxyCompactItemize}


\subsection{Macro Definition Documentation}
\hypertarget{toxav_8c_a369266c24eacffb87046522897a570d5}{\index{toxav.\+c@{toxav.\+c}!\+\_\+\+G\+N\+U\+\_\+\+S\+O\+U\+R\+C\+E@{\+\_\+\+G\+N\+U\+\_\+\+S\+O\+U\+R\+C\+E}}
\index{\+\_\+\+G\+N\+U\+\_\+\+S\+O\+U\+R\+C\+E@{\+\_\+\+G\+N\+U\+\_\+\+S\+O\+U\+R\+C\+E}!toxav.\+c@{toxav.\+c}}
\subsubsection[{\+\_\+\+G\+N\+U\+\_\+\+S\+O\+U\+R\+C\+E}]{\setlength{\rightskip}{0pt plus 5cm}\#define \+\_\+\+G\+N\+U\+\_\+\+S\+O\+U\+R\+C\+E~/$\ast$ implicit declaration warning $\ast$/}}\label{toxav_8c_a369266c24eacffb87046522897a570d5}


Definition at line 29 of file toxav.\+c.

\hypertarget{toxav_8c_a9b51ecd9e898c75b7ed6cf9cd5596d1b}{\index{toxav.\+c@{toxav.\+c}!C\+A\+L\+L\+\_\+\+I\+N\+V\+A\+L\+I\+D\+\_\+\+I\+N\+D\+E\+X@{C\+A\+L\+L\+\_\+\+I\+N\+V\+A\+L\+I\+D\+\_\+\+I\+N\+D\+E\+X}}
\index{C\+A\+L\+L\+\_\+\+I\+N\+V\+A\+L\+I\+D\+\_\+\+I\+N\+D\+E\+X@{C\+A\+L\+L\+\_\+\+I\+N\+V\+A\+L\+I\+D\+\_\+\+I\+N\+D\+E\+X}!toxav.\+c@{toxav.\+c}}
\subsubsection[{C\+A\+L\+L\+\_\+\+I\+N\+V\+A\+L\+I\+D\+\_\+\+I\+N\+D\+E\+X}]{\setlength{\rightskip}{0pt plus 5cm}\#define C\+A\+L\+L\+\_\+\+I\+N\+V\+A\+L\+I\+D\+\_\+\+I\+N\+D\+E\+X(
\begin{DoxyParamCaption}
\item[{}]{idx, }
\item[{}]{max}
\end{DoxyParamCaption}
)~(idx $<$ 0 $\vert$$\vert$ idx $>$= max)}}\label{toxav_8c_a9b51ecd9e898c75b7ed6cf9cd5596d1b}


Definition at line 46 of file toxav.\+c.



Referenced by toxav\+\_\+get\+\_\+call\+\_\+state(), toxav\+\_\+get\+\_\+peer\+\_\+csettings(), toxav\+\_\+get\+\_\+peer\+\_\+id(), toxav\+\_\+kill\+\_\+transmission(), toxav\+\_\+prepare\+\_\+audio\+\_\+frame(), toxav\+\_\+prepare\+\_\+transmission(), toxav\+\_\+prepare\+\_\+video\+\_\+frame(), toxav\+\_\+send\+\_\+audio(), and toxav\+\_\+send\+\_\+video().

\hypertarget{toxav_8c_ae1b44adfa4b1d57de2dd1d9ba055d816}{\index{toxav.\+c@{toxav.\+c}!M\+A\+X\+\_\+\+E\+N\+C\+O\+D\+E\+\_\+\+T\+I\+M\+E\+\_\+\+U\+S@{M\+A\+X\+\_\+\+E\+N\+C\+O\+D\+E\+\_\+\+T\+I\+M\+E\+\_\+\+U\+S}}
\index{M\+A\+X\+\_\+\+E\+N\+C\+O\+D\+E\+\_\+\+T\+I\+M\+E\+\_\+\+U\+S@{M\+A\+X\+\_\+\+E\+N\+C\+O\+D\+E\+\_\+\+T\+I\+M\+E\+\_\+\+U\+S}!toxav.\+c@{toxav.\+c}}
\subsubsection[{M\+A\+X\+\_\+\+E\+N\+C\+O\+D\+E\+\_\+\+T\+I\+M\+E\+\_\+\+U\+S}]{\setlength{\rightskip}{0pt plus 5cm}\#define M\+A\+X\+\_\+\+E\+N\+C\+O\+D\+E\+\_\+\+T\+I\+M\+E\+\_\+\+U\+S~((1000 / 24) $\ast$ 1000)}}\label{toxav_8c_ae1b44adfa4b1d57de2dd1d9ba055d816}


Definition at line 43 of file toxav.\+c.



Referenced by toxav\+\_\+prepare\+\_\+video\+\_\+frame().

\hypertarget{toxav_8c_af80a3c50ad465fbd07df3d5fc144aa1b}{\index{toxav.\+c@{toxav.\+c}!T\+O\+X\+\_\+\+D\+E\+F\+I\+N\+E\+D@{T\+O\+X\+\_\+\+D\+E\+F\+I\+N\+E\+D}}
\index{T\+O\+X\+\_\+\+D\+E\+F\+I\+N\+E\+D@{T\+O\+X\+\_\+\+D\+E\+F\+I\+N\+E\+D}!toxav.\+c@{toxav.\+c}}
\subsubsection[{T\+O\+X\+\_\+\+D\+E\+F\+I\+N\+E\+D}]{\setlength{\rightskip}{0pt plus 5cm}\#define T\+O\+X\+\_\+\+D\+E\+F\+I\+N\+E\+D}}\label{toxav_8c_af80a3c50ad465fbd07df3d5fc144aa1b}
\hyperlink{toxav_8c}{toxav.\+c}

Copyright (C) 2013 Tox project All Rights Reserved.

This file is part of Tox.

Tox is free software\+: you can redistribute it and/or modify it under the terms of the G\+N\+U General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.

Tox is distributed in the hope that it will be useful, but W\+I\+T\+H\+O\+U\+T A\+N\+Y W\+A\+R\+R\+A\+N\+T\+Y; without even the implied warranty of M\+E\+R\+C\+H\+A\+N\+T\+A\+B\+I\+L\+I\+T\+Y or F\+I\+T\+N\+E\+S\+S F\+O\+R A P\+A\+R\+T\+I\+C\+U\+L\+A\+R P\+U\+R\+P\+O\+S\+E. See the G\+N\+U General Public License for more details.

You should have received a copy of the G\+N\+U General Public License along with Tox. If not, see \href{http://www.gnu.org/licenses/}{\tt http\+://www.\+gnu.\+org/licenses/}. 

Definition at line 26 of file toxav.\+c.



\subsection{Typedef Documentation}
\hypertarget{toxav_8c_a9e678c08e286eb1f36ebc7f770354e82}{\index{toxav.\+c@{toxav.\+c}!Tox@{Tox}}
\index{Tox@{Tox}!toxav.\+c@{toxav.\+c}}
\subsubsection[{Tox}]{\setlength{\rightskip}{0pt plus 5cm}typedef struct {\bf Messenger} {\bf Tox}}}\label{toxav_8c_a9e678c08e286eb1f36ebc7f770354e82}


Definition at line 27 of file toxav.\+c.

\hypertarget{toxav_8c_aec40f142d19ca255ccdf4097b03ef51e}{\index{toxav.\+c@{toxav.\+c}!Tox\+Av\+Call@{Tox\+Av\+Call}}
\index{Tox\+Av\+Call@{Tox\+Av\+Call}!toxav.\+c@{toxav.\+c}}
\subsubsection[{Tox\+Av\+Call}]{\setlength{\rightskip}{0pt plus 5cm}typedef struct {\bf \+\_\+\+Tox\+Av\+Call}  {\bf Tox\+Av\+Call}}}\label{toxav_8c_aec40f142d19ca255ccdf4097b03ef51e}


\subsection{Function Documentation}
\hypertarget{toxav_8c_ac5cf7284cc2e32780c71a7f5f80e3f9b}{\index{toxav.\+c@{toxav.\+c}!msicsettings\+\_\+cast@{msicsettings\+\_\+cast}}
\index{msicsettings\+\_\+cast@{msicsettings\+\_\+cast}!toxav.\+c@{toxav.\+c}}
\subsubsection[{msicsettings\+\_\+cast}]{\setlength{\rightskip}{0pt plus 5cm}static const {\bf M\+S\+I\+C\+Settings}$\ast$ msicsettings\+\_\+cast (
\begin{DoxyParamCaption}
\item[{const {\bf Tox\+Av\+C\+Settings} $\ast$}]{from}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{toxav_8c_ac5cf7284cc2e32780c71a7f5f80e3f9b}


Definition at line 89 of file toxav.\+c.



Referenced by toxav\+\_\+answer(), toxav\+\_\+call(), and toxav\+\_\+change\+\_\+settings().


\begin{DoxyCode}
90 \{
91     assert(\textcolor{keyword}{sizeof}(\hyperlink{struct___m_s_i_codec_settings}{MSICSettings}) == \textcolor{keyword}{sizeof}(\hyperlink{struct___tox_av_c_settings}{ToxAvCSettings}));
92     \textcolor{keywordflow}{return} (\textcolor{keyword}{const} \hyperlink{struct___m_s_i_codec_settings}{MSICSettings} *) from;
93 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/d0e/toxav_8c_ac5cf7284cc2e32780c71a7f5f80e3f9b_icgraph}
\end{center}
\end{figure}


\hypertarget{toxav_8c_a593b4b2a8f14139b452f53f9543a18e0}{\index{toxav.\+c@{toxav.\+c}!toxav\+\_\+add\+\_\+av\+\_\+groupchat@{toxav\+\_\+add\+\_\+av\+\_\+groupchat}}
\index{toxav\+\_\+add\+\_\+av\+\_\+groupchat@{toxav\+\_\+add\+\_\+av\+\_\+groupchat}!toxav.\+c@{toxav.\+c}}
\subsubsection[{toxav\+\_\+add\+\_\+av\+\_\+groupchat}]{\setlength{\rightskip}{0pt plus 5cm}int toxav\+\_\+add\+\_\+av\+\_\+groupchat (
\begin{DoxyParamCaption}
\item[{{\bf Tox} $\ast$}]{tox, }
\item[{void($\ast$)({\bf Messenger} $\ast$, int, int, const int16\+\_\+t $\ast$, unsigned int, uint8\+\_\+t, unsigned int, void $\ast$)}]{audio\+\_\+callback, }
\item[{void $\ast$}]{userdata}
\end{DoxyParamCaption}
)}}\label{toxav_8c_a593b4b2a8f14139b452f53f9543a18e0}


Definition at line 653 of file toxav.\+c.



References add\+\_\+av\+\_\+groupchat(), Messenger\+::group\+\_\+chat\+\_\+object, and m.


\begin{DoxyCode}
655 \{
656     \hyperlink{struct_messenger}{Messenger} *\hyperlink{messenger__test_8c_aea6eb6c7c30a659f1b0dee83eaf03ea2}{m} = tox;
657     \textcolor{keywordflow}{return} \hyperlink{toxav_2group_8c_a0cf061415a40de14b1dca48921a6f687}{add\_av\_groupchat}(m->\hyperlink{struct_messenger_accf717ba3e14c38e1611b17b78eed25c}{group\_chat\_object}, audio\_callback, userdata
      );
658 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/d0e/toxav_8c_a593b4b2a8f14139b452f53f9543a18e0_cgraph}
\end{center}
\end{figure}


\hypertarget{toxav_8c_a71ea4cbf449462254bc5982b810dfe20}{\index{toxav.\+c@{toxav.\+c}!toxav\+\_\+answer@{toxav\+\_\+answer}}
\index{toxav\+\_\+answer@{toxav\+\_\+answer}!toxav.\+c@{toxav.\+c}}
\subsubsection[{toxav\+\_\+answer}]{\setlength{\rightskip}{0pt plus 5cm}int toxav\+\_\+answer (
\begin{DoxyParamCaption}
\item[{{\bf Tox\+Av} $\ast$}]{av, }
\item[{int32\+\_\+t}]{call\+\_\+index, }
\item[{const {\bf Tox\+Av\+C\+Settings} $\ast$}]{csettings}
\end{DoxyParamCaption}
)}}\label{toxav_8c_a71ea4cbf449462254bc5982b810dfe20}
Answer incoming call. Pass the csettings that you will use. 

Definition at line 240 of file toxav.\+c.



References msi\+\_\+answer(), \+\_\+\+Tox\+Av\+::msi\+\_\+session, and msicsettings\+\_\+cast().



Referenced by in\+\_\+thread\+\_\+call().


\begin{DoxyCode}
241 \{
242     \textcolor{keywordflow}{return} \hyperlink{msi_8c_a3cf8337cde29970de207c3c77c953261}{msi\_answer}(av->\hyperlink{struct___tox_av_a85e3d7dd2ab722ee5ba0cd4b72bc7d60}{msi\_session}, call\_index, 
      \hyperlink{toxav_8c_ac5cf7284cc2e32780c71a7f5f80e3f9b}{msicsettings\_cast}(csettings));
243 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/d0e/toxav_8c_a71ea4cbf449462254bc5982b810dfe20_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=270pt]{d8/d0e/toxav_8c_a71ea4cbf449462254bc5982b810dfe20_icgraph}
\end{center}
\end{figure}


\hypertarget{toxav_8c_a4fde8db9bc925b8b5c4b974d8935daac}{\index{toxav.\+c@{toxav.\+c}!toxav\+\_\+call@{toxav\+\_\+call}}
\index{toxav\+\_\+call@{toxav\+\_\+call}!toxav.\+c@{toxav.\+c}}
\subsubsection[{toxav\+\_\+call}]{\setlength{\rightskip}{0pt plus 5cm}int toxav\+\_\+call (
\begin{DoxyParamCaption}
\item[{{\bf Tox\+Av} $\ast$}]{av, }
\item[{int32\+\_\+t $\ast$}]{call\+\_\+index, }
\item[{int}]{friend\+\_\+id, }
\item[{const {\bf Tox\+Av\+C\+Settings} $\ast$}]{csettings, }
\item[{int}]{ringing\+\_\+seconds}
\end{DoxyParamCaption}
)}}\label{toxav_8c_a4fde8db9bc925b8b5c4b974d8935daac}
Call user. Use its friend\+\_\+id. 

Definition at line 226 of file toxav.\+c.



References msi\+\_\+invite(), \+\_\+\+Tox\+Av\+::msi\+\_\+session, and msicsettings\+\_\+cast().



Referenced by in\+\_\+thread\+\_\+call(), and S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T().


\begin{DoxyCode}
231 \{
232     \textcolor{keywordflow}{return} \hyperlink{msi_8c_a9f714a4729f22ca5810ff0ee89313fab}{msi\_invite}(av->\hyperlink{struct___tox_av_a85e3d7dd2ab722ee5ba0cd4b72bc7d60}{msi\_session}, call\_index, 
      \hyperlink{toxav_8c_ac5cf7284cc2e32780c71a7f5f80e3f9b}{msicsettings\_cast}(csettings), ringing\_seconds * 1000, user);
233 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/d0e/toxav_8c_a4fde8db9bc925b8b5c4b974d8935daac_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=257pt]{d8/d0e/toxav_8c_a4fde8db9bc925b8b5c4b974d8935daac_icgraph}
\end{center}
\end{figure}


\hypertarget{toxav_8c_ae0d14b853f586b2e07d2d0ef62efc4eb}{\index{toxav.\+c@{toxav.\+c}!toxav\+\_\+cancel@{toxav\+\_\+cancel}}
\index{toxav\+\_\+cancel@{toxav\+\_\+cancel}!toxav.\+c@{toxav.\+c}}
\subsubsection[{toxav\+\_\+cancel}]{\setlength{\rightskip}{0pt plus 5cm}int toxav\+\_\+cancel (
\begin{DoxyParamCaption}
\item[{{\bf Tox\+Av} $\ast$}]{av, }
\item[{int32\+\_\+t}]{call\+\_\+index, }
\item[{int}]{peer\+\_\+id, }
\item[{const char $\ast$}]{reason}
\end{DoxyParamCaption}
)}}\label{toxav_8c_ae0d14b853f586b2e07d2d0ef62efc4eb}
Cancel outgoing request. 

Definition at line 250 of file toxav.\+c.



References msi\+\_\+cancel(), and \+\_\+\+Tox\+Av\+::msi\+\_\+session.



Referenced by S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T().


\begin{DoxyCode}
251 \{
252     \textcolor{keywordflow}{return} \hyperlink{msi_8c_aefbf5f591676d4b56853b21fdf215e69}{msi\_cancel}(av->\hyperlink{struct___tox_av_a85e3d7dd2ab722ee5ba0cd4b72bc7d60}{msi\_session}, call\_index, peer\_id, reason);
253 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/d0e/toxav_8c_ae0d14b853f586b2e07d2d0ef62efc4eb_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=270pt]{d8/d0e/toxav_8c_ae0d14b853f586b2e07d2d0ef62efc4eb_icgraph}
\end{center}
\end{figure}


\hypertarget{toxav_8c_aa0c1199d6c03b979810a27ce82751e7d}{\index{toxav.\+c@{toxav.\+c}!toxav\+\_\+capability\+\_\+supported@{toxav\+\_\+capability\+\_\+supported}}
\index{toxav\+\_\+capability\+\_\+supported@{toxav\+\_\+capability\+\_\+supported}!toxav.\+c@{toxav.\+c}}
\subsubsection[{toxav\+\_\+capability\+\_\+supported}]{\setlength{\rightskip}{0pt plus 5cm}int toxav\+\_\+capability\+\_\+supported (
\begin{DoxyParamCaption}
\item[{{\bf Tox\+Av} $\ast$}]{av, }
\item[{int32\+\_\+t}]{call\+\_\+index, }
\item[{{\bf Tox\+Av\+Capabilities}}]{capability}
\end{DoxyParamCaption}
)}}\label{toxav_8c_aa0c1199d6c03b979810a27ce82751e7d}
Is certain capability supported. Used to determine if encoding/decoding is ready. 

Definition at line 615 of file toxav.\+c.



References \+\_\+\+Tox\+Av\+::calls, \+\_\+\+C\+S\+Session\+::capabilities, and \+\_\+\+Tox\+Av\+Call\+::cs.


\begin{DoxyCode}
616 \{
617     \textcolor{keywordflow}{return} av->\hyperlink{struct___tox_av_abe854f89ac28ebd5112d1639d531b128}{calls}[call\_index].\hyperlink{struct___tox_av_call_ae88a02b5082b346e4c90541186364e99}{cs} ? av->\hyperlink{struct___tox_av_abe854f89ac28ebd5112d1639d531b128}{calls}[call\_index].\hyperlink{struct___tox_av_call_ae88a02b5082b346e4c90541186364e99}{cs}->
      \hyperlink{struct___c_s_session_ac9e675ead9b3559ea462414a0016f6a6}{capabilities} & (\hyperlink{codec_8h_a9ad0f479beeeb19d00d4ce7063bed6de}{CSCapabilities}) capability : 0;
618     \textcolor{comment}{/* 0 is error here */}
619 \}
\end{DoxyCode}
\hypertarget{toxav_8c_a2ad323fd957032a11b1fadd4668f41ee}{\index{toxav.\+c@{toxav.\+c}!toxav\+\_\+change\+\_\+settings@{toxav\+\_\+change\+\_\+settings}}
\index{toxav\+\_\+change\+\_\+settings@{toxav\+\_\+change\+\_\+settings}!toxav.\+c@{toxav.\+c}}
\subsubsection[{toxav\+\_\+change\+\_\+settings}]{\setlength{\rightskip}{0pt plus 5cm}int toxav\+\_\+change\+\_\+settings (
\begin{DoxyParamCaption}
\item[{{\bf Tox\+Av} $\ast$}]{av, }
\item[{int32\+\_\+t}]{call\+\_\+index, }
\item[{const {\bf Tox\+Av\+C\+Settings} $\ast$}]{csettings}
\end{DoxyParamCaption}
)}}\label{toxav_8c_a2ad323fd957032a11b1fadd4668f41ee}
Notify peer that we are changing codec settings. 

Definition at line 255 of file toxav.\+c.



References msi\+\_\+change\+\_\+csettings(), \+\_\+\+Tox\+Av\+::msi\+\_\+session, and msicsettings\+\_\+cast().



Referenced by S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T().


\begin{DoxyCode}
256 \{
257     \textcolor{keywordflow}{return} \hyperlink{msi_8c_ad82b81e88f4a912b7ec492baf6ab7ea8}{msi\_change\_csettings}(av->\hyperlink{struct___tox_av_a85e3d7dd2ab722ee5ba0cd4b72bc7d60}{msi\_session}, call\_index, 
      \hyperlink{toxav_8c_ac5cf7284cc2e32780c71a7f5f80e3f9b}{msicsettings\_cast}(csettings));
258 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/d0e/toxav_8c_a2ad323fd957032a11b1fadd4668f41ee_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=313pt]{d8/d0e/toxav_8c_a2ad323fd957032a11b1fadd4668f41ee_icgraph}
\end{center}
\end{figure}


\hypertarget{toxav_8c_a78b4ac618a3683f06432c06594846121}{\index{toxav.\+c@{toxav.\+c}!toxav\+\_\+do@{toxav\+\_\+do}}
\index{toxav\+\_\+do@{toxav\+\_\+do}!toxav.\+c@{toxav.\+c}}
\subsubsection[{toxav\+\_\+do}]{\setlength{\rightskip}{0pt plus 5cm}void toxav\+\_\+do (
\begin{DoxyParamCaption}
\item[{{\bf Tox\+Av} $\ast$}]{av}
\end{DoxyParamCaption}
)}}\label{toxav_8c_a78b4ac618a3683f06432c06594846121}
Main loop for the session. Best called right after tox\+\_\+do(); 

Definition at line 176 of file toxav.\+c.



References \+\_\+\+Tox\+Av\+Call\+::active, \+\_\+\+Tox\+Av\+::calls, \+\_\+\+Tox\+Av\+Call\+::cs, cs\+\_\+do(), current\+\_\+time\+\_\+monotonic(), end, i, \+\_\+\+Tox\+Av\+::max\+\_\+calls, msi\+\_\+do(), \+\_\+\+Tox\+Av\+::msi\+\_\+session, \+\_\+\+Tox\+Av\+Call\+::mutex, \+\_\+\+Tox\+Av\+Call\+::mutex\+\_\+do, and start.



Referenced by S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T().


\begin{DoxyCode}
177 \{
178     \hyperlink{msi_8c_a6596ff23a6bcdd19c4fa1985dcc6b257}{msi\_do}(av->\hyperlink{struct___tox_av_a85e3d7dd2ab722ee5ba0cd4b72bc7d60}{msi\_session});
179 
180     uint64\_t \hyperlink{msi_8c_ae511d1f1e345bb77cd4120b39679f028a0e97c69c73117f6c0109b2d7d1d9cedc}{start} = \hyperlink{irc__syncbot_8c_ae8ecaef140b786a2720eadbb85918e81}{current\_time\_monotonic}();
181 
182     uint32\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i} = 0;
183 
184     \textcolor{keywordflow}{for} (; i < av->\hyperlink{struct___tox_av_a7d6cf32eb812384ebd4074c588c17499}{max\_calls}; i ++) \{
185         pthread\_mutex\_lock(av->\hyperlink{struct___tox_av_abe854f89ac28ebd5112d1639d531b128}{calls}[i].\hyperlink{struct___tox_av_call_ab4293016252c4d4e63549b0773fa0f33}{mutex});
186 
187         \textcolor{keywordflow}{if} (av->\hyperlink{struct___tox_av_abe854f89ac28ebd5112d1639d531b128}{calls}[i].\hyperlink{struct___tox_av_call_a215df53a125f9b848dc883d9a1164430}{active}) \{
188             pthread\_mutex\_lock(av->\hyperlink{struct___tox_av_abe854f89ac28ebd5112d1639d531b128}{calls}[i].\hyperlink{struct___tox_av_call_acc4203df7776b6dfe0e5c3922a35e5b0}{mutex\_do});
189             pthread\_mutex\_unlock(av->\hyperlink{struct___tox_av_abe854f89ac28ebd5112d1639d531b128}{calls}[i].\hyperlink{struct___tox_av_call_ab4293016252c4d4e63549b0773fa0f33}{mutex});
190             \hyperlink{codec_8c_a478d9b52aca882a11b160e8bbb50dd74}{cs\_do}(av->\hyperlink{struct___tox_av_abe854f89ac28ebd5112d1639d531b128}{calls}[i].\hyperlink{struct___tox_av_call_ae88a02b5082b346e4c90541186364e99}{cs});
191             pthread\_mutex\_unlock(av->\hyperlink{struct___tox_av_abe854f89ac28ebd5112d1639d531b128}{calls}[i].\hyperlink{struct___tox_av_call_acc4203df7776b6dfe0e5c3922a35e5b0}{mutex\_do});
192         \} \textcolor{keywordflow}{else} \{
193             pthread\_mutex\_unlock(av->\hyperlink{struct___tox_av_abe854f89ac28ebd5112d1639d531b128}{calls}[i].\hyperlink{struct___tox_av_call_ab4293016252c4d4e63549b0773fa0f33}{mutex});
194         \}
195     \}
196 
197     uint64\_t \hyperlink{msi_8c_ae511d1f1e345bb77cd4120b39679f028a80b1a820e533d7cf0e1715319339e6d0}{end} = \hyperlink{irc__syncbot_8c_ae8ecaef140b786a2720eadbb85918e81}{current\_time\_monotonic}();
198 
199     \textcolor{comment}{/* TODO maybe use variable for sizes */}
200     av->dectmsstotal += end - \hyperlink{msi_8c_ae511d1f1e345bb77cd4120b39679f028a0e97c69c73117f6c0109b2d7d1d9cedc}{start};
201 
202     \textcolor{keywordflow}{if} (++av->dectmsscount == 3) \{
203         av->avgdectms = av->dectmsstotal / 3 + 2 \textcolor{comment}{/* NOTE Magic Offset */};
204         av->dectmsscount = 0;
205         av->dectmsstotal = 0;
206     \}
207 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/d0e/toxav_8c_a78b4ac618a3683f06432c06594846121_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=252pt]{d8/d0e/toxav_8c_a78b4ac618a3683f06432c06594846121_icgraph}
\end{center}
\end{figure}


\hypertarget{toxav_8c_a552b5f2c515a0162c7f44e66db707be5}{\index{toxav.\+c@{toxav.\+c}!toxav\+\_\+do\+\_\+interval@{toxav\+\_\+do\+\_\+interval}}
\index{toxav\+\_\+do\+\_\+interval@{toxav\+\_\+do\+\_\+interval}!toxav.\+c@{toxav.\+c}}
\subsubsection[{toxav\+\_\+do\+\_\+interval}]{\setlength{\rightskip}{0pt plus 5cm}uint32\+\_\+t toxav\+\_\+do\+\_\+interval (
\begin{DoxyParamCaption}
\item[{{\bf Tox\+Av} $\ast$}]{av}
\end{DoxyParamCaption}
)}}\label{toxav_8c_a552b5f2c515a0162c7f44e66db707be5}
Returns the interval in milliseconds when the next \hyperlink{toxav_8h_a78b4ac618a3683f06432c06594846121}{toxav\+\_\+do()} should be called. If no call is active at the moment returns 200. 

Definition at line 157 of file toxav.\+c.



References \+\_\+\+Tox\+Av\+Call\+::active, \+\_\+\+C\+S\+Session\+::audio\+\_\+decoder\+\_\+frame\+\_\+duration, \+\_\+\+Tox\+Av\+::calls, \+\_\+\+Tox\+Av\+Call\+::cs, i, \+\_\+\+Tox\+Av\+::max\+\_\+calls, M\+I\+N, and \+\_\+\+Tox\+Av\+Call\+::mutex.


\begin{DoxyCode}
158 \{
159     \textcolor{keywordtype}{int} \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i} = 0;
160     uint32\_t rc = 200 + av->avgdectms; \textcolor{comment}{/* Return 200 if no call is active */}
161 
162     \textcolor{keywordflow}{for} (; i < av->\hyperlink{struct___tox_av_a7d6cf32eb812384ebd4074c588c17499}{max\_calls}; i ++) \{
163         pthread\_mutex\_lock(av->\hyperlink{struct___tox_av_abe854f89ac28ebd5112d1639d531b128}{calls}[i].\hyperlink{struct___tox_av_call_ab4293016252c4d4e63549b0773fa0f33}{mutex});
164 
165         \textcolor{keywordflow}{if} (av->\hyperlink{struct___tox_av_abe854f89ac28ebd5112d1639d531b128}{calls}[i].\hyperlink{struct___tox_av_call_a215df53a125f9b848dc883d9a1164430}{active}) \{
166             \textcolor{comment}{/* This should work. Video payload will always come in greater intervals */}
167             rc = \hyperlink{util_8h_a3acffbd305ee72dcd4593c0d8af64a4f}{MIN}(av->\hyperlink{struct___tox_av_abe854f89ac28ebd5112d1639d531b128}{calls}[i].\hyperlink{struct___tox_av_call_ae88a02b5082b346e4c90541186364e99}{cs}->\hyperlink{struct___c_s_session_a245af4e824b82e6e91850ac26ace1230}{audio\_decoder\_frame\_duration}, 
      rc);
168         \}
169 
170         pthread\_mutex\_unlock(av->\hyperlink{struct___tox_av_abe854f89ac28ebd5112d1639d531b128}{calls}[i].\hyperlink{struct___tox_av_call_ab4293016252c4d4e63549b0773fa0f33}{mutex});
171     \}
172 
173     \textcolor{keywordflow}{return} rc < av->avgdectms ? 0 : rc - av->avgdectms;
174 \}
\end{DoxyCode}
\hypertarget{toxav_8c_a45828173fc8cd78ee9c50390a98ce10d}{\index{toxav.\+c@{toxav.\+c}!toxav\+\_\+get\+\_\+active\+\_\+count@{toxav\+\_\+get\+\_\+active\+\_\+count}}
\index{toxav\+\_\+get\+\_\+active\+\_\+count@{toxav\+\_\+get\+\_\+active\+\_\+count}!toxav.\+c@{toxav.\+c}}
\subsubsection[{toxav\+\_\+get\+\_\+active\+\_\+count}]{\setlength{\rightskip}{0pt plus 5cm}int toxav\+\_\+get\+\_\+active\+\_\+count (
\begin{DoxyParamCaption}
\item[{{\bf Tox\+Av} $\ast$}]{av}
\end{DoxyParamCaption}
)}}\label{toxav_8c_a45828173fc8cd78ee9c50390a98ce10d}
Returns number of active calls or -\/1 on error. 

Definition at line 626 of file toxav.\+c.



References \+\_\+\+Tox\+Av\+Call\+::active, \+\_\+\+Tox\+Av\+::calls, i, \+\_\+\+Tox\+Av\+::max\+\_\+calls, and \+\_\+\+Tox\+Av\+Call\+::mutex.


\begin{DoxyCode}
627 \{
628     \textcolor{keywordflow}{if} (!av) \textcolor{keywordflow}{return} -1;
629 
630     \textcolor{keywordtype}{int} rc = 0, \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i} = 0;
631 
632     \textcolor{keywordflow}{for} (; \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i} < av->\hyperlink{struct___tox_av_a7d6cf32eb812384ebd4074c588c17499}{max\_calls}; \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}++) \{
633         pthread\_mutex\_lock(av->\hyperlink{struct___tox_av_abe854f89ac28ebd5112d1639d531b128}{calls}[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}].\hyperlink{struct___tox_av_call_ab4293016252c4d4e63549b0773fa0f33}{mutex});
634 
635         \textcolor{keywordflow}{if} (av->\hyperlink{struct___tox_av_abe854f89ac28ebd5112d1639d531b128}{calls}[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}].\hyperlink{struct___tox_av_call_a215df53a125f9b848dc883d9a1164430}{active}) rc++;
636 
637         pthread\_mutex\_unlock(av->\hyperlink{struct___tox_av_abe854f89ac28ebd5112d1639d531b128}{calls}[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}].\hyperlink{struct___tox_av_call_ab4293016252c4d4e63549b0773fa0f33}{mutex});
638     \}
639 
640     \textcolor{keywordflow}{return} rc;
641 \}
\end{DoxyCode}
\hypertarget{toxav_8c_a6217a5aaff6ccbb8768080466613208b}{\index{toxav.\+c@{toxav.\+c}!toxav\+\_\+get\+\_\+call\+\_\+state@{toxav\+\_\+get\+\_\+call\+\_\+state}}
\index{toxav\+\_\+get\+\_\+call\+\_\+state@{toxav\+\_\+get\+\_\+call\+\_\+state}!toxav.\+c@{toxav.\+c}}
\subsubsection[{toxav\+\_\+get\+\_\+call\+\_\+state}]{\setlength{\rightskip}{0pt plus 5cm}{\bf Tox\+Av\+Call\+State} toxav\+\_\+get\+\_\+call\+\_\+state (
\begin{DoxyParamCaption}
\item[{{\bf Tox\+Av} $\ast$}]{av, }
\item[{int32\+\_\+t}]{call\+\_\+index}
\end{DoxyParamCaption}
)}}\label{toxav_8c_a6217a5aaff6ccbb8768080466613208b}
Get current call state. 

Definition at line 606 of file toxav.\+c.



References av\+\_\+\+Call\+Non\+Existent, C\+A\+L\+L\+\_\+\+I\+N\+V\+A\+L\+I\+D\+\_\+\+I\+N\+D\+E\+X, \+\_\+\+M\+S\+I\+Session\+::calls, \+\_\+\+M\+S\+I\+Session\+::max\+\_\+calls, \+\_\+\+Tox\+Av\+::msi\+\_\+session, and \+\_\+\+M\+S\+I\+Call\+::state.


\begin{DoxyCode}
607 \{
608     \textcolor{keywordflow}{if} ( \hyperlink{toxav_8c_a9b51ecd9e898c75b7ed6cf9cd5596d1b}{CALL\_INVALID\_INDEX}(call\_index, av->\hyperlink{struct___tox_av_a85e3d7dd2ab722ee5ba0cd4b72bc7d60}{msi\_session}->
      \hyperlink{struct___m_s_i_session_ae4bbb4682dc5c74588083ca06ac2f76f}{max\_calls}) || !av->\hyperlink{struct___tox_av_a85e3d7dd2ab722ee5ba0cd4b72bc7d60}{msi\_session}->\hyperlink{struct___m_s_i_session_ac40fee673bae4030b812579c57389a02}{calls}[call\_index] )
609         \textcolor{keywordflow}{return} \hyperlink{toxav_8h_ab2667961717e3fa3f2e13c69d2fec01da26188d2569243c690946efb6140562e7}{av\_CallNonExistent};
610 
611     \textcolor{keywordflow}{return} av->\hyperlink{struct___tox_av_a85e3d7dd2ab722ee5ba0cd4b72bc7d60}{msi\_session}->\hyperlink{struct___m_s_i_session_ac40fee673bae4030b812579c57389a02}{calls}[call\_index]->\hyperlink{struct___m_s_i_call_a4a1fc0e5d23dbdc357786d4c69eda9b9}{state};
612 
613 \}
\end{DoxyCode}
\hypertarget{toxav_8c_aaa65fd5f05a94ed9abf63c42f5e10ed4}{\index{toxav.\+c@{toxav.\+c}!toxav\+\_\+get\+\_\+peer\+\_\+csettings@{toxav\+\_\+get\+\_\+peer\+\_\+csettings}}
\index{toxav\+\_\+get\+\_\+peer\+\_\+csettings@{toxav\+\_\+get\+\_\+peer\+\_\+csettings}!toxav.\+c@{toxav.\+c}}
\subsubsection[{toxav\+\_\+get\+\_\+peer\+\_\+csettings}]{\setlength{\rightskip}{0pt plus 5cm}int toxav\+\_\+get\+\_\+peer\+\_\+csettings (
\begin{DoxyParamCaption}
\item[{{\bf Tox\+Av} $\ast$}]{av, }
\item[{int32\+\_\+t}]{call\+\_\+index, }
\item[{int}]{peer, }
\item[{{\bf Tox\+Av\+C\+Settings} $\ast$}]{dest}
\end{DoxyParamCaption}
)}}\label{toxav_8c_aaa65fd5f05a94ed9abf63c42f5e10ed4}
Get codec settings from the peer. These were exchanged during call initialization or when peer send us new csettings. 

Definition at line 587 of file toxav.\+c.



References av\+\_\+\+Error\+No\+Call, av\+\_\+\+Error\+None, C\+A\+L\+L\+\_\+\+I\+N\+V\+A\+L\+I\+D\+\_\+\+I\+N\+D\+E\+X, \+\_\+\+M\+S\+I\+Session\+::calls, \+\_\+\+M\+S\+I\+Call\+::csettings\+\_\+peer, \+\_\+\+M\+S\+I\+Session\+::max\+\_\+calls, \+\_\+\+Tox\+Av\+::msi\+\_\+session, \+\_\+\+M\+S\+I\+Call\+::peer\+\_\+count, and toxavcsettings\+\_\+cast().



Referenced by callback\+\_\+peer\+\_\+cs\+\_\+change(), and callback\+\_\+self\+\_\+cs\+\_\+change().


\begin{DoxyCode}
588 \{
589     \textcolor{keywordflow}{if} ( peer < 0 || \hyperlink{toxav_8c_a9b51ecd9e898c75b7ed6cf9cd5596d1b}{CALL\_INVALID\_INDEX}(call\_index, av->
      \hyperlink{struct___tox_av_a85e3d7dd2ab722ee5ba0cd4b72bc7d60}{msi\_session}->\hyperlink{struct___m_s_i_session_ae4bbb4682dc5c74588083ca06ac2f76f}{max\_calls}) ||
590             !av->\hyperlink{struct___tox_av_a85e3d7dd2ab722ee5ba0cd4b72bc7d60}{msi\_session}->\hyperlink{struct___m_s_i_session_ac40fee673bae4030b812579c57389a02}{calls}[call\_index] || av->
      \hyperlink{struct___tox_av_a85e3d7dd2ab722ee5ba0cd4b72bc7d60}{msi\_session}->\hyperlink{struct___m_s_i_session_ac40fee673bae4030b812579c57389a02}{calls}[call\_index]->\hyperlink{struct___m_s_i_call_a62e9da1e57f84fd224590c4d466724aa}{peer\_count} <= peer )
591         \textcolor{keywordflow}{return} \hyperlink{toxav_8h_a18cce814b2dde9d75ad400fa3d4c4571a8ea49f41e11f0f288834a29183fc57b5}{av\_ErrorNoCall};
592 
593     *dest = *\hyperlink{toxav_8c_a8eb45d94b5ed002925b58f36c66426b1}{toxavcsettings\_cast}(&av->\hyperlink{struct___tox_av_a85e3d7dd2ab722ee5ba0cd4b72bc7d60}{msi\_session}->
      \hyperlink{struct___m_s_i_session_ac40fee673bae4030b812579c57389a02}{calls}[call\_index]->\hyperlink{struct___m_s_i_call_a3b7fc70c2772bbdc453eeff763fc0b4c}{csettings\_peer}[peer]);
594     \textcolor{keywordflow}{return} \hyperlink{toxav_8h_a18cce814b2dde9d75ad400fa3d4c4571a112b17acf03c570f3bd9d1a1b42bdd40}{av\_ErrorNone};
595 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=348pt]{d8/d0e/toxav_8c_aaa65fd5f05a94ed9abf63c42f5e10ed4_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/d0e/toxav_8c_aaa65fd5f05a94ed9abf63c42f5e10ed4_icgraph}
\end{center}
\end{figure}


\hypertarget{toxav_8c_a7de9b3c23c1d6b46b3ed0f2ea3385a7b}{\index{toxav.\+c@{toxav.\+c}!toxav\+\_\+get\+\_\+peer\+\_\+id@{toxav\+\_\+get\+\_\+peer\+\_\+id}}
\index{toxav\+\_\+get\+\_\+peer\+\_\+id@{toxav\+\_\+get\+\_\+peer\+\_\+id}!toxav.\+c@{toxav.\+c}}
\subsubsection[{toxav\+\_\+get\+\_\+peer\+\_\+id}]{\setlength{\rightskip}{0pt plus 5cm}int toxav\+\_\+get\+\_\+peer\+\_\+id (
\begin{DoxyParamCaption}
\item[{{\bf Tox\+Av} $\ast$}]{av, }
\item[{int32\+\_\+t}]{call\+\_\+index, }
\item[{int}]{peer}
\end{DoxyParamCaption}
)}}\label{toxav_8c_a7de9b3c23c1d6b46b3ed0f2ea3385a7b}
Get friend id of peer participating in conversation. 

Definition at line 597 of file toxav.\+c.



References av\+\_\+\+Error\+No\+Call, C\+A\+L\+L\+\_\+\+I\+N\+V\+A\+L\+I\+D\+\_\+\+I\+N\+D\+E\+X, \+\_\+\+M\+S\+I\+Session\+::calls, \+\_\+\+M\+S\+I\+Session\+::max\+\_\+calls, \+\_\+\+Tox\+Av\+::msi\+\_\+session, \+\_\+\+M\+S\+I\+Call\+::peer\+\_\+count, and \+\_\+\+M\+S\+I\+Call\+::peers.


\begin{DoxyCode}
598 \{
599     \textcolor{keywordflow}{if} ( peer < 0 || \hyperlink{toxav_8c_a9b51ecd9e898c75b7ed6cf9cd5596d1b}{CALL\_INVALID\_INDEX}(call\_index, av->
      \hyperlink{struct___tox_av_a85e3d7dd2ab722ee5ba0cd4b72bc7d60}{msi\_session}->\hyperlink{struct___m_s_i_session_ae4bbb4682dc5c74588083ca06ac2f76f}{max\_calls}) || !av->\hyperlink{struct___tox_av_a85e3d7dd2ab722ee5ba0cd4b72bc7d60}{msi\_session}->
      \hyperlink{struct___m_s_i_session_ac40fee673bae4030b812579c57389a02}{calls}[call\_index]
600             || av->\hyperlink{struct___tox_av_a85e3d7dd2ab722ee5ba0cd4b72bc7d60}{msi\_session}->\hyperlink{struct___m_s_i_session_ac40fee673bae4030b812579c57389a02}{calls}[call\_index]->\hyperlink{struct___m_s_i_call_a62e9da1e57f84fd224590c4d466724aa}{peer\_count} <= peer )
601         \textcolor{keywordflow}{return} \hyperlink{toxav_8h_a18cce814b2dde9d75ad400fa3d4c4571a8ea49f41e11f0f288834a29183fc57b5}{av\_ErrorNoCall};
602 
603     \textcolor{keywordflow}{return} av->\hyperlink{struct___tox_av_a85e3d7dd2ab722ee5ba0cd4b72bc7d60}{msi\_session}->\hyperlink{struct___m_s_i_session_ac40fee673bae4030b812579c57389a02}{calls}[call\_index]->\hyperlink{struct___m_s_i_call_a55d2568491d616f7fef07bc7137c8c23}{peers}[peer];
604 \}
\end{DoxyCode}
\hypertarget{toxav_8c_abef2e18b8445840844cb411fa3cd4a49}{\index{toxav.\+c@{toxav.\+c}!toxav\+\_\+get\+\_\+tox@{toxav\+\_\+get\+\_\+tox}}
\index{toxav\+\_\+get\+\_\+tox@{toxav\+\_\+get\+\_\+tox}!toxav.\+c@{toxav.\+c}}
\subsubsection[{toxav\+\_\+get\+\_\+tox}]{\setlength{\rightskip}{0pt plus 5cm}{\bf Tox}$\ast$ toxav\+\_\+get\+\_\+tox (
\begin{DoxyParamCaption}
\item[{{\bf Tox\+Av} $\ast$}]{av}
\end{DoxyParamCaption}
)}}\label{toxav_8c_abef2e18b8445840844cb411fa3cd4a49}
Returns tox reference. 

Definition at line 621 of file toxav.\+c.



References \+\_\+\+Tox\+Av\+::messenger.


\begin{DoxyCode}
622 \{
623     \textcolor{keywordflow}{return} (\hyperlink{struct_messenger}{Tox} *)av->\hyperlink{struct___tox_av_a48342badc24a04d2310ca16ff4a3711b}{messenger};
624 \}
\end{DoxyCode}
\hypertarget{toxav_8c_ad78d09fb2b5ac7b1bd5c2395a7bdb5c6}{\index{toxav.\+c@{toxav.\+c}!toxav\+\_\+group\+\_\+send\+\_\+audio@{toxav\+\_\+group\+\_\+send\+\_\+audio}}
\index{toxav\+\_\+group\+\_\+send\+\_\+audio@{toxav\+\_\+group\+\_\+send\+\_\+audio}!toxav.\+c@{toxav.\+c}}
\subsubsection[{toxav\+\_\+group\+\_\+send\+\_\+audio}]{\setlength{\rightskip}{0pt plus 5cm}int toxav\+\_\+group\+\_\+send\+\_\+audio (
\begin{DoxyParamCaption}
\item[{{\bf Tox} $\ast$}]{tox, }
\item[{int}]{groupnumber, }
\item[{const int16\+\_\+t $\ast$}]{pcm, }
\item[{unsigned int}]{samples, }
\item[{uint8\+\_\+t}]{channels, }
\item[{unsigned int}]{sample\+\_\+rate}
\end{DoxyParamCaption}
)}}\label{toxav_8c_ad78d09fb2b5ac7b1bd5c2395a7bdb5c6}


Definition at line 691 of file toxav.\+c.



References Messenger\+::group\+\_\+chat\+\_\+object, group\+\_\+send\+\_\+audio(), and m.


\begin{DoxyCode}
693 \{
694     \hyperlink{struct_messenger}{Messenger} *\hyperlink{messenger__test_8c_aea6eb6c7c30a659f1b0dee83eaf03ea2}{m} = tox;
695     \textcolor{keywordflow}{return} \hyperlink{toxav_2group_8c_abed2d235751a4282d79ff38abc3bf228}{group\_send\_audio}(m->\hyperlink{struct_messenger_accf717ba3e14c38e1611b17b78eed25c}{group\_chat\_object}, groupnumber, pcm, 
      samples, channels, sample\_rate);
696 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/d0e/toxav_8c_ad78d09fb2b5ac7b1bd5c2395a7bdb5c6_cgraph}
\end{center}
\end{figure}


\hypertarget{toxav_8c_a225958005e20091600e798e9827a5639}{\index{toxav.\+c@{toxav.\+c}!toxav\+\_\+hangup@{toxav\+\_\+hangup}}
\index{toxav\+\_\+hangup@{toxav\+\_\+hangup}!toxav.\+c@{toxav.\+c}}
\subsubsection[{toxav\+\_\+hangup}]{\setlength{\rightskip}{0pt plus 5cm}int toxav\+\_\+hangup (
\begin{DoxyParamCaption}
\item[{{\bf Tox\+Av} $\ast$}]{av, }
\item[{int32\+\_\+t}]{call\+\_\+index}
\end{DoxyParamCaption}
)}}\label{toxav_8c_a225958005e20091600e798e9827a5639}
Hangup active call. 

Definition at line 235 of file toxav.\+c.



References msi\+\_\+hangup(), and \+\_\+\+Tox\+Av\+::msi\+\_\+session.



Referenced by in\+\_\+thread\+\_\+call(), and S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T().


\begin{DoxyCode}
236 \{
237     \textcolor{keywordflow}{return} \hyperlink{msi_8c_a8023a8417a3e79e382a9ff3d99cdd24a}{msi\_hangup}(av->\hyperlink{struct___tox_av_a85e3d7dd2ab722ee5ba0cd4b72bc7d60}{msi\_session}, call\_index);
238 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/d0e/toxav_8c_a225958005e20091600e798e9827a5639_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=273pt]{d8/d0e/toxav_8c_a225958005e20091600e798e9827a5639_icgraph}
\end{center}
\end{figure}


\hypertarget{toxav_8c_a72a9a86105538f4f702d006185ce0b7e}{\index{toxav.\+c@{toxav.\+c}!toxav\+\_\+join\+\_\+av\+\_\+groupchat@{toxav\+\_\+join\+\_\+av\+\_\+groupchat}}
\index{toxav\+\_\+join\+\_\+av\+\_\+groupchat@{toxav\+\_\+join\+\_\+av\+\_\+groupchat}!toxav.\+c@{toxav.\+c}}
\subsubsection[{toxav\+\_\+join\+\_\+av\+\_\+groupchat}]{\setlength{\rightskip}{0pt plus 5cm}int toxav\+\_\+join\+\_\+av\+\_\+groupchat (
\begin{DoxyParamCaption}
\item[{{\bf Tox} $\ast$}]{tox, }
\item[{int32\+\_\+t}]{friendnumber, }
\item[{const uint8\+\_\+t $\ast$}]{data, }
\item[{uint16\+\_\+t}]{length, }
\item[{void($\ast$)({\bf Messenger} $\ast$, int, int, const int16\+\_\+t $\ast$, unsigned int, uint8\+\_\+t, unsigned int, void $\ast$)}]{audio\+\_\+callback, }
\item[{void $\ast$}]{userdata}
\end{DoxyParamCaption}
)}}\label{toxav_8c_a72a9a86105538f4f702d006185ce0b7e}


Definition at line 670 of file toxav.\+c.



References Messenger\+::group\+\_\+chat\+\_\+object, join\+\_\+av\+\_\+groupchat(), and m.


\begin{DoxyCode}
673 \{
674     \hyperlink{struct_messenger}{Messenger} *\hyperlink{messenger__test_8c_aea6eb6c7c30a659f1b0dee83eaf03ea2}{m} = tox;
675     \textcolor{keywordflow}{return} \hyperlink{toxav_2group_8c_a3bb53f02b23ac60cb1e76d3717a4e2e5}{join\_av\_groupchat}(m->\hyperlink{struct_messenger_accf717ba3e14c38e1611b17b78eed25c}{group\_chat\_object}, friendnumber, 
      \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}, length, audio\_callback, userdata);
676 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/d0e/toxav_8c_a72a9a86105538f4f702d006185ce0b7e_cgraph}
\end{center}
\end{figure}


\hypertarget{toxav_8c_a10c356c3264067f4e8ebdc1cc7c6d545}{\index{toxav.\+c@{toxav.\+c}!toxav\+\_\+kill@{toxav\+\_\+kill}}
\index{toxav\+\_\+kill@{toxav\+\_\+kill}!toxav.\+c@{toxav.\+c}}
\subsubsection[{toxav\+\_\+kill}]{\setlength{\rightskip}{0pt plus 5cm}void toxav\+\_\+kill (
\begin{DoxyParamCaption}
\item[{{\bf Tox\+Av} $\ast$}]{av}
\end{DoxyParamCaption}
)}}\label{toxav_8c_a10c356c3264067f4e8ebdc1cc7c6d545}
Remove A/\+V session. 

Definition at line 133 of file toxav.\+c.



References audio\+\_\+index, \+\_\+\+Tox\+Av\+::calls, \+\_\+\+Tox\+Av\+Call\+::crtps, \+\_\+\+Tox\+Av\+Call\+::cs, cs\+\_\+kill(), i, \+\_\+\+Tox\+Av\+::max\+\_\+calls, \+\_\+\+M\+S\+I\+Session\+::messenger\+\_\+handle, msi\+\_\+kill(), \+\_\+\+Tox\+Av\+::msi\+\_\+session, \+\_\+\+Tox\+Av\+Call\+::mutex, rtp\+\_\+kill(), and video\+\_\+index.


\begin{DoxyCode}
134 \{
135     uint32\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
136 
137     \textcolor{keywordflow}{for} (i = 0; i < av->\hyperlink{struct___tox_av_a7d6cf32eb812384ebd4074c588c17499}{max\_calls}; i ++) \{
138         \textcolor{keywordflow}{if} ( av->\hyperlink{struct___tox_av_abe854f89ac28ebd5112d1639d531b128}{calls}[i].\hyperlink{struct___tox_av_call_a2e84bee4a1898deac1f63f47235378eb}{crtps}[\hyperlink{toxav_8c_adf973963a7840ccbd70ca8f958a8d8fa}{audio\_index}] )
139             \hyperlink{rtp_8c_a8e1f9ce4d45738658914f4ef7c3144bc}{rtp\_kill}(av->\hyperlink{struct___tox_av_abe854f89ac28ebd5112d1639d531b128}{calls}[i].\hyperlink{struct___tox_av_call_a2e84bee4a1898deac1f63f47235378eb}{crtps}[audio\_index], av->
      \hyperlink{struct___tox_av_a85e3d7dd2ab722ee5ba0cd4b72bc7d60}{msi\_session}->\hyperlink{struct___m_s_i_session_a2adfe301d17504006b8321f71f642039}{messenger\_handle});
140 
141 
142         \textcolor{keywordflow}{if} ( av->\hyperlink{struct___tox_av_abe854f89ac28ebd5112d1639d531b128}{calls}[i].\hyperlink{struct___tox_av_call_a2e84bee4a1898deac1f63f47235378eb}{crtps}[\hyperlink{toxav_8c_a8aac960ea1e1579b3d90c1ab4a3dfe79}{video\_index}] )
143             \hyperlink{rtp_8c_a8e1f9ce4d45738658914f4ef7c3144bc}{rtp\_kill}(av->\hyperlink{struct___tox_av_abe854f89ac28ebd5112d1639d531b128}{calls}[i].\hyperlink{struct___tox_av_call_a2e84bee4a1898deac1f63f47235378eb}{crtps}[video\_index], av->
      \hyperlink{struct___tox_av_a85e3d7dd2ab722ee5ba0cd4b72bc7d60}{msi\_session}->\hyperlink{struct___m_s_i_session_a2adfe301d17504006b8321f71f642039}{messenger\_handle});
144 
145         \textcolor{keywordflow}{if} ( av->\hyperlink{struct___tox_av_abe854f89ac28ebd5112d1639d531b128}{calls}[i].\hyperlink{struct___tox_av_call_ae88a02b5082b346e4c90541186364e99}{cs} )
146             \hyperlink{codec_8c_addde6ea51851fcce009bb7d45147a88f}{cs\_kill}(av->\hyperlink{struct___tox_av_abe854f89ac28ebd5112d1639d531b128}{calls}[i].\hyperlink{struct___tox_av_call_ae88a02b5082b346e4c90541186364e99}{cs});
147 
148         pthread\_mutex\_destroy(av->\hyperlink{struct___tox_av_abe854f89ac28ebd5112d1639d531b128}{calls}[i].\hyperlink{struct___tox_av_call_ab4293016252c4d4e63549b0773fa0f33}{mutex});
149     \}
150 
151     \hyperlink{msi_8c_a85e4f629815819ee2abed82041bd9436}{msi\_kill}(av->\hyperlink{struct___tox_av_a85e3d7dd2ab722ee5ba0cd4b72bc7d60}{msi\_session});
152 
153     free(av->\hyperlink{struct___tox_av_abe854f89ac28ebd5112d1639d531b128}{calls});
154     free(av);
155 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/d0e/toxav_8c_a10c356c3264067f4e8ebdc1cc7c6d545_cgraph}
\end{center}
\end{figure}


\hypertarget{toxav_8c_aeef2a0ed5e716e7449d3f1c6053e31af}{\index{toxav.\+c@{toxav.\+c}!toxav\+\_\+kill\+\_\+transmission@{toxav\+\_\+kill\+\_\+transmission}}
\index{toxav\+\_\+kill\+\_\+transmission@{toxav\+\_\+kill\+\_\+transmission}!toxav.\+c@{toxav.\+c}}
\subsubsection[{toxav\+\_\+kill\+\_\+transmission}]{\setlength{\rightskip}{0pt plus 5cm}int toxav\+\_\+kill\+\_\+transmission (
\begin{DoxyParamCaption}
\item[{{\bf Tox\+Av} $\ast$}]{av, }
\item[{int32\+\_\+t}]{call\+\_\+index}
\end{DoxyParamCaption}
)}}\label{toxav_8c_aeef2a0ed5e716e7449d3f1c6053e31af}
Clears transmission data. Call this at the end of the transmission. 

Definition at line 370 of file toxav.\+c.



References \+\_\+\+Tox\+Av\+Call\+::active, audio\+\_\+index, av\+\_\+\+Error\+Invalid\+State, av\+\_\+\+Error\+No\+Call, av\+\_\+\+Error\+None, C\+A\+L\+L\+\_\+\+I\+N\+V\+A\+L\+I\+D\+\_\+\+I\+N\+D\+E\+X, \+\_\+\+Tox\+Av\+::calls, \+\_\+\+Tox\+Av\+Call\+::crtps, \+\_\+\+Tox\+Av\+Call\+::cs, cs\+\_\+kill(), L\+O\+G\+G\+E\+R\+\_\+\+W\+A\+R\+N\+I\+N\+G, \+\_\+\+M\+S\+I\+Session\+::max\+\_\+calls, \+\_\+\+Tox\+Av\+::messenger, \+\_\+\+Tox\+Av\+::msi\+\_\+session, \+\_\+\+Tox\+Av\+Call\+::mutex, \+\_\+\+Tox\+Av\+Call\+::mutex\+\_\+do, \+\_\+\+Tox\+Av\+Call\+::mutex\+\_\+encoding\+\_\+audio, \+\_\+\+Tox\+Av\+Call\+::mutex\+\_\+encoding\+\_\+video, rtp\+\_\+kill(), and video\+\_\+index.



Referenced by in\+\_\+thread\+\_\+call(), and S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T().


\begin{DoxyCode}
371 \{
372     \textcolor{keywordflow}{if} (\hyperlink{toxav_8c_a9b51ecd9e898c75b7ed6cf9cd5596d1b}{CALL\_INVALID\_INDEX}(call\_index, av->\hyperlink{struct___tox_av_a85e3d7dd2ab722ee5ba0cd4b72bc7d60}{msi\_session}->
      \hyperlink{struct___m_s_i_session_ae4bbb4682dc5c74588083ca06ac2f76f}{max\_calls})) \{
373         \hyperlink{logger_8h_ab3e970f3c1ecb5b71f17eccee4ebb286}{LOGGER\_WARNING}(\textcolor{stringliteral}{"Invalid call index: %d"}, call\_index);
374         \textcolor{keywordflow}{return} \hyperlink{toxav_8h_a18cce814b2dde9d75ad400fa3d4c4571a8ea49f41e11f0f288834a29183fc57b5}{av\_ErrorNoCall};
375     \}
376 
377     \hyperlink{struct___tox_av_call}{ToxAvCall} *call = &av->\hyperlink{struct___tox_av_abe854f89ac28ebd5112d1639d531b128}{calls}[call\_index];
378 
379     pthread\_mutex\_lock(call->\hyperlink{struct___tox_av_call_ab4293016252c4d4e63549b0773fa0f33}{mutex});
380 
381     \textcolor{keywordflow}{if} (!call->\hyperlink{struct___tox_av_call_a215df53a125f9b848dc883d9a1164430}{active}) \{
382         pthread\_mutex\_unlock(call->\hyperlink{struct___tox_av_call_ab4293016252c4d4e63549b0773fa0f33}{mutex});
383         \hyperlink{logger_8h_ab3e970f3c1ecb5b71f17eccee4ebb286}{LOGGER\_WARNING}(\textcolor{stringliteral}{"Action on inactive call: %d"}, call\_index);
384         \textcolor{keywordflow}{return} \hyperlink{toxav_8h_a18cce814b2dde9d75ad400fa3d4c4571a8c3a91ff5639f545fbc49378cf7d94ad}{av\_ErrorInvalidState};
385     \}
386 
387     call->\hyperlink{struct___tox_av_call_a215df53a125f9b848dc883d9a1164430}{active} = 0;
388 
389     pthread\_mutex\_lock(call->\hyperlink{struct___tox_av_call_ac4c859b6e4ff8e175151fbd0a763e414}{mutex\_encoding\_audio});
390     pthread\_mutex\_unlock(call->\hyperlink{struct___tox_av_call_ac4c859b6e4ff8e175151fbd0a763e414}{mutex\_encoding\_audio});
391     pthread\_mutex\_lock(call->\hyperlink{struct___tox_av_call_a89e9fe0c3fef08c502e53ad423dccc34}{mutex\_encoding\_video});
392     pthread\_mutex\_unlock(call->\hyperlink{struct___tox_av_call_a89e9fe0c3fef08c502e53ad423dccc34}{mutex\_encoding\_video});
393     pthread\_mutex\_lock(call->\hyperlink{struct___tox_av_call_acc4203df7776b6dfe0e5c3922a35e5b0}{mutex\_do});
394     pthread\_mutex\_unlock(call->\hyperlink{struct___tox_av_call_acc4203df7776b6dfe0e5c3922a35e5b0}{mutex\_do});
395 
396     \hyperlink{rtp_8c_a8e1f9ce4d45738658914f4ef7c3144bc}{rtp\_kill}(call->\hyperlink{struct___tox_av_call_a2e84bee4a1898deac1f63f47235378eb}{crtps}[\hyperlink{toxav_8c_adf973963a7840ccbd70ca8f958a8d8fa}{audio\_index}], av->\hyperlink{struct___tox_av_a48342badc24a04d2310ca16ff4a3711b}{messenger});
397     call->\hyperlink{struct___tox_av_call_a2e84bee4a1898deac1f63f47235378eb}{crtps}[\hyperlink{toxav_8c_adf973963a7840ccbd70ca8f958a8d8fa}{audio\_index}] = NULL;
398     \hyperlink{rtp_8c_a8e1f9ce4d45738658914f4ef7c3144bc}{rtp\_kill}(call->\hyperlink{struct___tox_av_call_a2e84bee4a1898deac1f63f47235378eb}{crtps}[\hyperlink{toxav_8c_a8aac960ea1e1579b3d90c1ab4a3dfe79}{video\_index}], av->\hyperlink{struct___tox_av_a48342badc24a04d2310ca16ff4a3711b}{messenger});
399     call->\hyperlink{struct___tox_av_call_a2e84bee4a1898deac1f63f47235378eb}{crtps}[\hyperlink{toxav_8c_a8aac960ea1e1579b3d90c1ab4a3dfe79}{video\_index}] = NULL;
400     \hyperlink{codec_8c_addde6ea51851fcce009bb7d45147a88f}{cs\_kill}(call->\hyperlink{struct___tox_av_call_ae88a02b5082b346e4c90541186364e99}{cs});
401     call->\hyperlink{struct___tox_av_call_ae88a02b5082b346e4c90541186364e99}{cs} = NULL;
402 
403     pthread\_mutex\_destroy(call->\hyperlink{struct___tox_av_call_ac4c859b6e4ff8e175151fbd0a763e414}{mutex\_encoding\_audio});
404     pthread\_mutex\_destroy(call->\hyperlink{struct___tox_av_call_a89e9fe0c3fef08c502e53ad423dccc34}{mutex\_encoding\_video});
405     pthread\_mutex\_destroy(call->\hyperlink{struct___tox_av_call_acc4203df7776b6dfe0e5c3922a35e5b0}{mutex\_do});
406 
407     pthread\_mutex\_unlock(call->\hyperlink{struct___tox_av_call_ab4293016252c4d4e63549b0773fa0f33}{mutex});
408 
409     \textcolor{keywordflow}{return} \hyperlink{toxav_8h_a18cce814b2dde9d75ad400fa3d4c4571a112b17acf03c570f3bd9d1a1b42bdd40}{av\_ErrorNone};
410 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/d0e/toxav_8c_aeef2a0ed5e716e7449d3f1c6053e31af_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=315pt]{d8/d0e/toxav_8c_aeef2a0ed5e716e7449d3f1c6053e31af_icgraph}
\end{center}
\end{figure}


\hypertarget{toxav_8c_ab5565a6110643c428b28b2c79fb47b08}{\index{toxav.\+c@{toxav.\+c}!toxav\+\_\+new@{toxav\+\_\+new}}
\index{toxav\+\_\+new@{toxav\+\_\+new}!toxav.\+c@{toxav.\+c}}
\subsubsection[{toxav\+\_\+new}]{\setlength{\rightskip}{0pt plus 5cm}{\bf Tox\+Av}$\ast$ toxav\+\_\+new (
\begin{DoxyParamCaption}
\item[{{\bf Tox} $\ast$}]{messenger, }
\item[{int32\+\_\+t}]{max\+\_\+calls}
\end{DoxyParamCaption}
)}}\label{toxav_8c_ab5565a6110643c428b28b2c79fb47b08}
Start new A/\+V session. There can only be one session at the time. 

Definition at line 102 of file toxav.\+c.



References \+\_\+\+M\+S\+I\+Session\+::agent\+\_\+handler, \+\_\+\+Tox\+Av\+::calls, create\+\_\+recursive\+\_\+mutex(), i, L\+O\+G\+G\+E\+R\+\_\+\+W\+A\+R\+N\+I\+N\+G, \+\_\+\+Tox\+Av\+::max\+\_\+calls, \+\_\+\+Tox\+Av\+::messenger, msi\+\_\+kill(), msi\+\_\+new(), \+\_\+\+Tox\+Av\+::msi\+\_\+session, and \+\_\+\+Tox\+Av\+Call\+::mutex.



Referenced by S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T().


\begin{DoxyCode}
103 \{
104     \hyperlink{struct___tox_av}{ToxAv} *av = calloc ( \textcolor{keyword}{sizeof}(\hyperlink{struct___tox_av}{ToxAv}), 1);
105 
106     \textcolor{keywordflow}{if} (av == NULL) \{
107         \hyperlink{logger_8h_ab3e970f3c1ecb5b71f17eccee4ebb286}{LOGGER\_WARNING}(\textcolor{stringliteral}{"Allocation failed!"});
108         \textcolor{keywordflow}{return} NULL;
109     \}
110 
111     av->\hyperlink{struct___tox_av_a48342badc24a04d2310ca16ff4a3711b}{messenger} = (\hyperlink{struct_messenger}{Messenger} *)messenger;
112     av->\hyperlink{struct___tox_av_a85e3d7dd2ab722ee5ba0cd4b72bc7d60}{msi\_session} = \hyperlink{msi_8c_af33f2706f6d0f8e547716e2f6c5f68d3}{msi\_new}(av->\hyperlink{struct___tox_av_a48342badc24a04d2310ca16ff4a3711b}{messenger}, max\_calls);
113     av->\hyperlink{struct___tox_av_a85e3d7dd2ab722ee5ba0cd4b72bc7d60}{msi\_session}->\hyperlink{struct___m_s_i_session_ae284478ea42e8d4ed283876c3ae18c8a}{agent\_handler} = av;
114     av->\hyperlink{struct___tox_av_abe854f89ac28ebd5112d1639d531b128}{calls} = calloc(\textcolor{keyword}{sizeof}(\hyperlink{struct___tox_av_call}{ToxAvCall}), max\_calls);
115     av->\hyperlink{struct___tox_av_a7d6cf32eb812384ebd4074c588c17499}{max\_calls} = max\_calls;
116 
117     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
118 
119     \textcolor{keywordflow}{for} (i = 0; i < max\_calls; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
120         \textcolor{keywordflow}{if} (\hyperlink{util_8c_a2f0ae269c015342e2d29a251237ccce2}{create\_recursive\_mutex}(av->\hyperlink{struct___tox_av_abe854f89ac28ebd5112d1639d531b128}{calls}[i].\hyperlink{struct___tox_av_call_ab4293016252c4d4e63549b0773fa0f33}{mutex}) != 0 ) \{
121             \hyperlink{logger_8h_ab3e970f3c1ecb5b71f17eccee4ebb286}{LOGGER\_WARNING}(\textcolor{stringliteral}{"Failed to init call(%u) mutex!"}, i);
122             \hyperlink{msi_8c_a85e4f629815819ee2abed82041bd9436}{msi\_kill}(av->\hyperlink{struct___tox_av_a85e3d7dd2ab722ee5ba0cd4b72bc7d60}{msi\_session});
123 
124             free(av->\hyperlink{struct___tox_av_abe854f89ac28ebd5112d1639d531b128}{calls});
125             free(av);
126             \textcolor{keywordflow}{return} NULL;
127         \}
128     \}
129 
130     \textcolor{keywordflow}{return} av;
131 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/d0e/toxav_8c_ab5565a6110643c428b28b2c79fb47b08_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=260pt]{d8/d0e/toxav_8c_ab5565a6110643c428b28b2c79fb47b08_icgraph}
\end{center}
\end{figure}


\hypertarget{toxav_8c_a64caf285a2ad7cadf24263e0f8f7a507}{\index{toxav.\+c@{toxav.\+c}!toxav\+\_\+prepare\+\_\+audio\+\_\+frame@{toxav\+\_\+prepare\+\_\+audio\+\_\+frame}}
\index{toxav\+\_\+prepare\+\_\+audio\+\_\+frame@{toxav\+\_\+prepare\+\_\+audio\+\_\+frame}!toxav.\+c@{toxav.\+c}}
\subsubsection[{toxav\+\_\+prepare\+\_\+audio\+\_\+frame}]{\setlength{\rightskip}{0pt plus 5cm}int toxav\+\_\+prepare\+\_\+audio\+\_\+frame (
\begin{DoxyParamCaption}
\item[{{\bf Tox\+Av} $\ast$}]{av, }
\item[{int32\+\_\+t}]{call\+\_\+index, }
\item[{uint8\+\_\+t $\ast$}]{dest, }
\item[{int}]{dest\+\_\+max, }
\item[{const int16\+\_\+t $\ast$}]{frame, }
\item[{int}]{frame\+\_\+size}
\end{DoxyParamCaption}
)}}\label{toxav_8c_a64caf285a2ad7cadf24263e0f8f7a507}
Encode audio frame. 

Definition at line 531 of file toxav.\+c.



References \+\_\+\+Tox\+Av\+Call\+::active, \+\_\+\+C\+S\+Session\+::audio\+\_\+encoder, av\+\_\+\+Error\+Encoding\+Audio, av\+\_\+\+Error\+Invalid\+State, av\+\_\+\+Error\+No\+Call, C\+A\+L\+L\+\_\+\+I\+N\+V\+A\+L\+I\+D\+\_\+\+I\+N\+D\+E\+X, \+\_\+\+Tox\+Av\+::calls, \+\_\+\+Tox\+Av\+Call\+::cs, L\+O\+G\+G\+E\+R\+\_\+\+E\+R\+R\+O\+R, L\+O\+G\+G\+E\+R\+\_\+\+W\+A\+R\+N\+I\+N\+G, \+\_\+\+M\+S\+I\+Session\+::max\+\_\+calls, \+\_\+\+Tox\+Av\+::msi\+\_\+session, \+\_\+\+Tox\+Av\+Call\+::mutex, and \+\_\+\+Tox\+Av\+Call\+::mutex\+\_\+encoding\+\_\+audio.



Referenced by in\+\_\+thread\+\_\+call(), and S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T().


\begin{DoxyCode}
537 \{
538     \textcolor{keywordflow}{if} (\hyperlink{toxav_8c_a9b51ecd9e898c75b7ed6cf9cd5596d1b}{CALL\_INVALID\_INDEX}(call\_index, av->\hyperlink{struct___tox_av_a85e3d7dd2ab722ee5ba0cd4b72bc7d60}{msi\_session}->
      \hyperlink{struct___m_s_i_session_ae4bbb4682dc5c74588083ca06ac2f76f}{max\_calls})) \{
539         \hyperlink{logger_8h_ab3e970f3c1ecb5b71f17eccee4ebb286}{LOGGER\_WARNING}(\textcolor{stringliteral}{"Action on nonexisting call: %d"}, call\_index);
540         \textcolor{keywordflow}{return} \hyperlink{toxav_8h_a18cce814b2dde9d75ad400fa3d4c4571a8ea49f41e11f0f288834a29183fc57b5}{av\_ErrorNoCall};
541     \}
542 
543     \hyperlink{struct___tox_av_call}{ToxAvCall} *call = &av->\hyperlink{struct___tox_av_abe854f89ac28ebd5112d1639d531b128}{calls}[call\_index];
544     pthread\_mutex\_lock(call->\hyperlink{struct___tox_av_call_ab4293016252c4d4e63549b0773fa0f33}{mutex});
545 
546     \textcolor{keywordflow}{if} (!call->\hyperlink{struct___tox_av_call_a215df53a125f9b848dc883d9a1164430}{active}) \{
547         pthread\_mutex\_unlock(call->\hyperlink{struct___tox_av_call_ab4293016252c4d4e63549b0773fa0f33}{mutex});
548         \hyperlink{logger_8h_ab3e970f3c1ecb5b71f17eccee4ebb286}{LOGGER\_WARNING}(\textcolor{stringliteral}{"Action on inactive call: %d"}, call\_index);
549         \textcolor{keywordflow}{return} \hyperlink{toxav_8h_a18cce814b2dde9d75ad400fa3d4c4571a8c3a91ff5639f545fbc49378cf7d94ad}{av\_ErrorInvalidState};
550     \}
551 
552     pthread\_mutex\_lock(call->\hyperlink{struct___tox_av_call_ac4c859b6e4ff8e175151fbd0a763e414}{mutex\_encoding\_audio});
553     pthread\_mutex\_unlock(call->\hyperlink{struct___tox_av_call_ab4293016252c4d4e63549b0773fa0f33}{mutex});
554     int32\_t rc = opus\_encode(call->\hyperlink{struct___tox_av_call_ae88a02b5082b346e4c90541186364e99}{cs}->\hyperlink{struct___c_s_session_a8c1fa3d73f3426ba5cac83857c390ebc}{audio\_encoder}, frame, frame\_size, dest, dest\_max);
555     pthread\_mutex\_unlock(call->\hyperlink{struct___tox_av_call_ac4c859b6e4ff8e175151fbd0a763e414}{mutex\_encoding\_audio});
556 
557     \textcolor{keywordflow}{if} (rc < 0) \{
558         \hyperlink{logger_8h_aedad6a1e3ffe0d4cd0992b822ec0eeeb}{LOGGER\_ERROR}(\textcolor{stringliteral}{"Failed to encode payload: %s\(\backslash\)n"}, opus\_strerror(rc));
559         \textcolor{keywordflow}{return} \hyperlink{toxav_8h_a18cce814b2dde9d75ad400fa3d4c4571a9f291c07429420c79a3478cab526b84b}{av\_ErrorEncodingAudio};
560     \}
561 
562     \textcolor{keywordflow}{return} rc;
563 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=303pt]{d8/d0e/toxav_8c_a64caf285a2ad7cadf24263e0f8f7a507_icgraph}
\end{center}
\end{figure}


\hypertarget{toxav_8c_a9f2a69dda0bfe14d2a2bcf2497967f31}{\index{toxav.\+c@{toxav.\+c}!toxav\+\_\+prepare\+\_\+transmission@{toxav\+\_\+prepare\+\_\+transmission}}
\index{toxav\+\_\+prepare\+\_\+transmission@{toxav\+\_\+prepare\+\_\+transmission}!toxav.\+c@{toxav.\+c}}
\subsubsection[{toxav\+\_\+prepare\+\_\+transmission}]{\setlength{\rightskip}{0pt plus 5cm}int toxav\+\_\+prepare\+\_\+transmission (
\begin{DoxyParamCaption}
\item[{{\bf Tox\+Av} $\ast$}]{av, }
\item[{int32\+\_\+t}]{call\+\_\+index, }
\item[{int}]{support\+\_\+video}
\end{DoxyParamCaption}
)}}\label{toxav_8c_a9f2a69dda0bfe14d2a2bcf2497967f31}
Allocates transmission data. Must be call before calling toxav\+\_\+prepare\+\_\+$\ast$ and toxav\+\_\+send\+\_\+$\ast$. Also, it must be called when call is started 

Definition at line 265 of file toxav.\+c.



References \+\_\+\+Tox\+Av\+Call\+::active, \+\_\+\+C\+S\+Session\+::agent, \+\_\+\+Tox\+Av\+C\+Settings\+::audio\+\_\+bitrate, \+\_\+\+Tox\+Av\+C\+Settings\+::audio\+\_\+channels, \+\_\+\+Tox\+Av\+C\+Settings\+::audio\+\_\+frame\+\_\+duration, audio\+\_\+index, \+\_\+\+Tox\+Av\+C\+Settings\+::audio\+\_\+sample\+\_\+rate, av\+\_\+\+Error\+Already\+In\+Call\+With\+Peer, av\+\_\+\+Error\+Creating\+Rtp\+Sessions, av\+\_\+\+Error\+Initializing\+Codecs, av\+\_\+\+Error\+No\+Call, av\+\_\+\+Error\+None, av\+\_\+\+Error\+Unknown, \+\_\+\+C\+S\+Session\+::call\+\_\+idx, C\+A\+L\+L\+\_\+\+I\+N\+V\+A\+L\+I\+D\+\_\+\+I\+N\+D\+E\+X, \+\_\+\+Tox\+Av\+C\+Settings\+::call\+\_\+type, \+\_\+\+Tox\+Av\+::calls, \+\_\+\+M\+S\+I\+Session\+::calls, \+\_\+\+Tox\+Av\+Call\+::crtps, \+\_\+\+Tox\+Av\+Call\+::cs, \+\_\+\+R\+T\+P\+Session\+::cs, cs\+\_\+kill(), cs\+\_\+new(), \+\_\+\+M\+S\+I\+Call\+::csettings\+\_\+local, \+\_\+\+M\+S\+I\+Call\+::csettings\+\_\+peer, error, jbuf\+\_\+capacity, L\+O\+G\+G\+E\+R\+\_\+\+D\+E\+B\+U\+G, L\+O\+G\+G\+E\+R\+\_\+\+E\+R\+R\+O\+R, \+\_\+\+M\+S\+I\+Session\+::max\+\_\+calls, \+\_\+\+Tox\+Av\+C\+Settings\+::max\+\_\+video\+\_\+height, \+\_\+\+Tox\+Av\+C\+Settings\+::max\+\_\+video\+\_\+width, \+\_\+\+Tox\+Av\+::messenger, \+\_\+\+Tox\+Av\+::msi\+\_\+session, msi\+\_\+\+Type\+Audio, msi\+\_\+\+Type\+Video, \+\_\+\+Tox\+Av\+Call\+::mutex, \+\_\+\+Tox\+Av\+Call\+::mutex\+\_\+do, \+\_\+\+Tox\+Av\+Call\+::mutex\+\_\+encoding\+\_\+audio, \+\_\+\+Tox\+Av\+Call\+::mutex\+\_\+encoding\+\_\+video, \+\_\+\+M\+S\+I\+Call\+::peers, rtp\+\_\+kill(), rtp\+\_\+new(), toxavcsettings\+\_\+cast(), \+\_\+\+Tox\+Av\+C\+Settings\+::video\+\_\+bitrate, and video\+\_\+index.



Referenced by callback\+\_\+call\+\_\+started(), and in\+\_\+thread\+\_\+call().


\begin{DoxyCode}
266 \{
267     \textcolor{keywordflow}{if} ( !av->\hyperlink{struct___tox_av_a85e3d7dd2ab722ee5ba0cd4b72bc7d60}{msi\_session} || \hyperlink{toxav_8c_a9b51ecd9e898c75b7ed6cf9cd5596d1b}{CALL\_INVALID\_INDEX}(call\_index, av->
      \hyperlink{struct___tox_av_a85e3d7dd2ab722ee5ba0cd4b72bc7d60}{msi\_session}->\hyperlink{struct___m_s_i_session_ae4bbb4682dc5c74588083ca06ac2f76f}{max\_calls}) ||
268             !av->\hyperlink{struct___tox_av_a85e3d7dd2ab722ee5ba0cd4b72bc7d60}{msi\_session}->\hyperlink{struct___m_s_i_session_ac40fee673bae4030b812579c57389a02}{calls}[call\_index] || !av->
      \hyperlink{struct___tox_av_a85e3d7dd2ab722ee5ba0cd4b72bc7d60}{msi\_session}->\hyperlink{struct___m_s_i_session_ac40fee673bae4030b812579c57389a02}{calls}[call\_index]->\hyperlink{struct___m_s_i_call_a3b7fc70c2772bbdc453eeff763fc0b4c}{csettings\_peer}) \{
269         \hyperlink{logger_8h_aedad6a1e3ffe0d4cd0992b822ec0eeeb}{LOGGER\_ERROR}(\textcolor{stringliteral}{"Error while starting RTP session: invalid call!\(\backslash\)n"});
270         \textcolor{keywordflow}{return} \hyperlink{toxav_8h_a18cce814b2dde9d75ad400fa3d4c4571a8ea49f41e11f0f288834a29183fc57b5}{av\_ErrorNoCall};
271     \}
272 
273     \hyperlink{struct___tox_av_call}{ToxAvCall} *call = &av->\hyperlink{struct___tox_av_abe854f89ac28ebd5112d1639d531b128}{calls}[call\_index];
274 
275     pthread\_mutex\_lock(call->\hyperlink{struct___tox_av_call_ab4293016252c4d4e63549b0773fa0f33}{mutex});
276 
277     \textcolor{keywordflow}{if} (call->\hyperlink{struct___tox_av_call_a215df53a125f9b848dc883d9a1164430}{active}) \{
278         pthread\_mutex\_unlock(call->\hyperlink{struct___tox_av_call_ab4293016252c4d4e63549b0773fa0f33}{mutex});
279         \hyperlink{logger_8h_aedad6a1e3ffe0d4cd0992b822ec0eeeb}{LOGGER\_ERROR}(\textcolor{stringliteral}{"Error while starting RTP session: call already active!\(\backslash\)n"});
280         \textcolor{keywordflow}{return} \hyperlink{toxav_8h_a18cce814b2dde9d75ad400fa3d4c4571a718bde38a53749d62708a1099524f7d1}{av\_ErrorAlreadyInCallWithPeer};
281     \}
282 
283     \textcolor{keywordflow}{if} (pthread\_mutex\_init(call->\hyperlink{struct___tox_av_call_ac4c859b6e4ff8e175151fbd0a763e414}{mutex\_encoding\_audio}, NULL) != 0
284             || pthread\_mutex\_init(call->\hyperlink{struct___tox_av_call_a89e9fe0c3fef08c502e53ad423dccc34}{mutex\_encoding\_video}, NULL) != 0 || 
      pthread\_mutex\_init(call->\hyperlink{struct___tox_av_call_acc4203df7776b6dfe0e5c3922a35e5b0}{mutex\_do}, NULL) != 0) \{
285         pthread\_mutex\_unlock(call->\hyperlink{struct___tox_av_call_ab4293016252c4d4e63549b0773fa0f33}{mutex});
286         \hyperlink{logger_8h_aedad6a1e3ffe0d4cd0992b822ec0eeeb}{LOGGER\_ERROR}(\textcolor{stringliteral}{"Error while starting RTP session: mutex initializing failed!\(\backslash\)n"});
287         \textcolor{keywordflow}{return} \hyperlink{toxav_8h_a18cce814b2dde9d75ad400fa3d4c4571a46a905a3549bb3ed243cb57a193a99d4}{av\_ErrorUnknown};
288     \}
289 
290     \textcolor{keyword}{const} \hyperlink{struct___tox_av_c_settings}{ToxAvCSettings} *c\_peer = \hyperlink{toxav_8c_a8eb45d94b5ed002925b58f36c66426b1}{toxavcsettings\_cast}
291                                    (&av->\hyperlink{struct___tox_av_a85e3d7dd2ab722ee5ba0cd4b72bc7d60}{msi\_session}->\hyperlink{struct___m_s_i_session_ac40fee673bae4030b812579c57389a02}{calls}[call\_index]->
      \hyperlink{struct___m_s_i_call_a3b7fc70c2772bbdc453eeff763fc0b4c}{csettings\_peer}[0]);
292     \textcolor{keyword}{const} \hyperlink{struct___tox_av_c_settings}{ToxAvCSettings} *c\_self = \hyperlink{toxav_8c_a8eb45d94b5ed002925b58f36c66426b1}{toxavcsettings\_cast}
293                                    (&av->\hyperlink{struct___tox_av_a85e3d7dd2ab722ee5ba0cd4b72bc7d60}{msi\_session}->\hyperlink{struct___m_s_i_session_ac40fee673bae4030b812579c57389a02}{calls}[call\_index]->
      \hyperlink{struct___m_s_i_call_ae57cfc81fffd82f53953c6546bb9f3c3}{csettings\_local});
294 
295     \hyperlink{logger_8h_a9885ca09ce5f94d936c91a5b0856a024}{LOGGER\_DEBUG}(
296         \textcolor{stringliteral}{"Type: %u(s) %u(p)\(\backslash\)n"}
297         \textcolor{stringliteral}{"Video bitrate: %u(s) %u(p)\(\backslash\)n"}
298         \textcolor{stringliteral}{"Video height: %u(s) %u(p)\(\backslash\)n"}
299         \textcolor{stringliteral}{"Video width: %u(s) %u(p)\(\backslash\)n"}
300         \textcolor{stringliteral}{"Audio bitrate: %u(s) %u(p)\(\backslash\)n"}
301         \textcolor{stringliteral}{"Audio framedur: %u(s) %u(p)\(\backslash\)n"}
302         \textcolor{stringliteral}{"Audio sample rate: %u(s) %u(p)\(\backslash\)n"}
303         \textcolor{stringliteral}{"Audio channels: %u(s) %u(p)\(\backslash\)n"},
304         c\_self->\hyperlink{struct___tox_av_c_settings_af8142c751283bdc9d14609ab3009b920}{call\_type},              c\_peer->\hyperlink{struct___tox_av_c_settings_af8142c751283bdc9d14609ab3009b920}{call\_type},
305         c\_self->\hyperlink{struct___tox_av_c_settings_af0eac99d4181795e8a595d244e745192}{video\_bitrate},          c\_peer->\hyperlink{struct___tox_av_c_settings_af0eac99d4181795e8a595d244e745192}{video\_bitrate},
306         c\_self->\hyperlink{struct___tox_av_c_settings_a4fef4b2fa1a8ae8446314ad0af4ce698}{max\_video\_height},       c\_peer->\hyperlink{struct___tox_av_c_settings_a4fef4b2fa1a8ae8446314ad0af4ce698}{max\_video\_height},
307         c\_self->\hyperlink{struct___tox_av_c_settings_ab81ecded1f7c46e120c8f2afa7b2c5cc}{max\_video\_width},        c\_peer->\hyperlink{struct___tox_av_c_settings_ab81ecded1f7c46e120c8f2afa7b2c5cc}{max\_video\_width},
308         c\_self->\hyperlink{struct___tox_av_c_settings_a5d9a8b59b2eb1eef8dbdcb032bf1dd01}{audio\_bitrate},          c\_peer->\hyperlink{struct___tox_av_c_settings_a5d9a8b59b2eb1eef8dbdcb032bf1dd01}{audio\_bitrate},
309         c\_self->\hyperlink{struct___tox_av_c_settings_a61b592233f5a65705eb2600d38e365cd}{audio\_frame\_duration},   c\_peer->
      \hyperlink{struct___tox_av_c_settings_a61b592233f5a65705eb2600d38e365cd}{audio\_frame\_duration},
310         c\_self->\hyperlink{struct___tox_av_c_settings_a66da4482e934a2700e07a39fa0838559}{audio\_sample\_rate},      c\_peer->
      \hyperlink{struct___tox_av_c_settings_a66da4482e934a2700e07a39fa0838559}{audio\_sample\_rate},
311         c\_self->\hyperlink{struct___tox_av_c_settings_a1b04e9669a2929f425e867440b6d826d}{audio\_channels},         c\_peer->\hyperlink{struct___tox_av_c_settings_a1b04e9669a2929f425e867440b6d826d}{audio\_channels} );
312 
313     \textcolor{keywordflow}{if} ( !(call->\hyperlink{struct___tox_av_call_ae88a02b5082b346e4c90541186364e99}{cs} = \hyperlink{codec_8c_aa99953343ed26c4b7914cac072ff95c1}{cs\_new}(c\_self, c\_peer, \hyperlink{toxav_8c_a6a7e054aaa660429cbca3c5b0e6c83df}{jbuf\_capacity}, support\_video)) ) \{
314         \hyperlink{logger_8h_aedad6a1e3ffe0d4cd0992b822ec0eeeb}{LOGGER\_ERROR}(\textcolor{stringliteral}{"Error while starting Codec State!\(\backslash\)n"});
315         pthread\_mutex\_unlock(call->\hyperlink{struct___tox_av_call_ab4293016252c4d4e63549b0773fa0f33}{mutex});
316         \textcolor{keywordflow}{return} \hyperlink{toxav_8h_a18cce814b2dde9d75ad400fa3d4c4571a631b6ad304b7291e35d5b6db2a77f92f}{av\_ErrorInitializingCodecs};
317     \}
318 
319     call->\hyperlink{struct___tox_av_call_ae88a02b5082b346e4c90541186364e99}{cs}->\hyperlink{struct___c_s_session_a18e94ace0074984593ae281f6bbda315}{agent} = av;
320     call->\hyperlink{struct___tox_av_call_ae88a02b5082b346e4c90541186364e99}{cs}->\hyperlink{struct___c_s_session_ad6b287fd08a0cc466cd41bd2e76d5808}{call\_idx} = call\_index;
321 
322     call->\hyperlink{struct___tox_av_call_ae88a02b5082b346e4c90541186364e99}{cs}->acb.first = av->acb.first;
323     call->\hyperlink{struct___tox_av_call_ae88a02b5082b346e4c90541186364e99}{cs}->acb.second = av->acb.second;
324 
325     call->\hyperlink{struct___tox_av_call_ae88a02b5082b346e4c90541186364e99}{cs}->vcb.first = av->vcb.first;
326     call->\hyperlink{struct___tox_av_call_ae88a02b5082b346e4c90541186364e99}{cs}->vcb.second = av->vcb.second;
327 
328 
329     call->\hyperlink{struct___tox_av_call_a2e84bee4a1898deac1f63f47235378eb}{crtps}[\hyperlink{toxav_8c_adf973963a7840ccbd70ca8f958a8d8fa}{audio\_index}] =
330         \hyperlink{rtp_8c_acda914088783d9822cdafdedf8fadd65}{rtp\_new}(\hyperlink{msi_8h_a54df3a97d8d112a3a4a6476c9f9284a6a4a64c16a6c74d9e29598b14b97bf5a45}{msi\_TypeAudio}, av->\hyperlink{struct___tox_av_a48342badc24a04d2310ca16ff4a3711b}{messenger}, av->
      \hyperlink{struct___tox_av_a85e3d7dd2ab722ee5ba0cd4b72bc7d60}{msi\_session}->\hyperlink{struct___m_s_i_session_ac40fee673bae4030b812579c57389a02}{calls}[call\_index]->\hyperlink{struct___m_s_i_call_a55d2568491d616f7fef07bc7137c8c23}{peers}[0]);
331 
332     \textcolor{keywordflow}{if} ( !call->\hyperlink{struct___tox_av_call_a2e84bee4a1898deac1f63f47235378eb}{crtps}[\hyperlink{toxav_8c_adf973963a7840ccbd70ca8f958a8d8fa}{audio\_index}] ) \{
333         \hyperlink{logger_8h_aedad6a1e3ffe0d4cd0992b822ec0eeeb}{LOGGER\_ERROR}(\textcolor{stringliteral}{"Error while starting audio RTP session!\(\backslash\)n"});
334         \textcolor{keywordflow}{goto} \hyperlink{msi_8c_a7251f9a01631fc788dd7c8eff23a422ead606e435413ea0944dd00d49e901e4ed}{error};
335     \}
336 
337     call->\hyperlink{struct___tox_av_call_a2e84bee4a1898deac1f63f47235378eb}{crtps}[\hyperlink{toxav_8c_adf973963a7840ccbd70ca8f958a8d8fa}{audio\_index}]->\hyperlink{struct___r_t_p_session_a6fa710f1d7103d0f7b2b872e33aac143}{cs} = call->\hyperlink{struct___tox_av_call_ae88a02b5082b346e4c90541186364e99}{cs};
338 
339     \textcolor{keywordflow}{if} ( support\_video ) \{
340         call->\hyperlink{struct___tox_av_call_a2e84bee4a1898deac1f63f47235378eb}{crtps}[\hyperlink{toxav_8c_a8aac960ea1e1579b3d90c1ab4a3dfe79}{video\_index}] =
341             \hyperlink{rtp_8c_acda914088783d9822cdafdedf8fadd65}{rtp\_new}(\hyperlink{msi_8h_a54df3a97d8d112a3a4a6476c9f9284a6a5db9e0515683460259700cbbdb916e68}{msi\_TypeVideo}, av->\hyperlink{struct___tox_av_a48342badc24a04d2310ca16ff4a3711b}{messenger}, av->
      \hyperlink{struct___tox_av_a85e3d7dd2ab722ee5ba0cd4b72bc7d60}{msi\_session}->\hyperlink{struct___m_s_i_session_ac40fee673bae4030b812579c57389a02}{calls}[call\_index]->\hyperlink{struct___m_s_i_call_a55d2568491d616f7fef07bc7137c8c23}{peers}[0]);
342 
343         \textcolor{keywordflow}{if} ( !call->\hyperlink{struct___tox_av_call_a2e84bee4a1898deac1f63f47235378eb}{crtps}[\hyperlink{toxav_8c_a8aac960ea1e1579b3d90c1ab4a3dfe79}{video\_index}] ) \{
344             \hyperlink{logger_8h_aedad6a1e3ffe0d4cd0992b822ec0eeeb}{LOGGER\_ERROR}(\textcolor{stringliteral}{"Error while starting video RTP session!\(\backslash\)n"});
345             \textcolor{keywordflow}{goto} \hyperlink{msi_8c_a7251f9a01631fc788dd7c8eff23a422ead606e435413ea0944dd00d49e901e4ed}{error};
346         \}
347 
348         call->\hyperlink{struct___tox_av_call_a2e84bee4a1898deac1f63f47235378eb}{crtps}[\hyperlink{toxav_8c_a8aac960ea1e1579b3d90c1ab4a3dfe79}{video\_index}]->\hyperlink{struct___r_t_p_session_a6fa710f1d7103d0f7b2b872e33aac143}{cs} = call->\hyperlink{struct___tox_av_call_ae88a02b5082b346e4c90541186364e99}{cs};
349     \}
350 
351     call->\hyperlink{struct___tox_av_call_a215df53a125f9b848dc883d9a1164430}{active} = 1;
352     pthread\_mutex\_unlock(call->\hyperlink{struct___tox_av_call_ab4293016252c4d4e63549b0773fa0f33}{mutex});
353     \textcolor{keywordflow}{return} \hyperlink{toxav_8h_a18cce814b2dde9d75ad400fa3d4c4571a112b17acf03c570f3bd9d1a1b42bdd40}{av\_ErrorNone};
354 \hyperlink{msi_8c_a7251f9a01631fc788dd7c8eff23a422ead606e435413ea0944dd00d49e901e4ed}{error}:
355     \hyperlink{rtp_8c_a8e1f9ce4d45738658914f4ef7c3144bc}{rtp\_kill}(call->\hyperlink{struct___tox_av_call_a2e84bee4a1898deac1f63f47235378eb}{crtps}[\hyperlink{toxav_8c_adf973963a7840ccbd70ca8f958a8d8fa}{audio\_index}], av->\hyperlink{struct___tox_av_a48342badc24a04d2310ca16ff4a3711b}{messenger});
356     call->\hyperlink{struct___tox_av_call_a2e84bee4a1898deac1f63f47235378eb}{crtps}[\hyperlink{toxav_8c_adf973963a7840ccbd70ca8f958a8d8fa}{audio\_index}] = NULL;
357     \hyperlink{rtp_8c_a8e1f9ce4d45738658914f4ef7c3144bc}{rtp\_kill}(call->\hyperlink{struct___tox_av_call_a2e84bee4a1898deac1f63f47235378eb}{crtps}[\hyperlink{toxav_8c_a8aac960ea1e1579b3d90c1ab4a3dfe79}{video\_index}], av->\hyperlink{struct___tox_av_a48342badc24a04d2310ca16ff4a3711b}{messenger});
358     call->\hyperlink{struct___tox_av_call_a2e84bee4a1898deac1f63f47235378eb}{crtps}[\hyperlink{toxav_8c_a8aac960ea1e1579b3d90c1ab4a3dfe79}{video\_index}] = NULL;
359     \hyperlink{codec_8c_addde6ea51851fcce009bb7d45147a88f}{cs\_kill}(call->\hyperlink{struct___tox_av_call_ae88a02b5082b346e4c90541186364e99}{cs});
360     call->\hyperlink{struct___tox_av_call_ae88a02b5082b346e4c90541186364e99}{cs} = NULL;
361     call->\hyperlink{struct___tox_av_call_a215df53a125f9b848dc883d9a1164430}{active} = 0;
362     pthread\_mutex\_destroy(call->\hyperlink{struct___tox_av_call_ac4c859b6e4ff8e175151fbd0a763e414}{mutex\_encoding\_audio});
363     pthread\_mutex\_destroy(call->\hyperlink{struct___tox_av_call_a89e9fe0c3fef08c502e53ad423dccc34}{mutex\_encoding\_video});
364     pthread\_mutex\_destroy(call->\hyperlink{struct___tox_av_call_acc4203df7776b6dfe0e5c3922a35e5b0}{mutex\_do});
365 
366     pthread\_mutex\_unlock(call->\hyperlink{struct___tox_av_call_ab4293016252c4d4e63549b0773fa0f33}{mutex});
367     \textcolor{keywordflow}{return} \hyperlink{toxav_8h_a18cce814b2dde9d75ad400fa3d4c4571ad4d12c61b5a320ba535db6c06d4e6bb8}{av\_ErrorCreatingRtpSessions};
368 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/d0e/toxav_8c_a9f2a69dda0bfe14d2a2bcf2497967f31_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/d0e/toxav_8c_a9f2a69dda0bfe14d2a2bcf2497967f31_icgraph}
\end{center}
\end{figure}


\hypertarget{toxav_8c_ac15e39782145d25bf6ba397aaf910071}{\index{toxav.\+c@{toxav.\+c}!toxav\+\_\+prepare\+\_\+video\+\_\+frame@{toxav\+\_\+prepare\+\_\+video\+\_\+frame}}
\index{toxav\+\_\+prepare\+\_\+video\+\_\+frame@{toxav\+\_\+prepare\+\_\+video\+\_\+frame}!toxav.\+c@{toxav.\+c}}
\subsubsection[{toxav\+\_\+prepare\+\_\+video\+\_\+frame}]{\setlength{\rightskip}{0pt plus 5cm}int toxav\+\_\+prepare\+\_\+video\+\_\+frame (
\begin{DoxyParamCaption}
\item[{{\bf Tox\+Av} $\ast$}]{av, }
\item[{int32\+\_\+t}]{call\+\_\+index, }
\item[{uint8\+\_\+t $\ast$}]{dest, }
\item[{int}]{dest\+\_\+max, }
\item[{vpx\+\_\+image\+\_\+t $\ast$}]{input}
\end{DoxyParamCaption}
)}}\label{toxav_8c_ac15e39782145d25bf6ba397aaf910071}
Encode video frame. 

Definition at line 446 of file toxav.\+c.



References \+\_\+\+Tox\+Av\+Call\+::active, av\+\_\+\+Error\+Encoding\+Video, av\+\_\+\+Error\+Invalid\+State, av\+\_\+\+Error\+No\+Call, av\+\_\+\+Error\+Packet\+Too\+Large, av\+\_\+\+Error\+Setting\+Video\+Resolution, C\+A\+L\+L\+\_\+\+I\+N\+V\+A\+L\+I\+D\+\_\+\+I\+N\+D\+E\+X, \+\_\+\+Tox\+Av\+::calls, \+\_\+\+C\+S\+Session\+::capabilities, \+\_\+\+Tox\+Av\+Call\+::cs, cs\+\_\+set\+\_\+video\+\_\+encoder\+\_\+resolution(), cs\+\_\+\+Video\+Encoding, \+\_\+\+C\+S\+Session\+::frame\+\_\+counter, L\+O\+G\+G\+E\+R\+\_\+\+E\+R\+R\+O\+R, L\+O\+G\+G\+E\+R\+\_\+\+W\+A\+R\+N\+I\+N\+G, \+\_\+\+M\+S\+I\+Session\+::max\+\_\+calls, M\+A\+X\+\_\+\+E\+N\+C\+O\+D\+E\+\_\+\+T\+I\+M\+E\+\_\+\+U\+S, \+\_\+\+Tox\+Av\+::msi\+\_\+session, \+\_\+\+Tox\+Av\+Call\+::mutex, \+\_\+\+Tox\+Av\+Call\+::mutex\+\_\+encoding\+\_\+video, and \+\_\+\+C\+S\+Session\+::v\+\_\+encoder.


\begin{DoxyCode}
447 \{
448     \textcolor{keywordflow}{if} (\hyperlink{toxav_8c_a9b51ecd9e898c75b7ed6cf9cd5596d1b}{CALL\_INVALID\_INDEX}(call\_index, av->\hyperlink{struct___tox_av_a85e3d7dd2ab722ee5ba0cd4b72bc7d60}{msi\_session}->
      \hyperlink{struct___m_s_i_session_ae4bbb4682dc5c74588083ca06ac2f76f}{max\_calls})) \{
449         \hyperlink{logger_8h_ab3e970f3c1ecb5b71f17eccee4ebb286}{LOGGER\_WARNING}(\textcolor{stringliteral}{"Invalid call index: %d"}, call\_index);
450         \textcolor{keywordflow}{return} \hyperlink{toxav_8h_a18cce814b2dde9d75ad400fa3d4c4571a8ea49f41e11f0f288834a29183fc57b5}{av\_ErrorNoCall};
451     \}
452 
453 
454     \hyperlink{struct___tox_av_call}{ToxAvCall} *call = &av->\hyperlink{struct___tox_av_abe854f89ac28ebd5112d1639d531b128}{calls}[call\_index];
455     pthread\_mutex\_lock(call->\hyperlink{struct___tox_av_call_ab4293016252c4d4e63549b0773fa0f33}{mutex});
456 
457     \textcolor{keywordflow}{if} (!call->\hyperlink{struct___tox_av_call_a215df53a125f9b848dc883d9a1164430}{active}) \{
458         pthread\_mutex\_unlock(call->\hyperlink{struct___tox_av_call_ab4293016252c4d4e63549b0773fa0f33}{mutex});
459         \hyperlink{logger_8h_ab3e970f3c1ecb5b71f17eccee4ebb286}{LOGGER\_WARNING}(\textcolor{stringliteral}{"Action on inactive call: %d"}, call\_index);
460         \textcolor{keywordflow}{return} \hyperlink{toxav_8h_a18cce814b2dde9d75ad400fa3d4c4571a8c3a91ff5639f545fbc49378cf7d94ad}{av\_ErrorInvalidState};
461     \}
462 
463     \textcolor{keywordflow}{if} (!(call->\hyperlink{struct___tox_av_call_ae88a02b5082b346e4c90541186364e99}{cs}->\hyperlink{struct___c_s_session_ac9e675ead9b3559ea462414a0016f6a6}{capabilities} & \hyperlink{codec_8h_a9ad0f479beeeb19d00d4ce7063bed6dea6a5a203bfa4ccde530809a3f11d4bb73}{cs\_VideoEncoding})) \{
464         pthread\_mutex\_unlock(call->\hyperlink{struct___tox_av_call_ab4293016252c4d4e63549b0773fa0f33}{mutex});
465         \hyperlink{logger_8h_ab3e970f3c1ecb5b71f17eccee4ebb286}{LOGGER\_WARNING}(\textcolor{stringliteral}{"Call doesn't support encoding video: %d"}, call\_index);
466         \textcolor{keywordflow}{return} \hyperlink{toxav_8h_a18cce814b2dde9d75ad400fa3d4c4571a8c3a91ff5639f545fbc49378cf7d94ad}{av\_ErrorInvalidState};
467     \}
468 
469     \textcolor{keywordflow}{if} (\hyperlink{codec_8c_a2c3fede54bd31b427fc5147cb450c714}{cs\_set\_video\_encoder\_resolution}(call->\hyperlink{struct___tox_av_call_ae88a02b5082b346e4c90541186364e99}{cs}, input->w, input->h) < 0)
       \{
470         pthread\_mutex\_unlock(call->\hyperlink{struct___tox_av_call_ab4293016252c4d4e63549b0773fa0f33}{mutex});
471         \textcolor{keywordflow}{return} \hyperlink{toxav_8h_a18cce814b2dde9d75ad400fa3d4c4571ae72fe6811cd822b18729badd3f0a985f}{av\_ErrorSettingVideoResolution};
472     \}
473 
474     pthread\_mutex\_lock(call->\hyperlink{struct___tox_av_call_a89e9fe0c3fef08c502e53ad423dccc34}{mutex\_encoding\_video});
475     pthread\_mutex\_unlock(call->\hyperlink{struct___tox_av_call_ab4293016252c4d4e63549b0773fa0f33}{mutex});
476 
477     \textcolor{keywordtype}{int} rc = vpx\_codec\_encode(&call->\hyperlink{struct___tox_av_call_ae88a02b5082b346e4c90541186364e99}{cs}->\hyperlink{struct___c_s_session_a0ec480a7314c0f185ae18f411d73b1bd}{v\_encoder}, input, call->\hyperlink{struct___tox_av_call_ae88a02b5082b346e4c90541186364e99}{cs}->
      \hyperlink{struct___c_s_session_abeaee952422869c026bab7d7f3f0f145}{frame\_counter}, 1, 0, \hyperlink{toxav_8c_ae1b44adfa4b1d57de2dd1d9ba055d816}{MAX\_ENCODE\_TIME\_US});
478 
479     \textcolor{keywordflow}{if} ( rc != VPX\_CODEC\_OK) \{
480         \hyperlink{logger_8h_aedad6a1e3ffe0d4cd0992b822ec0eeeb}{LOGGER\_ERROR}(\textcolor{stringliteral}{"Could not encode video frame: %s\(\backslash\)n"}, vpx\_codec\_err\_to\_string(rc));
481         pthread\_mutex\_unlock(call->\hyperlink{struct___tox_av_call_a89e9fe0c3fef08c502e53ad423dccc34}{mutex\_encoding\_video});
482         \textcolor{keywordflow}{return} \hyperlink{toxav_8h_a18cce814b2dde9d75ad400fa3d4c4571aef4e9f4373944befbfbf5c4cb903d3c6}{av\_ErrorEncodingVideo};
483     \}
484 
485     ++call->\hyperlink{struct___tox_av_call_ae88a02b5082b346e4c90541186364e99}{cs}->\hyperlink{struct___c_s_session_abeaee952422869c026bab7d7f3f0f145}{frame\_counter};
486 
487     vpx\_codec\_iter\_t iter = NULL;
488     \textcolor{keyword}{const} vpx\_codec\_cx\_pkt\_t *pkt;
489     \textcolor{keywordtype}{int} copied = 0;
490 
491     \textcolor{keywordflow}{while} ( (pkt = vpx\_codec\_get\_cx\_data(&call->\hyperlink{struct___tox_av_call_ae88a02b5082b346e4c90541186364e99}{cs}->\hyperlink{struct___c_s_session_a0ec480a7314c0f185ae18f411d73b1bd}{v\_encoder}, &iter)) ) \{
492         \textcolor{keywordflow}{if} (pkt->kind == VPX\_CODEC\_CX\_FRAME\_PKT) \{
493             \textcolor{keywordflow}{if} ( copied + pkt->data.frame.sz > dest\_max ) \{
494                 pthread\_mutex\_unlock(call->\hyperlink{struct___tox_av_call_a89e9fe0c3fef08c502e53ad423dccc34}{mutex\_encoding\_video});
495                 \textcolor{keywordflow}{return} \hyperlink{toxav_8h_a18cce814b2dde9d75ad400fa3d4c4571a49718f7267fb6589c66c535dc8cfce82}{av\_ErrorPacketTooLarge};
496             \}
497 
498             memcpy(dest + copied, pkt->data.frame.buf, pkt->data.frame.sz);
499             copied += pkt->data.frame.sz;
500         \}
501     \}
502 
503     pthread\_mutex\_unlock(call->\hyperlink{struct___tox_av_call_a89e9fe0c3fef08c502e53ad423dccc34}{mutex\_encoding\_video});
504     \textcolor{keywordflow}{return} copied;
505 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/d0e/toxav_8c_ac15e39782145d25bf6ba397aaf910071_cgraph}
\end{center}
\end{figure}


\hypertarget{toxav_8c_a61dbbb75f2337c5c7c77acd83fffe639}{\index{toxav.\+c@{toxav.\+c}!toxav\+\_\+register\+\_\+audio\+\_\+callback@{toxav\+\_\+register\+\_\+audio\+\_\+callback}}
\index{toxav\+\_\+register\+\_\+audio\+\_\+callback@{toxav\+\_\+register\+\_\+audio\+\_\+callback}!toxav.\+c@{toxav.\+c}}
\subsubsection[{toxav\+\_\+register\+\_\+audio\+\_\+callback}]{\setlength{\rightskip}{0pt plus 5cm}void toxav\+\_\+register\+\_\+audio\+\_\+callback (
\begin{DoxyParamCaption}
\item[{{\bf Tox\+Av} $\ast$}]{av, }
\item[{{\bf Tox\+Av\+Audio\+Callback}}]{cb, }
\item[{void $\ast$}]{userdata}
\end{DoxyParamCaption}
)}}\label{toxav_8c_a61dbbb75f2337c5c7c77acd83fffe639}
Register callback for audio data. 

Definition at line 214 of file toxav.\+c.



Referenced by register\+\_\+callbacks().


\begin{DoxyCode}
215 \{
216     av->acb.first = cb;
217     av->acb.second = userdata;
218 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/d0e/toxav_8c_a61dbbb75f2337c5c7c77acd83fffe639_icgraph}
\end{center}
\end{figure}


\hypertarget{toxav_8c_a9abb9d72d8ce906d4bfc5b472b617017}{\index{toxav.\+c@{toxav.\+c}!toxav\+\_\+register\+\_\+callstate\+\_\+callback@{toxav\+\_\+register\+\_\+callstate\+\_\+callback}}
\index{toxav\+\_\+register\+\_\+callstate\+\_\+callback@{toxav\+\_\+register\+\_\+callstate\+\_\+callback}!toxav.\+c@{toxav.\+c}}
\subsubsection[{toxav\+\_\+register\+\_\+callstate\+\_\+callback}]{\setlength{\rightskip}{0pt plus 5cm}void toxav\+\_\+register\+\_\+callstate\+\_\+callback (
\begin{DoxyParamCaption}
\item[{{\bf Tox\+Av} $\ast$}]{av, }
\item[{{\bf Tox\+A\+V\+Callback}}]{cb, }
\item[{{\bf Tox\+Av\+Callback\+I\+D}}]{id, }
\item[{void $\ast$}]{userdata}
\end{DoxyParamCaption}
)}}\label{toxav_8c_a9abb9d72d8ce906d4bfc5b472b617017}
Register callback for call state. 

Definition at line 209 of file toxav.\+c.



References msi\+\_\+register\+\_\+callback(), and \+\_\+\+Tox\+Av\+::msi\+\_\+session.



Referenced by register\+\_\+callbacks().


\begin{DoxyCode}
210 \{
211     \hyperlink{msi_8c_a1121e56554f776e97436cc9a6a3769c4}{msi\_register\_callback}(av->\hyperlink{struct___tox_av_a85e3d7dd2ab722ee5ba0cd4b72bc7d60}{msi\_session}, (
      \hyperlink{msi_8h_afe514f5cbbbb1153f50ab068d405b864}{MSICallbackType})cb, (\hyperlink{msi_8h_aba083d202aa40ee6d37db924fe486401}{MSICallbackID}) \textcolor{keywordtype}{id}, userdata);
212 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=347pt]{d8/d0e/toxav_8c_a9abb9d72d8ce906d4bfc5b472b617017_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/d0e/toxav_8c_a9abb9d72d8ce906d4bfc5b472b617017_icgraph}
\end{center}
\end{figure}


\hypertarget{toxav_8c_a22179185a68fe2a2f126b2c328670f73}{\index{toxav.\+c@{toxav.\+c}!toxav\+\_\+register\+\_\+video\+\_\+callback@{toxav\+\_\+register\+\_\+video\+\_\+callback}}
\index{toxav\+\_\+register\+\_\+video\+\_\+callback@{toxav\+\_\+register\+\_\+video\+\_\+callback}!toxav.\+c@{toxav.\+c}}
\subsubsection[{toxav\+\_\+register\+\_\+video\+\_\+callback}]{\setlength{\rightskip}{0pt plus 5cm}void toxav\+\_\+register\+\_\+video\+\_\+callback (
\begin{DoxyParamCaption}
\item[{{\bf Tox\+Av} $\ast$}]{av, }
\item[{{\bf Tox\+Av\+Video\+Callback}}]{cb, }
\item[{void $\ast$}]{userdata}
\end{DoxyParamCaption}
)}}\label{toxav_8c_a22179185a68fe2a2f126b2c328670f73}
Register callback for video data. 

Definition at line 220 of file toxav.\+c.



Referenced by register\+\_\+callbacks().


\begin{DoxyCode}
221 \{
222     av->vcb.first = cb;
223     av->vcb.second = userdata;
224 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/d0e/toxav_8c_a22179185a68fe2a2f126b2c328670f73_icgraph}
\end{center}
\end{figure}


\hypertarget{toxav_8c_ad783f1a19a2765ff6924723193d05d07}{\index{toxav.\+c@{toxav.\+c}!toxav\+\_\+reject@{toxav\+\_\+reject}}
\index{toxav\+\_\+reject@{toxav\+\_\+reject}!toxav.\+c@{toxav.\+c}}
\subsubsection[{toxav\+\_\+reject}]{\setlength{\rightskip}{0pt plus 5cm}int toxav\+\_\+reject (
\begin{DoxyParamCaption}
\item[{{\bf Tox\+Av} $\ast$}]{av, }
\item[{int32\+\_\+t}]{call\+\_\+index, }
\item[{const char $\ast$}]{reason}
\end{DoxyParamCaption}
)}}\label{toxav_8c_ad783f1a19a2765ff6924723193d05d07}
Reject incoming call. 

Definition at line 245 of file toxav.\+c.



References msi\+\_\+reject(), and \+\_\+\+Tox\+Av\+::msi\+\_\+session.



Referenced by S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T().


\begin{DoxyCode}
246 \{
247     \textcolor{keywordflow}{return} \hyperlink{msi_8c_a9d846fba046c8539b9e183cc01a25fe9}{msi\_reject}(av->\hyperlink{struct___tox_av_a85e3d7dd2ab722ee5ba0cd4b72bc7d60}{msi\_session}, call\_index, reason);
248 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/d0e/toxav_8c_ad783f1a19a2765ff6924723193d05d07_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=266pt]{d8/d0e/toxav_8c_ad783f1a19a2765ff6924723193d05d07_icgraph}
\end{center}
\end{figure}


\hypertarget{toxav_8c_abd49d9a595a87814f54eeaa17d7ad833}{\index{toxav.\+c@{toxav.\+c}!toxav\+\_\+send\+\_\+audio@{toxav\+\_\+send\+\_\+audio}}
\index{toxav\+\_\+send\+\_\+audio@{toxav\+\_\+send\+\_\+audio}!toxav.\+c@{toxav.\+c}}
\subsubsection[{toxav\+\_\+send\+\_\+audio}]{\setlength{\rightskip}{0pt plus 5cm}int toxav\+\_\+send\+\_\+audio (
\begin{DoxyParamCaption}
\item[{{\bf Tox\+Av} $\ast$}]{av, }
\item[{int32\+\_\+t}]{call\+\_\+index, }
\item[{const uint8\+\_\+t $\ast$}]{frame, }
\item[{unsigned int}]{size}
\end{DoxyParamCaption}
)}}\label{toxav_8c_abd49d9a595a87814f54eeaa17d7ad833}
Send encoded audio frame. 

Definition at line 565 of file toxav.\+c.



References \+\_\+\+Tox\+Av\+Call\+::active, av\+\_\+\+Error\+Invalid\+State, av\+\_\+\+Error\+No\+Call, av\+\_\+\+Type\+Audio, C\+A\+L\+L\+\_\+\+I\+N\+V\+A\+L\+I\+D\+\_\+\+I\+N\+D\+E\+X, \+\_\+\+Tox\+Av\+::calls, L\+O\+G\+G\+E\+R\+\_\+\+W\+A\+R\+N\+I\+N\+G, \+\_\+\+M\+S\+I\+Session\+::max\+\_\+calls, \+\_\+\+Tox\+Av\+::msi\+\_\+session, \+\_\+\+Tox\+Av\+Call\+::mutex, and toxav\+\_\+send\+\_\+rtp\+\_\+payload().



Referenced by in\+\_\+thread\+\_\+call(), and S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T().


\begin{DoxyCode}
566 \{
567     \textcolor{keywordflow}{if} (\hyperlink{toxav_8c_a9b51ecd9e898c75b7ed6cf9cd5596d1b}{CALL\_INVALID\_INDEX}(call\_index, av->\hyperlink{struct___tox_av_a85e3d7dd2ab722ee5ba0cd4b72bc7d60}{msi\_session}->
      \hyperlink{struct___m_s_i_session_ae4bbb4682dc5c74588083ca06ac2f76f}{max\_calls})) \{
568         \hyperlink{logger_8h_ab3e970f3c1ecb5b71f17eccee4ebb286}{LOGGER\_WARNING}(\textcolor{stringliteral}{"Action on nonexisting call: %d"}, call\_index);
569         \textcolor{keywordflow}{return} \hyperlink{toxav_8h_a18cce814b2dde9d75ad400fa3d4c4571a8ea49f41e11f0f288834a29183fc57b5}{av\_ErrorNoCall};
570     \}
571 
572     \hyperlink{struct___tox_av_call}{ToxAvCall} *call = &av->\hyperlink{struct___tox_av_abe854f89ac28ebd5112d1639d531b128}{calls}[call\_index];
573     pthread\_mutex\_lock(call->\hyperlink{struct___tox_av_call_ab4293016252c4d4e63549b0773fa0f33}{mutex});
574 
575 
576     \textcolor{keywordflow}{if} (!call->\hyperlink{struct___tox_av_call_a215df53a125f9b848dc883d9a1164430}{active}) \{
577         pthread\_mutex\_unlock(call->\hyperlink{struct___tox_av_call_ab4293016252c4d4e63549b0773fa0f33}{mutex});
578         \hyperlink{logger_8h_ab3e970f3c1ecb5b71f17eccee4ebb286}{LOGGER\_WARNING}(\textcolor{stringliteral}{"Action on inactive call: %d"}, call\_index);
579         \textcolor{keywordflow}{return} \hyperlink{toxav_8h_a18cce814b2dde9d75ad400fa3d4c4571a8c3a91ff5639f545fbc49378cf7d94ad}{av\_ErrorInvalidState};
580     \}
581 
582     \textcolor{keywordtype}{int} rc = \hyperlink{toxav_8c_aa03b009616ed838e27caded4f69483d1}{toxav\_send\_rtp\_payload}(av, call, \hyperlink{toxav_8h_aa735e8f3c71af6a841c2ffc3650bb802a9a2c48ac5859ccdd4329bd6c31f372a5}{av\_TypeAudio}, 
      \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}, size);
583     pthread\_mutex\_unlock(call->\hyperlink{struct___tox_av_call_ab4293016252c4d4e63549b0773fa0f33}{mutex});
584     \textcolor{keywordflow}{return} rc;
585 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/d0e/toxav_8c_abd49d9a595a87814f54eeaa17d7ad833_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=291pt]{d8/d0e/toxav_8c_abd49d9a595a87814f54eeaa17d7ad833_icgraph}
\end{center}
\end{figure}


\hypertarget{toxav_8c_aa03b009616ed838e27caded4f69483d1}{\index{toxav.\+c@{toxav.\+c}!toxav\+\_\+send\+\_\+rtp\+\_\+payload@{toxav\+\_\+send\+\_\+rtp\+\_\+payload}}
\index{toxav\+\_\+send\+\_\+rtp\+\_\+payload@{toxav\+\_\+send\+\_\+rtp\+\_\+payload}!toxav.\+c@{toxav.\+c}}
\subsubsection[{toxav\+\_\+send\+\_\+rtp\+\_\+payload}]{\setlength{\rightskip}{0pt plus 5cm}static int toxav\+\_\+send\+\_\+rtp\+\_\+payload (
\begin{DoxyParamCaption}
\item[{{\bf Tox\+Av} $\ast$}]{av, }
\item[{{\bf Tox\+Av\+Call} $\ast$}]{call, }
\item[{{\bf Tox\+Av\+Call\+Type}}]{type, }
\item[{const uint8\+\_\+t $\ast$}]{payload, }
\item[{unsigned int}]{length}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{toxav_8c_aa03b009616ed838e27caded4f69483d1}


Definition at line 412 of file toxav.\+c.



References audio\+\_\+index, av\+\_\+\+Error\+None, av\+\_\+\+Error\+No\+Rtp\+Session, av\+\_\+\+Error\+Sending\+Payload, av\+\_\+\+Type\+Audio, \+\_\+\+Tox\+Av\+Call\+::crtps, \+\_\+\+Tox\+Av\+Call\+::cs, cs\+\_\+get\+\_\+split\+\_\+video\+\_\+frame(), cs\+\_\+split\+\_\+video\+\_\+payload(), i, \+\_\+\+Tox\+Av\+::messenger, rtp\+\_\+send\+\_\+msg(), and video\+\_\+index.



Referenced by toxav\+\_\+send\+\_\+audio(), and toxav\+\_\+send\+\_\+video().


\begin{DoxyCode}
417 \{
418     \textcolor{keywordflow}{if} (call->\hyperlink{struct___tox_av_call_a2e84bee4a1898deac1f63f47235378eb}{crtps}[type - \hyperlink{toxav_8h_aa735e8f3c71af6a841c2ffc3650bb802a9a2c48ac5859ccdd4329bd6c31f372a5}{av\_TypeAudio}]) \{
419 
420         \textcolor{comment}{/* Audio */}
421         \textcolor{keywordflow}{if} (type == \hyperlink{toxav_8h_aa735e8f3c71af6a841c2ffc3650bb802a9a2c48ac5859ccdd4329bd6c31f372a5}{av\_TypeAudio})
422             \textcolor{keywordflow}{return} \hyperlink{rtp_8c_a061d9b8e8abbcfb87d365bf65297e3f3}{rtp\_send\_msg}(call->\hyperlink{struct___tox_av_call_a2e84bee4a1898deac1f63f47235378eb}{crtps}[\hyperlink{toxav_8c_adf973963a7840ccbd70ca8f958a8d8fa}{audio\_index}], av->
      \hyperlink{struct___tox_av_a48342badc24a04d2310ca16ff4a3711b}{messenger}, payload, length);
423 
424         \textcolor{comment}{/* Video */}
425         \textcolor{keywordtype}{int} parts = \hyperlink{codec_8c_a5da4a305e711e7213dfcbe92d31d37bf}{cs\_split\_video\_payload}(call->\hyperlink{struct___tox_av_call_ae88a02b5082b346e4c90541186364e99}{cs}, payload, length);
426 
427         \textcolor{keywordflow}{if} (parts < 0) \textcolor{keywordflow}{return} parts;
428 
429         uint16\_t part\_size;
430         \textcolor{keyword}{const} uint8\_t *iter;
431 
432         \textcolor{keywordtype}{int} \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
433 
434         \textcolor{keywordflow}{for} (i = 0; i < parts; i++) \{
435             iter = \hyperlink{codec_8c_a61d7fe6f60a95160c4ca434a60cb9bf7}{cs\_get\_split\_video\_frame}(call->\hyperlink{struct___tox_av_call_ae88a02b5082b346e4c90541186364e99}{cs}, &part\_size);
436 
437             \textcolor{keywordflow}{if} (\hyperlink{rtp_8c_a061d9b8e8abbcfb87d365bf65297e3f3}{rtp\_send\_msg}(call->\hyperlink{struct___tox_av_call_a2e84bee4a1898deac1f63f47235378eb}{crtps}[\hyperlink{toxav_8c_a8aac960ea1e1579b3d90c1ab4a3dfe79}{video\_index}], av->
      \hyperlink{struct___tox_av_a48342badc24a04d2310ca16ff4a3711b}{messenger}, iter, part\_size) < 0)
438                 \textcolor{keywordflow}{return} \hyperlink{toxav_8h_a18cce814b2dde9d75ad400fa3d4c4571a32cae25023f47db33e901efdcb988bb6}{av\_ErrorSendingPayload};
439         \}
440 
441         \textcolor{keywordflow}{return} \hyperlink{toxav_8h_a18cce814b2dde9d75ad400fa3d4c4571a112b17acf03c570f3bd9d1a1b42bdd40}{av\_ErrorNone};
442 
443     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{return} \hyperlink{toxav_8h_a18cce814b2dde9d75ad400fa3d4c4571a006410f633c4e8269fddc6dca6280b82}{av\_ErrorNoRtpSession};
444 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/d0e/toxav_8c_aa03b009616ed838e27caded4f69483d1_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/d0e/toxav_8c_aa03b009616ed838e27caded4f69483d1_icgraph}
\end{center}
\end{figure}


\hypertarget{toxav_8c_a4aa0876a176b4e5e7abea2f72059a502}{\index{toxav.\+c@{toxav.\+c}!toxav\+\_\+send\+\_\+video@{toxav\+\_\+send\+\_\+video}}
\index{toxav\+\_\+send\+\_\+video@{toxav\+\_\+send\+\_\+video}!toxav.\+c@{toxav.\+c}}
\subsubsection[{toxav\+\_\+send\+\_\+video}]{\setlength{\rightskip}{0pt plus 5cm}int toxav\+\_\+send\+\_\+video (
\begin{DoxyParamCaption}
\item[{{\bf Tox\+Av} $\ast$}]{av, }
\item[{int32\+\_\+t}]{call\+\_\+index, }
\item[{const uint8\+\_\+t $\ast$}]{frame, }
\item[{unsigned int}]{frame\+\_\+size}
\end{DoxyParamCaption}
)}}\label{toxav_8c_a4aa0876a176b4e5e7abea2f72059a502}


Definition at line 507 of file toxav.\+c.



References \+\_\+\+Tox\+Av\+Call\+::active, av\+\_\+\+Error\+Invalid\+State, av\+\_\+\+Error\+No\+Call, av\+\_\+\+Type\+Video, C\+A\+L\+L\+\_\+\+I\+N\+V\+A\+L\+I\+D\+\_\+\+I\+N\+D\+E\+X, \+\_\+\+Tox\+Av\+::calls, L\+O\+G\+G\+E\+R\+\_\+\+W\+A\+R\+N\+I\+N\+G, \+\_\+\+M\+S\+I\+Session\+::max\+\_\+calls, \+\_\+\+Tox\+Av\+::msi\+\_\+session, \+\_\+\+Tox\+Av\+Call\+::mutex, and toxav\+\_\+send\+\_\+rtp\+\_\+payload().


\begin{DoxyCode}
508 \{
509 
510     \textcolor{keywordflow}{if} (\hyperlink{toxav_8c_a9b51ecd9e898c75b7ed6cf9cd5596d1b}{CALL\_INVALID\_INDEX}(call\_index, av->\hyperlink{struct___tox_av_a85e3d7dd2ab722ee5ba0cd4b72bc7d60}{msi\_session}->
      \hyperlink{struct___m_s_i_session_ae4bbb4682dc5c74588083ca06ac2f76f}{max\_calls})) \{
511         \hyperlink{logger_8h_ab3e970f3c1ecb5b71f17eccee4ebb286}{LOGGER\_WARNING}(\textcolor{stringliteral}{"Invalid call index: %d"}, call\_index);
512         \textcolor{keywordflow}{return} \hyperlink{toxav_8h_a18cce814b2dde9d75ad400fa3d4c4571a8ea49f41e11f0f288834a29183fc57b5}{av\_ErrorNoCall};
513     \}
514 
515     \hyperlink{struct___tox_av_call}{ToxAvCall} *call = &av->\hyperlink{struct___tox_av_abe854f89ac28ebd5112d1639d531b128}{calls}[call\_index];
516     pthread\_mutex\_lock(call->\hyperlink{struct___tox_av_call_ab4293016252c4d4e63549b0773fa0f33}{mutex});
517 
518 
519     \textcolor{keywordflow}{if} (!call->\hyperlink{struct___tox_av_call_a215df53a125f9b848dc883d9a1164430}{active}) \{
520         pthread\_mutex\_unlock(call->\hyperlink{struct___tox_av_call_ab4293016252c4d4e63549b0773fa0f33}{mutex});
521         \hyperlink{logger_8h_ab3e970f3c1ecb5b71f17eccee4ebb286}{LOGGER\_WARNING}(\textcolor{stringliteral}{"Action on inactive call: %d"}, call\_index);
522         \textcolor{keywordflow}{return} \hyperlink{toxav_8h_a18cce814b2dde9d75ad400fa3d4c4571a8c3a91ff5639f545fbc49378cf7d94ad}{av\_ErrorInvalidState};
523     \}
524 
525     \textcolor{keywordtype}{int} rc = \hyperlink{toxav_8c_aa03b009616ed838e27caded4f69483d1}{toxav\_send\_rtp\_payload}(av, call, \hyperlink{toxav_8h_aa735e8f3c71af6a841c2ffc3650bb802a4c8031669712d3775b97811c5200ebbc}{av\_TypeVideo}, frame, 
      frame\_size);
526     pthread\_mutex\_unlock(call->\hyperlink{struct___tox_av_call_ab4293016252c4d4e63549b0773fa0f33}{mutex});
527 
528     \textcolor{keywordflow}{return} rc;
529 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/d0e/toxav_8c_a4aa0876a176b4e5e7abea2f72059a502_cgraph}
\end{center}
\end{figure}


\hypertarget{toxav_8c_a7f5a8786bb985cdcdae0cc42a442b23e}{\index{toxav.\+c@{toxav.\+c}!toxav\+\_\+stop\+\_\+call@{toxav\+\_\+stop\+\_\+call}}
\index{toxav\+\_\+stop\+\_\+call@{toxav\+\_\+stop\+\_\+call}!toxav.\+c@{toxav.\+c}}
\subsubsection[{toxav\+\_\+stop\+\_\+call}]{\setlength{\rightskip}{0pt plus 5cm}int toxav\+\_\+stop\+\_\+call (
\begin{DoxyParamCaption}
\item[{{\bf Tox\+Av} $\ast$}]{av, }
\item[{int32\+\_\+t}]{call\+\_\+index}
\end{DoxyParamCaption}
)}}\label{toxav_8c_a7f5a8786bb985cdcdae0cc42a442b23e}
Terminate transmission. Note that transmission will be terminated without informing remote peer. Usually called when we can't inform peer. 

Definition at line 260 of file toxav.\+c.



References \+\_\+\+Tox\+Av\+::msi\+\_\+session, and msi\+\_\+stopcall().


\begin{DoxyCode}
261 \{
262     \textcolor{keywordflow}{return} \hyperlink{msi_8c_a4d2aa9bfe7f4a96275204f2797d6e7eb}{msi\_stopcall}(av->\hyperlink{struct___tox_av_a85e3d7dd2ab722ee5ba0cd4b72bc7d60}{msi\_session}, call\_index);
263 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/d0e/toxav_8c_a7f5a8786bb985cdcdae0cc42a442b23e_cgraph}
\end{center}
\end{figure}


\hypertarget{toxav_8c_a8eb45d94b5ed002925b58f36c66426b1}{\index{toxav.\+c@{toxav.\+c}!toxavcsettings\+\_\+cast@{toxavcsettings\+\_\+cast}}
\index{toxavcsettings\+\_\+cast@{toxavcsettings\+\_\+cast}!toxav.\+c@{toxav.\+c}}
\subsubsection[{toxavcsettings\+\_\+cast}]{\setlength{\rightskip}{0pt plus 5cm}static const {\bf Tox\+Av\+C\+Settings}$\ast$ toxavcsettings\+\_\+cast (
\begin{DoxyParamCaption}
\item[{const {\bf M\+S\+I\+C\+Settings} $\ast$}]{from}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{toxav_8c_a8eb45d94b5ed002925b58f36c66426b1}


Definition at line 95 of file toxav.\+c.



Referenced by toxav\+\_\+get\+\_\+peer\+\_\+csettings(), and toxav\+\_\+prepare\+\_\+transmission().


\begin{DoxyCode}
96 \{
97     assert(\textcolor{keyword}{sizeof}(\hyperlink{struct___m_s_i_codec_settings}{MSICSettings}) == \textcolor{keyword}{sizeof}(\hyperlink{struct___tox_av_c_settings}{ToxAvCSettings}));
98     \textcolor{keywordflow}{return} (\textcolor{keyword}{const} \hyperlink{struct___tox_av_c_settings}{ToxAvCSettings} *) from;
99 
100 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/d0e/toxav_8c_a8eb45d94b5ed002925b58f36c66426b1_icgraph}
\end{center}
\end{figure}




\subsection{Variable Documentation}
\hypertarget{toxav_8c_adf973963a7840ccbd70ca8f958a8d8fa}{\index{toxav.\+c@{toxav.\+c}!audio\+\_\+index@{audio\+\_\+index}}
\index{audio\+\_\+index@{audio\+\_\+index}!toxav.\+c@{toxav.\+c}}
\subsubsection[{audio\+\_\+index}]{\setlength{\rightskip}{0pt plus 5cm}const uint8\+\_\+t audio\+\_\+index = 0\hspace{0.3cm}{\ttfamily [static]}}}\label{toxav_8c_adf973963a7840ccbd70ca8f958a8d8fa}


Definition at line 62 of file toxav.\+c.



Referenced by toxav\+\_\+kill(), toxav\+\_\+kill\+\_\+transmission(), toxav\+\_\+prepare\+\_\+transmission(), and toxav\+\_\+send\+\_\+rtp\+\_\+payload().

\hypertarget{toxav_8c_aff13faf6b338ca682c4c206b9fdde7fc}{\index{toxav.\+c@{toxav.\+c}!av\+\_\+\+Default\+Settings@{av\+\_\+\+Default\+Settings}}
\index{av\+\_\+\+Default\+Settings@{av\+\_\+\+Default\+Settings}!toxav.\+c@{toxav.\+c}}
\subsubsection[{av\+\_\+\+Default\+Settings}]{\setlength{\rightskip}{0pt plus 5cm}const {\bf Tox\+Av\+C\+Settings} av\+\_\+\+Default\+Settings}}\label{toxav_8c_aff13faf6b338ca682c4c206b9fdde7fc}
{\bfseries Initial value\+:}
\begin{DoxyCode}
= \{
    \hyperlink{toxav_8h_aa735e8f3c71af6a841c2ffc3650bb802a9a2c48ac5859ccdd4329bd6c31f372a5}{av\_TypeAudio},

    500,
    1280,
    720,

    32000,
    20,
    48000,
    1
\}
\end{DoxyCode}


Definition at line 48 of file toxav.\+c.



Referenced by in\+\_\+thread\+\_\+call(), and S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T().

\hypertarget{toxav_8c_a6a7e054aaa660429cbca3c5b0e6c83df}{\index{toxav.\+c@{toxav.\+c}!jbuf\+\_\+capacity@{jbuf\+\_\+capacity}}
\index{jbuf\+\_\+capacity@{jbuf\+\_\+capacity}!toxav.\+c@{toxav.\+c}}
\subsubsection[{jbuf\+\_\+capacity}]{\setlength{\rightskip}{0pt plus 5cm}const uint32\+\_\+t jbuf\+\_\+capacity = 6\hspace{0.3cm}{\ttfamily [static]}}}\label{toxav_8c_a6a7e054aaa660429cbca3c5b0e6c83df}


Definition at line 61 of file toxav.\+c.



Referenced by toxav\+\_\+prepare\+\_\+transmission().

\hypertarget{toxav_8c_a8aac960ea1e1579b3d90c1ab4a3dfe79}{\index{toxav.\+c@{toxav.\+c}!video\+\_\+index@{video\+\_\+index}}
\index{video\+\_\+index@{video\+\_\+index}!toxav.\+c@{toxav.\+c}}
\subsubsection[{video\+\_\+index}]{\setlength{\rightskip}{0pt plus 5cm}const uint8\+\_\+t video\+\_\+index = 1\hspace{0.3cm}{\ttfamily [static]}}}\label{toxav_8c_a8aac960ea1e1579b3d90c1ab4a3dfe79}


Definition at line 62 of file toxav.\+c.



Referenced by toxav\+\_\+kill(), toxav\+\_\+kill\+\_\+transmission(), toxav\+\_\+prepare\+\_\+transmission(), and toxav\+\_\+send\+\_\+rtp\+\_\+payload().

