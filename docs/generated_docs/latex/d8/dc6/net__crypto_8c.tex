\hypertarget{net__crypto_8c}{\section{toxcore/net\+\_\+crypto.c File Reference}
\label{net__crypto_8c}\index{toxcore/net\+\_\+crypto.\+c@{toxcore/net\+\_\+crypto.\+c}}
}
{\ttfamily \#include \char`\"{}net\+\_\+crypto.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}util.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}math.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}logger.\+h\char`\"{}}\\*
Include dependency graph for net\+\_\+crypto.\+c\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d6/da9/net__crypto_8c__incl}
\end{center}
\end{figure}
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{net__crypto_8c_adba18a4b236aff118053b3b614499cad}{C\+O\+O\+K\+I\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T}~15
\item 
\#define \hyperlink{net__crypto_8c_ada1ab442f8ac484c80c15260ab737cab}{C\+O\+O\+K\+I\+E\+\_\+\+D\+A\+T\+A\+\_\+\+L\+E\+N\+G\+T\+H}~(crypto\+\_\+box\+\_\+\+P\+U\+B\+L\+I\+C\+K\+E\+Y\+B\+Y\+T\+E\+S $\ast$ 2)
\item 
\#define \hyperlink{net__crypto_8c_a35fd5a283cae1c0954d99c778ac9ad27}{C\+O\+O\+K\+I\+E\+\_\+\+C\+O\+N\+T\+E\+N\+T\+S\+\_\+\+L\+E\+N\+G\+T\+H}~(sizeof(uint64\+\_\+t) + \hyperlink{net__crypto_8c_ada1ab442f8ac484c80c15260ab737cab}{C\+O\+O\+K\+I\+E\+\_\+\+D\+A\+T\+A\+\_\+\+L\+E\+N\+G\+T\+H})
\item 
\#define \hyperlink{net__crypto_8c_a905c0a7642c878ca482e2d7aff7d670c}{C\+O\+O\+K\+I\+E\+\_\+\+L\+E\+N\+G\+T\+H}~(crypto\+\_\+box\+\_\+\+N\+O\+N\+C\+E\+B\+Y\+T\+E\+S + \hyperlink{net__crypto_8c_a35fd5a283cae1c0954d99c778ac9ad27}{C\+O\+O\+K\+I\+E\+\_\+\+C\+O\+N\+T\+E\+N\+T\+S\+\_\+\+L\+E\+N\+G\+T\+H} + crypto\+\_\+box\+\_\+\+M\+A\+C\+B\+Y\+T\+E\+S)
\item 
\#define \hyperlink{net__crypto_8c_a09bc1e1952ce2d46d01925227c1c34d1}{C\+O\+O\+K\+I\+E\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+P\+L\+A\+I\+N\+\_\+\+L\+E\+N\+G\+T\+H}~(\hyperlink{net__crypto_8c_ada1ab442f8ac484c80c15260ab737cab}{C\+O\+O\+K\+I\+E\+\_\+\+D\+A\+T\+A\+\_\+\+L\+E\+N\+G\+T\+H} + sizeof(uint64\+\_\+t))
\item 
\#define \hyperlink{net__crypto_8c_a25d19522f8fdd8da8932746bcf11e8aa}{C\+O\+O\+K\+I\+E\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+L\+E\+N\+G\+T\+H}~(1 + crypto\+\_\+box\+\_\+\+P\+U\+B\+L\+I\+C\+K\+E\+Y\+B\+Y\+T\+E\+S + crypto\+\_\+box\+\_\+\+N\+O\+N\+C\+E\+B\+Y\+T\+E\+S + \hyperlink{net__crypto_8c_a09bc1e1952ce2d46d01925227c1c34d1}{C\+O\+O\+K\+I\+E\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+P\+L\+A\+I\+N\+\_\+\+L\+E\+N\+G\+T\+H} + crypto\+\_\+box\+\_\+\+M\+A\+C\+B\+Y\+T\+E\+S)
\item 
\#define \hyperlink{net__crypto_8c_a145d90f988058f15e869e94884d7f614}{C\+O\+O\+K\+I\+E\+\_\+\+R\+E\+S\+P\+O\+N\+S\+E\+\_\+\+L\+E\+N\+G\+T\+H}~(1 + crypto\+\_\+box\+\_\+\+N\+O\+N\+C\+E\+B\+Y\+T\+E\+S + \hyperlink{net__crypto_8c_a905c0a7642c878ca482e2d7aff7d670c}{C\+O\+O\+K\+I\+E\+\_\+\+L\+E\+N\+G\+T\+H} + sizeof(uint64\+\_\+t) + crypto\+\_\+box\+\_\+\+M\+A\+C\+B\+Y\+T\+E\+S)
\item 
\#define \hyperlink{net__crypto_8c_aae5268846bab0f3dcfe6071d0442d89e}{H\+A\+N\+D\+S\+H\+A\+K\+E\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+L\+E\+N\+G\+T\+H}~(1 + \hyperlink{net__crypto_8c_a905c0a7642c878ca482e2d7aff7d670c}{C\+O\+O\+K\+I\+E\+\_\+\+L\+E\+N\+G\+T\+H} + crypto\+\_\+box\+\_\+\+N\+O\+N\+C\+E\+B\+Y\+T\+E\+S + crypto\+\_\+box\+\_\+\+N\+O\+N\+C\+E\+B\+Y\+T\+E\+S + crypto\+\_\+box\+\_\+\+P\+U\+B\+L\+I\+C\+K\+E\+Y\+B\+Y\+T\+E\+S + crypto\+\_\+hash\+\_\+sha512\+\_\+\+B\+Y\+T\+E\+S + \hyperlink{net__crypto_8c_a905c0a7642c878ca482e2d7aff7d670c}{C\+O\+O\+K\+I\+E\+\_\+\+L\+E\+N\+G\+T\+H} + crypto\+\_\+box\+\_\+\+M\+A\+C\+B\+Y\+T\+E\+S)
\item 
\#define \hyperlink{net__crypto_8c_a83b926a0be4d9d952b10a08998f9d705}{M\+A\+X\+\_\+\+D\+A\+T\+A\+\_\+\+D\+A\+T\+A\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+S\+I\+Z\+E}~(\hyperlink{net__crypto_8h_a4358ff1fe0068c79f791ac88674aea04}{M\+A\+X\+\_\+\+C\+R\+Y\+P\+T\+O\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+S\+I\+Z\+E} -\/ (1 + sizeof(uint16\+\_\+t) + crypto\+\_\+box\+\_\+\+M\+A\+C\+B\+Y\+T\+E\+S))
\item 
\#define \hyperlink{net__crypto_8c_aa28dae2bf4e9d1f19db5be07ea6aab1f}{D\+A\+T\+A\+\_\+\+N\+U\+M\+\_\+\+T\+H\+R\+E\+S\+H\+O\+L\+D}~21845
\item 
\#define \hyperlink{net__crypto_8c_a58c37109876b20009e566cf0857c1b4c}{C\+R\+Y\+P\+T\+O\+\_\+\+M\+I\+N\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+S\+I\+Z\+E}~(1 + sizeof(uint16\+\_\+t) + crypto\+\_\+box\+\_\+\+M\+A\+C\+B\+Y\+T\+E\+S)
\item 
\#define \hyperlink{net__crypto_8c_a6f21b0600be4cfb620ec7de106df2675}{P\+A\+C\+K\+E\+T\+\_\+\+C\+O\+U\+N\+T\+E\+R\+\_\+\+A\+V\+E\+R\+A\+G\+E\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L}~50
\item 
\#define \hyperlink{net__crypto_8c_a81678e56442d540709e358b402f015da}{R\+E\+Q\+U\+E\+S\+T\+\_\+\+P\+A\+C\+K\+E\+T\+S\+\_\+\+C\+O\+M\+P\+A\+R\+E\+\_\+\+C\+O\+N\+S\+T\+A\+N\+T}~(0.\+125 $\ast$ 100.\+0)
\item 
\#define \hyperlink{net__crypto_8c_a6a3b41060125fe2f17cc1c5818f52756}{P\+A\+C\+K\+E\+T\+\_\+\+R\+E\+S\+E\+N\+D\+\_\+\+M\+U\+L\+T\+I\+P\+L\+I\+E\+R}~3.\+5
\item 
\#define \hyperlink{net__crypto_8c_ab07fbb1d15443ad37bfa7c13af21be75}{C\+O\+N\+G\+E\+S\+T\+I\+O\+N\+\_\+\+E\+V\+E\+N\+T\+\_\+\+T\+I\+M\+E\+O\+U\+T}~2000
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
static uint8\+\_\+t \hyperlink{net__crypto_8c_a8aae93bf17f0b4a4305b88334e820310}{crypt\+\_\+connection\+\_\+id\+\_\+not\+\_\+valid} (const \hyperlink{struct_net___crypto}{Net\+\_\+\+Crypto} $\ast$c, int crypt\+\_\+connection\+\_\+id)
\item 
static int \hyperlink{net__crypto_8c_a5b67a38d23f1bbe5ff0ba96ea57520a4}{create\+\_\+cookie\+\_\+request} (const \hyperlink{struct_net___crypto}{Net\+\_\+\+Crypto} $\ast$c, uint8\+\_\+t $\ast$packet, uint8\+\_\+t $\ast$dht\+\_\+public\+\_\+key, uint64\+\_\+t number, uint8\+\_\+t $\ast$shared\+\_\+key)
\item 
static int \hyperlink{net__crypto_8c_ad630e2753f088cf9ccd45babe8719532}{create\+\_\+cookie} (uint8\+\_\+t $\ast$cookie, const uint8\+\_\+t $\ast$bytes, const uint8\+\_\+t $\ast$encryption\+\_\+key)
\item 
static int \hyperlink{net__crypto_8c_aadb69c5328b7e0958fb1ee1961ec2f5c}{open\+\_\+cookie} (uint8\+\_\+t $\ast$bytes, const uint8\+\_\+t $\ast$cookie, const uint8\+\_\+t $\ast$encryption\+\_\+key)
\item 
static int \hyperlink{net__crypto_8c_ab88b2226740cacde1112ee7fd13048d3}{create\+\_\+cookie\+\_\+response} (const \hyperlink{struct_net___crypto}{Net\+\_\+\+Crypto} $\ast$c, uint8\+\_\+t $\ast$packet, const uint8\+\_\+t $\ast$request\+\_\+plain, const uint8\+\_\+t $\ast$shared\+\_\+key, const uint8\+\_\+t $\ast$dht\+\_\+public\+\_\+key)
\item 
static int \hyperlink{net__crypto_8c_ae86cc5b9c02d6a9f61916e1ff1a1b768}{handle\+\_\+cookie\+\_\+request} (const \hyperlink{struct_net___crypto}{Net\+\_\+\+Crypto} $\ast$c, uint8\+\_\+t $\ast$request\+\_\+plain, uint8\+\_\+t $\ast$shared\+\_\+key, uint8\+\_\+t $\ast$dht\+\_\+public\+\_\+key, const uint8\+\_\+t $\ast$packet, uint16\+\_\+t length)
\item 
static int \hyperlink{net__crypto_8c_a04fc41a4cb0d904536626006f3b7d7dd}{udp\+\_\+handle\+\_\+cookie\+\_\+request} (void $\ast$object, \hyperlink{struct_i_p___port}{I\+P\+\_\+\+Port} source, const uint8\+\_\+t $\ast$packet, uint16\+\_\+t length)
\item 
static int \hyperlink{net__crypto_8c_a9308f183e47e29869d5562d03a01f88a}{tcp\+\_\+handle\+\_\+cookie\+\_\+request} (\hyperlink{struct_net___crypto}{Net\+\_\+\+Crypto} $\ast$c, int connections\+\_\+number, const uint8\+\_\+t $\ast$packet, uint16\+\_\+t length)
\item 
static int \hyperlink{net__crypto_8c_ae88369484d37b525d33c5c87c846606b}{tcp\+\_\+oob\+\_\+handle\+\_\+cookie\+\_\+request} (const \hyperlink{struct_net___crypto}{Net\+\_\+\+Crypto} $\ast$c, unsigned int tcp\+\_\+connections\+\_\+number, const uint8\+\_\+t $\ast$dht\+\_\+public\+\_\+key, const uint8\+\_\+t $\ast$packet, uint16\+\_\+t length)
\item 
static int \hyperlink{net__crypto_8c_a28d8190542201eb7f1e41fe4764a7d53}{handle\+\_\+cookie\+\_\+response} (uint8\+\_\+t $\ast$cookie, uint64\+\_\+t $\ast$number, const uint8\+\_\+t $\ast$packet, uint16\+\_\+t length, const uint8\+\_\+t $\ast$shared\+\_\+key)
\item 
static int \hyperlink{net__crypto_8c_a152a683d32712d0d91bfe1f4497c9485}{create\+\_\+crypto\+\_\+handshake} (const \hyperlink{struct_net___crypto}{Net\+\_\+\+Crypto} $\ast$c, uint8\+\_\+t $\ast$packet, const uint8\+\_\+t $\ast$cookie, const uint8\+\_\+t $\ast$\hyperlink{onion__test_8c_af73a4a6ff6a4878d8eae4ec38ffeaac2}{nonce}, const uint8\+\_\+t $\ast$session\+\_\+pk, const uint8\+\_\+t $\ast$peer\+\_\+real\+\_\+pk, const uint8\+\_\+t $\ast$peer\+\_\+dht\+\_\+pubkey)
\item 
static int \hyperlink{net__crypto_8c_a33f5ee072c7c7f92f2302e98f1697cea}{handle\+\_\+crypto\+\_\+handshake} (const \hyperlink{struct_net___crypto}{Net\+\_\+\+Crypto} $\ast$c, uint8\+\_\+t $\ast$\hyperlink{onion__test_8c_af73a4a6ff6a4878d8eae4ec38ffeaac2}{nonce}, uint8\+\_\+t $\ast$session\+\_\+pk, uint8\+\_\+t $\ast$peer\+\_\+real\+\_\+pk, uint8\+\_\+t $\ast$dht\+\_\+public\+\_\+key, uint8\+\_\+t $\ast$cookie, const uint8\+\_\+t $\ast$packet, uint16\+\_\+t length, const uint8\+\_\+t $\ast$expected\+\_\+real\+\_\+pk)
\item 
static \hyperlink{struct_crypto___connection}{Crypto\+\_\+\+Connection} $\ast$ \hyperlink{net__crypto_8c_a909daa4b6d420cbd028f2c956a8642db}{get\+\_\+crypto\+\_\+connection} (const \hyperlink{struct_net___crypto}{Net\+\_\+\+Crypto} $\ast$c, int crypt\+\_\+connection\+\_\+id)
\item 
static int \hyperlink{net__crypto_8c_a94d4c99b16cb7bd2dd61f9a7a8caf94a}{send\+\_\+packet\+\_\+to} (\hyperlink{struct_net___crypto}{Net\+\_\+\+Crypto} $\ast$c, int crypt\+\_\+connection\+\_\+id, const uint8\+\_\+t $\ast$data, uint16\+\_\+t length)
\item 
static uint32\+\_\+t \hyperlink{net__crypto_8c_abbe1101e6464100c19aea7cde5c1d3a0}{num\+\_\+packets\+\_\+array} (const \hyperlink{struct_packets___array}{Packets\+\_\+\+Array} $\ast$array)
\item 
static int \hyperlink{net__crypto_8c_a25e7d5165bf373d47b71dbb49e2e8c78}{add\+\_\+data\+\_\+to\+\_\+buffer} (\hyperlink{struct_packets___array}{Packets\+\_\+\+Array} $\ast$array, uint32\+\_\+t number, const \hyperlink{struct_packet___data}{Packet\+\_\+\+Data} $\ast$data)
\item 
static int \hyperlink{net__crypto_8c_a1e36bfc22078fc52c29d90e8ab79295d}{get\+\_\+data\+\_\+pointer} (const \hyperlink{struct_packets___array}{Packets\+\_\+\+Array} $\ast$array, \hyperlink{struct_packet___data}{Packet\+\_\+\+Data} $\ast$$\ast$data, uint32\+\_\+t number)
\item 
static int64\+\_\+t \hyperlink{net__crypto_8c_af55d3f30f6b07366883f01a8fa09d866}{add\+\_\+data\+\_\+end\+\_\+of\+\_\+buffer} (\hyperlink{struct_packets___array}{Packets\+\_\+\+Array} $\ast$array, const \hyperlink{struct_packet___data}{Packet\+\_\+\+Data} $\ast$data)
\item 
static int64\+\_\+t \hyperlink{net__crypto_8c_a8833802df3897cccb469cc3b86e097a7}{read\+\_\+data\+\_\+beg\+\_\+buffer} (\hyperlink{struct_packets___array}{Packets\+\_\+\+Array} $\ast$array, \hyperlink{struct_packet___data}{Packet\+\_\+\+Data} $\ast$data)
\item 
static int \hyperlink{net__crypto_8c_adb75f9c0e1a6f9ab1064cb17953011a3}{clear\+\_\+buffer\+\_\+until} (\hyperlink{struct_packets___array}{Packets\+\_\+\+Array} $\ast$array, uint32\+\_\+t number)
\item 
static int \hyperlink{net__crypto_8c_ae690bbce7d008eda1142ceaf0673e672}{clear\+\_\+buffer} (\hyperlink{struct_packets___array}{Packets\+\_\+\+Array} $\ast$array)
\item 
static int \hyperlink{net__crypto_8c_a065063595d40809cb6c5c2ccc09fdd74}{set\+\_\+buffer\+\_\+end} (\hyperlink{struct_packets___array}{Packets\+\_\+\+Array} $\ast$array, uint32\+\_\+t number)
\item 
static int \hyperlink{net__crypto_8c_ae4bed66c607b0d067e9b83dbf718d1f7}{generate\+\_\+request\+\_\+packet} (uint8\+\_\+t $\ast$data, uint16\+\_\+t length, const \hyperlink{struct_packets___array}{Packets\+\_\+\+Array} $\ast$recv\+\_\+array)
\item 
static int \hyperlink{net__crypto_8c_a4a6efacedb06b73ea8a0ce30b72b3d42}{handle\+\_\+request\+\_\+packet} (\hyperlink{struct_packets___array}{Packets\+\_\+\+Array} $\ast$send\+\_\+array, const uint8\+\_\+t $\ast$data, uint16\+\_\+t length, uint64\+\_\+t $\ast$latest\+\_\+send\+\_\+time, uint64\+\_\+t rtt\+\_\+time)
\item 
static int \hyperlink{net__crypto_8c_a507dd998c297ff5a666bd08121dd4143}{send\+\_\+data\+\_\+packet} (\hyperlink{struct_net___crypto}{Net\+\_\+\+Crypto} $\ast$c, int crypt\+\_\+connection\+\_\+id, const uint8\+\_\+t $\ast$data, uint16\+\_\+t length)
\item 
static int \hyperlink{net__crypto_8c_a572e703b36ffafdc4cf9dafd31a279d7}{send\+\_\+data\+\_\+packet\+\_\+helper} (\hyperlink{struct_net___crypto}{Net\+\_\+\+Crypto} $\ast$c, int crypt\+\_\+connection\+\_\+id, uint32\+\_\+t buffer\+\_\+start, uint32\+\_\+t \hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num}, const uint8\+\_\+t $\ast$data, uint16\+\_\+t length)
\item 
static int \hyperlink{net__crypto_8c_abb8a6ea2bdfb75eb366cc0a026649e2c}{reset\+\_\+max\+\_\+speed\+\_\+reached} (\hyperlink{struct_net___crypto}{Net\+\_\+\+Crypto} $\ast$c, int crypt\+\_\+connection\+\_\+id)
\item 
static int64\+\_\+t \hyperlink{net__crypto_8c_a06c8bdc27b9865d1b7d775b654f44d1a}{send\+\_\+lossless\+\_\+packet} (\hyperlink{struct_net___crypto}{Net\+\_\+\+Crypto} $\ast$c, int crypt\+\_\+connection\+\_\+id, const uint8\+\_\+t $\ast$data, uint16\+\_\+t length, uint8\+\_\+t congestion\+\_\+control)
\item 
static uint16\+\_\+t \hyperlink{net__crypto_8c_ad23e31b60004bf5f05899d3945530e6f}{get\+\_\+nonce\+\_\+uint16} (const uint8\+\_\+t $\ast$\hyperlink{onion__test_8c_af73a4a6ff6a4878d8eae4ec38ffeaac2}{nonce})
\item 
static int \hyperlink{net__crypto_8c_acb5cc4167df17fcc066c2c4be9704ad7}{handle\+\_\+data\+\_\+packet} (const \hyperlink{struct_net___crypto}{Net\+\_\+\+Crypto} $\ast$c, int crypt\+\_\+connection\+\_\+id, uint8\+\_\+t $\ast$data, const uint8\+\_\+t $\ast$packet, uint16\+\_\+t length)
\item 
static int \hyperlink{net__crypto_8c_a31370353b1f1c90c8fb06ae736be1a0d}{send\+\_\+request\+\_\+packet} (\hyperlink{struct_net___crypto}{Net\+\_\+\+Crypto} $\ast$c, int crypt\+\_\+connection\+\_\+id)
\item 
static int \hyperlink{net__crypto_8c_ac64daefe87866ea116735f3540be3092}{send\+\_\+requested\+\_\+packets} (\hyperlink{struct_net___crypto}{Net\+\_\+\+Crypto} $\ast$c, int crypt\+\_\+connection\+\_\+id, uint32\+\_\+t max\+\_\+num)
\item 
static int \hyperlink{net__crypto_8c_aa762d8aa84aa2c0a9cd48fa3d93856b1}{new\+\_\+temp\+\_\+packet} (const \hyperlink{struct_net___crypto}{Net\+\_\+\+Crypto} $\ast$c, int crypt\+\_\+connection\+\_\+id, const uint8\+\_\+t $\ast$packet, uint16\+\_\+t length)
\item 
static int \hyperlink{net__crypto_8c_a6e6c3107cf48ec1c5087d3780a03ad0c}{clear\+\_\+temp\+\_\+packet} (const \hyperlink{struct_net___crypto}{Net\+\_\+\+Crypto} $\ast$c, int crypt\+\_\+connection\+\_\+id)
\item 
static int \hyperlink{net__crypto_8c_ae0a00f5fe1955d7d15af11eacc20997b}{send\+\_\+temp\+\_\+packet} (\hyperlink{struct_net___crypto}{Net\+\_\+\+Crypto} $\ast$c, int crypt\+\_\+connection\+\_\+id)
\item 
static int \hyperlink{net__crypto_8c_ad2ca4aad15dc0607252aa21cd525b5ba}{create\+\_\+send\+\_\+handshake} (\hyperlink{struct_net___crypto}{Net\+\_\+\+Crypto} $\ast$c, int crypt\+\_\+connection\+\_\+id, const uint8\+\_\+t $\ast$cookie, const uint8\+\_\+t $\ast$dht\+\_\+public\+\_\+key)
\item 
static int \hyperlink{net__crypto_8c_aef6ea83ebc4f62428b09ee74441f6f4b}{send\+\_\+kill\+\_\+packet} (\hyperlink{struct_net___crypto}{Net\+\_\+\+Crypto} $\ast$c, int crypt\+\_\+connection\+\_\+id)
\item 
static void \hyperlink{net__crypto_8c_ac679d5f08189ac10b3eca22c3f032dbc}{connection\+\_\+kill} (\hyperlink{struct_net___crypto}{Net\+\_\+\+Crypto} $\ast$c, int crypt\+\_\+connection\+\_\+id)
\item 
static int \hyperlink{net__crypto_8c_a38debbf6310a8190eeafd33e42423f1a}{handle\+\_\+data\+\_\+packet\+\_\+helper} (\hyperlink{struct_net___crypto}{Net\+\_\+\+Crypto} $\ast$c, int crypt\+\_\+connection\+\_\+id, const uint8\+\_\+t $\ast$packet, uint16\+\_\+t length)
\item 
static int \hyperlink{net__crypto_8c_a04717fefa34f146623e7c95d5eef8caa}{handle\+\_\+packet\+\_\+connection} (\hyperlink{struct_net___crypto}{Net\+\_\+\+Crypto} $\ast$c, int crypt\+\_\+connection\+\_\+id, const uint8\+\_\+t $\ast$packet, uint16\+\_\+t length)
\item 
static int \hyperlink{net__crypto_8c_ab0b745274346dc3464e35fcd756db0d2}{realloc\+\_\+cryptoconnection} (\hyperlink{struct_net___crypto}{Net\+\_\+\+Crypto} $\ast$c, uint32\+\_\+t \hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num})
\item 
static int \hyperlink{net__crypto_8c_aed34560fc11f32d1b280d00152655b9b}{create\+\_\+crypto\+\_\+connection} (\hyperlink{struct_net___crypto}{Net\+\_\+\+Crypto} $\ast$c)
\item 
static int \hyperlink{net__crypto_8c_a7be52b4dc75558fc64e9e017ea67f1d0}{wipe\+\_\+crypto\+\_\+connection} (\hyperlink{struct_net___crypto}{Net\+\_\+\+Crypto} $\ast$c, int crypt\+\_\+connection\+\_\+id)
\item 
static int \hyperlink{net__crypto_8c_a2a46344fe22f21eea9d777b12918e257}{getcryptconnection\+\_\+id} (const \hyperlink{struct_net___crypto}{Net\+\_\+\+Crypto} $\ast$c, const uint8\+\_\+t $\ast$public\+\_\+key)
\item 
static int \hyperlink{net__crypto_8c_a9e779393ece10111b0ac7fe2bbc3beeb}{crypto\+\_\+connection\+\_\+add\+\_\+source} (\hyperlink{struct_net___crypto}{Net\+\_\+\+Crypto} $\ast$c, int crypt\+\_\+connection\+\_\+id, \hyperlink{struct_i_p___port}{I\+P\+\_\+\+Port} source)
\item 
void \hyperlink{net__crypto_8c_adaa8cd47d0ede85ca13626e91d2e995d}{new\+\_\+connection\+\_\+handler} (\hyperlink{struct_net___crypto}{Net\+\_\+\+Crypto} $\ast$c, int($\ast$new\+\_\+connection\+\_\+callback)(void $\ast$object, \hyperlink{struct_new___connection}{New\+\_\+\+Connection} $\ast$n\+\_\+c), void $\ast$object)
\item 
static int \hyperlink{net__crypto_8c_ae8139c35468806f25d5aed185edcc5a1}{handle\+\_\+new\+\_\+connection\+\_\+handshake} (\hyperlink{struct_net___crypto}{Net\+\_\+\+Crypto} $\ast$c, \hyperlink{struct_i_p___port}{I\+P\+\_\+\+Port} source, const uint8\+\_\+t $\ast$data, uint16\+\_\+t length)
\item 
int \hyperlink{net__crypto_8c_ab11f6e96035c3717a21b809d5373f96f}{accept\+\_\+crypto\+\_\+connection} (\hyperlink{struct_net___crypto}{Net\+\_\+\+Crypto} $\ast$c, \hyperlink{struct_new___connection}{New\+\_\+\+Connection} $\ast$n\+\_\+c)
\item 
int \hyperlink{net__crypto_8c_ae09413aa94644bc88bf73b88f48ef814}{new\+\_\+crypto\+\_\+connection} (\hyperlink{struct_net___crypto}{Net\+\_\+\+Crypto} $\ast$c, const uint8\+\_\+t $\ast$real\+\_\+public\+\_\+key, const uint8\+\_\+t $\ast$dht\+\_\+public\+\_\+key)
\item 
int \hyperlink{net__crypto_8c_a8ced4e168a95db5708bf4b3095cb4df6}{set\+\_\+direct\+\_\+ip\+\_\+port} (\hyperlink{struct_net___crypto}{Net\+\_\+\+Crypto} $\ast$c, int crypt\+\_\+connection\+\_\+id, \hyperlink{struct_i_p___port}{I\+P\+\_\+\+Port} ip\+\_\+port, \+\_\+\+Bool connected)
\item 
static int \hyperlink{net__crypto_8c_ab2eaad4448a5deca58a00316b522e380}{tcp\+\_\+data\+\_\+callback} (void $\ast$object, int id, const uint8\+\_\+t $\ast$data, uint16\+\_\+t length)
\item 
static int \hyperlink{net__crypto_8c_a86a3ff661a8b9b10fd7c0daee3901091}{tcp\+\_\+oob\+\_\+callback} (void $\ast$object, const uint8\+\_\+t $\ast$public\+\_\+key, unsigned int tcp\+\_\+connections\+\_\+number, const uint8\+\_\+t $\ast$data, uint16\+\_\+t length)
\item 
int \hyperlink{net__crypto_8c_a4b9f3aef7b0d4c461294e24a21e64e71}{add\+\_\+tcp\+\_\+relay\+\_\+peer} (\hyperlink{struct_net___crypto}{Net\+\_\+\+Crypto} $\ast$c, int crypt\+\_\+connection\+\_\+id, \hyperlink{struct_i_p___port}{I\+P\+\_\+\+Port} ip\+\_\+port, const uint8\+\_\+t $\ast$public\+\_\+key)
\item 
int \hyperlink{net__crypto_8c_a632021583d7dd2484614071a7080f311}{add\+\_\+tcp\+\_\+relay} (\hyperlink{struct_net___crypto}{Net\+\_\+\+Crypto} $\ast$c, \hyperlink{struct_i_p___port}{I\+P\+\_\+\+Port} ip\+\_\+port, const uint8\+\_\+t $\ast$public\+\_\+key)
\item 
int \hyperlink{net__crypto_8c_ad1a4103f75eb81ae93a0f1701b259db0}{get\+\_\+random\+\_\+tcp\+\_\+con\+\_\+number} (\hyperlink{struct_net___crypto}{Net\+\_\+\+Crypto} $\ast$c)
\item 
int \hyperlink{net__crypto_8c_ae25dcb51c019c3c59fd07da846bbe0df}{send\+\_\+tcp\+\_\+onion\+\_\+request} (\hyperlink{struct_net___crypto}{Net\+\_\+\+Crypto} $\ast$c, unsigned int tcp\+\_\+connections\+\_\+number, const uint8\+\_\+t $\ast$data, uint16\+\_\+t length)
\item 
unsigned int \hyperlink{net__crypto_8c_ac398e442ae77ace2af0156b9ce7f604c}{copy\+\_\+connected\+\_\+tcp\+\_\+relays} (\hyperlink{struct_net___crypto}{Net\+\_\+\+Crypto} $\ast$c, \hyperlink{struct_node__format}{Node\+\_\+format} $\ast$tcp\+\_\+relays, uint16\+\_\+t \hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num})
\item 
static void \hyperlink{net__crypto_8c_adf499e22f45244e3660f9da6de77d2a3}{do\+\_\+tcp} (\hyperlink{struct_net___crypto}{Net\+\_\+\+Crypto} $\ast$c)
\item 
int \hyperlink{net__crypto_8c_af159dc9120b9cd0675a865eabec03a73}{connection\+\_\+status\+\_\+handler} (const \hyperlink{struct_net___crypto}{Net\+\_\+\+Crypto} $\ast$c, int crypt\+\_\+connection\+\_\+id, int($\ast$connection\+\_\+status\+\_\+callback)(void $\ast$object, int id, uint8\+\_\+t status), void $\ast$object, int id)
\item 
int \hyperlink{net__crypto_8c_afdc8cda0f8580be3a59a4f315c042fb0}{connection\+\_\+data\+\_\+handler} (const \hyperlink{struct_net___crypto}{Net\+\_\+\+Crypto} $\ast$c, int crypt\+\_\+connection\+\_\+id, int($\ast$connection\+\_\+data\+\_\+callback)(void $\ast$object, int id, uint8\+\_\+t $\ast$data, uint16\+\_\+t length), void $\ast$object, int id)
\item 
int \hyperlink{net__crypto_8c_a8a587a287b13cce4271a272c71c2b788}{connection\+\_\+lossy\+\_\+data\+\_\+handler} (\hyperlink{struct_net___crypto}{Net\+\_\+\+Crypto} $\ast$c, int crypt\+\_\+connection\+\_\+id, int($\ast$connection\+\_\+lossy\+\_\+data\+\_\+callback)(void $\ast$object, int id, const uint8\+\_\+t $\ast$data, uint16\+\_\+t length), void $\ast$object, int id)
\item 
int \hyperlink{net__crypto_8c_a92ed6dc36b6e6996387b7542fc2580fa}{nc\+\_\+dht\+\_\+pk\+\_\+callback} (\hyperlink{struct_net___crypto}{Net\+\_\+\+Crypto} $\ast$c, int crypt\+\_\+connection\+\_\+id, void($\ast$function)(void $\ast$data, int32\+\_\+t number, const uint8\+\_\+t $\ast$dht\+\_\+public\+\_\+key), void $\ast$object, uint32\+\_\+t number)
\item 
static int \hyperlink{net__crypto_8c_ace680157da68eb91755350d0cb14cd8f}{crypto\+\_\+id\+\_\+ip\+\_\+port} (const \hyperlink{struct_net___crypto}{Net\+\_\+\+Crypto} $\ast$c, \hyperlink{struct_i_p___port}{I\+P\+\_\+\+Port} ip\+\_\+port)
\item 
static int \hyperlink{net__crypto_8c_a812ca8a7291e22ce343669c9835c7c12}{udp\+\_\+handle\+\_\+packet} (void $\ast$object, \hyperlink{struct_i_p___port}{I\+P\+\_\+\+Port} source, const uint8\+\_\+t $\ast$packet, uint16\+\_\+t length)
\item 
static void \hyperlink{net__crypto_8c_ad0fc252748fecbb499c4b01706476a77}{send\+\_\+crypto\+\_\+packets} (\hyperlink{struct_net___crypto}{Net\+\_\+\+Crypto} $\ast$c)
\item 
\+\_\+\+Bool \hyperlink{net__crypto_8c_ac2a5448ebee4fd4f8fd32cc7e3ac69c0}{max\+\_\+speed\+\_\+reached} (\hyperlink{struct_net___crypto}{Net\+\_\+\+Crypto} $\ast$c, int crypt\+\_\+connection\+\_\+id)
\item 
uint32\+\_\+t \hyperlink{net__crypto_8c_a4680603c9714e8742ad580b74ff1d891}{crypto\+\_\+num\+\_\+free\+\_\+sendqueue\+\_\+slots} (const \hyperlink{struct_net___crypto}{Net\+\_\+\+Crypto} $\ast$c, int crypt\+\_\+connection\+\_\+id)
\item 
int64\+\_\+t \hyperlink{net__crypto_8c_ab17ccce6d503f75b7d98be214ebd7621}{write\+\_\+cryptpacket} (\hyperlink{struct_net___crypto}{Net\+\_\+\+Crypto} $\ast$c, int crypt\+\_\+connection\+\_\+id, const uint8\+\_\+t $\ast$data, uint16\+\_\+t length, uint8\+\_\+t congestion\+\_\+control)
\item 
int \hyperlink{net__crypto_8c_a8ced352d973b7f835224854ef97f4407}{cryptpacket\+\_\+received} (\hyperlink{struct_net___crypto}{Net\+\_\+\+Crypto} $\ast$c, int crypt\+\_\+connection\+\_\+id, uint32\+\_\+t packet\+\_\+number)
\item 
int \hyperlink{net__crypto_8c_a7fcdf763c4a1b4b71e0de620b12f074c}{send\+\_\+lossy\+\_\+cryptpacket} (\hyperlink{struct_net___crypto}{Net\+\_\+\+Crypto} $\ast$c, int crypt\+\_\+connection\+\_\+id, const uint8\+\_\+t $\ast$data, uint16\+\_\+t length)
\item 
int \hyperlink{net__crypto_8c_a16c3a0008512675dad8eb00ff1822763}{crypto\+\_\+kill} (\hyperlink{struct_net___crypto}{Net\+\_\+\+Crypto} $\ast$c, int crypt\+\_\+connection\+\_\+id)
\item 
unsigned int \hyperlink{net__crypto_8c_afb5c59e6df7f38fe0bdf9e0f6c459869}{crypto\+\_\+connection\+\_\+status} (const \hyperlink{struct_net___crypto}{Net\+\_\+\+Crypto} $\ast$c, int crypt\+\_\+connection\+\_\+id, \+\_\+\+Bool $\ast$direct\+\_\+connected, unsigned int $\ast$online\+\_\+tcp\+\_\+relays)
\item 
void \hyperlink{net__crypto_8c_abcede595fdf06772b76f60792c82ed2b}{new\+\_\+keys} (\hyperlink{struct_net___crypto}{Net\+\_\+\+Crypto} $\ast$c)
\item 
void \hyperlink{net__crypto_8c_ae2f39ed236b85952fa913fdac1785671}{save\+\_\+keys} (const \hyperlink{struct_net___crypto}{Net\+\_\+\+Crypto} $\ast$c, uint8\+\_\+t $\ast$keys)
\item 
void \hyperlink{net__crypto_8c_ac8131842eafef1819a6e6da5404e3234}{load\+\_\+secret\+\_\+key} (\hyperlink{struct_net___crypto}{Net\+\_\+\+Crypto} $\ast$c, const uint8\+\_\+t $\ast$sk)
\item 
\hyperlink{struct_net___crypto}{Net\+\_\+\+Crypto} $\ast$ \hyperlink{net__crypto_8c_a5e46c6f42e93e2aa968f8f63de90a53c}{new\+\_\+net\+\_\+crypto} (\hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht, \hyperlink{struct_t_c_p___proxy___info}{T\+C\+P\+\_\+\+Proxy\+\_\+\+Info} $\ast$proxy\+\_\+info)
\item 
static void \hyperlink{net__crypto_8c_acb48e059ed89d52de983ac4c59fcde06}{kill\+\_\+timedout} (\hyperlink{struct_net___crypto}{Net\+\_\+\+Crypto} $\ast$c)
\item 
uint32\+\_\+t \hyperlink{net__crypto_8c_af0fcda7ce07347179ae4f327489c7643}{crypto\+\_\+run\+\_\+interval} (const \hyperlink{struct_net___crypto}{Net\+\_\+\+Crypto} $\ast$c)
\item 
void \hyperlink{net__crypto_8c_a6fa028eb320bf09ecd619c5053580436}{do\+\_\+net\+\_\+crypto} (\hyperlink{struct_net___crypto}{Net\+\_\+\+Crypto} $\ast$c)
\item 
void \hyperlink{net__crypto_8c_abb3546495adde3f08c0474f31c5d3a37}{kill\+\_\+net\+\_\+crypto} (\hyperlink{struct_net___crypto}{Net\+\_\+\+Crypto} $\ast$c)
\end{DoxyCompactItemize}


\subsection{Macro Definition Documentation}
\hypertarget{net__crypto_8c_ab07fbb1d15443ad37bfa7c13af21be75}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!C\+O\+N\+G\+E\+S\+T\+I\+O\+N\+\_\+\+E\+V\+E\+N\+T\+\_\+\+T\+I\+M\+E\+O\+U\+T@{C\+O\+N\+G\+E\+S\+T\+I\+O\+N\+\_\+\+E\+V\+E\+N\+T\+\_\+\+T\+I\+M\+E\+O\+U\+T}}
\index{C\+O\+N\+G\+E\+S\+T\+I\+O\+N\+\_\+\+E\+V\+E\+N\+T\+\_\+\+T\+I\+M\+E\+O\+U\+T@{C\+O\+N\+G\+E\+S\+T\+I\+O\+N\+\_\+\+E\+V\+E\+N\+T\+\_\+\+T\+I\+M\+E\+O\+U\+T}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{C\+O\+N\+G\+E\+S\+T\+I\+O\+N\+\_\+\+E\+V\+E\+N\+T\+\_\+\+T\+I\+M\+E\+O\+U\+T}]{\setlength{\rightskip}{0pt plus 5cm}\#define C\+O\+N\+G\+E\+S\+T\+I\+O\+N\+\_\+\+E\+V\+E\+N\+T\+\_\+\+T\+I\+M\+E\+O\+U\+T~2000}}\label{net__crypto_8c_ab07fbb1d15443ad37bfa7c13af21be75}


Definition at line 2040 of file net\+\_\+crypto.\+c.



Referenced by send\+\_\+crypto\+\_\+packets().

\hypertarget{net__crypto_8c_a35fd5a283cae1c0954d99c778ac9ad27}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!C\+O\+O\+K\+I\+E\+\_\+\+C\+O\+N\+T\+E\+N\+T\+S\+\_\+\+L\+E\+N\+G\+T\+H@{C\+O\+O\+K\+I\+E\+\_\+\+C\+O\+N\+T\+E\+N\+T\+S\+\_\+\+L\+E\+N\+G\+T\+H}}
\index{C\+O\+O\+K\+I\+E\+\_\+\+C\+O\+N\+T\+E\+N\+T\+S\+\_\+\+L\+E\+N\+G\+T\+H@{C\+O\+O\+K\+I\+E\+\_\+\+C\+O\+N\+T\+E\+N\+T\+S\+\_\+\+L\+E\+N\+G\+T\+H}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{C\+O\+O\+K\+I\+E\+\_\+\+C\+O\+N\+T\+E\+N\+T\+S\+\_\+\+L\+E\+N\+G\+T\+H}]{\setlength{\rightskip}{0pt plus 5cm}\#define C\+O\+O\+K\+I\+E\+\_\+\+C\+O\+N\+T\+E\+N\+T\+S\+\_\+\+L\+E\+N\+G\+T\+H~(sizeof(uint64\+\_\+t) + {\bf C\+O\+O\+K\+I\+E\+\_\+\+D\+A\+T\+A\+\_\+\+L\+E\+N\+G\+T\+H})}}\label{net__crypto_8c_a35fd5a283cae1c0954d99c778ac9ad27}


Definition at line 52 of file net\+\_\+crypto.\+c.



Referenced by create\+\_\+cookie(), and open\+\_\+cookie().

\hypertarget{net__crypto_8c_ada1ab442f8ac484c80c15260ab737cab}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!C\+O\+O\+K\+I\+E\+\_\+\+D\+A\+T\+A\+\_\+\+L\+E\+N\+G\+T\+H@{C\+O\+O\+K\+I\+E\+\_\+\+D\+A\+T\+A\+\_\+\+L\+E\+N\+G\+T\+H}}
\index{C\+O\+O\+K\+I\+E\+\_\+\+D\+A\+T\+A\+\_\+\+L\+E\+N\+G\+T\+H@{C\+O\+O\+K\+I\+E\+\_\+\+D\+A\+T\+A\+\_\+\+L\+E\+N\+G\+T\+H}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{C\+O\+O\+K\+I\+E\+\_\+\+D\+A\+T\+A\+\_\+\+L\+E\+N\+G\+T\+H}]{\setlength{\rightskip}{0pt plus 5cm}\#define C\+O\+O\+K\+I\+E\+\_\+\+D\+A\+T\+A\+\_\+\+L\+E\+N\+G\+T\+H~(crypto\+\_\+box\+\_\+\+P\+U\+B\+L\+I\+C\+K\+E\+Y\+B\+Y\+T\+E\+S $\ast$ 2)}}\label{net__crypto_8c_ada1ab442f8ac484c80c15260ab737cab}


Definition at line 51 of file net\+\_\+crypto.\+c.



Referenced by create\+\_\+cookie(), create\+\_\+cookie\+\_\+response(), create\+\_\+crypto\+\_\+handshake(), handle\+\_\+crypto\+\_\+handshake(), and open\+\_\+cookie().

\hypertarget{net__crypto_8c_a905c0a7642c878ca482e2d7aff7d670c}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!C\+O\+O\+K\+I\+E\+\_\+\+L\+E\+N\+G\+T\+H@{C\+O\+O\+K\+I\+E\+\_\+\+L\+E\+N\+G\+T\+H}}
\index{C\+O\+O\+K\+I\+E\+\_\+\+L\+E\+N\+G\+T\+H@{C\+O\+O\+K\+I\+E\+\_\+\+L\+E\+N\+G\+T\+H}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{C\+O\+O\+K\+I\+E\+\_\+\+L\+E\+N\+G\+T\+H}]{\setlength{\rightskip}{0pt plus 5cm}\#define C\+O\+O\+K\+I\+E\+\_\+\+L\+E\+N\+G\+T\+H~(crypto\+\_\+box\+\_\+\+N\+O\+N\+C\+E\+B\+Y\+T\+E\+S + {\bf C\+O\+O\+K\+I\+E\+\_\+\+C\+O\+N\+T\+E\+N\+T\+S\+\_\+\+L\+E\+N\+G\+T\+H} + crypto\+\_\+box\+\_\+\+M\+A\+C\+B\+Y\+T\+E\+S)}}\label{net__crypto_8c_a905c0a7642c878ca482e2d7aff7d670c}


Definition at line 53 of file net\+\_\+crypto.\+c.



Referenced by accept\+\_\+crypto\+\_\+connection(), create\+\_\+cookie(), create\+\_\+cookie\+\_\+response(), create\+\_\+crypto\+\_\+handshake(), handle\+\_\+cookie\+\_\+response(), handle\+\_\+crypto\+\_\+handshake(), handle\+\_\+new\+\_\+connection\+\_\+handshake(), handle\+\_\+packet\+\_\+connection(), and open\+\_\+cookie().

\hypertarget{net__crypto_8c_a25d19522f8fdd8da8932746bcf11e8aa}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!C\+O\+O\+K\+I\+E\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+L\+E\+N\+G\+T\+H@{C\+O\+O\+K\+I\+E\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+L\+E\+N\+G\+T\+H}}
\index{C\+O\+O\+K\+I\+E\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+L\+E\+N\+G\+T\+H@{C\+O\+O\+K\+I\+E\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+L\+E\+N\+G\+T\+H}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{C\+O\+O\+K\+I\+E\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+L\+E\+N\+G\+T\+H}]{\setlength{\rightskip}{0pt plus 5cm}\#define C\+O\+O\+K\+I\+E\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+L\+E\+N\+G\+T\+H~(1 + crypto\+\_\+box\+\_\+\+P\+U\+B\+L\+I\+C\+K\+E\+Y\+B\+Y\+T\+E\+S + crypto\+\_\+box\+\_\+\+N\+O\+N\+C\+E\+B\+Y\+T\+E\+S + {\bf C\+O\+O\+K\+I\+E\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+P\+L\+A\+I\+N\+\_\+\+L\+E\+N\+G\+T\+H} + crypto\+\_\+box\+\_\+\+M\+A\+C\+B\+Y\+T\+E\+S)}}\label{net__crypto_8c_a25d19522f8fdd8da8932746bcf11e8aa}


Definition at line 56 of file net\+\_\+crypto.\+c.



Referenced by handle\+\_\+cookie\+\_\+request(), and new\+\_\+crypto\+\_\+connection().

\hypertarget{net__crypto_8c_a09bc1e1952ce2d46d01925227c1c34d1}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!C\+O\+O\+K\+I\+E\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+P\+L\+A\+I\+N\+\_\+\+L\+E\+N\+G\+T\+H@{C\+O\+O\+K\+I\+E\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+P\+L\+A\+I\+N\+\_\+\+L\+E\+N\+G\+T\+H}}
\index{C\+O\+O\+K\+I\+E\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+P\+L\+A\+I\+N\+\_\+\+L\+E\+N\+G\+T\+H@{C\+O\+O\+K\+I\+E\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+P\+L\+A\+I\+N\+\_\+\+L\+E\+N\+G\+T\+H}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{C\+O\+O\+K\+I\+E\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+P\+L\+A\+I\+N\+\_\+\+L\+E\+N\+G\+T\+H}]{\setlength{\rightskip}{0pt plus 5cm}\#define C\+O\+O\+K\+I\+E\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+P\+L\+A\+I\+N\+\_\+\+L\+E\+N\+G\+T\+H~({\bf C\+O\+O\+K\+I\+E\+\_\+\+D\+A\+T\+A\+\_\+\+L\+E\+N\+G\+T\+H} + sizeof(uint64\+\_\+t))}}\label{net__crypto_8c_a09bc1e1952ce2d46d01925227c1c34d1}


Definition at line 55 of file net\+\_\+crypto.\+c.



Referenced by create\+\_\+cookie\+\_\+request(), handle\+\_\+cookie\+\_\+request(), tcp\+\_\+handle\+\_\+cookie\+\_\+request(), tcp\+\_\+oob\+\_\+handle\+\_\+cookie\+\_\+request(), and udp\+\_\+handle\+\_\+cookie\+\_\+request().

\hypertarget{net__crypto_8c_a145d90f988058f15e869e94884d7f614}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!C\+O\+O\+K\+I\+E\+\_\+\+R\+E\+S\+P\+O\+N\+S\+E\+\_\+\+L\+E\+N\+G\+T\+H@{C\+O\+O\+K\+I\+E\+\_\+\+R\+E\+S\+P\+O\+N\+S\+E\+\_\+\+L\+E\+N\+G\+T\+H}}
\index{C\+O\+O\+K\+I\+E\+\_\+\+R\+E\+S\+P\+O\+N\+S\+E\+\_\+\+L\+E\+N\+G\+T\+H@{C\+O\+O\+K\+I\+E\+\_\+\+R\+E\+S\+P\+O\+N\+S\+E\+\_\+\+L\+E\+N\+G\+T\+H}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{C\+O\+O\+K\+I\+E\+\_\+\+R\+E\+S\+P\+O\+N\+S\+E\+\_\+\+L\+E\+N\+G\+T\+H}]{\setlength{\rightskip}{0pt plus 5cm}\#define C\+O\+O\+K\+I\+E\+\_\+\+R\+E\+S\+P\+O\+N\+S\+E\+\_\+\+L\+E\+N\+G\+T\+H~(1 + crypto\+\_\+box\+\_\+\+N\+O\+N\+C\+E\+B\+Y\+T\+E\+S + {\bf C\+O\+O\+K\+I\+E\+\_\+\+L\+E\+N\+G\+T\+H} + sizeof(uint64\+\_\+t) + crypto\+\_\+box\+\_\+\+M\+A\+C\+B\+Y\+T\+E\+S)}}\label{net__crypto_8c_a145d90f988058f15e869e94884d7f614}


Definition at line 57 of file net\+\_\+crypto.\+c.



Referenced by create\+\_\+cookie\+\_\+response(), handle\+\_\+cookie\+\_\+response(), tcp\+\_\+handle\+\_\+cookie\+\_\+request(), tcp\+\_\+oob\+\_\+handle\+\_\+cookie\+\_\+request(), and udp\+\_\+handle\+\_\+cookie\+\_\+request().

\hypertarget{net__crypto_8c_adba18a4b236aff118053b3b614499cad}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!C\+O\+O\+K\+I\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T@{C\+O\+O\+K\+I\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T}}
\index{C\+O\+O\+K\+I\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T@{C\+O\+O\+K\+I\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{C\+O\+O\+K\+I\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T}]{\setlength{\rightskip}{0pt plus 5cm}\#define C\+O\+O\+K\+I\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T~15}}\label{net__crypto_8c_adba18a4b236aff118053b3b614499cad}


Definition at line 50 of file net\+\_\+crypto.\+c.



Referenced by open\+\_\+cookie().

\hypertarget{net__crypto_8c_a58c37109876b20009e566cf0857c1b4c}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!C\+R\+Y\+P\+T\+O\+\_\+\+M\+I\+N\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+S\+I\+Z\+E@{C\+R\+Y\+P\+T\+O\+\_\+\+M\+I\+N\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+S\+I\+Z\+E}}
\index{C\+R\+Y\+P\+T\+O\+\_\+\+M\+I\+N\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+S\+I\+Z\+E@{C\+R\+Y\+P\+T\+O\+\_\+\+M\+I\+N\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+S\+I\+Z\+E}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{C\+R\+Y\+P\+T\+O\+\_\+\+M\+I\+N\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+S\+I\+Z\+E}]{\setlength{\rightskip}{0pt plus 5cm}\#define C\+R\+Y\+P\+T\+O\+\_\+\+M\+I\+N\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+S\+I\+Z\+E~(1 + sizeof(uint16\+\_\+t) + crypto\+\_\+box\+\_\+\+M\+A\+C\+B\+Y\+T\+E\+S)}}\label{net__crypto_8c_a58c37109876b20009e566cf0857c1b4c}


Definition at line 1985 of file net\+\_\+crypto.\+c.

\hypertarget{net__crypto_8c_aa28dae2bf4e9d1f19db5be07ea6aab1f}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!D\+A\+T\+A\+\_\+\+N\+U\+M\+\_\+\+T\+H\+R\+E\+S\+H\+O\+L\+D@{D\+A\+T\+A\+\_\+\+N\+U\+M\+\_\+\+T\+H\+R\+E\+S\+H\+O\+L\+D}}
\index{D\+A\+T\+A\+\_\+\+N\+U\+M\+\_\+\+T\+H\+R\+E\+S\+H\+O\+L\+D@{D\+A\+T\+A\+\_\+\+N\+U\+M\+\_\+\+T\+H\+R\+E\+S\+H\+O\+L\+D}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{D\+A\+T\+A\+\_\+\+N\+U\+M\+\_\+\+T\+H\+R\+E\+S\+H\+O\+L\+D}]{\setlength{\rightskip}{0pt plus 5cm}\#define D\+A\+T\+A\+\_\+\+N\+U\+M\+\_\+\+T\+H\+R\+E\+S\+H\+O\+L\+D~21845}}\label{net__crypto_8c_aa28dae2bf4e9d1f19db5be07ea6aab1f}


Definition at line 888 of file net\+\_\+crypto.\+c.



Referenced by handle\+\_\+data\+\_\+packet().

\hypertarget{net__crypto_8c_aae5268846bab0f3dcfe6071d0442d89e}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!H\+A\+N\+D\+S\+H\+A\+K\+E\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+L\+E\+N\+G\+T\+H@{H\+A\+N\+D\+S\+H\+A\+K\+E\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+L\+E\+N\+G\+T\+H}}
\index{H\+A\+N\+D\+S\+H\+A\+K\+E\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+L\+E\+N\+G\+T\+H@{H\+A\+N\+D\+S\+H\+A\+K\+E\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+L\+E\+N\+G\+T\+H}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{H\+A\+N\+D\+S\+H\+A\+K\+E\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+L\+E\+N\+G\+T\+H}]{\setlength{\rightskip}{0pt plus 5cm}\#define H\+A\+N\+D\+S\+H\+A\+K\+E\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+L\+E\+N\+G\+T\+H~(1 + {\bf C\+O\+O\+K\+I\+E\+\_\+\+L\+E\+N\+G\+T\+H} + crypto\+\_\+box\+\_\+\+N\+O\+N\+C\+E\+B\+Y\+T\+E\+S + crypto\+\_\+box\+\_\+\+N\+O\+N\+C\+E\+B\+Y\+T\+E\+S + crypto\+\_\+box\+\_\+\+P\+U\+B\+L\+I\+C\+K\+E\+Y\+B\+Y\+T\+E\+S + crypto\+\_\+hash\+\_\+sha512\+\_\+\+B\+Y\+T\+E\+S + {\bf C\+O\+O\+K\+I\+E\+\_\+\+L\+E\+N\+G\+T\+H} + crypto\+\_\+box\+\_\+\+M\+A\+C\+B\+Y\+T\+E\+S)}}\label{net__crypto_8c_aae5268846bab0f3dcfe6071d0442d89e}


Definition at line 285 of file net\+\_\+crypto.\+c.



Referenced by create\+\_\+crypto\+\_\+handshake(), create\+\_\+send\+\_\+handshake(), and handle\+\_\+crypto\+\_\+handshake().

\hypertarget{net__crypto_8c_a83b926a0be4d9d952b10a08998f9d705}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!M\+A\+X\+\_\+\+D\+A\+T\+A\+\_\+\+D\+A\+T\+A\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+S\+I\+Z\+E@{M\+A\+X\+\_\+\+D\+A\+T\+A\+\_\+\+D\+A\+T\+A\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+S\+I\+Z\+E}}
\index{M\+A\+X\+\_\+\+D\+A\+T\+A\+\_\+\+D\+A\+T\+A\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+S\+I\+Z\+E@{M\+A\+X\+\_\+\+D\+A\+T\+A\+\_\+\+D\+A\+T\+A\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+S\+I\+Z\+E}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{M\+A\+X\+\_\+\+D\+A\+T\+A\+\_\+\+D\+A\+T\+A\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+S\+I\+Z\+E}]{\setlength{\rightskip}{0pt plus 5cm}\#define M\+A\+X\+\_\+\+D\+A\+T\+A\+\_\+\+D\+A\+T\+A\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+S\+I\+Z\+E~({\bf M\+A\+X\+\_\+\+C\+R\+Y\+P\+T\+O\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+S\+I\+Z\+E} -\/ (1 + sizeof(uint16\+\_\+t) + crypto\+\_\+box\+\_\+\+M\+A\+C\+B\+Y\+T\+E\+S))}}\label{net__crypto_8c_a83b926a0be4d9d952b10a08998f9d705}
E\+N\+D\+: Array Related functions 

Definition at line 734 of file net\+\_\+crypto.\+c.



Referenced by handle\+\_\+data\+\_\+packet\+\_\+helper().

\hypertarget{net__crypto_8c_a6f21b0600be4cfb620ec7de106df2675}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!P\+A\+C\+K\+E\+T\+\_\+\+C\+O\+U\+N\+T\+E\+R\+\_\+\+A\+V\+E\+R\+A\+G\+E\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L@{P\+A\+C\+K\+E\+T\+\_\+\+C\+O\+U\+N\+T\+E\+R\+\_\+\+A\+V\+E\+R\+A\+G\+E\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L}}
\index{P\+A\+C\+K\+E\+T\+\_\+\+C\+O\+U\+N\+T\+E\+R\+\_\+\+A\+V\+E\+R\+A\+G\+E\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L@{P\+A\+C\+K\+E\+T\+\_\+\+C\+O\+U\+N\+T\+E\+R\+\_\+\+A\+V\+E\+R\+A\+G\+E\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{P\+A\+C\+K\+E\+T\+\_\+\+C\+O\+U\+N\+T\+E\+R\+\_\+\+A\+V\+E\+R\+A\+G\+E\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\+A\+C\+K\+E\+T\+\_\+\+C\+O\+U\+N\+T\+E\+R\+\_\+\+A\+V\+E\+R\+A\+G\+E\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L~50}}\label{net__crypto_8c_a6f21b0600be4cfb620ec7de106df2675}


Definition at line 2029 of file net\+\_\+crypto.\+c.



Referenced by send\+\_\+crypto\+\_\+packets().

\hypertarget{net__crypto_8c_a6a3b41060125fe2f17cc1c5818f52756}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!P\+A\+C\+K\+E\+T\+\_\+\+R\+E\+S\+E\+N\+D\+\_\+\+M\+U\+L\+T\+I\+P\+L\+I\+E\+R@{P\+A\+C\+K\+E\+T\+\_\+\+R\+E\+S\+E\+N\+D\+\_\+\+M\+U\+L\+T\+I\+P\+L\+I\+E\+R}}
\index{P\+A\+C\+K\+E\+T\+\_\+\+R\+E\+S\+E\+N\+D\+\_\+\+M\+U\+L\+T\+I\+P\+L\+I\+E\+R@{P\+A\+C\+K\+E\+T\+\_\+\+R\+E\+S\+E\+N\+D\+\_\+\+M\+U\+L\+T\+I\+P\+L\+I\+E\+R}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{P\+A\+C\+K\+E\+T\+\_\+\+R\+E\+S\+E\+N\+D\+\_\+\+M\+U\+L\+T\+I\+P\+L\+I\+E\+R}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\+A\+C\+K\+E\+T\+\_\+\+R\+E\+S\+E\+N\+D\+\_\+\+M\+U\+L\+T\+I\+P\+L\+I\+E\+R~3.\+5}}\label{net__crypto_8c_a6a3b41060125fe2f17cc1c5818f52756}


Definition at line 2037 of file net\+\_\+crypto.\+c.



Referenced by send\+\_\+crypto\+\_\+packets().

\hypertarget{net__crypto_8c_a81678e56442d540709e358b402f015da}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!R\+E\+Q\+U\+E\+S\+T\+\_\+\+P\+A\+C\+K\+E\+T\+S\+\_\+\+C\+O\+M\+P\+A\+R\+E\+\_\+\+C\+O\+N\+S\+T\+A\+N\+T@{R\+E\+Q\+U\+E\+S\+T\+\_\+\+P\+A\+C\+K\+E\+T\+S\+\_\+\+C\+O\+M\+P\+A\+R\+E\+\_\+\+C\+O\+N\+S\+T\+A\+N\+T}}
\index{R\+E\+Q\+U\+E\+S\+T\+\_\+\+P\+A\+C\+K\+E\+T\+S\+\_\+\+C\+O\+M\+P\+A\+R\+E\+\_\+\+C\+O\+N\+S\+T\+A\+N\+T@{R\+E\+Q\+U\+E\+S\+T\+\_\+\+P\+A\+C\+K\+E\+T\+S\+\_\+\+C\+O\+M\+P\+A\+R\+E\+\_\+\+C\+O\+N\+S\+T\+A\+N\+T}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{R\+E\+Q\+U\+E\+S\+T\+\_\+\+P\+A\+C\+K\+E\+T\+S\+\_\+\+C\+O\+M\+P\+A\+R\+E\+\_\+\+C\+O\+N\+S\+T\+A\+N\+T}]{\setlength{\rightskip}{0pt plus 5cm}\#define R\+E\+Q\+U\+E\+S\+T\+\_\+\+P\+A\+C\+K\+E\+T\+S\+\_\+\+C\+O\+M\+P\+A\+R\+E\+\_\+\+C\+O\+N\+S\+T\+A\+N\+T~(0.\+125 $\ast$ 100.\+0)}}\label{net__crypto_8c_a81678e56442d540709e358b402f015da}


Definition at line 2034 of file net\+\_\+crypto.\+c.



Referenced by send\+\_\+crypto\+\_\+packets().



\subsection{Function Documentation}
\hypertarget{net__crypto_8c_ab11f6e96035c3717a21b809d5373f96f}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!accept\+\_\+crypto\+\_\+connection@{accept\+\_\+crypto\+\_\+connection}}
\index{accept\+\_\+crypto\+\_\+connection@{accept\+\_\+crypto\+\_\+connection}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{accept\+\_\+crypto\+\_\+connection}]{\setlength{\rightskip}{0pt plus 5cm}int accept\+\_\+crypto\+\_\+connection (
\begin{DoxyParamCaption}
\item[{{\bf Net\+\_\+\+Crypto} $\ast$}]{c, }
\item[{{\bf New\+\_\+\+Connection} $\ast$}]{n\+\_\+c}
\end{DoxyParamCaption}
)}}\label{net__crypto_8c_ab11f6e96035c3717a21b809d5373f96f}


Definition at line 1570 of file net\+\_\+crypto.\+c.



References Crypto\+\_\+\+Connection\+::connection\+\_\+number\+\_\+tcp, New\+\_\+\+Connection\+::cookie, C\+O\+O\+K\+I\+E\+\_\+\+L\+E\+N\+G\+T\+H, New\+\_\+\+Connection\+::cookie\+\_\+length, create\+\_\+crypto\+\_\+connection(), create\+\_\+send\+\_\+handshake(), C\+R\+Y\+P\+T\+O\+\_\+\+C\+O\+N\+N\+\_\+\+N\+O\+\_\+\+C\+O\+N\+N\+E\+C\+T\+I\+O\+N, C\+R\+Y\+P\+T\+O\+\_\+\+C\+O\+N\+N\+\_\+\+N\+O\+T\+\_\+\+C\+O\+N\+F\+I\+R\+M\+E\+D, crypto\+\_\+connection\+\_\+add\+\_\+source(), Net\+\_\+\+Crypto\+::crypto\+\_\+connections, C\+R\+Y\+P\+T\+O\+\_\+\+M\+I\+N\+\_\+\+Q\+U\+E\+U\+E\+\_\+\+L\+E\+N\+G\+T\+H, C\+R\+Y\+P\+T\+O\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+M\+I\+N\+\_\+\+R\+A\+T\+E, D\+E\+F\+A\+U\+L\+T\+\_\+\+P\+I\+N\+G\+\_\+\+C\+O\+N\+N\+E\+C\+T\+I\+O\+N, Crypto\+\_\+\+Connection\+::dht\+\_\+public\+\_\+key, New\+\_\+\+Connection\+::dht\+\_\+public\+\_\+key, encrypt\+\_\+precompute(), getcryptconnection\+\_\+id(), kill\+\_\+tcp\+\_\+connection\+\_\+to(), new\+\_\+tcp\+\_\+connection\+\_\+to(), Crypto\+\_\+\+Connection\+::packet\+\_\+send\+\_\+rate, Crypto\+\_\+\+Connection\+::packets\+\_\+left, Crypto\+\_\+\+Connection\+::peersessionpublic\+\_\+key, New\+\_\+\+Connection\+::peersessionpublic\+\_\+key, Crypto\+\_\+\+Connection\+::public\+\_\+key, New\+\_\+\+Connection\+::public\+\_\+key, random\+\_\+nonce(), Crypto\+\_\+\+Connection\+::recv\+\_\+nonce, New\+\_\+\+Connection\+::recv\+\_\+nonce, Crypto\+\_\+\+Connection\+::rtt\+\_\+time, Crypto\+\_\+\+Connection\+::sent\+\_\+nonce, Crypto\+\_\+\+Connection\+::sessionpublic\+\_\+key, Crypto\+\_\+\+Connection\+::sessionsecret\+\_\+key, Crypto\+\_\+\+Connection\+::shared\+\_\+key, New\+\_\+\+Connection\+::source, Crypto\+\_\+\+Connection\+::status, Net\+\_\+\+Crypto\+::tcp\+\_\+c, and Net\+\_\+\+Crypto\+::tcp\+\_\+mutex.



Referenced by handle\+\_\+new\+\_\+connections().


\begin{DoxyCode}
1571 \{
1572     \textcolor{keywordflow}{if} (\hyperlink{net__crypto_8c_a2a46344fe22f21eea9d777b12918e257}{getcryptconnection\_id}(c, n\_c->\hyperlink{struct_new___connection_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}) != -1)
1573         \textcolor{keywordflow}{return} -1;
1574 
1575     \textcolor{keywordtype}{int} crypt\_connection\_id = \hyperlink{net__crypto_8c_aed34560fc11f32d1b280d00152655b9b}{create\_crypto\_connection}(c);
1576 
1577     \textcolor{keywordflow}{if} (crypt\_connection\_id == -1)
1578         \textcolor{keywordflow}{return} -1;
1579 
1580     \hyperlink{struct_crypto___connection}{Crypto\_Connection} *conn = &c->\hyperlink{struct_net___crypto_a13fdc865b8a114466ba136f5390ec1b2}{crypto\_connections}[crypt\_connection\_id
      ];
1581 
1582     \textcolor{keywordflow}{if} (n\_c->\hyperlink{struct_new___connection_a801672aeddedd60f76a667a2275a95ce}{cookie\_length} != \hyperlink{net__crypto_8c_a905c0a7642c878ca482e2d7aff7d670c}{COOKIE\_LENGTH})
1583         \textcolor{keywordflow}{return} -1;
1584 
1585     pthread\_mutex\_lock(&c->\hyperlink{struct_net___crypto_a2e8f7f4dff2f2fc4ac2cc32b0c886974}{tcp\_mutex});
1586     \textcolor{keywordtype}{int} connection\_number\_tcp = \hyperlink{_t_c_p__connection_8c_a22c797c7e0ef3ad66e171f05b1cb52bd}{new\_tcp\_connection\_to}(c->
      \hyperlink{struct_net___crypto_a179982a02be89eaf6617ed81bd3c0961}{tcp\_c}, n\_c->\hyperlink{struct_new___connection_ab2ecaa07625ad0ed5e07d3a1f0dcc939}{dht\_public\_key}, crypt\_connection\_id);
1587     pthread\_mutex\_unlock(&c->\hyperlink{struct_net___crypto_a2e8f7f4dff2f2fc4ac2cc32b0c886974}{tcp\_mutex});
1588 
1589     \textcolor{keywordflow}{if} (connection\_number\_tcp == -1)
1590         \textcolor{keywordflow}{return} -1;
1591 
1592     conn->\hyperlink{struct_crypto___connection_a51666aaba0fc5680040fe5bd6778bc50}{connection\_number\_tcp} = connection\_number\_tcp;
1593     memcpy(conn->\hyperlink{struct_crypto___connection_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, n\_c->\hyperlink{struct_new___connection_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, crypto\_box\_PUBLICKEYBYTES);
1594     memcpy(conn->\hyperlink{struct_crypto___connection_aae0467706f97aa3ef23e5dc9c3c199d7}{recv\_nonce}, n\_c->\hyperlink{struct_new___connection_aae0467706f97aa3ef23e5dc9c3c199d7}{recv\_nonce}, crypto\_box\_NONCEBYTES);
1595     memcpy(conn->\hyperlink{struct_crypto___connection_ac040d4ba2a22ee327952009e7396bb2f}{peersessionpublic\_key}, n\_c->
      \hyperlink{struct_new___connection_ac040d4ba2a22ee327952009e7396bb2f}{peersessionpublic\_key}, crypto\_box\_PUBLICKEYBYTES);
1596     \hyperlink{crypto__core_8c_a15ef255ab026d4881a16b99148b05dd7}{random\_nonce}(conn->\hyperlink{struct_crypto___connection_a9df0e00e8f493ed6cd1ff45e7da33c0d}{sent\_nonce});
1597     crypto\_box\_keypair(conn->\hyperlink{struct_crypto___connection_a6e74fbae398c7966800ee80f7b93dbfa}{sessionpublic\_key}, conn->
      \hyperlink{struct_crypto___connection_a5f38fc9ff1b20b61ffbb56d9e7f5c892}{sessionsecret\_key});
1598     \hyperlink{crypto__core_8c_a0d8eaef49981c5dc3ada078866b42f6d}{encrypt\_precompute}(conn->\hyperlink{struct_crypto___connection_ac040d4ba2a22ee327952009e7396bb2f}{peersessionpublic\_key}, conn->
      \hyperlink{struct_crypto___connection_a5f38fc9ff1b20b61ffbb56d9e7f5c892}{sessionsecret\_key}, conn->\hyperlink{struct_crypto___connection_a81ead9fac55a0cedc30a96253a2c5119}{shared\_key});
1599     conn->\hyperlink{struct_crypto___connection_ade818037fd6c985038ff29656089758d}{status} = \hyperlink{net__crypto_8h_ac188171760299bf65ba620fe348b9b40}{CRYPTO\_CONN\_NOT\_CONFIRMED};
1600 
1601     \textcolor{keywordflow}{if} (\hyperlink{net__crypto_8c_ad2ca4aad15dc0607252aa21cd525b5ba}{create\_send\_handshake}(c, crypt\_connection\_id, n\_c->
      \hyperlink{struct_new___connection_a78fb2cbe7af4d12847f2f044c35e7823}{cookie}, n\_c->\hyperlink{struct_new___connection_ab2ecaa07625ad0ed5e07d3a1f0dcc939}{dht\_public\_key}) != 0) \{
1602         pthread\_mutex\_lock(&c->\hyperlink{struct_net___crypto_a2e8f7f4dff2f2fc4ac2cc32b0c886974}{tcp\_mutex});
1603         \hyperlink{_t_c_p__connection_8c_a2369688a49bef46cb2029b3bb680e11d}{kill\_tcp\_connection\_to}(c->\hyperlink{struct_net___crypto_a179982a02be89eaf6617ed81bd3c0961}{tcp\_c}, conn->
      \hyperlink{struct_crypto___connection_a51666aaba0fc5680040fe5bd6778bc50}{connection\_number\_tcp});
1604         pthread\_mutex\_unlock(&c->\hyperlink{struct_net___crypto_a2e8f7f4dff2f2fc4ac2cc32b0c886974}{tcp\_mutex});
1605         conn->\hyperlink{struct_crypto___connection_ade818037fd6c985038ff29656089758d}{status} = \hyperlink{net__crypto_8h_ab974dcadabde124fab5287024341f7a1}{CRYPTO\_CONN\_NO\_CONNECTION};
1606         \textcolor{keywordflow}{return} -1;
1607     \}
1608 
1609     memcpy(conn->\hyperlink{struct_crypto___connection_ab2ecaa07625ad0ed5e07d3a1f0dcc939}{dht\_public\_key}, n\_c->\hyperlink{struct_new___connection_ab2ecaa07625ad0ed5e07d3a1f0dcc939}{dht\_public\_key}, crypto\_box\_PUBLICKEYBYTES
      );
1610     conn->\hyperlink{struct_crypto___connection_a8358768a02871910ed059b1b2646438e}{packet\_send\_rate} = \hyperlink{net__crypto_8h_ab329443d2f5643d95e6034542fcb82f3}{CRYPTO\_PACKET\_MIN\_RATE};
1611     conn->\hyperlink{struct_crypto___connection_adfabcbe80305cc6b4e1c0dfef5c48653}{packets\_left} = \hyperlink{net__crypto_8h_ab0d2e7f3b3f18b516bb0a512c91b2914}{CRYPTO\_MIN\_QUEUE\_LENGTH};
1612     conn->\hyperlink{struct_crypto___connection_ae88ec876060fbc648a4c75ac596137f9}{rtt\_time} = \hyperlink{net__crypto_8h_aa737ddb8e565b8959c9d30398907026e}{DEFAULT\_PING\_CONNECTION};
1613     \hyperlink{net__crypto_8c_a9e779393ece10111b0ac7fe2bbc3beeb}{crypto\_connection\_add\_source}(c, crypt\_connection\_id, n\_c->
      \hyperlink{struct_new___connection_afffde330c649378add9a507c9c151586}{source});
1614     \textcolor{keywordflow}{return} crypt\_connection\_id;
1615 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_ab11f6e96035c3717a21b809d5373f96f_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_ab11f6e96035c3717a21b809d5373f96f_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_af55d3f30f6b07366883f01a8fa09d866}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!add\+\_\+data\+\_\+end\+\_\+of\+\_\+buffer@{add\+\_\+data\+\_\+end\+\_\+of\+\_\+buffer}}
\index{add\+\_\+data\+\_\+end\+\_\+of\+\_\+buffer@{add\+\_\+data\+\_\+end\+\_\+of\+\_\+buffer}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{add\+\_\+data\+\_\+end\+\_\+of\+\_\+buffer}]{\setlength{\rightskip}{0pt plus 5cm}static int64\+\_\+t add\+\_\+data\+\_\+end\+\_\+of\+\_\+buffer (
\begin{DoxyParamCaption}
\item[{{\bf Packets\+\_\+\+Array} $\ast$}]{array, }
\item[{const {\bf Packet\+\_\+\+Data} $\ast$}]{data}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{net__crypto_8c_af55d3f30f6b07366883f01a8fa09d866}


Definition at line 505 of file net\+\_\+crypto.\+c.



References Packets\+\_\+\+Array\+::buffer, Packets\+\_\+\+Array\+::buffer\+\_\+end, C\+R\+Y\+P\+T\+O\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+B\+U\+F\+F\+E\+R\+\_\+\+S\+I\+Z\+E, and num\+\_\+packets\+\_\+array().



Referenced by send\+\_\+lossless\+\_\+packet().


\begin{DoxyCode}
506 \{
507     \textcolor{keywordflow}{if} (\hyperlink{net__crypto_8c_abbe1101e6464100c19aea7cde5c1d3a0}{num\_packets\_array}(array) >= \hyperlink{net__crypto_8h_ac73cf1eb0a938f0962ddc607945636f4}{CRYPTO\_PACKET\_BUFFER\_SIZE})
508         \textcolor{keywordflow}{return} -1;
509 
510     \hyperlink{struct_packet___data}{Packet\_Data} *new\_d = malloc(\textcolor{keyword}{sizeof}(\hyperlink{struct_packet___data}{Packet\_Data}));
511 
512     \textcolor{keywordflow}{if} (new\_d == NULL)
513         \textcolor{keywordflow}{return} -1;
514 
515     memcpy(new\_d, data, \textcolor{keyword}{sizeof}(\hyperlink{struct_packet___data}{Packet\_Data}));
516     uint32\_t \textcolor{keywordtype}{id} = array->\hyperlink{struct_packets___array_a66d710e0093872b26ee80118c1a85d99}{buffer\_end};
517     array->\hyperlink{struct_packets___array_ae9d4e6271fdb80e86ebb3e846fcd709c}{buffer}[\textcolor{keywordtype}{id} % \hyperlink{net__crypto_8h_ac73cf1eb0a938f0962ddc607945636f4}{CRYPTO\_PACKET\_BUFFER\_SIZE}] = new\_d;
518     ++array->\hyperlink{struct_packets___array_a66d710e0093872b26ee80118c1a85d99}{buffer\_end};
519     \textcolor{keywordflow}{return} \hyperlink{struct_file___transfers_aa32dbb3439461c6ccc1a52ff15bcb22e}{id};
520 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=339pt]{d8/dc6/net__crypto_8c_af55d3f30f6b07366883f01a8fa09d866_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_af55d3f30f6b07366883f01a8fa09d866_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_a25e7d5165bf373d47b71dbb49e2e8c78}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!add\+\_\+data\+\_\+to\+\_\+buffer@{add\+\_\+data\+\_\+to\+\_\+buffer}}
\index{add\+\_\+data\+\_\+to\+\_\+buffer@{add\+\_\+data\+\_\+to\+\_\+buffer}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{add\+\_\+data\+\_\+to\+\_\+buffer}]{\setlength{\rightskip}{0pt plus 5cm}static int add\+\_\+data\+\_\+to\+\_\+buffer (
\begin{DoxyParamCaption}
\item[{{\bf Packets\+\_\+\+Array} $\ast$}]{array, }
\item[{uint32\+\_\+t}]{number, }
\item[{const {\bf Packet\+\_\+\+Data} $\ast$}]{data}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{net__crypto_8c_a25e7d5165bf373d47b71dbb49e2e8c78}


Definition at line 454 of file net\+\_\+crypto.\+c.



References Packets\+\_\+\+Array\+::buffer, Packets\+\_\+\+Array\+::buffer\+\_\+end, Packets\+\_\+\+Array\+::buffer\+\_\+start, C\+R\+Y\+P\+T\+O\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+B\+U\+F\+F\+E\+R\+\_\+\+S\+I\+Z\+E, and num.



Referenced by handle\+\_\+data\+\_\+packet\+\_\+helper().


\begin{DoxyCode}
455 \{
456     \textcolor{keywordflow}{if} (number - array->\hyperlink{struct_packets___array_a85973b335814248c05f63543876b348e}{buffer\_start} > \hyperlink{net__crypto_8h_ac73cf1eb0a938f0962ddc607945636f4}{CRYPTO\_PACKET\_BUFFER\_SIZE})
457         \textcolor{keywordflow}{return} -1;
458 
459     uint32\_t \hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num} = number % \hyperlink{net__crypto_8h_ac73cf1eb0a938f0962ddc607945636f4}{CRYPTO\_PACKET\_BUFFER\_SIZE};
460 
461     \textcolor{keywordflow}{if} (array->\hyperlink{struct_packets___array_ae9d4e6271fdb80e86ebb3e846fcd709c}{buffer}[num])
462         \textcolor{keywordflow}{return} -1;
463 
464     \hyperlink{struct_packet___data}{Packet\_Data} *new\_d = malloc(\textcolor{keyword}{sizeof}(\hyperlink{struct_packet___data}{Packet\_Data}));
465 
466     \textcolor{keywordflow}{if} (new\_d == NULL)
467         \textcolor{keywordflow}{return} -1;
468 
469     memcpy(new\_d, data, \textcolor{keyword}{sizeof}(\hyperlink{struct_packet___data}{Packet\_Data}));
470     array->\hyperlink{struct_packets___array_ae9d4e6271fdb80e86ebb3e846fcd709c}{buffer}[\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num}] = new\_d;
471 
472     \textcolor{keywordflow}{if} ((number - array->\hyperlink{struct_packets___array_a85973b335814248c05f63543876b348e}{buffer\_start}) >= (array->\hyperlink{struct_packets___array_a66d710e0093872b26ee80118c1a85d99}{buffer\_end} - array->
      \hyperlink{struct_packets___array_a85973b335814248c05f63543876b348e}{buffer\_start}))
473         array->\hyperlink{struct_packets___array_a66d710e0093872b26ee80118c1a85d99}{buffer\_end} = number + 1;
474 
475     \textcolor{keywordflow}{return} 0;
476 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a25e7d5165bf373d47b71dbb49e2e8c78_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_a632021583d7dd2484614071a7080f311}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!add\+\_\+tcp\+\_\+relay@{add\+\_\+tcp\+\_\+relay}}
\index{add\+\_\+tcp\+\_\+relay@{add\+\_\+tcp\+\_\+relay}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{add\+\_\+tcp\+\_\+relay}]{\setlength{\rightskip}{0pt plus 5cm}int add\+\_\+tcp\+\_\+relay (
\begin{DoxyParamCaption}
\item[{{\bf Net\+\_\+\+Crypto} $\ast$}]{c, }
\item[{{\bf I\+P\+\_\+\+Port}}]{ip\+\_\+port, }
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key}
\end{DoxyParamCaption}
)}}\label{net__crypto_8c_a632021583d7dd2484614071a7080f311}


Definition at line 1794 of file net\+\_\+crypto.\+c.



References add\+\_\+tcp\+\_\+relay\+\_\+global(), Net\+\_\+\+Crypto\+::tcp\+\_\+c, and Net\+\_\+\+Crypto\+::tcp\+\_\+mutex.



Referenced by do\+\_\+messenger(), tcp\+\_\+relay\+\_\+node\+\_\+callback(), and tox\+\_\+add\+\_\+tcp\+\_\+relay().


\begin{DoxyCode}
1795 \{
1796     pthread\_mutex\_lock(&c->\hyperlink{struct_net___crypto_a2e8f7f4dff2f2fc4ac2cc32b0c886974}{tcp\_mutex});
1797     \textcolor{keywordtype}{int} ret = \hyperlink{_t_c_p__connection_8c_a5ee1dbaa28ff59e0f452eda3c97418e3}{add\_tcp\_relay\_global}(c->\hyperlink{struct_net___crypto_a179982a02be89eaf6617ed81bd3c0961}{tcp\_c}, ip\_port, 
      \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key});
1798     pthread\_mutex\_unlock(&c->\hyperlink{struct_net___crypto_a2e8f7f4dff2f2fc4ac2cc32b0c886974}{tcp\_mutex});
1799     \textcolor{keywordflow}{return} ret;
1800 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a632021583d7dd2484614071a7080f311_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a632021583d7dd2484614071a7080f311_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_a4b9f3aef7b0d4c461294e24a21e64e71}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!add\+\_\+tcp\+\_\+relay\+\_\+peer@{add\+\_\+tcp\+\_\+relay\+\_\+peer}}
\index{add\+\_\+tcp\+\_\+relay\+\_\+peer@{add\+\_\+tcp\+\_\+relay\+\_\+peer}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{add\+\_\+tcp\+\_\+relay\+\_\+peer}]{\setlength{\rightskip}{0pt plus 5cm}int add\+\_\+tcp\+\_\+relay\+\_\+peer (
\begin{DoxyParamCaption}
\item[{{\bf Net\+\_\+\+Crypto} $\ast$}]{c, }
\item[{int}]{crypt\+\_\+connection\+\_\+id, }
\item[{{\bf I\+P\+\_\+\+Port}}]{ip\+\_\+port, }
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key}
\end{DoxyParamCaption}
)}}\label{net__crypto_8c_a4b9f3aef7b0d4c461294e24a21e64e71}


Definition at line 1776 of file net\+\_\+crypto.\+c.



References add\+\_\+tcp\+\_\+relay\+\_\+connection(), Crypto\+\_\+\+Connection\+::connection\+\_\+number\+\_\+tcp, get\+\_\+crypto\+\_\+connection(), Net\+\_\+\+Crypto\+::tcp\+\_\+c, and Net\+\_\+\+Crypto\+::tcp\+\_\+mutex.



Referenced by connect\+\_\+to\+\_\+saved\+\_\+tcp\+\_\+relays(), and friend\+\_\+add\+\_\+tcp\+\_\+relay().


\begin{DoxyCode}
1777 \{
1778     \hyperlink{struct_crypto___connection}{Crypto\_Connection} *conn = \hyperlink{net__crypto_8c_a909daa4b6d420cbd028f2c956a8642db}{get\_crypto\_connection}(c, 
      crypt\_connection\_id);
1779 
1780     \textcolor{keywordflow}{if} (conn == 0)
1781         \textcolor{keywordflow}{return} -1;
1782 
1783     pthread\_mutex\_lock(&c->\hyperlink{struct_net___crypto_a2e8f7f4dff2f2fc4ac2cc32b0c886974}{tcp\_mutex});
1784     \textcolor{keywordtype}{int} ret = \hyperlink{_t_c_p__connection_8c_a26901882c0b134822660515493683132}{add\_tcp\_relay\_connection}(c->\hyperlink{struct_net___crypto_a179982a02be89eaf6617ed81bd3c0961}{tcp\_c}, conn->
      \hyperlink{struct_crypto___connection_a51666aaba0fc5680040fe5bd6778bc50}{connection\_number\_tcp}, ip\_port, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key});
1785     pthread\_mutex\_unlock(&c->\hyperlink{struct_net___crypto_a2e8f7f4dff2f2fc4ac2cc32b0c886974}{tcp\_mutex});
1786     \textcolor{keywordflow}{return} ret;
1787 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a4b9f3aef7b0d4c461294e24a21e64e71_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a4b9f3aef7b0d4c461294e24a21e64e71_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_ae690bbce7d008eda1142ceaf0673e672}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!clear\+\_\+buffer@{clear\+\_\+buffer}}
\index{clear\+\_\+buffer@{clear\+\_\+buffer}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{clear\+\_\+buffer}]{\setlength{\rightskip}{0pt plus 5cm}static int clear\+\_\+buffer (
\begin{DoxyParamCaption}
\item[{{\bf Packets\+\_\+\+Array} $\ast$}]{array}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{net__crypto_8c_ae690bbce7d008eda1142ceaf0673e672}


Definition at line 572 of file net\+\_\+crypto.\+c.



References Packets\+\_\+\+Array\+::buffer, Packets\+\_\+\+Array\+::buffer\+\_\+end, Packets\+\_\+\+Array\+::buffer\+\_\+start, C\+R\+Y\+P\+T\+O\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+B\+U\+F\+F\+E\+R\+\_\+\+S\+I\+Z\+E, i, and num.



Referenced by crypto\+\_\+kill().


\begin{DoxyCode}
573 \{
574     uint32\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
575 
576     \textcolor{keywordflow}{for} (i = array->\hyperlink{struct_packets___array_a85973b335814248c05f63543876b348e}{buffer\_start}; i != array->\hyperlink{struct_packets___array_a66d710e0093872b26ee80118c1a85d99}{buffer\_end}; ++i) \{
577         uint32\_t \hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num} = i % \hyperlink{net__crypto_8h_ac73cf1eb0a938f0962ddc607945636f4}{CRYPTO\_PACKET\_BUFFER\_SIZE};
578 
579         \textcolor{keywordflow}{if} (array->\hyperlink{struct_packets___array_ae9d4e6271fdb80e86ebb3e846fcd709c}{buffer}[num]) \{
580             free(array->\hyperlink{struct_packets___array_ae9d4e6271fdb80e86ebb3e846fcd709c}{buffer}[num]);
581             array->\hyperlink{struct_packets___array_ae9d4e6271fdb80e86ebb3e846fcd709c}{buffer}[\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num}] = NULL;
582         \}
583     \}
584 
585     array->\hyperlink{struct_packets___array_a85973b335814248c05f63543876b348e}{buffer\_start} = \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
586     \textcolor{keywordflow}{return} 0;
587 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_ae690bbce7d008eda1142ceaf0673e672_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_adb75f9c0e1a6f9ab1064cb17953011a3}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!clear\+\_\+buffer\+\_\+until@{clear\+\_\+buffer\+\_\+until}}
\index{clear\+\_\+buffer\+\_\+until@{clear\+\_\+buffer\+\_\+until}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{clear\+\_\+buffer\+\_\+until}]{\setlength{\rightskip}{0pt plus 5cm}static int clear\+\_\+buffer\+\_\+until (
\begin{DoxyParamCaption}
\item[{{\bf Packets\+\_\+\+Array} $\ast$}]{array, }
\item[{uint32\+\_\+t}]{number}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{net__crypto_8c_adb75f9c0e1a6f9ab1064cb17953011a3}


Definition at line 550 of file net\+\_\+crypto.\+c.



References Packets\+\_\+\+Array\+::buffer, Packets\+\_\+\+Array\+::buffer\+\_\+end, Packets\+\_\+\+Array\+::buffer\+\_\+start, C\+R\+Y\+P\+T\+O\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+B\+U\+F\+F\+E\+R\+\_\+\+S\+I\+Z\+E, i, and num.



Referenced by handle\+\_\+data\+\_\+packet\+\_\+helper().


\begin{DoxyCode}
551 \{
552     uint32\_t num\_spots = array->\hyperlink{struct_packets___array_a66d710e0093872b26ee80118c1a85d99}{buffer\_end} - array->\hyperlink{struct_packets___array_a85973b335814248c05f63543876b348e}{buffer\_start};
553 
554     \textcolor{keywordflow}{if} (array->\hyperlink{struct_packets___array_a66d710e0093872b26ee80118c1a85d99}{buffer\_end} - number >= num\_spots || number - array->
      \hyperlink{struct_packets___array_a85973b335814248c05f63543876b348e}{buffer\_start} > num\_spots)
555         \textcolor{keywordflow}{return} -1;
556 
557     uint32\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
558 
559     \textcolor{keywordflow}{for} (i = array->\hyperlink{struct_packets___array_a85973b335814248c05f63543876b348e}{buffer\_start}; i != number; ++i) \{
560         uint32\_t \hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num} = i % \hyperlink{net__crypto_8h_ac73cf1eb0a938f0962ddc607945636f4}{CRYPTO\_PACKET\_BUFFER\_SIZE};
561 
562         \textcolor{keywordflow}{if} (array->\hyperlink{struct_packets___array_ae9d4e6271fdb80e86ebb3e846fcd709c}{buffer}[num]) \{
563             free(array->\hyperlink{struct_packets___array_ae9d4e6271fdb80e86ebb3e846fcd709c}{buffer}[num]);
564             array->\hyperlink{struct_packets___array_ae9d4e6271fdb80e86ebb3e846fcd709c}{buffer}[\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num}] = NULL;
565         \}
566     \}
567 
568     array->\hyperlink{struct_packets___array_a85973b335814248c05f63543876b348e}{buffer\_start} = \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
569     \textcolor{keywordflow}{return} 0;
570 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_adb75f9c0e1a6f9ab1064cb17953011a3_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_a6e6c3107cf48ec1c5087d3780a03ad0c}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!clear\+\_\+temp\+\_\+packet@{clear\+\_\+temp\+\_\+packet}}
\index{clear\+\_\+temp\+\_\+packet@{clear\+\_\+temp\+\_\+packet}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{clear\+\_\+temp\+\_\+packet}]{\setlength{\rightskip}{0pt plus 5cm}static int clear\+\_\+temp\+\_\+packet (
\begin{DoxyParamCaption}
\item[{const {\bf Net\+\_\+\+Crypto} $\ast$}]{c, }
\item[{int}]{crypt\+\_\+connection\+\_\+id}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{net__crypto_8c_a6e6c3107cf48ec1c5087d3780a03ad0c}


Definition at line 1034 of file net\+\_\+crypto.\+c.



References get\+\_\+crypto\+\_\+connection(), Crypto\+\_\+\+Connection\+::temp\+\_\+packet, Crypto\+\_\+\+Connection\+::temp\+\_\+packet\+\_\+length, Crypto\+\_\+\+Connection\+::temp\+\_\+packet\+\_\+num\+\_\+sent, and Crypto\+\_\+\+Connection\+::temp\+\_\+packet\+\_\+sent\+\_\+time.



Referenced by crypto\+\_\+kill(), and handle\+\_\+data\+\_\+packet\+\_\+helper().


\begin{DoxyCode}
1035 \{
1036     \hyperlink{struct_crypto___connection}{Crypto\_Connection} *conn = \hyperlink{net__crypto_8c_a909daa4b6d420cbd028f2c956a8642db}{get\_crypto\_connection}(c, 
      crypt\_connection\_id);
1037 
1038     \textcolor{keywordflow}{if} (conn == 0)
1039         \textcolor{keywordflow}{return} -1;
1040 
1041     \textcolor{keywordflow}{if} (conn->\hyperlink{struct_crypto___connection_a360adb14f743065d5c69fe29a00a06a7}{temp\_packet})
1042         free(conn->\hyperlink{struct_crypto___connection_a360adb14f743065d5c69fe29a00a06a7}{temp\_packet});
1043 
1044     conn->\hyperlink{struct_crypto___connection_a360adb14f743065d5c69fe29a00a06a7}{temp\_packet} = 0;
1045     conn->\hyperlink{struct_crypto___connection_a4ef842580c6c073f36578d0e07551cc4}{temp\_packet\_length} = 0;
1046     conn->\hyperlink{struct_crypto___connection_abb5fdaef769d667f90bc97bd72d765d6}{temp\_packet\_sent\_time} = 0;
1047     conn->\hyperlink{struct_crypto___connection_a7386b7ad7bedb9dd47d898f588b4f463}{temp\_packet\_num\_sent} = 0;
1048     \textcolor{keywordflow}{return} 0;
1049 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a6e6c3107cf48ec1c5087d3780a03ad0c_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a6e6c3107cf48ec1c5087d3780a03ad0c_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_afdc8cda0f8580be3a59a4f315c042fb0}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!connection\+\_\+data\+\_\+handler@{connection\+\_\+data\+\_\+handler}}
\index{connection\+\_\+data\+\_\+handler@{connection\+\_\+data\+\_\+handler}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{connection\+\_\+data\+\_\+handler}]{\setlength{\rightskip}{0pt plus 5cm}int connection\+\_\+data\+\_\+handler (
\begin{DoxyParamCaption}
\item[{const {\bf Net\+\_\+\+Crypto} $\ast$}]{c, }
\item[{int}]{crypt\+\_\+connection\+\_\+id, }
\item[{int($\ast$)(void $\ast$object, int id, uint8\+\_\+t $\ast$data, uint16\+\_\+t length)}]{connection\+\_\+data\+\_\+callback, }
\item[{void $\ast$}]{object, }
\item[{int}]{id}
\end{DoxyParamCaption}
)}}\label{net__crypto_8c_afdc8cda0f8580be3a59a4f315c042fb0}


Definition at line 1914 of file net\+\_\+crypto.\+c.



References Crypto\+\_\+\+Connection\+::connection\+\_\+data\+\_\+callback, Crypto\+\_\+\+Connection\+::connection\+\_\+data\+\_\+callback\+\_\+id, Crypto\+\_\+\+Connection\+::connection\+\_\+data\+\_\+callback\+\_\+object, and get\+\_\+crypto\+\_\+connection().



Referenced by friend\+\_\+new\+\_\+connection(), and handle\+\_\+new\+\_\+connections().


\begin{DoxyCode}
1916 \{
1917     \hyperlink{struct_crypto___connection}{Crypto\_Connection} *conn = \hyperlink{net__crypto_8c_a909daa4b6d420cbd028f2c956a8642db}{get\_crypto\_connection}(c, 
      crypt\_connection\_id);
1918 
1919     \textcolor{keywordflow}{if} (conn == 0)
1920         \textcolor{keywordflow}{return} -1;
1921 
1922     conn->\hyperlink{struct_crypto___connection_adc6ee264e4a5758049c6299beb81ce6d}{connection\_data\_callback} = connection\_data\_callback;
1923     conn->\hyperlink{struct_crypto___connection_a3c44dfac7528ae10a6d09bf812f36486}{connection\_data\_callback\_object} = object;
1924     conn->\hyperlink{struct_crypto___connection_a7d50567cce6cb1b8ef983e64060d414e}{connection\_data\_callback\_id} = \hyperlink{struct_file___transfers_aa32dbb3439461c6ccc1a52ff15bcb22e}{id};
1925     \textcolor{keywordflow}{return} 0;
1926 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_afdc8cda0f8580be3a59a4f315c042fb0_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_afdc8cda0f8580be3a59a4f315c042fb0_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_ac679d5f08189ac10b3eca22c3f032dbc}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!connection\+\_\+kill@{connection\+\_\+kill}}
\index{connection\+\_\+kill@{connection\+\_\+kill}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{connection\+\_\+kill}]{\setlength{\rightskip}{0pt plus 5cm}static void connection\+\_\+kill (
\begin{DoxyParamCaption}
\item[{{\bf Net\+\_\+\+Crypto} $\ast$}]{c, }
\item[{int}]{crypt\+\_\+connection\+\_\+id}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{net__crypto_8c_ac679d5f08189ac10b3eca22c3f032dbc}


Definition at line 1119 of file net\+\_\+crypto.\+c.



References Crypto\+\_\+\+Connection\+::connection\+\_\+status\+\_\+callback, Crypto\+\_\+\+Connection\+::connection\+\_\+status\+\_\+callback\+\_\+id, Crypto\+\_\+\+Connection\+::connection\+\_\+status\+\_\+callback\+\_\+object, crypto\+\_\+kill(), and get\+\_\+crypto\+\_\+connection().



Referenced by handle\+\_\+data\+\_\+packet\+\_\+helper(), handle\+\_\+new\+\_\+connection\+\_\+handshake(), and kill\+\_\+timedout().


\begin{DoxyCode}
1120 \{
1121     \hyperlink{struct_crypto___connection}{Crypto\_Connection} *conn = \hyperlink{net__crypto_8c_a909daa4b6d420cbd028f2c956a8642db}{get\_crypto\_connection}(c, 
      crypt\_connection\_id);
1122 
1123     \textcolor{keywordflow}{if} (conn == 0)
1124         \textcolor{keywordflow}{return};
1125 
1126     \textcolor{keywordflow}{if} (conn->\hyperlink{struct_crypto___connection_ad3c663c15ca97b75951ea711b522c049}{connection\_status\_callback}) \{
1127         conn->\hyperlink{struct_crypto___connection_ad3c663c15ca97b75951ea711b522c049}{connection\_status\_callback}(conn->
      \hyperlink{struct_crypto___connection_afe03d43c62ac2aa575a39e4308353244}{connection\_status\_callback\_object}, conn->
      \hyperlink{struct_crypto___connection_a3cd6f7015115dc493f86be91526eb9f8}{connection\_status\_callback\_id}, 0);
1128     \}
1129 
1130     \hyperlink{net__crypto_8c_a16c3a0008512675dad8eb00ff1822763}{crypto\_kill}(c, crypt\_connection\_id);
1131 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_ac679d5f08189ac10b3eca22c3f032dbc_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_ac679d5f08189ac10b3eca22c3f032dbc_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_a8a587a287b13cce4271a272c71c2b788}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!connection\+\_\+lossy\+\_\+data\+\_\+handler@{connection\+\_\+lossy\+\_\+data\+\_\+handler}}
\index{connection\+\_\+lossy\+\_\+data\+\_\+handler@{connection\+\_\+lossy\+\_\+data\+\_\+handler}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{connection\+\_\+lossy\+\_\+data\+\_\+handler}]{\setlength{\rightskip}{0pt plus 5cm}int connection\+\_\+lossy\+\_\+data\+\_\+handler (
\begin{DoxyParamCaption}
\item[{{\bf Net\+\_\+\+Crypto} $\ast$}]{c, }
\item[{int}]{crypt\+\_\+connection\+\_\+id, }
\item[{int($\ast$)(void $\ast$object, int id, const uint8\+\_\+t $\ast$data, uint16\+\_\+t length)}]{connection\+\_\+lossy\+\_\+data\+\_\+callback, }
\item[{void $\ast$}]{object, }
\item[{int}]{id}
\end{DoxyParamCaption}
)}}\label{net__crypto_8c_a8a587a287b13cce4271a272c71c2b788}


Definition at line 1936 of file net\+\_\+crypto.\+c.



References Crypto\+\_\+\+Connection\+::connection\+\_\+lossy\+\_\+data\+\_\+callback, Crypto\+\_\+\+Connection\+::connection\+\_\+lossy\+\_\+data\+\_\+callback\+\_\+id, Crypto\+\_\+\+Connection\+::connection\+\_\+lossy\+\_\+data\+\_\+callback\+\_\+object, and get\+\_\+crypto\+\_\+connection().



Referenced by friend\+\_\+new\+\_\+connection(), and handle\+\_\+new\+\_\+connections().


\begin{DoxyCode}
1938 \{
1939     \hyperlink{struct_crypto___connection}{Crypto\_Connection} *conn = \hyperlink{net__crypto_8c_a909daa4b6d420cbd028f2c956a8642db}{get\_crypto\_connection}(c, 
      crypt\_connection\_id);
1940 
1941     \textcolor{keywordflow}{if} (conn == 0)
1942         \textcolor{keywordflow}{return} -1;
1943 
1944     conn->\hyperlink{struct_crypto___connection_ab5af8aad05ddc085e69ead928cc26313}{connection\_lossy\_data\_callback} = connection\_lossy\_data\_callback;
1945     conn->\hyperlink{struct_crypto___connection_a70a99b7d0c9dd2f913ca9ea42bafc942}{connection\_lossy\_data\_callback\_object} = object;
1946     conn->\hyperlink{struct_crypto___connection_acdd49847729119bc5d6cc7269cde876a}{connection\_lossy\_data\_callback\_id} = 
      \hyperlink{struct_file___transfers_aa32dbb3439461c6ccc1a52ff15bcb22e}{id};
1947     \textcolor{keywordflow}{return} 0;
1948 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a8a587a287b13cce4271a272c71c2b788_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a8a587a287b13cce4271a272c71c2b788_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_af159dc9120b9cd0675a865eabec03a73}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!connection\+\_\+status\+\_\+handler@{connection\+\_\+status\+\_\+handler}}
\index{connection\+\_\+status\+\_\+handler@{connection\+\_\+status\+\_\+handler}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{connection\+\_\+status\+\_\+handler}]{\setlength{\rightskip}{0pt plus 5cm}int connection\+\_\+status\+\_\+handler (
\begin{DoxyParamCaption}
\item[{const {\bf Net\+\_\+\+Crypto} $\ast$}]{c, }
\item[{int}]{crypt\+\_\+connection\+\_\+id, }
\item[{int($\ast$)(void $\ast$object, int id, uint8\+\_\+t status)}]{connection\+\_\+status\+\_\+callback, }
\item[{void $\ast$}]{object, }
\item[{int}]{id}
\end{DoxyParamCaption}
)}}\label{net__crypto_8c_af159dc9120b9cd0675a865eabec03a73}


Definition at line 1892 of file net\+\_\+crypto.\+c.



References Crypto\+\_\+\+Connection\+::connection\+\_\+status\+\_\+callback, Crypto\+\_\+\+Connection\+::connection\+\_\+status\+\_\+callback\+\_\+id, Crypto\+\_\+\+Connection\+::connection\+\_\+status\+\_\+callback\+\_\+object, and get\+\_\+crypto\+\_\+connection().



Referenced by friend\+\_\+new\+\_\+connection(), and handle\+\_\+new\+\_\+connections().


\begin{DoxyCode}
1894 \{
1895     \hyperlink{struct_crypto___connection}{Crypto\_Connection} *conn = \hyperlink{net__crypto_8c_a909daa4b6d420cbd028f2c956a8642db}{get\_crypto\_connection}(c, 
      crypt\_connection\_id);
1896 
1897     \textcolor{keywordflow}{if} (conn == 0)
1898         \textcolor{keywordflow}{return} -1;
1899 
1900     conn->\hyperlink{struct_crypto___connection_ad3c663c15ca97b75951ea711b522c049}{connection\_status\_callback} = connection\_status\_callback;
1901     conn->\hyperlink{struct_crypto___connection_afe03d43c62ac2aa575a39e4308353244}{connection\_status\_callback\_object} = object;
1902     conn->\hyperlink{struct_crypto___connection_a3cd6f7015115dc493f86be91526eb9f8}{connection\_status\_callback\_id} = \hyperlink{struct_file___transfers_aa32dbb3439461c6ccc1a52ff15bcb22e}{id};
1903     \textcolor{keywordflow}{return} 0;
1904 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_af159dc9120b9cd0675a865eabec03a73_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_af159dc9120b9cd0675a865eabec03a73_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_ac398e442ae77ace2af0156b9ce7f604c}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!copy\+\_\+connected\+\_\+tcp\+\_\+relays@{copy\+\_\+connected\+\_\+tcp\+\_\+relays}}
\index{copy\+\_\+connected\+\_\+tcp\+\_\+relays@{copy\+\_\+connected\+\_\+tcp\+\_\+relays}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{copy\+\_\+connected\+\_\+tcp\+\_\+relays}]{\setlength{\rightskip}{0pt plus 5cm}unsigned int copy\+\_\+connected\+\_\+tcp\+\_\+relays (
\begin{DoxyParamCaption}
\item[{{\bf Net\+\_\+\+Crypto} $\ast$}]{c, }
\item[{{\bf Node\+\_\+format} $\ast$}]{tcp\+\_\+relays, }
\item[{uint16\+\_\+t}]{num}
\end{DoxyParamCaption}
)}}\label{net__crypto_8c_ac398e442ae77ace2af0156b9ce7f604c}


Definition at line 1839 of file net\+\_\+crypto.\+c.



References Net\+\_\+\+Crypto\+::tcp\+\_\+c, tcp\+\_\+copy\+\_\+connected\+\_\+relays(), and Net\+\_\+\+Crypto\+::tcp\+\_\+mutex.



Referenced by messenger\+\_\+save(), populate\+\_\+path\+\_\+nodes\+\_\+tcp(), send\+\_\+dhtpk\+\_\+announce(), and send\+\_\+relays().


\begin{DoxyCode}
1840 \{
1841     \textcolor{keywordflow}{if} (\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num} == 0)
1842         \textcolor{keywordflow}{return} 0;
1843 
1844     pthread\_mutex\_lock(&c->\hyperlink{struct_net___crypto_a2e8f7f4dff2f2fc4ac2cc32b0c886974}{tcp\_mutex});
1845     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} ret = \hyperlink{_t_c_p__connection_8c_ac2e62c717ccebd2379e32ca9b330812c}{tcp\_copy\_connected\_relays}(c->
      \hyperlink{struct_net___crypto_a179982a02be89eaf6617ed81bd3c0961}{tcp\_c}, tcp\_relays, \hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num});
1846     pthread\_mutex\_unlock(&c->\hyperlink{struct_net___crypto_a2e8f7f4dff2f2fc4ac2cc32b0c886974}{tcp\_mutex});
1847 
1848     \textcolor{keywordflow}{return} ret;
1849 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_ac398e442ae77ace2af0156b9ce7f604c_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_ac398e442ae77ace2af0156b9ce7f604c_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_ad630e2753f088cf9ccd45babe8719532}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!create\+\_\+cookie@{create\+\_\+cookie}}
\index{create\+\_\+cookie@{create\+\_\+cookie}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{create\+\_\+cookie}]{\setlength{\rightskip}{0pt plus 5cm}static int create\+\_\+cookie (
\begin{DoxyParamCaption}
\item[{uint8\+\_\+t $\ast$}]{cookie, }
\item[{const uint8\+\_\+t $\ast$}]{bytes, }
\item[{const uint8\+\_\+t $\ast$}]{encryption\+\_\+key}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{net__crypto_8c_ad630e2753f088cf9ccd45babe8719532}


Definition at line 97 of file net\+\_\+crypto.\+c.



References C\+O\+O\+K\+I\+E\+\_\+\+C\+O\+N\+T\+E\+N\+T\+S\+\_\+\+L\+E\+N\+G\+T\+H, C\+O\+O\+K\+I\+E\+\_\+\+D\+A\+T\+A\+\_\+\+L\+E\+N\+G\+T\+H, C\+O\+O\+K\+I\+E\+\_\+\+L\+E\+N\+G\+T\+H, encrypt\+\_\+data\+\_\+symmetric(), new\+\_\+nonce(), and unix\+\_\+time().



Referenced by create\+\_\+cookie\+\_\+response(), and create\+\_\+crypto\+\_\+handshake().


\begin{DoxyCode}
98 \{
99     uint8\_t contents[\hyperlink{net__crypto_8c_a35fd5a283cae1c0954d99c778ac9ad27}{COOKIE\_CONTENTS\_LENGTH}];
100     uint64\_t temp\_time = \hyperlink{util_8c_ac958d9f8847cb8039444bfa3d304233a}{unix\_time}();
101     memcpy(contents, &temp\_time, \textcolor{keyword}{sizeof}(temp\_time));
102     memcpy(contents + \textcolor{keyword}{sizeof}(temp\_time), bytes, \hyperlink{net__crypto_8c_ada1ab442f8ac484c80c15260ab737cab}{COOKIE\_DATA\_LENGTH});
103     \hyperlink{crypto__core_8c_a8b1033efb47c625779d11be7d8eb9e24}{new\_nonce}(cookie);
104     \textcolor{keywordtype}{int} len = \hyperlink{crypto__core_8c_a81efc0a4a6e0efe372651e26e342a6e5}{encrypt\_data\_symmetric}(encryption\_key, cookie, contents, \textcolor{keyword}{sizeof}(
      contents), cookie + crypto\_box\_NONCEBYTES);
105 
106     \textcolor{keywordflow}{if} (len != \hyperlink{net__crypto_8c_a905c0a7642c878ca482e2d7aff7d670c}{COOKIE\_LENGTH} - crypto\_box\_NONCEBYTES)
107         \textcolor{keywordflow}{return} -1;
108 
109     \textcolor{keywordflow}{return} 0;
110 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_ad630e2753f088cf9ccd45babe8719532_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_ad630e2753f088cf9ccd45babe8719532_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_a5b67a38d23f1bbe5ff0ba96ea57520a4}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!create\+\_\+cookie\+\_\+request@{create\+\_\+cookie\+\_\+request}}
\index{create\+\_\+cookie\+\_\+request@{create\+\_\+cookie\+\_\+request}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{create\+\_\+cookie\+\_\+request}]{\setlength{\rightskip}{0pt plus 5cm}static int create\+\_\+cookie\+\_\+request (
\begin{DoxyParamCaption}
\item[{const {\bf Net\+\_\+\+Crypto} $\ast$}]{c, }
\item[{uint8\+\_\+t $\ast$}]{packet, }
\item[{uint8\+\_\+t $\ast$}]{dht\+\_\+public\+\_\+key, }
\item[{uint64\+\_\+t}]{number, }
\item[{uint8\+\_\+t $\ast$}]{shared\+\_\+key}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{net__crypto_8c_a5b67a38d23f1bbe5ff0ba96ea57520a4}


Definition at line 67 of file net\+\_\+crypto.\+c.



References C\+O\+O\+K\+I\+E\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+P\+L\+A\+I\+N\+\_\+\+L\+E\+N\+G\+T\+H, Net\+\_\+\+Crypto\+::dht, D\+H\+T\+\_\+get\+\_\+shared\+\_\+key\+\_\+sent(), encrypt\+\_\+data\+\_\+symmetric(), N\+E\+T\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+C\+O\+O\+K\+I\+E\+\_\+\+R\+E\+Q\+U\+E\+S\+T, new\+\_\+nonce(), nonce, Net\+\_\+\+Crypto\+::self\+\_\+public\+\_\+key, and D\+H\+T\+::self\+\_\+public\+\_\+key.



Referenced by new\+\_\+crypto\+\_\+connection().


\begin{DoxyCode}
69 \{
70     uint8\_t plain[\hyperlink{net__crypto_8c_a09bc1e1952ce2d46d01925227c1c34d1}{COOKIE\_REQUEST\_PLAIN\_LENGTH}];
71     uint8\_t padding[crypto\_box\_PUBLICKEYBYTES] = \{0\};
72 
73     memcpy(plain, c->\hyperlink{struct_net___crypto_ae726df8bdc26380e5a6c3187a00d6881}{self\_public\_key}, crypto\_box\_PUBLICKEYBYTES);
74     memcpy(plain + crypto\_box\_PUBLICKEYBYTES, padding, crypto\_box\_PUBLICKEYBYTES);
75     memcpy(plain + (crypto\_box\_PUBLICKEYBYTES * 2), &number, \textcolor{keyword}{sizeof}(uint64\_t));
76 
77     \hyperlink{_d_h_t_8c_a087cceeacc5a14415b651c2980a24d34}{DHT\_get\_shared\_key\_sent}(c->\hyperlink{struct_net___crypto_a8b3d6ce8745acc52695e252bdb1531b6}{dht}, shared\_key, dht\_public\_key);
78     uint8\_t \hyperlink{crypto__test_8c_a7932c523f7065073a396e571319201ce}{nonce}[crypto\_box\_NONCEBYTES];
79     \hyperlink{crypto__core_8c_a8b1033efb47c625779d11be7d8eb9e24}{new\_nonce}(nonce);
80     packet[0] = \hyperlink{network_8h_a3ad6d83af0ed67a84b327df50d66229c}{NET\_PACKET\_COOKIE\_REQUEST};
81     memcpy(packet + 1, c->\hyperlink{struct_net___crypto_a8b3d6ce8745acc52695e252bdb1531b6}{dht}->\hyperlink{struct_d_h_t_ae726df8bdc26380e5a6c3187a00d6881}{self\_public\_key}, crypto\_box\_PUBLICKEYBYTES);
82     memcpy(packet + 1 + crypto\_box\_PUBLICKEYBYTES, nonce, crypto\_box\_NONCEBYTES);
83     \textcolor{keywordtype}{int} len = \hyperlink{crypto__core_8c_a81efc0a4a6e0efe372651e26e342a6e5}{encrypt\_data\_symmetric}(shared\_key, nonce, plain, \textcolor{keyword}{sizeof}(plain),
84                                      packet + 1 + crypto\_box\_PUBLICKEYBYTES + crypto\_box\_NONCEBYTES);
85 
86     \textcolor{keywordflow}{if} (len != \hyperlink{net__crypto_8c_a09bc1e1952ce2d46d01925227c1c34d1}{COOKIE\_REQUEST\_PLAIN\_LENGTH} + crypto\_box\_MACBYTES)
87         \textcolor{keywordflow}{return} -1;
88 
89     \textcolor{keywordflow}{return} (1 + crypto\_box\_PUBLICKEYBYTES + crypto\_box\_NONCEBYTES + len);
90 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a5b67a38d23f1bbe5ff0ba96ea57520a4_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a5b67a38d23f1bbe5ff0ba96ea57520a4_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_ab88b2226740cacde1112ee7fd13048d3}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!create\+\_\+cookie\+\_\+response@{create\+\_\+cookie\+\_\+response}}
\index{create\+\_\+cookie\+\_\+response@{create\+\_\+cookie\+\_\+response}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{create\+\_\+cookie\+\_\+response}]{\setlength{\rightskip}{0pt plus 5cm}static int create\+\_\+cookie\+\_\+response (
\begin{DoxyParamCaption}
\item[{const {\bf Net\+\_\+\+Crypto} $\ast$}]{c, }
\item[{uint8\+\_\+t $\ast$}]{packet, }
\item[{const uint8\+\_\+t $\ast$}]{request\+\_\+plain, }
\item[{const uint8\+\_\+t $\ast$}]{shared\+\_\+key, }
\item[{const uint8\+\_\+t $\ast$}]{dht\+\_\+public\+\_\+key}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{net__crypto_8c_ab88b2226740cacde1112ee7fd13048d3}


Definition at line 145 of file net\+\_\+crypto.\+c.



References C\+O\+O\+K\+I\+E\+\_\+\+D\+A\+T\+A\+\_\+\+L\+E\+N\+G\+T\+H, C\+O\+O\+K\+I\+E\+\_\+\+L\+E\+N\+G\+T\+H, C\+O\+O\+K\+I\+E\+\_\+\+R\+E\+S\+P\+O\+N\+S\+E\+\_\+\+L\+E\+N\+G\+T\+H, create\+\_\+cookie(), encrypt\+\_\+data\+\_\+symmetric(), N\+E\+T\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+C\+O\+O\+K\+I\+E\+\_\+\+R\+E\+S\+P\+O\+N\+S\+E, new\+\_\+nonce(), and Net\+\_\+\+Crypto\+::secret\+\_\+symmetric\+\_\+key.



Referenced by tcp\+\_\+handle\+\_\+cookie\+\_\+request(), tcp\+\_\+oob\+\_\+handle\+\_\+cookie\+\_\+request(), and udp\+\_\+handle\+\_\+cookie\+\_\+request().


\begin{DoxyCode}
147 \{
148     uint8\_t cookie\_plain[\hyperlink{net__crypto_8c_ada1ab442f8ac484c80c15260ab737cab}{COOKIE\_DATA\_LENGTH}];
149     memcpy(cookie\_plain, request\_plain, crypto\_box\_PUBLICKEYBYTES);
150     memcpy(cookie\_plain + crypto\_box\_PUBLICKEYBYTES, dht\_public\_key, crypto\_box\_PUBLICKEYBYTES);
151     uint8\_t plain[\hyperlink{net__crypto_8c_a905c0a7642c878ca482e2d7aff7d670c}{COOKIE\_LENGTH} + \textcolor{keyword}{sizeof}(uint64\_t)];
152 
153     \textcolor{keywordflow}{if} (\hyperlink{net__crypto_8c_ad630e2753f088cf9ccd45babe8719532}{create\_cookie}(plain, cookie\_plain, c->\hyperlink{struct_net___crypto_ab9f2ff47bc0b1e5110202a6e4be86390}{secret\_symmetric\_key}) != 0)
154         \textcolor{keywordflow}{return} -1;
155 
156     memcpy(plain + \hyperlink{net__crypto_8c_a905c0a7642c878ca482e2d7aff7d670c}{COOKIE\_LENGTH}, request\_plain + 
      \hyperlink{net__crypto_8c_ada1ab442f8ac484c80c15260ab737cab}{COOKIE\_DATA\_LENGTH}, \textcolor{keyword}{sizeof}(uint64\_t));
157     packet[0] = \hyperlink{network_8h_a1162e12ce54e50cb3744e2cf69553565}{NET\_PACKET\_COOKIE\_RESPONSE};
158     \hyperlink{crypto__core_8c_a8b1033efb47c625779d11be7d8eb9e24}{new\_nonce}(packet + 1);
159     \textcolor{keywordtype}{int} len = \hyperlink{crypto__core_8c_a81efc0a4a6e0efe372651e26e342a6e5}{encrypt\_data\_symmetric}(shared\_key, packet + 1, plain, \textcolor{keyword}{sizeof}(plain), 
      packet + 1 + crypto\_box\_NONCEBYTES);
160 
161     \textcolor{keywordflow}{if} (len != \hyperlink{net__crypto_8c_a145d90f988058f15e869e94884d7f614}{COOKIE\_RESPONSE\_LENGTH} - (1 + crypto\_box\_NONCEBYTES))
162         \textcolor{keywordflow}{return} -1;
163 
164     \textcolor{keywordflow}{return} \hyperlink{net__crypto_8c_a145d90f988058f15e869e94884d7f614}{COOKIE\_RESPONSE\_LENGTH};
165 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_ab88b2226740cacde1112ee7fd13048d3_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_ab88b2226740cacde1112ee7fd13048d3_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_aed34560fc11f32d1b280d00152655b9b}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!create\+\_\+crypto\+\_\+connection@{create\+\_\+crypto\+\_\+connection}}
\index{create\+\_\+crypto\+\_\+connection@{create\+\_\+crypto\+\_\+connection}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{create\+\_\+crypto\+\_\+connection}]{\setlength{\rightskip}{0pt plus 5cm}static int create\+\_\+crypto\+\_\+connection (
\begin{DoxyParamCaption}
\item[{{\bf Net\+\_\+\+Crypto} $\ast$}]{c}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{net__crypto_8c_aed34560fc11f32d1b280d00152655b9b}


Definition at line 1375 of file net\+\_\+crypto.\+c.



References Net\+\_\+\+Crypto\+::connection\+\_\+use\+\_\+counter, Net\+\_\+\+Crypto\+::connections\+\_\+mutex, C\+R\+Y\+P\+T\+O\+\_\+\+C\+O\+N\+N\+\_\+\+N\+O\+\_\+\+C\+O\+N\+N\+E\+C\+T\+I\+O\+N, Net\+\_\+\+Crypto\+::crypto\+\_\+connections, Net\+\_\+\+Crypto\+::crypto\+\_\+connections\+\_\+length, i, Crypto\+\_\+\+Connection\+::mutex, realloc\+\_\+cryptoconnection(), and Crypto\+\_\+\+Connection\+::status.



Referenced by accept\+\_\+crypto\+\_\+connection(), and new\+\_\+crypto\+\_\+connection().


\begin{DoxyCode}
1376 \{
1377     uint32\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
1378 
1379     \textcolor{keywordflow}{for} (i = 0; i < c->\hyperlink{struct_net___crypto_a9c91c3c65885a2bd39d0f864b9a5ddb9}{crypto\_connections\_length}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
1380         \textcolor{keywordflow}{if} (c->\hyperlink{struct_net___crypto_a13fdc865b8a114466ba136f5390ec1b2}{crypto\_connections}[i].\hyperlink{struct_crypto___connection_ade818037fd6c985038ff29656089758d}{status} == 
      \hyperlink{net__crypto_8h_ab974dcadabde124fab5287024341f7a1}{CRYPTO\_CONN\_NO\_CONNECTION})
1381             \textcolor{keywordflow}{return} \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
1382     \}
1383 
1384     \textcolor{keywordflow}{while} (1) \{ \textcolor{comment}{/* TODO: is this really the best way to do this? */}
1385         pthread\_mutex\_lock(&c->\hyperlink{struct_net___crypto_a213135bf3b5b80b1cfe99b27dc42815e}{connections\_mutex});
1386 
1387         \textcolor{keywordflow}{if} (!c->\hyperlink{struct_net___crypto_ab5be057850e1cee67902276a69900326}{connection\_use\_counter}) \{
1388             \textcolor{keywordflow}{break};
1389         \}
1390 
1391         pthread\_mutex\_unlock(&c->\hyperlink{struct_net___crypto_a213135bf3b5b80b1cfe99b27dc42815e}{connections\_mutex});
1392     \}
1393 
1394     \textcolor{keywordtype}{int} \textcolor{keywordtype}{id} = -1;
1395 
1396     \textcolor{keywordflow}{if} (\hyperlink{net__crypto_8c_ab0b745274346dc3464e35fcd756db0d2}{realloc\_cryptoconnection}(c, c->
      \hyperlink{struct_net___crypto_a9c91c3c65885a2bd39d0f864b9a5ddb9}{crypto\_connections\_length} + 1) == 0) \{
1397         \textcolor{keywordtype}{id} = c->\hyperlink{struct_net___crypto_a9c91c3c65885a2bd39d0f864b9a5ddb9}{crypto\_connections\_length};
1398         ++c->\hyperlink{struct_net___crypto_a9c91c3c65885a2bd39d0f864b9a5ddb9}{crypto\_connections\_length};
1399         memset(&(c->\hyperlink{struct_net___crypto_a13fdc865b8a114466ba136f5390ec1b2}{crypto\_connections}[\textcolor{keywordtype}{id}]), 0, \textcolor{keyword}{sizeof}(
      \hyperlink{struct_crypto___connection}{Crypto\_Connection}));
1400 
1401         \textcolor{keywordflow}{if} (pthread\_mutex\_init(&c->\hyperlink{struct_net___crypto_a13fdc865b8a114466ba136f5390ec1b2}{crypto\_connections}[\textcolor{keywordtype}{id}].
      \hyperlink{struct_crypto___connection_a4acff8232e4aec9cd5c6dc200ac55ef3}{mutex}, NULL) != 0) \{
1402             pthread\_mutex\_unlock(&c->\hyperlink{struct_net___crypto_a213135bf3b5b80b1cfe99b27dc42815e}{connections\_mutex});
1403             \textcolor{keywordflow}{return} -1;
1404         \}
1405     \}
1406 
1407     pthread\_mutex\_unlock(&c->\hyperlink{struct_net___crypto_a213135bf3b5b80b1cfe99b27dc42815e}{connections\_mutex});
1408     \textcolor{keywordflow}{return} \hyperlink{struct_file___transfers_aa32dbb3439461c6ccc1a52ff15bcb22e}{id};
1409 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_aed34560fc11f32d1b280d00152655b9b_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_aed34560fc11f32d1b280d00152655b9b_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_a152a683d32712d0d91bfe1f4497c9485}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!create\+\_\+crypto\+\_\+handshake@{create\+\_\+crypto\+\_\+handshake}}
\index{create\+\_\+crypto\+\_\+handshake@{create\+\_\+crypto\+\_\+handshake}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{create\+\_\+crypto\+\_\+handshake}]{\setlength{\rightskip}{0pt plus 5cm}static int create\+\_\+crypto\+\_\+handshake (
\begin{DoxyParamCaption}
\item[{const {\bf Net\+\_\+\+Crypto} $\ast$}]{c, }
\item[{uint8\+\_\+t $\ast$}]{packet, }
\item[{const uint8\+\_\+t $\ast$}]{cookie, }
\item[{const uint8\+\_\+t $\ast$}]{nonce, }
\item[{const uint8\+\_\+t $\ast$}]{session\+\_\+pk, }
\item[{const uint8\+\_\+t $\ast$}]{peer\+\_\+real\+\_\+pk, }
\item[{const uint8\+\_\+t $\ast$}]{peer\+\_\+dht\+\_\+pubkey}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{net__crypto_8c_a152a683d32712d0d91bfe1f4497c9485}


Definition at line 294 of file net\+\_\+crypto.\+c.



References C\+O\+O\+K\+I\+E\+\_\+\+D\+A\+T\+A\+\_\+\+L\+E\+N\+G\+T\+H, C\+O\+O\+K\+I\+E\+\_\+\+L\+E\+N\+G\+T\+H, create\+\_\+cookie(), encrypt\+\_\+data(), H\+A\+N\+D\+S\+H\+A\+K\+E\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+L\+E\+N\+G\+T\+H, N\+E\+T\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+C\+R\+Y\+P\+T\+O\+\_\+\+H\+S, new\+\_\+nonce(), Net\+\_\+\+Crypto\+::secret\+\_\+symmetric\+\_\+key, and Net\+\_\+\+Crypto\+::self\+\_\+secret\+\_\+key.



Referenced by create\+\_\+send\+\_\+handshake().


\begin{DoxyCode}
296 \{
297     uint8\_t plain[crypto\_box\_NONCEBYTES + crypto\_box\_PUBLICKEYBYTES + crypto\_hash\_sha512\_BYTES + 
      \hyperlink{net__crypto_8c_a905c0a7642c878ca482e2d7aff7d670c}{COOKIE\_LENGTH}];
298     memcpy(plain, \hyperlink{crypto__test_8c_a7932c523f7065073a396e571319201ce}{nonce}, crypto\_box\_NONCEBYTES);
299     memcpy(plain + crypto\_box\_NONCEBYTES, session\_pk, crypto\_box\_PUBLICKEYBYTES);
300     crypto\_hash\_sha512(plain + crypto\_box\_NONCEBYTES + crypto\_box\_PUBLICKEYBYTES, cookie, 
      \hyperlink{net__crypto_8c_a905c0a7642c878ca482e2d7aff7d670c}{COOKIE\_LENGTH});
301     uint8\_t cookie\_plain[\hyperlink{net__crypto_8c_ada1ab442f8ac484c80c15260ab737cab}{COOKIE\_DATA\_LENGTH}];
302     memcpy(cookie\_plain, peer\_real\_pk, crypto\_box\_PUBLICKEYBYTES);
303     memcpy(cookie\_plain + crypto\_box\_PUBLICKEYBYTES, peer\_dht\_pubkey, crypto\_box\_PUBLICKEYBYTES);
304 
305     \textcolor{keywordflow}{if} (\hyperlink{net__crypto_8c_ad630e2753f088cf9ccd45babe8719532}{create\_cookie}(plain + crypto\_box\_NONCEBYTES + crypto\_box\_PUBLICKEYBYTES + 
      crypto\_hash\_sha512\_BYTES, cookie\_plain,
306                       c->\hyperlink{struct_net___crypto_ab9f2ff47bc0b1e5110202a6e4be86390}{secret\_symmetric\_key}) != 0)
307         \textcolor{keywordflow}{return} -1;
308 
309     \hyperlink{crypto__core_8c_a8b1033efb47c625779d11be7d8eb9e24}{new\_nonce}(packet + 1 + \hyperlink{net__crypto_8c_a905c0a7642c878ca482e2d7aff7d670c}{COOKIE\_LENGTH});
310     \textcolor{keywordtype}{int} len = \hyperlink{crypto__core_8c_a014149333522d211490304255e139ec3}{encrypt\_data}(peer\_real\_pk, c->\hyperlink{struct_net___crypto_aa05050f86513ff53fe9da81f73c72267}{self\_secret\_key}, packet + 1 + 
      \hyperlink{net__crypto_8c_a905c0a7642c878ca482e2d7aff7d670c}{COOKIE\_LENGTH}, plain, \textcolor{keyword}{sizeof}(plain),
311                            packet + 1 + \hyperlink{net__crypto_8c_a905c0a7642c878ca482e2d7aff7d670c}{COOKIE\_LENGTH} + crypto\_box\_NONCEBYTES);
312 
313     \textcolor{keywordflow}{if} (len != \hyperlink{net__crypto_8c_aae5268846bab0f3dcfe6071d0442d89e}{HANDSHAKE\_PACKET\_LENGTH} - (1 + 
      \hyperlink{net__crypto_8c_a905c0a7642c878ca482e2d7aff7d670c}{COOKIE\_LENGTH} + crypto\_box\_NONCEBYTES))
314         \textcolor{keywordflow}{return} -1;
315 
316     packet[0] = \hyperlink{network_8h_ae4ba32f7f36e935bd3a56b5e90299857}{NET\_PACKET\_CRYPTO\_HS};
317     memcpy(packet + 1, cookie, \hyperlink{net__crypto_8c_a905c0a7642c878ca482e2d7aff7d670c}{COOKIE\_LENGTH});
318 
319     \textcolor{keywordflow}{return} \hyperlink{net__crypto_8c_aae5268846bab0f3dcfe6071d0442d89e}{HANDSHAKE\_PACKET\_LENGTH};
320 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a152a683d32712d0d91bfe1f4497c9485_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a152a683d32712d0d91bfe1f4497c9485_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_ad2ca4aad15dc0607252aa21cd525b5ba}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!create\+\_\+send\+\_\+handshake@{create\+\_\+send\+\_\+handshake}}
\index{create\+\_\+send\+\_\+handshake@{create\+\_\+send\+\_\+handshake}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{create\+\_\+send\+\_\+handshake}]{\setlength{\rightskip}{0pt plus 5cm}static int create\+\_\+send\+\_\+handshake (
\begin{DoxyParamCaption}
\item[{{\bf Net\+\_\+\+Crypto} $\ast$}]{c, }
\item[{int}]{crypt\+\_\+connection\+\_\+id, }
\item[{const uint8\+\_\+t $\ast$}]{cookie, }
\item[{const uint8\+\_\+t $\ast$}]{dht\+\_\+public\+\_\+key}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{net__crypto_8c_ad2ca4aad15dc0607252aa21cd525b5ba}


Definition at line 1081 of file net\+\_\+crypto.\+c.



References create\+\_\+crypto\+\_\+handshake(), get\+\_\+crypto\+\_\+connection(), H\+A\+N\+D\+S\+H\+A\+K\+E\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+L\+E\+N\+G\+T\+H, new\+\_\+temp\+\_\+packet(), Crypto\+\_\+\+Connection\+::public\+\_\+key, send\+\_\+temp\+\_\+packet(), Crypto\+\_\+\+Connection\+::sent\+\_\+nonce, and Crypto\+\_\+\+Connection\+::sessionpublic\+\_\+key.



Referenced by accept\+\_\+crypto\+\_\+connection(), handle\+\_\+new\+\_\+connection\+\_\+handshake(), and handle\+\_\+packet\+\_\+connection().


\begin{DoxyCode}
1083 \{
1084     \hyperlink{struct_crypto___connection}{Crypto\_Connection} *conn = \hyperlink{net__crypto_8c_a909daa4b6d420cbd028f2c956a8642db}{get\_crypto\_connection}(c, 
      crypt\_connection\_id);
1085 
1086     \textcolor{keywordflow}{if} (conn == 0)
1087         \textcolor{keywordflow}{return} -1;
1088 
1089     uint8\_t handshake\_packet[\hyperlink{net__crypto_8c_aae5268846bab0f3dcfe6071d0442d89e}{HANDSHAKE\_PACKET\_LENGTH}];
1090 
1091     \textcolor{keywordflow}{if} (\hyperlink{net__crypto_8c_a152a683d32712d0d91bfe1f4497c9485}{create\_crypto\_handshake}(c, handshake\_packet, cookie, conn->
      \hyperlink{struct_crypto___connection_a9df0e00e8f493ed6cd1ff45e7da33c0d}{sent\_nonce}, conn->\hyperlink{struct_crypto___connection_a6e74fbae398c7966800ee80f7b93dbfa}{sessionpublic\_key},
1092                                 conn->\hyperlink{struct_crypto___connection_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, dht\_public\_key) != \textcolor{keyword}{sizeof}(handshake\_packet))
1093         \textcolor{keywordflow}{return} -1;
1094 
1095     \textcolor{keywordflow}{if} (\hyperlink{net__crypto_8c_aa762d8aa84aa2c0a9cd48fa3d93856b1}{new\_temp\_packet}(c, crypt\_connection\_id, handshake\_packet, \textcolor{keyword}{sizeof}(handshake\_packet)) 
      != 0)
1096         \textcolor{keywordflow}{return} -1;
1097 
1098     \hyperlink{net__crypto_8c_ae0a00f5fe1955d7d15af11eacc20997b}{send\_temp\_packet}(c, crypt\_connection\_id);
1099     \textcolor{keywordflow}{return} 0;
1100 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_ad2ca4aad15dc0607252aa21cd525b5ba_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_ad2ca4aad15dc0607252aa21cd525b5ba_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_a8aae93bf17f0b4a4305b88334e820310}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!crypt\+\_\+connection\+\_\+id\+\_\+not\+\_\+valid@{crypt\+\_\+connection\+\_\+id\+\_\+not\+\_\+valid}}
\index{crypt\+\_\+connection\+\_\+id\+\_\+not\+\_\+valid@{crypt\+\_\+connection\+\_\+id\+\_\+not\+\_\+valid}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{crypt\+\_\+connection\+\_\+id\+\_\+not\+\_\+valid}]{\setlength{\rightskip}{0pt plus 5cm}static uint8\+\_\+t crypt\+\_\+connection\+\_\+id\+\_\+not\+\_\+valid (
\begin{DoxyParamCaption}
\item[{const {\bf Net\+\_\+\+Crypto} $\ast$}]{c, }
\item[{int}]{crypt\+\_\+connection\+\_\+id}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{net__crypto_8c_a8aae93bf17f0b4a4305b88334e820310}


Definition at line 35 of file net\+\_\+crypto.\+c.



References C\+R\+Y\+P\+T\+O\+\_\+\+C\+O\+N\+N\+\_\+\+N\+O\+\_\+\+C\+O\+N\+N\+E\+C\+T\+I\+O\+N, Net\+\_\+\+Crypto\+::crypto\+\_\+connections, Net\+\_\+\+Crypto\+::crypto\+\_\+connections\+\_\+length, and Crypto\+\_\+\+Connection\+::status.



Referenced by get\+\_\+crypto\+\_\+connection(), and wipe\+\_\+crypto\+\_\+connection().


\begin{DoxyCode}
36 \{
37     \textcolor{keywordflow}{if} ((uint32\_t)crypt\_connection\_id >= c->\hyperlink{struct_net___crypto_a9c91c3c65885a2bd39d0f864b9a5ddb9}{crypto\_connections\_length})
38         \textcolor{keywordflow}{return} 1;
39 
40     \textcolor{keywordflow}{if} (c->\hyperlink{struct_net___crypto_a13fdc865b8a114466ba136f5390ec1b2}{crypto\_connections} == NULL)
41         \textcolor{keywordflow}{return} 1;
42 
43     \textcolor{keywordflow}{if} (c->\hyperlink{struct_net___crypto_a13fdc865b8a114466ba136f5390ec1b2}{crypto\_connections}[crypt\_connection\_id].\hyperlink{struct_crypto___connection_ade818037fd6c985038ff29656089758d}{status} == 
      \hyperlink{net__crypto_8h_ab974dcadabde124fab5287024341f7a1}{CRYPTO\_CONN\_NO\_CONNECTION})
44         \textcolor{keywordflow}{return} 1;
45 
46     \textcolor{keywordflow}{return} 0;
47 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a8aae93bf17f0b4a4305b88334e820310_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_a9e779393ece10111b0ac7fe2bbc3beeb}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!crypto\+\_\+connection\+\_\+add\+\_\+source@{crypto\+\_\+connection\+\_\+add\+\_\+source}}
\index{crypto\+\_\+connection\+\_\+add\+\_\+source@{crypto\+\_\+connection\+\_\+add\+\_\+source}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{crypto\+\_\+connection\+\_\+add\+\_\+source}]{\setlength{\rightskip}{0pt plus 5cm}static int crypto\+\_\+connection\+\_\+add\+\_\+source (
\begin{DoxyParamCaption}
\item[{{\bf Net\+\_\+\+Crypto} $\ast$}]{c, }
\item[{int}]{crypt\+\_\+connection\+\_\+id, }
\item[{{\bf I\+P\+\_\+\+Port}}]{source}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{net__crypto_8c_a9e779393ece10111b0ac7fe2bbc3beeb}


Definition at line 1469 of file net\+\_\+crypto.\+c.



References add\+\_\+tcp\+\_\+number\+\_\+relay\+\_\+connection(), bs\+\_\+list\+\_\+add(), bs\+\_\+list\+\_\+remove(), Crypto\+\_\+\+Connection\+::connection\+\_\+number\+\_\+tcp, Crypto\+\_\+\+Connection\+::direct\+\_\+lastrecv\+\_\+time, I\+P\+::family, get\+\_\+crypto\+\_\+connection(), I\+P\+\_\+\+Port\+::ip, I\+P\+::ip6, Crypto\+\_\+\+Connection\+::ip\+\_\+port, Net\+\_\+\+Crypto\+::ip\+\_\+port\+\_\+list, ipport\+\_\+equal(), Net\+\_\+\+Crypto\+::tcp\+\_\+c, T\+C\+P\+\_\+\+F\+A\+M\+I\+L\+Y, I\+P6\+::uint32, and unix\+\_\+time().



Referenced by accept\+\_\+crypto\+\_\+connection(), and handle\+\_\+new\+\_\+connection\+\_\+handshake().


\begin{DoxyCode}
1470 \{
1471     \hyperlink{struct_crypto___connection}{Crypto\_Connection} *conn = \hyperlink{net__crypto_8c_a909daa4b6d420cbd028f2c956a8642db}{get\_crypto\_connection}(c, 
      crypt\_connection\_id);
1472 
1473     \textcolor{keywordflow}{if} (conn == 0)
1474         \textcolor{keywordflow}{return} -1;
1475 
1476     \textcolor{keywordflow}{if} (source.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} == AF\_INET || source.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} == AF\_INET6) \{
1477         \textcolor{keywordflow}{if} (!\hyperlink{network_8c_a6913335cf0b2a76303f5f61d18ea2277}{ipport\_equal}(&source, &conn->\hyperlink{struct_crypto___connection_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port})) \{
1478             \textcolor{keywordflow}{if} (!\hyperlink{list_8c_ace05755dd126bff18700a17d6f8edd28}{bs\_list\_add}(&c->\hyperlink{struct_net___crypto_ae8cfe94df9c9030bbc525010603450ac}{ip\_port\_list}, (uint8\_t *)&source, 
      crypt\_connection\_id))
1479                 \textcolor{keywordflow}{return} -1;
1480 
1481             \hyperlink{list_8c_a365995457101cc16f8c6b25ead07fb6f}{bs\_list\_remove}(&c->\hyperlink{struct_net___crypto_ae8cfe94df9c9030bbc525010603450ac}{ip\_port\_list}, (uint8\_t *)&conn->
      \hyperlink{struct_crypto___connection_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}, crypt\_connection\_id);
1482             conn->\hyperlink{struct_crypto___connection_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port} = source;
1483         \}
1484 
1485         conn->\hyperlink{struct_crypto___connection_ac6eb8a274b0dedea83359f2d9269cbc2}{direct\_lastrecv\_time} = \hyperlink{util_8c_ac958d9f8847cb8039444bfa3d304233a}{unix\_time}();
1486         \textcolor{keywordflow}{return} 0;
1487     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (source.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} == \hyperlink{network_8h_a8b8d4bdf23eea1681ac4126938f587ec}{TCP\_FAMILY}) \{
1488         \textcolor{keywordflow}{if} (\hyperlink{_t_c_p__connection_8c_af7a3111a46b9cb6947452393a2cbea31}{add\_tcp\_number\_relay\_connection}(c->
      \hyperlink{struct_net___crypto_a179982a02be89eaf6617ed81bd3c0961}{tcp\_c}, conn->\hyperlink{struct_crypto___connection_a51666aaba0fc5680040fe5bd6778bc50}{connection\_number\_tcp}, source.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_a14c606eb5ffb078c38ad854dc4e79507}{ip6}.
      \hyperlink{union_i_p6_a1d8ab1f6c1da5565bed41e7095610dea}{uint32}[0]) == 0)
1489             \textcolor{keywordflow}{return} 1;
1490     \}
1491 
1492     \textcolor{keywordflow}{return} -1;
1493 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a9e779393ece10111b0ac7fe2bbc3beeb_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a9e779393ece10111b0ac7fe2bbc3beeb_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_afb5c59e6df7f38fe0bdf9e0f6c459869}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!crypto\+\_\+connection\+\_\+status@{crypto\+\_\+connection\+\_\+status}}
\index{crypto\+\_\+connection\+\_\+status@{crypto\+\_\+connection\+\_\+status}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{crypto\+\_\+connection\+\_\+status}]{\setlength{\rightskip}{0pt plus 5cm}unsigned int crypto\+\_\+connection\+\_\+status (
\begin{DoxyParamCaption}
\item[{const {\bf Net\+\_\+\+Crypto} $\ast$}]{c, }
\item[{int}]{crypt\+\_\+connection\+\_\+id, }
\item[{\+\_\+\+Bool $\ast$}]{direct\+\_\+connected, }
\item[{unsigned int $\ast$}]{online\+\_\+tcp\+\_\+relays}
\end{DoxyParamCaption}
)}}\label{net__crypto_8c_afb5c59e6df7f38fe0bdf9e0f6c459869}


Definition at line 2364 of file net\+\_\+crypto.\+c.



References Crypto\+\_\+\+Connection\+::connection\+\_\+number\+\_\+tcp, C\+R\+Y\+P\+T\+O\+\_\+\+C\+O\+N\+N\+\_\+\+N\+O\+\_\+\+C\+O\+N\+N\+E\+C\+T\+I\+O\+N, Crypto\+\_\+\+Connection\+::direct\+\_\+lastrecv\+\_\+time, get\+\_\+crypto\+\_\+connection(), Crypto\+\_\+\+Connection\+::status, Net\+\_\+\+Crypto\+::tcp\+\_\+c, tcp\+\_\+connection\+\_\+to\+\_\+online\+\_\+tcp\+\_\+relays(), U\+D\+P\+\_\+\+D\+I\+R\+E\+C\+T\+\_\+\+T\+I\+M\+E\+O\+U\+T, and unix\+\_\+time().



Referenced by do\+\_\+tcp(), m\+\_\+get\+\_\+friend\+\_\+connectionstatus(), and send\+\_\+packet\+\_\+to().


\begin{DoxyCode}
2366 \{
2367     \hyperlink{struct_crypto___connection}{Crypto\_Connection} *conn = \hyperlink{net__crypto_8c_a909daa4b6d420cbd028f2c956a8642db}{get\_crypto\_connection}(c, 
      crypt\_connection\_id);
2368 
2369     \textcolor{keywordflow}{if} (conn == 0)
2370         \textcolor{keywordflow}{return} \hyperlink{net__crypto_8h_ab974dcadabde124fab5287024341f7a1}{CRYPTO\_CONN\_NO\_CONNECTION};
2371 
2372     \textcolor{keywordflow}{if} (direct\_connected) \{
2373         *direct\_connected = 0;
2374 
2375         \textcolor{keywordflow}{if} ((\hyperlink{net__crypto_8h_a0c533e2029f9b1bdb8a368a7308253c0}{UDP\_DIRECT\_TIMEOUT} + conn->\hyperlink{struct_crypto___connection_ac6eb8a274b0dedea83359f2d9269cbc2}{direct\_lastrecv\_time}) > 
      \hyperlink{util_8c_ac958d9f8847cb8039444bfa3d304233a}{unix\_time}())
2376             *direct\_connected = 1;
2377     \}
2378 
2379     \textcolor{keywordflow}{if} (online\_tcp\_relays) \{
2380         *online\_tcp\_relays = \hyperlink{_t_c_p__connection_8c_ae843b0b4c8041f08bf9c18f68cae8a61}{tcp\_connection\_to\_online\_tcp\_relays}(c->
      \hyperlink{struct_net___crypto_a179982a02be89eaf6617ed81bd3c0961}{tcp\_c}, conn->\hyperlink{struct_crypto___connection_a51666aaba0fc5680040fe5bd6778bc50}{connection\_number\_tcp});
2381     \}
2382 
2383     \textcolor{keywordflow}{return} conn->\hyperlink{struct_crypto___connection_ade818037fd6c985038ff29656089758d}{status};
2384 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_afb5c59e6df7f38fe0bdf9e0f6c459869_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_afb5c59e6df7f38fe0bdf9e0f6c459869_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_ace680157da68eb91755350d0cb14cd8f}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!crypto\+\_\+id\+\_\+ip\+\_\+port@{crypto\+\_\+id\+\_\+ip\+\_\+port}}
\index{crypto\+\_\+id\+\_\+ip\+\_\+port@{crypto\+\_\+id\+\_\+ip\+\_\+port}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{crypto\+\_\+id\+\_\+ip\+\_\+port}]{\setlength{\rightskip}{0pt plus 5cm}static int crypto\+\_\+id\+\_\+ip\+\_\+port (
\begin{DoxyParamCaption}
\item[{const {\bf Net\+\_\+\+Crypto} $\ast$}]{c, }
\item[{{\bf I\+P\+\_\+\+Port}}]{ip\+\_\+port}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{net__crypto_8c_ace680157da68eb91755350d0cb14cd8f}


Definition at line 1980 of file net\+\_\+crypto.\+c.



References bs\+\_\+list\+\_\+find(), and Net\+\_\+\+Crypto\+::ip\+\_\+port\+\_\+list.



Referenced by udp\+\_\+handle\+\_\+packet().


\begin{DoxyCode}
1981 \{
1982     \textcolor{keywordflow}{return} \hyperlink{list_8c_aa2ee2cbbc130c7c976f2c69bda129bd1}{bs\_list\_find}(&c->\hyperlink{struct_net___crypto_ae8cfe94df9c9030bbc525010603450ac}{ip\_port\_list}, (uint8\_t *)&ip\_port);
1983 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=341pt]{d8/dc6/net__crypto_8c_ace680157da68eb91755350d0cb14cd8f_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_ace680157da68eb91755350d0cb14cd8f_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_a16c3a0008512675dad8eb00ff1822763}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!crypto\+\_\+kill@{crypto\+\_\+kill}}
\index{crypto\+\_\+kill@{crypto\+\_\+kill}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{crypto\+\_\+kill}]{\setlength{\rightskip}{0pt plus 5cm}int crypto\+\_\+kill (
\begin{DoxyParamCaption}
\item[{{\bf Net\+\_\+\+Crypto} $\ast$}]{c, }
\item[{int}]{crypt\+\_\+connection\+\_\+id}
\end{DoxyParamCaption}
)}}\label{net__crypto_8c_a16c3a0008512675dad8eb00ff1822763}


Definition at line 2323 of file net\+\_\+crypto.\+c.



References bs\+\_\+list\+\_\+remove(), clear\+\_\+buffer(), clear\+\_\+temp\+\_\+packet(), Crypto\+\_\+\+Connection\+::connection\+\_\+number\+\_\+tcp, Net\+\_\+\+Crypto\+::connection\+\_\+use\+\_\+counter, Net\+\_\+\+Crypto\+::connections\+\_\+mutex, C\+R\+Y\+P\+T\+O\+\_\+\+C\+O\+N\+N\+\_\+\+E\+S\+T\+A\+B\+L\+I\+S\+H\+E\+D, get\+\_\+crypto\+\_\+connection(), Crypto\+\_\+\+Connection\+::ip\+\_\+port, Net\+\_\+\+Crypto\+::ip\+\_\+port\+\_\+list, kill\+\_\+tcp\+\_\+connection\+\_\+to(), Crypto\+\_\+\+Connection\+::recv\+\_\+array, Crypto\+\_\+\+Connection\+::send\+\_\+array, send\+\_\+kill\+\_\+packet(), Crypto\+\_\+\+Connection\+::status, Net\+\_\+\+Crypto\+::tcp\+\_\+c, Net\+\_\+\+Crypto\+::tcp\+\_\+mutex, and wipe\+\_\+crypto\+\_\+connection().



Referenced by connection\+\_\+kill(), dht\+\_\+pk\+\_\+callback(), do\+\_\+friend\+\_\+connections(), kill\+\_\+friend\+\_\+connection(), and kill\+\_\+net\+\_\+crypto().


\begin{DoxyCode}
2324 \{
2325     \textcolor{keywordflow}{while} (1) \{ \textcolor{comment}{/* TODO: is this really the best way to do this? */}
2326         pthread\_mutex\_lock(&c->\hyperlink{struct_net___crypto_a213135bf3b5b80b1cfe99b27dc42815e}{connections\_mutex});
2327 
2328         \textcolor{keywordflow}{if} (!c->\hyperlink{struct_net___crypto_ab5be057850e1cee67902276a69900326}{connection\_use\_counter}) \{
2329             \textcolor{keywordflow}{break};
2330         \}
2331 
2332         pthread\_mutex\_unlock(&c->\hyperlink{struct_net___crypto_a213135bf3b5b80b1cfe99b27dc42815e}{connections\_mutex});
2333     \}
2334 
2335     \hyperlink{struct_crypto___connection}{Crypto\_Connection} *conn = \hyperlink{net__crypto_8c_a909daa4b6d420cbd028f2c956a8642db}{get\_crypto\_connection}(c, 
      crypt\_connection\_id);
2336 
2337     \textcolor{keywordtype}{int} ret = -1;
2338 
2339     \textcolor{keywordflow}{if} (conn) \{
2340         \textcolor{keywordflow}{if} (conn->\hyperlink{struct_crypto___connection_ade818037fd6c985038ff29656089758d}{status} == \hyperlink{net__crypto_8h_ae15ad1cc9a29a669e0df83d610c188b0}{CRYPTO\_CONN\_ESTABLISHED})
2341             \hyperlink{net__crypto_8c_aef6ea83ebc4f62428b09ee74441f6f4b}{send\_kill\_packet}(c, crypt\_connection\_id);
2342 
2343         pthread\_mutex\_lock(&c->\hyperlink{struct_net___crypto_a2e8f7f4dff2f2fc4ac2cc32b0c886974}{tcp\_mutex});
2344         \hyperlink{_t_c_p__connection_8c_a2369688a49bef46cb2029b3bb680e11d}{kill\_tcp\_connection\_to}(c->\hyperlink{struct_net___crypto_a179982a02be89eaf6617ed81bd3c0961}{tcp\_c}, conn->
      \hyperlink{struct_crypto___connection_a51666aaba0fc5680040fe5bd6778bc50}{connection\_number\_tcp});
2345         pthread\_mutex\_unlock(&c->\hyperlink{struct_net___crypto_a2e8f7f4dff2f2fc4ac2cc32b0c886974}{tcp\_mutex});
2346 
2347         \hyperlink{list_8c_a365995457101cc16f8c6b25ead07fb6f}{bs\_list\_remove}(&c->\hyperlink{struct_net___crypto_ae8cfe94df9c9030bbc525010603450ac}{ip\_port\_list}, (uint8\_t *)&conn->
      \hyperlink{struct_crypto___connection_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}, crypt\_connection\_id);
2348         \hyperlink{net__crypto_8c_a6e6c3107cf48ec1c5087d3780a03ad0c}{clear\_temp\_packet}(c, crypt\_connection\_id);
2349         \hyperlink{net__crypto_8c_ae690bbce7d008eda1142ceaf0673e672}{clear\_buffer}(&conn->\hyperlink{struct_crypto___connection_aa9112ee7e76eb3e870491f7c5c272197}{send\_array});
2350         \hyperlink{net__crypto_8c_ae690bbce7d008eda1142ceaf0673e672}{clear\_buffer}(&conn->\hyperlink{struct_crypto___connection_a1a62bc0c4bb9e349735c65f9948020d5}{recv\_array});
2351         ret = \hyperlink{net__crypto_8c_a7be52b4dc75558fc64e9e017ea67f1d0}{wipe\_crypto\_connection}(c, crypt\_connection\_id);
2352     \}
2353 
2354     pthread\_mutex\_unlock(&c->\hyperlink{struct_net___crypto_a213135bf3b5b80b1cfe99b27dc42815e}{connections\_mutex});
2355 
2356     \textcolor{keywordflow}{return} ret;
2357 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a16c3a0008512675dad8eb00ff1822763_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a16c3a0008512675dad8eb00ff1822763_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_a4680603c9714e8742ad580b74ff1d891}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!crypto\+\_\+num\+\_\+free\+\_\+sendqueue\+\_\+slots@{crypto\+\_\+num\+\_\+free\+\_\+sendqueue\+\_\+slots}}
\index{crypto\+\_\+num\+\_\+free\+\_\+sendqueue\+\_\+slots@{crypto\+\_\+num\+\_\+free\+\_\+sendqueue\+\_\+slots}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{crypto\+\_\+num\+\_\+free\+\_\+sendqueue\+\_\+slots}]{\setlength{\rightskip}{0pt plus 5cm}uint32\+\_\+t crypto\+\_\+num\+\_\+free\+\_\+sendqueue\+\_\+slots (
\begin{DoxyParamCaption}
\item[{const {\bf Net\+\_\+\+Crypto} $\ast$}]{c, }
\item[{int}]{crypt\+\_\+connection\+\_\+id}
\end{DoxyParamCaption}
)}}\label{net__crypto_8c_a4680603c9714e8742ad580b74ff1d891}


Definition at line 2196 of file net\+\_\+crypto.\+c.



References C\+R\+Y\+P\+T\+O\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+B\+U\+F\+F\+E\+R\+\_\+\+S\+I\+Z\+E, get\+\_\+crypto\+\_\+connection(), num\+\_\+packets\+\_\+array(), Crypto\+\_\+\+Connection\+::packets\+\_\+left, and Crypto\+\_\+\+Connection\+::send\+\_\+array.



Referenced by do\+\_\+reqchunk\+\_\+filecb(), and file\+\_\+data().


\begin{DoxyCode}
2197 \{
2198     \hyperlink{struct_crypto___connection}{Crypto\_Connection} *conn = \hyperlink{net__crypto_8c_a909daa4b6d420cbd028f2c956a8642db}{get\_crypto\_connection}(c, 
      crypt\_connection\_id);
2199 
2200     \textcolor{keywordflow}{if} (conn == 0)
2201         \textcolor{keywordflow}{return} 0;
2202 
2203     uint32\_t max\_packets = \hyperlink{net__crypto_8h_ac73cf1eb0a938f0962ddc607945636f4}{CRYPTO\_PACKET\_BUFFER\_SIZE} - 
      \hyperlink{net__crypto_8c_abbe1101e6464100c19aea7cde5c1d3a0}{num\_packets\_array}(&conn->\hyperlink{struct_crypto___connection_aa9112ee7e76eb3e870491f7c5c272197}{send\_array});
2204 
2205     \textcolor{keywordflow}{if} (conn->\hyperlink{struct_crypto___connection_adfabcbe80305cc6b4e1c0dfef5c48653}{packets\_left} < max\_packets) \{
2206         \textcolor{keywordflow}{return} conn->\hyperlink{struct_crypto___connection_adfabcbe80305cc6b4e1c0dfef5c48653}{packets\_left};
2207     \} \textcolor{keywordflow}{else} \{
2208         \textcolor{keywordflow}{return} max\_packets;
2209     \}
2210 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a4680603c9714e8742ad580b74ff1d891_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a4680603c9714e8742ad580b74ff1d891_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_af0fcda7ce07347179ae4f327489c7643}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!crypto\+\_\+run\+\_\+interval@{crypto\+\_\+run\+\_\+interval}}
\index{crypto\+\_\+run\+\_\+interval@{crypto\+\_\+run\+\_\+interval}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{crypto\+\_\+run\+\_\+interval}]{\setlength{\rightskip}{0pt plus 5cm}uint32\+\_\+t crypto\+\_\+run\+\_\+interval (
\begin{DoxyParamCaption}
\item[{const {\bf Net\+\_\+\+Crypto} $\ast$}]{c}
\end{DoxyParamCaption}
)}}\label{net__crypto_8c_af0fcda7ce07347179ae4f327489c7643}


Definition at line 2491 of file net\+\_\+crypto.\+c.



References Net\+\_\+\+Crypto\+::current\+\_\+sleep\+\_\+time.



Referenced by messenger\+\_\+run\+\_\+interval().


\begin{DoxyCode}
2492 \{
2493     \textcolor{keywordflow}{return} c->\hyperlink{struct_net___crypto_a86823a02e323235811eada4755e3f81e}{current\_sleep\_time};
2494 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_af0fcda7ce07347179ae4f327489c7643_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_a8ced352d973b7f835224854ef97f4407}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!cryptpacket\+\_\+received@{cryptpacket\+\_\+received}}
\index{cryptpacket\+\_\+received@{cryptpacket\+\_\+received}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{cryptpacket\+\_\+received}]{\setlength{\rightskip}{0pt plus 5cm}int cryptpacket\+\_\+received (
\begin{DoxyParamCaption}
\item[{{\bf Net\+\_\+\+Crypto} $\ast$}]{c, }
\item[{int}]{crypt\+\_\+connection\+\_\+id, }
\item[{uint32\+\_\+t}]{packet\+\_\+number}
\end{DoxyParamCaption}
)}}\label{net__crypto_8c_a8ced352d973b7f835224854ef97f4407}


Definition at line 2262 of file net\+\_\+crypto.\+c.



References Packets\+\_\+\+Array\+::buffer\+\_\+end, Packets\+\_\+\+Array\+::buffer\+\_\+start, get\+\_\+crypto\+\_\+connection(), num, and Crypto\+\_\+\+Connection\+::send\+\_\+array.



Referenced by friend\+\_\+received\+\_\+packet().


\begin{DoxyCode}
2263 \{
2264     \hyperlink{struct_crypto___connection}{Crypto\_Connection} *conn = \hyperlink{net__crypto_8c_a909daa4b6d420cbd028f2c956a8642db}{get\_crypto\_connection}(c, 
      crypt\_connection\_id);
2265 
2266     \textcolor{keywordflow}{if} (conn == 0)
2267         \textcolor{keywordflow}{return} -1;
2268 
2269     uint32\_t \hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num} = conn->\hyperlink{struct_crypto___connection_aa9112ee7e76eb3e870491f7c5c272197}{send\_array}.\hyperlink{struct_packets___array_a66d710e0093872b26ee80118c1a85d99}{buffer\_end} - conn->
      \hyperlink{struct_crypto___connection_aa9112ee7e76eb3e870491f7c5c272197}{send\_array}.\hyperlink{struct_packets___array_a85973b335814248c05f63543876b348e}{buffer\_start};
2270     uint32\_t num1 = packet\_number - conn->\hyperlink{struct_crypto___connection_aa9112ee7e76eb3e870491f7c5c272197}{send\_array}.\hyperlink{struct_packets___array_a85973b335814248c05f63543876b348e}{buffer\_start};
2271 
2272     \textcolor{keywordflow}{if} (num < num1) \{
2273         \textcolor{keywordflow}{return} 0;
2274     \} \textcolor{keywordflow}{else} \{
2275         \textcolor{keywordflow}{return} -1;
2276     \}
2277 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a8ced352d973b7f835224854ef97f4407_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a8ced352d973b7f835224854ef97f4407_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_a6fa028eb320bf09ecd619c5053580436}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!do\+\_\+net\+\_\+crypto@{do\+\_\+net\+\_\+crypto}}
\index{do\+\_\+net\+\_\+crypto@{do\+\_\+net\+\_\+crypto}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{do\+\_\+net\+\_\+crypto}]{\setlength{\rightskip}{0pt plus 5cm}void do\+\_\+net\+\_\+crypto (
\begin{DoxyParamCaption}
\item[{{\bf Net\+\_\+\+Crypto} $\ast$}]{c}
\end{DoxyParamCaption}
)}}\label{net__crypto_8c_a6fa028eb320bf09ecd619c5053580436}


Definition at line 2497 of file net\+\_\+crypto.\+c.



References do\+\_\+tcp(), kill\+\_\+timedout(), send\+\_\+crypto\+\_\+packets(), and unix\+\_\+time\+\_\+update().



Referenced by do\+\_\+messenger().


\begin{DoxyCode}
2498 \{
2499     \hyperlink{util_8c_a849af10dd491723cf3abdef599846897}{unix\_time\_update}();
2500     \hyperlink{net__crypto_8c_acb48e059ed89d52de983ac4c59fcde06}{kill\_timedout}(c);
2501     \hyperlink{net__crypto_8c_adf499e22f45244e3660f9da6de77d2a3}{do\_tcp}(c);
2502     \hyperlink{net__crypto_8c_ad0fc252748fecbb499c4b01706476a77}{send\_crypto\_packets}(c);
2503 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a6fa028eb320bf09ecd619c5053580436_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a6fa028eb320bf09ecd619c5053580436_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_adf499e22f45244e3660f9da6de77d2a3}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!do\+\_\+tcp@{do\+\_\+tcp}}
\index{do\+\_\+tcp@{do\+\_\+tcp}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{do\+\_\+tcp}]{\setlength{\rightskip}{0pt plus 5cm}static void do\+\_\+tcp (
\begin{DoxyParamCaption}
\item[{{\bf Net\+\_\+\+Crypto} $\ast$}]{c}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{net__crypto_8c_adf499e22f45244e3660f9da6de77d2a3}


Definition at line 1851 of file net\+\_\+crypto.\+c.



References Crypto\+\_\+\+Connection\+::connection\+\_\+number\+\_\+tcp, C\+R\+Y\+P\+T\+O\+\_\+\+C\+O\+N\+N\+\_\+\+E\+S\+T\+A\+B\+L\+I\+S\+H\+E\+D, crypto\+\_\+connection\+\_\+status(), Net\+\_\+\+Crypto\+::crypto\+\_\+connections\+\_\+length, do\+\_\+tcp\+\_\+connections(), get\+\_\+crypto\+\_\+connection(), i, set\+\_\+tcp\+\_\+connection\+\_\+to\+\_\+status(), Crypto\+\_\+\+Connection\+::status, Net\+\_\+\+Crypto\+::tcp\+\_\+c, and Net\+\_\+\+Crypto\+::tcp\+\_\+mutex.



Referenced by do\+\_\+net\+\_\+crypto().


\begin{DoxyCode}
1852 \{
1853     pthread\_mutex\_lock(&c->\hyperlink{struct_net___crypto_a2e8f7f4dff2f2fc4ac2cc32b0c886974}{tcp\_mutex});
1854     \hyperlink{_t_c_p__connection_8c_a30c1a9c57a8d07cc2327c0505d6619a4}{do\_tcp\_connections}(c->\hyperlink{struct_net___crypto_a179982a02be89eaf6617ed81bd3c0961}{tcp\_c});
1855     pthread\_mutex\_unlock(&c->\hyperlink{struct_net___crypto_a2e8f7f4dff2f2fc4ac2cc32b0c886974}{tcp\_mutex});
1856 
1857     uint32\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
1858 
1859     \textcolor{keywordflow}{for} (i = 0; i < c->\hyperlink{struct_net___crypto_a9c91c3c65885a2bd39d0f864b9a5ddb9}{crypto\_connections\_length}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
1860         \hyperlink{struct_crypto___connection}{Crypto\_Connection} *conn = \hyperlink{net__crypto_8c_a909daa4b6d420cbd028f2c956a8642db}{get\_crypto\_connection}(c, i);
1861 
1862         \textcolor{keywordflow}{if} (conn == 0)
1863             \textcolor{keywordflow}{return};
1864 
1865         \textcolor{keywordflow}{if} (conn->\hyperlink{struct_crypto___connection_ade818037fd6c985038ff29656089758d}{status} == \hyperlink{net__crypto_8h_ae15ad1cc9a29a669e0df83d610c188b0}{CRYPTO\_CONN\_ESTABLISHED}) \{
1866             \_Bool direct\_connected = 0;
1867             \hyperlink{net__crypto_8c_afb5c59e6df7f38fe0bdf9e0f6c459869}{crypto\_connection\_status}(c, i, &direct\_connected, NULL);
1868 
1869             \textcolor{keywordflow}{if} (direct\_connected) \{
1870                 pthread\_mutex\_lock(&c->\hyperlink{struct_net___crypto_a2e8f7f4dff2f2fc4ac2cc32b0c886974}{tcp\_mutex});
1871                 \hyperlink{_t_c_p__connection_8c_a0c7079221df3e2f827e6ec1aaac597e6}{set\_tcp\_connection\_to\_status}(c->
      \hyperlink{struct_net___crypto_a179982a02be89eaf6617ed81bd3c0961}{tcp\_c}, conn->\hyperlink{struct_crypto___connection_a51666aaba0fc5680040fe5bd6778bc50}{connection\_number\_tcp}, 0);
1872                 pthread\_mutex\_unlock(&c->\hyperlink{struct_net___crypto_a2e8f7f4dff2f2fc4ac2cc32b0c886974}{tcp\_mutex});
1873             \} \textcolor{keywordflow}{else} \{
1874                 pthread\_mutex\_lock(&c->\hyperlink{struct_net___crypto_a2e8f7f4dff2f2fc4ac2cc32b0c886974}{tcp\_mutex});
1875                 \hyperlink{_t_c_p__connection_8c_a0c7079221df3e2f827e6ec1aaac597e6}{set\_tcp\_connection\_to\_status}(c->
      \hyperlink{struct_net___crypto_a179982a02be89eaf6617ed81bd3c0961}{tcp\_c}, conn->\hyperlink{struct_crypto___connection_a51666aaba0fc5680040fe5bd6778bc50}{connection\_number\_tcp}, 1);
1876                 pthread\_mutex\_unlock(&c->\hyperlink{struct_net___crypto_a2e8f7f4dff2f2fc4ac2cc32b0c886974}{tcp\_mutex});
1877             \}
1878         \}
1879     \}
1880 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_adf499e22f45244e3660f9da6de77d2a3_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_adf499e22f45244e3660f9da6de77d2a3_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_ae4bed66c607b0d067e9b83dbf718d1f7}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!generate\+\_\+request\+\_\+packet@{generate\+\_\+request\+\_\+packet}}
\index{generate\+\_\+request\+\_\+packet@{generate\+\_\+request\+\_\+packet}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{generate\+\_\+request\+\_\+packet}]{\setlength{\rightskip}{0pt plus 5cm}static int generate\+\_\+request\+\_\+packet (
\begin{DoxyParamCaption}
\item[{uint8\+\_\+t $\ast$}]{data, }
\item[{uint16\+\_\+t}]{length, }
\item[{const {\bf Packets\+\_\+\+Array} $\ast$}]{recv\+\_\+array}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{net__crypto_8c_ae4bed66c607b0d067e9b83dbf718d1f7}


Definition at line 612 of file net\+\_\+crypto.\+c.



References Packets\+\_\+\+Array\+::buffer, Packets\+\_\+\+Array\+::buffer\+\_\+end, Packets\+\_\+\+Array\+::buffer\+\_\+start, C\+R\+Y\+P\+T\+O\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+B\+U\+F\+F\+E\+R\+\_\+\+S\+I\+Z\+E, i, num, and P\+A\+C\+K\+E\+T\+\_\+\+I\+D\+\_\+\+R\+E\+Q\+U\+E\+S\+T.



Referenced by send\+\_\+request\+\_\+packet().


\begin{DoxyCode}
613 \{
614     \textcolor{keywordflow}{if} (length == 0)
615         \textcolor{keywordflow}{return} -1;
616 
617     \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[0] = \hyperlink{net__crypto_8h_af1de9decbe4790923c53235d3b04a00a}{PACKET\_ID\_REQUEST};
618 
619     uint16\_t cur\_len = 1;
620 
621     \textcolor{keywordflow}{if} (recv\_array->\hyperlink{struct_packets___array_a85973b335814248c05f63543876b348e}{buffer\_start} == recv\_array->\hyperlink{struct_packets___array_a66d710e0093872b26ee80118c1a85d99}{buffer\_end})
622         \textcolor{keywordflow}{return} cur\_len;
623 
624     \textcolor{keywordflow}{if} (length <= cur\_len)
625         \textcolor{keywordflow}{return} cur\_len;
626 
627     uint32\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}, n = 1;
628 
629     \textcolor{keywordflow}{for} (i = recv\_array->\hyperlink{struct_packets___array_a85973b335814248c05f63543876b348e}{buffer\_start}; i != recv\_array->\hyperlink{struct_packets___array_a66d710e0093872b26ee80118c1a85d99}{buffer\_end}; ++i) \{
630         uint32\_t \hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num} = i % \hyperlink{net__crypto_8h_ac73cf1eb0a938f0962ddc607945636f4}{CRYPTO\_PACKET\_BUFFER\_SIZE};
631 
632         \textcolor{keywordflow}{if} (!recv\_array->\hyperlink{struct_packets___array_ae9d4e6271fdb80e86ebb3e846fcd709c}{buffer}[num]) \{
633             \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[cur\_len] = n;
634             n = 0;
635             ++cur\_len;
636 
637             \textcolor{keywordflow}{if} (length <= cur\_len)
638                 \textcolor{keywordflow}{return} cur\_len;
639 
640         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (n == 255) \{
641             \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[cur\_len] = 0;
642             n = 0;
643             ++cur\_len;
644 
645             \textcolor{keywordflow}{if} (length <= cur\_len)
646                 \textcolor{keywordflow}{return} cur\_len;
647         \}
648 
649         ++n;
650     \}
651 
652     \textcolor{keywordflow}{return} cur\_len;
653 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_ae4bed66c607b0d067e9b83dbf718d1f7_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_a909daa4b6d420cbd028f2c956a8642db}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!get\+\_\+crypto\+\_\+connection@{get\+\_\+crypto\+\_\+connection}}
\index{get\+\_\+crypto\+\_\+connection@{get\+\_\+crypto\+\_\+connection}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{get\+\_\+crypto\+\_\+connection}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf Crypto\+\_\+\+Connection}$\ast$ get\+\_\+crypto\+\_\+connection (
\begin{DoxyParamCaption}
\item[{const {\bf Net\+\_\+\+Crypto} $\ast$}]{c, }
\item[{int}]{crypt\+\_\+connection\+\_\+id}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{net__crypto_8c_a909daa4b6d420cbd028f2c956a8642db}


Definition at line 378 of file net\+\_\+crypto.\+c.



References crypt\+\_\+connection\+\_\+id\+\_\+not\+\_\+valid(), and Net\+\_\+\+Crypto\+::crypto\+\_\+connections.



Referenced by add\+\_\+tcp\+\_\+relay\+\_\+peer(), clear\+\_\+temp\+\_\+packet(), connection\+\_\+data\+\_\+handler(), connection\+\_\+kill(), connection\+\_\+lossy\+\_\+data\+\_\+handler(), connection\+\_\+status\+\_\+handler(), create\+\_\+send\+\_\+handshake(), crypto\+\_\+connection\+\_\+add\+\_\+source(), crypto\+\_\+connection\+\_\+status(), crypto\+\_\+kill(), crypto\+\_\+num\+\_\+free\+\_\+sendqueue\+\_\+slots(), cryptpacket\+\_\+received(), do\+\_\+tcp(), handle\+\_\+data\+\_\+packet(), handle\+\_\+data\+\_\+packet\+\_\+helper(), handle\+\_\+new\+\_\+connection\+\_\+handshake(), handle\+\_\+packet\+\_\+connection(), kill\+\_\+timedout(), nc\+\_\+dht\+\_\+pk\+\_\+callback(), new\+\_\+temp\+\_\+packet(), reset\+\_\+max\+\_\+speed\+\_\+reached(), send\+\_\+crypto\+\_\+packets(), send\+\_\+data\+\_\+packet(), send\+\_\+kill\+\_\+packet(), send\+\_\+lossless\+\_\+packet(), send\+\_\+lossy\+\_\+cryptpacket(), send\+\_\+packet\+\_\+to(), send\+\_\+request\+\_\+packet(), send\+\_\+requested\+\_\+packets(), send\+\_\+temp\+\_\+packet(), set\+\_\+direct\+\_\+ip\+\_\+port(), tcp\+\_\+data\+\_\+callback(), udp\+\_\+handle\+\_\+packet(), and write\+\_\+cryptpacket().


\begin{DoxyCode}
379 \{
380     \textcolor{keywordflow}{if} (\hyperlink{net__crypto_8c_a8aae93bf17f0b4a4305b88334e820310}{crypt\_connection\_id\_not\_valid}(c, crypt\_connection\_id))
381         \textcolor{keywordflow}{return} 0;
382 
383     \textcolor{keywordflow}{return} &c->\hyperlink{struct_net___crypto_a13fdc865b8a114466ba136f5390ec1b2}{crypto\_connections}[crypt\_connection\_id];
384 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=335pt]{d8/dc6/net__crypto_8c_a909daa4b6d420cbd028f2c956a8642db_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a909daa4b6d420cbd028f2c956a8642db_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_a1e36bfc22078fc52c29d90e8ab79295d}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!get\+\_\+data\+\_\+pointer@{get\+\_\+data\+\_\+pointer}}
\index{get\+\_\+data\+\_\+pointer@{get\+\_\+data\+\_\+pointer}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{get\+\_\+data\+\_\+pointer}]{\setlength{\rightskip}{0pt plus 5cm}static int get\+\_\+data\+\_\+pointer (
\begin{DoxyParamCaption}
\item[{const {\bf Packets\+\_\+\+Array} $\ast$}]{array, }
\item[{{\bf Packet\+\_\+\+Data} $\ast$$\ast$}]{data, }
\item[{uint32\+\_\+t}]{number}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{net__crypto_8c_a1e36bfc22078fc52c29d90e8ab79295d}


Definition at line 484 of file net\+\_\+crypto.\+c.



References Packets\+\_\+\+Array\+::buffer, Packets\+\_\+\+Array\+::buffer\+\_\+end, Packets\+\_\+\+Array\+::buffer\+\_\+start, C\+R\+Y\+P\+T\+O\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+B\+U\+F\+F\+E\+R\+\_\+\+S\+I\+Z\+E, and num.



Referenced by handle\+\_\+data\+\_\+packet\+\_\+helper(), reset\+\_\+max\+\_\+speed\+\_\+reached(), send\+\_\+lossless\+\_\+packet(), and send\+\_\+requested\+\_\+packets().


\begin{DoxyCode}
485 \{
486     uint32\_t num\_spots = array->\hyperlink{struct_packets___array_a66d710e0093872b26ee80118c1a85d99}{buffer\_end} - array->\hyperlink{struct_packets___array_a85973b335814248c05f63543876b348e}{buffer\_start};
487 
488     \textcolor{keywordflow}{if} (array->\hyperlink{struct_packets___array_a66d710e0093872b26ee80118c1a85d99}{buffer\_end} - number > num\_spots || number - array->
      \hyperlink{struct_packets___array_a85973b335814248c05f63543876b348e}{buffer\_start} >= num\_spots)
489         \textcolor{keywordflow}{return} -1;
490 
491     uint32\_t \hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num} = number % \hyperlink{net__crypto_8h_ac73cf1eb0a938f0962ddc607945636f4}{CRYPTO\_PACKET\_BUFFER\_SIZE};
492 
493     \textcolor{keywordflow}{if} (!array->\hyperlink{struct_packets___array_ae9d4e6271fdb80e86ebb3e846fcd709c}{buffer}[num])
494         \textcolor{keywordflow}{return} 0;
495 
496     *data = array->\hyperlink{struct_packets___array_ae9d4e6271fdb80e86ebb3e846fcd709c}{buffer}[\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num}];
497     \textcolor{keywordflow}{return} 1;
498 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a1e36bfc22078fc52c29d90e8ab79295d_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_ad23e31b60004bf5f05899d3945530e6f}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!get\+\_\+nonce\+\_\+uint16@{get\+\_\+nonce\+\_\+uint16}}
\index{get\+\_\+nonce\+\_\+uint16@{get\+\_\+nonce\+\_\+uint16}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{get\+\_\+nonce\+\_\+uint16}]{\setlength{\rightskip}{0pt plus 5cm}static uint16\+\_\+t get\+\_\+nonce\+\_\+uint16 (
\begin{DoxyParamCaption}
\item[{const uint8\+\_\+t $\ast$}]{nonce}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{net__crypto_8c_ad23e31b60004bf5f05899d3945530e6f}


Definition at line 881 of file net\+\_\+crypto.\+c.



References num.



Referenced by handle\+\_\+data\+\_\+packet().


\begin{DoxyCode}
882 \{
883     uint16\_t \hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num};
884     memcpy(&num, \hyperlink{crypto__test_8c_a7932c523f7065073a396e571319201ce}{nonce} + (crypto\_box\_NONCEBYTES - \textcolor{keyword}{sizeof}(uint16\_t)), \textcolor{keyword}{sizeof}(uint16\_t));
885     \textcolor{keywordflow}{return} ntohs(num);
886 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_ad23e31b60004bf5f05899d3945530e6f_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_ad1a4103f75eb81ae93a0f1701b259db0}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!get\+\_\+random\+\_\+tcp\+\_\+con\+\_\+number@{get\+\_\+random\+\_\+tcp\+\_\+con\+\_\+number}}
\index{get\+\_\+random\+\_\+tcp\+\_\+con\+\_\+number@{get\+\_\+random\+\_\+tcp\+\_\+con\+\_\+number}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{get\+\_\+random\+\_\+tcp\+\_\+con\+\_\+number}]{\setlength{\rightskip}{0pt plus 5cm}int get\+\_\+random\+\_\+tcp\+\_\+con\+\_\+number (
\begin{DoxyParamCaption}
\item[{{\bf Net\+\_\+\+Crypto} $\ast$}]{c}
\end{DoxyParamCaption}
)}}\label{net__crypto_8c_ad1a4103f75eb81ae93a0f1701b259db0}


Definition at line 1810 of file net\+\_\+crypto.\+c.



References get\+\_\+random\+\_\+tcp\+\_\+onion\+\_\+conn\+\_\+number(), Net\+\_\+\+Crypto\+::tcp\+\_\+c, and Net\+\_\+\+Crypto\+::tcp\+\_\+mutex.



Referenced by random\+\_\+nodes\+\_\+path\+\_\+onion().


\begin{DoxyCode}
1811 \{
1812     pthread\_mutex\_lock(&c->\hyperlink{struct_net___crypto_a2e8f7f4dff2f2fc4ac2cc32b0c886974}{tcp\_mutex});
1813     \textcolor{keywordtype}{int} ret = \hyperlink{_t_c_p__connection_8c_a84992bb55c148bb9f7a1b442d255865f}{get\_random\_tcp\_onion\_conn\_number}(c->
      \hyperlink{struct_net___crypto_a179982a02be89eaf6617ed81bd3c0961}{tcp\_c});
1814     pthread\_mutex\_unlock(&c->\hyperlink{struct_net___crypto_a2e8f7f4dff2f2fc4ac2cc32b0c886974}{tcp\_mutex});
1815 
1816     \textcolor{keywordflow}{return} ret;
1817 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=338pt]{d8/dc6/net__crypto_8c_ad1a4103f75eb81ae93a0f1701b259db0_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_ad1a4103f75eb81ae93a0f1701b259db0_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_a2a46344fe22f21eea9d777b12918e257}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!getcryptconnection\+\_\+id@{getcryptconnection\+\_\+id}}
\index{getcryptconnection\+\_\+id@{getcryptconnection\+\_\+id}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{getcryptconnection\+\_\+id}]{\setlength{\rightskip}{0pt plus 5cm}static int getcryptconnection\+\_\+id (
\begin{DoxyParamCaption}
\item[{const {\bf Net\+\_\+\+Crypto} $\ast$}]{c, }
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{net__crypto_8c_a2a46344fe22f21eea9d777b12918e257}


Definition at line 1449 of file net\+\_\+crypto.\+c.



References C\+R\+Y\+P\+T\+O\+\_\+\+C\+O\+N\+N\+\_\+\+N\+O\+\_\+\+C\+O\+N\+N\+E\+C\+T\+I\+O\+N, Net\+\_\+\+Crypto\+::crypto\+\_\+connections, Net\+\_\+\+Crypto\+::crypto\+\_\+connections\+\_\+length, i, Crypto\+\_\+\+Connection\+::public\+\_\+key, and Crypto\+\_\+\+Connection\+::status.



Referenced by accept\+\_\+crypto\+\_\+connection(), handle\+\_\+new\+\_\+connection\+\_\+handshake(), and new\+\_\+crypto\+\_\+connection().


\begin{DoxyCode}
1450 \{
1451     uint32\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
1452 
1453     \textcolor{keywordflow}{for} (i = 0; i < c->\hyperlink{struct_net___crypto_a9c91c3c65885a2bd39d0f864b9a5ddb9}{crypto\_connections\_length}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
1454         \textcolor{keywordflow}{if} (c->\hyperlink{struct_net___crypto_a13fdc865b8a114466ba136f5390ec1b2}{crypto\_connections}[i].\hyperlink{struct_crypto___connection_ade818037fd6c985038ff29656089758d}{status} != 
      \hyperlink{net__crypto_8h_ab974dcadabde124fab5287024341f7a1}{CRYPTO\_CONN\_NO\_CONNECTION})
1455             \textcolor{keywordflow}{if} (memcmp(\hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, c->\hyperlink{struct_net___crypto_a13fdc865b8a114466ba136f5390ec1b2}{crypto\_connections}[i].
      \hyperlink{struct_crypto___connection_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, crypto\_box\_PUBLICKEYBYTES) == 0)
1456                 \textcolor{keywordflow}{return} \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
1457     \}
1458 
1459     \textcolor{keywordflow}{return} -1;
1460 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a2a46344fe22f21eea9d777b12918e257_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_ae86cc5b9c02d6a9f61916e1ff1a1b768}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!handle\+\_\+cookie\+\_\+request@{handle\+\_\+cookie\+\_\+request}}
\index{handle\+\_\+cookie\+\_\+request@{handle\+\_\+cookie\+\_\+request}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{handle\+\_\+cookie\+\_\+request}]{\setlength{\rightskip}{0pt plus 5cm}static int handle\+\_\+cookie\+\_\+request (
\begin{DoxyParamCaption}
\item[{const {\bf Net\+\_\+\+Crypto} $\ast$}]{c, }
\item[{uint8\+\_\+t $\ast$}]{request\+\_\+plain, }
\item[{uint8\+\_\+t $\ast$}]{shared\+\_\+key, }
\item[{uint8\+\_\+t $\ast$}]{dht\+\_\+public\+\_\+key, }
\item[{const uint8\+\_\+t $\ast$}]{packet, }
\item[{uint16\+\_\+t}]{length}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{net__crypto_8c_ae86cc5b9c02d6a9f61916e1ff1a1b768}


Definition at line 174 of file net\+\_\+crypto.\+c.



References C\+O\+O\+K\+I\+E\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+L\+E\+N\+G\+T\+H, C\+O\+O\+K\+I\+E\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+P\+L\+A\+I\+N\+\_\+\+L\+E\+N\+G\+T\+H, decrypt\+\_\+data\+\_\+symmetric(), Net\+\_\+\+Crypto\+::dht, and D\+H\+T\+\_\+get\+\_\+shared\+\_\+key\+\_\+sent().



Referenced by tcp\+\_\+handle\+\_\+cookie\+\_\+request(), tcp\+\_\+oob\+\_\+handle\+\_\+cookie\+\_\+request(), and udp\+\_\+handle\+\_\+cookie\+\_\+request().


\begin{DoxyCode}
176 \{
177     \textcolor{keywordflow}{if} (length != \hyperlink{net__crypto_8c_a25d19522f8fdd8da8932746bcf11e8aa}{COOKIE\_REQUEST\_LENGTH})
178         \textcolor{keywordflow}{return} -1;
179 
180     memcpy(dht\_public\_key, packet + 1, crypto\_box\_PUBLICKEYBYTES);
181     \hyperlink{_d_h_t_8c_a087cceeacc5a14415b651c2980a24d34}{DHT\_get\_shared\_key\_sent}(c->\hyperlink{struct_net___crypto_a8b3d6ce8745acc52695e252bdb1531b6}{dht}, shared\_key, dht\_public\_key);
182     \textcolor{keywordtype}{int} len = \hyperlink{crypto__core_8c_a824b257fcff74b9d17c5247223fbed29}{decrypt\_data\_symmetric}(shared\_key, packet + 1 + 
      crypto\_box\_PUBLICKEYBYTES,
183                                      packet + 1 + crypto\_box\_PUBLICKEYBYTES + crypto\_box\_NONCEBYTES, 
      \hyperlink{net__crypto_8c_a09bc1e1952ce2d46d01925227c1c34d1}{COOKIE\_REQUEST\_PLAIN\_LENGTH} + crypto\_box\_MACBYTES,
184                                      request\_plain);
185 
186     \textcolor{keywordflow}{if} (len != \hyperlink{net__crypto_8c_a09bc1e1952ce2d46d01925227c1c34d1}{COOKIE\_REQUEST\_PLAIN\_LENGTH})
187         \textcolor{keywordflow}{return} -1;
188 
189     \textcolor{keywordflow}{return} 0;
190 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_ae86cc5b9c02d6a9f61916e1ff1a1b768_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_ae86cc5b9c02d6a9f61916e1ff1a1b768_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_a28d8190542201eb7f1e41fe4764a7d53}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!handle\+\_\+cookie\+\_\+response@{handle\+\_\+cookie\+\_\+response}}
\index{handle\+\_\+cookie\+\_\+response@{handle\+\_\+cookie\+\_\+response}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{handle\+\_\+cookie\+\_\+response}]{\setlength{\rightskip}{0pt plus 5cm}static int handle\+\_\+cookie\+\_\+response (
\begin{DoxyParamCaption}
\item[{uint8\+\_\+t $\ast$}]{cookie, }
\item[{uint64\+\_\+t $\ast$}]{number, }
\item[{const uint8\+\_\+t $\ast$}]{packet, }
\item[{uint16\+\_\+t}]{length, }
\item[{const uint8\+\_\+t $\ast$}]{shared\+\_\+key}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{net__crypto_8c_a28d8190542201eb7f1e41fe4764a7d53}


Definition at line 267 of file net\+\_\+crypto.\+c.



References C\+O\+O\+K\+I\+E\+\_\+\+L\+E\+N\+G\+T\+H, C\+O\+O\+K\+I\+E\+\_\+\+R\+E\+S\+P\+O\+N\+S\+E\+\_\+\+L\+E\+N\+G\+T\+H, and decrypt\+\_\+data\+\_\+symmetric().



Referenced by handle\+\_\+packet\+\_\+connection().


\begin{DoxyCode}
269 \{
270     \textcolor{keywordflow}{if} (length != \hyperlink{net__crypto_8c_a145d90f988058f15e869e94884d7f614}{COOKIE\_RESPONSE\_LENGTH})
271         \textcolor{keywordflow}{return} -1;
272 
273     uint8\_t plain[\hyperlink{net__crypto_8c_a905c0a7642c878ca482e2d7aff7d670c}{COOKIE\_LENGTH} + \textcolor{keyword}{sizeof}(uint64\_t)];
274     \textcolor{keywordtype}{int} len = \hyperlink{crypto__core_8c_a824b257fcff74b9d17c5247223fbed29}{decrypt\_data\_symmetric}(shared\_key, packet + 1, packet + 1 + 
      crypto\_box\_NONCEBYTES,
275                                      length - (1 + crypto\_box\_NONCEBYTES), plain);
276 
277     \textcolor{keywordflow}{if} (len != \textcolor{keyword}{sizeof}(plain))
278         \textcolor{keywordflow}{return} -1;
279 
280     memcpy(cookie, plain, \hyperlink{net__crypto_8c_a905c0a7642c878ca482e2d7aff7d670c}{COOKIE\_LENGTH});
281     memcpy(number, plain + \hyperlink{net__crypto_8c_a905c0a7642c878ca482e2d7aff7d670c}{COOKIE\_LENGTH}, \textcolor{keyword}{sizeof}(uint64\_t));
282     \textcolor{keywordflow}{return} \hyperlink{net__crypto_8c_a905c0a7642c878ca482e2d7aff7d670c}{COOKIE\_LENGTH};
283 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a28d8190542201eb7f1e41fe4764a7d53_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a28d8190542201eb7f1e41fe4764a7d53_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_a33f5ee072c7c7f92f2302e98f1697cea}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!handle\+\_\+crypto\+\_\+handshake@{handle\+\_\+crypto\+\_\+handshake}}
\index{handle\+\_\+crypto\+\_\+handshake@{handle\+\_\+crypto\+\_\+handshake}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{handle\+\_\+crypto\+\_\+handshake}]{\setlength{\rightskip}{0pt plus 5cm}static int handle\+\_\+crypto\+\_\+handshake (
\begin{DoxyParamCaption}
\item[{const {\bf Net\+\_\+\+Crypto} $\ast$}]{c, }
\item[{uint8\+\_\+t $\ast$}]{nonce, }
\item[{uint8\+\_\+t $\ast$}]{session\+\_\+pk, }
\item[{uint8\+\_\+t $\ast$}]{peer\+\_\+real\+\_\+pk, }
\item[{uint8\+\_\+t $\ast$}]{dht\+\_\+public\+\_\+key, }
\item[{uint8\+\_\+t $\ast$}]{cookie, }
\item[{const uint8\+\_\+t $\ast$}]{packet, }
\item[{uint16\+\_\+t}]{length, }
\item[{const uint8\+\_\+t $\ast$}]{expected\+\_\+real\+\_\+pk}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{net__crypto_8c_a33f5ee072c7c7f92f2302e98f1697cea}


Definition at line 340 of file net\+\_\+crypto.\+c.



References C\+O\+O\+K\+I\+E\+\_\+\+D\+A\+T\+A\+\_\+\+L\+E\+N\+G\+T\+H, C\+O\+O\+K\+I\+E\+\_\+\+L\+E\+N\+G\+T\+H, decrypt\+\_\+data(), H\+A\+N\+D\+S\+H\+A\+K\+E\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+L\+E\+N\+G\+T\+H, open\+\_\+cookie(), public\+\_\+key\+\_\+cmp(), Net\+\_\+\+Crypto\+::secret\+\_\+symmetric\+\_\+key, and Net\+\_\+\+Crypto\+::self\+\_\+secret\+\_\+key.



Referenced by handle\+\_\+new\+\_\+connection\+\_\+handshake(), and handle\+\_\+packet\+\_\+connection().


\begin{DoxyCode}
342 \{
343     \textcolor{keywordflow}{if} (length != \hyperlink{net__crypto_8c_aae5268846bab0f3dcfe6071d0442d89e}{HANDSHAKE\_PACKET\_LENGTH})
344         \textcolor{keywordflow}{return} -1;
345 
346     uint8\_t cookie\_plain[\hyperlink{net__crypto_8c_ada1ab442f8ac484c80c15260ab737cab}{COOKIE\_DATA\_LENGTH}];
347 
348     \textcolor{keywordflow}{if} (\hyperlink{net__crypto_8c_aadb69c5328b7e0958fb1ee1961ec2f5c}{open\_cookie}(cookie\_plain, packet + 1, c->\hyperlink{struct_net___crypto_ab9f2ff47bc0b1e5110202a6e4be86390}{secret\_symmetric\_key}) != 0)
349         \textcolor{keywordflow}{return} -1;
350 
351     \textcolor{keywordflow}{if} (expected\_real\_pk)
352         \textcolor{keywordflow}{if} (\hyperlink{crypto__core_8c_a45ba09cd560b3be51f6cb7a3859f31b3}{public\_key\_cmp}(cookie\_plain, expected\_real\_pk) != 0)
353             \textcolor{keywordflow}{return} -1;
354 
355     uint8\_t cookie\_hash[crypto\_hash\_sha512\_BYTES];
356     crypto\_hash\_sha512(cookie\_hash, packet + 1, \hyperlink{net__crypto_8c_a905c0a7642c878ca482e2d7aff7d670c}{COOKIE\_LENGTH});
357 
358     uint8\_t plain[crypto\_box\_NONCEBYTES + crypto\_box\_PUBLICKEYBYTES + crypto\_hash\_sha512\_BYTES + 
      \hyperlink{net__crypto_8c_a905c0a7642c878ca482e2d7aff7d670c}{COOKIE\_LENGTH}];
359     \textcolor{keywordtype}{int} len = \hyperlink{crypto__core_8c_ab0aff79180f3852c24ad8f6fd88caf18}{decrypt\_data}(cookie\_plain, c->\hyperlink{struct_net___crypto_aa05050f86513ff53fe9da81f73c72267}{self\_secret\_key}, packet + 1 + 
      \hyperlink{net__crypto_8c_a905c0a7642c878ca482e2d7aff7d670c}{COOKIE\_LENGTH},
360                            packet + 1 + \hyperlink{net__crypto_8c_a905c0a7642c878ca482e2d7aff7d670c}{COOKIE\_LENGTH} + crypto\_box\_NONCEBYTES,
361                            \hyperlink{net__crypto_8c_aae5268846bab0f3dcfe6071d0442d89e}{HANDSHAKE\_PACKET\_LENGTH} - (1 + 
      \hyperlink{net__crypto_8c_a905c0a7642c878ca482e2d7aff7d670c}{COOKIE\_LENGTH} + crypto\_box\_NONCEBYTES), plain);
362 
363     \textcolor{keywordflow}{if} (len != \textcolor{keyword}{sizeof}(plain))
364         \textcolor{keywordflow}{return} -1;
365 
366     \textcolor{keywordflow}{if} (memcmp(cookie\_hash, plain + crypto\_box\_NONCEBYTES + crypto\_box\_PUBLICKEYBYTES, 
      crypto\_hash\_sha512\_BYTES) != 0)
367         \textcolor{keywordflow}{return} -1;
368 
369     memcpy(\hyperlink{crypto__test_8c_a7932c523f7065073a396e571319201ce}{nonce}, plain, crypto\_box\_NONCEBYTES);
370     memcpy(session\_pk, plain + crypto\_box\_NONCEBYTES, crypto\_box\_PUBLICKEYBYTES);
371     memcpy(cookie, plain + crypto\_box\_NONCEBYTES + crypto\_box\_PUBLICKEYBYTES + crypto\_hash\_sha512\_BYTES, 
      \hyperlink{net__crypto_8c_a905c0a7642c878ca482e2d7aff7d670c}{COOKIE\_LENGTH});
372     memcpy(peer\_real\_pk, cookie\_plain, crypto\_box\_PUBLICKEYBYTES);
373     memcpy(dht\_public\_key, cookie\_plain + crypto\_box\_PUBLICKEYBYTES, crypto\_box\_PUBLICKEYBYTES);
374     \textcolor{keywordflow}{return} 0;
375 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a33f5ee072c7c7f92f2302e98f1697cea_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a33f5ee072c7c7f92f2302e98f1697cea_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_acb5cc4167df17fcc066c2c4be9704ad7}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!handle\+\_\+data\+\_\+packet@{handle\+\_\+data\+\_\+packet}}
\index{handle\+\_\+data\+\_\+packet@{handle\+\_\+data\+\_\+packet}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{handle\+\_\+data\+\_\+packet}]{\setlength{\rightskip}{0pt plus 5cm}static int handle\+\_\+data\+\_\+packet (
\begin{DoxyParamCaption}
\item[{const {\bf Net\+\_\+\+Crypto} $\ast$}]{c, }
\item[{int}]{crypt\+\_\+connection\+\_\+id, }
\item[{uint8\+\_\+t $\ast$}]{data, }
\item[{const uint8\+\_\+t $\ast$}]{packet, }
\item[{uint16\+\_\+t}]{length}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{net__crypto_8c_acb5cc4167df17fcc066c2c4be9704ad7}


Definition at line 897 of file net\+\_\+crypto.\+c.



References D\+A\+T\+A\+\_\+\+N\+U\+M\+\_\+\+T\+H\+R\+E\+S\+H\+O\+L\+D, decrypt\+\_\+data\+\_\+symmetric(), get\+\_\+crypto\+\_\+connection(), get\+\_\+nonce\+\_\+uint16(), increment\+\_\+nonce\+\_\+number(), M\+A\+X\+\_\+\+C\+R\+Y\+P\+T\+O\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+S\+I\+Z\+E, nonce, num, Crypto\+\_\+\+Connection\+::recv\+\_\+nonce, and Crypto\+\_\+\+Connection\+::shared\+\_\+key.



Referenced by handle\+\_\+data\+\_\+packet\+\_\+helper().


\begin{DoxyCode}
899 \{
900     \textcolor{keywordflow}{if} (length <= (1 + \textcolor{keyword}{sizeof}(uint16\_t) + crypto\_box\_MACBYTES) || length > 
      \hyperlink{net__crypto_8h_a4358ff1fe0068c79f791ac88674aea04}{MAX\_CRYPTO\_PACKET\_SIZE})
901         \textcolor{keywordflow}{return} -1;
902 
903     \hyperlink{struct_crypto___connection}{Crypto\_Connection} *conn = \hyperlink{net__crypto_8c_a909daa4b6d420cbd028f2c956a8642db}{get\_crypto\_connection}(c, 
      crypt\_connection\_id);
904 
905     \textcolor{keywordflow}{if} (conn == 0)
906         \textcolor{keywordflow}{return} -1;
907 
908     uint8\_t \hyperlink{crypto__test_8c_a7932c523f7065073a396e571319201ce}{nonce}[crypto\_box\_NONCEBYTES];
909     memcpy(nonce, conn->\hyperlink{struct_crypto___connection_aae0467706f97aa3ef23e5dc9c3c199d7}{recv\_nonce}, crypto\_box\_NONCEBYTES);
910     uint16\_t num\_cur\_nonce = \hyperlink{net__crypto_8c_ad23e31b60004bf5f05899d3945530e6f}{get\_nonce\_uint16}(nonce);
911     uint16\_t \hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num};
912     memcpy(&num, packet + 1, \textcolor{keyword}{sizeof}(uint16\_t));
913     num = ntohs(num);
914     uint16\_t diff = num - num\_cur\_nonce;
915     \hyperlink{crypto__core_8c_a07e9b83f1240aacaa124f60e4f11b031}{increment\_nonce\_number}(nonce, diff);
916     \textcolor{keywordtype}{int} len = \hyperlink{crypto__core_8c_a824b257fcff74b9d17c5247223fbed29}{decrypt\_data\_symmetric}(conn->\hyperlink{struct_crypto___connection_a81ead9fac55a0cedc30a96253a2c5119}{shared\_key}, nonce, packet + 1 + \textcolor{keyword}{
      sizeof}(uint16\_t),
917                                      length - (1 + \textcolor{keyword}{sizeof}(uint16\_t)), \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data});
918 
919     \textcolor{keywordflow}{if} ((\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int})len != length - (1 + \textcolor{keyword}{sizeof}(uint16\_t) + crypto\_box\_MACBYTES))
920         \textcolor{keywordflow}{return} -1;
921 
922     \textcolor{keywordflow}{if} (diff > \hyperlink{net__crypto_8c_aa28dae2bf4e9d1f19db5be07ea6aab1f}{DATA\_NUM\_THRESHOLD} * 2) \{
923         \hyperlink{crypto__core_8c_a07e9b83f1240aacaa124f60e4f11b031}{increment\_nonce\_number}(conn->\hyperlink{struct_crypto___connection_aae0467706f97aa3ef23e5dc9c3c199d7}{recv\_nonce}, 
      \hyperlink{net__crypto_8c_aa28dae2bf4e9d1f19db5be07ea6aab1f}{DATA\_NUM\_THRESHOLD});
924     \}
925 
926     \textcolor{keywordflow}{return} len;
927 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_acb5cc4167df17fcc066c2c4be9704ad7_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_acb5cc4167df17fcc066c2c4be9704ad7_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_a38debbf6310a8190eeafd33e42423f1a}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!handle\+\_\+data\+\_\+packet\+\_\+helper@{handle\+\_\+data\+\_\+packet\+\_\+helper}}
\index{handle\+\_\+data\+\_\+packet\+\_\+helper@{handle\+\_\+data\+\_\+packet\+\_\+helper}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{handle\+\_\+data\+\_\+packet\+\_\+helper}]{\setlength{\rightskip}{0pt plus 5cm}static int handle\+\_\+data\+\_\+packet\+\_\+helper (
\begin{DoxyParamCaption}
\item[{{\bf Net\+\_\+\+Crypto} $\ast$}]{c, }
\item[{int}]{crypt\+\_\+connection\+\_\+id, }
\item[{const uint8\+\_\+t $\ast$}]{packet, }
\item[{uint16\+\_\+t}]{length}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{net__crypto_8c_a38debbf6310a8190eeafd33e42423f1a}


Definition at line 1138 of file net\+\_\+crypto.\+c.



References add\+\_\+data\+\_\+to\+\_\+buffer(), Packets\+\_\+\+Array\+::buffer\+\_\+start, clear\+\_\+buffer\+\_\+until(), clear\+\_\+temp\+\_\+packet(), Crypto\+\_\+\+Connection\+::connection\+\_\+data\+\_\+callback, Crypto\+\_\+\+Connection\+::connection\+\_\+data\+\_\+callback\+\_\+id, Crypto\+\_\+\+Connection\+::connection\+\_\+data\+\_\+callback\+\_\+object, connection\+\_\+kill(), Crypto\+\_\+\+Connection\+::connection\+\_\+lossy\+\_\+data\+\_\+callback, Crypto\+\_\+\+Connection\+::connection\+\_\+lossy\+\_\+data\+\_\+callback\+\_\+id, Crypto\+\_\+\+Connection\+::connection\+\_\+lossy\+\_\+data\+\_\+callback\+\_\+object, Crypto\+\_\+\+Connection\+::connection\+\_\+status\+\_\+callback, Crypto\+\_\+\+Connection\+::connection\+\_\+status\+\_\+callback\+\_\+id, Crypto\+\_\+\+Connection\+::connection\+\_\+status\+\_\+callback\+\_\+object, C\+R\+Y\+P\+T\+O\+\_\+\+C\+O\+N\+N\+\_\+\+E\+S\+T\+A\+B\+L\+I\+S\+H\+E\+D, C\+R\+Y\+P\+T\+O\+\_\+\+C\+O\+N\+N\+\_\+\+N\+O\+T\+\_\+\+C\+O\+N\+F\+I\+R\+M\+E\+D, C\+R\+Y\+P\+T\+O\+\_\+\+D\+A\+T\+A\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+M\+I\+N\+\_\+\+S\+I\+Z\+E, C\+R\+Y\+P\+T\+O\+\_\+\+R\+E\+S\+E\+R\+V\+E\+D\+\_\+\+P\+A\+C\+K\+E\+T\+S, current\+\_\+time\+\_\+monotonic(), Packet\+\_\+\+Data\+::data, make-\/funny-\/savefile\+::data, get\+\_\+crypto\+\_\+connection(), get\+\_\+data\+\_\+pointer(), handle\+\_\+data\+\_\+packet(), handle\+\_\+request\+\_\+packet(), Packet\+\_\+\+Data\+::length, M\+A\+X\+\_\+\+C\+R\+Y\+P\+T\+O\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+S\+I\+Z\+E, M\+A\+X\+\_\+\+D\+A\+T\+A\+\_\+\+D\+A\+T\+A\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+S\+I\+Z\+E, Crypto\+\_\+\+Connection\+::mutex, num, Crypto\+\_\+\+Connection\+::packet\+\_\+counter, P\+A\+C\+K\+E\+T\+\_\+\+I\+D\+\_\+\+K\+I\+L\+L, P\+A\+C\+K\+E\+T\+\_\+\+I\+D\+\_\+\+L\+O\+S\+S\+Y\+\_\+\+R\+A\+N\+G\+E\+\_\+\+S\+I\+Z\+E, P\+A\+C\+K\+E\+T\+\_\+\+I\+D\+\_\+\+L\+O\+S\+S\+Y\+\_\+\+R\+A\+N\+G\+E\+\_\+\+S\+T\+A\+R\+T, P\+A\+C\+K\+E\+T\+\_\+\+I\+D\+\_\+\+P\+A\+D\+D\+I\+N\+G, P\+A\+C\+K\+E\+T\+\_\+\+I\+D\+\_\+\+R\+E\+Q\+U\+E\+S\+T, read\+\_\+data\+\_\+beg\+\_\+buffer(), Crypto\+\_\+\+Connection\+::recv\+\_\+array, Crypto\+\_\+\+Connection\+::rtt\+\_\+time, Crypto\+\_\+\+Connection\+::send\+\_\+array, Packet\+\_\+\+Data\+::sent\+\_\+time, set\+\_\+buffer\+\_\+end(), and Crypto\+\_\+\+Connection\+::status.



Referenced by handle\+\_\+packet\+\_\+connection().


\begin{DoxyCode}
1139 \{
1140     \textcolor{keywordflow}{if} (length > \hyperlink{net__crypto_8h_a4358ff1fe0068c79f791ac88674aea04}{MAX\_CRYPTO\_PACKET\_SIZE} || length <= 
      \hyperlink{net__crypto_8h_a5f9efcfe577f9eadd24094a8abd6bb7e}{CRYPTO\_DATA\_PACKET\_MIN\_SIZE})
1141         \textcolor{keywordflow}{return} -1;
1142 
1143     \hyperlink{struct_crypto___connection}{Crypto\_Connection} *conn = \hyperlink{net__crypto_8c_a909daa4b6d420cbd028f2c956a8642db}{get\_crypto\_connection}(c, 
      crypt\_connection\_id);
1144 
1145     \textcolor{keywordflow}{if} (conn == 0)
1146         \textcolor{keywordflow}{return} -1;
1147 
1148     uint8\_t \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[\hyperlink{net__crypto_8c_a83b926a0be4d9d952b10a08998f9d705}{MAX\_DATA\_DATA\_PACKET\_SIZE}];
1149     \textcolor{keywordtype}{int} len = \hyperlink{net__crypto_8c_acb5cc4167df17fcc066c2c4be9704ad7}{handle\_data\_packet}(c, crypt\_connection\_id, data, packet, length);
1150 
1151     \textcolor{keywordflow}{if} (len <= (\textcolor{keywordtype}{int})(\textcolor{keyword}{sizeof}(uint32\_t) * 2))
1152         \textcolor{keywordflow}{return} -1;
1153 
1154     uint32\_t buffer\_start, \hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num};
1155     memcpy(&buffer\_start, data, \textcolor{keyword}{sizeof}(uint32\_t));
1156     memcpy(&num, data + \textcolor{keyword}{sizeof}(uint32\_t), \textcolor{keyword}{sizeof}(uint32\_t));
1157     buffer\_start = ntohl(buffer\_start);
1158     num = ntohl(num);
1159 
1160     uint64\_t rtt\_calc\_time = 0;
1161 
1162     \textcolor{keywordflow}{if} (buffer\_start != conn->\hyperlink{struct_crypto___connection_aa9112ee7e76eb3e870491f7c5c272197}{send\_array}.\hyperlink{struct_packets___array_a85973b335814248c05f63543876b348e}{buffer\_start}) \{
1163         \hyperlink{struct_packet___data}{Packet\_Data} *packet\_time;
1164 
1165         \textcolor{keywordflow}{if} (\hyperlink{net__crypto_8c_a1e36bfc22078fc52c29d90e8ab79295d}{get\_data\_pointer}(&conn->\hyperlink{struct_crypto___connection_aa9112ee7e76eb3e870491f7c5c272197}{send\_array}, &packet\_time, conn->
      \hyperlink{struct_crypto___connection_aa9112ee7e76eb3e870491f7c5c272197}{send\_array}.\hyperlink{struct_packets___array_a85973b335814248c05f63543876b348e}{buffer\_start}) == 1) \{
1166             rtt\_calc\_time = packet\_time->\hyperlink{struct_packet___data_ae6e5e2c139451ff48ec8dbba5d21bb50}{sent\_time};
1167         \}
1168 
1169         \textcolor{keywordflow}{if} (\hyperlink{net__crypto_8c_adb75f9c0e1a6f9ab1064cb17953011a3}{clear\_buffer\_until}(&conn->\hyperlink{struct_crypto___connection_aa9112ee7e76eb3e870491f7c5c272197}{send\_array}, buffer\_start) != 0) \{
1170             \textcolor{keywordflow}{return} -1;
1171         \}
1172     \}
1173 
1174     uint8\_t *real\_data = data + (\textcolor{keyword}{sizeof}(uint32\_t) * 2);
1175     uint16\_t real\_length = len - (\textcolor{keyword}{sizeof}(uint32\_t) * 2);
1176 
1177     \textcolor{keywordflow}{while} (real\_data[0] == \hyperlink{net__crypto_8h_aacaea3de09437a784d2b510a47ae15d6}{PACKET\_ID\_PADDING}) \{ \textcolor{comment}{/* Remove Padding */}
1178         ++real\_data;
1179         --real\_length;
1180 
1181         \textcolor{keywordflow}{if} (real\_length == 0)
1182             \textcolor{keywordflow}{return} -1;
1183     \}
1184 
1185     \textcolor{keywordflow}{if} (real\_data[0] == \hyperlink{net__crypto_8h_ac3fca17f739e473ffb4f16ec9b2f4cde}{PACKET\_ID\_KILL}) \{
1186         \hyperlink{net__crypto_8c_ac679d5f08189ac10b3eca22c3f032dbc}{connection\_kill}(c, crypt\_connection\_id);
1187         \textcolor{keywordflow}{return} 0;
1188     \}
1189 
1190     \textcolor{keywordflow}{if} (conn->\hyperlink{struct_crypto___connection_ade818037fd6c985038ff29656089758d}{status} == \hyperlink{net__crypto_8h_ac188171760299bf65ba620fe348b9b40}{CRYPTO\_CONN\_NOT\_CONFIRMED}) \{
1191         \hyperlink{net__crypto_8c_a6e6c3107cf48ec1c5087d3780a03ad0c}{clear\_temp\_packet}(c, crypt\_connection\_id);
1192         conn->\hyperlink{struct_crypto___connection_ade818037fd6c985038ff29656089758d}{status} = \hyperlink{net__crypto_8h_ae15ad1cc9a29a669e0df83d610c188b0}{CRYPTO\_CONN\_ESTABLISHED};
1193 
1194         \textcolor{keywordflow}{if} (conn->\hyperlink{struct_crypto___connection_ad3c663c15ca97b75951ea711b522c049}{connection\_status\_callback})
1195             conn->\hyperlink{struct_crypto___connection_ad3c663c15ca97b75951ea711b522c049}{connection\_status\_callback}(conn->
      \hyperlink{struct_crypto___connection_afe03d43c62ac2aa575a39e4308353244}{connection\_status\_callback\_object}, conn->
      \hyperlink{struct_crypto___connection_a3cd6f7015115dc493f86be91526eb9f8}{connection\_status\_callback\_id}, 1);
1196     \}
1197 
1198     \textcolor{keywordflow}{if} (real\_data[0] == \hyperlink{net__crypto_8h_af1de9decbe4790923c53235d3b04a00a}{PACKET\_ID\_REQUEST}) \{
1199         \textcolor{keywordtype}{int} \hyperlink{struct_file___transfers_a23cc26eca74ddec84f975c0be5496457}{requested} = \hyperlink{net__crypto_8c_a4a6efacedb06b73ea8a0ce30b72b3d42}{handle\_request\_packet}(&conn->
      \hyperlink{struct_crypto___connection_aa9112ee7e76eb3e870491f7c5c272197}{send\_array}, real\_data, real\_length, &rtt\_calc\_time, conn->\hyperlink{struct_crypto___connection_ae88ec876060fbc648a4c75ac596137f9}{rtt\_time});
1200 
1201         \textcolor{keywordflow}{if} (requested == -1) \{
1202             \textcolor{keywordflow}{return} -1;
1203         \} \textcolor{keywordflow}{else} \{
1204             \textcolor{comment}{//TODO?}
1205         \}
1206 
1207         \hyperlink{net__crypto_8c_a065063595d40809cb6c5c2ccc09fdd74}{set\_buffer\_end}(&conn->\hyperlink{struct_crypto___connection_a1a62bc0c4bb9e349735c65f9948020d5}{recv\_array}, num);
1208     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (real\_data[0] >= \hyperlink{net__crypto_8h_a98aaeb516244f1581d65e3dbb008979e}{CRYPTO\_RESERVED\_PACKETS} && real\_data[0] < 
      \hyperlink{net__crypto_8h_a02481d2cc931289c2d5ee21d2a633316}{PACKET\_ID\_LOSSY\_RANGE\_START}) \{
1209         \hyperlink{struct_packet___data}{Packet\_Data} dt;
1210         dt.\hyperlink{struct_packet___data_a1892eba2086d12ac2b09005aeb09ea3b}{length} = real\_length;
1211         memcpy(dt.\hyperlink{struct_packet___data_ab895a6b34c217017925a6aea69c78c09}{data}, real\_data, real\_length);
1212 
1213         \textcolor{keywordflow}{if} (\hyperlink{net__crypto_8c_a25e7d5165bf373d47b71dbb49e2e8c78}{add\_data\_to\_buffer}(&conn->\hyperlink{struct_crypto___connection_a1a62bc0c4bb9e349735c65f9948020d5}{recv\_array}, num, &dt) != 0)
1214             \textcolor{keywordflow}{return} -1;
1215 
1216 
1217         \textcolor{keywordflow}{while} (1) \{
1218             pthread\_mutex\_lock(&conn->\hyperlink{struct_crypto___connection_a4acff8232e4aec9cd5c6dc200ac55ef3}{mutex});
1219             \textcolor{keywordtype}{int} ret = \hyperlink{net__crypto_8c_a8833802df3897cccb469cc3b86e097a7}{read\_data\_beg\_buffer}(&conn->\hyperlink{struct_crypto___connection_a1a62bc0c4bb9e349735c65f9948020d5}{recv\_array}, &dt);
1220             pthread\_mutex\_unlock(&conn->\hyperlink{struct_crypto___connection_a4acff8232e4aec9cd5c6dc200ac55ef3}{mutex});
1221 
1222             \textcolor{keywordflow}{if} (ret == -1)
1223                 \textcolor{keywordflow}{break};
1224 
1225             \textcolor{keywordflow}{if} (conn->\hyperlink{struct_crypto___connection_adc6ee264e4a5758049c6299beb81ce6d}{connection\_data\_callback})
1226                 conn->\hyperlink{struct_crypto___connection_adc6ee264e4a5758049c6299beb81ce6d}{connection\_data\_callback}(conn->
      \hyperlink{struct_crypto___connection_a3c44dfac7528ae10a6d09bf812f36486}{connection\_data\_callback\_object}, conn->
      \hyperlink{struct_crypto___connection_a7d50567cce6cb1b8ef983e64060d414e}{connection\_data\_callback\_id}, dt.\hyperlink{struct_packet___data_ab895a6b34c217017925a6aea69c78c09}{data},
1227                                                dt.\hyperlink{struct_packet___data_a1892eba2086d12ac2b09005aeb09ea3b}{length});
1228 
1229             \textcolor{comment}{/* conn might get killed in callback. */}
1230             conn = \hyperlink{net__crypto_8c_a909daa4b6d420cbd028f2c956a8642db}{get\_crypto\_connection}(c, crypt\_connection\_id);
1231 
1232             \textcolor{keywordflow}{if} (conn == 0)
1233                 \textcolor{keywordflow}{return} -1;
1234         \}
1235 
1236         \textcolor{comment}{/* Packet counter. */}
1237         ++conn->\hyperlink{struct_crypto___connection_a253e0640ca1d914e479ea37e97d1ba12}{packet\_counter};
1238     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (real\_data[0] >= \hyperlink{net__crypto_8h_a02481d2cc931289c2d5ee21d2a633316}{PACKET\_ID\_LOSSY\_RANGE\_START} &&
1239                real\_data[0] < (\hyperlink{net__crypto_8h_a02481d2cc931289c2d5ee21d2a633316}{PACKET\_ID\_LOSSY\_RANGE\_START} + 
      \hyperlink{net__crypto_8h_a97668dde651012b4dffe599cd0df333b}{PACKET\_ID\_LOSSY\_RANGE\_SIZE})) \{
1240 
1241         \hyperlink{net__crypto_8c_a065063595d40809cb6c5c2ccc09fdd74}{set\_buffer\_end}(&conn->\hyperlink{struct_crypto___connection_a1a62bc0c4bb9e349735c65f9948020d5}{recv\_array}, num);
1242 
1243         \textcolor{keywordflow}{if} (conn->\hyperlink{struct_crypto___connection_ab5af8aad05ddc085e69ead928cc26313}{connection\_lossy\_data\_callback})
1244             conn->\hyperlink{struct_crypto___connection_ab5af8aad05ddc085e69ead928cc26313}{connection\_lossy\_data\_callback}(conn->
      \hyperlink{struct_crypto___connection_a70a99b7d0c9dd2f913ca9ea42bafc942}{connection\_lossy\_data\_callback\_object},
1245                                                  conn->
      \hyperlink{struct_crypto___connection_acdd49847729119bc5d6cc7269cde876a}{connection\_lossy\_data\_callback\_id}, real\_data, real\_length);
1246 
1247     \} \textcolor{keywordflow}{else} \{
1248         \textcolor{keywordflow}{return} -1;
1249     \}
1250 
1251     \textcolor{keywordflow}{if} (rtt\_calc\_time != 0) \{
1252         uint64\_t rtt\_time = \hyperlink{irc__syncbot_8c_ae8ecaef140b786a2720eadbb85918e81}{current\_time\_monotonic}() - rtt\_calc\_time;
1253 
1254         \textcolor{keywordflow}{if} (rtt\_time < conn->rtt\_time)
1255             conn->\hyperlink{struct_crypto___connection_ae88ec876060fbc648a4c75ac596137f9}{rtt\_time} = rtt\_time;
1256     \}
1257 
1258     \textcolor{keywordflow}{return} 0;
1259 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a38debbf6310a8190eeafd33e42423f1a_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a38debbf6310a8190eeafd33e42423f1a_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_ae8139c35468806f25d5aed185edcc5a1}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!handle\+\_\+new\+\_\+connection\+\_\+handshake@{handle\+\_\+new\+\_\+connection\+\_\+handshake}}
\index{handle\+\_\+new\+\_\+connection\+\_\+handshake@{handle\+\_\+new\+\_\+connection\+\_\+handshake}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{handle\+\_\+new\+\_\+connection\+\_\+handshake}]{\setlength{\rightskip}{0pt plus 5cm}static int handle\+\_\+new\+\_\+connection\+\_\+handshake (
\begin{DoxyParamCaption}
\item[{{\bf Net\+\_\+\+Crypto} $\ast$}]{c, }
\item[{{\bf I\+P\+\_\+\+Port}}]{source, }
\item[{const uint8\+\_\+t $\ast$}]{data, }
\item[{uint16\+\_\+t}]{length}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{net__crypto_8c_ae8139c35468806f25d5aed185edcc5a1}


Definition at line 1515 of file net\+\_\+crypto.\+c.



References connection\+\_\+kill(), New\+\_\+\+Connection\+::cookie, C\+O\+O\+K\+I\+E\+\_\+\+L\+E\+N\+G\+T\+H, New\+\_\+\+Connection\+::cookie\+\_\+length, create\+\_\+send\+\_\+handshake(), C\+R\+Y\+P\+T\+O\+\_\+\+C\+O\+N\+N\+\_\+\+C\+O\+O\+K\+I\+E\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+I\+N\+G, C\+R\+Y\+P\+T\+O\+\_\+\+C\+O\+N\+N\+\_\+\+H\+A\+N\+D\+S\+H\+A\+K\+E\+\_\+\+S\+E\+N\+T, C\+R\+Y\+P\+T\+O\+\_\+\+C\+O\+N\+N\+\_\+\+N\+O\+T\+\_\+\+C\+O\+N\+F\+I\+R\+M\+E\+D, crypto\+\_\+connection\+\_\+add\+\_\+source(), Crypto\+\_\+\+Connection\+::dht\+\_\+public\+\_\+key, New\+\_\+\+Connection\+::dht\+\_\+public\+\_\+key, encrypt\+\_\+precompute(), get\+\_\+crypto\+\_\+connection(), getcryptconnection\+\_\+id(), handle\+\_\+crypto\+\_\+handshake(), Net\+\_\+\+Crypto\+::new\+\_\+connection\+\_\+callback, Net\+\_\+\+Crypto\+::new\+\_\+connection\+\_\+callback\+\_\+object, Crypto\+\_\+\+Connection\+::peersessionpublic\+\_\+key, New\+\_\+\+Connection\+::peersessionpublic\+\_\+key, New\+\_\+\+Connection\+::public\+\_\+key, public\+\_\+key\+\_\+cmp(), Crypto\+\_\+\+Connection\+::recv\+\_\+nonce, New\+\_\+\+Connection\+::recv\+\_\+nonce, Crypto\+\_\+\+Connection\+::sessionsecret\+\_\+key, Crypto\+\_\+\+Connection\+::shared\+\_\+key, New\+\_\+\+Connection\+::source, and Crypto\+\_\+\+Connection\+::status.



Referenced by tcp\+\_\+oob\+\_\+callback(), and udp\+\_\+handle\+\_\+packet().


\begin{DoxyCode}
1516 \{
1517     \hyperlink{struct_new___connection}{New\_Connection} n\_c;
1518     n\_c.\hyperlink{struct_new___connection_a78fb2cbe7af4d12847f2f044c35e7823}{cookie} = malloc(\hyperlink{net__crypto_8c_a905c0a7642c878ca482e2d7aff7d670c}{COOKIE\_LENGTH});
1519 
1520     \textcolor{keywordflow}{if} (n\_c.\hyperlink{struct_new___connection_a78fb2cbe7af4d12847f2f044c35e7823}{cookie} == NULL)
1521         \textcolor{keywordflow}{return} -1;
1522 
1523     n\_c.\hyperlink{struct_new___connection_afffde330c649378add9a507c9c151586}{source} = source;
1524     n\_c.\hyperlink{struct_new___connection_a801672aeddedd60f76a667a2275a95ce}{cookie\_length} = \hyperlink{net__crypto_8c_a905c0a7642c878ca482e2d7aff7d670c}{COOKIE\_LENGTH};
1525 
1526     \textcolor{keywordflow}{if} (\hyperlink{net__crypto_8c_a33f5ee072c7c7f92f2302e98f1697cea}{handle\_crypto\_handshake}(c, n\_c.\hyperlink{struct_new___connection_aae0467706f97aa3ef23e5dc9c3c199d7}{recv\_nonce}, n\_c.
      \hyperlink{struct_new___connection_ac040d4ba2a22ee327952009e7396bb2f}{peersessionpublic\_key}, n\_c.\hyperlink{struct_new___connection_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, n\_c.
      \hyperlink{struct_new___connection_ab2ecaa07625ad0ed5e07d3a1f0dcc939}{dht\_public\_key},
1527                                 n\_c.\hyperlink{struct_new___connection_a78fb2cbe7af4d12847f2f044c35e7823}{cookie}, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}, length, 0) != 0) \{
1528         free(n\_c.\hyperlink{struct_new___connection_a78fb2cbe7af4d12847f2f044c35e7823}{cookie});
1529         \textcolor{keywordflow}{return} -1;
1530     \}
1531 
1532     \textcolor{keywordtype}{int} crypt\_connection\_id = \hyperlink{net__crypto_8c_a2a46344fe22f21eea9d777b12918e257}{getcryptconnection\_id}(c, n\_c.
      \hyperlink{struct_new___connection_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key});
1533 
1534     \textcolor{keywordflow}{if} (crypt\_connection\_id != -1) \{
1535         \hyperlink{struct_crypto___connection}{Crypto\_Connection} *conn = \hyperlink{net__crypto_8c_a909daa4b6d420cbd028f2c956a8642db}{get\_crypto\_connection}(c, 
      crypt\_connection\_id);
1536 
1537         \textcolor{keywordflow}{if} (\hyperlink{crypto__core_8c_a45ba09cd560b3be51f6cb7a3859f31b3}{public\_key\_cmp}(n\_c.\hyperlink{struct_new___connection_ab2ecaa07625ad0ed5e07d3a1f0dcc939}{dht\_public\_key}, conn->
      \hyperlink{struct_crypto___connection_ab2ecaa07625ad0ed5e07d3a1f0dcc939}{dht\_public\_key}) != 0) \{
1538             \hyperlink{net__crypto_8c_ac679d5f08189ac10b3eca22c3f032dbc}{connection\_kill}(c, crypt\_connection\_id);
1539         \} \textcolor{keywordflow}{else} \{
1540             \textcolor{keywordtype}{int} ret = -1;
1541 
1542             \textcolor{keywordflow}{if} (conn && (conn->\hyperlink{struct_crypto___connection_ade818037fd6c985038ff29656089758d}{status} == \hyperlink{net__crypto_8h_a3982349ee55b611d39ef3014e739e403}{CRYPTO\_CONN\_COOKIE\_REQUESTING} 
      || conn->\hyperlink{struct_crypto___connection_ade818037fd6c985038ff29656089758d}{status} == \hyperlink{net__crypto_8h_a83145faeb8957481e615549e05e03d78}{CRYPTO\_CONN\_HANDSHAKE\_SENT})) \{
1543                 memcpy(conn->\hyperlink{struct_crypto___connection_aae0467706f97aa3ef23e5dc9c3c199d7}{recv\_nonce}, n\_c.\hyperlink{struct_new___connection_aae0467706f97aa3ef23e5dc9c3c199d7}{recv\_nonce}, crypto\_box\_NONCEBYTES);
1544                 memcpy(conn->\hyperlink{struct_crypto___connection_ac040d4ba2a22ee327952009e7396bb2f}{peersessionpublic\_key}, n\_c.
      \hyperlink{struct_new___connection_ac040d4ba2a22ee327952009e7396bb2f}{peersessionpublic\_key}, crypto\_box\_PUBLICKEYBYTES);
1545                 \hyperlink{crypto__core_8c_a0d8eaef49981c5dc3ada078866b42f6d}{encrypt\_precompute}(conn->\hyperlink{struct_crypto___connection_ac040d4ba2a22ee327952009e7396bb2f}{peersessionpublic\_key}, conn
      ->\hyperlink{struct_crypto___connection_a5f38fc9ff1b20b61ffbb56d9e7f5c892}{sessionsecret\_key}, conn->\hyperlink{struct_crypto___connection_a81ead9fac55a0cedc30a96253a2c5119}{shared\_key});
1546 
1547                 \hyperlink{net__crypto_8c_a9e779393ece10111b0ac7fe2bbc3beeb}{crypto\_connection\_add\_source}(c, crypt\_connection\_id, source);
1548 
1549                 \textcolor{keywordflow}{if} (\hyperlink{net__crypto_8c_ad2ca4aad15dc0607252aa21cd525b5ba}{create\_send\_handshake}(c, crypt\_connection\_id, n\_c.
      \hyperlink{struct_new___connection_a78fb2cbe7af4d12847f2f044c35e7823}{cookie}, n\_c.\hyperlink{struct_new___connection_ab2ecaa07625ad0ed5e07d3a1f0dcc939}{dht\_public\_key}) == 0) \{
1550                     conn->\hyperlink{struct_crypto___connection_ade818037fd6c985038ff29656089758d}{status} = \hyperlink{net__crypto_8h_ac188171760299bf65ba620fe348b9b40}{CRYPTO\_CONN\_NOT\_CONFIRMED};
1551                     ret = 0;
1552                 \}
1553             \}
1554 
1555             free(n\_c.\hyperlink{struct_new___connection_a78fb2cbe7af4d12847f2f044c35e7823}{cookie});
1556             \textcolor{keywordflow}{return} ret;
1557         \}
1558     \}
1559 
1560     \textcolor{keywordtype}{int} ret = c->\hyperlink{struct_net___crypto_a4e2c131b4a4b4ccb2acc140c29c628be}{new\_connection\_callback}(c->
      \hyperlink{struct_net___crypto_af28bac95ede5cab8426b07e02dd1a1b0}{new\_connection\_callback\_object}, &n\_c);
1561     free(n\_c.\hyperlink{struct_new___connection_a78fb2cbe7af4d12847f2f044c35e7823}{cookie});
1562     \textcolor{keywordflow}{return} ret;
1563 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_ae8139c35468806f25d5aed185edcc5a1_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_ae8139c35468806f25d5aed185edcc5a1_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_a04717fefa34f146623e7c95d5eef8caa}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!handle\+\_\+packet\+\_\+connection@{handle\+\_\+packet\+\_\+connection}}
\index{handle\+\_\+packet\+\_\+connection@{handle\+\_\+packet\+\_\+connection}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{handle\+\_\+packet\+\_\+connection}]{\setlength{\rightskip}{0pt plus 5cm}static int handle\+\_\+packet\+\_\+connection (
\begin{DoxyParamCaption}
\item[{{\bf Net\+\_\+\+Crypto} $\ast$}]{c, }
\item[{int}]{crypt\+\_\+connection\+\_\+id, }
\item[{const uint8\+\_\+t $\ast$}]{packet, }
\item[{uint16\+\_\+t}]{length}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{net__crypto_8c_a04717fefa34f146623e7c95d5eef8caa}


Definition at line 1266 of file net\+\_\+crypto.\+c.



References C\+O\+O\+K\+I\+E\+\_\+\+L\+E\+N\+G\+T\+H, Crypto\+\_\+\+Connection\+::cookie\+\_\+request\+\_\+number, create\+\_\+send\+\_\+handshake(), C\+R\+Y\+P\+T\+O\+\_\+\+C\+O\+N\+N\+\_\+\+C\+O\+O\+K\+I\+E\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+I\+N\+G, C\+R\+Y\+P\+T\+O\+\_\+\+C\+O\+N\+N\+\_\+\+E\+S\+T\+A\+B\+L\+I\+S\+H\+E\+D, C\+R\+Y\+P\+T\+O\+\_\+\+C\+O\+N\+N\+\_\+\+H\+A\+N\+D\+S\+H\+A\+K\+E\+\_\+\+S\+E\+N\+T, C\+R\+Y\+P\+T\+O\+\_\+\+C\+O\+N\+N\+\_\+\+N\+O\+T\+\_\+\+C\+O\+N\+F\+I\+R\+M\+E\+D, Crypto\+\_\+\+Connection\+::dht\+\_\+pk\+\_\+callback, Crypto\+\_\+\+Connection\+::dht\+\_\+pk\+\_\+callback\+\_\+number, Crypto\+\_\+\+Connection\+::dht\+\_\+pk\+\_\+callback\+\_\+object, Crypto\+\_\+\+Connection\+::dht\+\_\+public\+\_\+key, encrypt\+\_\+precompute(), get\+\_\+crypto\+\_\+connection(), handle\+\_\+cookie\+\_\+response(), handle\+\_\+crypto\+\_\+handshake(), handle\+\_\+data\+\_\+packet\+\_\+helper(), M\+A\+X\+\_\+\+C\+R\+Y\+P\+T\+O\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+S\+I\+Z\+E, N\+E\+T\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+C\+O\+O\+K\+I\+E\+\_\+\+R\+E\+S\+P\+O\+N\+S\+E, N\+E\+T\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+C\+R\+Y\+P\+T\+O\+\_\+\+D\+A\+T\+A, N\+E\+T\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+C\+R\+Y\+P\+T\+O\+\_\+\+H\+S, Crypto\+\_\+\+Connection\+::peersessionpublic\+\_\+key, Crypto\+\_\+\+Connection\+::public\+\_\+key, public\+\_\+key\+\_\+cmp(), Crypto\+\_\+\+Connection\+::recv\+\_\+nonce, Crypto\+\_\+\+Connection\+::sessionsecret\+\_\+key, Crypto\+\_\+\+Connection\+::shared\+\_\+key, and Crypto\+\_\+\+Connection\+::status.



Referenced by tcp\+\_\+data\+\_\+callback(), and udp\+\_\+handle\+\_\+packet().


\begin{DoxyCode}
1267 \{
1268     \textcolor{keywordflow}{if} (length == 0 || length > \hyperlink{net__crypto_8h_a4358ff1fe0068c79f791ac88674aea04}{MAX\_CRYPTO\_PACKET\_SIZE})
1269         \textcolor{keywordflow}{return} -1;
1270 
1271     \hyperlink{struct_crypto___connection}{Crypto\_Connection} *conn = \hyperlink{net__crypto_8c_a909daa4b6d420cbd028f2c956a8642db}{get\_crypto\_connection}(c, 
      crypt\_connection\_id);
1272 
1273     \textcolor{keywordflow}{if} (conn == 0)
1274         \textcolor{keywordflow}{return} -1;
1275 
1276     \textcolor{keywordflow}{switch} (packet[0]) \{
1277         \textcolor{keywordflow}{case} \hyperlink{network_8h_a1162e12ce54e50cb3744e2cf69553565}{NET\_PACKET\_COOKIE\_RESPONSE}: \{
1278             \textcolor{keywordflow}{if} (conn->\hyperlink{struct_crypto___connection_ade818037fd6c985038ff29656089758d}{status} != \hyperlink{net__crypto_8h_a3982349ee55b611d39ef3014e739e403}{CRYPTO\_CONN\_COOKIE\_REQUESTING})
1279                 \textcolor{keywordflow}{return} -1;
1280 
1281             uint8\_t cookie[\hyperlink{net__crypto_8c_a905c0a7642c878ca482e2d7aff7d670c}{COOKIE\_LENGTH}];
1282             uint64\_t number;
1283 
1284             \textcolor{keywordflow}{if} (\hyperlink{net__crypto_8c_a28d8190542201eb7f1e41fe4764a7d53}{handle\_cookie\_response}(cookie, &number, packet, length, conn->
      \hyperlink{struct_crypto___connection_a81ead9fac55a0cedc30a96253a2c5119}{shared\_key}) != \textcolor{keyword}{sizeof}(cookie))
1285                 \textcolor{keywordflow}{return} -1;
1286 
1287             \textcolor{keywordflow}{if} (number != conn->\hyperlink{struct_crypto___connection_acb77d5443961bf245b63c17347b1b030}{cookie\_request\_number})
1288                 \textcolor{keywordflow}{return} -1;
1289 
1290             \textcolor{keywordflow}{if} (\hyperlink{net__crypto_8c_ad2ca4aad15dc0607252aa21cd525b5ba}{create\_send\_handshake}(c, crypt\_connection\_id, cookie, conn->
      \hyperlink{struct_crypto___connection_ab2ecaa07625ad0ed5e07d3a1f0dcc939}{dht\_public\_key}) != 0)
1291                 \textcolor{keywordflow}{return} -1;
1292 
1293             conn->\hyperlink{struct_crypto___connection_ade818037fd6c985038ff29656089758d}{status} = \hyperlink{net__crypto_8h_a83145faeb8957481e615549e05e03d78}{CRYPTO\_CONN\_HANDSHAKE\_SENT};
1294             \textcolor{keywordflow}{return} 0;
1295         \}
1296 
1297         \textcolor{keywordflow}{case} \hyperlink{network_8h_ae4ba32f7f36e935bd3a56b5e90299857}{NET\_PACKET\_CRYPTO\_HS}: \{
1298             \textcolor{keywordflow}{if} (conn->\hyperlink{struct_crypto___connection_ade818037fd6c985038ff29656089758d}{status} == \hyperlink{net__crypto_8h_a3982349ee55b611d39ef3014e739e403}{CRYPTO\_CONN\_COOKIE\_REQUESTING} || conn->
      \hyperlink{struct_crypto___connection_ade818037fd6c985038ff29656089758d}{status} == \hyperlink{net__crypto_8h_a83145faeb8957481e615549e05e03d78}{CRYPTO\_CONN\_HANDSHAKE\_SENT}
1299                     || conn->\hyperlink{struct_crypto___connection_ade818037fd6c985038ff29656089758d}{status} == \hyperlink{net__crypto_8h_ac188171760299bf65ba620fe348b9b40}{CRYPTO\_CONN\_NOT\_CONFIRMED}) \{
1300                 uint8\_t peer\_real\_pk[crypto\_box\_PUBLICKEYBYTES];
1301                 uint8\_t dht\_public\_key[crypto\_box\_PUBLICKEYBYTES];
1302                 uint8\_t cookie[\hyperlink{net__crypto_8c_a905c0a7642c878ca482e2d7aff7d670c}{COOKIE\_LENGTH}];
1303 
1304                 \textcolor{keywordflow}{if} (\hyperlink{net__crypto_8c_a33f5ee072c7c7f92f2302e98f1697cea}{handle\_crypto\_handshake}(c, conn->
      \hyperlink{struct_crypto___connection_aae0467706f97aa3ef23e5dc9c3c199d7}{recv\_nonce}, conn->\hyperlink{struct_crypto___connection_ac040d4ba2a22ee327952009e7396bb2f}{peersessionpublic\_key}, peer\_real\_pk, dht\_public\_key, 
      cookie,
1305                                             packet, length, conn->\hyperlink{struct_crypto___connection_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}) != 0)
1306                     \textcolor{keywordflow}{return} -1;
1307 
1308                 \textcolor{keywordflow}{if} (\hyperlink{crypto__core_8c_a45ba09cd560b3be51f6cb7a3859f31b3}{public\_key\_cmp}(dht\_public\_key, conn->
      \hyperlink{struct_crypto___connection_ab2ecaa07625ad0ed5e07d3a1f0dcc939}{dht\_public\_key}) == 0) \{
1309                     \hyperlink{crypto__core_8c_a0d8eaef49981c5dc3ada078866b42f6d}{encrypt\_precompute}(conn->
      \hyperlink{struct_crypto___connection_ac040d4ba2a22ee327952009e7396bb2f}{peersessionpublic\_key}, conn->\hyperlink{struct_crypto___connection_a5f38fc9ff1b20b61ffbb56d9e7f5c892}{sessionsecret\_key}, conn->
      \hyperlink{struct_crypto___connection_a81ead9fac55a0cedc30a96253a2c5119}{shared\_key});
1310 
1311                     \textcolor{keywordflow}{if} (conn->\hyperlink{struct_crypto___connection_ade818037fd6c985038ff29656089758d}{status} == \hyperlink{net__crypto_8h_a3982349ee55b611d39ef3014e739e403}{CRYPTO\_CONN\_COOKIE\_REQUESTING}) \{
1312                         \textcolor{keywordflow}{if} (\hyperlink{net__crypto_8c_ad2ca4aad15dc0607252aa21cd525b5ba}{create\_send\_handshake}(c, crypt\_connection\_id, cookie, 
      dht\_public\_key) != 0)
1313                             \textcolor{keywordflow}{return} -1;
1314                     \}
1315 
1316                     conn->\hyperlink{struct_crypto___connection_ade818037fd6c985038ff29656089758d}{status} = \hyperlink{net__crypto_8h_ac188171760299bf65ba620fe348b9b40}{CRYPTO\_CONN\_NOT\_CONFIRMED};
1317                 \} \textcolor{keywordflow}{else} \{
1318                     \textcolor{keywordflow}{if} (conn->\hyperlink{struct_crypto___connection_ab0f780a41ece58bf84d8460e71cbdbb3}{dht\_pk\_callback})
1319                         conn->\hyperlink{struct_crypto___connection_ab0f780a41ece58bf84d8460e71cbdbb3}{dht\_pk\_callback}(conn->
      \hyperlink{struct_crypto___connection_ab5d618d73b8d83fb07209433e7b448ee}{dht\_pk\_callback\_object}, conn->\hyperlink{struct_crypto___connection_ab0413da421baacf312141b8ae3ec7762}{dht\_pk\_callback\_number}, 
      dht\_public\_key);
1320                 \}
1321 
1322             \} \textcolor{keywordflow}{else} \{
1323                 \textcolor{keywordflow}{return} -1;
1324             \}
1325 
1326             \textcolor{keywordflow}{return} 0;
1327         \}
1328 
1329         \textcolor{keywordflow}{case} \hyperlink{network_8h_abd68cd32dfdf6a1e0407967df0c10a9e}{NET\_PACKET\_CRYPTO\_DATA}: \{
1330             \textcolor{keywordflow}{if} (conn->\hyperlink{struct_crypto___connection_ade818037fd6c985038ff29656089758d}{status} == \hyperlink{net__crypto_8h_ac188171760299bf65ba620fe348b9b40}{CRYPTO\_CONN\_NOT\_CONFIRMED} || conn->
      \hyperlink{struct_crypto___connection_ade818037fd6c985038ff29656089758d}{status} == \hyperlink{net__crypto_8h_ae15ad1cc9a29a669e0df83d610c188b0}{CRYPTO\_CONN\_ESTABLISHED}) \{
1331                 \textcolor{keywordflow}{return} \hyperlink{net__crypto_8c_a38debbf6310a8190eeafd33e42423f1a}{handle\_data\_packet\_helper}(c, crypt\_connection\_id, packet, 
      length);
1332             \} \textcolor{keywordflow}{else} \{
1333                 \textcolor{keywordflow}{return} -1;
1334             \}
1335 
1336             \textcolor{keywordflow}{return} 0;
1337         \}
1338 
1339         \textcolor{keywordflow}{default}: \{
1340             \textcolor{keywordflow}{return} -1;
1341         \}
1342     \}
1343 
1344     \textcolor{keywordflow}{return} 0;
1345 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a04717fefa34f146623e7c95d5eef8caa_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a04717fefa34f146623e7c95d5eef8caa_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_a4a6efacedb06b73ea8a0ce30b72b3d42}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!handle\+\_\+request\+\_\+packet@{handle\+\_\+request\+\_\+packet}}
\index{handle\+\_\+request\+\_\+packet@{handle\+\_\+request\+\_\+packet}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{handle\+\_\+request\+\_\+packet}]{\setlength{\rightskip}{0pt plus 5cm}static int handle\+\_\+request\+\_\+packet (
\begin{DoxyParamCaption}
\item[{{\bf Packets\+\_\+\+Array} $\ast$}]{send\+\_\+array, }
\item[{const uint8\+\_\+t $\ast$}]{data, }
\item[{uint16\+\_\+t}]{length, }
\item[{uint64\+\_\+t $\ast$}]{latest\+\_\+send\+\_\+time, }
\item[{uint64\+\_\+t}]{rtt\+\_\+time}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{net__crypto_8c_a4a6efacedb06b73ea8a0ce30b72b3d42}


Definition at line 661 of file net\+\_\+crypto.\+c.



References Packets\+\_\+\+Array\+::buffer, Packets\+\_\+\+Array\+::buffer\+\_\+end, Packets\+\_\+\+Array\+::buffer\+\_\+start, C\+R\+Y\+P\+T\+O\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+B\+U\+F\+F\+E\+R\+\_\+\+S\+I\+Z\+E, current\+\_\+time\+\_\+monotonic(), make-\/funny-\/savefile\+::data, i, num, P\+A\+C\+K\+E\+T\+\_\+\+I\+D\+\_\+\+R\+E\+Q\+U\+E\+S\+T, and Packet\+\_\+\+Data\+::sent\+\_\+time.



Referenced by handle\+\_\+data\+\_\+packet\+\_\+helper().


\begin{DoxyCode}
663 \{
664     \textcolor{keywordflow}{if} (length < 1)
665         \textcolor{keywordflow}{return} -1;
666 
667     \textcolor{keywordflow}{if} (\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[0] != \hyperlink{net__crypto_8h_af1de9decbe4790923c53235d3b04a00a}{PACKET\_ID\_REQUEST})
668         \textcolor{keywordflow}{return} -1;
669 
670     \textcolor{keywordflow}{if} (length == 1)
671         \textcolor{keywordflow}{return} 0;
672 
673     ++\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data};
674     --length;
675 
676     uint32\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}, n = 1;
677     uint32\_t \hyperlink{struct_file___transfers_a23cc26eca74ddec84f975c0be5496457}{requested} = 0;
678 
679     uint64\_t temp\_time = \hyperlink{irc__syncbot_8c_ae8ecaef140b786a2720eadbb85918e81}{current\_time\_monotonic}();
680     uint64\_t l\_sent\_time = ~0;
681 
682     \textcolor{keywordflow}{for} (i = send\_array->\hyperlink{struct_packets___array_a85973b335814248c05f63543876b348e}{buffer\_start}; i != send\_array->\hyperlink{struct_packets___array_a66d710e0093872b26ee80118c1a85d99}{buffer\_end}; ++i) \{
683         \textcolor{keywordflow}{if} (length == 0)
684             \textcolor{keywordflow}{break};
685 
686         uint32\_t \hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num} = i % \hyperlink{net__crypto_8h_ac73cf1eb0a938f0962ddc607945636f4}{CRYPTO\_PACKET\_BUFFER\_SIZE};
687 
688         \textcolor{keywordflow}{if} (n == \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[0]) \{
689             \textcolor{keywordflow}{if} (send\_array->\hyperlink{struct_packets___array_ae9d4e6271fdb80e86ebb3e846fcd709c}{buffer}[num]) \{
690                 uint64\_t sent\_time = send\_array->\hyperlink{struct_packets___array_ae9d4e6271fdb80e86ebb3e846fcd709c}{buffer}[\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num}]->\hyperlink{struct_packet___data_ae6e5e2c139451ff48ec8dbba5d21bb50}{sent\_time};
691 
692                 \textcolor{keywordflow}{if} ((sent\_time + rtt\_time) < temp\_time) \{
693                     send\_array->\hyperlink{struct_packets___array_ae9d4e6271fdb80e86ebb3e846fcd709c}{buffer}[\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num}]->\hyperlink{struct_packet___data_ae6e5e2c139451ff48ec8dbba5d21bb50}{sent\_time} = 0;
694                 \}
695             \}
696 
697             ++\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data};
698             --length;
699             n = 0;
700             ++\hyperlink{struct_file___transfers_a23cc26eca74ddec84f975c0be5496457}{requested};
701         \} \textcolor{keywordflow}{else} \{
702             \textcolor{keywordflow}{if} (send\_array->\hyperlink{struct_packets___array_ae9d4e6271fdb80e86ebb3e846fcd709c}{buffer}[num]) \{
703                 uint64\_t sent\_time = send\_array->\hyperlink{struct_packets___array_ae9d4e6271fdb80e86ebb3e846fcd709c}{buffer}[\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num}]->\hyperlink{struct_packet___data_ae6e5e2c139451ff48ec8dbba5d21bb50}{sent\_time};
704 
705                 \textcolor{keywordflow}{if} (l\_sent\_time < sent\_time)
706                     l\_sent\_time = sent\_time;
707 
708                 free(send\_array->\hyperlink{struct_packets___array_ae9d4e6271fdb80e86ebb3e846fcd709c}{buffer}[num]);
709                 send\_array->\hyperlink{struct_packets___array_ae9d4e6271fdb80e86ebb3e846fcd709c}{buffer}[\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num}] = NULL;
710             \}
711         \}
712 
713         \textcolor{keywordflow}{if} (n == 255) \{
714             n = 1;
715 
716             \textcolor{keywordflow}{if} (\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[0] != 0)
717                 \textcolor{keywordflow}{return} -1;
718 
719             ++\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data};
720             --length;
721         \} \textcolor{keywordflow}{else} \{
722             ++n;
723         \}
724     \}
725 
726     \textcolor{keywordflow}{if} (*latest\_send\_time < l\_sent\_time)
727         *latest\_send\_time = l\_sent\_time;
728 
729     \textcolor{keywordflow}{return} \hyperlink{struct_file___transfers_a23cc26eca74ddec84f975c0be5496457}{requested};
730 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a4a6efacedb06b73ea8a0ce30b72b3d42_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a4a6efacedb06b73ea8a0ce30b72b3d42_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_abb3546495adde3f08c0474f31c5d3a37}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!kill\+\_\+net\+\_\+crypto@{kill\+\_\+net\+\_\+crypto}}
\index{kill\+\_\+net\+\_\+crypto@{kill\+\_\+net\+\_\+crypto}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{kill\+\_\+net\+\_\+crypto}]{\setlength{\rightskip}{0pt plus 5cm}void kill\+\_\+net\+\_\+crypto (
\begin{DoxyParamCaption}
\item[{{\bf Net\+\_\+\+Crypto} $\ast$}]{c}
\end{DoxyParamCaption}
)}}\label{net__crypto_8c_abb3546495adde3f08c0474f31c5d3a37}


Definition at line 2505 of file net\+\_\+crypto.\+c.



References bs\+\_\+list\+\_\+free(), Net\+\_\+\+Crypto\+::connections\+\_\+mutex, Net\+\_\+\+Crypto\+::crypto\+\_\+connections\+\_\+length, crypto\+\_\+kill(), Net\+\_\+\+Crypto\+::dht, i, Net\+\_\+\+Crypto\+::ip\+\_\+port\+\_\+list, kill\+\_\+tcp\+\_\+connections(), D\+H\+T\+::net, N\+E\+T\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+C\+O\+O\+K\+I\+E\+\_\+\+R\+E\+Q\+U\+E\+S\+T, N\+E\+T\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+C\+O\+O\+K\+I\+E\+\_\+\+R\+E\+S\+P\+O\+N\+S\+E, N\+E\+T\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+C\+R\+Y\+P\+T\+O\+\_\+\+D\+A\+T\+A, N\+E\+T\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+C\+R\+Y\+P\+T\+O\+\_\+\+H\+S, networking\+\_\+registerhandler(), Net\+\_\+\+Crypto\+::tcp\+\_\+c, and Net\+\_\+\+Crypto\+::tcp\+\_\+mutex.



Referenced by kill\+\_\+messenger(), kill\+\_\+onions(), and new\+\_\+messenger().


\begin{DoxyCode}
2506 \{
2507     uint32\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
2508 
2509     \textcolor{keywordflow}{for} (i = 0; i < c->\hyperlink{struct_net___crypto_a9c91c3c65885a2bd39d0f864b9a5ddb9}{crypto\_connections\_length}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
2510         \hyperlink{net__crypto_8c_a16c3a0008512675dad8eb00ff1822763}{crypto\_kill}(c, i);
2511     \}
2512 
2513     pthread\_mutex\_destroy(&c->\hyperlink{struct_net___crypto_a2e8f7f4dff2f2fc4ac2cc32b0c886974}{tcp\_mutex});
2514     pthread\_mutex\_destroy(&c->\hyperlink{struct_net___crypto_a213135bf3b5b80b1cfe99b27dc42815e}{connections\_mutex});
2515 
2516     \hyperlink{_t_c_p__connection_8c_a6938788005ebe33a896755ac2b9f501a}{kill\_tcp\_connections}(c->\hyperlink{struct_net___crypto_a179982a02be89eaf6617ed81bd3c0961}{tcp\_c});
2517     \hyperlink{list_8c_a20f4503183113923cd946fc04bf8f2b4}{bs\_list\_free}(&c->\hyperlink{struct_net___crypto_ae8cfe94df9c9030bbc525010603450ac}{ip\_port\_list});
2518     \hyperlink{network_8c_a230a192ca9463ec4985d4f86de439733}{networking\_registerhandler}(c->\hyperlink{struct_net___crypto_a8b3d6ce8745acc52695e252bdb1531b6}{dht}->\hyperlink{struct_d_h_t_aa14ea2f67950f57fe4235d7375a2216c}{net}, 
      \hyperlink{network_8h_a3ad6d83af0ed67a84b327df50d66229c}{NET\_PACKET\_COOKIE\_REQUEST}, NULL, NULL);
2519     \hyperlink{network_8c_a230a192ca9463ec4985d4f86de439733}{networking\_registerhandler}(c->\hyperlink{struct_net___crypto_a8b3d6ce8745acc52695e252bdb1531b6}{dht}->\hyperlink{struct_d_h_t_aa14ea2f67950f57fe4235d7375a2216c}{net}, 
      \hyperlink{network_8h_a1162e12ce54e50cb3744e2cf69553565}{NET\_PACKET\_COOKIE\_RESPONSE}, NULL, NULL);
2520     \hyperlink{network_8c_a230a192ca9463ec4985d4f86de439733}{networking\_registerhandler}(c->\hyperlink{struct_net___crypto_a8b3d6ce8745acc52695e252bdb1531b6}{dht}->\hyperlink{struct_d_h_t_aa14ea2f67950f57fe4235d7375a2216c}{net}, 
      \hyperlink{network_8h_ae4ba32f7f36e935bd3a56b5e90299857}{NET\_PACKET\_CRYPTO\_HS}, NULL, NULL);
2521     \hyperlink{network_8c_a230a192ca9463ec4985d4f86de439733}{networking\_registerhandler}(c->\hyperlink{struct_net___crypto_a8b3d6ce8745acc52695e252bdb1531b6}{dht}->\hyperlink{struct_d_h_t_aa14ea2f67950f57fe4235d7375a2216c}{net}, 
      \hyperlink{network_8h_abd68cd32dfdf6a1e0407967df0c10a9e}{NET\_PACKET\_CRYPTO\_DATA}, NULL, NULL);
2522     memset(c, 0, \textcolor{keyword}{sizeof}(\hyperlink{struct_net___crypto}{Net\_Crypto}));
2523     free(c);
2524 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_abb3546495adde3f08c0474f31c5d3a37_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_abb3546495adde3f08c0474f31c5d3a37_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_acb48e059ed89d52de983ac4c59fcde06}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!kill\+\_\+timedout@{kill\+\_\+timedout}}
\index{kill\+\_\+timedout@{kill\+\_\+timedout}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{kill\+\_\+timedout}]{\setlength{\rightskip}{0pt plus 5cm}static void kill\+\_\+timedout (
\begin{DoxyParamCaption}
\item[{{\bf Net\+\_\+\+Crypto} $\ast$}]{c}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{net__crypto_8c_acb48e059ed89d52de983ac4c59fcde06}


Definition at line 2460 of file net\+\_\+crypto.\+c.



References connection\+\_\+kill(), C\+R\+Y\+P\+T\+O\+\_\+\+C\+O\+N\+N\+\_\+\+C\+O\+O\+K\+I\+E\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+I\+N\+G, C\+R\+Y\+P\+T\+O\+\_\+\+C\+O\+N\+N\+\_\+\+E\+S\+T\+A\+B\+L\+I\+S\+H\+E\+D, C\+R\+Y\+P\+T\+O\+\_\+\+C\+O\+N\+N\+\_\+\+H\+A\+N\+D\+S\+H\+A\+K\+E\+\_\+\+S\+E\+N\+T, C\+R\+Y\+P\+T\+O\+\_\+\+C\+O\+N\+N\+\_\+\+N\+O\+\_\+\+C\+O\+N\+N\+E\+C\+T\+I\+O\+N, C\+R\+Y\+P\+T\+O\+\_\+\+C\+O\+N\+N\+\_\+\+N\+O\+T\+\_\+\+C\+O\+N\+F\+I\+R\+M\+E\+D, Net\+\_\+\+Crypto\+::crypto\+\_\+connections\+\_\+length, get\+\_\+crypto\+\_\+connection(), i, M\+A\+X\+\_\+\+N\+U\+M\+\_\+\+S\+E\+N\+D\+P\+A\+C\+K\+E\+T\+\_\+\+T\+R\+I\+E\+S, Crypto\+\_\+\+Connection\+::status, and Crypto\+\_\+\+Connection\+::temp\+\_\+packet\+\_\+num\+\_\+sent.



Referenced by do\+\_\+net\+\_\+crypto().


\begin{DoxyCode}
2461 \{
2462     uint32\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
2463     \textcolor{comment}{//uint64\_t temp\_time = current\_time\_monotonic();}
2464 
2465     \textcolor{keywordflow}{for} (i = 0; i < c->\hyperlink{struct_net___crypto_a9c91c3c65885a2bd39d0f864b9a5ddb9}{crypto\_connections\_length}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
2466         \hyperlink{struct_crypto___connection}{Crypto\_Connection} *conn = \hyperlink{net__crypto_8c_a909daa4b6d420cbd028f2c956a8642db}{get\_crypto\_connection}(c, i);
2467 
2468         \textcolor{keywordflow}{if} (conn == 0)
2469             \textcolor{keywordflow}{return};
2470 
2471         \textcolor{keywordflow}{if} (conn->\hyperlink{struct_crypto___connection_ade818037fd6c985038ff29656089758d}{status} == \hyperlink{net__crypto_8h_ab974dcadabde124fab5287024341f7a1}{CRYPTO\_CONN\_NO\_CONNECTION})
2472             \textcolor{keywordflow}{continue};
2473 
2474         \textcolor{keywordflow}{if} (conn->\hyperlink{struct_crypto___connection_ade818037fd6c985038ff29656089758d}{status} == \hyperlink{net__crypto_8h_a3982349ee55b611d39ef3014e739e403}{CRYPTO\_CONN\_COOKIE\_REQUESTING} || conn->
      \hyperlink{struct_crypto___connection_ade818037fd6c985038ff29656089758d}{status} == \hyperlink{net__crypto_8h_a83145faeb8957481e615549e05e03d78}{CRYPTO\_CONN\_HANDSHAKE\_SENT}
2475                 || conn->\hyperlink{struct_crypto___connection_ade818037fd6c985038ff29656089758d}{status} == \hyperlink{net__crypto_8h_ac188171760299bf65ba620fe348b9b40}{CRYPTO\_CONN\_NOT\_CONFIRMED}) \{
2476             \textcolor{keywordflow}{if} (conn->\hyperlink{struct_crypto___connection_a7386b7ad7bedb9dd47d898f588b4f463}{temp\_packet\_num\_sent} < 
      \hyperlink{net__crypto_8h_adea7d88fb77084002add50dddb519cc9}{MAX\_NUM\_SENDPACKET\_TRIES})
2477                 \textcolor{keywordflow}{continue};
2478 
2479             \hyperlink{net__crypto_8c_ac679d5f08189ac10b3eca22c3f032dbc}{connection\_kill}(c, i);
2480 
2481         \}
2482 
2483         \textcolor{keywordflow}{if} (conn->\hyperlink{struct_crypto___connection_ade818037fd6c985038ff29656089758d}{status} == \hyperlink{net__crypto_8h_ae15ad1cc9a29a669e0df83d610c188b0}{CRYPTO\_CONN\_ESTABLISHED}) \{
2484             \textcolor{comment}{//TODO: add a timeout here?}
2485         \}
2486     \}
2487 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_acb48e059ed89d52de983ac4c59fcde06_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_acb48e059ed89d52de983ac4c59fcde06_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_ac8131842eafef1819a6e6da5404e3234}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!load\+\_\+secret\+\_\+key@{load\+\_\+secret\+\_\+key}}
\index{load\+\_\+secret\+\_\+key@{load\+\_\+secret\+\_\+key}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{load\+\_\+secret\+\_\+key}]{\setlength{\rightskip}{0pt plus 5cm}void load\+\_\+secret\+\_\+key (
\begin{DoxyParamCaption}
\item[{{\bf Net\+\_\+\+Crypto} $\ast$}]{c, }
\item[{const uint8\+\_\+t $\ast$}]{sk}
\end{DoxyParamCaption}
)}}\label{net__crypto_8c_ac8131842eafef1819a6e6da5404e3234}


Definition at line 2405 of file net\+\_\+crypto.\+c.



References Net\+\_\+\+Crypto\+::self\+\_\+public\+\_\+key, and Net\+\_\+\+Crypto\+::self\+\_\+secret\+\_\+key.



Referenced by messenger\+\_\+load\+\_\+state\+\_\+callback(), and tox\+\_\+new().


\begin{DoxyCode}
2406 \{
2407     memcpy(c->\hyperlink{struct_net___crypto_aa05050f86513ff53fe9da81f73c72267}{self\_secret\_key}, sk, crypto\_box\_SECRETKEYBYTES);
2408     crypto\_scalarmult\_curve25519\_base(c->\hyperlink{struct_net___crypto_ae726df8bdc26380e5a6c3187a00d6881}{self\_public\_key}, c->
      \hyperlink{struct_net___crypto_aa05050f86513ff53fe9da81f73c72267}{self\_secret\_key});
2409 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_ac8131842eafef1819a6e6da5404e3234_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_ac2a5448ebee4fd4f8fd32cc7e3ac69c0}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!max\+\_\+speed\+\_\+reached@{max\+\_\+speed\+\_\+reached}}
\index{max\+\_\+speed\+\_\+reached@{max\+\_\+speed\+\_\+reached}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{max\+\_\+speed\+\_\+reached}]{\setlength{\rightskip}{0pt plus 5cm}\+\_\+\+Bool max\+\_\+speed\+\_\+reached (
\begin{DoxyParamCaption}
\item[{{\bf Net\+\_\+\+Crypto} $\ast$}]{c, }
\item[{int}]{crypt\+\_\+connection\+\_\+id}
\end{DoxyParamCaption}
)}}\label{net__crypto_8c_ac2a5448ebee4fd4f8fd32cc7e3ac69c0}


Definition at line 2188 of file net\+\_\+crypto.\+c.



References reset\+\_\+max\+\_\+speed\+\_\+reached().



Referenced by do\+\_\+reqchunk\+\_\+filecb().


\begin{DoxyCode}
2189 \{
2190     \textcolor{keywordflow}{return} \hyperlink{net__crypto_8c_abb8a6ea2bdfb75eb366cc0a026649e2c}{reset\_max\_speed\_reached}(c, crypt\_connection\_id) != 0;
2191 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_ac2a5448ebee4fd4f8fd32cc7e3ac69c0_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_ac2a5448ebee4fd4f8fd32cc7e3ac69c0_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_a92ed6dc36b6e6996387b7542fc2580fa}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!nc\+\_\+dht\+\_\+pk\+\_\+callback@{nc\+\_\+dht\+\_\+pk\+\_\+callback}}
\index{nc\+\_\+dht\+\_\+pk\+\_\+callback@{nc\+\_\+dht\+\_\+pk\+\_\+callback}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{nc\+\_\+dht\+\_\+pk\+\_\+callback}]{\setlength{\rightskip}{0pt plus 5cm}int nc\+\_\+dht\+\_\+pk\+\_\+callback (
\begin{DoxyParamCaption}
\item[{{\bf Net\+\_\+\+Crypto} $\ast$}]{c, }
\item[{int}]{crypt\+\_\+connection\+\_\+id, }
\item[{void($\ast$)(void $\ast$data, int32\+\_\+t number, const uint8\+\_\+t $\ast$dht\+\_\+public\+\_\+key)}]{function, }
\item[{void $\ast$}]{object, }
\item[{uint32\+\_\+t}]{number}
\end{DoxyParamCaption}
)}}\label{net__crypto_8c_a92ed6dc36b6e6996387b7542fc2580fa}


Definition at line 1961 of file net\+\_\+crypto.\+c.



References Crypto\+\_\+\+Connection\+::dht\+\_\+pk\+\_\+callback, Crypto\+\_\+\+Connection\+::dht\+\_\+pk\+\_\+callback\+\_\+number, Crypto\+\_\+\+Connection\+::dht\+\_\+pk\+\_\+callback\+\_\+object, and get\+\_\+crypto\+\_\+connection().



Referenced by friend\+\_\+new\+\_\+connection(), and handle\+\_\+new\+\_\+connections().


\begin{DoxyCode}
1963 \{
1964     \hyperlink{struct_crypto___connection}{Crypto\_Connection} *conn = \hyperlink{net__crypto_8c_a909daa4b6d420cbd028f2c956a8642db}{get\_crypto\_connection}(c, 
      crypt\_connection\_id);
1965 
1966     \textcolor{keywordflow}{if} (conn == 0)
1967         \textcolor{keywordflow}{return} -1;
1968 
1969     conn->\hyperlink{struct_crypto___connection_ab0f780a41ece58bf84d8460e71cbdbb3}{dht\_pk\_callback} = \textcolor{keyword}{function};
1970     conn->\hyperlink{struct_crypto___connection_ab5d618d73b8d83fb07209433e7b448ee}{dht\_pk\_callback\_object} = object;
1971     conn->\hyperlink{struct_crypto___connection_ab0413da421baacf312141b8ae3ec7762}{dht\_pk\_callback\_number} = number;
1972     \textcolor{keywordflow}{return} 0;
1973 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a92ed6dc36b6e6996387b7542fc2580fa_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a92ed6dc36b6e6996387b7542fc2580fa_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_adaa8cd47d0ede85ca13626e91d2e995d}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!new\+\_\+connection\+\_\+handler@{new\+\_\+connection\+\_\+handler}}
\index{new\+\_\+connection\+\_\+handler@{new\+\_\+connection\+\_\+handler}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{new\+\_\+connection\+\_\+handler}]{\setlength{\rightskip}{0pt plus 5cm}void new\+\_\+connection\+\_\+handler (
\begin{DoxyParamCaption}
\item[{{\bf Net\+\_\+\+Crypto} $\ast$}]{c, }
\item[{int($\ast$)(void $\ast$object, {\bf New\+\_\+\+Connection} $\ast$n\+\_\+c)}]{new\+\_\+connection\+\_\+callback, }
\item[{void $\ast$}]{object}
\end{DoxyParamCaption}
)}}\label{net__crypto_8c_adaa8cd47d0ede85ca13626e91d2e995d}


Definition at line 1502 of file net\+\_\+crypto.\+c.



References Net\+\_\+\+Crypto\+::new\+\_\+connection\+\_\+callback, and Net\+\_\+\+Crypto\+::new\+\_\+connection\+\_\+callback\+\_\+object.



Referenced by new\+\_\+friend\+\_\+connections().


\begin{DoxyCode}
1504 \{
1505     c->\hyperlink{struct_net___crypto_a4e2c131b4a4b4ccb2acc140c29c628be}{new\_connection\_callback} = new\_connection\_callback;
1506     c->\hyperlink{struct_net___crypto_af28bac95ede5cab8426b07e02dd1a1b0}{new\_connection\_callback\_object} = object;
1507 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_adaa8cd47d0ede85ca13626e91d2e995d_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_ae09413aa94644bc88bf73b88f48ef814}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!new\+\_\+crypto\+\_\+connection@{new\+\_\+crypto\+\_\+connection}}
\index{new\+\_\+crypto\+\_\+connection@{new\+\_\+crypto\+\_\+connection}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{new\+\_\+crypto\+\_\+connection}]{\setlength{\rightskip}{0pt plus 5cm}int new\+\_\+crypto\+\_\+connection (
\begin{DoxyParamCaption}
\item[{{\bf Net\+\_\+\+Crypto} $\ast$}]{c, }
\item[{const uint8\+\_\+t $\ast$}]{real\+\_\+public\+\_\+key, }
\item[{const uint8\+\_\+t $\ast$}]{dht\+\_\+public\+\_\+key}
\end{DoxyParamCaption}
)}}\label{net__crypto_8c_ae09413aa94644bc88bf73b88f48ef814}


Definition at line 1623 of file net\+\_\+crypto.\+c.



References Crypto\+\_\+\+Connection\+::connection\+\_\+number\+\_\+tcp, C\+O\+O\+K\+I\+E\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+L\+E\+N\+G\+T\+H, Crypto\+\_\+\+Connection\+::cookie\+\_\+request\+\_\+number, create\+\_\+cookie\+\_\+request(), create\+\_\+crypto\+\_\+connection(), C\+R\+Y\+P\+T\+O\+\_\+\+C\+O\+N\+N\+\_\+\+C\+O\+O\+K\+I\+E\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+I\+N\+G, C\+R\+Y\+P\+T\+O\+\_\+\+C\+O\+N\+N\+\_\+\+N\+O\+\_\+\+C\+O\+N\+N\+E\+C\+T\+I\+O\+N, Net\+\_\+\+Crypto\+::crypto\+\_\+connections, C\+R\+Y\+P\+T\+O\+\_\+\+M\+I\+N\+\_\+\+Q\+U\+E\+U\+E\+\_\+\+L\+E\+N\+G\+T\+H, C\+R\+Y\+P\+T\+O\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+M\+I\+N\+\_\+\+R\+A\+T\+E, D\+E\+F\+A\+U\+L\+T\+\_\+\+P\+I\+N\+G\+\_\+\+C\+O\+N\+N\+E\+C\+T\+I\+O\+N, Crypto\+\_\+\+Connection\+::dht\+\_\+public\+\_\+key, getcryptconnection\+\_\+id(), kill\+\_\+tcp\+\_\+connection\+\_\+to(), new\+\_\+tcp\+\_\+connection\+\_\+to(), new\+\_\+temp\+\_\+packet(), Crypto\+\_\+\+Connection\+::packet\+\_\+send\+\_\+rate, Crypto\+\_\+\+Connection\+::packets\+\_\+left, Crypto\+\_\+\+Connection\+::public\+\_\+key, random\+\_\+64b(), random\+\_\+nonce(), Crypto\+\_\+\+Connection\+::rtt\+\_\+time, Crypto\+\_\+\+Connection\+::sent\+\_\+nonce, Crypto\+\_\+\+Connection\+::sessionpublic\+\_\+key, Crypto\+\_\+\+Connection\+::sessionsecret\+\_\+key, Crypto\+\_\+\+Connection\+::shared\+\_\+key, Crypto\+\_\+\+Connection\+::status, Net\+\_\+\+Crypto\+::tcp\+\_\+c, and Net\+\_\+\+Crypto\+::tcp\+\_\+mutex.



Referenced by friend\+\_\+new\+\_\+connection().


\begin{DoxyCode}
1624 \{
1625     \textcolor{keywordtype}{int} crypt\_connection\_id = \hyperlink{net__crypto_8c_a2a46344fe22f21eea9d777b12918e257}{getcryptconnection\_id}(c, real\_public\_key);
1626 
1627     \textcolor{keywordflow}{if} (crypt\_connection\_id != -1)
1628         \textcolor{keywordflow}{return} crypt\_connection\_id;
1629 
1630     crypt\_connection\_id = \hyperlink{net__crypto_8c_aed34560fc11f32d1b280d00152655b9b}{create\_crypto\_connection}(c);
1631 
1632     \textcolor{keywordflow}{if} (crypt\_connection\_id == -1)
1633         \textcolor{keywordflow}{return} -1;
1634 
1635     \hyperlink{struct_crypto___connection}{Crypto\_Connection} *conn = &c->\hyperlink{struct_net___crypto_a13fdc865b8a114466ba136f5390ec1b2}{crypto\_connections}[crypt\_connection\_id
      ];
1636 
1637     \textcolor{keywordflow}{if} (conn == 0)
1638         \textcolor{keywordflow}{return} -1;
1639 
1640     pthread\_mutex\_lock(&c->\hyperlink{struct_net___crypto_a2e8f7f4dff2f2fc4ac2cc32b0c886974}{tcp\_mutex});
1641     \textcolor{keywordtype}{int} connection\_number\_tcp = \hyperlink{_t_c_p__connection_8c_a22c797c7e0ef3ad66e171f05b1cb52bd}{new\_tcp\_connection\_to}(c->
      \hyperlink{struct_net___crypto_a179982a02be89eaf6617ed81bd3c0961}{tcp\_c}, dht\_public\_key, crypt\_connection\_id);
1642     pthread\_mutex\_unlock(&c->\hyperlink{struct_net___crypto_a2e8f7f4dff2f2fc4ac2cc32b0c886974}{tcp\_mutex});
1643 
1644     \textcolor{keywordflow}{if} (connection\_number\_tcp == -1)
1645         \textcolor{keywordflow}{return} -1;
1646 
1647     conn->\hyperlink{struct_crypto___connection_a51666aaba0fc5680040fe5bd6778bc50}{connection\_number\_tcp} = connection\_number\_tcp;
1648     memcpy(conn->\hyperlink{struct_crypto___connection_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, real\_public\_key, crypto\_box\_PUBLICKEYBYTES);
1649     \hyperlink{crypto__core_8c_a15ef255ab026d4881a16b99148b05dd7}{random\_nonce}(conn->\hyperlink{struct_crypto___connection_a9df0e00e8f493ed6cd1ff45e7da33c0d}{sent\_nonce});
1650     crypto\_box\_keypair(conn->\hyperlink{struct_crypto___connection_a6e74fbae398c7966800ee80f7b93dbfa}{sessionpublic\_key}, conn->
      \hyperlink{struct_crypto___connection_a5f38fc9ff1b20b61ffbb56d9e7f5c892}{sessionsecret\_key});
1651     conn->\hyperlink{struct_crypto___connection_ade818037fd6c985038ff29656089758d}{status} = \hyperlink{net__crypto_8h_a3982349ee55b611d39ef3014e739e403}{CRYPTO\_CONN\_COOKIE\_REQUESTING};
1652     conn->\hyperlink{struct_crypto___connection_a8358768a02871910ed059b1b2646438e}{packet\_send\_rate} = \hyperlink{net__crypto_8h_ab329443d2f5643d95e6034542fcb82f3}{CRYPTO\_PACKET\_MIN\_RATE};
1653     conn->\hyperlink{struct_crypto___connection_adfabcbe80305cc6b4e1c0dfef5c48653}{packets\_left} = \hyperlink{net__crypto_8h_ab0d2e7f3b3f18b516bb0a512c91b2914}{CRYPTO\_MIN\_QUEUE\_LENGTH};
1654     conn->\hyperlink{struct_crypto___connection_ae88ec876060fbc648a4c75ac596137f9}{rtt\_time} = \hyperlink{net__crypto_8h_aa737ddb8e565b8959c9d30398907026e}{DEFAULT\_PING\_CONNECTION};
1655     memcpy(conn->\hyperlink{struct_crypto___connection_ab2ecaa07625ad0ed5e07d3a1f0dcc939}{dht\_public\_key}, dht\_public\_key, crypto\_box\_PUBLICKEYBYTES);
1656 
1657     conn->\hyperlink{struct_crypto___connection_acb77d5443961bf245b63c17347b1b030}{cookie\_request\_number} = \hyperlink{crypto__core_8c_a1ce51b34ab2247e750b9c2a25121eb9e}{random\_64b}();
1658     uint8\_t cookie\_request[\hyperlink{net__crypto_8c_a25d19522f8fdd8da8932746bcf11e8aa}{COOKIE\_REQUEST\_LENGTH}];
1659 
1660     \textcolor{keywordflow}{if} (\hyperlink{net__crypto_8c_a5b67a38d23f1bbe5ff0ba96ea57520a4}{create\_cookie\_request}(c, cookie\_request, conn->
      \hyperlink{struct_crypto___connection_ab2ecaa07625ad0ed5e07d3a1f0dcc939}{dht\_public\_key}, conn->\hyperlink{struct_crypto___connection_acb77d5443961bf245b63c17347b1b030}{cookie\_request\_number},
1661                               conn->\hyperlink{struct_crypto___connection_a81ead9fac55a0cedc30a96253a2c5119}{shared\_key}) != \textcolor{keyword}{sizeof}(cookie\_request)
1662             || \hyperlink{net__crypto_8c_aa762d8aa84aa2c0a9cd48fa3d93856b1}{new\_temp\_packet}(c, crypt\_connection\_id, cookie\_request, \textcolor{keyword}{sizeof}(cookie\_request
      )) != 0) \{
1663         pthread\_mutex\_lock(&c->\hyperlink{struct_net___crypto_a2e8f7f4dff2f2fc4ac2cc32b0c886974}{tcp\_mutex});
1664         \hyperlink{_t_c_p__connection_8c_a2369688a49bef46cb2029b3bb680e11d}{kill\_tcp\_connection\_to}(c->\hyperlink{struct_net___crypto_a179982a02be89eaf6617ed81bd3c0961}{tcp\_c}, conn->
      \hyperlink{struct_crypto___connection_a51666aaba0fc5680040fe5bd6778bc50}{connection\_number\_tcp});
1665         pthread\_mutex\_unlock(&c->\hyperlink{struct_net___crypto_a2e8f7f4dff2f2fc4ac2cc32b0c886974}{tcp\_mutex});
1666         conn->\hyperlink{struct_crypto___connection_ade818037fd6c985038ff29656089758d}{status} = \hyperlink{net__crypto_8h_ab974dcadabde124fab5287024341f7a1}{CRYPTO\_CONN\_NO\_CONNECTION};
1667         \textcolor{keywordflow}{return} -1;
1668     \}
1669 
1670     \textcolor{keywordflow}{return} crypt\_connection\_id;
1671 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_ae09413aa94644bc88bf73b88f48ef814_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_ae09413aa94644bc88bf73b88f48ef814_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_abcede595fdf06772b76f60792c82ed2b}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!new\+\_\+keys@{new\+\_\+keys}}
\index{new\+\_\+keys@{new\+\_\+keys}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{new\+\_\+keys}]{\setlength{\rightskip}{0pt plus 5cm}void new\+\_\+keys (
\begin{DoxyParamCaption}
\item[{{\bf Net\+\_\+\+Crypto} $\ast$}]{c}
\end{DoxyParamCaption}
)}}\label{net__crypto_8c_abcede595fdf06772b76f60792c82ed2b}


Definition at line 2386 of file net\+\_\+crypto.\+c.



References Net\+\_\+\+Crypto\+::self\+\_\+public\+\_\+key, and Net\+\_\+\+Crypto\+::self\+\_\+secret\+\_\+key.



Referenced by new\+\_\+net\+\_\+crypto().


\begin{DoxyCode}
2387 \{
2388     crypto\_box\_keypair(c->\hyperlink{struct_net___crypto_ae726df8bdc26380e5a6c3187a00d6881}{self\_public\_key}, c->\hyperlink{struct_net___crypto_aa05050f86513ff53fe9da81f73c72267}{self\_secret\_key});
2389 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_abcede595fdf06772b76f60792c82ed2b_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_a5e46c6f42e93e2aa968f8f63de90a53c}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!new\+\_\+net\+\_\+crypto@{new\+\_\+net\+\_\+crypto}}
\index{new\+\_\+net\+\_\+crypto@{new\+\_\+net\+\_\+crypto}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{new\+\_\+net\+\_\+crypto}]{\setlength{\rightskip}{0pt plus 5cm}{\bf Net\+\_\+\+Crypto}$\ast$ new\+\_\+net\+\_\+crypto (
\begin{DoxyParamCaption}
\item[{{\bf D\+H\+T} $\ast$}]{dht, }
\item[{{\bf T\+C\+P\+\_\+\+Proxy\+\_\+\+Info} $\ast$}]{proxy\+\_\+info}
\end{DoxyParamCaption}
)}}\label{net__crypto_8c_a5e46c6f42e93e2aa968f8f63de90a53c}


Definition at line 2414 of file net\+\_\+crypto.\+c.



References bs\+\_\+list\+\_\+init(), Net\+\_\+\+Crypto\+::connections\+\_\+mutex, create\+\_\+recursive\+\_\+mutex(), C\+R\+Y\+P\+T\+O\+\_\+\+S\+E\+N\+D\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L, Net\+\_\+\+Crypto\+::current\+\_\+sleep\+\_\+time, Net\+\_\+\+Crypto\+::dht, Messenger\+::dht, Net\+\_\+\+Crypto\+::ip\+\_\+port\+\_\+list, kill\+\_\+tcp\+\_\+connections(), D\+H\+T\+::net, N\+E\+T\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+C\+O\+O\+K\+I\+E\+\_\+\+R\+E\+Q\+U\+E\+S\+T, N\+E\+T\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+C\+O\+O\+K\+I\+E\+\_\+\+R\+E\+S\+P\+O\+N\+S\+E, N\+E\+T\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+C\+R\+Y\+P\+T\+O\+\_\+\+D\+A\+T\+A, N\+E\+T\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+C\+R\+Y\+P\+T\+O\+\_\+\+H\+S, networking\+\_\+registerhandler(), new\+\_\+keys(), new\+\_\+symmetric\+\_\+key(), new\+\_\+tcp\+\_\+connections(), Net\+\_\+\+Crypto\+::secret\+\_\+symmetric\+\_\+key, D\+H\+T\+::self\+\_\+secret\+\_\+key, set\+\_\+oob\+\_\+packet\+\_\+tcp\+\_\+connection\+\_\+callback(), set\+\_\+packet\+\_\+tcp\+\_\+connection\+\_\+callback(), Net\+\_\+\+Crypto\+::tcp\+\_\+c, tcp\+\_\+data\+\_\+callback(), Net\+\_\+\+Crypto\+::tcp\+\_\+mutex, tcp\+\_\+oob\+\_\+callback(), udp\+\_\+handle\+\_\+cookie\+\_\+request(), udp\+\_\+handle\+\_\+packet(), and unix\+\_\+time\+\_\+update().



Referenced by new\+\_\+messenger(), and new\+\_\+onions().


\begin{DoxyCode}
2415 \{
2416     \hyperlink{util_8c_a849af10dd491723cf3abdef599846897}{unix\_time\_update}();
2417 
2418     \textcolor{keywordflow}{if} (dht == NULL)
2419         \textcolor{keywordflow}{return} NULL;
2420 
2421     \hyperlink{struct_net___crypto}{Net\_Crypto} *temp = calloc(1, \textcolor{keyword}{sizeof}(\hyperlink{struct_net___crypto}{Net\_Crypto}));
2422 
2423     \textcolor{keywordflow}{if} (temp == NULL)
2424         \textcolor{keywordflow}{return} NULL;
2425 
2426     temp->\hyperlink{struct_net___crypto_a179982a02be89eaf6617ed81bd3c0961}{tcp\_c} = \hyperlink{_t_c_p__connection_8c_a3526d187a2a8f91d672f0bde2dff4633}{new\_tcp\_connections}(dht->
      \hyperlink{struct_d_h_t_aa05050f86513ff53fe9da81f73c72267}{self\_secret\_key}, proxy\_info);
2427 
2428     \textcolor{keywordflow}{if} (temp->\hyperlink{struct_net___crypto_a179982a02be89eaf6617ed81bd3c0961}{tcp\_c} == NULL) \{
2429         free(temp);
2430         \textcolor{keywordflow}{return} NULL;
2431     \}
2432 
2433     \hyperlink{_t_c_p__connection_8c_afdea860d77b12c79ee24c3ade58d4ac6}{set\_packet\_tcp\_connection\_callback}(temp->
      \hyperlink{struct_net___crypto_a179982a02be89eaf6617ed81bd3c0961}{tcp\_c}, &\hyperlink{net__crypto_8c_ab2eaad4448a5deca58a00316b522e380}{tcp\_data\_callback}, temp);
2434     \hyperlink{_t_c_p__connection_8c_a13df5ebd6110288f192070b8c1c28328}{set\_oob\_packet\_tcp\_connection\_callback}(temp->
      \hyperlink{struct_net___crypto_a179982a02be89eaf6617ed81bd3c0961}{tcp\_c}, &\hyperlink{net__crypto_8c_a86a3ff661a8b9b10fd7c0daee3901091}{tcp\_oob\_callback}, temp);
2435 
2436     \textcolor{keywordflow}{if} (\hyperlink{util_8c_a2f0ae269c015342e2d29a251237ccce2}{create\_recursive\_mutex}(&temp->\hyperlink{struct_net___crypto_a2e8f7f4dff2f2fc4ac2cc32b0c886974}{tcp\_mutex}) != 0 ||
2437             pthread\_mutex\_init(&temp->\hyperlink{struct_net___crypto_a213135bf3b5b80b1cfe99b27dc42815e}{connections\_mutex}, NULL) != 0) \{
2438         \hyperlink{_t_c_p__connection_8c_a6938788005ebe33a896755ac2b9f501a}{kill\_tcp\_connections}(temp->\hyperlink{struct_net___crypto_a179982a02be89eaf6617ed81bd3c0961}{tcp\_c});
2439         free(temp);
2440         \textcolor{keywordflow}{return} NULL;
2441     \}
2442 
2443     temp->\hyperlink{struct_net___crypto_a8b3d6ce8745acc52695e252bdb1531b6}{dht} = dht;
2444 
2445     \hyperlink{net__crypto_8c_abcede595fdf06772b76f60792c82ed2b}{new\_keys}(temp);
2446     \hyperlink{crypto__core_8c_a89b4a1a4a7d8bfabdf0e1b60f074e531}{new\_symmetric\_key}(temp->\hyperlink{struct_net___crypto_ab9f2ff47bc0b1e5110202a6e4be86390}{secret\_symmetric\_key});
2447 
2448     temp->\hyperlink{struct_net___crypto_a86823a02e323235811eada4755e3f81e}{current\_sleep\_time} = \hyperlink{net__crypto_8h_a22cf528ff4b695034a0f38e6ea1cc40e}{CRYPTO\_SEND\_PACKET\_INTERVAL};
2449 
2450     \hyperlink{network_8c_a230a192ca9463ec4985d4f86de439733}{networking\_registerhandler}(dht->\hyperlink{struct_d_h_t_aa14ea2f67950f57fe4235d7375a2216c}{net}, 
      \hyperlink{network_8h_a3ad6d83af0ed67a84b327df50d66229c}{NET\_PACKET\_COOKIE\_REQUEST}, &\hyperlink{net__crypto_8c_a04fc41a4cb0d904536626006f3b7d7dd}{udp\_handle\_cookie\_request}, 
      temp);
2451     \hyperlink{network_8c_a230a192ca9463ec4985d4f86de439733}{networking\_registerhandler}(dht->\hyperlink{struct_d_h_t_aa14ea2f67950f57fe4235d7375a2216c}{net}, 
      \hyperlink{network_8h_a1162e12ce54e50cb3744e2cf69553565}{NET\_PACKET\_COOKIE\_RESPONSE}, &\hyperlink{net__crypto_8c_a812ca8a7291e22ce343669c9835c7c12}{udp\_handle\_packet}, temp);
2452     \hyperlink{network_8c_a230a192ca9463ec4985d4f86de439733}{networking\_registerhandler}(dht->\hyperlink{struct_d_h_t_aa14ea2f67950f57fe4235d7375a2216c}{net}, 
      \hyperlink{network_8h_ae4ba32f7f36e935bd3a56b5e90299857}{NET\_PACKET\_CRYPTO\_HS}, &\hyperlink{net__crypto_8c_a812ca8a7291e22ce343669c9835c7c12}{udp\_handle\_packet}, temp);
2453     \hyperlink{network_8c_a230a192ca9463ec4985d4f86de439733}{networking\_registerhandler}(dht->\hyperlink{struct_d_h_t_aa14ea2f67950f57fe4235d7375a2216c}{net}, 
      \hyperlink{network_8h_abd68cd32dfdf6a1e0407967df0c10a9e}{NET\_PACKET\_CRYPTO\_DATA}, &\hyperlink{net__crypto_8c_a812ca8a7291e22ce343669c9835c7c12}{udp\_handle\_packet}, temp);
2454 
2455     \hyperlink{list_8c_a7b07772cffb6af34e279f424dca08895}{bs\_list\_init}(&temp->\hyperlink{struct_net___crypto_ae8cfe94df9c9030bbc525010603450ac}{ip\_port\_list}, \textcolor{keyword}{sizeof}(\hyperlink{struct_i_p___port}{IP\_Port}), 8);
2456 
2457     \textcolor{keywordflow}{return} temp;
2458 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a5e46c6f42e93e2aa968f8f63de90a53c_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a5e46c6f42e93e2aa968f8f63de90a53c_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_aa762d8aa84aa2c0a9cd48fa3d93856b1}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!new\+\_\+temp\+\_\+packet@{new\+\_\+temp\+\_\+packet}}
\index{new\+\_\+temp\+\_\+packet@{new\+\_\+temp\+\_\+packet}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{new\+\_\+temp\+\_\+packet}]{\setlength{\rightskip}{0pt plus 5cm}static int new\+\_\+temp\+\_\+packet (
\begin{DoxyParamCaption}
\item[{const {\bf Net\+\_\+\+Crypto} $\ast$}]{c, }
\item[{int}]{crypt\+\_\+connection\+\_\+id, }
\item[{const uint8\+\_\+t $\ast$}]{packet, }
\item[{uint16\+\_\+t}]{length}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{net__crypto_8c_aa762d8aa84aa2c0a9cd48fa3d93856b1}


Definition at line 1003 of file net\+\_\+crypto.\+c.



References get\+\_\+crypto\+\_\+connection(), M\+A\+X\+\_\+\+C\+R\+Y\+P\+T\+O\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+S\+I\+Z\+E, Crypto\+\_\+\+Connection\+::temp\+\_\+packet, Crypto\+\_\+\+Connection\+::temp\+\_\+packet\+\_\+length, Crypto\+\_\+\+Connection\+::temp\+\_\+packet\+\_\+num\+\_\+sent, and Crypto\+\_\+\+Connection\+::temp\+\_\+packet\+\_\+sent\+\_\+time.



Referenced by create\+\_\+send\+\_\+handshake(), and new\+\_\+crypto\+\_\+connection().


\begin{DoxyCode}
1004 \{
1005     \textcolor{keywordflow}{if} (length == 0 || length > \hyperlink{net__crypto_8h_a4358ff1fe0068c79f791ac88674aea04}{MAX\_CRYPTO\_PACKET\_SIZE})
1006         \textcolor{keywordflow}{return} -1;
1007 
1008     \hyperlink{struct_crypto___connection}{Crypto\_Connection} *conn = \hyperlink{net__crypto_8c_a909daa4b6d420cbd028f2c956a8642db}{get\_crypto\_connection}(c, 
      crypt\_connection\_id);
1009 
1010     \textcolor{keywordflow}{if} (conn == 0)
1011         \textcolor{keywordflow}{return} -1;
1012 
1013     uint8\_t *temp\_packet = malloc(length);
1014 
1015     \textcolor{keywordflow}{if} (temp\_packet == 0)
1016         \textcolor{keywordflow}{return} -1;
1017 
1018     \textcolor{keywordflow}{if} (conn->\hyperlink{struct_crypto___connection_a360adb14f743065d5c69fe29a00a06a7}{temp\_packet})
1019         free(conn->\hyperlink{struct_crypto___connection_a360adb14f743065d5c69fe29a00a06a7}{temp\_packet});
1020 
1021     memcpy(temp\_packet, packet, length);
1022     conn->\hyperlink{struct_crypto___connection_a360adb14f743065d5c69fe29a00a06a7}{temp\_packet} = temp\_packet;
1023     conn->\hyperlink{struct_crypto___connection_a4ef842580c6c073f36578d0e07551cc4}{temp\_packet\_length} = length;
1024     conn->\hyperlink{struct_crypto___connection_abb5fdaef769d667f90bc97bd72d765d6}{temp\_packet\_sent\_time} = 0;
1025     conn->\hyperlink{struct_crypto___connection_a7386b7ad7bedb9dd47d898f588b4f463}{temp\_packet\_num\_sent} = 0;
1026     \textcolor{keywordflow}{return} 0;
1027 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_aa762d8aa84aa2c0a9cd48fa3d93856b1_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_aa762d8aa84aa2c0a9cd48fa3d93856b1_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_abbe1101e6464100c19aea7cde5c1d3a0}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!num\+\_\+packets\+\_\+array@{num\+\_\+packets\+\_\+array}}
\index{num\+\_\+packets\+\_\+array@{num\+\_\+packets\+\_\+array}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{num\+\_\+packets\+\_\+array}]{\setlength{\rightskip}{0pt plus 5cm}static uint32\+\_\+t num\+\_\+packets\+\_\+array (
\begin{DoxyParamCaption}
\item[{const {\bf Packets\+\_\+\+Array} $\ast$}]{array}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{net__crypto_8c_abbe1101e6464100c19aea7cde5c1d3a0}
S\+T\+A\+R\+T\+: Array Related functions 

Definition at line 444 of file net\+\_\+crypto.\+c.



References Packets\+\_\+\+Array\+::buffer\+\_\+end, and Packets\+\_\+\+Array\+::buffer\+\_\+start.



Referenced by add\+\_\+data\+\_\+end\+\_\+of\+\_\+buffer(), crypto\+\_\+num\+\_\+free\+\_\+sendqueue\+\_\+slots(), send\+\_\+crypto\+\_\+packets(), and send\+\_\+requested\+\_\+packets().


\begin{DoxyCode}
445 \{
446     \textcolor{keywordflow}{return} array->\hyperlink{struct_packets___array_a66d710e0093872b26ee80118c1a85d99}{buffer\_end} - array->\hyperlink{struct_packets___array_a85973b335814248c05f63543876b348e}{buffer\_start};
447 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_abbe1101e6464100c19aea7cde5c1d3a0_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_aadb69c5328b7e0958fb1ee1961ec2f5c}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!open\+\_\+cookie@{open\+\_\+cookie}}
\index{open\+\_\+cookie@{open\+\_\+cookie}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{open\+\_\+cookie}]{\setlength{\rightskip}{0pt plus 5cm}static int open\+\_\+cookie (
\begin{DoxyParamCaption}
\item[{uint8\+\_\+t $\ast$}]{bytes, }
\item[{const uint8\+\_\+t $\ast$}]{cookie, }
\item[{const uint8\+\_\+t $\ast$}]{encryption\+\_\+key}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{net__crypto_8c_aadb69c5328b7e0958fb1ee1961ec2f5c}


Definition at line 117 of file net\+\_\+crypto.\+c.



References C\+O\+O\+K\+I\+E\+\_\+\+C\+O\+N\+T\+E\+N\+T\+S\+\_\+\+L\+E\+N\+G\+T\+H, C\+O\+O\+K\+I\+E\+\_\+\+D\+A\+T\+A\+\_\+\+L\+E\+N\+G\+T\+H, C\+O\+O\+K\+I\+E\+\_\+\+L\+E\+N\+G\+T\+H, C\+O\+O\+K\+I\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T, decrypt\+\_\+data\+\_\+symmetric(), and unix\+\_\+time().



Referenced by handle\+\_\+crypto\+\_\+handshake().


\begin{DoxyCode}
118 \{
119     uint8\_t contents[\hyperlink{net__crypto_8c_a35fd5a283cae1c0954d99c778ac9ad27}{COOKIE\_CONTENTS\_LENGTH}];
120     \textcolor{keywordtype}{int} len = \hyperlink{crypto__core_8c_a824b257fcff74b9d17c5247223fbed29}{decrypt\_data\_symmetric}(encryption\_key, cookie, cookie + 
      crypto\_box\_NONCEBYTES,
121                                      \hyperlink{net__crypto_8c_a905c0a7642c878ca482e2d7aff7d670c}{COOKIE\_LENGTH} - crypto\_box\_NONCEBYTES, contents);
122 
123     \textcolor{keywordflow}{if} (len != \textcolor{keyword}{sizeof}(contents))
124         \textcolor{keywordflow}{return} -1;
125 
126     uint64\_t cookie\_time;
127     memcpy(&cookie\_time, contents, \textcolor{keyword}{sizeof}(cookie\_time));
128     uint64\_t temp\_time = \hyperlink{util_8c_ac958d9f8847cb8039444bfa3d304233a}{unix\_time}();
129 
130     \textcolor{keywordflow}{if} (cookie\_time + \hyperlink{net__crypto_8c_adba18a4b236aff118053b3b614499cad}{COOKIE\_TIMEOUT} < temp\_time || temp\_time < cookie\_time)
131         \textcolor{keywordflow}{return} -1;
132 
133     memcpy(bytes, contents + \textcolor{keyword}{sizeof}(cookie\_time), \hyperlink{net__crypto_8c_ada1ab442f8ac484c80c15260ab737cab}{COOKIE\_DATA\_LENGTH});
134     \textcolor{keywordflow}{return} 0;
135 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=311pt]{d8/dc6/net__crypto_8c_aadb69c5328b7e0958fb1ee1961ec2f5c_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_aadb69c5328b7e0958fb1ee1961ec2f5c_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_a8833802df3897cccb469cc3b86e097a7}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!read\+\_\+data\+\_\+beg\+\_\+buffer@{read\+\_\+data\+\_\+beg\+\_\+buffer}}
\index{read\+\_\+data\+\_\+beg\+\_\+buffer@{read\+\_\+data\+\_\+beg\+\_\+buffer}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{read\+\_\+data\+\_\+beg\+\_\+buffer}]{\setlength{\rightskip}{0pt plus 5cm}static int64\+\_\+t read\+\_\+data\+\_\+beg\+\_\+buffer (
\begin{DoxyParamCaption}
\item[{{\bf Packets\+\_\+\+Array} $\ast$}]{array, }
\item[{{\bf Packet\+\_\+\+Data} $\ast$}]{data}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{net__crypto_8c_a8833802df3897cccb469cc3b86e097a7}


Definition at line 527 of file net\+\_\+crypto.\+c.



References Packets\+\_\+\+Array\+::buffer, Packets\+\_\+\+Array\+::buffer\+\_\+end, Packets\+\_\+\+Array\+::buffer\+\_\+start, C\+R\+Y\+P\+T\+O\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+B\+U\+F\+F\+E\+R\+\_\+\+S\+I\+Z\+E, and num.



Referenced by handle\+\_\+data\+\_\+packet\+\_\+helper().


\begin{DoxyCode}
528 \{
529     \textcolor{keywordflow}{if} (array->\hyperlink{struct_packets___array_a66d710e0093872b26ee80118c1a85d99}{buffer\_end} == array->\hyperlink{struct_packets___array_a85973b335814248c05f63543876b348e}{buffer\_start})
530         \textcolor{keywordflow}{return} -1;
531 
532     uint32\_t \hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num} = array->\hyperlink{struct_packets___array_a85973b335814248c05f63543876b348e}{buffer\_start} % 
      \hyperlink{net__crypto_8h_ac73cf1eb0a938f0962ddc607945636f4}{CRYPTO\_PACKET\_BUFFER\_SIZE};
533 
534     \textcolor{keywordflow}{if} (!array->\hyperlink{struct_packets___array_ae9d4e6271fdb80e86ebb3e846fcd709c}{buffer}[num])
535         \textcolor{keywordflow}{return} -1;
536 
537     memcpy(data, array->\hyperlink{struct_packets___array_ae9d4e6271fdb80e86ebb3e846fcd709c}{buffer}[num], \textcolor{keyword}{sizeof}(\hyperlink{struct_packet___data}{Packet\_Data}));
538     uint32\_t \textcolor{keywordtype}{id} = array->\hyperlink{struct_packets___array_a85973b335814248c05f63543876b348e}{buffer\_start};
539     ++array->\hyperlink{struct_packets___array_a85973b335814248c05f63543876b348e}{buffer\_start};
540     free(array->\hyperlink{struct_packets___array_ae9d4e6271fdb80e86ebb3e846fcd709c}{buffer}[num]);
541     array->\hyperlink{struct_packets___array_ae9d4e6271fdb80e86ebb3e846fcd709c}{buffer}[\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num}] = NULL;
542     \textcolor{keywordflow}{return} \hyperlink{struct_file___transfers_aa32dbb3439461c6ccc1a52ff15bcb22e}{id};
543 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a8833802df3897cccb469cc3b86e097a7_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_ab0b745274346dc3464e35fcd756db0d2}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!realloc\+\_\+cryptoconnection@{realloc\+\_\+cryptoconnection}}
\index{realloc\+\_\+cryptoconnection@{realloc\+\_\+cryptoconnection}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{realloc\+\_\+cryptoconnection}]{\setlength{\rightskip}{0pt plus 5cm}static int realloc\+\_\+cryptoconnection (
\begin{DoxyParamCaption}
\item[{{\bf Net\+\_\+\+Crypto} $\ast$}]{c, }
\item[{uint32\+\_\+t}]{num}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{net__crypto_8c_ab0b745274346dc3464e35fcd756db0d2}


Definition at line 1352 of file net\+\_\+crypto.\+c.



References Net\+\_\+\+Crypto\+::crypto\+\_\+connections.



Referenced by create\+\_\+crypto\+\_\+connection(), and wipe\+\_\+crypto\+\_\+connection().


\begin{DoxyCode}
1353 \{
1354     \textcolor{keywordflow}{if} (\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num} == 0) \{
1355         free(c->\hyperlink{struct_net___crypto_a13fdc865b8a114466ba136f5390ec1b2}{crypto\_connections});
1356         c->\hyperlink{struct_net___crypto_a13fdc865b8a114466ba136f5390ec1b2}{crypto\_connections} = NULL;
1357         \textcolor{keywordflow}{return} 0;
1358     \}
1359 
1360     \hyperlink{struct_crypto___connection}{Crypto\_Connection} *newcrypto\_connections = realloc(c->
      \hyperlink{struct_net___crypto_a13fdc865b8a114466ba136f5390ec1b2}{crypto\_connections}, \hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num} * \textcolor{keyword}{sizeof}(\hyperlink{struct_crypto___connection}{Crypto\_Connection}));
1361 
1362     \textcolor{keywordflow}{if} (newcrypto\_connections == NULL)
1363         \textcolor{keywordflow}{return} -1;
1364 
1365     c->\hyperlink{struct_net___crypto_a13fdc865b8a114466ba136f5390ec1b2}{crypto\_connections} = newcrypto\_connections;
1366     \textcolor{keywordflow}{return} 0;
1367 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_ab0b745274346dc3464e35fcd756db0d2_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_abb8a6ea2bdfb75eb366cc0a026649e2c}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!reset\+\_\+max\+\_\+speed\+\_\+reached@{reset\+\_\+max\+\_\+speed\+\_\+reached}}
\index{reset\+\_\+max\+\_\+speed\+\_\+reached@{reset\+\_\+max\+\_\+speed\+\_\+reached}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{reset\+\_\+max\+\_\+speed\+\_\+reached}]{\setlength{\rightskip}{0pt plus 5cm}static int reset\+\_\+max\+\_\+speed\+\_\+reached (
\begin{DoxyParamCaption}
\item[{{\bf Net\+\_\+\+Crypto} $\ast$}]{c, }
\item[{int}]{crypt\+\_\+connection\+\_\+id}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{net__crypto_8c_abb8a6ea2bdfb75eb366cc0a026649e2c}


Definition at line 791 of file net\+\_\+crypto.\+c.



References Packets\+\_\+\+Array\+::buffer\+\_\+end, Packets\+\_\+\+Array\+::buffer\+\_\+start, current\+\_\+time\+\_\+monotonic(), Packet\+\_\+\+Data\+::data, get\+\_\+crypto\+\_\+connection(), get\+\_\+data\+\_\+pointer(), Packet\+\_\+\+Data\+::length, Crypto\+\_\+\+Connection\+::maximum\+\_\+speed\+\_\+reached, Crypto\+\_\+\+Connection\+::recv\+\_\+array, Crypto\+\_\+\+Connection\+::send\+\_\+array, send\+\_\+data\+\_\+packet\+\_\+helper(), and Packet\+\_\+\+Data\+::sent\+\_\+time.



Referenced by max\+\_\+speed\+\_\+reached(), and send\+\_\+lossless\+\_\+packet().


\begin{DoxyCode}
792 \{
793     \hyperlink{struct_crypto___connection}{Crypto\_Connection} *conn = \hyperlink{net__crypto_8c_a909daa4b6d420cbd028f2c956a8642db}{get\_crypto\_connection}(c, 
      crypt\_connection\_id);
794 
795     \textcolor{keywordflow}{if} (conn == 0)
796         \textcolor{keywordflow}{return} -1;
797 
798     \textcolor{comment}{/* If last packet send failed, try to send packet again.}
799 \textcolor{comment}{       If sending it fails we won't be able to send the new packet. */}
800     \textcolor{keywordflow}{if} (conn->\hyperlink{struct_crypto___connection_a8aa9d51e0fa27ad34f8046486d519275}{maximum\_speed\_reached}) \{
801         \hyperlink{struct_packet___data}{Packet\_Data} *dt = NULL;
802         uint32\_t packet\_num = conn->\hyperlink{struct_crypto___connection_aa9112ee7e76eb3e870491f7c5c272197}{send\_array}.\hyperlink{struct_packets___array_a66d710e0093872b26ee80118c1a85d99}{buffer\_end} - 1;
803         \textcolor{keywordtype}{int} ret = \hyperlink{net__crypto_8c_a1e36bfc22078fc52c29d90e8ab79295d}{get\_data\_pointer}(&conn->\hyperlink{struct_crypto___connection_aa9112ee7e76eb3e870491f7c5c272197}{send\_array}, &dt, packet\_num);
804 
805         uint8\_t send\_failed = 0;
806 
807         \textcolor{keywordflow}{if} (ret == 1) \{
808             \textcolor{keywordflow}{if} (!dt->\hyperlink{struct_packet___data_ae6e5e2c139451ff48ec8dbba5d21bb50}{sent\_time}) \{
809                 \textcolor{keywordflow}{if} (\hyperlink{net__crypto_8c_a572e703b36ffafdc4cf9dafd31a279d7}{send\_data\_packet\_helper}(c, crypt\_connection\_id, conn->
      \hyperlink{struct_crypto___connection_a1a62bc0c4bb9e349735c65f9948020d5}{recv\_array}.\hyperlink{struct_packets___array_a85973b335814248c05f63543876b348e}{buffer\_start}, packet\_num, dt->\hyperlink{struct_packet___data_ab895a6b34c217017925a6aea69c78c09}{data},
810                                             dt->\hyperlink{struct_packet___data_a1892eba2086d12ac2b09005aeb09ea3b}{length}) != 0) \{
811                     send\_failed = 1;
812                 \} \textcolor{keywordflow}{else} \{
813                     dt->\hyperlink{struct_packet___data_ae6e5e2c139451ff48ec8dbba5d21bb50}{sent\_time} = \hyperlink{irc__syncbot_8c_ae8ecaef140b786a2720eadbb85918e81}{current\_time\_monotonic}();
814                 \}
815             \}
816         \}
817 
818         \textcolor{keywordflow}{if} (!send\_failed) \{
819             conn->\hyperlink{struct_crypto___connection_a8aa9d51e0fa27ad34f8046486d519275}{maximum\_speed\_reached} = 0;
820         \} \textcolor{keywordflow}{else} \{
821             \textcolor{keywordflow}{return} -1;
822         \}
823     \}
824 
825     \textcolor{keywordflow}{return} 0;
826 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_abb8a6ea2bdfb75eb366cc0a026649e2c_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_abb8a6ea2bdfb75eb366cc0a026649e2c_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_ae2f39ed236b85952fa913fdac1785671}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!save\+\_\+keys@{save\+\_\+keys}}
\index{save\+\_\+keys@{save\+\_\+keys}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{save\+\_\+keys}]{\setlength{\rightskip}{0pt plus 5cm}void save\+\_\+keys (
\begin{DoxyParamCaption}
\item[{const {\bf Net\+\_\+\+Crypto} $\ast$}]{c, }
\item[{uint8\+\_\+t $\ast$}]{keys}
\end{DoxyParamCaption}
)}}\label{net__crypto_8c_ae2f39ed236b85952fa913fdac1785671}


Definition at line 2396 of file net\+\_\+crypto.\+c.



References Net\+\_\+\+Crypto\+::self\+\_\+public\+\_\+key, and Net\+\_\+\+Crypto\+::self\+\_\+secret\+\_\+key.



Referenced by messenger\+\_\+save().


\begin{DoxyCode}
2397 \{
2398     memcpy(keys, c->\hyperlink{struct_net___crypto_ae726df8bdc26380e5a6c3187a00d6881}{self\_public\_key}, crypto\_box\_PUBLICKEYBYTES);
2399     memcpy(keys + crypto\_box\_PUBLICKEYBYTES, c->\hyperlink{struct_net___crypto_aa05050f86513ff53fe9da81f73c72267}{self\_secret\_key}, crypto\_box\_SECRETKEYBYTES);
2400 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_ae2f39ed236b85952fa913fdac1785671_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_ad0fc252748fecbb499c4b01706476a77}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!send\+\_\+crypto\+\_\+packets@{send\+\_\+crypto\+\_\+packets}}
\index{send\+\_\+crypto\+\_\+packets@{send\+\_\+crypto\+\_\+packets}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{send\+\_\+crypto\+\_\+packets}]{\setlength{\rightskip}{0pt plus 5cm}static void send\+\_\+crypto\+\_\+packets (
\begin{DoxyParamCaption}
\item[{{\bf Net\+\_\+\+Crypto} $\ast$}]{c}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{net__crypto_8c_ad0fc252748fecbb499c4b01706476a77}


Definition at line 2042 of file net\+\_\+crypto.\+c.



References C\+O\+N\+G\+E\+S\+T\+I\+O\+N\+\_\+\+E\+V\+E\+N\+T\+\_\+\+T\+I\+M\+E\+O\+U\+T, C\+O\+N\+G\+E\+S\+T\+I\+O\+N\+\_\+\+Q\+U\+E\+U\+E\+\_\+\+A\+R\+R\+A\+Y\+\_\+\+S\+I\+Z\+E, C\+R\+Y\+P\+T\+O\+\_\+\+C\+O\+N\+N\+\_\+\+E\+S\+T\+A\+B\+L\+I\+S\+H\+E\+D, C\+R\+Y\+P\+T\+O\+\_\+\+C\+O\+N\+N\+\_\+\+N\+O\+T\+\_\+\+C\+O\+N\+F\+I\+R\+M\+E\+D, Net\+\_\+\+Crypto\+::crypto\+\_\+connections\+\_\+length, C\+R\+Y\+P\+T\+O\+\_\+\+M\+I\+N\+\_\+\+Q\+U\+E\+U\+E\+\_\+\+L\+E\+N\+G\+T\+H, C\+R\+Y\+P\+T\+O\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+M\+I\+N\+\_\+\+R\+A\+T\+E, C\+R\+Y\+P\+T\+O\+\_\+\+S\+E\+N\+D\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L, Net\+\_\+\+Crypto\+::current\+\_\+sleep\+\_\+time, current\+\_\+time\+\_\+monotonic(), get\+\_\+crypto\+\_\+connection(), i, Crypto\+\_\+\+Connection\+::last\+\_\+congestion\+\_\+event, Crypto\+\_\+\+Connection\+::last\+\_\+num\+\_\+packets\+\_\+sent, Crypto\+\_\+\+Connection\+::last\+\_\+packets\+\_\+left\+\_\+set, Crypto\+\_\+\+Connection\+::last\+\_\+request\+\_\+packet\+\_\+sent, Crypto\+\_\+\+Connection\+::last\+\_\+sendqueue\+\_\+counter, Crypto\+\_\+\+Connection\+::last\+\_\+sendqueue\+\_\+size, num\+\_\+packets\+\_\+array(), Crypto\+\_\+\+Connection\+::packet\+\_\+counter, P\+A\+C\+K\+E\+T\+\_\+\+C\+O\+U\+N\+T\+E\+R\+\_\+\+A\+V\+E\+R\+A\+G\+E\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L, Crypto\+\_\+\+Connection\+::packet\+\_\+counter\+\_\+set, Crypto\+\_\+\+Connection\+::packet\+\_\+recv\+\_\+rate, P\+A\+C\+K\+E\+T\+\_\+\+R\+E\+S\+E\+N\+D\+\_\+\+M\+U\+L\+T\+I\+P\+L\+I\+E\+R, Crypto\+\_\+\+Connection\+::packet\+\_\+send\+\_\+rate, Crypto\+\_\+\+Connection\+::packets\+\_\+left, Crypto\+\_\+\+Connection\+::packets\+\_\+sent, Crypto\+\_\+\+Connection\+::recv\+\_\+array, R\+E\+Q\+U\+E\+S\+T\+\_\+\+P\+A\+C\+K\+E\+T\+S\+\_\+\+C\+O\+M\+P\+A\+R\+E\+\_\+\+C\+O\+N\+S\+T\+A\+N\+T, Crypto\+\_\+\+Connection\+::send\+\_\+array, send\+\_\+request\+\_\+packet(), send\+\_\+requested\+\_\+packets(), send\+\_\+temp\+\_\+packet(), Crypto\+\_\+\+Connection\+::status, and Crypto\+\_\+\+Connection\+::temp\+\_\+packet\+\_\+sent\+\_\+time.



Referenced by do\+\_\+net\+\_\+crypto().


\begin{DoxyCode}
2043 \{
2044     uint32\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
2045     uint64\_t temp\_time = \hyperlink{irc__syncbot_8c_ae8ecaef140b786a2720eadbb85918e81}{current\_time\_monotonic}();
2046     \textcolor{keywordtype}{double} total\_send\_rate = 0;
2047     uint32\_t peak\_request\_packet\_interval = ~0;
2048 
2049     \textcolor{keywordflow}{for} (i = 0; i < c->\hyperlink{struct_net___crypto_a9c91c3c65885a2bd39d0f864b9a5ddb9}{crypto\_connections\_length}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
2050         \hyperlink{struct_crypto___connection}{Crypto\_Connection} *conn = \hyperlink{net__crypto_8c_a909daa4b6d420cbd028f2c956a8642db}{get\_crypto\_connection}(c, i);
2051 
2052         \textcolor{keywordflow}{if} (conn == 0)
2053             \textcolor{keywordflow}{return};
2054 
2055         \textcolor{keywordflow}{if} (\hyperlink{net__crypto_8h_a22cf528ff4b695034a0f38e6ea1cc40e}{CRYPTO\_SEND\_PACKET\_INTERVAL} + conn->
      \hyperlink{struct_crypto___connection_abb5fdaef769d667f90bc97bd72d765d6}{temp\_packet\_sent\_time} < temp\_time) \{
2056             \hyperlink{net__crypto_8c_ae0a00f5fe1955d7d15af11eacc20997b}{send\_temp\_packet}(c, i);
2057         \}
2058 
2059         \textcolor{keywordflow}{if} ((conn->\hyperlink{struct_crypto___connection_ade818037fd6c985038ff29656089758d}{status} == \hyperlink{net__crypto_8h_ac188171760299bf65ba620fe348b9b40}{CRYPTO\_CONN\_NOT\_CONFIRMED} || conn->
      \hyperlink{struct_crypto___connection_ade818037fd6c985038ff29656089758d}{status} == \hyperlink{net__crypto_8h_ae15ad1cc9a29a669e0df83d610c188b0}{CRYPTO\_CONN\_ESTABLISHED})
2060                 && (\hyperlink{net__crypto_8h_a22cf528ff4b695034a0f38e6ea1cc40e}{CRYPTO\_SEND\_PACKET\_INTERVAL} + conn->
      \hyperlink{struct_crypto___connection_aa0c15e9ada39b9e8d1f27e2a10ad2e0e}{last\_request\_packet\_sent}) < temp\_time) \{
2061             \textcolor{keywordflow}{if} (\hyperlink{net__crypto_8c_a31370353b1f1c90c8fb06ae736be1a0d}{send\_request\_packet}(c, i) == 0) \{
2062                 conn->\hyperlink{struct_crypto___connection_aa0c15e9ada39b9e8d1f27e2a10ad2e0e}{last\_request\_packet\_sent} = temp\_time;
2063             \}
2064 
2065         \}
2066 
2067         \textcolor{keywordflow}{if} (conn->\hyperlink{struct_crypto___connection_ade818037fd6c985038ff29656089758d}{status} == \hyperlink{net__crypto_8h_ae15ad1cc9a29a669e0df83d610c188b0}{CRYPTO\_CONN\_ESTABLISHED}) \{
2068             \textcolor{keywordflow}{if} (conn->\hyperlink{struct_crypto___connection_ae1c1fa0c995f0fab590b094baa769e8d}{packet\_recv\_rate} > \hyperlink{net__crypto_8h_ab329443d2f5643d95e6034542fcb82f3}{CRYPTO\_PACKET\_MIN\_RATE}) \{
2069                 \textcolor{keywordtype}{double} request\_packet\_interval = (
      \hyperlink{net__crypto_8c_a81678e56442d540709e358b402f015da}{REQUEST\_PACKETS\_COMPARE\_CONSTANT} / (((double)
      \hyperlink{net__crypto_8c_abbe1101e6464100c19aea7cde5c1d3a0}{num\_packets\_array}(
2070                                                       &conn->\hyperlink{struct_crypto___connection_a1a62bc0c4bb9e349735c65f9948020d5}{recv\_array}) + 1.0) / (conn->
      \hyperlink{struct_crypto___connection_ae1c1fa0c995f0fab590b094baa769e8d}{packet\_recv\_rate} + 1.0)));
2071 
2072                 \textcolor{keywordflow}{if} (temp\_time - conn->\hyperlink{struct_crypto___connection_aa0c15e9ada39b9e8d1f27e2a10ad2e0e}{last\_request\_packet\_sent} > (uint64\_t)
      request\_packet\_interval) \{
2073                     \textcolor{keywordflow}{if} (\hyperlink{net__crypto_8c_a31370353b1f1c90c8fb06ae736be1a0d}{send\_request\_packet}(c, i) == 0) \{
2074                         conn->\hyperlink{struct_crypto___connection_aa0c15e9ada39b9e8d1f27e2a10ad2e0e}{last\_request\_packet\_sent} = temp\_time;
2075                     \}
2076                 \}
2077 
2078                 \textcolor{keywordflow}{if} (request\_packet\_interval < peak\_request\_packet\_interval) \{
2079                     peak\_request\_packet\_interval = request\_packet\_interval;
2080                 \}
2081             \}
2082 
2083             \textcolor{keywordflow}{if} ((\hyperlink{net__crypto_8c_a6f21b0600be4cfb620ec7de106df2675}{PACKET\_COUNTER\_AVERAGE\_INTERVAL} + conn->
      \hyperlink{struct_crypto___connection_a77c1105a8f0d4de4daab379a572bb11c}{packet\_counter\_set}) < temp\_time) \{
2084 
2085                 \textcolor{keywordtype}{double} dt = temp\_time - conn->\hyperlink{struct_crypto___connection_a77c1105a8f0d4de4daab379a572bb11c}{packet\_counter\_set};
2086 
2087                 conn->\hyperlink{struct_crypto___connection_ae1c1fa0c995f0fab590b094baa769e8d}{packet\_recv\_rate} = (double)conn->
      \hyperlink{struct_crypto___connection_a253e0640ca1d914e479ea37e97d1ba12}{packet\_counter} / (dt / 1000.0);
2088                 conn->\hyperlink{struct_crypto___connection_a253e0640ca1d914e479ea37e97d1ba12}{packet\_counter} = 0;
2089                 conn->\hyperlink{struct_crypto___connection_a77c1105a8f0d4de4daab379a572bb11c}{packet\_counter\_set} = temp\_time;
2090 
2091                 uint32\_t packets\_sent = conn->\hyperlink{struct_crypto___connection_ad51d37ac38989c1d089da8aa0d1bc1d7}{packets\_sent};
2092                 conn->\hyperlink{struct_crypto___connection_ad51d37ac38989c1d089da8aa0d1bc1d7}{packets\_sent} = 0;
2093 
2094                 \textcolor{comment}{/* conjestion control}
2095 \textcolor{comment}{                    calculate a new value of conn->packet\_send\_rate based on some data}
2096 \textcolor{comment}{                 */}
2097 
2098                 \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} pos = conn->\hyperlink{struct_crypto___connection_a9fff7889476ca9104b603dd03781e0c9}{last\_sendqueue\_counter} % 
      \hyperlink{net__crypto_8h_a0f273efcbb427d7ab96d56de4de63137}{CONGESTION\_QUEUE\_ARRAY\_SIZE};
2099                 conn->\hyperlink{struct_crypto___connection_a0157f7d2fcd3f9d92521930547ddaae6}{last\_sendqueue\_size}[pos] = 
      \hyperlink{net__crypto_8c_abbe1101e6464100c19aea7cde5c1d3a0}{num\_packets\_array}(&conn->\hyperlink{struct_crypto___connection_aa9112ee7e76eb3e870491f7c5c272197}{send\_array});
2100                 ++conn->\hyperlink{struct_crypto___connection_a9fff7889476ca9104b603dd03781e0c9}{last\_sendqueue\_counter};
2101 
2102                 \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} j;
2103                 \textcolor{keywordtype}{long} \textcolor{keywordtype}{signed} \textcolor{keywordtype}{int} sum = 0;
2104                 sum = (\textcolor{keywordtype}{long} \textcolor{keywordtype}{signed} int)conn->\hyperlink{struct_crypto___connection_a0157f7d2fcd3f9d92521930547ddaae6}{last\_sendqueue\_size}[(pos) % 
      \hyperlink{net__crypto_8h_a0f273efcbb427d7ab96d56de4de63137}{CONGESTION\_QUEUE\_ARRAY\_SIZE}] -
2105                       (\textcolor{keywordtype}{long} \textcolor{keywordtype}{signed} int)conn->\hyperlink{struct_crypto___connection_a0157f7d2fcd3f9d92521930547ddaae6}{last\_sendqueue\_size}[(pos - (
      \hyperlink{net__crypto_8h_a0f273efcbb427d7ab96d56de4de63137}{CONGESTION\_QUEUE\_ARRAY\_SIZE} - 1)) % 
      \hyperlink{net__crypto_8h_a0f273efcbb427d7ab96d56de4de63137}{CONGESTION\_QUEUE\_ARRAY\_SIZE}];
2106 
2107                 conn->\hyperlink{struct_crypto___connection_aa6d1d107adcffe30564bf3837faefca4}{last\_num\_packets\_sent}[pos] = packets\_sent;
2108                 \textcolor{keywordtype}{long} \textcolor{keywordtype}{signed} \textcolor{keywordtype}{int} total\_sent = 0;
2109 
2110                 \textcolor{keywordflow}{for} (j = 0; j < \hyperlink{net__crypto_8h_a0f273efcbb427d7ab96d56de4de63137}{CONGESTION\_QUEUE\_ARRAY\_SIZE}; ++j) \{
2111                     total\_sent += conn->\hyperlink{struct_crypto___connection_aa6d1d107adcffe30564bf3837faefca4}{last\_num\_packets\_sent}[j];
2112                 \}
2113 
2114                 total\_sent -= sum;
2115 
2116                 \textcolor{keywordtype}{double} min\_speed = 1000.0 * (((double)(total\_sent)) / ((\textcolor{keywordtype}{double})(
      \hyperlink{net__crypto_8h_a0f273efcbb427d7ab96d56de4de63137}{CONGESTION\_QUEUE\_ARRAY\_SIZE}) *
2117                                              \hyperlink{net__crypto_8c_a6f21b0600be4cfb620ec7de106df2675}{PACKET\_COUNTER\_AVERAGE\_INTERVAL}
      ));
2118 
2119                 \textcolor{keywordflow}{if} (conn->\hyperlink{struct_crypto___connection_ad33f09e937800c05f22fa695e756554d}{last\_congestion\_event} + 
      \hyperlink{net__crypto_8c_ab07fbb1d15443ad37bfa7c13af21be75}{CONGESTION\_EVENT\_TIMEOUT} < temp\_time) \{
2120                     conn->\hyperlink{struct_crypto___connection_a8358768a02871910ed059b1b2646438e}{packet\_send\_rate} = min\_speed * 1.25;
2121                 \} \textcolor{keywordflow}{else} \{
2122                     conn->\hyperlink{struct_crypto___connection_a8358768a02871910ed059b1b2646438e}{packet\_send\_rate} = min\_speed;
2123                 \}
2124 
2125                 \textcolor{keywordflow}{if} (conn->\hyperlink{struct_crypto___connection_a8358768a02871910ed059b1b2646438e}{packet\_send\_rate} < 
      \hyperlink{net__crypto_8h_ab329443d2f5643d95e6034542fcb82f3}{CRYPTO\_PACKET\_MIN\_RATE}) \{
2126                     conn->\hyperlink{struct_crypto___connection_a8358768a02871910ed059b1b2646438e}{packet\_send\_rate} = 
      \hyperlink{net__crypto_8h_ab329443d2f5643d95e6034542fcb82f3}{CRYPTO\_PACKET\_MIN\_RATE};
2127                 \}
2128 
2129             \}
2130 
2131             \textcolor{keywordflow}{if} (conn->\hyperlink{struct_crypto___connection_a3c50560fad9a00689d5d3f143f4b56aa}{last\_packets\_left\_set} == 0) \{
2132                 conn->\hyperlink{struct_crypto___connection_a3c50560fad9a00689d5d3f143f4b56aa}{last\_packets\_left\_set} = temp\_time;
2133                 conn->\hyperlink{struct_crypto___connection_adfabcbe80305cc6b4e1c0dfef5c48653}{packets\_left} = \hyperlink{net__crypto_8h_ab0d2e7f3b3f18b516bb0a512c91b2914}{CRYPTO\_MIN\_QUEUE\_LENGTH};
2134             \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (((uint64\_t)((1000.0 / conn->\hyperlink{struct_crypto___connection_a8358768a02871910ed059b1b2646438e}{packet\_send\_rate}) + 0.5) + conn->
      \hyperlink{struct_crypto___connection_a3c50560fad9a00689d5d3f143f4b56aa}{last\_packets\_left\_set}) < temp\_time) \{
2135                 uint32\_t num\_packets = conn->\hyperlink{struct_crypto___connection_a8358768a02871910ed059b1b2646438e}{packet\_send\_rate} * ((double)(temp\_time - conn
      ->\hyperlink{struct_crypto___connection_a3c50560fad9a00689d5d3f143f4b56aa}{last\_packets\_left\_set}) / 1000.0) + 0.5;
2136 
2137                 \textcolor{keywordflow}{if} (conn->\hyperlink{struct_crypto___connection_adfabcbe80305cc6b4e1c0dfef5c48653}{packets\_left} > num\_packets * 4 + 
      \hyperlink{net__crypto_8h_ab0d2e7f3b3f18b516bb0a512c91b2914}{CRYPTO\_MIN\_QUEUE\_LENGTH}) \{
2138                     conn->\hyperlink{struct_crypto___connection_adfabcbe80305cc6b4e1c0dfef5c48653}{packets\_left} = num\_packets * 4 + 
      \hyperlink{net__crypto_8h_ab0d2e7f3b3f18b516bb0a512c91b2914}{CRYPTO\_MIN\_QUEUE\_LENGTH};
2139                 \} \textcolor{keywordflow}{else} \{
2140                     conn->\hyperlink{struct_crypto___connection_adfabcbe80305cc6b4e1c0dfef5c48653}{packets\_left} += num\_packets;
2141                 \}
2142 
2143                 conn->\hyperlink{struct_crypto___connection_a3c50560fad9a00689d5d3f143f4b56aa}{last\_packets\_left\_set} = temp\_time;
2144             \}
2145 
2146             \textcolor{keywordtype}{int} ret = \hyperlink{net__crypto_8c_ac64daefe87866ea116735f3540be3092}{send\_requested\_packets}(c, i, conn->
      \hyperlink{struct_crypto___connection_adfabcbe80305cc6b4e1c0dfef5c48653}{packets\_left} * \hyperlink{net__crypto_8c_a6a3b41060125fe2f17cc1c5818f52756}{PACKET\_RESEND\_MULTIPLIER});
2147 
2148             \textcolor{keywordflow}{if} (ret != -1) \{
2149                 \textcolor{keywordflow}{if} ((\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int})ret < conn->packets\_left) \{
2150                     conn->\hyperlink{struct_crypto___connection_adfabcbe80305cc6b4e1c0dfef5c48653}{packets\_left} -= ret;
2151                 \} \textcolor{keywordflow}{else} \{
2152                     conn->\hyperlink{struct_crypto___connection_ad33f09e937800c05f22fa695e756554d}{last\_congestion\_event} = temp\_time;
2153                     conn->\hyperlink{struct_crypto___connection_adfabcbe80305cc6b4e1c0dfef5c48653}{packets\_left} = 0;
2154                 \}
2155             \}
2156 
2157             \textcolor{keywordflow}{if} (conn->\hyperlink{struct_crypto___connection_a8358768a02871910ed059b1b2646438e}{packet\_send\_rate} > \hyperlink{net__crypto_8h_ab329443d2f5643d95e6034542fcb82f3}{CRYPTO\_PACKET\_MIN\_RATE} * 1.5
      ) \{
2158                 total\_send\_rate += conn->\hyperlink{struct_crypto___connection_a8358768a02871910ed059b1b2646438e}{packet\_send\_rate};
2159             \}
2160         \}
2161     \}
2162 
2163     c->\hyperlink{struct_net___crypto_a86823a02e323235811eada4755e3f81e}{current\_sleep\_time} = ~0;
2164     uint32\_t sleep\_time = peak\_request\_packet\_interval;
2165 
2166     \textcolor{keywordflow}{if} (c->\hyperlink{struct_net___crypto_a86823a02e323235811eada4755e3f81e}{current\_sleep\_time} > sleep\_time) \{
2167         c->\hyperlink{struct_net___crypto_a86823a02e323235811eada4755e3f81e}{current\_sleep\_time} = sleep\_time;
2168     \}
2169 
2170     \textcolor{keywordflow}{if} (total\_send\_rate > \hyperlink{net__crypto_8h_ab329443d2f5643d95e6034542fcb82f3}{CRYPTO\_PACKET\_MIN\_RATE}) \{
2171         sleep\_time = (1000.0 / total\_send\_rate);
2172 
2173         \textcolor{keywordflow}{if} (c->\hyperlink{struct_net___crypto_a86823a02e323235811eada4755e3f81e}{current\_sleep\_time} > sleep\_time) \{
2174             c->\hyperlink{struct_net___crypto_a86823a02e323235811eada4755e3f81e}{current\_sleep\_time} = sleep\_time + 1;
2175         \}
2176     \}
2177 
2178     sleep\_time = \hyperlink{net__crypto_8h_a22cf528ff4b695034a0f38e6ea1cc40e}{CRYPTO\_SEND\_PACKET\_INTERVAL};
2179 
2180     \textcolor{keywordflow}{if} (c->\hyperlink{struct_net___crypto_a86823a02e323235811eada4755e3f81e}{current\_sleep\_time} > sleep\_time) \{
2181         c->\hyperlink{struct_net___crypto_a86823a02e323235811eada4755e3f81e}{current\_sleep\_time} = sleep\_time;
2182     \}
2183 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_ad0fc252748fecbb499c4b01706476a77_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_ad0fc252748fecbb499c4b01706476a77_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_a507dd998c297ff5a666bd08121dd4143}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!send\+\_\+data\+\_\+packet@{send\+\_\+data\+\_\+packet}}
\index{send\+\_\+data\+\_\+packet@{send\+\_\+data\+\_\+packet}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{send\+\_\+data\+\_\+packet}]{\setlength{\rightskip}{0pt plus 5cm}static int send\+\_\+data\+\_\+packet (
\begin{DoxyParamCaption}
\item[{{\bf Net\+\_\+\+Crypto} $\ast$}]{c, }
\item[{int}]{crypt\+\_\+connection\+\_\+id, }
\item[{const uint8\+\_\+t $\ast$}]{data, }
\item[{uint16\+\_\+t}]{length}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{net__crypto_8c_a507dd998c297ff5a666bd08121dd4143}


Definition at line 741 of file net\+\_\+crypto.\+c.



References encrypt\+\_\+data\+\_\+symmetric(), get\+\_\+crypto\+\_\+connection(), increment\+\_\+nonce(), M\+A\+X\+\_\+\+C\+R\+Y\+P\+T\+O\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+S\+I\+Z\+E, Crypto\+\_\+\+Connection\+::mutex, N\+E\+T\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+C\+R\+Y\+P\+T\+O\+\_\+\+D\+A\+T\+A, send\+\_\+packet\+\_\+to(), Crypto\+\_\+\+Connection\+::sent\+\_\+nonce, and Crypto\+\_\+\+Connection\+::shared\+\_\+key.



Referenced by send\+\_\+data\+\_\+packet\+\_\+helper().


\begin{DoxyCode}
742 \{
743     \textcolor{keywordflow}{if} (length == 0 || length + (1 + \textcolor{keyword}{sizeof}(uint16\_t) + crypto\_box\_MACBYTES) > 
      \hyperlink{net__crypto_8h_a4358ff1fe0068c79f791ac88674aea04}{MAX\_CRYPTO\_PACKET\_SIZE})
744         \textcolor{keywordflow}{return} -1;
745 
746     \hyperlink{struct_crypto___connection}{Crypto\_Connection} *conn = \hyperlink{net__crypto_8c_a909daa4b6d420cbd028f2c956a8642db}{get\_crypto\_connection}(c, 
      crypt\_connection\_id);
747 
748     \textcolor{keywordflow}{if} (conn == 0)
749         \textcolor{keywordflow}{return} -1;
750 
751     pthread\_mutex\_lock(&conn->\hyperlink{struct_crypto___connection_a4acff8232e4aec9cd5c6dc200ac55ef3}{mutex});
752     uint8\_t packet[1 + \textcolor{keyword}{sizeof}(uint16\_t) + length + crypto\_box\_MACBYTES];
753     packet[0] = \hyperlink{network_8h_abd68cd32dfdf6a1e0407967df0c10a9e}{NET\_PACKET\_CRYPTO\_DATA};
754     memcpy(packet + 1, conn->\hyperlink{struct_crypto___connection_a9df0e00e8f493ed6cd1ff45e7da33c0d}{sent\_nonce} + (crypto\_box\_NONCEBYTES - \textcolor{keyword}{sizeof}(uint16\_t)), \textcolor{keyword}{sizeof}(
      uint16\_t));
755     \textcolor{keywordtype}{int} len = \hyperlink{crypto__core_8c_a81efc0a4a6e0efe372651e26e342a6e5}{encrypt\_data\_symmetric}(conn->\hyperlink{struct_crypto___connection_a81ead9fac55a0cedc30a96253a2c5119}{shared\_key}, conn->
      \hyperlink{struct_crypto___connection_a9df0e00e8f493ed6cd1ff45e7da33c0d}{sent\_nonce}, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}, length, packet + 1 + \textcolor{keyword}{sizeof}(uint16\_t));
756 
757     \textcolor{keywordflow}{if} (len + 1 + \textcolor{keyword}{sizeof}(uint16\_t) != \textcolor{keyword}{sizeof}(packet)) \{
758         pthread\_mutex\_unlock(&conn->\hyperlink{struct_crypto___connection_a4acff8232e4aec9cd5c6dc200ac55ef3}{mutex});
759         \textcolor{keywordflow}{return} -1;
760     \}
761 
762     \hyperlink{crypto__core_8c_ab953f1e92b8a9a193f69f02323b9c980}{increment\_nonce}(conn->\hyperlink{struct_crypto___connection_a9df0e00e8f493ed6cd1ff45e7da33c0d}{sent\_nonce});
763     pthread\_mutex\_unlock(&conn->\hyperlink{struct_crypto___connection_a4acff8232e4aec9cd5c6dc200ac55ef3}{mutex});
764 
765     \textcolor{keywordflow}{return} \hyperlink{net__crypto_8c_a94d4c99b16cb7bd2dd61f9a7a8caf94a}{send\_packet\_to}(c, crypt\_connection\_id, packet, \textcolor{keyword}{sizeof}(packet));
766 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a507dd998c297ff5a666bd08121dd4143_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a507dd998c297ff5a666bd08121dd4143_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_a572e703b36ffafdc4cf9dafd31a279d7}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!send\+\_\+data\+\_\+packet\+\_\+helper@{send\+\_\+data\+\_\+packet\+\_\+helper}}
\index{send\+\_\+data\+\_\+packet\+\_\+helper@{send\+\_\+data\+\_\+packet\+\_\+helper}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{send\+\_\+data\+\_\+packet\+\_\+helper}]{\setlength{\rightskip}{0pt plus 5cm}static int send\+\_\+data\+\_\+packet\+\_\+helper (
\begin{DoxyParamCaption}
\item[{{\bf Net\+\_\+\+Crypto} $\ast$}]{c, }
\item[{int}]{crypt\+\_\+connection\+\_\+id, }
\item[{uint32\+\_\+t}]{buffer\+\_\+start, }
\item[{uint32\+\_\+t}]{num, }
\item[{const uint8\+\_\+t $\ast$}]{data, }
\item[{uint16\+\_\+t}]{length}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{net__crypto_8c_a572e703b36ffafdc4cf9dafd31a279d7}


Definition at line 773 of file net\+\_\+crypto.\+c.



References C\+R\+Y\+P\+T\+O\+\_\+\+M\+A\+X\+\_\+\+P\+A\+D\+D\+I\+N\+G, M\+A\+X\+\_\+\+C\+R\+Y\+P\+T\+O\+\_\+\+D\+A\+T\+A\+\_\+\+S\+I\+Z\+E, P\+A\+C\+K\+E\+T\+\_\+\+I\+D\+\_\+\+P\+A\+D\+D\+I\+N\+G, and send\+\_\+data\+\_\+packet().



Referenced by reset\+\_\+max\+\_\+speed\+\_\+reached(), send\+\_\+kill\+\_\+packet(), send\+\_\+lossless\+\_\+packet(), send\+\_\+lossy\+\_\+cryptpacket(), send\+\_\+request\+\_\+packet(), and send\+\_\+requested\+\_\+packets().


\begin{DoxyCode}
775 \{
776     \textcolor{keywordflow}{if} (length == 0 || length > \hyperlink{net__crypto_8h_a1b6e5122f9fdc5ef548ccf920f0c246e}{MAX\_CRYPTO\_DATA\_SIZE})
777         \textcolor{keywordflow}{return} -1;
778 
779     \hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num} = htonl(\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num});
780     buffer\_start = htonl(buffer\_start);
781     uint16\_t padding\_length = (\hyperlink{net__crypto_8h_a1b6e5122f9fdc5ef548ccf920f0c246e}{MAX\_CRYPTO\_DATA\_SIZE} - length) % 
      \hyperlink{net__crypto_8h_a3e42bab1226f7962c22372f29012a0d6}{CRYPTO\_MAX\_PADDING};
782     uint8\_t packet[\textcolor{keyword}{sizeof}(uint32\_t) + \textcolor{keyword}{sizeof}(uint32\_t) + padding\_length + length];
783     memcpy(packet, &buffer\_start, \textcolor{keyword}{sizeof}(uint32\_t));
784     memcpy(packet + \textcolor{keyword}{sizeof}(uint32\_t), &\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num}, \textcolor{keyword}{sizeof}(uint32\_t));
785     memset(packet + (\textcolor{keyword}{sizeof}(uint32\_t) * 2), \hyperlink{net__crypto_8h_aacaea3de09437a784d2b510a47ae15d6}{PACKET\_ID\_PADDING}, padding\_length);
786     memcpy(packet + (\textcolor{keyword}{sizeof}(uint32\_t) * 2) + padding\_length, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}, length);
787 
788     \textcolor{keywordflow}{return} \hyperlink{net__crypto_8c_a507dd998c297ff5a666bd08121dd4143}{send\_data\_packet}(c, crypt\_connection\_id, packet, \textcolor{keyword}{sizeof}(packet));
789 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a572e703b36ffafdc4cf9dafd31a279d7_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a572e703b36ffafdc4cf9dafd31a279d7_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_aef6ea83ebc4f62428b09ee74441f6f4b}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!send\+\_\+kill\+\_\+packet@{send\+\_\+kill\+\_\+packet}}
\index{send\+\_\+kill\+\_\+packet@{send\+\_\+kill\+\_\+packet}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{send\+\_\+kill\+\_\+packet}]{\setlength{\rightskip}{0pt plus 5cm}static int send\+\_\+kill\+\_\+packet (
\begin{DoxyParamCaption}
\item[{{\bf Net\+\_\+\+Crypto} $\ast$}]{c, }
\item[{int}]{crypt\+\_\+connection\+\_\+id}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{net__crypto_8c_aef6ea83ebc4f62428b09ee74441f6f4b}


Definition at line 1107 of file net\+\_\+crypto.\+c.



References Packets\+\_\+\+Array\+::buffer\+\_\+end, Packets\+\_\+\+Array\+::buffer\+\_\+start, get\+\_\+crypto\+\_\+connection(), P\+A\+C\+K\+E\+T\+\_\+\+I\+D\+\_\+\+K\+I\+L\+L, Crypto\+\_\+\+Connection\+::recv\+\_\+array, Crypto\+\_\+\+Connection\+::send\+\_\+array, and send\+\_\+data\+\_\+packet\+\_\+helper().



Referenced by crypto\+\_\+kill().


\begin{DoxyCode}
1108 \{
1109     \hyperlink{struct_crypto___connection}{Crypto\_Connection} *conn = \hyperlink{net__crypto_8c_a909daa4b6d420cbd028f2c956a8642db}{get\_crypto\_connection}(c, 
      crypt\_connection\_id);
1110 
1111     \textcolor{keywordflow}{if} (conn == 0)
1112         \textcolor{keywordflow}{return} -1;
1113 
1114     uint8\_t kill\_packet = \hyperlink{net__crypto_8h_ac3fca17f739e473ffb4f16ec9b2f4cde}{PACKET\_ID\_KILL};
1115     \textcolor{keywordflow}{return} \hyperlink{net__crypto_8c_a572e703b36ffafdc4cf9dafd31a279d7}{send\_data\_packet\_helper}(c, crypt\_connection\_id, conn->
      \hyperlink{struct_crypto___connection_a1a62bc0c4bb9e349735c65f9948020d5}{recv\_array}.\hyperlink{struct_packets___array_a85973b335814248c05f63543876b348e}{buffer\_start}, conn->\hyperlink{struct_crypto___connection_aa9112ee7e76eb3e870491f7c5c272197}{send\_array}.
      \hyperlink{struct_packets___array_a66d710e0093872b26ee80118c1a85d99}{buffer\_end},
1116                                    &kill\_packet, \textcolor{keyword}{sizeof}(kill\_packet));
1117 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_aef6ea83ebc4f62428b09ee74441f6f4b_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_aef6ea83ebc4f62428b09ee74441f6f4b_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_a06c8bdc27b9865d1b7d775b654f44d1a}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!send\+\_\+lossless\+\_\+packet@{send\+\_\+lossless\+\_\+packet}}
\index{send\+\_\+lossless\+\_\+packet@{send\+\_\+lossless\+\_\+packet}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{send\+\_\+lossless\+\_\+packet}]{\setlength{\rightskip}{0pt plus 5cm}static int64\+\_\+t send\+\_\+lossless\+\_\+packet (
\begin{DoxyParamCaption}
\item[{{\bf Net\+\_\+\+Crypto} $\ast$}]{c, }
\item[{int}]{crypt\+\_\+connection\+\_\+id, }
\item[{const uint8\+\_\+t $\ast$}]{data, }
\item[{uint16\+\_\+t}]{length, }
\item[{uint8\+\_\+t}]{congestion\+\_\+control}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{net__crypto_8c_a06c8bdc27b9865d1b7d775b654f44d1a}


Definition at line 831 of file net\+\_\+crypto.\+c.



References add\+\_\+data\+\_\+end\+\_\+of\+\_\+buffer(), Packets\+\_\+\+Array\+::buffer\+\_\+start, current\+\_\+time\+\_\+monotonic(), Packet\+\_\+\+Data\+::data, get\+\_\+crypto\+\_\+connection(), get\+\_\+data\+\_\+pointer(), Packet\+\_\+\+Data\+::length, L\+O\+G\+G\+E\+R\+\_\+\+E\+R\+R\+O\+R, M\+A\+X\+\_\+\+C\+R\+Y\+P\+T\+O\+\_\+\+D\+A\+T\+A\+\_\+\+S\+I\+Z\+E, Crypto\+\_\+\+Connection\+::maximum\+\_\+speed\+\_\+reached, Crypto\+\_\+\+Connection\+::mutex, Crypto\+\_\+\+Connection\+::recv\+\_\+array, reset\+\_\+max\+\_\+speed\+\_\+reached(), Crypto\+\_\+\+Connection\+::send\+\_\+array, send\+\_\+data\+\_\+packet\+\_\+helper(), and Packet\+\_\+\+Data\+::sent\+\_\+time.



Referenced by write\+\_\+cryptpacket().


\begin{DoxyCode}
833 \{
834     \textcolor{keywordflow}{if} (length == 0 || length > \hyperlink{net__crypto_8h_a1b6e5122f9fdc5ef548ccf920f0c246e}{MAX\_CRYPTO\_DATA\_SIZE})
835         \textcolor{keywordflow}{return} -1;
836 
837     \hyperlink{struct_crypto___connection}{Crypto\_Connection} *conn = \hyperlink{net__crypto_8c_a909daa4b6d420cbd028f2c956a8642db}{get\_crypto\_connection}(c, 
      crypt\_connection\_id);
838 
839     \textcolor{keywordflow}{if} (conn == 0)
840         \textcolor{keywordflow}{return} -1;
841 
842     \textcolor{comment}{/* If last packet send failed, try to send packet again.}
843 \textcolor{comment}{       If sending it fails we won't be able to send the new packet. */}
844     \hyperlink{net__crypto_8c_abb8a6ea2bdfb75eb366cc0a026649e2c}{reset\_max\_speed\_reached}(c, crypt\_connection\_id);
845 
846     \textcolor{keywordflow}{if} (conn->\hyperlink{struct_crypto___connection_a8aa9d51e0fa27ad34f8046486d519275}{maximum\_speed\_reached} && congestion\_control) \{
847         \textcolor{keywordflow}{return} -1;
848     \}
849 
850     \hyperlink{struct_packet___data}{Packet\_Data} dt;
851     dt.\hyperlink{struct_packet___data_ae6e5e2c139451ff48ec8dbba5d21bb50}{sent\_time} = 0;
852     dt.\hyperlink{struct_packet___data_a1892eba2086d12ac2b09005aeb09ea3b}{length} = length;
853     memcpy(dt.\hyperlink{struct_packet___data_ab895a6b34c217017925a6aea69c78c09}{data}, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}, length);
854     pthread\_mutex\_lock(&conn->\hyperlink{struct_crypto___connection_a4acff8232e4aec9cd5c6dc200ac55ef3}{mutex});
855     int64\_t packet\_num = \hyperlink{net__crypto_8c_af55d3f30f6b07366883f01a8fa09d866}{add\_data\_end\_of\_buffer}(&conn->
      \hyperlink{struct_crypto___connection_aa9112ee7e76eb3e870491f7c5c272197}{send\_array}, &dt);
856     pthread\_mutex\_unlock(&conn->\hyperlink{struct_crypto___connection_a4acff8232e4aec9cd5c6dc200ac55ef3}{mutex});
857 
858     \textcolor{keywordflow}{if} (packet\_num == -1)
859         \textcolor{keywordflow}{return} -1;
860 
861     \textcolor{keywordflow}{if} (!congestion\_control && conn->\hyperlink{struct_crypto___connection_a8aa9d51e0fa27ad34f8046486d519275}{maximum\_speed\_reached}) \{
862         \textcolor{keywordflow}{return} packet\_num;
863     \}
864 
865     \textcolor{keywordflow}{if} (\hyperlink{net__crypto_8c_a572e703b36ffafdc4cf9dafd31a279d7}{send\_data\_packet\_helper}(c, crypt\_connection\_id, conn->
      \hyperlink{struct_crypto___connection_a1a62bc0c4bb9e349735c65f9948020d5}{recv\_array}.\hyperlink{struct_packets___array_a85973b335814248c05f63543876b348e}{buffer\_start}, packet\_num, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}, length) == 0) \{
866         \hyperlink{struct_packet___data}{Packet\_Data} *dt1 = NULL;
867 
868         \textcolor{keywordflow}{if} (\hyperlink{net__crypto_8c_a1e36bfc22078fc52c29d90e8ab79295d}{get\_data\_pointer}(&conn->\hyperlink{struct_crypto___connection_aa9112ee7e76eb3e870491f7c5c272197}{send\_array}, &dt1, packet\_num) == 1)
869             dt1->\hyperlink{struct_packet___data_ae6e5e2c139451ff48ec8dbba5d21bb50}{sent\_time} = \hyperlink{irc__syncbot_8c_ae8ecaef140b786a2720eadbb85918e81}{current\_time\_monotonic}();
870     \} \textcolor{keywordflow}{else} \{
871         conn->\hyperlink{struct_crypto___connection_a8aa9d51e0fa27ad34f8046486d519275}{maximum\_speed\_reached} = 1;
872         \hyperlink{logger_8h_aedad6a1e3ffe0d4cd0992b822ec0eeeb}{LOGGER\_ERROR}(\textcolor{stringliteral}{"send\_data\_packet failed\(\backslash\)n"});
873     \}
874 
875     \textcolor{keywordflow}{return} packet\_num;
876 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a06c8bdc27b9865d1b7d775b654f44d1a_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a06c8bdc27b9865d1b7d775b654f44d1a_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_a7fcdf763c4a1b4b71e0de620b12f074c}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!send\+\_\+lossy\+\_\+cryptpacket@{send\+\_\+lossy\+\_\+cryptpacket}}
\index{send\+\_\+lossy\+\_\+cryptpacket@{send\+\_\+lossy\+\_\+cryptpacket}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{send\+\_\+lossy\+\_\+cryptpacket}]{\setlength{\rightskip}{0pt plus 5cm}int send\+\_\+lossy\+\_\+cryptpacket (
\begin{DoxyParamCaption}
\item[{{\bf Net\+\_\+\+Crypto} $\ast$}]{c, }
\item[{int}]{crypt\+\_\+connection\+\_\+id, }
\item[{const uint8\+\_\+t $\ast$}]{data, }
\item[{uint16\+\_\+t}]{length}
\end{DoxyParamCaption}
)}}\label{net__crypto_8c_a7fcdf763c4a1b4b71e0de620b12f074c}


Definition at line 2284 of file net\+\_\+crypto.\+c.



References Packets\+\_\+\+Array\+::buffer\+\_\+end, Packets\+\_\+\+Array\+::buffer\+\_\+start, Net\+\_\+\+Crypto\+::connection\+\_\+use\+\_\+counter, Net\+\_\+\+Crypto\+::connections\+\_\+mutex, get\+\_\+crypto\+\_\+connection(), M\+A\+X\+\_\+\+C\+R\+Y\+P\+T\+O\+\_\+\+D\+A\+T\+A\+\_\+\+S\+I\+Z\+E, Crypto\+\_\+\+Connection\+::mutex, P\+A\+C\+K\+E\+T\+\_\+\+I\+D\+\_\+\+L\+O\+S\+S\+Y\+\_\+\+R\+A\+N\+G\+E\+\_\+\+S\+I\+Z\+E, P\+A\+C\+K\+E\+T\+\_\+\+I\+D\+\_\+\+L\+O\+S\+S\+Y\+\_\+\+R\+A\+N\+G\+E\+\_\+\+S\+T\+A\+R\+T, Crypto\+\_\+\+Connection\+::recv\+\_\+array, Crypto\+\_\+\+Connection\+::send\+\_\+array, and send\+\_\+data\+\_\+packet\+\_\+helper().



Referenced by send\+\_\+custom\+\_\+lossy\+\_\+packet(), and send\+\_\+lossy\+\_\+group\+\_\+peer().


\begin{DoxyCode}
2285 \{
2286     \textcolor{keywordflow}{if} (length == 0 || length > \hyperlink{net__crypto_8h_a1b6e5122f9fdc5ef548ccf920f0c246e}{MAX\_CRYPTO\_DATA\_SIZE})
2287         \textcolor{keywordflow}{return} -1;
2288 
2289     \textcolor{keywordflow}{if} (\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[0] < \hyperlink{net__crypto_8h_a02481d2cc931289c2d5ee21d2a633316}{PACKET\_ID\_LOSSY\_RANGE\_START})
2290         \textcolor{keywordflow}{return} -1;
2291 
2292     \textcolor{keywordflow}{if} (\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[0] >= (\hyperlink{net__crypto_8h_a02481d2cc931289c2d5ee21d2a633316}{PACKET\_ID\_LOSSY\_RANGE\_START} + 
      \hyperlink{net__crypto_8h_a97668dde651012b4dffe599cd0df333b}{PACKET\_ID\_LOSSY\_RANGE\_SIZE}))
2293         \textcolor{keywordflow}{return} -1;
2294 
2295     pthread\_mutex\_lock(&c->\hyperlink{struct_net___crypto_a213135bf3b5b80b1cfe99b27dc42815e}{connections\_mutex});
2296     ++c->\hyperlink{struct_net___crypto_ab5be057850e1cee67902276a69900326}{connection\_use\_counter};
2297     pthread\_mutex\_unlock(&c->\hyperlink{struct_net___crypto_a213135bf3b5b80b1cfe99b27dc42815e}{connections\_mutex});
2298 
2299     \hyperlink{struct_crypto___connection}{Crypto\_Connection} *conn = \hyperlink{net__crypto_8c_a909daa4b6d420cbd028f2c956a8642db}{get\_crypto\_connection}(c, 
      crypt\_connection\_id);
2300 
2301     \textcolor{keywordtype}{int} ret = -1;
2302 
2303     \textcolor{keywordflow}{if} (conn) \{
2304         pthread\_mutex\_lock(&conn->\hyperlink{struct_crypto___connection_a4acff8232e4aec9cd5c6dc200ac55ef3}{mutex});
2305         uint32\_t buffer\_start = conn->\hyperlink{struct_crypto___connection_a1a62bc0c4bb9e349735c65f9948020d5}{recv\_array}.\hyperlink{struct_packets___array_a85973b335814248c05f63543876b348e}{buffer\_start};
2306         uint32\_t buffer\_end = conn->\hyperlink{struct_crypto___connection_aa9112ee7e76eb3e870491f7c5c272197}{send\_array}.\hyperlink{struct_packets___array_a66d710e0093872b26ee80118c1a85d99}{buffer\_end};
2307         pthread\_mutex\_unlock(&conn->\hyperlink{struct_crypto___connection_a4acff8232e4aec9cd5c6dc200ac55ef3}{mutex});
2308         ret = \hyperlink{net__crypto_8c_a572e703b36ffafdc4cf9dafd31a279d7}{send\_data\_packet\_helper}(c, crypt\_connection\_id, buffer\_start, 
      buffer\_end, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}, length);
2309     \}
2310 
2311     pthread\_mutex\_lock(&c->\hyperlink{struct_net___crypto_a213135bf3b5b80b1cfe99b27dc42815e}{connections\_mutex});
2312     --c->\hyperlink{struct_net___crypto_ab5be057850e1cee67902276a69900326}{connection\_use\_counter};
2313     pthread\_mutex\_unlock(&c->\hyperlink{struct_net___crypto_a213135bf3b5b80b1cfe99b27dc42815e}{connections\_mutex});
2314 
2315     \textcolor{keywordflow}{return} ret;
2316 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a7fcdf763c4a1b4b71e0de620b12f074c_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a7fcdf763c4a1b4b71e0de620b12f074c_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_a94d4c99b16cb7bd2dd61f9a7a8caf94a}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!send\+\_\+packet\+\_\+to@{send\+\_\+packet\+\_\+to}}
\index{send\+\_\+packet\+\_\+to@{send\+\_\+packet\+\_\+to}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{send\+\_\+packet\+\_\+to}]{\setlength{\rightskip}{0pt plus 5cm}static int send\+\_\+packet\+\_\+to (
\begin{DoxyParamCaption}
\item[{{\bf Net\+\_\+\+Crypto} $\ast$}]{c, }
\item[{int}]{crypt\+\_\+connection\+\_\+id, }
\item[{const uint8\+\_\+t $\ast$}]{data, }
\item[{uint16\+\_\+t}]{length}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{net__crypto_8c_a94d4c99b16cb7bd2dd61f9a7a8caf94a}


Definition at line 392 of file net\+\_\+crypto.\+c.



References Crypto\+\_\+\+Connection\+::connection\+\_\+number\+\_\+tcp, crypto\+\_\+connection\+\_\+status(), Net\+\_\+\+Crypto\+::dht, I\+P\+::family, get\+\_\+crypto\+\_\+connection(), I\+P\+\_\+\+Port\+::ip, Crypto\+\_\+\+Connection\+::ip\+\_\+port, Crypto\+\_\+\+Connection\+::mutex, D\+H\+T\+::net, N\+E\+T\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+C\+O\+O\+K\+I\+E\+\_\+\+R\+E\+Q\+U\+E\+S\+T, N\+E\+T\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+C\+R\+Y\+P\+T\+O\+\_\+\+H\+S, send\+\_\+packet\+\_\+tcp\+\_\+connection(), sendpacket(), Net\+\_\+\+Crypto\+::tcp\+\_\+c, and Net\+\_\+\+Crypto\+::tcp\+\_\+mutex.



Referenced by send\+\_\+data\+\_\+packet(), and send\+\_\+temp\+\_\+packet().


\begin{DoxyCode}
393 \{
394 \textcolor{comment}{//TODO TCP, etc...}
395     \hyperlink{struct_crypto___connection}{Crypto\_Connection} *conn = \hyperlink{net__crypto_8c_a909daa4b6d420cbd028f2c956a8642db}{get\_crypto\_connection}(c, 
      crypt\_connection\_id);
396 
397     \textcolor{keywordflow}{if} (conn == 0)
398         \textcolor{keywordflow}{return} -1;
399 
400     \textcolor{keywordtype}{int} direct\_send\_attempt = 0;
401 
402     pthread\_mutex\_lock(&conn->\hyperlink{struct_crypto___connection_a4acff8232e4aec9cd5c6dc200ac55ef3}{mutex});
403 
404     \textcolor{comment}{//TODO: on bad networks, direct connections might not last indefinitely.}
405     \textcolor{keywordflow}{if} (conn->\hyperlink{struct_crypto___connection_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} != 0) \{
406         \_Bool direct\_connected = 0;
407         \hyperlink{net__crypto_8c_afb5c59e6df7f38fe0bdf9e0f6c459869}{crypto\_connection\_status}(c, crypt\_connection\_id, &direct\_connected, NULL);
408 
409         \textcolor{keywordflow}{if} (direct\_connected) \{
410             \textcolor{keywordflow}{if} ((uint32\_t)\hyperlink{network_8c_a7b90f87f3ba60cc5c66dd6dd77cd5cb1}{sendpacket}(c->\hyperlink{struct_net___crypto_a8b3d6ce8745acc52695e252bdb1531b6}{dht}->\hyperlink{struct_d_h_t_aa14ea2f67950f57fe4235d7375a2216c}{net}, conn->\hyperlink{struct_crypto___connection_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}, 
      \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}, length) == length) \{
411                 pthread\_mutex\_unlock(&conn->\hyperlink{struct_crypto___connection_a4acff8232e4aec9cd5c6dc200ac55ef3}{mutex});
412                 \textcolor{keywordflow}{return} 0;
413             \} \textcolor{keywordflow}{else} \{
414                 pthread\_mutex\_unlock(&conn->\hyperlink{struct_crypto___connection_a4acff8232e4aec9cd5c6dc200ac55ef3}{mutex});
415                 \textcolor{keywordflow}{return} -1;
416             \}
417         \}
418 
419         \textcolor{comment}{//TODO: a better way of sending packets directly to confirm the others ip.}
420         \textcolor{keywordflow}{if} (length < 96 || \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[0] == \hyperlink{network_8h_a3ad6d83af0ed67a84b327df50d66229c}{NET\_PACKET\_COOKIE\_REQUEST} || 
      \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[0] == \hyperlink{network_8h_ae4ba32f7f36e935bd3a56b5e90299857}{NET\_PACKET\_CRYPTO\_HS}) \{
421             \textcolor{keywordflow}{if} ((uint32\_t)\hyperlink{network_8c_a7b90f87f3ba60cc5c66dd6dd77cd5cb1}{sendpacket}(c->\hyperlink{struct_net___crypto_a8b3d6ce8745acc52695e252bdb1531b6}{dht}->\hyperlink{struct_d_h_t_aa14ea2f67950f57fe4235d7375a2216c}{net}, conn->\hyperlink{struct_crypto___connection_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}, 
      \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}, length) == length)
422                 direct\_send\_attempt = 1;
423         \}
424     \}
425 
426     pthread\_mutex\_unlock(&conn->\hyperlink{struct_crypto___connection_a4acff8232e4aec9cd5c6dc200ac55ef3}{mutex});
427     pthread\_mutex\_lock(&c->\hyperlink{struct_net___crypto_a2e8f7f4dff2f2fc4ac2cc32b0c886974}{tcp\_mutex});
428     \textcolor{keywordtype}{int} ret = \hyperlink{_t_c_p__connection_8c_a455e955e01d34ff3db0b22b8f6d49d98}{send\_packet\_tcp\_connection}(c->\hyperlink{struct_net___crypto_a179982a02be89eaf6617ed81bd3c0961}{tcp\_c}, conn->
      \hyperlink{struct_crypto___connection_a51666aaba0fc5680040fe5bd6778bc50}{connection\_number\_tcp}, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}, length);
429     pthread\_mutex\_unlock(&c->\hyperlink{struct_net___crypto_a2e8f7f4dff2f2fc4ac2cc32b0c886974}{tcp\_mutex});
430 
431     \textcolor{keywordflow}{if} (ret == 0 || direct\_send\_attempt) \{
432         \textcolor{keywordflow}{return} 0;
433     \}
434 
435     \textcolor{keywordflow}{return} -1;
436 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a94d4c99b16cb7bd2dd61f9a7a8caf94a_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a94d4c99b16cb7bd2dd61f9a7a8caf94a_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_a31370353b1f1c90c8fb06ae736be1a0d}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!send\+\_\+request\+\_\+packet@{send\+\_\+request\+\_\+packet}}
\index{send\+\_\+request\+\_\+packet@{send\+\_\+request\+\_\+packet}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{send\+\_\+request\+\_\+packet}]{\setlength{\rightskip}{0pt plus 5cm}static int send\+\_\+request\+\_\+packet (
\begin{DoxyParamCaption}
\item[{{\bf Net\+\_\+\+Crypto} $\ast$}]{c, }
\item[{int}]{crypt\+\_\+connection\+\_\+id}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{net__crypto_8c_a31370353b1f1c90c8fb06ae736be1a0d}


Definition at line 934 of file net\+\_\+crypto.\+c.



References Packets\+\_\+\+Array\+::buffer\+\_\+end, Packets\+\_\+\+Array\+::buffer\+\_\+start, make-\/funny-\/savefile\+::data, generate\+\_\+request\+\_\+packet(), get\+\_\+crypto\+\_\+connection(), M\+A\+X\+\_\+\+C\+R\+Y\+P\+T\+O\+\_\+\+D\+A\+T\+A\+\_\+\+S\+I\+Z\+E, Crypto\+\_\+\+Connection\+::recv\+\_\+array, Crypto\+\_\+\+Connection\+::send\+\_\+array, and send\+\_\+data\+\_\+packet\+\_\+helper().



Referenced by send\+\_\+crypto\+\_\+packets().


\begin{DoxyCode}
935 \{
936     \hyperlink{struct_crypto___connection}{Crypto\_Connection} *conn = \hyperlink{net__crypto_8c_a909daa4b6d420cbd028f2c956a8642db}{get\_crypto\_connection}(c, 
      crypt\_connection\_id);
937 
938     \textcolor{keywordflow}{if} (conn == 0)
939         \textcolor{keywordflow}{return} -1;
940 
941     uint8\_t \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[\hyperlink{net__crypto_8h_a1b6e5122f9fdc5ef548ccf920f0c246e}{MAX\_CRYPTO\_DATA\_SIZE}];
942     \textcolor{keywordtype}{int} len = \hyperlink{net__crypto_8c_ae4bed66c607b0d067e9b83dbf718d1f7}{generate\_request\_packet}(data, \textcolor{keyword}{sizeof}(data), &conn->
      \hyperlink{struct_crypto___connection_a1a62bc0c4bb9e349735c65f9948020d5}{recv\_array});
943 
944     \textcolor{keywordflow}{if} (len == -1)
945         \textcolor{keywordflow}{return} -1;
946 
947     \textcolor{keywordflow}{return} \hyperlink{net__crypto_8c_a572e703b36ffafdc4cf9dafd31a279d7}{send\_data\_packet\_helper}(c, crypt\_connection\_id, conn->
      \hyperlink{struct_crypto___connection_a1a62bc0c4bb9e349735c65f9948020d5}{recv\_array}.\hyperlink{struct_packets___array_a85973b335814248c05f63543876b348e}{buffer\_start}, conn->\hyperlink{struct_crypto___connection_aa9112ee7e76eb3e870491f7c5c272197}{send\_array}.
      \hyperlink{struct_packets___array_a66d710e0093872b26ee80118c1a85d99}{buffer\_end}, data,
948                                    len);
949 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a31370353b1f1c90c8fb06ae736be1a0d_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a31370353b1f1c90c8fb06ae736be1a0d_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_ac64daefe87866ea116735f3540be3092}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!send\+\_\+requested\+\_\+packets@{send\+\_\+requested\+\_\+packets}}
\index{send\+\_\+requested\+\_\+packets@{send\+\_\+requested\+\_\+packets}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{send\+\_\+requested\+\_\+packets}]{\setlength{\rightskip}{0pt plus 5cm}static int send\+\_\+requested\+\_\+packets (
\begin{DoxyParamCaption}
\item[{{\bf Net\+\_\+\+Crypto} $\ast$}]{c, }
\item[{int}]{crypt\+\_\+connection\+\_\+id, }
\item[{uint32\+\_\+t}]{max\+\_\+num}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{net__crypto_8c_ac64daefe87866ea116735f3540be3092}


Definition at line 956 of file net\+\_\+crypto.\+c.



References Packets\+\_\+\+Array\+::buffer\+\_\+start, current\+\_\+time\+\_\+monotonic(), Packet\+\_\+\+Data\+::data, get\+\_\+crypto\+\_\+connection(), get\+\_\+data\+\_\+pointer(), i, Packet\+\_\+\+Data\+::length, num\+\_\+packets\+\_\+array(), Crypto\+\_\+\+Connection\+::recv\+\_\+array, Crypto\+\_\+\+Connection\+::send\+\_\+array, send\+\_\+data\+\_\+packet\+\_\+helper(), and Packet\+\_\+\+Data\+::sent\+\_\+time.



Referenced by send\+\_\+crypto\+\_\+packets().


\begin{DoxyCode}
957 \{
958     \textcolor{keywordflow}{if} (max\_num == 0)
959         \textcolor{keywordflow}{return} -1;
960 
961     \hyperlink{struct_crypto___connection}{Crypto\_Connection} *conn = \hyperlink{net__crypto_8c_a909daa4b6d420cbd028f2c956a8642db}{get\_crypto\_connection}(c, 
      crypt\_connection\_id);
962 
963     \textcolor{keywordflow}{if} (conn == 0)
964         \textcolor{keywordflow}{return} -1;
965 
966     uint64\_t temp\_time = \hyperlink{irc__syncbot_8c_ae8ecaef140b786a2720eadbb85918e81}{current\_time\_monotonic}();
967     uint32\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}, num\_sent = 0, array\_size = \hyperlink{net__crypto_8c_abbe1101e6464100c19aea7cde5c1d3a0}{num\_packets\_array}(&conn->
      \hyperlink{struct_crypto___connection_aa9112ee7e76eb3e870491f7c5c272197}{send\_array});
968 
969     \textcolor{keywordflow}{for} (i = 0; i < array\_size; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
970         \hyperlink{struct_packet___data}{Packet\_Data} *dt;
971         uint32\_t packet\_num = (i + conn->\hyperlink{struct_crypto___connection_aa9112ee7e76eb3e870491f7c5c272197}{send\_array}.\hyperlink{struct_packets___array_a85973b335814248c05f63543876b348e}{buffer\_start});
972         \textcolor{keywordtype}{int} ret = \hyperlink{net__crypto_8c_a1e36bfc22078fc52c29d90e8ab79295d}{get\_data\_pointer}(&conn->\hyperlink{struct_crypto___connection_aa9112ee7e76eb3e870491f7c5c272197}{send\_array}, &dt, packet\_num);
973 
974         \textcolor{keywordflow}{if} (ret == -1) \{
975             \textcolor{keywordflow}{return} -1;
976         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (ret == 0) \{
977             \textcolor{keywordflow}{continue};
978         \}
979 
980         \textcolor{keywordflow}{if} (dt->\hyperlink{struct_packet___data_ae6e5e2c139451ff48ec8dbba5d21bb50}{sent\_time}) \{
981             \textcolor{keywordflow}{continue};
982         \}
983 
984         \textcolor{keywordflow}{if} (\hyperlink{net__crypto_8c_a572e703b36ffafdc4cf9dafd31a279d7}{send\_data\_packet\_helper}(c, crypt\_connection\_id, conn->
      \hyperlink{struct_crypto___connection_a1a62bc0c4bb9e349735c65f9948020d5}{recv\_array}.\hyperlink{struct_packets___array_a85973b335814248c05f63543876b348e}{buffer\_start}, packet\_num, dt->\hyperlink{struct_packet___data_ab895a6b34c217017925a6aea69c78c09}{data},
985                                     dt->\hyperlink{struct_packet___data_a1892eba2086d12ac2b09005aeb09ea3b}{length}) == 0) \{
986             dt->\hyperlink{struct_packet___data_ae6e5e2c139451ff48ec8dbba5d21bb50}{sent\_time} = temp\_time;
987             ++num\_sent;
988         \}
989 
990         \textcolor{keywordflow}{if} (num\_sent >= max\_num)
991             \textcolor{keywordflow}{break};
992     \}
993 
994     \textcolor{keywordflow}{return} num\_sent;
995 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_ac64daefe87866ea116735f3540be3092_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_ac64daefe87866ea116735f3540be3092_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_ae25dcb51c019c3c59fd07da846bbe0df}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!send\+\_\+tcp\+\_\+onion\+\_\+request@{send\+\_\+tcp\+\_\+onion\+\_\+request}}
\index{send\+\_\+tcp\+\_\+onion\+\_\+request@{send\+\_\+tcp\+\_\+onion\+\_\+request}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{send\+\_\+tcp\+\_\+onion\+\_\+request}]{\setlength{\rightskip}{0pt plus 5cm}int send\+\_\+tcp\+\_\+onion\+\_\+request (
\begin{DoxyParamCaption}
\item[{{\bf Net\+\_\+\+Crypto} $\ast$}]{c, }
\item[{unsigned int}]{tcp\+\_\+connections\+\_\+number, }
\item[{const uint8\+\_\+t $\ast$}]{data, }
\item[{uint16\+\_\+t}]{length}
\end{DoxyParamCaption}
)}}\label{net__crypto_8c_ae25dcb51c019c3c59fd07da846bbe0df}


Definition at line 1824 of file net\+\_\+crypto.\+c.



References Net\+\_\+\+Crypto\+::tcp\+\_\+c, Net\+\_\+\+Crypto\+::tcp\+\_\+mutex, and tcp\+\_\+send\+\_\+onion\+\_\+request().



Referenced by send\+\_\+onion\+\_\+packet\+\_\+tcp\+\_\+udp().


\begin{DoxyCode}
1825 \{
1826     pthread\_mutex\_lock(&c->\hyperlink{struct_net___crypto_a2e8f7f4dff2f2fc4ac2cc32b0c886974}{tcp\_mutex});
1827     \textcolor{keywordtype}{int} ret = \hyperlink{_t_c_p__connection_8c_afb1a507e5f1af925b01666f1b9b4960a}{tcp\_send\_onion\_request}(c->\hyperlink{struct_net___crypto_a179982a02be89eaf6617ed81bd3c0961}{tcp\_c}, tcp\_connections\_number, 
      \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}, length);
1828     pthread\_mutex\_unlock(&c->\hyperlink{struct_net___crypto_a2e8f7f4dff2f2fc4ac2cc32b0c886974}{tcp\_mutex});
1829 
1830     \textcolor{keywordflow}{return} ret;
1831 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_ae25dcb51c019c3c59fd07da846bbe0df_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_ae25dcb51c019c3c59fd07da846bbe0df_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_ae0a00f5fe1955d7d15af11eacc20997b}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!send\+\_\+temp\+\_\+packet@{send\+\_\+temp\+\_\+packet}}
\index{send\+\_\+temp\+\_\+packet@{send\+\_\+temp\+\_\+packet}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{send\+\_\+temp\+\_\+packet}]{\setlength{\rightskip}{0pt plus 5cm}static int send\+\_\+temp\+\_\+packet (
\begin{DoxyParamCaption}
\item[{{\bf Net\+\_\+\+Crypto} $\ast$}]{c, }
\item[{int}]{crypt\+\_\+connection\+\_\+id}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{net__crypto_8c_ae0a00f5fe1955d7d15af11eacc20997b}


Definition at line 1057 of file net\+\_\+crypto.\+c.



References current\+\_\+time\+\_\+monotonic(), get\+\_\+crypto\+\_\+connection(), send\+\_\+packet\+\_\+to(), Crypto\+\_\+\+Connection\+::temp\+\_\+packet, Crypto\+\_\+\+Connection\+::temp\+\_\+packet\+\_\+length, Crypto\+\_\+\+Connection\+::temp\+\_\+packet\+\_\+num\+\_\+sent, and Crypto\+\_\+\+Connection\+::temp\+\_\+packet\+\_\+sent\+\_\+time.



Referenced by create\+\_\+send\+\_\+handshake(), and send\+\_\+crypto\+\_\+packets().


\begin{DoxyCode}
1058 \{
1059     \hyperlink{struct_crypto___connection}{Crypto\_Connection} *conn = \hyperlink{net__crypto_8c_a909daa4b6d420cbd028f2c956a8642db}{get\_crypto\_connection}(c, 
      crypt\_connection\_id);
1060 
1061     \textcolor{keywordflow}{if} (conn == 0)
1062         \textcolor{keywordflow}{return} -1;
1063 
1064     \textcolor{keywordflow}{if} (!conn->\hyperlink{struct_crypto___connection_a360adb14f743065d5c69fe29a00a06a7}{temp\_packet})
1065         \textcolor{keywordflow}{return} -1;
1066 
1067     \textcolor{keywordflow}{if} (\hyperlink{net__crypto_8c_a94d4c99b16cb7bd2dd61f9a7a8caf94a}{send\_packet\_to}(c, crypt\_connection\_id, conn->\hyperlink{struct_crypto___connection_a360adb14f743065d5c69fe29a00a06a7}{temp\_packet}, conn->
      \hyperlink{struct_crypto___connection_a4ef842580c6c073f36578d0e07551cc4}{temp\_packet\_length}) != 0)
1068         \textcolor{keywordflow}{return} -1;
1069 
1070     conn->\hyperlink{struct_crypto___connection_abb5fdaef769d667f90bc97bd72d765d6}{temp\_packet\_sent\_time} = \hyperlink{irc__syncbot_8c_ae8ecaef140b786a2720eadbb85918e81}{current\_time\_monotonic}();
1071     ++conn->\hyperlink{struct_crypto___connection_a7386b7ad7bedb9dd47d898f588b4f463}{temp\_packet\_num\_sent};
1072     \textcolor{keywordflow}{return} 0;
1073 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_ae0a00f5fe1955d7d15af11eacc20997b_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_ae0a00f5fe1955d7d15af11eacc20997b_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_a065063595d40809cb6c5c2ccc09fdd74}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!set\+\_\+buffer\+\_\+end@{set\+\_\+buffer\+\_\+end}}
\index{set\+\_\+buffer\+\_\+end@{set\+\_\+buffer\+\_\+end}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{set\+\_\+buffer\+\_\+end}]{\setlength{\rightskip}{0pt plus 5cm}static int set\+\_\+buffer\+\_\+end (
\begin{DoxyParamCaption}
\item[{{\bf Packets\+\_\+\+Array} $\ast$}]{array, }
\item[{uint32\+\_\+t}]{number}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{net__crypto_8c_a065063595d40809cb6c5c2ccc09fdd74}


Definition at line 594 of file net\+\_\+crypto.\+c.



References Packets\+\_\+\+Array\+::buffer\+\_\+end, Packets\+\_\+\+Array\+::buffer\+\_\+start, and C\+R\+Y\+P\+T\+O\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+B\+U\+F\+F\+E\+R\+\_\+\+S\+I\+Z\+E.



Referenced by handle\+\_\+data\+\_\+packet\+\_\+helper().


\begin{DoxyCode}
595 \{
596     \textcolor{keywordflow}{if} ((number - array->\hyperlink{struct_packets___array_a85973b335814248c05f63543876b348e}{buffer\_start}) > \hyperlink{net__crypto_8h_ac73cf1eb0a938f0962ddc607945636f4}{CRYPTO\_PACKET\_BUFFER\_SIZE})
597         \textcolor{keywordflow}{return} -1;
598 
599     \textcolor{keywordflow}{if} ((number - array->\hyperlink{struct_packets___array_a66d710e0093872b26ee80118c1a85d99}{buffer\_end}) > \hyperlink{net__crypto_8h_ac73cf1eb0a938f0962ddc607945636f4}{CRYPTO\_PACKET\_BUFFER\_SIZE})
600         \textcolor{keywordflow}{return} -1;
601 
602     array->\hyperlink{struct_packets___array_a66d710e0093872b26ee80118c1a85d99}{buffer\_end} = number;
603     \textcolor{keywordflow}{return} 0;
604 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a065063595d40809cb6c5c2ccc09fdd74_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_a8ced4e168a95db5708bf4b3095cb4df6}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!set\+\_\+direct\+\_\+ip\+\_\+port@{set\+\_\+direct\+\_\+ip\+\_\+port}}
\index{set\+\_\+direct\+\_\+ip\+\_\+port@{set\+\_\+direct\+\_\+ip\+\_\+port}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{set\+\_\+direct\+\_\+ip\+\_\+port}]{\setlength{\rightskip}{0pt plus 5cm}int set\+\_\+direct\+\_\+ip\+\_\+port (
\begin{DoxyParamCaption}
\item[{{\bf Net\+\_\+\+Crypto} $\ast$}]{c, }
\item[{int}]{crypt\+\_\+connection\+\_\+id, }
\item[{{\bf I\+P\+\_\+\+Port}}]{ip\+\_\+port, }
\item[{\+\_\+\+Bool}]{connected}
\end{DoxyParamCaption}
)}}\label{net__crypto_8c_a8ced4e168a95db5708bf4b3095cb4df6}


Definition at line 1680 of file net\+\_\+crypto.\+c.



References bs\+\_\+list\+\_\+add(), bs\+\_\+list\+\_\+remove(), Crypto\+\_\+\+Connection\+::direct\+\_\+lastrecv\+\_\+time, I\+P\+::family, get\+\_\+crypto\+\_\+connection(), I\+P\+\_\+\+Port\+::ip, Crypto\+\_\+\+Connection\+::ip\+\_\+port, Net\+\_\+\+Crypto\+::ip\+\_\+port\+\_\+list, ipport\+\_\+equal(), L\+A\+N\+\_\+ip(), U\+D\+P\+\_\+\+D\+I\+R\+E\+C\+T\+\_\+\+T\+I\+M\+E\+O\+U\+T, and unix\+\_\+time().



Referenced by dht\+\_\+ip\+\_\+callback(), do\+\_\+friend\+\_\+connections(), and handle\+\_\+new\+\_\+connections().


\begin{DoxyCode}
1681 \{
1682     \hyperlink{struct_crypto___connection}{Crypto\_Connection} *conn = \hyperlink{net__crypto_8c_a909daa4b6d420cbd028f2c956a8642db}{get\_crypto\_connection}(c, 
      crypt\_connection\_id);
1683 
1684     \textcolor{keywordflow}{if} (conn == 0)
1685         \textcolor{keywordflow}{return} -1;
1686 
1687     \textcolor{keywordflow}{if} (ip\_port.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} != AF\_INET && ip\_port.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} != AF\_INET6)
1688         \textcolor{keywordflow}{return} -1;
1689 
1690     \textcolor{keywordflow}{if} (!\hyperlink{network_8c_a6913335cf0b2a76303f5f61d18ea2277}{ipport\_equal}(&ip\_port, &conn->\hyperlink{struct_crypto___connection_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port})) \{
1691         \textcolor{keywordflow}{if} ((\hyperlink{net__crypto_8h_a0c533e2029f9b1bdb8a368a7308253c0}{UDP\_DIRECT\_TIMEOUT} + conn->\hyperlink{struct_crypto___connection_ac6eb8a274b0dedea83359f2d9269cbc2}{direct\_lastrecv\_time}) > 
      \hyperlink{util_8c_ac958d9f8847cb8039444bfa3d304233a}{unix\_time}()) \{
1692             \textcolor{comment}{/* We already know a LAN ip, no need to switch. */}
1693             \textcolor{keywordflow}{if} (\hyperlink{_l_a_n__discovery_8c_a2d80a53390598eb8ededbc63f4e9c152}{LAN\_ip}(conn->\hyperlink{struct_crypto___connection_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}) == 0)
1694                 \textcolor{keywordflow}{return} -1;
1695 
1696             \textcolor{comment}{/* Prefer ipv6. */}
1697             \textcolor{keywordflow}{if} (conn->\hyperlink{struct_crypto___connection_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} == AF\_INET6 && ip\_port.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.
      \hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} == AF\_INET)
1698                 \textcolor{keywordflow}{return} -1;
1699         \}
1700 
1701         \textcolor{keywordflow}{if} (\hyperlink{list_8c_ace05755dd126bff18700a17d6f8edd28}{bs\_list\_add}(&c->\hyperlink{struct_net___crypto_ae8cfe94df9c9030bbc525010603450ac}{ip\_port\_list}, (uint8\_t *)&ip\_port, crypt\_connection\_id))
       \{
1702             \hyperlink{list_8c_a365995457101cc16f8c6b25ead07fb6f}{bs\_list\_remove}(&c->\hyperlink{struct_net___crypto_ae8cfe94df9c9030bbc525010603450ac}{ip\_port\_list}, (uint8\_t *)&conn->
      \hyperlink{struct_crypto___connection_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}, crypt\_connection\_id);
1703             conn->\hyperlink{struct_crypto___connection_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port} = ip\_port;
1704 
1705             \textcolor{keywordflow}{if} (connected) \{
1706                 conn->\hyperlink{struct_crypto___connection_ac6eb8a274b0dedea83359f2d9269cbc2}{direct\_lastrecv\_time} = \hyperlink{util_8c_ac958d9f8847cb8039444bfa3d304233a}{unix\_time}();
1707             \} \textcolor{keywordflow}{else} \{
1708                 conn->\hyperlink{struct_crypto___connection_ac6eb8a274b0dedea83359f2d9269cbc2}{direct\_lastrecv\_time} = 0;
1709             \}
1710 
1711             \textcolor{keywordflow}{return} 0;
1712         \}
1713     \}
1714 
1715     \textcolor{keywordflow}{return} -1;
1716 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a8ced4e168a95db5708bf4b3095cb4df6_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a8ced4e168a95db5708bf4b3095cb4df6_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_ab2eaad4448a5deca58a00316b522e380}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!tcp\+\_\+data\+\_\+callback@{tcp\+\_\+data\+\_\+callback}}
\index{tcp\+\_\+data\+\_\+callback@{tcp\+\_\+data\+\_\+callback}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{tcp\+\_\+data\+\_\+callback}]{\setlength{\rightskip}{0pt plus 5cm}static int tcp\+\_\+data\+\_\+callback (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{object, }
\item[{int}]{id, }
\item[{const uint8\+\_\+t $\ast$}]{data, }
\item[{uint16\+\_\+t}]{length}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{net__crypto_8c_ab2eaad4448a5deca58a00316b522e380}


Definition at line 1719 of file net\+\_\+crypto.\+c.



References Crypto\+\_\+\+Connection\+::connection\+\_\+number\+\_\+tcp, get\+\_\+crypto\+\_\+connection(), handle\+\_\+packet\+\_\+connection(), M\+A\+X\+\_\+\+C\+R\+Y\+P\+T\+O\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+S\+I\+Z\+E, N\+E\+T\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+C\+O\+O\+K\+I\+E\+\_\+\+R\+E\+Q\+U\+E\+S\+T, tcp\+\_\+handle\+\_\+cookie\+\_\+request(), and Net\+\_\+\+Crypto\+::tcp\+\_\+mutex.



Referenced by new\+\_\+net\+\_\+crypto().


\begin{DoxyCode}
1720 \{
1721     \textcolor{keywordflow}{if} (length == 0 || length > \hyperlink{net__crypto_8h_a4358ff1fe0068c79f791ac88674aea04}{MAX\_CRYPTO\_PACKET\_SIZE})
1722         \textcolor{keywordflow}{return} -1;
1723 
1724     \hyperlink{struct_net___crypto}{Net\_Crypto} *c = object;
1725 
1726     \hyperlink{struct_crypto___connection}{Crypto\_Connection} *conn = \hyperlink{net__crypto_8c_a909daa4b6d420cbd028f2c956a8642db}{get\_crypto\_connection}(c, \textcolor{keywordtype}{id});
1727 
1728     \textcolor{keywordflow}{if} (conn == 0)
1729         \textcolor{keywordflow}{return} -1;
1730 
1731     \textcolor{keywordflow}{if} (\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[0] == \hyperlink{network_8h_a3ad6d83af0ed67a84b327df50d66229c}{NET\_PACKET\_COOKIE\_REQUEST}) \{
1732         \textcolor{keywordflow}{return} \hyperlink{net__crypto_8c_a9308f183e47e29869d5562d03a01f88a}{tcp\_handle\_cookie\_request}(c, conn->
      \hyperlink{struct_crypto___connection_a51666aaba0fc5680040fe5bd6778bc50}{connection\_number\_tcp}, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}, length);
1733     \}
1734 
1735     pthread\_mutex\_unlock(&c->\hyperlink{struct_net___crypto_a2e8f7f4dff2f2fc4ac2cc32b0c886974}{tcp\_mutex});
1736     \textcolor{keywordtype}{int} ret = \hyperlink{net__crypto_8c_a04717fefa34f146623e7c95d5eef8caa}{handle\_packet\_connection}(c, \textcolor{keywordtype}{id}, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}, length);
1737     pthread\_mutex\_lock(&c->\hyperlink{struct_net___crypto_a2e8f7f4dff2f2fc4ac2cc32b0c886974}{tcp\_mutex});
1738 
1739     \textcolor{keywordflow}{if} (ret != 0)
1740         \textcolor{keywordflow}{return} -1;
1741 
1742     \textcolor{comment}{//TODO detect and kill bad TCP connections.}
1743     \textcolor{keywordflow}{return} 0;
1744 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_ab2eaad4448a5deca58a00316b522e380_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_ab2eaad4448a5deca58a00316b522e380_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_a9308f183e47e29869d5562d03a01f88a}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!tcp\+\_\+handle\+\_\+cookie\+\_\+request@{tcp\+\_\+handle\+\_\+cookie\+\_\+request}}
\index{tcp\+\_\+handle\+\_\+cookie\+\_\+request@{tcp\+\_\+handle\+\_\+cookie\+\_\+request}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{tcp\+\_\+handle\+\_\+cookie\+\_\+request}]{\setlength{\rightskip}{0pt plus 5cm}static int tcp\+\_\+handle\+\_\+cookie\+\_\+request (
\begin{DoxyParamCaption}
\item[{{\bf Net\+\_\+\+Crypto} $\ast$}]{c, }
\item[{int}]{connections\+\_\+number, }
\item[{const uint8\+\_\+t $\ast$}]{packet, }
\item[{uint16\+\_\+t}]{length}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{net__crypto_8c_a9308f183e47e29869d5562d03a01f88a}


Definition at line 217 of file net\+\_\+crypto.\+c.



References C\+O\+O\+K\+I\+E\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+P\+L\+A\+I\+N\+\_\+\+L\+E\+N\+G\+T\+H, C\+O\+O\+K\+I\+E\+\_\+\+R\+E\+S\+P\+O\+N\+S\+E\+\_\+\+L\+E\+N\+G\+T\+H, create\+\_\+cookie\+\_\+response(), make-\/funny-\/savefile\+::data, handle\+\_\+cookie\+\_\+request(), send\+\_\+packet\+\_\+tcp\+\_\+connection(), and Net\+\_\+\+Crypto\+::tcp\+\_\+c.



Referenced by tcp\+\_\+data\+\_\+callback().


\begin{DoxyCode}
218 \{
219     uint8\_t request\_plain[\hyperlink{net__crypto_8c_a09bc1e1952ce2d46d01925227c1c34d1}{COOKIE\_REQUEST\_PLAIN\_LENGTH}];
220     uint8\_t shared\_key[crypto\_box\_BEFORENMBYTES];
221     uint8\_t dht\_public\_key[crypto\_box\_PUBLICKEYBYTES];
222 
223     \textcolor{keywordflow}{if} (\hyperlink{net__crypto_8c_ae86cc5b9c02d6a9f61916e1ff1a1b768}{handle\_cookie\_request}(c, request\_plain, shared\_key, dht\_public\_key, packet, 
      length) != 0)
224         \textcolor{keywordflow}{return} -1;
225 
226     uint8\_t \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[\hyperlink{net__crypto_8c_a145d90f988058f15e869e94884d7f614}{COOKIE\_RESPONSE\_LENGTH}];
227 
228     \textcolor{keywordflow}{if} (\hyperlink{net__crypto_8c_ab88b2226740cacde1112ee7fd13048d3}{create\_cookie\_response}(c, data, request\_plain, shared\_key, dht\_public\_key) !=
       \textcolor{keyword}{sizeof}(data))
229         \textcolor{keywordflow}{return} -1;
230 
231     \textcolor{keywordtype}{int} ret = \hyperlink{_t_c_p__connection_8c_a455e955e01d34ff3db0b22b8f6d49d98}{send\_packet\_tcp\_connection}(c->\hyperlink{struct_net___crypto_a179982a02be89eaf6617ed81bd3c0961}{tcp\_c}, connections\_number, data,
       \textcolor{keyword}{sizeof}(data));
232     \textcolor{keywordflow}{return} ret;
233 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a9308f183e47e29869d5562d03a01f88a_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a9308f183e47e29869d5562d03a01f88a_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_a86a3ff661a8b9b10fd7c0daee3901091}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!tcp\+\_\+oob\+\_\+callback@{tcp\+\_\+oob\+\_\+callback}}
\index{tcp\+\_\+oob\+\_\+callback@{tcp\+\_\+oob\+\_\+callback}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{tcp\+\_\+oob\+\_\+callback}]{\setlength{\rightskip}{0pt plus 5cm}static int tcp\+\_\+oob\+\_\+callback (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{object, }
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key, }
\item[{unsigned int}]{tcp\+\_\+connections\+\_\+number, }
\item[{const uint8\+\_\+t $\ast$}]{data, }
\item[{uint16\+\_\+t}]{length}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{net__crypto_8c_a86a3ff661a8b9b10fd7c0daee3901091}


Definition at line 1746 of file net\+\_\+crypto.\+c.



References I\+P\+::family, handle\+\_\+new\+\_\+connection\+\_\+handshake(), I\+P\+\_\+\+Port\+::ip, I\+P\+::ip6, M\+A\+X\+\_\+\+C\+R\+Y\+P\+T\+O\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+S\+I\+Z\+E, N\+E\+T\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+C\+O\+O\+K\+I\+E\+\_\+\+R\+E\+Q\+U\+E\+S\+T, N\+E\+T\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+C\+R\+Y\+P\+T\+O\+\_\+\+H\+S, I\+P\+\_\+\+Port\+::port, T\+C\+P\+\_\+\+F\+A\+M\+I\+L\+Y, tcp\+\_\+oob\+\_\+handle\+\_\+cookie\+\_\+request(), and I\+P6\+::uint32.



Referenced by new\+\_\+net\+\_\+crypto().


\begin{DoxyCode}
1748 \{
1749     \textcolor{keywordflow}{if} (length == 0 || length > \hyperlink{net__crypto_8h_a4358ff1fe0068c79f791ac88674aea04}{MAX\_CRYPTO\_PACKET\_SIZE})
1750         \textcolor{keywordflow}{return} -1;
1751 
1752     \hyperlink{struct_net___crypto}{Net\_Crypto} *c = object;
1753 
1754     \textcolor{keywordflow}{if} (\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[0] == \hyperlink{network_8h_a3ad6d83af0ed67a84b327df50d66229c}{NET\_PACKET\_COOKIE\_REQUEST}) \{
1755         \textcolor{keywordflow}{return} \hyperlink{net__crypto_8c_ae88369484d37b525d33c5c87c846606b}{tcp\_oob\_handle\_cookie\_request}(c, tcp\_connections\_number, 
      \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}, length);
1756     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[0] == \hyperlink{network_8h_ae4ba32f7f36e935bd3a56b5e90299857}{NET\_PACKET\_CRYPTO\_HS}) \{
1757         \hyperlink{struct_i_p___port}{IP\_Port} source;
1758         source.\hyperlink{struct_i_p___port_a8e0798404bf2cf5dabb84c5ba9a4f236}{port} = 0;
1759         source.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} = \hyperlink{network_8h_a8b8d4bdf23eea1681ac4126938f587ec}{TCP\_FAMILY};
1760         source.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_a14c606eb5ffb078c38ad854dc4e79507}{ip6}.\hyperlink{union_i_p6_a1d8ab1f6c1da5565bed41e7095610dea}{uint32}[0] = tcp\_connections\_number;
1761 
1762         \textcolor{keywordflow}{if} (\hyperlink{net__crypto_8c_ae8139c35468806f25d5aed185edcc5a1}{handle\_new\_connection\_handshake}(c, source, 
      \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}, length) != 0)
1763             \textcolor{keywordflow}{return} -1;
1764 
1765         \textcolor{keywordflow}{return} 0;
1766     \} \textcolor{keywordflow}{else} \{
1767         \textcolor{keywordflow}{return} -1;
1768     \}
1769 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a86a3ff661a8b9b10fd7c0daee3901091_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a86a3ff661a8b9b10fd7c0daee3901091_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_ae88369484d37b525d33c5c87c846606b}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!tcp\+\_\+oob\+\_\+handle\+\_\+cookie\+\_\+request@{tcp\+\_\+oob\+\_\+handle\+\_\+cookie\+\_\+request}}
\index{tcp\+\_\+oob\+\_\+handle\+\_\+cookie\+\_\+request@{tcp\+\_\+oob\+\_\+handle\+\_\+cookie\+\_\+request}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{tcp\+\_\+oob\+\_\+handle\+\_\+cookie\+\_\+request}]{\setlength{\rightskip}{0pt plus 5cm}static int tcp\+\_\+oob\+\_\+handle\+\_\+cookie\+\_\+request (
\begin{DoxyParamCaption}
\item[{const {\bf Net\+\_\+\+Crypto} $\ast$}]{c, }
\item[{unsigned int}]{tcp\+\_\+connections\+\_\+number, }
\item[{const uint8\+\_\+t $\ast$}]{dht\+\_\+public\+\_\+key, }
\item[{const uint8\+\_\+t $\ast$}]{packet, }
\item[{uint16\+\_\+t}]{length}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{net__crypto_8c_ae88369484d37b525d33c5c87c846606b}


Definition at line 237 of file net\+\_\+crypto.\+c.



References C\+O\+O\+K\+I\+E\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+P\+L\+A\+I\+N\+\_\+\+L\+E\+N\+G\+T\+H, C\+O\+O\+K\+I\+E\+\_\+\+R\+E\+S\+P\+O\+N\+S\+E\+\_\+\+L\+E\+N\+G\+T\+H, create\+\_\+cookie\+\_\+response(), make-\/funny-\/savefile\+::data, handle\+\_\+cookie\+\_\+request(), Net\+\_\+\+Crypto\+::tcp\+\_\+c, and tcp\+\_\+send\+\_\+oob\+\_\+packet().



Referenced by tcp\+\_\+oob\+\_\+callback().


\begin{DoxyCode}
239 \{
240     uint8\_t request\_plain[\hyperlink{net__crypto_8c_a09bc1e1952ce2d46d01925227c1c34d1}{COOKIE\_REQUEST\_PLAIN\_LENGTH}];
241     uint8\_t shared\_key[crypto\_box\_BEFORENMBYTES];
242     uint8\_t dht\_public\_key\_temp[crypto\_box\_PUBLICKEYBYTES];
243 
244     \textcolor{keywordflow}{if} (\hyperlink{net__crypto_8c_ae86cc5b9c02d6a9f61916e1ff1a1b768}{handle\_cookie\_request}(c, request\_plain, shared\_key, dht\_public\_key\_temp, 
      packet, length) != 0)
245         \textcolor{keywordflow}{return} -1;
246 
247     \textcolor{keywordflow}{if} (memcmp(dht\_public\_key, dht\_public\_key\_temp, crypto\_box\_PUBLICKEYBYTES) != 0)
248         \textcolor{keywordflow}{return} -1;
249 
250     uint8\_t \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[\hyperlink{net__crypto_8c_a145d90f988058f15e869e94884d7f614}{COOKIE\_RESPONSE\_LENGTH}];
251 
252     \textcolor{keywordflow}{if} (\hyperlink{net__crypto_8c_ab88b2226740cacde1112ee7fd13048d3}{create\_cookie\_response}(c, data, request\_plain, shared\_key, dht\_public\_key) !=
       \textcolor{keyword}{sizeof}(data))
253         \textcolor{keywordflow}{return} -1;
254 
255     \textcolor{keywordtype}{int} ret = \hyperlink{_t_c_p__connection_8c_a5effabd83d700cccf9bcc51174f041f1}{tcp\_send\_oob\_packet}(c->\hyperlink{struct_net___crypto_a179982a02be89eaf6617ed81bd3c0961}{tcp\_c}, tcp\_connections\_number, dht\_public\_key,
       data, \textcolor{keyword}{sizeof}(data));
256     \textcolor{keywordflow}{return} ret;
257 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_ae88369484d37b525d33c5c87c846606b_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_ae88369484d37b525d33c5c87c846606b_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_a04fc41a4cb0d904536626006f3b7d7dd}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!udp\+\_\+handle\+\_\+cookie\+\_\+request@{udp\+\_\+handle\+\_\+cookie\+\_\+request}}
\index{udp\+\_\+handle\+\_\+cookie\+\_\+request@{udp\+\_\+handle\+\_\+cookie\+\_\+request}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{udp\+\_\+handle\+\_\+cookie\+\_\+request}]{\setlength{\rightskip}{0pt plus 5cm}static int udp\+\_\+handle\+\_\+cookie\+\_\+request (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{object, }
\item[{{\bf I\+P\+\_\+\+Port}}]{source, }
\item[{const uint8\+\_\+t $\ast$}]{packet, }
\item[{uint16\+\_\+t}]{length}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{net__crypto_8c_a04fc41a4cb0d904536626006f3b7d7dd}


Definition at line 194 of file net\+\_\+crypto.\+c.



References C\+O\+O\+K\+I\+E\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+P\+L\+A\+I\+N\+\_\+\+L\+E\+N\+G\+T\+H, C\+O\+O\+K\+I\+E\+\_\+\+R\+E\+S\+P\+O\+N\+S\+E\+\_\+\+L\+E\+N\+G\+T\+H, create\+\_\+cookie\+\_\+response(), make-\/funny-\/savefile\+::data, Net\+\_\+\+Crypto\+::dht, handle\+\_\+cookie\+\_\+request(), D\+H\+T\+::net, and sendpacket().



Referenced by new\+\_\+net\+\_\+crypto().


\begin{DoxyCode}
195 \{
196     \hyperlink{struct_net___crypto}{Net\_Crypto} *c = object;
197     uint8\_t request\_plain[\hyperlink{net__crypto_8c_a09bc1e1952ce2d46d01925227c1c34d1}{COOKIE\_REQUEST\_PLAIN\_LENGTH}];
198     uint8\_t shared\_key[crypto\_box\_BEFORENMBYTES];
199     uint8\_t dht\_public\_key[crypto\_box\_PUBLICKEYBYTES];
200 
201     \textcolor{keywordflow}{if} (\hyperlink{net__crypto_8c_ae86cc5b9c02d6a9f61916e1ff1a1b768}{handle\_cookie\_request}(c, request\_plain, shared\_key, dht\_public\_key, packet, 
      length) != 0)
202         \textcolor{keywordflow}{return} 1;
203 
204     uint8\_t \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[\hyperlink{net__crypto_8c_a145d90f988058f15e869e94884d7f614}{COOKIE\_RESPONSE\_LENGTH}];
205 
206     \textcolor{keywordflow}{if} (\hyperlink{net__crypto_8c_ab88b2226740cacde1112ee7fd13048d3}{create\_cookie\_response}(c, data, request\_plain, shared\_key, dht\_public\_key) !=
       \textcolor{keyword}{sizeof}(data))
207         \textcolor{keywordflow}{return} 1;
208 
209     \textcolor{keywordflow}{if} ((uint32\_t)\hyperlink{network_8c_a7b90f87f3ba60cc5c66dd6dd77cd5cb1}{sendpacket}(c->\hyperlink{struct_net___crypto_a8b3d6ce8745acc52695e252bdb1531b6}{dht}->\hyperlink{struct_d_h_t_aa14ea2f67950f57fe4235d7375a2216c}{net}, source, data, \textcolor{keyword}{sizeof}(data)) != \textcolor{keyword}{sizeof}(data))
210         \textcolor{keywordflow}{return} 1;
211 
212     \textcolor{keywordflow}{return} 0;
213 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a04fc41a4cb0d904536626006f3b7d7dd_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a04fc41a4cb0d904536626006f3b7d7dd_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_a812ca8a7291e22ce343669c9835c7c12}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!udp\+\_\+handle\+\_\+packet@{udp\+\_\+handle\+\_\+packet}}
\index{udp\+\_\+handle\+\_\+packet@{udp\+\_\+handle\+\_\+packet}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{udp\+\_\+handle\+\_\+packet}]{\setlength{\rightskip}{0pt plus 5cm}static int udp\+\_\+handle\+\_\+packet (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{object, }
\item[{{\bf I\+P\+\_\+\+Port}}]{source, }
\item[{const uint8\+\_\+t $\ast$}]{packet, }
\item[{uint16\+\_\+t}]{length}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{net__crypto_8c_a812ca8a7291e22ce343669c9835c7c12}


Definition at line 1995 of file net\+\_\+crypto.\+c.



References crypto\+\_\+id\+\_\+ip\+\_\+port(), Crypto\+\_\+\+Connection\+::direct\+\_\+lastrecv\+\_\+time, get\+\_\+crypto\+\_\+connection(), handle\+\_\+new\+\_\+connection\+\_\+handshake(), handle\+\_\+packet\+\_\+connection(), M\+A\+X\+\_\+\+C\+R\+Y\+P\+T\+O\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+S\+I\+Z\+E, Crypto\+\_\+\+Connection\+::mutex, N\+E\+T\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+C\+R\+Y\+P\+T\+O\+\_\+\+H\+S, and unix\+\_\+time().



Referenced by new\+\_\+net\+\_\+crypto().


\begin{DoxyCode}
1996 \{
1997     \textcolor{keywordflow}{if} (length <= CRYPTO\_MIN\_PACKET\_SIZE || length > \hyperlink{net__crypto_8h_a4358ff1fe0068c79f791ac88674aea04}{MAX\_CRYPTO\_PACKET\_SIZE})
1998         \textcolor{keywordflow}{return} 1;
1999 
2000     \hyperlink{struct_net___crypto}{Net\_Crypto} *c = object;
2001     \textcolor{keywordtype}{int} crypt\_connection\_id = \hyperlink{net__crypto_8c_ace680157da68eb91755350d0cb14cd8f}{crypto\_id\_ip\_port}(c, source);
2002 
2003     \textcolor{keywordflow}{if} (crypt\_connection\_id == -1) \{
2004         \textcolor{keywordflow}{if} (packet[0] != \hyperlink{network_8h_ae4ba32f7f36e935bd3a56b5e90299857}{NET\_PACKET\_CRYPTO\_HS})
2005             \textcolor{keywordflow}{return} 1;
2006 
2007         \textcolor{keywordflow}{if} (\hyperlink{net__crypto_8c_ae8139c35468806f25d5aed185edcc5a1}{handle\_new\_connection\_handshake}(c, source, packet, length) != 0)
2008             \textcolor{keywordflow}{return} 1;
2009 
2010         \textcolor{keywordflow}{return} 0;
2011     \}
2012 
2013     \textcolor{keywordflow}{if} (\hyperlink{net__crypto_8c_a04717fefa34f146623e7c95d5eef8caa}{handle\_packet\_connection}(c, crypt\_connection\_id, packet, length) != 0)
2014         \textcolor{keywordflow}{return} 1;
2015 
2016     \hyperlink{struct_crypto___connection}{Crypto\_Connection} *conn = \hyperlink{net__crypto_8c_a909daa4b6d420cbd028f2c956a8642db}{get\_crypto\_connection}(c, 
      crypt\_connection\_id);
2017 
2018     \textcolor{keywordflow}{if} (conn == 0)
2019         \textcolor{keywordflow}{return} -1;
2020 
2021     pthread\_mutex\_lock(&conn->\hyperlink{struct_crypto___connection_a4acff8232e4aec9cd5c6dc200ac55ef3}{mutex});
2022     conn->\hyperlink{struct_crypto___connection_ac6eb8a274b0dedea83359f2d9269cbc2}{direct\_lastrecv\_time} = \hyperlink{util_8c_ac958d9f8847cb8039444bfa3d304233a}{unix\_time}();
2023     pthread\_mutex\_unlock(&conn->\hyperlink{struct_crypto___connection_a4acff8232e4aec9cd5c6dc200ac55ef3}{mutex});
2024     \textcolor{keywordflow}{return} 0;
2025 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a812ca8a7291e22ce343669c9835c7c12_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a812ca8a7291e22ce343669c9835c7c12_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_a7be52b4dc75558fc64e9e017ea67f1d0}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!wipe\+\_\+crypto\+\_\+connection@{wipe\+\_\+crypto\+\_\+connection}}
\index{wipe\+\_\+crypto\+\_\+connection@{wipe\+\_\+crypto\+\_\+connection}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{wipe\+\_\+crypto\+\_\+connection}]{\setlength{\rightskip}{0pt plus 5cm}static int wipe\+\_\+crypto\+\_\+connection (
\begin{DoxyParamCaption}
\item[{{\bf Net\+\_\+\+Crypto} $\ast$}]{c, }
\item[{int}]{crypt\+\_\+connection\+\_\+id}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{net__crypto_8c_a7be52b4dc75558fc64e9e017ea67f1d0}


Definition at line 1416 of file net\+\_\+crypto.\+c.



References crypt\+\_\+connection\+\_\+id\+\_\+not\+\_\+valid(), C\+R\+Y\+P\+T\+O\+\_\+\+C\+O\+N\+N\+\_\+\+N\+O\+\_\+\+C\+O\+N\+N\+E\+C\+T\+I\+O\+N, Net\+\_\+\+Crypto\+::crypto\+\_\+connections, Net\+\_\+\+Crypto\+::crypto\+\_\+connections\+\_\+length, i, Crypto\+\_\+\+Connection\+::mutex, realloc\+\_\+cryptoconnection(), and Crypto\+\_\+\+Connection\+::status.



Referenced by crypto\+\_\+kill().


\begin{DoxyCode}
1417 \{
1418     \textcolor{keywordflow}{if} (\hyperlink{net__crypto_8c_a8aae93bf17f0b4a4305b88334e820310}{crypt\_connection\_id\_not\_valid}(c, crypt\_connection\_id))
1419         \textcolor{keywordflow}{return} -1;
1420 
1421     uint32\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
1422 
1423     \textcolor{comment}{/* Keep mutex, only destroy it when connection is realloced out. */}
1424     pthread\_mutex\_t mutex = c->\hyperlink{struct_net___crypto_a13fdc865b8a114466ba136f5390ec1b2}{crypto\_connections}[crypt\_connection\_id].
      \hyperlink{struct_crypto___connection_a4acff8232e4aec9cd5c6dc200ac55ef3}{mutex};
1425     memset(&(c->\hyperlink{struct_net___crypto_a13fdc865b8a114466ba136f5390ec1b2}{crypto\_connections}[crypt\_connection\_id]), 0 , \textcolor{keyword}{sizeof}(
      \hyperlink{struct_crypto___connection}{Crypto\_Connection}));
1426     c->\hyperlink{struct_net___crypto_a13fdc865b8a114466ba136f5390ec1b2}{crypto\_connections}[crypt\_connection\_id].\hyperlink{struct_crypto___connection_a4acff8232e4aec9cd5c6dc200ac55ef3}{mutex} = mutex;
1427 
1428     \textcolor{keywordflow}{for} (i = c->\hyperlink{struct_net___crypto_a9c91c3c65885a2bd39d0f864b9a5ddb9}{crypto\_connections\_length}; i != 0; --i) \{
1429         \textcolor{keywordflow}{if} (c->\hyperlink{struct_net___crypto_a13fdc865b8a114466ba136f5390ec1b2}{crypto\_connections}[i - 1].\hyperlink{struct_crypto___connection_ade818037fd6c985038ff29656089758d}{status} == 
      \hyperlink{net__crypto_8h_ab974dcadabde124fab5287024341f7a1}{CRYPTO\_CONN\_NO\_CONNECTION}) \{
1430             pthread\_mutex\_destroy(&c->\hyperlink{struct_net___crypto_a13fdc865b8a114466ba136f5390ec1b2}{crypto\_connections}[i - 1].
      \hyperlink{struct_crypto___connection_a4acff8232e4aec9cd5c6dc200ac55ef3}{mutex});
1431         \} \textcolor{keywordflow}{else} \{
1432             \textcolor{keywordflow}{break};
1433         \}
1434     \}
1435 
1436     \textcolor{keywordflow}{if} (c->\hyperlink{struct_net___crypto_a9c91c3c65885a2bd39d0f864b9a5ddb9}{crypto\_connections\_length} != i) \{
1437         c->\hyperlink{struct_net___crypto_a9c91c3c65885a2bd39d0f864b9a5ddb9}{crypto\_connections\_length} = \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
1438         \hyperlink{net__crypto_8c_ab0b745274346dc3464e35fcd756db0d2}{realloc\_cryptoconnection}(c, c->
      \hyperlink{struct_net___crypto_a9c91c3c65885a2bd39d0f864b9a5ddb9}{crypto\_connections\_length});
1439     \}
1440 
1441     \textcolor{keywordflow}{return} 0;
1442 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a7be52b4dc75558fc64e9e017ea67f1d0_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_a7be52b4dc75558fc64e9e017ea67f1d0_icgraph}
\end{center}
\end{figure}


\hypertarget{net__crypto_8c_ab17ccce6d503f75b7d98be214ebd7621}{\index{net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}!write\+\_\+cryptpacket@{write\+\_\+cryptpacket}}
\index{write\+\_\+cryptpacket@{write\+\_\+cryptpacket}!net\+\_\+crypto.\+c@{net\+\_\+crypto.\+c}}
\subsubsection[{write\+\_\+cryptpacket}]{\setlength{\rightskip}{0pt plus 5cm}int64\+\_\+t write\+\_\+cryptpacket (
\begin{DoxyParamCaption}
\item[{{\bf Net\+\_\+\+Crypto} $\ast$}]{c, }
\item[{int}]{crypt\+\_\+connection\+\_\+id, }
\item[{const uint8\+\_\+t $\ast$}]{data, }
\item[{uint16\+\_\+t}]{length, }
\item[{uint8\+\_\+t}]{congestion\+\_\+control}
\end{DoxyParamCaption}
)}}\label{net__crypto_8c_ab17ccce6d503f75b7d98be214ebd7621}


Definition at line 2219 of file net\+\_\+crypto.\+c.



References C\+R\+Y\+P\+T\+O\+\_\+\+C\+O\+N\+N\+\_\+\+E\+S\+T\+A\+B\+L\+I\+S\+H\+E\+D, C\+R\+Y\+P\+T\+O\+\_\+\+R\+E\+S\+E\+R\+V\+E\+D\+\_\+\+P\+A\+C\+K\+E\+T\+S, get\+\_\+crypto\+\_\+connection(), P\+A\+C\+K\+E\+T\+\_\+\+I\+D\+\_\+\+L\+O\+S\+S\+Y\+\_\+\+R\+A\+N\+G\+E\+\_\+\+S\+T\+A\+R\+T, Crypto\+\_\+\+Connection\+::packets\+\_\+left, Crypto\+\_\+\+Connection\+::packets\+\_\+sent, send\+\_\+lossless\+\_\+packet(), and Crypto\+\_\+\+Connection\+::status.



Referenced by m\+\_\+send\+\_\+message\+\_\+generic(), send\+\_\+custom\+\_\+lossless\+\_\+packet(), send\+\_\+file\+\_\+data\+\_\+packet(), send\+\_\+friend\+\_\+request\+\_\+packet(), send\+\_\+offline\+\_\+packet(), send\+\_\+online\+\_\+packet(), send\+\_\+packet\+\_\+group\+\_\+peer(), send\+\_\+packet\+\_\+online(), send\+\_\+ping(), send\+\_\+relays(), and write\+\_\+cryptpacket\+\_\+id().


\begin{DoxyCode}
2221 \{
2222     \textcolor{keywordflow}{if} (length == 0)
2223         \textcolor{keywordflow}{return} -1;
2224 
2225     \textcolor{keywordflow}{if} (\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[0] < \hyperlink{net__crypto_8h_a98aaeb516244f1581d65e3dbb008979e}{CRYPTO\_RESERVED\_PACKETS})
2226         \textcolor{keywordflow}{return} -1;
2227 
2228     \textcolor{keywordflow}{if} (\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[0] >= \hyperlink{net__crypto_8h_a02481d2cc931289c2d5ee21d2a633316}{PACKET\_ID\_LOSSY\_RANGE\_START})
2229         \textcolor{keywordflow}{return} -1;
2230 
2231     \hyperlink{struct_crypto___connection}{Crypto\_Connection} *conn = \hyperlink{net__crypto_8c_a909daa4b6d420cbd028f2c956a8642db}{get\_crypto\_connection}(c, 
      crypt\_connection\_id);
2232 
2233     \textcolor{keywordflow}{if} (conn == 0)
2234         \textcolor{keywordflow}{return} -1;
2235 
2236     \textcolor{keywordflow}{if} (conn->\hyperlink{struct_crypto___connection_ade818037fd6c985038ff29656089758d}{status} != \hyperlink{net__crypto_8h_ae15ad1cc9a29a669e0df83d610c188b0}{CRYPTO\_CONN\_ESTABLISHED})
2237         \textcolor{keywordflow}{return} -1;
2238 
2239     \textcolor{keywordflow}{if} (congestion\_control && conn->\hyperlink{struct_crypto___connection_adfabcbe80305cc6b4e1c0dfef5c48653}{packets\_left} == 0)
2240         \textcolor{keywordflow}{return} -1;
2241 
2242     int64\_t ret = \hyperlink{net__crypto_8c_a06c8bdc27b9865d1b7d775b654f44d1a}{send\_lossless\_packet}(c, crypt\_connection\_id, 
      \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}, length, congestion\_control);
2243 
2244     \textcolor{keywordflow}{if} (ret == -1)
2245         \textcolor{keywordflow}{return} -1;
2246 
2247     \textcolor{keywordflow}{if} (congestion\_control) \{
2248         --conn->\hyperlink{struct_crypto___connection_adfabcbe80305cc6b4e1c0dfef5c48653}{packets\_left};
2249         conn->\hyperlink{struct_crypto___connection_ad51d37ac38989c1d089da8aa0d1bc1d7}{packets\_sent}++;
2250     \}
2251 
2252     \textcolor{keywordflow}{return} ret;
2253 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_ab17ccce6d503f75b7d98be214ebd7621_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dc6/net__crypto_8c_ab17ccce6d503f75b7d98be214ebd7621_icgraph}
\end{center}
\end{figure}


