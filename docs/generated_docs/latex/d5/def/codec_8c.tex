\hypertarget{codec_8c}{\section{toxav/codec.c File Reference}
\label{codec_8c}\index{toxav/codec.\+c@{toxav/codec.\+c}}
}
{\ttfamily \#include \char`\"{}codec.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}../toxcore/logger.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}../toxcore/util.\+h\char`\"{}}\\*
{\ttfamily \#include $<$stdio.\+h$>$}\\*
{\ttfamily \#include $<$stdlib.\+h$>$}\\*
{\ttfamily \#include $<$math.\+h$>$}\\*
{\ttfamily \#include $<$assert.\+h$>$}\\*
{\ttfamily \#include $<$time.\+h$>$}\\*
{\ttfamily \#include \char`\"{}msi.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}rtp.\+h\char`\"{}}\\*
Include dependency graph for codec.\+c\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d8/dfa/codec_8c__incl}
\end{center}
\end{figure}
\subsection*{Data Structures}
\begin{DoxyCompactItemize}
\item 
struct \hyperlink{struct___jitter_buffer}{\+\_\+\+Jitter\+Buffer}
\end{DoxyCompactItemize}
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{codec_8c_ad583b0b354b5a67760fb2af75610fae4}{M\+A\+X\+\_\+\+D\+E\+C\+O\+D\+E\+\_\+\+T\+I\+M\+E\+\_\+\+U\+S}~0
\item 
\#define \hyperlink{codec_8c_a7932455292fb6bc8d18f5baa12fc7b3f}{M\+A\+X\+\_\+\+V\+I\+D\+E\+O\+F\+R\+A\+M\+E\+\_\+\+S\+I\+Z\+E}~0x40000 /$\ast$ 256\+Ki\+B $\ast$/
\item 
\#define \hyperlink{codec_8c_ab2a08a350c695492c3b5b15bec8445e3}{V\+I\+D\+E\+O\+F\+R\+A\+M\+E\+\_\+\+P\+I\+E\+C\+E\+\_\+\+S\+I\+Z\+E}~0x500 /$\ast$ 1.\+25 Ki\+B$\ast$/
\item 
\#define \hyperlink{codec_8c_a1fd042bb49704e3c68dea14ff6956b33}{V\+I\+D\+E\+O\+F\+R\+A\+M\+E\+\_\+\+H\+E\+A\+D\+E\+R\+\_\+\+S\+I\+Z\+E}~0x2
\item 
\#define \hyperlink{codec_8c_a861904c6cbceb168142459076d189f14}{V\+I\+D\+E\+O\+\_\+\+D\+E\+C\+O\+D\+E\+\_\+\+B\+U\+F\+F\+E\+R\+\_\+\+S\+I\+Z\+E}~20
\item 
\#define \hyperlink{codec_8c_a95b93e308f97639fce32edc42fb277dd}{A\+R\+R\+A\+Y}(T\+Y\+P\+E\+\_\+\+\_\+)~struct \{ uint16\+\_\+t size; T\+Y\+P\+E\+\_\+\+\_\+ data\mbox{[}$\,$\mbox{]}; \}
\end{DoxyCompactItemize}
\subsection*{Typedefs}
\begin{DoxyCompactItemize}
\item 
typedef struct \hyperlink{struct___jitter_buffer}{\+\_\+\+Jitter\+Buffer} \hyperlink{codec_8c_a365d3e6ff2230c0999d4bbffcfa3785c}{Jitter\+Buffer}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
typedef \hyperlink{codec_8c_ae8a62234142030492c25e2985f74ce2f}{A\+R\+R\+A\+Y} (uint8\+\_\+t)
\item 
static \+\_\+\+Bool \hyperlink{codec_8c_ab27fdbd54a41e787c4a98b119d181b13}{buffer\+\_\+full} (const \hyperlink{codec_8c_a2594599edbe03ec432aabbcdb4c51ba9}{Payload\+Buffer} $\ast$b)
\item 
static \+\_\+\+Bool \hyperlink{codec_8c_a6e1ec2c6aa4625da81486a73661df742}{buffer\+\_\+empty} (const \hyperlink{codec_8c_a2594599edbe03ec432aabbcdb4c51ba9}{Payload\+Buffer} $\ast$b)
\item 
static void \hyperlink{codec_8c_a5990d0123726b7f12cebdae0984475b4}{buffer\+\_\+write} (\hyperlink{codec_8c_a2594599edbe03ec432aabbcdb4c51ba9}{Payload\+Buffer} $\ast$b, Payload $\ast$p)
\item 
static void \hyperlink{codec_8c_aa27710dac4f829dad6d007cf01bdf55f}{buffer\+\_\+read} (\hyperlink{codec_8c_a2594599edbe03ec432aabbcdb4c51ba9}{Payload\+Buffer} $\ast$b, Payload $\ast$$\ast$p)
\item 
static void \hyperlink{codec_8c_a6b10a945e7d4808b0192ee3b949babd3}{buffer\+\_\+clear} (\hyperlink{codec_8c_a2594599edbe03ec432aabbcdb4c51ba9}{Payload\+Buffer} $\ast$b)
\item 
static \hyperlink{codec_8c_a2594599edbe03ec432aabbcdb4c51ba9}{Payload\+Buffer} $\ast$ \hyperlink{codec_8c_acf8378036663935ba4186b5b24474a65}{buffer\+\_\+new} (int size)
\item 
static void \hyperlink{codec_8c_a30114dcdaee5519093e2ff87708c92ed}{buffer\+\_\+free} (\hyperlink{codec_8c_a2594599edbe03ec432aabbcdb4c51ba9}{Payload\+Buffer} $\ast$b)
\item 
static \hyperlink{codec_8c_a365d3e6ff2230c0999d4bbffcfa3785c}{Jitter\+Buffer} $\ast$ \hyperlink{codec_8c_a2c648daf423442a3f58d3f1386e9dd95}{jbuf\+\_\+new} (uint32\+\_\+t capacity)
\item 
static void \hyperlink{codec_8c_a2ab3636512ac576d996c504f9226108d}{jbuf\+\_\+clear} (\hyperlink{codec_8c_a365d3e6ff2230c0999d4bbffcfa3785c}{Jitter\+Buffer} $\ast$q)
\item 
static void \hyperlink{codec_8c_ac44be2f075777b2461178608c0efb36c}{jbuf\+\_\+free} (\hyperlink{codec_8c_a365d3e6ff2230c0999d4bbffcfa3785c}{Jitter\+Buffer} $\ast$q)
\item 
static int \hyperlink{codec_8c_a170dd2e497101775eea8695dbda58f9e}{jbuf\+\_\+write} (\hyperlink{codec_8c_a365d3e6ff2230c0999d4bbffcfa3785c}{Jitter\+Buffer} $\ast$q, \hyperlink{rtp_8h_ab98525fe7a493c34d9dc586aa5b029b6}{R\+T\+P\+Message} $\ast$\hyperlink{_messenger__test_8c_aea6eb6c7c30a659f1b0dee83eaf03ea2}{m})
\item 
static \hyperlink{rtp_8h_ab98525fe7a493c34d9dc586aa5b029b6}{R\+T\+P\+Message} $\ast$ \hyperlink{codec_8c_a5d946ee1be34a637150e7204137f91ea}{jbuf\+\_\+read} (\hyperlink{codec_8c_a365d3e6ff2230c0999d4bbffcfa3785c}{Jitter\+Buffer} $\ast$q, int32\+\_\+t $\ast$success)
\item 
static int \hyperlink{codec_8c_a33bcb63c2ad472f689ed1c2c99a153ff}{init\+\_\+video\+\_\+decoder} (\hyperlink{codec_8h_afe3951fb4d95e129eb5b9de06e946b16}{C\+S\+Session} $\ast$cs)
\item 
static int \hyperlink{codec_8c_a731be97412f688f88f08b3734d762616}{init\+\_\+audio\+\_\+decoder} (\hyperlink{codec_8h_afe3951fb4d95e129eb5b9de06e946b16}{C\+S\+Session} $\ast$cs)
\item 
static int \hyperlink{codec_8c_ab07ecfbcd82777c995c23e3fe70f6a2b}{init\+\_\+video\+\_\+encoder} (\hyperlink{codec_8h_afe3951fb4d95e129eb5b9de06e946b16}{C\+S\+Session} $\ast$cs, uint16\+\_\+t max\+\_\+width, uint16\+\_\+t max\+\_\+height, uint32\+\_\+t video\+\_\+bitrate)
\item 
static int \hyperlink{codec_8c_a9d09ec5d699f16689b64699d10acee5c}{init\+\_\+audio\+\_\+encoder} (\hyperlink{codec_8h_afe3951fb4d95e129eb5b9de06e946b16}{C\+S\+Session} $\ast$cs)
\item 
int \hyperlink{codec_8c_a5da4a305e711e7213dfcbe92d31d37bf}{cs\+\_\+split\+\_\+video\+\_\+payload} (\hyperlink{codec_8h_afe3951fb4d95e129eb5b9de06e946b16}{C\+S\+Session} $\ast$cs, const uint8\+\_\+t $\ast$payload, uint16\+\_\+t length)
\item 
const uint8\+\_\+t $\ast$ \hyperlink{codec_8c_a61d7fe6f60a95160c4ca434a60cb9bf7}{cs\+\_\+get\+\_\+split\+\_\+video\+\_\+frame} (\hyperlink{codec_8h_afe3951fb4d95e129eb5b9de06e946b16}{C\+S\+Session} $\ast$cs, uint16\+\_\+t $\ast$size)
\item 
void \hyperlink{codec_8c_a478d9b52aca882a11b160e8bbb50dd74}{cs\+\_\+do} (\hyperlink{codec_8h_afe3951fb4d95e129eb5b9de06e946b16}{C\+S\+Session} $\ast$cs)
\item 
int \hyperlink{codec_8c_a2c3fede54bd31b427fc5147cb450c714}{cs\+\_\+set\+\_\+video\+\_\+encoder\+\_\+resolution} (\hyperlink{codec_8h_afe3951fb4d95e129eb5b9de06e946b16}{C\+S\+Session} $\ast$cs, uint16\+\_\+t width, uint16\+\_\+t height)
\item 
int \hyperlink{codec_8c_ad5d2ffe3cd2dad642c722765639159e2}{cs\+\_\+set\+\_\+video\+\_\+encoder\+\_\+bitrate} (\hyperlink{codec_8h_afe3951fb4d95e129eb5b9de06e946b16}{C\+S\+Session} $\ast$cs, uint32\+\_\+t video\+\_\+bitrate)
\item 
\hyperlink{codec_8h_afe3951fb4d95e129eb5b9de06e946b16}{C\+S\+Session} $\ast$ \hyperlink{codec_8c_aa99953343ed26c4b7914cac072ff95c1}{cs\+\_\+new} (const \hyperlink{toxav_8h_ae30c65d2804a20349b0ea2ae240b209e}{Tox\+Av\+C\+Settings} $\ast$cs\+\_\+self, const \hyperlink{toxav_8h_ae30c65d2804a20349b0ea2ae240b209e}{Tox\+Av\+C\+Settings} $\ast$cs\+\_\+peer, uint32\+\_\+t jbuf\+\_\+size, int has\+\_\+video)
\item 
void \hyperlink{codec_8c_addde6ea51851fcce009bb7d45147a88f}{cs\+\_\+kill} (\hyperlink{codec_8h_afe3951fb4d95e129eb5b9de06e946b16}{C\+S\+Session} $\ast$cs)
\item 
void \hyperlink{codec_8c_a84bdc7c8bb1fa316af5ed8dd4fac4df8}{queue\+\_\+message} (\hyperlink{rtp_8h_aecafd8fd6e485ceb09747d50703bcd06}{R\+T\+P\+Session} $\ast$session, \hyperlink{rtp_8h_ab98525fe7a493c34d9dc586aa5b029b6}{R\+T\+P\+Message} $\ast$msg)
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\hyperlink{codec_8c_a2594599edbe03ec432aabbcdb4c51ba9}{Payload\+Buffer}
\end{DoxyCompactItemize}


\subsection{Macro Definition Documentation}
\hypertarget{codec_8c_a95b93e308f97639fce32edc42fb277dd}{\index{codec.\+c@{codec.\+c}!A\+R\+R\+A\+Y@{A\+R\+R\+A\+Y}}
\index{A\+R\+R\+A\+Y@{A\+R\+R\+A\+Y}!codec.\+c@{codec.\+c}}
\subsubsection[{A\+R\+R\+A\+Y}]{\setlength{\rightskip}{0pt plus 5cm}\#define A\+R\+R\+A\+Y(
\begin{DoxyParamCaption}
\item[{}]{T\+Y\+P\+E\+\_\+\+\_\+}
\end{DoxyParamCaption}
)~struct \{ uint16\+\_\+t size; T\+Y\+P\+E\+\_\+\+\_\+ data\mbox{[}$\,$\mbox{]}; \}}}\label{codec_8c_a95b93e308f97639fce32edc42fb277dd}


Definition at line 53 of file codec.\+c.

\hypertarget{codec_8c_ad583b0b354b5a67760fb2af75610fae4}{\index{codec.\+c@{codec.\+c}!M\+A\+X\+\_\+\+D\+E\+C\+O\+D\+E\+\_\+\+T\+I\+M\+E\+\_\+\+U\+S@{M\+A\+X\+\_\+\+D\+E\+C\+O\+D\+E\+\_\+\+T\+I\+M\+E\+\_\+\+U\+S}}
\index{M\+A\+X\+\_\+\+D\+E\+C\+O\+D\+E\+\_\+\+T\+I\+M\+E\+\_\+\+U\+S@{M\+A\+X\+\_\+\+D\+E\+C\+O\+D\+E\+\_\+\+T\+I\+M\+E\+\_\+\+U\+S}!codec.\+c@{codec.\+c}}
\subsubsection[{M\+A\+X\+\_\+\+D\+E\+C\+O\+D\+E\+\_\+\+T\+I\+M\+E\+\_\+\+U\+S}]{\setlength{\rightskip}{0pt plus 5cm}\#define M\+A\+X\+\_\+\+D\+E\+C\+O\+D\+E\+\_\+\+T\+I\+M\+E\+\_\+\+U\+S~0}}\label{codec_8c_ad583b0b354b5a67760fb2af75610fae4}
\hyperlink{codec_8c}{codec.\+c}

Audio and video codec intitialization, encoding/decoding and playback

Copyright (C) 2013 Tox project All Rights Reserved.

This file is part of Tox.

Tox is free software\+: you can redistribute it and/or modify it under the terms of the G\+N\+U General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.

Tox is distributed in the hope that it will be useful, but W\+I\+T\+H\+O\+U\+T A\+N\+Y W\+A\+R\+R\+A\+N\+T\+Y; without even the implied warranty of M\+E\+R\+C\+H\+A\+N\+T\+A\+B\+I\+L\+I\+T\+Y or F\+I\+T\+N\+E\+S\+S F\+O\+R A P\+A\+R\+T\+I\+C\+U\+L\+A\+R P\+U\+R\+P\+O\+S\+E. See the G\+N\+U General Public License for more details.

You should have received a copy of the G\+N\+U General Public License along with Tox. If not, see \href{http://www.gnu.org/licenses/}{\tt http\+://www.\+gnu.\+org/licenses/}. 

Definition at line 43 of file codec.\+c.



Referenced by cs\+\_\+do().

\hypertarget{codec_8c_a7932455292fb6bc8d18f5baa12fc7b3f}{\index{codec.\+c@{codec.\+c}!M\+A\+X\+\_\+\+V\+I\+D\+E\+O\+F\+R\+A\+M\+E\+\_\+\+S\+I\+Z\+E@{M\+A\+X\+\_\+\+V\+I\+D\+E\+O\+F\+R\+A\+M\+E\+\_\+\+S\+I\+Z\+E}}
\index{M\+A\+X\+\_\+\+V\+I\+D\+E\+O\+F\+R\+A\+M\+E\+\_\+\+S\+I\+Z\+E@{M\+A\+X\+\_\+\+V\+I\+D\+E\+O\+F\+R\+A\+M\+E\+\_\+\+S\+I\+Z\+E}!codec.\+c@{codec.\+c}}
\subsubsection[{M\+A\+X\+\_\+\+V\+I\+D\+E\+O\+F\+R\+A\+M\+E\+\_\+\+S\+I\+Z\+E}]{\setlength{\rightskip}{0pt plus 5cm}\#define M\+A\+X\+\_\+\+V\+I\+D\+E\+O\+F\+R\+A\+M\+E\+\_\+\+S\+I\+Z\+E~0x40000 /$\ast$ 256\+Ki\+B $\ast$/}}\label{codec_8c_a7932455292fb6bc8d18f5baa12fc7b3f}


Definition at line 46 of file codec.\+c.



Referenced by cs\+\_\+new().

\hypertarget{codec_8c_a861904c6cbceb168142459076d189f14}{\index{codec.\+c@{codec.\+c}!V\+I\+D\+E\+O\+\_\+\+D\+E\+C\+O\+D\+E\+\_\+\+B\+U\+F\+F\+E\+R\+\_\+\+S\+I\+Z\+E@{V\+I\+D\+E\+O\+\_\+\+D\+E\+C\+O\+D\+E\+\_\+\+B\+U\+F\+F\+E\+R\+\_\+\+S\+I\+Z\+E}}
\index{V\+I\+D\+E\+O\+\_\+\+D\+E\+C\+O\+D\+E\+\_\+\+B\+U\+F\+F\+E\+R\+\_\+\+S\+I\+Z\+E@{V\+I\+D\+E\+O\+\_\+\+D\+E\+C\+O\+D\+E\+\_\+\+B\+U\+F\+F\+E\+R\+\_\+\+S\+I\+Z\+E}!codec.\+c@{codec.\+c}}
\subsubsection[{V\+I\+D\+E\+O\+\_\+\+D\+E\+C\+O\+D\+E\+\_\+\+B\+U\+F\+F\+E\+R\+\_\+\+S\+I\+Z\+E}]{\setlength{\rightskip}{0pt plus 5cm}\#define V\+I\+D\+E\+O\+\_\+\+D\+E\+C\+O\+D\+E\+\_\+\+B\+U\+F\+F\+E\+R\+\_\+\+S\+I\+Z\+E~20}}\label{codec_8c_a861904c6cbceb168142459076d189f14}


Definition at line 51 of file codec.\+c.



Referenced by cs\+\_\+new().

\hypertarget{codec_8c_a1fd042bb49704e3c68dea14ff6956b33}{\index{codec.\+c@{codec.\+c}!V\+I\+D\+E\+O\+F\+R\+A\+M\+E\+\_\+\+H\+E\+A\+D\+E\+R\+\_\+\+S\+I\+Z\+E@{V\+I\+D\+E\+O\+F\+R\+A\+M\+E\+\_\+\+H\+E\+A\+D\+E\+R\+\_\+\+S\+I\+Z\+E}}
\index{V\+I\+D\+E\+O\+F\+R\+A\+M\+E\+\_\+\+H\+E\+A\+D\+E\+R\+\_\+\+S\+I\+Z\+E@{V\+I\+D\+E\+O\+F\+R\+A\+M\+E\+\_\+\+H\+E\+A\+D\+E\+R\+\_\+\+S\+I\+Z\+E}!codec.\+c@{codec.\+c}}
\subsubsection[{V\+I\+D\+E\+O\+F\+R\+A\+M\+E\+\_\+\+H\+E\+A\+D\+E\+R\+\_\+\+S\+I\+Z\+E}]{\setlength{\rightskip}{0pt plus 5cm}\#define V\+I\+D\+E\+O\+F\+R\+A\+M\+E\+\_\+\+H\+E\+A\+D\+E\+R\+\_\+\+S\+I\+Z\+E~0x2}}\label{codec_8c_a1fd042bb49704e3c68dea14ff6956b33}


Definition at line 48 of file codec.\+c.



Referenced by cs\+\_\+get\+\_\+split\+\_\+video\+\_\+frame(), cs\+\_\+new(), and queue\+\_\+message().

\hypertarget{codec_8c_ab2a08a350c695492c3b5b15bec8445e3}{\index{codec.\+c@{codec.\+c}!V\+I\+D\+E\+O\+F\+R\+A\+M\+E\+\_\+\+P\+I\+E\+C\+E\+\_\+\+S\+I\+Z\+E@{V\+I\+D\+E\+O\+F\+R\+A\+M\+E\+\_\+\+P\+I\+E\+C\+E\+\_\+\+S\+I\+Z\+E}}
\index{V\+I\+D\+E\+O\+F\+R\+A\+M\+E\+\_\+\+P\+I\+E\+C\+E\+\_\+\+S\+I\+Z\+E@{V\+I\+D\+E\+O\+F\+R\+A\+M\+E\+\_\+\+P\+I\+E\+C\+E\+\_\+\+S\+I\+Z\+E}!codec.\+c@{codec.\+c}}
\subsubsection[{V\+I\+D\+E\+O\+F\+R\+A\+M\+E\+\_\+\+P\+I\+E\+C\+E\+\_\+\+S\+I\+Z\+E}]{\setlength{\rightskip}{0pt plus 5cm}\#define V\+I\+D\+E\+O\+F\+R\+A\+M\+E\+\_\+\+P\+I\+E\+C\+E\+\_\+\+S\+I\+Z\+E~0x500 /$\ast$ 1.\+25 Ki\+B$\ast$/}}\label{codec_8c_ab2a08a350c695492c3b5b15bec8445e3}


Definition at line 47 of file codec.\+c.



Referenced by cs\+\_\+new().



\subsection{Typedef Documentation}
\hypertarget{codec_8c_a365d3e6ff2230c0999d4bbffcfa3785c}{\index{codec.\+c@{codec.\+c}!Jitter\+Buffer@{Jitter\+Buffer}}
\index{Jitter\+Buffer@{Jitter\+Buffer}!codec.\+c@{codec.\+c}}
\subsubsection[{Jitter\+Buffer}]{\setlength{\rightskip}{0pt plus 5cm}typedef struct {\bf \+\_\+\+Jitter\+Buffer}  {\bf Jitter\+Buffer}}}\label{codec_8c_a365d3e6ff2230c0999d4bbffcfa3785c}


\subsection{Function Documentation}
\hypertarget{codec_8c_ae8a62234142030492c25e2985f74ce2f}{\index{codec.\+c@{codec.\+c}!A\+R\+R\+A\+Y@{A\+R\+R\+A\+Y}}
\index{A\+R\+R\+A\+Y@{A\+R\+R\+A\+Y}!codec.\+c@{codec.\+c}}
\subsubsection[{A\+R\+R\+A\+Y}]{\setlength{\rightskip}{0pt plus 5cm}typedef A\+R\+R\+A\+Y (
\begin{DoxyParamCaption}
\item[{uint8\+\_\+t}]{}
\end{DoxyParamCaption}
)}}\label{codec_8c_ae8a62234142030492c25e2985f74ce2f}


Definition at line 55 of file codec.\+c.



References end, and start.


\begin{DoxyCode}
57                \{
58     uint16\_t size; \textcolor{comment}{/* Max size */}
59     uint16\_t \hyperlink{msi_8c_ae511d1f1e345bb77cd4120b39679f028a0e97c69c73117f6c0109b2d7d1d9cedc}{start};
60     uint16\_t \hyperlink{msi_8c_ae511d1f1e345bb77cd4120b39679f028a80b1a820e533d7cf0e1715319339e6d0}{end};
61     Payload **packets;
62 \} \hyperlink{codec_8c_a2594599edbe03ec432aabbcdb4c51ba9}{PayloadBuffer};
\end{DoxyCode}
\hypertarget{codec_8c_a6b10a945e7d4808b0192ee3b949babd3}{\index{codec.\+c@{codec.\+c}!buffer\+\_\+clear@{buffer\+\_\+clear}}
\index{buffer\+\_\+clear@{buffer\+\_\+clear}!codec.\+c@{codec.\+c}}
\subsubsection[{buffer\+\_\+clear}]{\setlength{\rightskip}{0pt plus 5cm}static void buffer\+\_\+clear (
\begin{DoxyParamCaption}
\item[{{\bf Payload\+Buffer} $\ast$}]{b}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{codec_8c_a6b10a945e7d4808b0192ee3b949babd3}


Definition at line 88 of file codec.\+c.



References buffer\+\_\+empty(), and buffer\+\_\+read().



Referenced by buffer\+\_\+free().


\begin{DoxyCode}
89 \{
90     \textcolor{keywordflow}{while} (!\hyperlink{codec_8c_a6e1ec2c6aa4625da81486a73661df742}{buffer\_empty}(b)) \{
91         Payload *p;
92         \hyperlink{codec_8c_aa27710dac4f829dad6d007cf01bdf55f}{buffer\_read}(b, &p);
93         free(p);
94     \}
95 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=258pt]{d5/def/codec_8c_a6b10a945e7d4808b0192ee3b949babd3_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d5/def/codec_8c_a6b10a945e7d4808b0192ee3b949babd3_icgraph}
\end{center}
\end{figure}


\hypertarget{codec_8c_a6e1ec2c6aa4625da81486a73661df742}{\index{codec.\+c@{codec.\+c}!buffer\+\_\+empty@{buffer\+\_\+empty}}
\index{buffer\+\_\+empty@{buffer\+\_\+empty}!codec.\+c@{codec.\+c}}
\subsubsection[{buffer\+\_\+empty}]{\setlength{\rightskip}{0pt plus 5cm}static \+\_\+\+Bool buffer\+\_\+empty (
\begin{DoxyParamCaption}
\item[{const {\bf Payload\+Buffer} $\ast$}]{b}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{codec_8c_a6e1ec2c6aa4625da81486a73661df742}


Definition at line 69 of file codec.\+c.



Referenced by buffer\+\_\+clear(), and cs\+\_\+do().


\begin{DoxyCode}
70 \{
71     \textcolor{keywordflow}{return} b->end == b->start;
72 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d5/def/codec_8c_a6e1ec2c6aa4625da81486a73661df742_icgraph}
\end{center}
\end{figure}


\hypertarget{codec_8c_a30114dcdaee5519093e2ff87708c92ed}{\index{codec.\+c@{codec.\+c}!buffer\+\_\+free@{buffer\+\_\+free}}
\index{buffer\+\_\+free@{buffer\+\_\+free}!codec.\+c@{codec.\+c}}
\subsubsection[{buffer\+\_\+free}]{\setlength{\rightskip}{0pt plus 5cm}static void buffer\+\_\+free (
\begin{DoxyParamCaption}
\item[{{\bf Payload\+Buffer} $\ast$}]{b}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{codec_8c_a30114dcdaee5519093e2ff87708c92ed}


Definition at line 113 of file codec.\+c.



References buffer\+\_\+clear().



Referenced by cs\+\_\+kill(), and cs\+\_\+new().


\begin{DoxyCode}
114 \{
115     \textcolor{keywordflow}{if} (b) \{
116         \hyperlink{codec_8c_a6b10a945e7d4808b0192ee3b949babd3}{buffer\_clear}(b);
117         free(b->packets);
118         free(b);
119     \}
120 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d5/def/codec_8c_a30114dcdaee5519093e2ff87708c92ed_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d5/def/codec_8c_a30114dcdaee5519093e2ff87708c92ed_icgraph}
\end{center}
\end{figure}


\hypertarget{codec_8c_ab27fdbd54a41e787c4a98b119d181b13}{\index{codec.\+c@{codec.\+c}!buffer\+\_\+full@{buffer\+\_\+full}}
\index{buffer\+\_\+full@{buffer\+\_\+full}!codec.\+c@{codec.\+c}}
\subsubsection[{buffer\+\_\+full}]{\setlength{\rightskip}{0pt plus 5cm}static \+\_\+\+Bool buffer\+\_\+full (
\begin{DoxyParamCaption}
\item[{const {\bf Payload\+Buffer} $\ast$}]{b}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{codec_8c_ab27fdbd54a41e787c4a98b119d181b13}


Definition at line 64 of file codec.\+c.



Referenced by queue\+\_\+message().


\begin{DoxyCode}
65 \{
66     \textcolor{keywordflow}{return} (b->end + 1) % b->size == b->start;
67 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d5/def/codec_8c_ab27fdbd54a41e787c4a98b119d181b13_icgraph}
\end{center}
\end{figure}


\hypertarget{codec_8c_acf8378036663935ba4186b5b24474a65}{\index{codec.\+c@{codec.\+c}!buffer\+\_\+new@{buffer\+\_\+new}}
\index{buffer\+\_\+new@{buffer\+\_\+new}!codec.\+c@{codec.\+c}}
\subsubsection[{buffer\+\_\+new}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf Payload\+Buffer}$\ast$ buffer\+\_\+new (
\begin{DoxyParamCaption}
\item[{int}]{size}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{codec_8c_acf8378036663935ba4186b5b24474a65}


Definition at line 97 of file codec.\+c.



References Payload\+Buffer.



Referenced by cs\+\_\+new().


\begin{DoxyCode}
98 \{
99     \hyperlink{codec_8c_a2594599edbe03ec432aabbcdb4c51ba9}{PayloadBuffer} *buf = calloc(\textcolor{keyword}{sizeof}(\hyperlink{codec_8c_a2594599edbe03ec432aabbcdb4c51ba9}{PayloadBuffer}), 1);
100 
101     \textcolor{keywordflow}{if} (!buf) \textcolor{keywordflow}{return} NULL;
102 
103     buf->size = size + 1; \textcolor{comment}{/* include empty elem */}
104 
105     \textcolor{keywordflow}{if} (!(buf->packets = calloc(buf->size, \textcolor{keyword}{sizeof}(Payload *)))) \{
106         free(buf);
107         \textcolor{keywordflow}{return} NULL;
108     \}
109 
110     \textcolor{keywordflow}{return} buf;
111 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d5/def/codec_8c_acf8378036663935ba4186b5b24474a65_icgraph}
\end{center}
\end{figure}


\hypertarget{codec_8c_aa27710dac4f829dad6d007cf01bdf55f}{\index{codec.\+c@{codec.\+c}!buffer\+\_\+read@{buffer\+\_\+read}}
\index{buffer\+\_\+read@{buffer\+\_\+read}!codec.\+c@{codec.\+c}}
\subsubsection[{buffer\+\_\+read}]{\setlength{\rightskip}{0pt plus 5cm}static void buffer\+\_\+read (
\begin{DoxyParamCaption}
\item[{{\bf Payload\+Buffer} $\ast$}]{b, }
\item[{Payload $\ast$$\ast$}]{p}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{codec_8c_aa27710dac4f829dad6d007cf01bdf55f}


Definition at line 82 of file codec.\+c.



Referenced by buffer\+\_\+clear(), cs\+\_\+do(), and queue\+\_\+message().


\begin{DoxyCode}
83 \{
84     *p = b->packets[b->start];
85     b->start = (b->start + 1) % b->size;
86 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d5/def/codec_8c_aa27710dac4f829dad6d007cf01bdf55f_icgraph}
\end{center}
\end{figure}


\hypertarget{codec_8c_a5990d0123726b7f12cebdae0984475b4}{\index{codec.\+c@{codec.\+c}!buffer\+\_\+write@{buffer\+\_\+write}}
\index{buffer\+\_\+write@{buffer\+\_\+write}!codec.\+c@{codec.\+c}}
\subsubsection[{buffer\+\_\+write}]{\setlength{\rightskip}{0pt plus 5cm}static void buffer\+\_\+write (
\begin{DoxyParamCaption}
\item[{{\bf Payload\+Buffer} $\ast$}]{b, }
\item[{Payload $\ast$}]{p}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{codec_8c_a5990d0123726b7f12cebdae0984475b4}


Definition at line 74 of file codec.\+c.



Referenced by queue\+\_\+message().


\begin{DoxyCode}
75 \{
76     b->packets[b->end] = p;
77     b->end = (b->end + 1) % b->size;
78 
79     if (b->end == b->start) b->start = (b->start + 1) % b->size; \textcolor{comment}{/* full, overwrite */}
80 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d5/def/codec_8c_a5990d0123726b7f12cebdae0984475b4_icgraph}
\end{center}
\end{figure}


\hypertarget{codec_8c_a478d9b52aca882a11b160e8bbb50dd74}{\index{codec.\+c@{codec.\+c}!cs\+\_\+do@{cs\+\_\+do}}
\index{cs\+\_\+do@{cs\+\_\+do}!codec.\+c@{codec.\+c}}
\subsubsection[{cs\+\_\+do}]{\setlength{\rightskip}{0pt plus 5cm}void cs\+\_\+do (
\begin{DoxyParamCaption}
\item[{{\bf C\+S\+Session} $\ast$}]{cs}
\end{DoxyParamCaption}
)}}\label{codec_8c_a478d9b52aca882a11b160e8bbb50dd74}
Call playback callbacks 

Definition at line 380 of file codec.\+c.



References \+\_\+\+C\+S\+Session\+::agent, \+\_\+\+C\+S\+Session\+::audio\+\_\+decoder, \+\_\+\+C\+S\+Session\+::audio\+\_\+decoder\+\_\+channels, \+\_\+\+C\+S\+Session\+::audio\+\_\+decoder\+\_\+frame\+\_\+duration, \+\_\+\+C\+S\+Session\+::audio\+\_\+decoder\+\_\+sample\+\_\+rate, buffer\+\_\+empty(), buffer\+\_\+read(), \+\_\+\+C\+S\+Session\+::call\+\_\+idx, \+\_\+\+R\+T\+P\+Message\+::data, \+\_\+\+C\+S\+Session\+::j\+\_\+buf, jbuf\+\_\+read(), \+\_\+\+R\+T\+P\+Message\+::length, L\+O\+G\+G\+E\+R\+\_\+\+E\+R\+R\+O\+R, L\+O\+G\+G\+E\+R\+\_\+\+W\+A\+R\+N\+I\+N\+G, M\+A\+X\+\_\+\+D\+E\+C\+O\+D\+E\+\_\+\+T\+I\+M\+E\+\_\+\+U\+S, \+\_\+\+C\+S\+Session\+::queue\+\_\+mutex, rtp\+\_\+free\+\_\+msg(), \+\_\+\+C\+S\+Session\+::v\+\_\+decoder, and \+\_\+\+C\+S\+Session\+::vbuf\+\_\+raw.



Referenced by toxav\+\_\+do().


\begin{DoxyCode}
381 \{
382     \textcolor{comment}{/* Codec session should always be protected by call mutex so no need to check for cs validity}
383 \textcolor{comment}{     */}
384 
385     \textcolor{keywordflow}{if} (!cs) \textcolor{keywordflow}{return};
386 
387     Payload *p;
388     \textcolor{keywordtype}{int} rc;
389 
390     \textcolor{keywordtype}{int} success = 0;
391 
392     pthread\_mutex\_lock(cs->\hyperlink{struct___c_s_session_aa1e20c410f3ec23066afb256fa3d1254}{queue\_mutex});
393     \hyperlink{struct___r_t_p_message}{RTPMessage} *msg;
394 
395     \textcolor{keywordflow}{while} ((msg = \hyperlink{codec_8c_a5d946ee1be34a637150e7204137f91ea}{jbuf\_read}(cs->\hyperlink{struct___c_s_session_a7567f0c621b65df3ff9e6f46164ac1c0}{j\_buf}, &success)) || success == 2) \{
396         pthread\_mutex\_unlock(cs->\hyperlink{struct___c_s_session_aa1e20c410f3ec23066afb256fa3d1254}{queue\_mutex});
397 
398         uint16\_t fsize = ((cs->\hyperlink{struct___c_s_session_a22979ca479f4d3e2660b604805a41833}{audio\_decoder\_sample\_rate} * cs->
      \hyperlink{struct___c_s_session_a245af4e824b82e6e91850ac26ace1230}{audio\_decoder\_frame\_duration}) / 1000);
399         int16\_t tmp[fsize * cs->\hyperlink{struct___c_s_session_a81fe9534366c7ea81e8ff6ac729d2ae9}{audio\_decoder\_channels}];
400 
401         \textcolor{keywordflow}{if} (success == 2) \{
402             rc = opus\_decode(cs->\hyperlink{struct___c_s_session_a3b9ee5ac4c354a3e31a8acf7aa1a1b6c}{audio\_decoder}, 0, 0, tmp, fsize, 1);
403         \} \textcolor{keywordflow}{else} \{
404             rc = opus\_decode(cs->\hyperlink{struct___c_s_session_a3b9ee5ac4c354a3e31a8acf7aa1a1b6c}{audio\_decoder}, msg->\hyperlink{struct___r_t_p_message_a89f8083b50c7cef74e96797bb74f8757}{data}, msg->
      \hyperlink{struct___r_t_p_message_aebb70c2aab3407a9f05334c47131a43b}{length}, tmp, fsize, 0);
405             \hyperlink{rtp_8c_a19cbf4e4c2831f2e162e7580bb7d5c7b}{rtp\_free\_msg}(NULL, msg);
406         \}
407 
408         \textcolor{keywordflow}{if} (rc < 0) \{
409             \hyperlink{logger_8h_ab3e970f3c1ecb5b71f17eccee4ebb286}{LOGGER\_WARNING}(\textcolor{stringliteral}{"Decoding error: %s"}, opus\_strerror(rc));
410         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (cs->acb.first) \{
411             \textcolor{comment}{/* Play */}
412             cs->acb.first(cs->\hyperlink{struct___c_s_session_a18e94ace0074984593ae281f6bbda315}{agent}, cs->\hyperlink{struct___c_s_session_ad6b287fd08a0cc466cd41bd2e76d5808}{call\_idx}, tmp, rc, cs->acb.second);
413         \}
414 
415         pthread\_mutex\_lock(cs->\hyperlink{struct___c_s_session_aa1e20c410f3ec23066afb256fa3d1254}{queue\_mutex});
416     \}
417 
418     \textcolor{keywordflow}{if} (cs->\hyperlink{struct___c_s_session_abb525d3cf1486064b35b5821a0646c86}{vbuf\_raw} && !\hyperlink{codec_8c_a6e1ec2c6aa4625da81486a73661df742}{buffer\_empty}(cs->\hyperlink{struct___c_s_session_abb525d3cf1486064b35b5821a0646c86}{vbuf\_raw})) \{
419         \textcolor{comment}{/* Decode video */}
420         \hyperlink{codec_8c_aa27710dac4f829dad6d007cf01bdf55f}{buffer\_read}(cs->\hyperlink{struct___c_s_session_abb525d3cf1486064b35b5821a0646c86}{vbuf\_raw}, &p);
421 
422         \textcolor{comment}{/* Leave space for (possibly) other thread to queue more data after we read it here */}
423         pthread\_mutex\_unlock(cs->\hyperlink{struct___c_s_session_aa1e20c410f3ec23066afb256fa3d1254}{queue\_mutex});
424 
425         rc = vpx\_codec\_decode(&cs->\hyperlink{struct___c_s_session_aa155f92243013193ef3fd9fd1b919bd0}{v\_decoder}, p->data, p->size, NULL, 
      \hyperlink{codec_8c_ad583b0b354b5a67760fb2af75610fae4}{MAX\_DECODE\_TIME\_US});
426         free(p);
427 
428         \textcolor{keywordflow}{if} (rc != VPX\_CODEC\_OK) \{
429             \hyperlink{logger_8h_aedad6a1e3ffe0d4cd0992b822ec0eeeb}{LOGGER\_ERROR}(\textcolor{stringliteral}{"Error decoding video: %s"}, vpx\_codec\_err\_to\_string(rc));
430         \} \textcolor{keywordflow}{else} \{
431             vpx\_codec\_iter\_t iter = NULL;
432             vpx\_image\_t *dest = vpx\_codec\_get\_frame(&cs->\hyperlink{struct___c_s_session_aa155f92243013193ef3fd9fd1b919bd0}{v\_decoder}, &iter);
433 
434             \textcolor{comment}{/* Play decoded images */}
435             \textcolor{keywordflow}{for} (; dest; dest = vpx\_codec\_get\_frame(&cs->\hyperlink{struct___c_s_session_aa155f92243013193ef3fd9fd1b919bd0}{v\_decoder}, &iter)) \{
436                 \textcolor{keywordflow}{if} (cs->vcb.first)
437                     cs->vcb.first(cs->\hyperlink{struct___c_s_session_a18e94ace0074984593ae281f6bbda315}{agent}, cs->\hyperlink{struct___c_s_session_ad6b287fd08a0cc466cd41bd2e76d5808}{call\_idx}, dest, cs->vcb.second);
438 
439                 vpx\_img\_free(dest);
440             \}
441         \}
442 
443         \textcolor{keywordflow}{return};
444     \}
445 
446     pthread\_mutex\_unlock(cs->\hyperlink{struct___c_s_session_aa1e20c410f3ec23066afb256fa3d1254}{queue\_mutex});
447 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=233pt]{d5/def/codec_8c_a478d9b52aca882a11b160e8bbb50dd74_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=331pt]{d5/def/codec_8c_a478d9b52aca882a11b160e8bbb50dd74_icgraph}
\end{center}
\end{figure}


\hypertarget{codec_8c_a61d7fe6f60a95160c4ca434a60cb9bf7}{\index{codec.\+c@{codec.\+c}!cs\+\_\+get\+\_\+split\+\_\+video\+\_\+frame@{cs\+\_\+get\+\_\+split\+\_\+video\+\_\+frame}}
\index{cs\+\_\+get\+\_\+split\+\_\+video\+\_\+frame@{cs\+\_\+get\+\_\+split\+\_\+video\+\_\+frame}!codec.\+c@{codec.\+c}}
\subsubsection[{cs\+\_\+get\+\_\+split\+\_\+video\+\_\+frame}]{\setlength{\rightskip}{0pt plus 5cm}const uint8\+\_\+t$\ast$ cs\+\_\+get\+\_\+split\+\_\+video\+\_\+frame (
\begin{DoxyParamCaption}
\item[{{\bf C\+S\+Session} $\ast$}]{cs, }
\item[{uint16\+\_\+t $\ast$}]{size}
\end{DoxyParamCaption}
)}}\label{codec_8c_a61d7fe6f60a95160c4ca434a60cb9bf7}


Definition at line 354 of file codec.\+c.



References \+\_\+\+C\+S\+Session\+::processing\+\_\+video\+\_\+frame, \+\_\+\+C\+S\+Session\+::processing\+\_\+video\+\_\+frame\+\_\+size, \+\_\+\+C\+S\+Session\+::split\+\_\+video\+\_\+frame, \+\_\+\+C\+S\+Session\+::video\+\_\+frame\+\_\+piece\+\_\+size, and V\+I\+D\+E\+O\+F\+R\+A\+M\+E\+\_\+\+H\+E\+A\+D\+E\+R\+\_\+\+S\+I\+Z\+E.



Referenced by toxav\+\_\+send\+\_\+rtp\+\_\+payload().


\begin{DoxyCode}
355 \{
356     \textcolor{keywordflow}{if} (!cs || !size) \textcolor{keywordflow}{return} NULL;
357 
358     \textcolor{keywordflow}{if} (cs->\hyperlink{struct___c_s_session_a7048faa402d6aecd2626ed85f352f5f2}{processing\_video\_frame\_size} > cs->
      \hyperlink{struct___c_s_session_af3563a0a96eb120a68e82d3135b6c49b}{video\_frame\_piece\_size}) \{
359         memcpy(cs->\hyperlink{struct___c_s_session_a100e5e445d6e9ff7775a1020dc780e56}{split\_video\_frame} + \hyperlink{codec_8c_a1fd042bb49704e3c68dea14ff6956b33}{VIDEOFRAME\_HEADER\_SIZE},
360                cs->\hyperlink{struct___c_s_session_ae94ea43be63edb42efe44edae585064e}{processing\_video\_frame},
361                cs->\hyperlink{struct___c_s_session_af3563a0a96eb120a68e82d3135b6c49b}{video\_frame\_piece\_size});
362 
363         cs->\hyperlink{struct___c_s_session_ae94ea43be63edb42efe44edae585064e}{processing\_video\_frame} += cs->
      \hyperlink{struct___c_s_session_af3563a0a96eb120a68e82d3135b6c49b}{video\_frame\_piece\_size};
364         cs->\hyperlink{struct___c_s_session_a7048faa402d6aecd2626ed85f352f5f2}{processing\_video\_frame\_size} -= cs->
      \hyperlink{struct___c_s_session_af3563a0a96eb120a68e82d3135b6c49b}{video\_frame\_piece\_size};
365 
366         *size = cs->\hyperlink{struct___c_s_session_af3563a0a96eb120a68e82d3135b6c49b}{video\_frame\_piece\_size} + 
      \hyperlink{codec_8c_a1fd042bb49704e3c68dea14ff6956b33}{VIDEOFRAME\_HEADER\_SIZE};
367     \} \textcolor{keywordflow}{else} \{
368         memcpy(cs->\hyperlink{struct___c_s_session_a100e5e445d6e9ff7775a1020dc780e56}{split\_video\_frame} + \hyperlink{codec_8c_a1fd042bb49704e3c68dea14ff6956b33}{VIDEOFRAME\_HEADER\_SIZE},
369                cs->\hyperlink{struct___c_s_session_ae94ea43be63edb42efe44edae585064e}{processing\_video\_frame},
370                cs->\hyperlink{struct___c_s_session_a7048faa402d6aecd2626ed85f352f5f2}{processing\_video\_frame\_size});
371 
372         *size = cs->\hyperlink{struct___c_s_session_a7048faa402d6aecd2626ed85f352f5f2}{processing\_video\_frame\_size} + 
      \hyperlink{codec_8c_a1fd042bb49704e3c68dea14ff6956b33}{VIDEOFRAME\_HEADER\_SIZE};
373     \}
374 
375     cs->\hyperlink{struct___c_s_session_a100e5e445d6e9ff7775a1020dc780e56}{split\_video\_frame}[1]++;
376 
377     \textcolor{keywordflow}{return} cs->\hyperlink{struct___c_s_session_a100e5e445d6e9ff7775a1020dc780e56}{split\_video\_frame};
378 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d5/def/codec_8c_a61d7fe6f60a95160c4ca434a60cb9bf7_icgraph}
\end{center}
\end{figure}


\hypertarget{codec_8c_addde6ea51851fcce009bb7d45147a88f}{\index{codec.\+c@{codec.\+c}!cs\+\_\+kill@{cs\+\_\+kill}}
\index{cs\+\_\+kill@{cs\+\_\+kill}!codec.\+c@{codec.\+c}}
\subsubsection[{cs\+\_\+kill}]{\setlength{\rightskip}{0pt plus 5cm}void cs\+\_\+kill (
\begin{DoxyParamCaption}
\item[{{\bf C\+S\+Session} $\ast$}]{cs}
\end{DoxyParamCaption}
)}}\label{codec_8c_addde6ea51851fcce009bb7d45147a88f}


Definition at line 584 of file codec.\+c.



References \+\_\+\+C\+S\+Session\+::audio\+\_\+decoder, \+\_\+\+C\+S\+Session\+::audio\+\_\+encoder, buffer\+\_\+free(), \+\_\+\+C\+S\+Session\+::capabilities, cs\+\_\+\+Video\+Decoding, cs\+\_\+\+Video\+Encoding, \+\_\+\+C\+S\+Session\+::frame\+\_\+buf, \+\_\+\+C\+S\+Session\+::j\+\_\+buf, jbuf\+\_\+free(), L\+O\+G\+G\+E\+R\+\_\+\+D\+E\+B\+U\+G, \+\_\+\+C\+S\+Session\+::queue\+\_\+mutex, \+\_\+\+C\+S\+Session\+::split\+\_\+video\+\_\+frame, \+\_\+\+C\+S\+Session\+::v\+\_\+decoder, \+\_\+\+C\+S\+Session\+::v\+\_\+encoder, and \+\_\+\+C\+S\+Session\+::vbuf\+\_\+raw.



Referenced by toxav\+\_\+kill(), toxav\+\_\+kill\+\_\+transmission(), and toxav\+\_\+prepare\+\_\+transmission().


\begin{DoxyCode}
585 \{
586     \textcolor{keywordflow}{if} (!cs) \textcolor{keywordflow}{return};
587 
588     \textcolor{comment}{/* queue\_message will not be called since it's unregistered before cs\_kill is called */}
589     pthread\_mutex\_destroy(cs->\hyperlink{struct___c_s_session_aa1e20c410f3ec23066afb256fa3d1254}{queue\_mutex});
590 
591 
592     \textcolor{keywordflow}{if} ( cs->\hyperlink{struct___c_s_session_a8c1fa3d73f3426ba5cac83857c390ebc}{audio\_encoder} )
593         opus\_encoder\_destroy(cs->\hyperlink{struct___c_s_session_a8c1fa3d73f3426ba5cac83857c390ebc}{audio\_encoder});
594 
595     \textcolor{keywordflow}{if} ( cs->\hyperlink{struct___c_s_session_a3b9ee5ac4c354a3e31a8acf7aa1a1b6c}{audio\_decoder} )
596         opus\_decoder\_destroy(cs->\hyperlink{struct___c_s_session_a3b9ee5ac4c354a3e31a8acf7aa1a1b6c}{audio\_decoder});
597 
598     \textcolor{keywordflow}{if} ( cs->\hyperlink{struct___c_s_session_ac9e675ead9b3559ea462414a0016f6a6}{capabilities} & \hyperlink{codec_8h_a9ad0f479beeeb19d00d4ce7063bed6dea7645328bfd892605b61a8548b902e3b8}{cs\_VideoDecoding} )
599         vpx\_codec\_destroy(&cs->\hyperlink{struct___c_s_session_aa155f92243013193ef3fd9fd1b919bd0}{v\_decoder});
600 
601     \textcolor{keywordflow}{if} ( cs->\hyperlink{struct___c_s_session_ac9e675ead9b3559ea462414a0016f6a6}{capabilities} & \hyperlink{codec_8h_a9ad0f479beeeb19d00d4ce7063bed6dea6a5a203bfa4ccde530809a3f11d4bb73}{cs\_VideoEncoding} )
602         vpx\_codec\_destroy(&cs->\hyperlink{struct___c_s_session_a0ec480a7314c0f185ae18f411d73b1bd}{v\_encoder});
603 
604     \hyperlink{codec_8c_ac44be2f075777b2461178608c0efb36c}{jbuf\_free}(cs->\hyperlink{struct___c_s_session_a7567f0c621b65df3ff9e6f46164ac1c0}{j\_buf});
605     \hyperlink{codec_8c_a30114dcdaee5519093e2ff87708c92ed}{buffer\_free}(cs->\hyperlink{struct___c_s_session_abb525d3cf1486064b35b5821a0646c86}{vbuf\_raw});
606     free(cs->\hyperlink{struct___c_s_session_aa4046ccf60d85f4f486ae0b24e3347f5}{frame\_buf});
607     free(cs->\hyperlink{struct___c_s_session_a100e5e445d6e9ff7775a1020dc780e56}{split\_video\_frame});
608 
609     \hyperlink{logger_8h_a9885ca09ce5f94d936c91a5b0856a024}{LOGGER\_DEBUG}(\textcolor{stringliteral}{"Terminated codec state: %p"}, cs);
610     free(cs);
611 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d5/def/codec_8c_addde6ea51851fcce009bb7d45147a88f_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d5/def/codec_8c_addde6ea51851fcce009bb7d45147a88f_icgraph}
\end{center}
\end{figure}


\hypertarget{codec_8c_aa99953343ed26c4b7914cac072ff95c1}{\index{codec.\+c@{codec.\+c}!cs\+\_\+new@{cs\+\_\+new}}
\index{cs\+\_\+new@{cs\+\_\+new}!codec.\+c@{codec.\+c}}
\subsubsection[{cs\+\_\+new}]{\setlength{\rightskip}{0pt plus 5cm}{\bf C\+S\+Session}$\ast$ cs\+\_\+new (
\begin{DoxyParamCaption}
\item[{const {\bf Tox\+Av\+C\+Settings} $\ast$}]{cs\+\_\+self, }
\item[{const {\bf Tox\+Av\+C\+Settings} $\ast$}]{cs\+\_\+peer, }
\item[{uint32\+\_\+t}]{jbuf\+\_\+size, }
\item[{int}]{has\+\_\+video}
\end{DoxyParamCaption}
)}}\label{codec_8c_aa99953343ed26c4b7914cac072ff95c1}


Definition at line 501 of file codec.\+c.



References \+\_\+\+Tox\+Av\+C\+Settings\+::audio\+\_\+bitrate, \+\_\+\+Tox\+Av\+C\+Settings\+::audio\+\_\+channels, \+\_\+\+C\+S\+Session\+::audio\+\_\+decoder, \+\_\+\+C\+S\+Session\+::audio\+\_\+decoder\+\_\+bitrate, \+\_\+\+C\+S\+Session\+::audio\+\_\+decoder\+\_\+channels, \+\_\+\+C\+S\+Session\+::audio\+\_\+decoder\+\_\+frame\+\_\+duration, \+\_\+\+C\+S\+Session\+::audio\+\_\+decoder\+\_\+sample\+\_\+rate, \+\_\+\+C\+S\+Session\+::audio\+\_\+encoder, \+\_\+\+C\+S\+Session\+::audio\+\_\+encoder\+\_\+bitrate, \+\_\+\+C\+S\+Session\+::audio\+\_\+encoder\+\_\+channels, \+\_\+\+C\+S\+Session\+::audio\+\_\+encoder\+\_\+frame\+\_\+duration, \+\_\+\+C\+S\+Session\+::audio\+\_\+encoder\+\_\+sample\+\_\+rate, \+\_\+\+Tox\+Av\+C\+Settings\+::audio\+\_\+frame\+\_\+duration, \+\_\+\+Tox\+Av\+C\+Settings\+::audio\+\_\+sample\+\_\+rate, buffer\+\_\+free(), buffer\+\_\+new(), \+\_\+\+C\+S\+Session\+::capabilities, create\+\_\+recursive\+\_\+mutex(), cs\+\_\+\+Audio\+Decoding, cs\+\_\+\+Audio\+Encoding, cs\+\_\+\+Video\+Decoding, cs\+\_\+\+Video\+Encoding, error, \+\_\+\+C\+S\+Session\+::frame\+\_\+buf, init\+\_\+audio\+\_\+decoder(), init\+\_\+audio\+\_\+encoder(), init\+\_\+video\+\_\+decoder(), init\+\_\+video\+\_\+encoder(), \+\_\+\+C\+S\+Session\+::j\+\_\+buf, jbuf\+\_\+free(), jbuf\+\_\+new(), L\+O\+G\+G\+E\+R\+\_\+\+W\+A\+R\+N\+I\+N\+G, \+\_\+\+C\+S\+Session\+::max\+\_\+video\+\_\+frame\+\_\+size, \+\_\+\+Tox\+Av\+C\+Settings\+::max\+\_\+video\+\_\+height, \+\_\+\+Tox\+Av\+C\+Settings\+::max\+\_\+video\+\_\+width, M\+A\+X\+\_\+\+V\+I\+D\+E\+O\+F\+R\+A\+M\+E\+\_\+\+S\+I\+Z\+E, \+\_\+\+C\+S\+Session\+::queue\+\_\+mutex, \+\_\+\+C\+S\+Session\+::split\+\_\+video\+\_\+frame, \+\_\+\+C\+S\+Session\+::support\+\_\+video, \+\_\+\+C\+S\+Session\+::v\+\_\+decoder, \+\_\+\+C\+S\+Session\+::v\+\_\+encoder, \+\_\+\+C\+S\+Session\+::vbuf\+\_\+raw, \+\_\+\+Tox\+Av\+C\+Settings\+::video\+\_\+bitrate, V\+I\+D\+E\+O\+\_\+\+D\+E\+C\+O\+D\+E\+\_\+\+B\+U\+F\+F\+E\+R\+\_\+\+S\+I\+Z\+E, \+\_\+\+C\+S\+Session\+::video\+\_\+frame\+\_\+piece\+\_\+size, V\+I\+D\+E\+O\+F\+R\+A\+M\+E\+\_\+\+H\+E\+A\+D\+E\+R\+\_\+\+S\+I\+Z\+E, and V\+I\+D\+E\+O\+F\+R\+A\+M\+E\+\_\+\+P\+I\+E\+C\+E\+\_\+\+S\+I\+Z\+E.



Referenced by toxav\+\_\+prepare\+\_\+transmission().


\begin{DoxyCode}
502 \{
503     \hyperlink{struct___c_s_session}{CSSession} *cs = calloc(\textcolor{keyword}{sizeof}(\hyperlink{struct___c_s_session}{CSSession}), 1);
504 
505     \textcolor{keywordflow}{if} (!cs) \{
506         \hyperlink{logger_8h_ab3e970f3c1ecb5b71f17eccee4ebb286}{LOGGER\_WARNING}(\textcolor{stringliteral}{"Allocation failed! Application might misbehave!"});
507         \textcolor{keywordflow}{return} NULL;
508     \}
509 
510     \textcolor{keywordflow}{if} (\hyperlink{util_8c_a2f0ae269c015342e2d29a251237ccce2}{create\_recursive\_mutex}(cs->\hyperlink{struct___c_s_session_aa1e20c410f3ec23066afb256fa3d1254}{queue\_mutex}) != 0) \{
511         \hyperlink{logger_8h_ab3e970f3c1ecb5b71f17eccee4ebb286}{LOGGER\_WARNING}(\textcolor{stringliteral}{"Failed to create recursive mutex!"});
512         free(cs);
513         \textcolor{keywordflow}{return} NULL;
514     \}
515 
516     \textcolor{keywordflow}{if} ( !(cs->\hyperlink{struct___c_s_session_a7567f0c621b65df3ff9e6f46164ac1c0}{j\_buf} = \hyperlink{codec_8c_a2c648daf423442a3f58d3f1386e9dd95}{jbuf\_new}(jbuf\_size)) ) \{
517         \hyperlink{logger_8h_ab3e970f3c1ecb5b71f17eccee4ebb286}{LOGGER\_WARNING}(\textcolor{stringliteral}{"Jitter buffer creaton failed!"});
518         \textcolor{keywordflow}{goto} \hyperlink{msi_8c_a7251f9a01631fc788dd7c8eff23a422ead606e435413ea0944dd00d49e901e4ed}{error};
519     \}
520 
521     cs->\hyperlink{struct___c_s_session_a8951572b99eec737269f5de96f9c5320}{audio\_encoder\_bitrate}        = cs\_self->
      \hyperlink{struct___tox_av_c_settings_a5d9a8b59b2eb1eef8dbdcb032bf1dd01}{audio\_bitrate};
522     cs->\hyperlink{struct___c_s_session_ae40829dc4300d79d3b175c8770b769a4}{audio\_encoder\_sample\_rate}    = cs\_self->
      \hyperlink{struct___tox_av_c_settings_a66da4482e934a2700e07a39fa0838559}{audio\_sample\_rate};
523     cs->\hyperlink{struct___c_s_session_a8ee56e2e7543722415f21dcc3ace1899}{audio\_encoder\_channels}       = cs\_self->
      \hyperlink{struct___tox_av_c_settings_a1b04e9669a2929f425e867440b6d826d}{audio\_channels};
524     cs->\hyperlink{struct___c_s_session_a25f8c6ef812a7edaaadb81b41f8d818d}{audio\_encoder\_frame\_duration} = cs\_self->
      \hyperlink{struct___tox_av_c_settings_a61b592233f5a65705eb2600d38e365cd}{audio\_frame\_duration};
525 
526     cs->\hyperlink{struct___c_s_session_a56e0bd5af866e6ba91078960083ac801}{audio\_decoder\_bitrate}        = cs\_peer->
      \hyperlink{struct___tox_av_c_settings_a5d9a8b59b2eb1eef8dbdcb032bf1dd01}{audio\_bitrate};
527     cs->\hyperlink{struct___c_s_session_a22979ca479f4d3e2660b604805a41833}{audio\_decoder\_sample\_rate}    = cs\_peer->
      \hyperlink{struct___tox_av_c_settings_a66da4482e934a2700e07a39fa0838559}{audio\_sample\_rate};
528     cs->\hyperlink{struct___c_s_session_a81fe9534366c7ea81e8ff6ac729d2ae9}{audio\_decoder\_channels}       = cs\_peer->
      \hyperlink{struct___tox_av_c_settings_a1b04e9669a2929f425e867440b6d826d}{audio\_channels};
529     cs->\hyperlink{struct___c_s_session_a245af4e824b82e6e91850ac26ace1230}{audio\_decoder\_frame\_duration} = cs\_peer->
      \hyperlink{struct___tox_av_c_settings_a61b592233f5a65705eb2600d38e365cd}{audio\_frame\_duration};
530 
531 
532     cs->\hyperlink{struct___c_s_session_ac9e675ead9b3559ea462414a0016f6a6}{capabilities} |= ( 0 == \hyperlink{codec_8c_a9d09ec5d699f16689b64699d10acee5c}{init\_audio\_encoder}(cs) ) ? 
      \hyperlink{codec_8h_a9ad0f479beeeb19d00d4ce7063bed6deaa87f50fffc6da5bfe0ebf1109bc3d043}{cs\_AudioEncoding} : 0;
533     cs->\hyperlink{struct___c_s_session_ac9e675ead9b3559ea462414a0016f6a6}{capabilities} |= ( 0 == \hyperlink{codec_8c_a731be97412f688f88f08b3734d762616}{init\_audio\_decoder}(cs) ) ? 
      \hyperlink{codec_8h_a9ad0f479beeeb19d00d4ce7063bed6dea1b08f39af3d00cdd95084db9920f28c4}{cs\_AudioDecoding} : 0;
534 
535     \textcolor{keywordflow}{if} ( !(cs->\hyperlink{struct___c_s_session_ac9e675ead9b3559ea462414a0016f6a6}{capabilities} & \hyperlink{codec_8h_a9ad0f479beeeb19d00d4ce7063bed6deaa87f50fffc6da5bfe0ebf1109bc3d043}{cs\_AudioEncoding}) || !(cs->
      \hyperlink{struct___c_s_session_ac9e675ead9b3559ea462414a0016f6a6}{capabilities} & \hyperlink{codec_8h_a9ad0f479beeeb19d00d4ce7063bed6dea1b08f39af3d00cdd95084db9920f28c4}{cs\_AudioDecoding}) ) \textcolor{keywordflow}{goto} \hyperlink{msi_8c_a7251f9a01631fc788dd7c8eff23a422ead606e435413ea0944dd00d49e901e4ed}{error};
536 
537     \textcolor{keywordflow}{if} ((cs->\hyperlink{struct___c_s_session_a269c7451109b710b39367a8ef63afce9}{support\_video} = has\_video)) \{
538         cs->\hyperlink{struct___c_s_session_a4de5a61c775468baabb35e2fcfaaa3a2}{max\_video\_frame\_size} = \hyperlink{codec_8c_a7932455292fb6bc8d18f5baa12fc7b3f}{MAX\_VIDEOFRAME\_SIZE};
539         cs->\hyperlink{struct___c_s_session_af3563a0a96eb120a68e82d3135b6c49b}{video\_frame\_piece\_size} = \hyperlink{codec_8c_ab2a08a350c695492c3b5b15bec8445e3}{VIDEOFRAME\_PIECE\_SIZE};
540 
541         cs->\hyperlink{struct___c_s_session_ac9e675ead9b3559ea462414a0016f6a6}{capabilities} |= ( 0 == \hyperlink{codec_8c_ab07ecfbcd82777c995c23e3fe70f6a2b}{init\_video\_encoder}(cs, cs\_self->
      \hyperlink{struct___tox_av_c_settings_ab81ecded1f7c46e120c8f2afa7b2c5cc}{max\_video\_width},
542                               cs\_self->\hyperlink{struct___tox_av_c_settings_a4fef4b2fa1a8ae8446314ad0af4ce698}{max\_video\_height}, cs\_self->
      \hyperlink{struct___tox_av_c_settings_af0eac99d4181795e8a595d244e745192}{video\_bitrate}) ) ? \hyperlink{codec_8h_a9ad0f479beeeb19d00d4ce7063bed6dea6a5a203bfa4ccde530809a3f11d4bb73}{cs\_VideoEncoding} : 0;
543         cs->\hyperlink{struct___c_s_session_ac9e675ead9b3559ea462414a0016f6a6}{capabilities} |= ( 0 == \hyperlink{codec_8c_a33bcb63c2ad472f689ed1c2c99a153ff}{init\_video\_decoder}(cs) ) ? 
      \hyperlink{codec_8h_a9ad0f479beeeb19d00d4ce7063bed6dea7645328bfd892605b61a8548b902e3b8}{cs\_VideoDecoding} : 0;
544 
545         \textcolor{keywordflow}{if} ( !(cs->\hyperlink{struct___c_s_session_ac9e675ead9b3559ea462414a0016f6a6}{capabilities} & \hyperlink{codec_8h_a9ad0f479beeeb19d00d4ce7063bed6dea6a5a203bfa4ccde530809a3f11d4bb73}{cs\_VideoEncoding}) || !(cs->
      \hyperlink{struct___c_s_session_ac9e675ead9b3559ea462414a0016f6a6}{capabilities} & \hyperlink{codec_8h_a9ad0f479beeeb19d00d4ce7063bed6dea7645328bfd892605b61a8548b902e3b8}{cs\_VideoDecoding}) ) \textcolor{keywordflow}{goto} \hyperlink{msi_8c_a7251f9a01631fc788dd7c8eff23a422ead606e435413ea0944dd00d49e901e4ed}{error};
546 
547         \textcolor{keywordflow}{if} ( !(cs->\hyperlink{struct___c_s_session_aa4046ccf60d85f4f486ae0b24e3347f5}{frame\_buf} = calloc(cs->\hyperlink{struct___c_s_session_a4de5a61c775468baabb35e2fcfaaa3a2}{max\_video\_frame\_size}, 1)) ) \textcolor{keywordflow}{goto} 
      \hyperlink{msi_8c_a7251f9a01631fc788dd7c8eff23a422ead606e435413ea0944dd00d49e901e4ed}{error};
548 
549         \textcolor{keywordflow}{if} ( !(cs->\hyperlink{struct___c_s_session_a100e5e445d6e9ff7775a1020dc780e56}{split\_video\_frame} = calloc(cs->
      \hyperlink{struct___c_s_session_af3563a0a96eb120a68e82d3135b6c49b}{video\_frame\_piece\_size} + \hyperlink{codec_8c_a1fd042bb49704e3c68dea14ff6956b33}{VIDEOFRAME\_HEADER\_SIZE}, 1)) )
550             \textcolor{keywordflow}{goto} \hyperlink{msi_8c_a7251f9a01631fc788dd7c8eff23a422ead606e435413ea0944dd00d49e901e4ed}{error};
551 
552         \textcolor{keywordflow}{if} ( !(cs->\hyperlink{struct___c_s_session_abb525d3cf1486064b35b5821a0646c86}{vbuf\_raw} = \hyperlink{codec_8c_acf8378036663935ba4186b5b24474a65}{buffer\_new}(
      \hyperlink{codec_8c_a861904c6cbceb168142459076d189f14}{VIDEO\_DECODE\_BUFFER\_SIZE})) ) \textcolor{keywordflow}{goto} \hyperlink{msi_8c_a7251f9a01631fc788dd7c8eff23a422ead606e435413ea0944dd00d49e901e4ed}{error};
553     \}
554 
555     \textcolor{keywordflow}{return} cs;
556 
557 \hyperlink{msi_8c_a7251f9a01631fc788dd7c8eff23a422ead606e435413ea0944dd00d49e901e4ed}{error}:
558     \hyperlink{logger_8h_ab3e970f3c1ecb5b71f17eccee4ebb286}{LOGGER\_WARNING}(\textcolor{stringliteral}{"Error initializing codec session! Application might misbehave!"});
559 
560     pthread\_mutex\_destroy(cs->\hyperlink{struct___c_s_session_aa1e20c410f3ec23066afb256fa3d1254}{queue\_mutex});
561 
562     \textcolor{keywordflow}{if} ( cs->\hyperlink{struct___c_s_session_a8c1fa3d73f3426ba5cac83857c390ebc}{audio\_encoder} ) opus\_encoder\_destroy(cs->\hyperlink{struct___c_s_session_a8c1fa3d73f3426ba5cac83857c390ebc}{audio\_encoder});
563 
564     \textcolor{keywordflow}{if} ( cs->\hyperlink{struct___c_s_session_a3b9ee5ac4c354a3e31a8acf7aa1a1b6c}{audio\_decoder} ) opus\_decoder\_destroy(cs->\hyperlink{struct___c_s_session_a3b9ee5ac4c354a3e31a8acf7aa1a1b6c}{audio\_decoder});
565 
566 
567     \textcolor{keywordflow}{if} (has\_video) \{
568         \textcolor{keywordflow}{if} ( cs->\hyperlink{struct___c_s_session_ac9e675ead9b3559ea462414a0016f6a6}{capabilities} & \hyperlink{codec_8h_a9ad0f479beeeb19d00d4ce7063bed6dea7645328bfd892605b61a8548b902e3b8}{cs\_VideoDecoding} ) vpx\_codec\_destroy(&cs->
      \hyperlink{struct___c_s_session_aa155f92243013193ef3fd9fd1b919bd0}{v\_decoder});
569 
570         \textcolor{keywordflow}{if} ( cs->\hyperlink{struct___c_s_session_ac9e675ead9b3559ea462414a0016f6a6}{capabilities} & \hyperlink{codec_8h_a9ad0f479beeeb19d00d4ce7063bed6dea6a5a203bfa4ccde530809a3f11d4bb73}{cs\_VideoEncoding} ) vpx\_codec\_destroy(&cs->
      \hyperlink{struct___c_s_session_a0ec480a7314c0f185ae18f411d73b1bd}{v\_encoder});
571 
572         \hyperlink{codec_8c_a30114dcdaee5519093e2ff87708c92ed}{buffer\_free}(cs->\hyperlink{struct___c_s_session_abb525d3cf1486064b35b5821a0646c86}{vbuf\_raw});
573 
574         free(cs->\hyperlink{struct___c_s_session_aa4046ccf60d85f4f486ae0b24e3347f5}{frame\_buf});
575         free(cs->\hyperlink{struct___c_s_session_a100e5e445d6e9ff7775a1020dc780e56}{split\_video\_frame});
576     \}
577 
578     \hyperlink{codec_8c_ac44be2f075777b2461178608c0efb36c}{jbuf\_free}(cs->\hyperlink{struct___c_s_session_a7567f0c621b65df3ff9e6f46164ac1c0}{j\_buf});
579     free(cs);
580 
581     \textcolor{keywordflow}{return} NULL;
582 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d5/def/codec_8c_aa99953343ed26c4b7914cac072ff95c1_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d5/def/codec_8c_aa99953343ed26c4b7914cac072ff95c1_icgraph}
\end{center}
\end{figure}


\hypertarget{codec_8c_ad5d2ffe3cd2dad642c722765639159e2}{\index{codec.\+c@{codec.\+c}!cs\+\_\+set\+\_\+video\+\_\+encoder\+\_\+bitrate@{cs\+\_\+set\+\_\+video\+\_\+encoder\+\_\+bitrate}}
\index{cs\+\_\+set\+\_\+video\+\_\+encoder\+\_\+bitrate@{cs\+\_\+set\+\_\+video\+\_\+encoder\+\_\+bitrate}!codec.\+c@{codec.\+c}}
\subsubsection[{cs\+\_\+set\+\_\+video\+\_\+encoder\+\_\+bitrate}]{\setlength{\rightskip}{0pt plus 5cm}int cs\+\_\+set\+\_\+video\+\_\+encoder\+\_\+bitrate (
\begin{DoxyParamCaption}
\item[{{\bf C\+S\+Session} $\ast$}]{cs, }
\item[{uint32\+\_\+t}]{video\+\_\+bitrate}
\end{DoxyParamCaption}
)}}\label{codec_8c_ad5d2ffe3cd2dad642c722765639159e2}


Definition at line 481 of file codec.\+c.



References cs\+\_\+\+Error\+Setting\+Video\+Bitrate, L\+O\+G\+G\+E\+R\+\_\+\+D\+E\+B\+U\+G, L\+O\+G\+G\+E\+R\+\_\+\+E\+R\+R\+O\+R, \+\_\+\+C\+S\+Session\+::v\+\_\+encoder, and \+\_\+\+C\+S\+Session\+::video\+\_\+bitrate.


\begin{DoxyCode}
482 \{
483     vpx\_codec\_enc\_cfg\_t cfg = *cs->\hyperlink{struct___c_s_session_a0ec480a7314c0f185ae18f411d73b1bd}{v\_encoder}.config.enc;
484 
485     \textcolor{keywordflow}{if} (cfg.rc\_target\_bitrate == video\_bitrate)
486         \textcolor{keywordflow}{return} 0;
487 
488     \hyperlink{logger_8h_a9885ca09ce5f94d936c91a5b0856a024}{LOGGER\_DEBUG}(\textcolor{stringliteral}{"New video bitrate: %u"}, video\_bitrate);
489     cfg.rc\_target\_bitrate = video\_bitrate;
490     \textcolor{keywordtype}{int} rc = vpx\_codec\_enc\_config\_set(&cs->\hyperlink{struct___c_s_session_a0ec480a7314c0f185ae18f411d73b1bd}{v\_encoder}, &cfg);
491 
492     \textcolor{keywordflow}{if} ( rc != VPX\_CODEC\_OK) \{
493         \hyperlink{logger_8h_aedad6a1e3ffe0d4cd0992b822ec0eeeb}{LOGGER\_ERROR}(\textcolor{stringliteral}{"Failed to set encoder control setting: %s"}, vpx\_codec\_err\_to\_string(rc));
494         \textcolor{keywordflow}{return} \hyperlink{codec_8h_a2452160d9e9ade8cd58a01ad61a5b6b2ae78b2b38fe3c75ee43165737192b1dad}{cs\_ErrorSettingVideoBitrate};
495     \}
496 
497     cs->\hyperlink{struct___c_s_session_acafa0ba061c3e09d3f17852abf830968}{video\_bitrate} = video\_bitrate;
498     \textcolor{keywordflow}{return} 0;
499 \}
\end{DoxyCode}
\hypertarget{codec_8c_a2c3fede54bd31b427fc5147cb450c714}{\index{codec.\+c@{codec.\+c}!cs\+\_\+set\+\_\+video\+\_\+encoder\+\_\+resolution@{cs\+\_\+set\+\_\+video\+\_\+encoder\+\_\+resolution}}
\index{cs\+\_\+set\+\_\+video\+\_\+encoder\+\_\+resolution@{cs\+\_\+set\+\_\+video\+\_\+encoder\+\_\+resolution}!codec.\+c@{codec.\+c}}
\subsubsection[{cs\+\_\+set\+\_\+video\+\_\+encoder\+\_\+resolution}]{\setlength{\rightskip}{0pt plus 5cm}int cs\+\_\+set\+\_\+video\+\_\+encoder\+\_\+resolution (
\begin{DoxyParamCaption}
\item[{{\bf C\+S\+Session} $\ast$}]{cs, }
\item[{uint16\+\_\+t}]{width, }
\item[{uint16\+\_\+t}]{height}
\end{DoxyParamCaption}
)}}\label{codec_8c_a2c3fede54bd31b427fc5147cb450c714}


Definition at line 449 of file codec.\+c.



References cs\+\_\+\+Error\+Setting\+Video\+Resolution, init\+\_\+video\+\_\+encoder(), L\+O\+G\+G\+E\+R\+\_\+\+D\+E\+B\+U\+G, L\+O\+G\+G\+E\+R\+\_\+\+E\+R\+R\+O\+R, \+\_\+\+C\+S\+Session\+::max\+\_\+height, \+\_\+\+C\+S\+Session\+::max\+\_\+width, \+\_\+\+C\+S\+Session\+::v\+\_\+encoder, and \+\_\+\+C\+S\+Session\+::video\+\_\+bitrate.



Referenced by toxav\+\_\+prepare\+\_\+video\+\_\+frame().


\begin{DoxyCode}
450 \{
451     vpx\_codec\_enc\_cfg\_t cfg = *cs->\hyperlink{struct___c_s_session_a0ec480a7314c0f185ae18f411d73b1bd}{v\_encoder}.config.enc;
452 
453     \textcolor{keywordflow}{if} (cfg.g\_w == width && cfg.g\_h == height)
454         \textcolor{keywordflow}{return} 0;
455 
456     \textcolor{keywordflow}{if} (width * height > cs->\hyperlink{struct___c_s_session_aa224a991c08c1d696a040a415d6a4a92}{max\_width} * cs->\hyperlink{struct___c_s_session_a3826471ddaa71d2730a6930625867bc1}{max\_height}) \{
457         vpx\_codec\_ctx\_t v\_encoder = cs->\hyperlink{struct___c_s_session_a0ec480a7314c0f185ae18f411d73b1bd}{v\_encoder};
458 
459         \textcolor{keywordflow}{if} (\hyperlink{codec_8c_ab07ecfbcd82777c995c23e3fe70f6a2b}{init\_video\_encoder}(cs, width, height, cs->
      \hyperlink{struct___c_s_session_acafa0ba061c3e09d3f17852abf830968}{video\_bitrate}) == -1) \{
460             cs->\hyperlink{struct___c_s_session_a0ec480a7314c0f185ae18f411d73b1bd}{v\_encoder} = v\_encoder;
461             \textcolor{keywordflow}{return} \hyperlink{codec_8h_a2452160d9e9ade8cd58a01ad61a5b6b2af1a6bea9022db13fcbb0fa1fa91b4639}{cs\_ErrorSettingVideoResolution};
462         \}
463 
464         vpx\_codec\_destroy(&v\_encoder);
465         \textcolor{keywordflow}{return} 0;
466     \}
467 
468     \hyperlink{logger_8h_a9885ca09ce5f94d936c91a5b0856a024}{LOGGER\_DEBUG}(\textcolor{stringliteral}{"New video resolution: %u %u"}, width, height);
469     cfg.g\_w = width;
470     cfg.g\_h = height;
471     \textcolor{keywordtype}{int} rc = vpx\_codec\_enc\_config\_set(&cs->\hyperlink{struct___c_s_session_a0ec480a7314c0f185ae18f411d73b1bd}{v\_encoder}, &cfg);
472 
473     \textcolor{keywordflow}{if} ( rc != VPX\_CODEC\_OK) \{
474         \hyperlink{logger_8h_aedad6a1e3ffe0d4cd0992b822ec0eeeb}{LOGGER\_ERROR}(\textcolor{stringliteral}{"Failed to set encoder control setting: %s"}, vpx\_codec\_err\_to\_string(rc));
475         \textcolor{keywordflow}{return} \hyperlink{codec_8h_a2452160d9e9ade8cd58a01ad61a5b6b2af1a6bea9022db13fcbb0fa1fa91b4639}{cs\_ErrorSettingVideoResolution};
476     \}
477 
478     \textcolor{keywordflow}{return} 0;
479 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=328pt]{d5/def/codec_8c_a2c3fede54bd31b427fc5147cb450c714_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=337pt]{d5/def/codec_8c_a2c3fede54bd31b427fc5147cb450c714_icgraph}
\end{center}
\end{figure}


\hypertarget{codec_8c_a5da4a305e711e7213dfcbe92d31d37bf}{\index{codec.\+c@{codec.\+c}!cs\+\_\+split\+\_\+video\+\_\+payload@{cs\+\_\+split\+\_\+video\+\_\+payload}}
\index{cs\+\_\+split\+\_\+video\+\_\+payload@{cs\+\_\+split\+\_\+video\+\_\+payload}!codec.\+c@{codec.\+c}}
\subsubsection[{cs\+\_\+split\+\_\+video\+\_\+payload}]{\setlength{\rightskip}{0pt plus 5cm}int cs\+\_\+split\+\_\+video\+\_\+payload (
\begin{DoxyParamCaption}
\item[{{\bf C\+S\+Session} $\ast$}]{cs, }
\item[{const uint8\+\_\+t $\ast$}]{payload, }
\item[{uint16\+\_\+t}]{length}
\end{DoxyParamCaption}
)}}\label{codec_8c_a5da4a305e711e7213dfcbe92d31d37bf}


Definition at line 339 of file codec.\+c.



References cs\+\_\+\+Error\+Splitting\+Video\+Payload, \+\_\+\+C\+S\+Session\+::frameid\+\_\+out, L\+O\+G\+G\+E\+R\+\_\+\+E\+R\+R\+O\+R, \+\_\+\+C\+S\+Session\+::max\+\_\+video\+\_\+frame\+\_\+size, \+\_\+\+C\+S\+Session\+::processing\+\_\+video\+\_\+frame, \+\_\+\+C\+S\+Session\+::processing\+\_\+video\+\_\+frame\+\_\+size, \+\_\+\+C\+S\+Session\+::split\+\_\+video\+\_\+frame, and \+\_\+\+C\+S\+Session\+::video\+\_\+frame\+\_\+piece\+\_\+size.



Referenced by toxav\+\_\+send\+\_\+rtp\+\_\+payload().


\begin{DoxyCode}
340 \{
341     \textcolor{keywordflow}{if} (!cs || !length || length > cs->\hyperlink{struct___c_s_session_a4de5a61c775468baabb35e2fcfaaa3a2}{max\_video\_frame\_size}) \{
342         \hyperlink{logger_8h_aedad6a1e3ffe0d4cd0992b822ec0eeeb}{LOGGER\_ERROR}(\textcolor{stringliteral}{"Invalid  CodecState or video frame size: %u"}, length);
343         \textcolor{keywordflow}{return} \hyperlink{codec_8h_a2452160d9e9ade8cd58a01ad61a5b6b2a70379b0a1ba1b8a9f513aa4133a09b05}{cs\_ErrorSplittingVideoPayload};
344     \}
345 
346     cs->\hyperlink{struct___c_s_session_a100e5e445d6e9ff7775a1020dc780e56}{split\_video\_frame}[0] = cs->\hyperlink{struct___c_s_session_acea7b9bf7e58ed8e24980edeaacecc25}{frameid\_out}++;
347     cs->\hyperlink{struct___c_s_session_a100e5e445d6e9ff7775a1020dc780e56}{split\_video\_frame}[1] = 0;
348     cs->\hyperlink{struct___c_s_session_ae94ea43be63edb42efe44edae585064e}{processing\_video\_frame} = payload;
349     cs->\hyperlink{struct___c_s_session_a7048faa402d6aecd2626ed85f352f5f2}{processing\_video\_frame\_size} = length;
350 
351     \textcolor{keywordflow}{return} ((length - 1) / cs->\hyperlink{struct___c_s_session_af3563a0a96eb120a68e82d3135b6c49b}{video\_frame\_piece\_size}) + 1;
352 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d5/def/codec_8c_a5da4a305e711e7213dfcbe92d31d37bf_icgraph}
\end{center}
\end{figure}


\hypertarget{codec_8c_a731be97412f688f88f08b3734d762616}{\index{codec.\+c@{codec.\+c}!init\+\_\+audio\+\_\+decoder@{init\+\_\+audio\+\_\+decoder}}
\index{init\+\_\+audio\+\_\+decoder@{init\+\_\+audio\+\_\+decoder}!codec.\+c@{codec.\+c}}
\subsubsection[{init\+\_\+audio\+\_\+decoder}]{\setlength{\rightskip}{0pt plus 5cm}static int init\+\_\+audio\+\_\+decoder (
\begin{DoxyParamCaption}
\item[{{\bf C\+S\+Session} $\ast$}]{cs}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{codec_8c_a731be97412f688f88f08b3734d762616}


Definition at line 239 of file codec.\+c.



References \+\_\+\+C\+S\+Session\+::audio\+\_\+decoder, \+\_\+\+C\+S\+Session\+::audio\+\_\+decoder\+\_\+channels, \+\_\+\+C\+S\+Session\+::audio\+\_\+decoder\+\_\+sample\+\_\+rate, and L\+O\+G\+G\+E\+R\+\_\+\+E\+R\+R\+O\+R.



Referenced by cs\+\_\+new().


\begin{DoxyCode}
240 \{
241     \textcolor{keywordtype}{int} rc;
242     cs->\hyperlink{struct___c_s_session_a3b9ee5ac4c354a3e31a8acf7aa1a1b6c}{audio\_decoder} = opus\_decoder\_create(cs->
      \hyperlink{struct___c_s_session_a22979ca479f4d3e2660b604805a41833}{audio\_decoder\_sample\_rate}, cs->\hyperlink{struct___c_s_session_a81fe9534366c7ea81e8ff6ac729d2ae9}{audio\_decoder\_channels}, &rc )
      ;
243 
244     \textcolor{keywordflow}{if} ( rc != OPUS\_OK ) \{
245         \hyperlink{logger_8h_aedad6a1e3ffe0d4cd0992b822ec0eeeb}{LOGGER\_ERROR}(\textcolor{stringliteral}{"Error while starting audio decoder: %s"}, opus\_strerror(rc));
246         \textcolor{keywordflow}{return} -1;
247     \}
248 
249     \textcolor{keywordflow}{return} 0;
250 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d5/def/codec_8c_a731be97412f688f88f08b3734d762616_icgraph}
\end{center}
\end{figure}


\hypertarget{codec_8c_a9d09ec5d699f16689b64699d10acee5c}{\index{codec.\+c@{codec.\+c}!init\+\_\+audio\+\_\+encoder@{init\+\_\+audio\+\_\+encoder}}
\index{init\+\_\+audio\+\_\+encoder@{init\+\_\+audio\+\_\+encoder}!codec.\+c@{codec.\+c}}
\subsubsection[{init\+\_\+audio\+\_\+encoder}]{\setlength{\rightskip}{0pt plus 5cm}static int init\+\_\+audio\+\_\+encoder (
\begin{DoxyParamCaption}
\item[{{\bf C\+S\+Session} $\ast$}]{cs}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{codec_8c_a9d09ec5d699f16689b64699d10acee5c}


Definition at line 293 of file codec.\+c.



References \+\_\+\+C\+S\+Session\+::audio\+\_\+encoder, \+\_\+\+C\+S\+Session\+::audio\+\_\+encoder\+\_\+bitrate, \+\_\+\+C\+S\+Session\+::audio\+\_\+encoder\+\_\+channels, \+\_\+\+C\+S\+Session\+::audio\+\_\+encoder\+\_\+sample\+\_\+rate, and L\+O\+G\+G\+E\+R\+\_\+\+E\+R\+R\+O\+R.



Referenced by cs\+\_\+new().


\begin{DoxyCode}
294 \{
295     \textcolor{keywordtype}{int} rc = OPUS\_OK;
296     cs->\hyperlink{struct___c_s_session_a8c1fa3d73f3426ba5cac83857c390ebc}{audio\_encoder} = opus\_encoder\_create(cs->
      \hyperlink{struct___c_s_session_ae40829dc4300d79d3b175c8770b769a4}{audio\_encoder\_sample\_rate},
297                                             cs->\hyperlink{struct___c_s_session_a8ee56e2e7543722415f21dcc3ace1899}{audio\_encoder\_channels}, 
      OPUS\_APPLICATION\_VOIP, &rc);
298 
299     \textcolor{keywordflow}{if} ( rc != OPUS\_OK ) \{
300         \hyperlink{logger_8h_aedad6a1e3ffe0d4cd0992b822ec0eeeb}{LOGGER\_ERROR}(\textcolor{stringliteral}{"Error while starting audio encoder: %s"}, opus\_strerror(rc));
301         \textcolor{keywordflow}{return} -1;
302     \}
303 
304     rc = opus\_encoder\_ctl(cs->\hyperlink{struct___c_s_session_a8c1fa3d73f3426ba5cac83857c390ebc}{audio\_encoder}, OPUS\_SET\_BITRATE(cs->
      \hyperlink{struct___c_s_session_a8951572b99eec737269f5de96f9c5320}{audio\_encoder\_bitrate}));
305 
306     \textcolor{keywordflow}{if} ( rc != OPUS\_OK ) \{
307         \hyperlink{logger_8h_aedad6a1e3ffe0d4cd0992b822ec0eeeb}{LOGGER\_ERROR}(\textcolor{stringliteral}{"Error while setting encoder ctl: %s"}, opus\_strerror(rc));
308         \textcolor{keywordflow}{return} -1;
309     \}
310 
311     \textcolor{comment}{/* Enable in-band forward error correction in codec */}
312     rc = opus\_encoder\_ctl(cs->\hyperlink{struct___c_s_session_a8c1fa3d73f3426ba5cac83857c390ebc}{audio\_encoder}, OPUS\_SET\_INBAND\_FEC(1));
313 
314     \textcolor{keywordflow}{if} ( rc != OPUS\_OK ) \{
315         \hyperlink{logger_8h_aedad6a1e3ffe0d4cd0992b822ec0eeeb}{LOGGER\_ERROR}(\textcolor{stringliteral}{"Error while setting encoder ctl: %s"}, opus\_strerror(rc));
316         \textcolor{keywordflow}{return} -1;
317     \}
318 
319     \textcolor{comment}{/* Make codec resistant to up to 10% packet loss */}
320     rc = opus\_encoder\_ctl(cs->\hyperlink{struct___c_s_session_a8c1fa3d73f3426ba5cac83857c390ebc}{audio\_encoder}, OPUS\_SET\_PACKET\_LOSS\_PERC(10));
321 
322     \textcolor{keywordflow}{if} ( rc != OPUS\_OK ) \{
323         \hyperlink{logger_8h_aedad6a1e3ffe0d4cd0992b822ec0eeeb}{LOGGER\_ERROR}(\textcolor{stringliteral}{"Error while setting encoder ctl: %s"}, opus\_strerror(rc));
324         \textcolor{keywordflow}{return} -1;
325     \}
326 
327     \textcolor{comment}{/* Set algorithm to the highest complexity, maximizing compression */}
328     rc = opus\_encoder\_ctl(cs->\hyperlink{struct___c_s_session_a8c1fa3d73f3426ba5cac83857c390ebc}{audio\_encoder}, OPUS\_SET\_COMPLEXITY(10));
329 
330     \textcolor{keywordflow}{if} ( rc != OPUS\_OK ) \{
331         \hyperlink{logger_8h_aedad6a1e3ffe0d4cd0992b822ec0eeeb}{LOGGER\_ERROR}(\textcolor{stringliteral}{"Error while setting encoder ctl: %s"}, opus\_strerror(rc));
332         \textcolor{keywordflow}{return} -1;
333     \}
334 
335     \textcolor{keywordflow}{return} 0;
336 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d5/def/codec_8c_a9d09ec5d699f16689b64699d10acee5c_icgraph}
\end{center}
\end{figure}


\hypertarget{codec_8c_a33bcb63c2ad472f689ed1c2c99a153ff}{\index{codec.\+c@{codec.\+c}!init\+\_\+video\+\_\+decoder@{init\+\_\+video\+\_\+decoder}}
\index{init\+\_\+video\+\_\+decoder@{init\+\_\+video\+\_\+decoder}!codec.\+c@{codec.\+c}}
\subsubsection[{init\+\_\+video\+\_\+decoder}]{\setlength{\rightskip}{0pt plus 5cm}static int init\+\_\+video\+\_\+decoder (
\begin{DoxyParamCaption}
\item[{{\bf C\+S\+Session} $\ast$}]{cs}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{codec_8c_a33bcb63c2ad472f689ed1c2c99a153ff}


Definition at line 227 of file codec.\+c.



References L\+O\+G\+G\+E\+R\+\_\+\+E\+R\+R\+O\+R, \+\_\+\+C\+S\+Session\+::v\+\_\+decoder, and V\+I\+D\+E\+O\+\_\+\+C\+O\+D\+E\+C\+\_\+\+D\+E\+C\+O\+D\+E\+R\+\_\+\+I\+N\+T\+E\+R\+F\+A\+C\+E.



Referenced by cs\+\_\+new().


\begin{DoxyCode}
228 \{
229     \textcolor{keywordtype}{int} rc = vpx\_codec\_dec\_init\_ver(&cs->\hyperlink{struct___c_s_session_aa155f92243013193ef3fd9fd1b919bd0}{v\_decoder}, 
      \hyperlink{codec_8h_a504d1d3982cd24ce5d5bf43340b65707}{VIDEO\_CODEC\_DECODER\_INTERFACE}, NULL, 0, VPX\_DECODER\_ABI\_VERSION);
230 
231     \textcolor{keywordflow}{if} ( rc != VPX\_CODEC\_OK) \{
232         \hyperlink{logger_8h_aedad6a1e3ffe0d4cd0992b822ec0eeeb}{LOGGER\_ERROR}(\textcolor{stringliteral}{"Init video\_decoder failed: %s"}, vpx\_codec\_err\_to\_string(rc));
233         \textcolor{keywordflow}{return} -1;
234     \}
235 
236     \textcolor{keywordflow}{return} 0;
237 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d5/def/codec_8c_a33bcb63c2ad472f689ed1c2c99a153ff_icgraph}
\end{center}
\end{figure}


\hypertarget{codec_8c_ab07ecfbcd82777c995c23e3fe70f6a2b}{\index{codec.\+c@{codec.\+c}!init\+\_\+video\+\_\+encoder@{init\+\_\+video\+\_\+encoder}}
\index{init\+\_\+video\+\_\+encoder@{init\+\_\+video\+\_\+encoder}!codec.\+c@{codec.\+c}}
\subsubsection[{init\+\_\+video\+\_\+encoder}]{\setlength{\rightskip}{0pt plus 5cm}static int init\+\_\+video\+\_\+encoder (
\begin{DoxyParamCaption}
\item[{{\bf C\+S\+Session} $\ast$}]{cs, }
\item[{uint16\+\_\+t}]{max\+\_\+width, }
\item[{uint16\+\_\+t}]{max\+\_\+height, }
\item[{uint32\+\_\+t}]{video\+\_\+bitrate}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{codec_8c_ab07ecfbcd82777c995c23e3fe70f6a2b}


Definition at line 252 of file codec.\+c.



References L\+O\+G\+G\+E\+R\+\_\+\+E\+R\+R\+O\+R, \+\_\+\+C\+S\+Session\+::max\+\_\+height, \+\_\+\+C\+S\+Session\+::max\+\_\+width, \+\_\+\+C\+S\+Session\+::v\+\_\+encoder, \+\_\+\+C\+S\+Session\+::video\+\_\+bitrate, and V\+I\+D\+E\+O\+\_\+\+C\+O\+D\+E\+C\+\_\+\+E\+N\+C\+O\+D\+E\+R\+\_\+\+I\+N\+T\+E\+R\+F\+A\+C\+E.



Referenced by cs\+\_\+new(), and cs\+\_\+set\+\_\+video\+\_\+encoder\+\_\+resolution().


\begin{DoxyCode}
253 \{
254     vpx\_codec\_enc\_cfg\_t  cfg;
255     \textcolor{keywordtype}{int} rc = vpx\_codec\_enc\_config\_default(\hyperlink{codec_8h_aa9fe0e8c6e6c6696a0bdc7a49d0795cb}{VIDEO\_CODEC\_ENCODER\_INTERFACE}, &cfg,
       0);
256 
257     \textcolor{keywordflow}{if} (rc != VPX\_CODEC\_OK) \{
258         \hyperlink{logger_8h_aedad6a1e3ffe0d4cd0992b822ec0eeeb}{LOGGER\_ERROR}(\textcolor{stringliteral}{"Failed to get config: %s"}, vpx\_codec\_err\_to\_string(rc));
259         \textcolor{keywordflow}{return} -1;
260     \}
261 
262     cfg.rc\_target\_bitrate = video\_bitrate;
263     cfg.g\_w = max\_width;
264     cfg.g\_h = max\_height;
265     cfg.g\_pass = VPX\_RC\_ONE\_PASS;
266     cfg.g\_error\_resilient = VPX\_ERROR\_RESILIENT\_DEFAULT | VPX\_ERROR\_RESILIENT\_PARTITIONS;
267     cfg.g\_lag\_in\_frames = 0;
268     cfg.kf\_min\_dist = 0;
269     cfg.kf\_max\_dist = 48;
270     cfg.kf\_mode = VPX\_KF\_AUTO;
271 
272     rc = vpx\_codec\_enc\_init\_ver(&cs->\hyperlink{struct___c_s_session_a0ec480a7314c0f185ae18f411d73b1bd}{v\_encoder}, 
      \hyperlink{codec_8h_aa9fe0e8c6e6c6696a0bdc7a49d0795cb}{VIDEO\_CODEC\_ENCODER\_INTERFACE}, &cfg, 0, VPX\_ENCODER\_ABI\_VERSION);
273 
274     \textcolor{keywordflow}{if} ( rc != VPX\_CODEC\_OK) \{
275         \hyperlink{logger_8h_aedad6a1e3ffe0d4cd0992b822ec0eeeb}{LOGGER\_ERROR}(\textcolor{stringliteral}{"Failed to initialize encoder: %s"}, vpx\_codec\_err\_to\_string(rc));
276         \textcolor{keywordflow}{return} -1;
277     \}
278 
279     rc = vpx\_codec\_control(&cs->\hyperlink{struct___c_s_session_a0ec480a7314c0f185ae18f411d73b1bd}{v\_encoder}, VP8E\_SET\_CPUUSED, 8);
280 
281     \textcolor{keywordflow}{if} ( rc != VPX\_CODEC\_OK) \{
282         \hyperlink{logger_8h_aedad6a1e3ffe0d4cd0992b822ec0eeeb}{LOGGER\_ERROR}(\textcolor{stringliteral}{"Failed to set encoder control setting: %s"}, vpx\_codec\_err\_to\_string(rc));
283         \textcolor{keywordflow}{return} -1;
284     \}
285 
286     cs->\hyperlink{struct___c_s_session_aa224a991c08c1d696a040a415d6a4a92}{max\_width} = max\_width;
287     cs->\hyperlink{struct___c_s_session_a3826471ddaa71d2730a6930625867bc1}{max\_height} = max\_height;
288     cs->\hyperlink{struct___c_s_session_acafa0ba061c3e09d3f17852abf830968}{video\_bitrate} = video\_bitrate;
289 
290     \textcolor{keywordflow}{return} 0;
291 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d5/def/codec_8c_ab07ecfbcd82777c995c23e3fe70f6a2b_icgraph}
\end{center}
\end{figure}


\hypertarget{codec_8c_a2ab3636512ac576d996c504f9226108d}{\index{codec.\+c@{codec.\+c}!jbuf\+\_\+clear@{jbuf\+\_\+clear}}
\index{jbuf\+\_\+clear@{jbuf\+\_\+clear}!codec.\+c@{codec.\+c}}
\subsubsection[{jbuf\+\_\+clear}]{\setlength{\rightskip}{0pt plus 5cm}static void jbuf\+\_\+clear (
\begin{DoxyParamCaption}
\item[{{\bf Jitter\+Buffer} $\ast$}]{q}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{codec_8c_a2ab3636512ac576d996c504f9226108d}


Definition at line 153 of file codec.\+c.



References \+\_\+\+Jitter\+Buffer\+::bottom, \+\_\+\+Jitter\+Buffer\+::queue, rtp\+\_\+free\+\_\+msg(), \+\_\+\+Jitter\+Buffer\+::size, and \+\_\+\+Jitter\+Buffer\+::top.



Referenced by jbuf\+\_\+free(), and jbuf\+\_\+write().


\begin{DoxyCode}
154 \{
155     \textcolor{keywordflow}{for} (; q->\hyperlink{struct___jitter_buffer_a12c8099ac87952580dd090215e02728c}{bottom} != q->\hyperlink{struct___jitter_buffer_a0c235a6df98714bb18538fc0afc5bad1}{top}; ++q->\hyperlink{struct___jitter_buffer_a12c8099ac87952580dd090215e02728c}{bottom}) \{
156         \textcolor{keywordflow}{if} (q->\hyperlink{struct___jitter_buffer_aba0e7057fa735d7bfaa585fd7bf43a24}{queue}[q->\hyperlink{struct___jitter_buffer_a12c8099ac87952580dd090215e02728c}{bottom} % q->\hyperlink{struct___jitter_buffer_ab2c6b258f02add8fdf4cfc7c371dd772}{size}]) \{
157             \hyperlink{rtp_8c_a19cbf4e4c2831f2e162e7580bb7d5c7b}{rtp\_free\_msg}(NULL, q->\hyperlink{struct___jitter_buffer_aba0e7057fa735d7bfaa585fd7bf43a24}{queue}[q->\hyperlink{struct___jitter_buffer_a12c8099ac87952580dd090215e02728c}{bottom} % q->
      \hyperlink{struct___jitter_buffer_ab2c6b258f02add8fdf4cfc7c371dd772}{size}]);
158             q->\hyperlink{struct___jitter_buffer_aba0e7057fa735d7bfaa585fd7bf43a24}{queue}[q->\hyperlink{struct___jitter_buffer_a12c8099ac87952580dd090215e02728c}{bottom} % q->\hyperlink{struct___jitter_buffer_ab2c6b258f02add8fdf4cfc7c371dd772}{size}] = NULL;
159         \}
160     \}
161 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=249pt]{d5/def/codec_8c_a2ab3636512ac576d996c504f9226108d_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d5/def/codec_8c_a2ab3636512ac576d996c504f9226108d_icgraph}
\end{center}
\end{figure}


\hypertarget{codec_8c_ac44be2f075777b2461178608c0efb36c}{\index{codec.\+c@{codec.\+c}!jbuf\+\_\+free@{jbuf\+\_\+free}}
\index{jbuf\+\_\+free@{jbuf\+\_\+free}!codec.\+c@{codec.\+c}}
\subsubsection[{jbuf\+\_\+free}]{\setlength{\rightskip}{0pt plus 5cm}static void jbuf\+\_\+free (
\begin{DoxyParamCaption}
\item[{{\bf Jitter\+Buffer} $\ast$}]{q}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{codec_8c_ac44be2f075777b2461178608c0efb36c}


Definition at line 163 of file codec.\+c.



References jbuf\+\_\+clear(), and \+\_\+\+Jitter\+Buffer\+::queue.



Referenced by cs\+\_\+kill(), and cs\+\_\+new().


\begin{DoxyCode}
164 \{
165     \textcolor{keywordflow}{if} (!q) \textcolor{keywordflow}{return};
166 
167     \hyperlink{codec_8c_a2ab3636512ac576d996c504f9226108d}{jbuf\_clear}(q);
168     free(q->\hyperlink{struct___jitter_buffer_aba0e7057fa735d7bfaa585fd7bf43a24}{queue});
169     free(q);
170 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=339pt]{d5/def/codec_8c_ac44be2f075777b2461178608c0efb36c_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d5/def/codec_8c_ac44be2f075777b2461178608c0efb36c_icgraph}
\end{center}
\end{figure}


\hypertarget{codec_8c_a2c648daf423442a3f58d3f1386e9dd95}{\index{codec.\+c@{codec.\+c}!jbuf\+\_\+new@{jbuf\+\_\+new}}
\index{jbuf\+\_\+new@{jbuf\+\_\+new}!codec.\+c@{codec.\+c}}
\subsubsection[{jbuf\+\_\+new}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf Jitter\+Buffer}$\ast$ jbuf\+\_\+new (
\begin{DoxyParamCaption}
\item[{uint32\+\_\+t}]{capacity}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{codec_8c_a2c648daf423442a3f58d3f1386e9dd95}


Definition at line 131 of file codec.\+c.



References \+\_\+\+Jitter\+Buffer\+::capacity, \+\_\+\+Jitter\+Buffer\+::queue, and \+\_\+\+Jitter\+Buffer\+::size.



Referenced by cs\+\_\+new().


\begin{DoxyCode}
132 \{
133     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} size = 1;
134 
135     \textcolor{keywordflow}{while} (size <= (capacity * 4)) \{
136         size *= 2;
137     \}
138 
139     \hyperlink{struct___jitter_buffer}{JitterBuffer} *q;
140 
141     \textcolor{keywordflow}{if} ( !(q = calloc(\textcolor{keyword}{sizeof}(\hyperlink{struct___jitter_buffer}{JitterBuffer}), 1)) ) \textcolor{keywordflow}{return} NULL;
142 
143     \textcolor{keywordflow}{if} (!(q->\hyperlink{struct___jitter_buffer_aba0e7057fa735d7bfaa585fd7bf43a24}{queue} = calloc(\textcolor{keyword}{sizeof}(\hyperlink{struct___r_t_p_message}{RTPMessage} *), size))) \{
144         free(q);
145         \textcolor{keywordflow}{return} NULL;
146     \}
147 
148     q->\hyperlink{struct___jitter_buffer_ab2c6b258f02add8fdf4cfc7c371dd772}{size} = size;
149     q->\hyperlink{struct___jitter_buffer_a391c992c66c3e5540265a85ec2b9216a}{capacity} = capacity;
150     \textcolor{keywordflow}{return} q;
151 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d5/def/codec_8c_a2c648daf423442a3f58d3f1386e9dd95_icgraph}
\end{center}
\end{figure}


\hypertarget{codec_8c_a5d946ee1be34a637150e7204137f91ea}{\index{codec.\+c@{codec.\+c}!jbuf\+\_\+read@{jbuf\+\_\+read}}
\index{jbuf\+\_\+read@{jbuf\+\_\+read}!codec.\+c@{codec.\+c}}
\subsubsection[{jbuf\+\_\+read}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf R\+T\+P\+Message}$\ast$ jbuf\+\_\+read (
\begin{DoxyParamCaption}
\item[{{\bf Jitter\+Buffer} $\ast$}]{q, }
\item[{int32\+\_\+t $\ast$}]{success}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{codec_8c_a5d946ee1be34a637150e7204137f91ea}


Definition at line 200 of file codec.\+c.



References \+\_\+\+Jitter\+Buffer\+::bottom, \+\_\+\+Jitter\+Buffer\+::capacity, num, \+\_\+\+Jitter\+Buffer\+::queue, \+\_\+\+Jitter\+Buffer\+::size, and \+\_\+\+Jitter\+Buffer\+::top.



Referenced by cs\+\_\+do().


\begin{DoxyCode}
201 \{
202     \textcolor{keywordflow}{if} (q->\hyperlink{struct___jitter_buffer_a0c235a6df98714bb18538fc0afc5bad1}{top} == q->\hyperlink{struct___jitter_buffer_a12c8099ac87952580dd090215e02728c}{bottom}) \{
203         *success = 0;
204         \textcolor{keywordflow}{return} NULL;
205     \}
206 
207     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num} = q->\hyperlink{struct___jitter_buffer_a12c8099ac87952580dd090215e02728c}{bottom} % q->\hyperlink{struct___jitter_buffer_ab2c6b258f02add8fdf4cfc7c371dd772}{size};
208 
209     \textcolor{keywordflow}{if} (q->\hyperlink{struct___jitter_buffer_aba0e7057fa735d7bfaa585fd7bf43a24}{queue}[num]) \{
210         \hyperlink{struct___r_t_p_message}{RTPMessage} *ret = q->\hyperlink{struct___jitter_buffer_aba0e7057fa735d7bfaa585fd7bf43a24}{queue}[\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num}];
211         q->\hyperlink{struct___jitter_buffer_aba0e7057fa735d7bfaa585fd7bf43a24}{queue}[\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num}] = NULL;
212         ++q->\hyperlink{struct___jitter_buffer_a12c8099ac87952580dd090215e02728c}{bottom};
213         *success = 1;
214         \textcolor{keywordflow}{return} ret;
215     \}
216 
217     \textcolor{keywordflow}{if} ((uint32\_t)(q->\hyperlink{struct___jitter_buffer_a0c235a6df98714bb18538fc0afc5bad1}{top} - q->\hyperlink{struct___jitter_buffer_a12c8099ac87952580dd090215e02728c}{bottom}) > q->\hyperlink{struct___jitter_buffer_a391c992c66c3e5540265a85ec2b9216a}{capacity}) \{
218         ++q->\hyperlink{struct___jitter_buffer_a12c8099ac87952580dd090215e02728c}{bottom};
219         *success = 2;
220         \textcolor{keywordflow}{return} NULL;
221     \}
222 
223     *success = 0;
224     \textcolor{keywordflow}{return} NULL;
225 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d5/def/codec_8c_a5d946ee1be34a637150e7204137f91ea_icgraph}
\end{center}
\end{figure}


\hypertarget{codec_8c_a170dd2e497101775eea8695dbda58f9e}{\index{codec.\+c@{codec.\+c}!jbuf\+\_\+write@{jbuf\+\_\+write}}
\index{jbuf\+\_\+write@{jbuf\+\_\+write}!codec.\+c@{codec.\+c}}
\subsubsection[{jbuf\+\_\+write}]{\setlength{\rightskip}{0pt plus 5cm}static int jbuf\+\_\+write (
\begin{DoxyParamCaption}
\item[{{\bf Jitter\+Buffer} $\ast$}]{q, }
\item[{{\bf R\+T\+P\+Message} $\ast$}]{m}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{codec_8c_a170dd2e497101775eea8695dbda58f9e}


Definition at line 172 of file codec.\+c.



References \+\_\+\+Jitter\+Buffer\+::bottom, \+\_\+\+Jitter\+Buffer\+::capacity, \+\_\+\+R\+T\+P\+Message\+::header, jbuf\+\_\+clear(), m, num, \+\_\+\+Jitter\+Buffer\+::queue, \+\_\+\+R\+T\+P\+Header\+::sequnum, \+\_\+\+Jitter\+Buffer\+::size, and \+\_\+\+Jitter\+Buffer\+::top.



Referenced by queue\+\_\+message().


\begin{DoxyCode}
173 \{
174     uint16\_t sequnum = m->\hyperlink{struct___r_t_p_message_afa0aee0d9eab5781c753943ec6a37584}{header}->\hyperlink{struct___r_t_p_header_afe208c7dec97b8f61e08094e61bf096e}{sequnum};
175 
176     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num} = sequnum % q->\hyperlink{struct___jitter_buffer_ab2c6b258f02add8fdf4cfc7c371dd772}{size};
177 
178     \textcolor{keywordflow}{if} ((uint32\_t)(sequnum - q->\hyperlink{struct___jitter_buffer_a12c8099ac87952580dd090215e02728c}{bottom}) > q->\hyperlink{struct___jitter_buffer_ab2c6b258f02add8fdf4cfc7c371dd772}{size}) \{
179         \hyperlink{codec_8c_a2ab3636512ac576d996c504f9226108d}{jbuf\_clear}(q);
180         q->\hyperlink{struct___jitter_buffer_a12c8099ac87952580dd090215e02728c}{bottom} = sequnum - q->\hyperlink{struct___jitter_buffer_a391c992c66c3e5540265a85ec2b9216a}{capacity};
181         q->\hyperlink{struct___jitter_buffer_aba0e7057fa735d7bfaa585fd7bf43a24}{queue}[\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num}] = \hyperlink{messenger__test_8c_aea6eb6c7c30a659f1b0dee83eaf03ea2}{m};
182         q->\hyperlink{struct___jitter_buffer_a0c235a6df98714bb18538fc0afc5bad1}{top} = sequnum + 1;
183         \textcolor{keywordflow}{return} 0;
184     \}
185 
186     \textcolor{keywordflow}{if} (q->\hyperlink{struct___jitter_buffer_aba0e7057fa735d7bfaa585fd7bf43a24}{queue}[num])
187         \textcolor{keywordflow}{return} -1;
188 
189     q->\hyperlink{struct___jitter_buffer_aba0e7057fa735d7bfaa585fd7bf43a24}{queue}[\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num}] = \hyperlink{messenger__test_8c_aea6eb6c7c30a659f1b0dee83eaf03ea2}{m};
190 
191     \textcolor{keywordflow}{if} ((sequnum - q->\hyperlink{struct___jitter_buffer_a12c8099ac87952580dd090215e02728c}{bottom}) >= (q->\hyperlink{struct___jitter_buffer_a0c235a6df98714bb18538fc0afc5bad1}{top} - q->\hyperlink{struct___jitter_buffer_a12c8099ac87952580dd090215e02728c}{bottom}))
192         q->\hyperlink{struct___jitter_buffer_a0c235a6df98714bb18538fc0afc5bad1}{top} = sequnum + 1;
193 
194     \textcolor{keywordflow}{return} 0;
195 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=344pt]{d5/def/codec_8c_a170dd2e497101775eea8695dbda58f9e_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d5/def/codec_8c_a170dd2e497101775eea8695dbda58f9e_icgraph}
\end{center}
\end{figure}


\hypertarget{codec_8c_a84bdc7c8bb1fa316af5ed8dd4fac4df8}{\index{codec.\+c@{codec.\+c}!queue\+\_\+message@{queue\+\_\+message}}
\index{queue\+\_\+message@{queue\+\_\+message}!codec.\+c@{codec.\+c}}
\subsubsection[{queue\+\_\+message}]{\setlength{\rightskip}{0pt plus 5cm}void queue\+\_\+message (
\begin{DoxyParamCaption}
\item[{{\bf R\+T\+P\+Session} $\ast$}]{\+\_\+session, }
\item[{{\bf R\+T\+P\+Message} $\ast$}]{\+\_\+msg}
\end{DoxyParamCaption}
)}}\label{codec_8c_a84bdc7c8bb1fa316af5ed8dd4fac4df8}
\hyperlink{rtp_8c}{rtp.\+c}

Copyright (C) 2013 Tox project All Rights Reserved.

This file is part of Tox.

Tox is free software\+: you can redistribute it and/or modify it under the terms of the G\+N\+U General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.

Tox is distributed in the hope that it will be useful, but W\+I\+T\+H\+O\+U\+T A\+N\+Y W\+A\+R\+R\+A\+N\+T\+Y; without even the implied warranty of M\+E\+R\+C\+H\+A\+N\+T\+A\+B\+I\+L\+I\+T\+Y or F\+I\+T\+N\+E\+S\+S F\+O\+R A P\+A\+R\+T\+I\+C\+U\+L\+A\+R P\+U\+R\+P\+O\+S\+E. See the G\+N\+U General Public License for more details.

You should have received a copy of the G\+N\+U General Public License along with Tox. If not, see \href{http://www.gnu.org/licenses/}{\tt http\+://www.\+gnu.\+org/licenses/}. 

Definition at line 617 of file codec.\+c.



References buffer\+\_\+full(), buffer\+\_\+read(), buffer\+\_\+write(), \+\_\+\+R\+T\+P\+Session\+::cs, \+\_\+\+R\+T\+P\+Message\+::data, end, \+\_\+\+C\+S\+Session\+::frame\+\_\+buf, \+\_\+\+C\+S\+Session\+::frame\+\_\+size, \+\_\+\+C\+S\+Session\+::frameid\+\_\+in, \+\_\+\+R\+T\+P\+Message\+::header, \+\_\+\+C\+S\+Session\+::j\+\_\+buf, jbuf\+\_\+write(), \+\_\+\+C\+S\+Session\+::last\+\_\+timestamp, \+\_\+\+R\+T\+P\+Message\+::length, L\+O\+G\+G\+E\+R\+\_\+\+D\+E\+B\+U\+G, L\+O\+G\+G\+E\+R\+\_\+\+W\+A\+R\+N\+I\+N\+G, \+\_\+\+C\+S\+Session\+::max\+\_\+video\+\_\+frame\+\_\+size, msi\+\_\+\+Type\+Audio, \+\_\+\+R\+T\+P\+Session\+::payload\+\_\+type, \+\_\+\+C\+S\+Session\+::queue\+\_\+mutex, rtp\+\_\+free\+\_\+msg(), \+\_\+\+R\+T\+P\+Header\+::timestamp, \+\_\+\+C\+S\+Session\+::vbuf\+\_\+raw, \+\_\+\+C\+S\+Session\+::video\+\_\+frame\+\_\+piece\+\_\+size, and V\+I\+D\+E\+O\+F\+R\+A\+M\+E\+\_\+\+H\+E\+A\+D\+E\+R\+\_\+\+S\+I\+Z\+E.



Referenced by rtp\+\_\+handle\+\_\+packet().


\begin{DoxyCode}
618 \{
619     \textcolor{comment}{/* This function is unregistered during call termination befor destroing}
620 \textcolor{comment}{     * Codec session so no need to check for validity of cs}
621 \textcolor{comment}{     */}
622     \hyperlink{struct___c_s_session}{CSSession} *cs = session->\hyperlink{struct___r_t_p_session_a6fa710f1d7103d0f7b2b872e33aac143}{cs};
623 
624     \textcolor{keywordflow}{if} (!cs) \textcolor{keywordflow}{return};
625 
626     \textcolor{comment}{/* Audio */}
627     \textcolor{keywordflow}{if} (session->\hyperlink{struct___r_t_p_session_a9cdef377149cce5efd90b1e60596573a}{payload\_type} == \hyperlink{msi_8h_a54df3a97d8d112a3a4a6476c9f9284a6a4a64c16a6c74d9e29598b14b97bf5a45}{msi\_TypeAudio} % 128) \{
628         pthread\_mutex\_lock(cs->\hyperlink{struct___c_s_session_aa1e20c410f3ec23066afb256fa3d1254}{queue\_mutex});
629         \textcolor{keywordtype}{int} ret = \hyperlink{codec_8c_a170dd2e497101775eea8695dbda58f9e}{jbuf\_write}(cs->\hyperlink{struct___c_s_session_a7567f0c621b65df3ff9e6f46164ac1c0}{j\_buf}, msg);
630         pthread\_mutex\_unlock(cs->\hyperlink{struct___c_s_session_aa1e20c410f3ec23066afb256fa3d1254}{queue\_mutex});
631 
632         \textcolor{keywordflow}{if} (ret == -1) \{
633             \hyperlink{rtp_8c_a19cbf4e4c2831f2e162e7580bb7d5c7b}{rtp\_free\_msg}(NULL, msg);
634         \}
635     \}
636     \textcolor{comment}{/* Video */}
637     \textcolor{keywordflow}{else} \{
638         uint8\_t *packet = msg->\hyperlink{struct___r_t_p_message_a89f8083b50c7cef74e96797bb74f8757}{data};
639         uint32\_t packet\_size = msg->\hyperlink{struct___r_t_p_message_aebb70c2aab3407a9f05334c47131a43b}{length};
640 
641         \textcolor{keywordflow}{if} (packet\_size < \hyperlink{codec_8c_a1fd042bb49704e3c68dea14ff6956b33}{VIDEOFRAME\_HEADER\_SIZE})
642             \textcolor{keywordflow}{goto} \hyperlink{msi_8c_ae511d1f1e345bb77cd4120b39679f028a80b1a820e533d7cf0e1715319339e6d0}{end};
643 
644         uint8\_t diff = packet[0] - cs->\hyperlink{struct___c_s_session_affc5ab5608c4d2dea8513fdc2b2cd6e6}{frameid\_in};
645 
646         \textcolor{keywordflow}{if} (diff != 0) \{
647             \textcolor{keywordflow}{if} (diff < 225) \{ \textcolor{comment}{/* New frame */}
648                 \textcolor{comment}{/* Flush last frames' data and get ready for this frame */}
649                 Payload *p = malloc(\textcolor{keyword}{sizeof}(Payload) + cs->\hyperlink{struct___c_s_session_a0229abcfe4414f86dcf52c5ebf84311c}{frame\_size});
650 
651                 \textcolor{keywordflow}{if} (p) \{
652                     pthread\_mutex\_lock(cs->\hyperlink{struct___c_s_session_aa1e20c410f3ec23066afb256fa3d1254}{queue\_mutex});
653 
654                     \textcolor{keywordflow}{if} (\hyperlink{codec_8c_ab27fdbd54a41e787c4a98b119d181b13}{buffer\_full}(cs->\hyperlink{struct___c_s_session_abb525d3cf1486064b35b5821a0646c86}{vbuf\_raw})) \{
655                         \hyperlink{logger_8h_a9885ca09ce5f94d936c91a5b0856a024}{LOGGER\_DEBUG}(\textcolor{stringliteral}{"Dropped video frame"});
656                         Payload *tp;
657                         \hyperlink{codec_8c_aa27710dac4f829dad6d007cf01bdf55f}{buffer\_read}(cs->\hyperlink{struct___c_s_session_abb525d3cf1486064b35b5821a0646c86}{vbuf\_raw}, &tp);
658                         free(tp);
659                     \} \textcolor{keywordflow}{else} \{
660                         p->size = cs->\hyperlink{struct___c_s_session_a0229abcfe4414f86dcf52c5ebf84311c}{frame\_size};
661                         memcpy(p->data, cs->\hyperlink{struct___c_s_session_aa4046ccf60d85f4f486ae0b24e3347f5}{frame\_buf}, cs->\hyperlink{struct___c_s_session_a0229abcfe4414f86dcf52c5ebf84311c}{frame\_size});
662                     \}
663 
664                     \hyperlink{codec_8c_a5990d0123726b7f12cebdae0984475b4}{buffer\_write}(cs->\hyperlink{struct___c_s_session_abb525d3cf1486064b35b5821a0646c86}{vbuf\_raw}, p);
665                     pthread\_mutex\_unlock(cs->\hyperlink{struct___c_s_session_aa1e20c410f3ec23066afb256fa3d1254}{queue\_mutex});
666                 \} \textcolor{keywordflow}{else} \{
667                     \hyperlink{logger_8h_ab3e970f3c1ecb5b71f17eccee4ebb286}{LOGGER\_WARNING}(\textcolor{stringliteral}{"Allocation failed! Program might misbehave!"});
668                     \textcolor{keywordflow}{goto} \hyperlink{msi_8c_ae511d1f1e345bb77cd4120b39679f028a80b1a820e533d7cf0e1715319339e6d0}{end};
669                 \}
670 
671                 cs->\hyperlink{struct___c_s_session_ab3eadf01045769905278f1908af23558}{last\_timestamp} = msg->\hyperlink{struct___r_t_p_message_afa0aee0d9eab5781c753943ec6a37584}{header}->\hyperlink{struct___r_t_p_header_ab20b0c7772544cf5d318507f34231fbe}{timestamp};
672                 cs->\hyperlink{struct___c_s_session_affc5ab5608c4d2dea8513fdc2b2cd6e6}{frameid\_in} = packet[0];
673                 memset(cs->\hyperlink{struct___c_s_session_aa4046ccf60d85f4f486ae0b24e3347f5}{frame\_buf}, 0, cs->\hyperlink{struct___c_s_session_a0229abcfe4414f86dcf52c5ebf84311c}{frame\_size});
674                 cs->\hyperlink{struct___c_s_session_a0229abcfe4414f86dcf52c5ebf84311c}{frame\_size} = 0;
675 
676             \} \textcolor{keywordflow}{else} \{ \textcolor{comment}{/* Old frame; drop */}
677                 \hyperlink{logger_8h_a9885ca09ce5f94d936c91a5b0856a024}{LOGGER\_DEBUG}(\textcolor{stringliteral}{"Old packet: %u"}, packet[0]);
678                 \textcolor{keywordflow}{goto} \hyperlink{msi_8c_ae511d1f1e345bb77cd4120b39679f028a80b1a820e533d7cf0e1715319339e6d0}{end};
679             \}
680         \}
681 
682         uint8\_t piece\_number = packet[1];
683 
684         uint32\_t length\_before\_piece = ((piece\_number - 1) * cs->
      \hyperlink{struct___c_s_session_af3563a0a96eb120a68e82d3135b6c49b}{video\_frame\_piece\_size});
685         uint32\_t framebuf\_new\_length = length\_before\_piece + (packet\_size - 
      \hyperlink{codec_8c_a1fd042bb49704e3c68dea14ff6956b33}{VIDEOFRAME\_HEADER\_SIZE});
686 
687         \textcolor{keywordflow}{if} (framebuf\_new\_length > cs->\hyperlink{struct___c_s_session_a4de5a61c775468baabb35e2fcfaaa3a2}{max\_video\_frame\_size}) \{
688             \textcolor{keywordflow}{goto} \hyperlink{msi_8c_ae511d1f1e345bb77cd4120b39679f028a80b1a820e533d7cf0e1715319339e6d0}{end};
689         \}
690 
691         \textcolor{comment}{/* Otherwise it's part of the frame so just process */}
692         \textcolor{comment}{/* LOGGER\_DEBUG("Video Packet: %u %u", packet[0], packet[1]); */}
693 
694         memcpy(cs->\hyperlink{struct___c_s_session_aa4046ccf60d85f4f486ae0b24e3347f5}{frame\_buf} + length\_before\_piece,
695                packet + \hyperlink{codec_8c_a1fd042bb49704e3c68dea14ff6956b33}{VIDEOFRAME\_HEADER\_SIZE},
696                packet\_size - \hyperlink{codec_8c_a1fd042bb49704e3c68dea14ff6956b33}{VIDEOFRAME\_HEADER\_SIZE});
697 
698         \textcolor{keywordflow}{if} (framebuf\_new\_length > cs->\hyperlink{struct___c_s_session_a0229abcfe4414f86dcf52c5ebf84311c}{frame\_size}) \{
699             cs->\hyperlink{struct___c_s_session_a0229abcfe4414f86dcf52c5ebf84311c}{frame\_size} = framebuf\_new\_length;
700         \}
701 
702 \hyperlink{msi_8c_ae511d1f1e345bb77cd4120b39679f028a80b1a820e533d7cf0e1715319339e6d0}{end}:
703         \hyperlink{rtp_8c_a19cbf4e4c2831f2e162e7580bb7d5c7b}{rtp\_free\_msg}(NULL, msg);
704     \}
705 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d5/def/codec_8c_a84bdc7c8bb1fa316af5ed8dd4fac4df8_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d5/def/codec_8c_a84bdc7c8bb1fa316af5ed8dd4fac4df8_icgraph}
\end{center}
\end{figure}




\subsection{Variable Documentation}
\hypertarget{codec_8c_a2594599edbe03ec432aabbcdb4c51ba9}{\index{codec.\+c@{codec.\+c}!Payload\+Buffer@{Payload\+Buffer}}
\index{Payload\+Buffer@{Payload\+Buffer}!codec.\+c@{codec.\+c}}
\subsubsection[{Payload\+Buffer}]{\setlength{\rightskip}{0pt plus 5cm}Payload\+Buffer}}\label{codec_8c_a2594599edbe03ec432aabbcdb4c51ba9}


Definition at line 62 of file codec.\+c.



Referenced by buffer\+\_\+new().

