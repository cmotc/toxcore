\hypertarget{tox-bootstrapd_8c}{\section{other/bootstrap\+\_\+daemon/tox-\/bootstrapd.c File Reference}
\label{tox-bootstrapd_8c}\index{other/bootstrap\+\_\+daemon/tox-\/bootstrapd.\+c@{other/bootstrap\+\_\+daemon/tox-\/bootstrapd.\+c}}
}
{\ttfamily \#include $<$arpa/inet.\+h$>$}\\*
{\ttfamily \#include $<$syslog.\+h$>$}\\*
{\ttfamily \#include $<$sys/stat.\+h$>$}\\*
{\ttfamily \#include $<$sys/types.\+h$>$}\\*
{\ttfamily \#include $<$unistd.\+h$>$}\\*
{\ttfamily \#include $<$stdio.\+h$>$}\\*
{\ttfamily \#include $<$stdlib.\+h$>$}\\*
{\ttfamily \#include $<$string.\+h$>$}\\*
{\ttfamily \#include $<$libconfig.\+h$>$}\\*
{\ttfamily \#include \char`\"{}../../toxcore/\+L\+A\+N\+\_\+discovery.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}../../toxcore/onion\+\_\+announce.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}../../toxcore/\+T\+C\+P\+\_\+server.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}../../toxcore/util.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}../bootstrap\+\_\+node\+\_\+packets.\+c\char`\"{}}\\*
{\ttfamily \#include \char`\"{}../../testing/misc\+\_\+tools.\+c\char`\"{}}\\*
Include dependency graph for tox-\/bootstrapd.c\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{de/df4/tox-bootstrapd_8c__incl}
\end{center}
\end{figure}
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{tox-bootstrapd_8c_a5ea777c6fb1dd39fda46cdf97a6949a5}{D\+A\+E\+M\+O\+N\+\_\+\+N\+A\+M\+E}~\char`\"{}tox-\/bootstrapd\char`\"{}
\item 
\#define \hyperlink{tox-bootstrapd_8c_a63112447ca129c284247c8b29b32b838}{D\+A\+E\+M\+O\+N\+\_\+\+V\+E\+R\+S\+I\+O\+N\+\_\+\+N\+U\+M\+B\+E\+R}~2014101200\+U\+L
\item 
\#define \hyperlink{tox-bootstrapd_8c_afb56b9187945a9a5a8ae0b48fb918b37}{S\+L\+E\+E\+P\+\_\+\+T\+I\+M\+E\+\_\+\+M\+I\+L\+L\+I\+S\+E\+C\+O\+N\+D\+S}~30
\item 
\#define \hyperlink{tox-bootstrapd_8c_acc8612feeec5f569b1e096e3110d0dca}{sleep}~usleep(1000$\ast$\hyperlink{tox-bootstrapd_8c_afb56b9187945a9a5a8ae0b48fb918b37}{S\+L\+E\+E\+P\+\_\+\+T\+I\+M\+E\+\_\+\+M\+I\+L\+L\+I\+S\+E\+C\+O\+N\+D\+S})
\item 
\#define \hyperlink{tox-bootstrapd_8c_a3229500bf4d840c088746e1a6482210d}{D\+E\+F\+A\+U\+L\+T\+\_\+\+P\+I\+D\+\_\+\+F\+I\+L\+E\+\_\+\+P\+A\+T\+H}~\char`\"{}tox-\/bootstrapd.\+pid\char`\"{}
\item 
\#define \hyperlink{tox-bootstrapd_8c_a1bdc61234638275814834465df95908a}{D\+E\+F\+A\+U\+L\+T\+\_\+\+K\+E\+Y\+S\+\_\+\+F\+I\+L\+E\+\_\+\+P\+A\+T\+H}~\char`\"{}tox-\/bootstrapd.\+keys\char`\"{}
\item 
\#define \hyperlink{tox-bootstrapd_8c_a16b710f592bf8f7900666392adc444dc}{D\+E\+F\+A\+U\+L\+T\+\_\+\+P\+O\+R\+T}~33445
\item 
\#define \hyperlink{tox-bootstrapd_8c_a67663ba00c576efce1226a3fd856cba6}{D\+E\+F\+A\+U\+L\+T\+\_\+\+E\+N\+A\+B\+L\+E\+\_\+\+I\+P\+V6}~1
\item 
\#define \hyperlink{tox-bootstrapd_8c_a51d848d37bbf1d506ca14f83ddd2e342}{D\+E\+F\+A\+U\+L\+T\+\_\+\+E\+N\+A\+B\+L\+E\+\_\+\+I\+P\+V4\+\_\+\+F\+A\+L\+L\+B\+A\+C\+K}~1
\item 
\#define \hyperlink{tox-bootstrapd_8c_a78c8c9f7a2ece92a6e6cab895c88962e}{D\+E\+F\+A\+U\+L\+T\+\_\+\+E\+N\+A\+B\+L\+E\+\_\+\+L\+A\+N\+\_\+\+D\+I\+S\+C\+O\+V\+E\+R\+Y}~1
\item 
\#define \hyperlink{tox-bootstrapd_8c_acfa79b0cd7c40eb8d55462d8b8fa0e17}{D\+E\+F\+A\+U\+L\+T\+\_\+\+E\+N\+A\+B\+L\+E\+\_\+\+T\+C\+P\+\_\+\+R\+E\+L\+A\+Y}~1
\item 
\#define \hyperlink{tox-bootstrapd_8c_a2d597b4c5dbb34d2f7e5387e8aa8d13d}{D\+E\+F\+A\+U\+L\+T\+\_\+\+T\+C\+P\+\_\+\+R\+E\+L\+A\+Y\+\_\+\+P\+O\+R\+T\+S}~443, 3389, 33445
\item 
\#define \hyperlink{tox-bootstrapd_8c_a8cd528f2dfb339311387dcb43608ceef}{D\+E\+F\+A\+U\+L\+T\+\_\+\+T\+C\+P\+\_\+\+R\+E\+L\+A\+Y\+\_\+\+P\+O\+R\+T\+S\+\_\+\+C\+O\+U\+N\+T}~3
\item 
\#define \hyperlink{tox-bootstrapd_8c_a1014d7c1334195d6330fb4b7d05d210c}{D\+E\+F\+A\+U\+L\+T\+\_\+\+E\+N\+A\+B\+L\+E\+\_\+\+M\+O\+T\+D}~1
\item 
\#define \hyperlink{tox-bootstrapd_8c_a91de4e54937ebc70859c64e252a85941}{D\+E\+F\+A\+U\+L\+T\+\_\+\+M\+O\+T\+D}~\hyperlink{tox-bootstrapd_8c_a5ea777c6fb1dd39fda46cdf97a6949a5}{D\+A\+E\+M\+O\+N\+\_\+\+N\+A\+M\+E}
\item 
\#define \hyperlink{tox-bootstrapd_8c_a3ef213aa33f9321104faf75dfe823623}{M\+I\+N\+\_\+\+A\+L\+L\+O\+W\+E\+D\+\_\+\+P\+O\+R\+T}~1
\item 
\#define \hyperlink{tox-bootstrapd_8c_a83828e6f5b4b788b1781b298a3a221cd}{M\+A\+X\+\_\+\+A\+L\+L\+O\+W\+E\+D\+\_\+\+P\+O\+R\+T}~65535
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{tox-bootstrapd_8c_a0a4dac6d686a3a976d578eb81322a81e}{manage\+\_\+keys} (\hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht, char $\ast$keys\+\_\+file\+\_\+path)
\item 
void \hyperlink{tox-bootstrapd_8c_a21026d73be31f649ba809b1c56cbdbe6}{parse\+\_\+tcp\+\_\+relay\+\_\+ports\+\_\+config} (config\+\_\+t $\ast$cfg, uint16\+\_\+t $\ast$$\ast$tcp\+\_\+relay\+\_\+ports, int $\ast$tcp\+\_\+relay\+\_\+port\+\_\+count)
\item 
int \hyperlink{tox-bootstrapd_8c_a6d074c4305e232b55bc9894bef6dc957}{get\+\_\+general\+\_\+config} (const char $\ast$cfg\+\_\+file\+\_\+path, char $\ast$$\ast$pid\+\_\+file\+\_\+path, char $\ast$$\ast$keys\+\_\+file\+\_\+path, int $\ast$\hyperlink{irc__syncbot_8c_a8e0798404bf2cf5dabb84c5ba9a4f236}{port}, int $\ast$enable\+\_\+ipv6, int $\ast$enable\+\_\+ipv4\+\_\+fallback, int $\ast$enable\+\_\+lan\+\_\+discovery, int $\ast$enable\+\_\+tcp\+\_\+relay, uint16\+\_\+t $\ast$$\ast$tcp\+\_\+relay\+\_\+ports, int $\ast$tcp\+\_\+relay\+\_\+port\+\_\+count, int $\ast$enable\+\_\+motd, char $\ast$$\ast$motd)
\item 
int \hyperlink{tox-bootstrapd_8c_a3b29f8b1522a8d051f35cc76a54f846a}{bootstrap\+\_\+from\+\_\+config} (const char $\ast$cfg\+\_\+file\+\_\+path, \hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht, int enable\+\_\+ipv6)
\item 
void \hyperlink{tox-bootstrapd_8c_adac86c780017ad2c55d81005ba02ac89}{print\+\_\+public\+\_\+key} (const uint8\+\_\+t $\ast$public\+\_\+key)
\item 
int \hyperlink{tox-bootstrapd_8c_a0ddf1224851353fc92bfbff6f499fa97}{main} (int argc, char $\ast$argv\mbox{[}$\,$\mbox{]})
\end{DoxyCompactItemize}


\subsection{Macro Definition Documentation}
\hypertarget{tox-bootstrapd_8c_a5ea777c6fb1dd39fda46cdf97a6949a5}{\index{tox-\/bootstrapd.\+c@{tox-\/bootstrapd.\+c}!D\+A\+E\+M\+O\+N\+\_\+\+N\+A\+M\+E@{D\+A\+E\+M\+O\+N\+\_\+\+N\+A\+M\+E}}
\index{D\+A\+E\+M\+O\+N\+\_\+\+N\+A\+M\+E@{D\+A\+E\+M\+O\+N\+\_\+\+N\+A\+M\+E}!tox-\/bootstrapd.\+c@{tox-\/bootstrapd.\+c}}
\subsubsection[{D\+A\+E\+M\+O\+N\+\_\+\+N\+A\+M\+E}]{\setlength{\rightskip}{0pt plus 5cm}\#define D\+A\+E\+M\+O\+N\+\_\+\+N\+A\+M\+E~\char`\"{}tox-\/bootstrapd\char`\"{}}}\label{tox-bootstrapd_8c_a5ea777c6fb1dd39fda46cdf97a6949a5}


Definition at line 55 of file tox-\/bootstrapd.\+c.



Referenced by main().

\hypertarget{tox-bootstrapd_8c_a63112447ca129c284247c8b29b32b838}{\index{tox-\/bootstrapd.\+c@{tox-\/bootstrapd.\+c}!D\+A\+E\+M\+O\+N\+\_\+\+V\+E\+R\+S\+I\+O\+N\+\_\+\+N\+U\+M\+B\+E\+R@{D\+A\+E\+M\+O\+N\+\_\+\+V\+E\+R\+S\+I\+O\+N\+\_\+\+N\+U\+M\+B\+E\+R}}
\index{D\+A\+E\+M\+O\+N\+\_\+\+V\+E\+R\+S\+I\+O\+N\+\_\+\+N\+U\+M\+B\+E\+R@{D\+A\+E\+M\+O\+N\+\_\+\+V\+E\+R\+S\+I\+O\+N\+\_\+\+N\+U\+M\+B\+E\+R}!tox-\/bootstrapd.\+c@{tox-\/bootstrapd.\+c}}
\subsubsection[{D\+A\+E\+M\+O\+N\+\_\+\+V\+E\+R\+S\+I\+O\+N\+\_\+\+N\+U\+M\+B\+E\+R}]{\setlength{\rightskip}{0pt plus 5cm}\#define D\+A\+E\+M\+O\+N\+\_\+\+V\+E\+R\+S\+I\+O\+N\+\_\+\+N\+U\+M\+B\+E\+R~2014101200\+U\+L}}\label{tox-bootstrapd_8c_a63112447ca129c284247c8b29b32b838}


Definition at line 56 of file tox-\/bootstrapd.\+c.



Referenced by main().

\hypertarget{tox-bootstrapd_8c_a51d848d37bbf1d506ca14f83ddd2e342}{\index{tox-\/bootstrapd.\+c@{tox-\/bootstrapd.\+c}!D\+E\+F\+A\+U\+L\+T\+\_\+\+E\+N\+A\+B\+L\+E\+\_\+\+I\+P\+V4\+\_\+\+F\+A\+L\+L\+B\+A\+C\+K@{D\+E\+F\+A\+U\+L\+T\+\_\+\+E\+N\+A\+B\+L\+E\+\_\+\+I\+P\+V4\+\_\+\+F\+A\+L\+L\+B\+A\+C\+K}}
\index{D\+E\+F\+A\+U\+L\+T\+\_\+\+E\+N\+A\+B\+L\+E\+\_\+\+I\+P\+V4\+\_\+\+F\+A\+L\+L\+B\+A\+C\+K@{D\+E\+F\+A\+U\+L\+T\+\_\+\+E\+N\+A\+B\+L\+E\+\_\+\+I\+P\+V4\+\_\+\+F\+A\+L\+L\+B\+A\+C\+K}!tox-\/bootstrapd.\+c@{tox-\/bootstrapd.\+c}}
\subsubsection[{D\+E\+F\+A\+U\+L\+T\+\_\+\+E\+N\+A\+B\+L\+E\+\_\+\+I\+P\+V4\+\_\+\+F\+A\+L\+L\+B\+A\+C\+K}]{\setlength{\rightskip}{0pt plus 5cm}\#define D\+E\+F\+A\+U\+L\+T\+\_\+\+E\+N\+A\+B\+L\+E\+\_\+\+I\+P\+V4\+\_\+\+F\+A\+L\+L\+B\+A\+C\+K~1}}\label{tox-bootstrapd_8c_a51d848d37bbf1d506ca14f83ddd2e342}


Definition at line 65 of file tox-\/bootstrapd.\+c.



Referenced by get\+\_\+general\+\_\+config().

\hypertarget{tox-bootstrapd_8c_a67663ba00c576efce1226a3fd856cba6}{\index{tox-\/bootstrapd.\+c@{tox-\/bootstrapd.\+c}!D\+E\+F\+A\+U\+L\+T\+\_\+\+E\+N\+A\+B\+L\+E\+\_\+\+I\+P\+V6@{D\+E\+F\+A\+U\+L\+T\+\_\+\+E\+N\+A\+B\+L\+E\+\_\+\+I\+P\+V6}}
\index{D\+E\+F\+A\+U\+L\+T\+\_\+\+E\+N\+A\+B\+L\+E\+\_\+\+I\+P\+V6@{D\+E\+F\+A\+U\+L\+T\+\_\+\+E\+N\+A\+B\+L\+E\+\_\+\+I\+P\+V6}!tox-\/bootstrapd.\+c@{tox-\/bootstrapd.\+c}}
\subsubsection[{D\+E\+F\+A\+U\+L\+T\+\_\+\+E\+N\+A\+B\+L\+E\+\_\+\+I\+P\+V6}]{\setlength{\rightskip}{0pt plus 5cm}\#define D\+E\+F\+A\+U\+L\+T\+\_\+\+E\+N\+A\+B\+L\+E\+\_\+\+I\+P\+V6~1}}\label{tox-bootstrapd_8c_a67663ba00c576efce1226a3fd856cba6}


Definition at line 64 of file tox-\/bootstrapd.\+c.



Referenced by get\+\_\+general\+\_\+config().

\hypertarget{tox-bootstrapd_8c_a78c8c9f7a2ece92a6e6cab895c88962e}{\index{tox-\/bootstrapd.\+c@{tox-\/bootstrapd.\+c}!D\+E\+F\+A\+U\+L\+T\+\_\+\+E\+N\+A\+B\+L\+E\+\_\+\+L\+A\+N\+\_\+\+D\+I\+S\+C\+O\+V\+E\+R\+Y@{D\+E\+F\+A\+U\+L\+T\+\_\+\+E\+N\+A\+B\+L\+E\+\_\+\+L\+A\+N\+\_\+\+D\+I\+S\+C\+O\+V\+E\+R\+Y}}
\index{D\+E\+F\+A\+U\+L\+T\+\_\+\+E\+N\+A\+B\+L\+E\+\_\+\+L\+A\+N\+\_\+\+D\+I\+S\+C\+O\+V\+E\+R\+Y@{D\+E\+F\+A\+U\+L\+T\+\_\+\+E\+N\+A\+B\+L\+E\+\_\+\+L\+A\+N\+\_\+\+D\+I\+S\+C\+O\+V\+E\+R\+Y}!tox-\/bootstrapd.\+c@{tox-\/bootstrapd.\+c}}
\subsubsection[{D\+E\+F\+A\+U\+L\+T\+\_\+\+E\+N\+A\+B\+L\+E\+\_\+\+L\+A\+N\+\_\+\+D\+I\+S\+C\+O\+V\+E\+R\+Y}]{\setlength{\rightskip}{0pt plus 5cm}\#define D\+E\+F\+A\+U\+L\+T\+\_\+\+E\+N\+A\+B\+L\+E\+\_\+\+L\+A\+N\+\_\+\+D\+I\+S\+C\+O\+V\+E\+R\+Y~1}}\label{tox-bootstrapd_8c_a78c8c9f7a2ece92a6e6cab895c88962e}


Definition at line 66 of file tox-\/bootstrapd.\+c.



Referenced by get\+\_\+general\+\_\+config().

\hypertarget{tox-bootstrapd_8c_a1014d7c1334195d6330fb4b7d05d210c}{\index{tox-\/bootstrapd.\+c@{tox-\/bootstrapd.\+c}!D\+E\+F\+A\+U\+L\+T\+\_\+\+E\+N\+A\+B\+L\+E\+\_\+\+M\+O\+T\+D@{D\+E\+F\+A\+U\+L\+T\+\_\+\+E\+N\+A\+B\+L\+E\+\_\+\+M\+O\+T\+D}}
\index{D\+E\+F\+A\+U\+L\+T\+\_\+\+E\+N\+A\+B\+L\+E\+\_\+\+M\+O\+T\+D@{D\+E\+F\+A\+U\+L\+T\+\_\+\+E\+N\+A\+B\+L\+E\+\_\+\+M\+O\+T\+D}!tox-\/bootstrapd.\+c@{tox-\/bootstrapd.\+c}}
\subsubsection[{D\+E\+F\+A\+U\+L\+T\+\_\+\+E\+N\+A\+B\+L\+E\+\_\+\+M\+O\+T\+D}]{\setlength{\rightskip}{0pt plus 5cm}\#define D\+E\+F\+A\+U\+L\+T\+\_\+\+E\+N\+A\+B\+L\+E\+\_\+\+M\+O\+T\+D~1}}\label{tox-bootstrapd_8c_a1014d7c1334195d6330fb4b7d05d210c}


Definition at line 70 of file tox-\/bootstrapd.\+c.



Referenced by get\+\_\+general\+\_\+config().

\hypertarget{tox-bootstrapd_8c_acfa79b0cd7c40eb8d55462d8b8fa0e17}{\index{tox-\/bootstrapd.\+c@{tox-\/bootstrapd.\+c}!D\+E\+F\+A\+U\+L\+T\+\_\+\+E\+N\+A\+B\+L\+E\+\_\+\+T\+C\+P\+\_\+\+R\+E\+L\+A\+Y@{D\+E\+F\+A\+U\+L\+T\+\_\+\+E\+N\+A\+B\+L\+E\+\_\+\+T\+C\+P\+\_\+\+R\+E\+L\+A\+Y}}
\index{D\+E\+F\+A\+U\+L\+T\+\_\+\+E\+N\+A\+B\+L\+E\+\_\+\+T\+C\+P\+\_\+\+R\+E\+L\+A\+Y@{D\+E\+F\+A\+U\+L\+T\+\_\+\+E\+N\+A\+B\+L\+E\+\_\+\+T\+C\+P\+\_\+\+R\+E\+L\+A\+Y}!tox-\/bootstrapd.\+c@{tox-\/bootstrapd.\+c}}
\subsubsection[{D\+E\+F\+A\+U\+L\+T\+\_\+\+E\+N\+A\+B\+L\+E\+\_\+\+T\+C\+P\+\_\+\+R\+E\+L\+A\+Y}]{\setlength{\rightskip}{0pt plus 5cm}\#define D\+E\+F\+A\+U\+L\+T\+\_\+\+E\+N\+A\+B\+L\+E\+\_\+\+T\+C\+P\+\_\+\+R\+E\+L\+A\+Y~1}}\label{tox-bootstrapd_8c_acfa79b0cd7c40eb8d55462d8b8fa0e17}


Definition at line 67 of file tox-\/bootstrapd.\+c.



Referenced by get\+\_\+general\+\_\+config().

\hypertarget{tox-bootstrapd_8c_a1bdc61234638275814834465df95908a}{\index{tox-\/bootstrapd.\+c@{tox-\/bootstrapd.\+c}!D\+E\+F\+A\+U\+L\+T\+\_\+\+K\+E\+Y\+S\+\_\+\+F\+I\+L\+E\+\_\+\+P\+A\+T\+H@{D\+E\+F\+A\+U\+L\+T\+\_\+\+K\+E\+Y\+S\+\_\+\+F\+I\+L\+E\+\_\+\+P\+A\+T\+H}}
\index{D\+E\+F\+A\+U\+L\+T\+\_\+\+K\+E\+Y\+S\+\_\+\+F\+I\+L\+E\+\_\+\+P\+A\+T\+H@{D\+E\+F\+A\+U\+L\+T\+\_\+\+K\+E\+Y\+S\+\_\+\+F\+I\+L\+E\+\_\+\+P\+A\+T\+H}!tox-\/bootstrapd.\+c@{tox-\/bootstrapd.\+c}}
\subsubsection[{D\+E\+F\+A\+U\+L\+T\+\_\+\+K\+E\+Y\+S\+\_\+\+F\+I\+L\+E\+\_\+\+P\+A\+T\+H}]{\setlength{\rightskip}{0pt plus 5cm}\#define D\+E\+F\+A\+U\+L\+T\+\_\+\+K\+E\+Y\+S\+\_\+\+F\+I\+L\+E\+\_\+\+P\+A\+T\+H~\char`\"{}tox-\/bootstrapd.\+keys\char`\"{}}}\label{tox-bootstrapd_8c_a1bdc61234638275814834465df95908a}


Definition at line 62 of file tox-\/bootstrapd.\+c.



Referenced by get\+\_\+general\+\_\+config().

\hypertarget{tox-bootstrapd_8c_a91de4e54937ebc70859c64e252a85941}{\index{tox-\/bootstrapd.\+c@{tox-\/bootstrapd.\+c}!D\+E\+F\+A\+U\+L\+T\+\_\+\+M\+O\+T\+D@{D\+E\+F\+A\+U\+L\+T\+\_\+\+M\+O\+T\+D}}
\index{D\+E\+F\+A\+U\+L\+T\+\_\+\+M\+O\+T\+D@{D\+E\+F\+A\+U\+L\+T\+\_\+\+M\+O\+T\+D}!tox-\/bootstrapd.\+c@{tox-\/bootstrapd.\+c}}
\subsubsection[{D\+E\+F\+A\+U\+L\+T\+\_\+\+M\+O\+T\+D}]{\setlength{\rightskip}{0pt plus 5cm}\#define D\+E\+F\+A\+U\+L\+T\+\_\+\+M\+O\+T\+D~{\bf D\+A\+E\+M\+O\+N\+\_\+\+N\+A\+M\+E}}}\label{tox-bootstrapd_8c_a91de4e54937ebc70859c64e252a85941}


Definition at line 71 of file tox-\/bootstrapd.\+c.



Referenced by get\+\_\+general\+\_\+config().

\hypertarget{tox-bootstrapd_8c_a3229500bf4d840c088746e1a6482210d}{\index{tox-\/bootstrapd.\+c@{tox-\/bootstrapd.\+c}!D\+E\+F\+A\+U\+L\+T\+\_\+\+P\+I\+D\+\_\+\+F\+I\+L\+E\+\_\+\+P\+A\+T\+H@{D\+E\+F\+A\+U\+L\+T\+\_\+\+P\+I\+D\+\_\+\+F\+I\+L\+E\+\_\+\+P\+A\+T\+H}}
\index{D\+E\+F\+A\+U\+L\+T\+\_\+\+P\+I\+D\+\_\+\+F\+I\+L\+E\+\_\+\+P\+A\+T\+H@{D\+E\+F\+A\+U\+L\+T\+\_\+\+P\+I\+D\+\_\+\+F\+I\+L\+E\+\_\+\+P\+A\+T\+H}!tox-\/bootstrapd.\+c@{tox-\/bootstrapd.\+c}}
\subsubsection[{D\+E\+F\+A\+U\+L\+T\+\_\+\+P\+I\+D\+\_\+\+F\+I\+L\+E\+\_\+\+P\+A\+T\+H}]{\setlength{\rightskip}{0pt plus 5cm}\#define D\+E\+F\+A\+U\+L\+T\+\_\+\+P\+I\+D\+\_\+\+F\+I\+L\+E\+\_\+\+P\+A\+T\+H~\char`\"{}tox-\/bootstrapd.\+pid\char`\"{}}}\label{tox-bootstrapd_8c_a3229500bf4d840c088746e1a6482210d}


Definition at line 61 of file tox-\/bootstrapd.\+c.



Referenced by get\+\_\+general\+\_\+config().

\hypertarget{tox-bootstrapd_8c_a16b710f592bf8f7900666392adc444dc}{\index{tox-\/bootstrapd.\+c@{tox-\/bootstrapd.\+c}!D\+E\+F\+A\+U\+L\+T\+\_\+\+P\+O\+R\+T@{D\+E\+F\+A\+U\+L\+T\+\_\+\+P\+O\+R\+T}}
\index{D\+E\+F\+A\+U\+L\+T\+\_\+\+P\+O\+R\+T@{D\+E\+F\+A\+U\+L\+T\+\_\+\+P\+O\+R\+T}!tox-\/bootstrapd.\+c@{tox-\/bootstrapd.\+c}}
\subsubsection[{D\+E\+F\+A\+U\+L\+T\+\_\+\+P\+O\+R\+T}]{\setlength{\rightskip}{0pt plus 5cm}\#define D\+E\+F\+A\+U\+L\+T\+\_\+\+P\+O\+R\+T~33445}}\label{tox-bootstrapd_8c_a16b710f592bf8f7900666392adc444dc}


Definition at line 63 of file tox-\/bootstrapd.\+c.



Referenced by get\+\_\+general\+\_\+config().

\hypertarget{tox-bootstrapd_8c_a2d597b4c5dbb34d2f7e5387e8aa8d13d}{\index{tox-\/bootstrapd.\+c@{tox-\/bootstrapd.\+c}!D\+E\+F\+A\+U\+L\+T\+\_\+\+T\+C\+P\+\_\+\+R\+E\+L\+A\+Y\+\_\+\+P\+O\+R\+T\+S@{D\+E\+F\+A\+U\+L\+T\+\_\+\+T\+C\+P\+\_\+\+R\+E\+L\+A\+Y\+\_\+\+P\+O\+R\+T\+S}}
\index{D\+E\+F\+A\+U\+L\+T\+\_\+\+T\+C\+P\+\_\+\+R\+E\+L\+A\+Y\+\_\+\+P\+O\+R\+T\+S@{D\+E\+F\+A\+U\+L\+T\+\_\+\+T\+C\+P\+\_\+\+R\+E\+L\+A\+Y\+\_\+\+P\+O\+R\+T\+S}!tox-\/bootstrapd.\+c@{tox-\/bootstrapd.\+c}}
\subsubsection[{D\+E\+F\+A\+U\+L\+T\+\_\+\+T\+C\+P\+\_\+\+R\+E\+L\+A\+Y\+\_\+\+P\+O\+R\+T\+S}]{\setlength{\rightskip}{0pt plus 5cm}\#define D\+E\+F\+A\+U\+L\+T\+\_\+\+T\+C\+P\+\_\+\+R\+E\+L\+A\+Y\+\_\+\+P\+O\+R\+T\+S~443, 3389, 33445}}\label{tox-bootstrapd_8c_a2d597b4c5dbb34d2f7e5387e8aa8d13d}


Definition at line 68 of file tox-\/bootstrapd.\+c.



Referenced by parse\+\_\+tcp\+\_\+relay\+\_\+ports\+\_\+config().

\hypertarget{tox-bootstrapd_8c_a8cd528f2dfb339311387dcb43608ceef}{\index{tox-\/bootstrapd.\+c@{tox-\/bootstrapd.\+c}!D\+E\+F\+A\+U\+L\+T\+\_\+\+T\+C\+P\+\_\+\+R\+E\+L\+A\+Y\+\_\+\+P\+O\+R\+T\+S\+\_\+\+C\+O\+U\+N\+T@{D\+E\+F\+A\+U\+L\+T\+\_\+\+T\+C\+P\+\_\+\+R\+E\+L\+A\+Y\+\_\+\+P\+O\+R\+T\+S\+\_\+\+C\+O\+U\+N\+T}}
\index{D\+E\+F\+A\+U\+L\+T\+\_\+\+T\+C\+P\+\_\+\+R\+E\+L\+A\+Y\+\_\+\+P\+O\+R\+T\+S\+\_\+\+C\+O\+U\+N\+T@{D\+E\+F\+A\+U\+L\+T\+\_\+\+T\+C\+P\+\_\+\+R\+E\+L\+A\+Y\+\_\+\+P\+O\+R\+T\+S\+\_\+\+C\+O\+U\+N\+T}!tox-\/bootstrapd.\+c@{tox-\/bootstrapd.\+c}}
\subsubsection[{D\+E\+F\+A\+U\+L\+T\+\_\+\+T\+C\+P\+\_\+\+R\+E\+L\+A\+Y\+\_\+\+P\+O\+R\+T\+S\+\_\+\+C\+O\+U\+N\+T}]{\setlength{\rightskip}{0pt plus 5cm}\#define D\+E\+F\+A\+U\+L\+T\+\_\+\+T\+C\+P\+\_\+\+R\+E\+L\+A\+Y\+\_\+\+P\+O\+R\+T\+S\+\_\+\+C\+O\+U\+N\+T~3}}\label{tox-bootstrapd_8c_a8cd528f2dfb339311387dcb43608ceef}


Definition at line 69 of file tox-\/bootstrapd.\+c.



Referenced by parse\+\_\+tcp\+\_\+relay\+\_\+ports\+\_\+config().

\hypertarget{tox-bootstrapd_8c_a83828e6f5b4b788b1781b298a3a221cd}{\index{tox-\/bootstrapd.\+c@{tox-\/bootstrapd.\+c}!M\+A\+X\+\_\+\+A\+L\+L\+O\+W\+E\+D\+\_\+\+P\+O\+R\+T@{M\+A\+X\+\_\+\+A\+L\+L\+O\+W\+E\+D\+\_\+\+P\+O\+R\+T}}
\index{M\+A\+X\+\_\+\+A\+L\+L\+O\+W\+E\+D\+\_\+\+P\+O\+R\+T@{M\+A\+X\+\_\+\+A\+L\+L\+O\+W\+E\+D\+\_\+\+P\+O\+R\+T}!tox-\/bootstrapd.\+c@{tox-\/bootstrapd.\+c}}
\subsubsection[{M\+A\+X\+\_\+\+A\+L\+L\+O\+W\+E\+D\+\_\+\+P\+O\+R\+T}]{\setlength{\rightskip}{0pt plus 5cm}\#define M\+A\+X\+\_\+\+A\+L\+L\+O\+W\+E\+D\+\_\+\+P\+O\+R\+T~65535}}\label{tox-bootstrapd_8c_a83828e6f5b4b788b1781b298a3a221cd}


Definition at line 74 of file tox-\/bootstrapd.\+c.



Referenced by bootstrap\+\_\+from\+\_\+config(), main(), and parse\+\_\+tcp\+\_\+relay\+\_\+ports\+\_\+config().

\hypertarget{tox-bootstrapd_8c_a3ef213aa33f9321104faf75dfe823623}{\index{tox-\/bootstrapd.\+c@{tox-\/bootstrapd.\+c}!M\+I\+N\+\_\+\+A\+L\+L\+O\+W\+E\+D\+\_\+\+P\+O\+R\+T@{M\+I\+N\+\_\+\+A\+L\+L\+O\+W\+E\+D\+\_\+\+P\+O\+R\+T}}
\index{M\+I\+N\+\_\+\+A\+L\+L\+O\+W\+E\+D\+\_\+\+P\+O\+R\+T@{M\+I\+N\+\_\+\+A\+L\+L\+O\+W\+E\+D\+\_\+\+P\+O\+R\+T}!tox-\/bootstrapd.\+c@{tox-\/bootstrapd.\+c}}
\subsubsection[{M\+I\+N\+\_\+\+A\+L\+L\+O\+W\+E\+D\+\_\+\+P\+O\+R\+T}]{\setlength{\rightskip}{0pt plus 5cm}\#define M\+I\+N\+\_\+\+A\+L\+L\+O\+W\+E\+D\+\_\+\+P\+O\+R\+T~1}}\label{tox-bootstrapd_8c_a3ef213aa33f9321104faf75dfe823623}


Definition at line 73 of file tox-\/bootstrapd.\+c.



Referenced by bootstrap\+\_\+from\+\_\+config(), main(), and parse\+\_\+tcp\+\_\+relay\+\_\+ports\+\_\+config().

\hypertarget{tox-bootstrapd_8c_acc8612feeec5f569b1e096e3110d0dca}{\index{tox-\/bootstrapd.\+c@{tox-\/bootstrapd.\+c}!sleep@{sleep}}
\index{sleep@{sleep}!tox-\/bootstrapd.\+c@{tox-\/bootstrapd.\+c}}
\subsubsection[{sleep}]{\setlength{\rightskip}{0pt plus 5cm}\#define sleep~usleep(1000$\ast${\bf S\+L\+E\+E\+P\+\_\+\+T\+I\+M\+E\+\_\+\+M\+I\+L\+L\+I\+S\+E\+C\+O\+N\+D\+S})}}\label{tox-bootstrapd_8c_acc8612feeec5f569b1e096e3110d0dca}


Definition at line 59 of file tox-\/bootstrapd.\+c.



Referenced by main().

\hypertarget{tox-bootstrapd_8c_afb56b9187945a9a5a8ae0b48fb918b37}{\index{tox-\/bootstrapd.\+c@{tox-\/bootstrapd.\+c}!S\+L\+E\+E\+P\+\_\+\+T\+I\+M\+E\+\_\+\+M\+I\+L\+L\+I\+S\+E\+C\+O\+N\+D\+S@{S\+L\+E\+E\+P\+\_\+\+T\+I\+M\+E\+\_\+\+M\+I\+L\+L\+I\+S\+E\+C\+O\+N\+D\+S}}
\index{S\+L\+E\+E\+P\+\_\+\+T\+I\+M\+E\+\_\+\+M\+I\+L\+L\+I\+S\+E\+C\+O\+N\+D\+S@{S\+L\+E\+E\+P\+\_\+\+T\+I\+M\+E\+\_\+\+M\+I\+L\+L\+I\+S\+E\+C\+O\+N\+D\+S}!tox-\/bootstrapd.\+c@{tox-\/bootstrapd.\+c}}
\subsubsection[{S\+L\+E\+E\+P\+\_\+\+T\+I\+M\+E\+\_\+\+M\+I\+L\+L\+I\+S\+E\+C\+O\+N\+D\+S}]{\setlength{\rightskip}{0pt plus 5cm}\#define S\+L\+E\+E\+P\+\_\+\+T\+I\+M\+E\+\_\+\+M\+I\+L\+L\+I\+S\+E\+C\+O\+N\+D\+S~30}}\label{tox-bootstrapd_8c_afb56b9187945a9a5a8ae0b48fb918b37}


Definition at line 58 of file tox-\/bootstrapd.\+c.



\subsection{Function Documentation}
\hypertarget{tox-bootstrapd_8c_a3b29f8b1522a8d051f35cc76a54f846a}{\index{tox-\/bootstrapd.\+c@{tox-\/bootstrapd.\+c}!bootstrap\+\_\+from\+\_\+config@{bootstrap\+\_\+from\+\_\+config}}
\index{bootstrap\+\_\+from\+\_\+config@{bootstrap\+\_\+from\+\_\+config}!tox-\/bootstrapd.\+c@{tox-\/bootstrapd.\+c}}
\subsubsection[{bootstrap\+\_\+from\+\_\+config}]{\setlength{\rightskip}{0pt plus 5cm}int bootstrap\+\_\+from\+\_\+config (
\begin{DoxyParamCaption}
\item[{const char $\ast$}]{cfg\+\_\+file\+\_\+path, }
\item[{{\bf D\+H\+T} $\ast$}]{dht, }
\item[{int}]{enable\+\_\+ipv6}
\end{DoxyParamCaption}
)}}\label{tox-bootstrapd_8c_a3b29f8b1522a8d051f35cc76a54f846a}


Definition at line 398 of file tox-\/bootstrapd.\+c.



References D\+H\+T\+\_\+bootstrap\+\_\+from\+\_\+address(), hex\+\_\+string\+\_\+to\+\_\+bin(), i, L\+O\+G\+\_\+\+D\+E\+B\+U\+G, L\+O\+G\+\_\+\+W\+A\+R\+N\+I\+N\+G, M\+A\+X\+\_\+\+A\+L\+L\+O\+W\+E\+D\+\_\+\+P\+O\+R\+T, and M\+I\+N\+\_\+\+A\+L\+L\+O\+W\+E\+D\+\_\+\+P\+O\+R\+T.



Referenced by main().


\begin{DoxyCode}
399 \{
400     \textcolor{keyword}{const} \textcolor{keywordtype}{char} *NAME\_BOOTSTRAP\_NODES = \textcolor{stringliteral}{"bootstrap\_nodes"};
401 
402     \textcolor{keyword}{const} \textcolor{keywordtype}{char} *NAME\_PUBLIC\_KEY = \textcolor{stringliteral}{"public\_key"};
403     \textcolor{keyword}{const} \textcolor{keywordtype}{char} *NAME\_PORT       = \textcolor{stringliteral}{"port"};
404     \textcolor{keyword}{const} \textcolor{keywordtype}{char} *NAME\_ADDRESS    = \textcolor{stringliteral}{"address"};
405 
406     config\_t cfg;
407 
408     config\_init(&cfg);
409 
410     \textcolor{keywordflow}{if} (config\_read\_file(&cfg, cfg\_file\_path) == CONFIG\_FALSE) \{
411         syslog(LOG\_ERR, \textcolor{stringliteral}{"%s:%d - %s\(\backslash\)n"}, config\_error\_file(&cfg), config\_error\_line(&cfg), config\_error\_text
      (&cfg));
412         config\_destroy(&cfg);
413         \textcolor{keywordflow}{return} 0;
414     \}
415 
416     config\_setting\_t *node\_list = config\_lookup(&cfg, NAME\_BOOTSTRAP\_NODES);
417 
418     \textcolor{keywordflow}{if} (node\_list == NULL) \{
419         syslog(\hyperlink{logger_8h_aa5a9053636a30269210c54e734e0d583a8f6fe15bfe15104da6d1b360194a5400}{LOG\_WARNING}, \textcolor{stringliteral}{"No '%s' setting in the configuration file. Skipping bootstrapping.
      \(\backslash\)n"}, NAME\_BOOTSTRAP\_NODES);
420         config\_destroy(&cfg);
421         \textcolor{keywordflow}{return} 1;
422     \}
423 
424     \textcolor{keywordflow}{if} (config\_setting\_length(node\_list) == 0) \{
425         syslog(\hyperlink{logger_8h_aa5a9053636a30269210c54e734e0d583a8f6fe15bfe15104da6d1b360194a5400}{LOG\_WARNING}, \textcolor{stringliteral}{"No bootstrap nodes found. Skipping bootstrapping.\(\backslash\)n"});
426         config\_destroy(&cfg);
427         \textcolor{keywordflow}{return} 1;
428     \}
429 
430     \textcolor{keywordtype}{int} bs\_port;
431     \textcolor{keyword}{const} \textcolor{keywordtype}{char} *bs\_address;
432     \textcolor{keyword}{const} \textcolor{keywordtype}{char} *bs\_public\_key;
433 
434     config\_setting\_t *node;
435 
436     \textcolor{keywordtype}{int} \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i} = 0;
437 
438     \textcolor{keywordflow}{while} (config\_setting\_length(node\_list)) \{
439 
440         node = config\_setting\_get\_elem(node\_list, 0);
441 
442         \textcolor{keywordflow}{if} (node == NULL) \{
443             config\_destroy(&cfg);
444             \textcolor{keywordflow}{return} 0;
445         \}
446 
447         \textcolor{comment}{// Check that all settings are present}
448         \textcolor{keywordflow}{if} (config\_setting\_lookup\_string(node, NAME\_PUBLIC\_KEY, &bs\_public\_key) == CONFIG\_FALSE) \{
449             syslog(\hyperlink{logger_8h_aa5a9053636a30269210c54e734e0d583a8f6fe15bfe15104da6d1b360194a5400}{LOG\_WARNING}, \textcolor{stringliteral}{"Bootstrap node #%d: Couldn't find '%s' setting. Skipping the
       node.\(\backslash\)n"}, i, NAME\_PUBLIC\_KEY);
450             \textcolor{keywordflow}{goto} next;
451         \}
452 
453         \textcolor{keywordflow}{if} (config\_setting\_lookup\_int(node, NAME\_PORT, &bs\_port) == CONFIG\_FALSE) \{
454             syslog(\hyperlink{logger_8h_aa5a9053636a30269210c54e734e0d583a8f6fe15bfe15104da6d1b360194a5400}{LOG\_WARNING}, \textcolor{stringliteral}{"Bootstrap node #%d: Couldn't find '%s' setting. Skipping the
       node.\(\backslash\)n"}, i, NAME\_PORT);
455             \textcolor{keywordflow}{goto} next;
456         \}
457 
458         \textcolor{keywordflow}{if} (config\_setting\_lookup\_string(node, NAME\_ADDRESS, &bs\_address) == CONFIG\_FALSE) \{
459             syslog(\hyperlink{logger_8h_aa5a9053636a30269210c54e734e0d583a8f6fe15bfe15104da6d1b360194a5400}{LOG\_WARNING}, \textcolor{stringliteral}{"Bootstrap node #%d: Couldn't find '%s' setting. Skipping the
       node.\(\backslash\)n"}, i, NAME\_ADDRESS);
460             \textcolor{keywordflow}{goto} next;
461         \}
462 
463         \textcolor{comment}{// Process settings}
464         \textcolor{keywordflow}{if} (strlen(bs\_public\_key) != crypto\_box\_PUBLICKEYBYTES * 2) \{
465             syslog(\hyperlink{logger_8h_aa5a9053636a30269210c54e734e0d583a8f6fe15bfe15104da6d1b360194a5400}{LOG\_WARNING}, \textcolor{stringliteral}{"Bootstrap node #%d: Invalid '%s': %s. Skipping the node.\(\backslash\)n"}, i,
       NAME\_PUBLIC\_KEY,
466                    bs\_public\_key);
467             \textcolor{keywordflow}{goto} next;
468         \}
469 
470         \textcolor{keywordflow}{if} (bs\_port < MIN\_ALLOWED\_PORT || bs\_port > \hyperlink{tox-bootstrapd_8c_a83828e6f5b4b788b1781b298a3a221cd}{MAX\_ALLOWED\_PORT}) \{
471             syslog(\hyperlink{logger_8h_aa5a9053636a30269210c54e734e0d583a8f6fe15bfe15104da6d1b360194a5400}{LOG\_WARNING}, \textcolor{stringliteral}{"Bootstrap node #%d: Invalid '%s': %d, should be in [%d, %d].
       Skipping the node.\(\backslash\)n"}, i, NAME\_PORT,
472                    bs\_port, \hyperlink{tox-bootstrapd_8c_a3ef213aa33f9321104faf75dfe823623}{MIN\_ALLOWED\_PORT}, MAX\_ALLOWED\_PORT);
473             \textcolor{keywordflow}{goto} next;
474         \}
475 
476         uint8\_t *bs\_public\_key\_bin = \hyperlink{misc__tools_8c_aff7dee3cea854d8a56b5a29f77910f96}{hex\_string\_to\_bin}((\textcolor{keywordtype}{char} *)bs\_public\_key);
477         \textcolor{keyword}{const} \textcolor{keywordtype}{int} address\_resolved = \hyperlink{_d_h_t_8c_af342c78837dbed569d4a75a0516455fc}{DHT\_bootstrap\_from\_address}(dht, bs\_address, 
      enable\_ipv6, htons(bs\_port),
478                                      bs\_public\_key\_bin);
479         free(bs\_public\_key\_bin);
480 
481         \textcolor{keywordflow}{if} (!address\_resolved) \{
482             syslog(\hyperlink{logger_8h_aa5a9053636a30269210c54e734e0d583a8f6fe15bfe15104da6d1b360194a5400}{LOG\_WARNING}, \textcolor{stringliteral}{"Bootstrap node #%d: Invalid '%s': %s. Skipping the node.\(\backslash\)n"}, i,
       NAME\_ADDRESS, bs\_address);
483             \textcolor{keywordflow}{goto} next;
484         \}
485 
486         syslog(\hyperlink{logger_8h_aa5a9053636a30269210c54e734e0d583ab9f002c6ffbfd511da8090213227454e}{LOG\_DEBUG}, \textcolor{stringliteral}{"Successfully added bootstrap node #%d: %s:%d %s\(\backslash\)n"}, i, bs\_address, 
      bs\_port, bs\_public\_key);
487 
488 next:
489         \textcolor{comment}{// config\_setting\_lookup\_string() allocates string inside and doesn't allow us to free it direcly}
490         \textcolor{comment}{// though it's freed when the element is removed, so we free it right away in order to keep memory}
491         \textcolor{comment}{// consumption minimal}
492         config\_setting\_remove\_elem(node\_list, 0);
493         i++;
494     \}
495 
496     config\_destroy(&cfg);
497 
498     \textcolor{keywordflow}{return} 1;
499 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d1/d36/tox-bootstrapd_8c_a3b29f8b1522a8d051f35cc76a54f846a_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=267pt]{d1/d36/tox-bootstrapd_8c_a3b29f8b1522a8d051f35cc76a54f846a_icgraph}
\end{center}
\end{figure}


\hypertarget{tox-bootstrapd_8c_a6d074c4305e232b55bc9894bef6dc957}{\index{tox-\/bootstrapd.\+c@{tox-\/bootstrapd.\+c}!get\+\_\+general\+\_\+config@{get\+\_\+general\+\_\+config}}
\index{get\+\_\+general\+\_\+config@{get\+\_\+general\+\_\+config}!tox-\/bootstrapd.\+c@{tox-\/bootstrapd.\+c}}
\subsubsection[{get\+\_\+general\+\_\+config}]{\setlength{\rightskip}{0pt plus 5cm}int get\+\_\+general\+\_\+config (
\begin{DoxyParamCaption}
\item[{const char $\ast$}]{cfg\+\_\+file\+\_\+path, }
\item[{char $\ast$$\ast$}]{pid\+\_\+file\+\_\+path, }
\item[{char $\ast$$\ast$}]{keys\+\_\+file\+\_\+path, }
\item[{int $\ast$}]{port, }
\item[{int $\ast$}]{enable\+\_\+ipv6, }
\item[{int $\ast$}]{enable\+\_\+ipv4\+\_\+fallback, }
\item[{int $\ast$}]{enable\+\_\+lan\+\_\+discovery, }
\item[{int $\ast$}]{enable\+\_\+tcp\+\_\+relay, }
\item[{uint16\+\_\+t $\ast$$\ast$}]{tcp\+\_\+relay\+\_\+ports, }
\item[{int $\ast$}]{tcp\+\_\+relay\+\_\+port\+\_\+count, }
\item[{int $\ast$}]{enable\+\_\+motd, }
\item[{char $\ast$$\ast$}]{motd}
\end{DoxyParamCaption}
)}}\label{tox-bootstrapd_8c_a6d074c4305e232b55bc9894bef6dc957}


Definition at line 239 of file tox-\/bootstrapd.\+c.



References D\+E\+F\+A\+U\+L\+T\+\_\+\+E\+N\+A\+B\+L\+E\+\_\+\+I\+P\+V4\+\_\+\+F\+A\+L\+L\+B\+A\+C\+K, D\+E\+F\+A\+U\+L\+T\+\_\+\+E\+N\+A\+B\+L\+E\+\_\+\+I\+P\+V6, D\+E\+F\+A\+U\+L\+T\+\_\+\+E\+N\+A\+B\+L\+E\+\_\+\+L\+A\+N\+\_\+\+D\+I\+S\+C\+O\+V\+E\+R\+Y, D\+E\+F\+A\+U\+L\+T\+\_\+\+E\+N\+A\+B\+L\+E\+\_\+\+M\+O\+T\+D, D\+E\+F\+A\+U\+L\+T\+\_\+\+E\+N\+A\+B\+L\+E\+\_\+\+T\+C\+P\+\_\+\+R\+E\+L\+A\+Y, D\+E\+F\+A\+U\+L\+T\+\_\+\+K\+E\+Y\+S\+\_\+\+F\+I\+L\+E\+\_\+\+P\+A\+T\+H, D\+E\+F\+A\+U\+L\+T\+\_\+\+M\+O\+T\+D, D\+E\+F\+A\+U\+L\+T\+\_\+\+P\+I\+D\+\_\+\+F\+I\+L\+E\+\_\+\+P\+A\+T\+H, D\+E\+F\+A\+U\+L\+T\+\_\+\+P\+O\+R\+T, i, L\+O\+G\+\_\+\+D\+E\+B\+U\+G, L\+O\+G\+\_\+\+W\+A\+R\+N\+I\+N\+G, M\+A\+X\+\_\+\+M\+O\+T\+D\+\_\+\+L\+E\+N\+G\+T\+H, and parse\+\_\+tcp\+\_\+relay\+\_\+ports\+\_\+config().



Referenced by main().


\begin{DoxyCode}
243 \{
244     config\_t cfg;
245 
246     \textcolor{keyword}{const} \textcolor{keywordtype}{char} *NAME\_PORT                 = \textcolor{stringliteral}{"port"};
247     \textcolor{keyword}{const} \textcolor{keywordtype}{char} *NAME\_PID\_FILE\_PATH        = \textcolor{stringliteral}{"pid\_file\_path"};
248     \textcolor{keyword}{const} \textcolor{keywordtype}{char} *NAME\_KEYS\_FILE\_PATH       = \textcolor{stringliteral}{"keys\_file\_path"};
249     \textcolor{keyword}{const} \textcolor{keywordtype}{char} *NAME\_ENABLE\_IPV6          = \textcolor{stringliteral}{"enable\_ipv6"};
250     \textcolor{keyword}{const} \textcolor{keywordtype}{char} *NAME\_ENABLE\_IPV4\_FALLBACK = \textcolor{stringliteral}{"enable\_ipv4\_fallback"};
251     \textcolor{keyword}{const} \textcolor{keywordtype}{char} *NAME\_ENABLE\_LAN\_DISCOVERY = \textcolor{stringliteral}{"enable\_lan\_discovery"};
252     \textcolor{keyword}{const} \textcolor{keywordtype}{char} *NAME\_ENABLE\_TCP\_RELAY     = \textcolor{stringliteral}{"enable\_tcp\_relay"};
253     \textcolor{keyword}{const} \textcolor{keywordtype}{char} *NAME\_ENABLE\_MOTD          = \textcolor{stringliteral}{"enable\_motd"};
254     \textcolor{keyword}{const} \textcolor{keywordtype}{char} *NAME\_MOTD                 = \textcolor{stringliteral}{"motd"};
255 
256     config\_init(&cfg);
257 
258     \textcolor{comment}{// Read the file. If there is an error, report it and exit.}
259     \textcolor{keywordflow}{if} (config\_read\_file(&cfg, cfg\_file\_path) == CONFIG\_FALSE) \{
260         syslog(LOG\_ERR, \textcolor{stringliteral}{"%s:%d - %s\(\backslash\)n"}, config\_error\_file(&cfg), config\_error\_line(&cfg), config\_error\_text
      (&cfg));
261         config\_destroy(&cfg);
262         \textcolor{keywordflow}{return} 0;
263     \}
264 
265     \textcolor{comment}{// Get port}
266     \textcolor{keywordflow}{if} (config\_lookup\_int(&cfg, NAME\_PORT, \hyperlink{irc__syncbot_8c_a8e0798404bf2cf5dabb84c5ba9a4f236}{port}) == CONFIG\_FALSE) \{
267         syslog(\hyperlink{logger_8h_aa5a9053636a30269210c54e734e0d583a8f6fe15bfe15104da6d1b360194a5400}{LOG\_WARNING}, \textcolor{stringliteral}{"No '%s' setting in configuration file.\(\backslash\)n"}, NAME\_PORT);
268         syslog(\hyperlink{logger_8h_aa5a9053636a30269210c54e734e0d583a8f6fe15bfe15104da6d1b360194a5400}{LOG\_WARNING}, \textcolor{stringliteral}{"Using default '%s': %d\(\backslash\)n"}, NAME\_PORT, 
      \hyperlink{tox-bootstrapd_8c_a16b710f592bf8f7900666392adc444dc}{DEFAULT\_PORT});
269         *\hyperlink{irc__syncbot_8c_a8e0798404bf2cf5dabb84c5ba9a4f236}{port} = \hyperlink{tox-bootstrapd_8c_a16b710f592bf8f7900666392adc444dc}{DEFAULT\_PORT};
270     \}
271 
272     \textcolor{comment}{// Get PID file location}
273     \textcolor{keyword}{const} \textcolor{keywordtype}{char} *tmp\_pid\_file;
274 
275     \textcolor{keywordflow}{if} (config\_lookup\_string(&cfg, NAME\_PID\_FILE\_PATH, &tmp\_pid\_file) == CONFIG\_FALSE) \{
276         syslog(\hyperlink{logger_8h_aa5a9053636a30269210c54e734e0d583a8f6fe15bfe15104da6d1b360194a5400}{LOG\_WARNING}, \textcolor{stringliteral}{"No '%s' setting in configuration file.\(\backslash\)n"}, NAME\_PID\_FILE\_PATH);
277         syslog(\hyperlink{logger_8h_aa5a9053636a30269210c54e734e0d583a8f6fe15bfe15104da6d1b360194a5400}{LOG\_WARNING}, \textcolor{stringliteral}{"Using default '%s': %s\(\backslash\)n"}, NAME\_PID\_FILE\_PATH, 
      \hyperlink{tox-bootstrapd_8c_a3229500bf4d840c088746e1a6482210d}{DEFAULT\_PID\_FILE\_PATH});
278         tmp\_pid\_file = \hyperlink{tox-bootstrapd_8c_a3229500bf4d840c088746e1a6482210d}{DEFAULT\_PID\_FILE\_PATH};
279     \}
280 
281     *pid\_file\_path = malloc(strlen(tmp\_pid\_file) + 1);
282     strcpy(*pid\_file\_path, tmp\_pid\_file);
283 
284     \textcolor{comment}{// Get keys file location}
285     \textcolor{keyword}{const} \textcolor{keywordtype}{char} *tmp\_keys\_file;
286 
287     \textcolor{keywordflow}{if} (config\_lookup\_string(&cfg, NAME\_KEYS\_FILE\_PATH, &tmp\_keys\_file) == CONFIG\_FALSE) \{
288         syslog(\hyperlink{logger_8h_aa5a9053636a30269210c54e734e0d583a8f6fe15bfe15104da6d1b360194a5400}{LOG\_WARNING}, \textcolor{stringliteral}{"No '%s' setting in configuration file.\(\backslash\)n"}, NAME\_KEYS\_FILE\_PATH);
289         syslog(\hyperlink{logger_8h_aa5a9053636a30269210c54e734e0d583a8f6fe15bfe15104da6d1b360194a5400}{LOG\_WARNING}, \textcolor{stringliteral}{"Using default '%s': %s\(\backslash\)n"}, NAME\_KEYS\_FILE\_PATH, 
      \hyperlink{tox-bootstrapd_8c_a1bdc61234638275814834465df95908a}{DEFAULT\_KEYS\_FILE\_PATH});
290         tmp\_keys\_file = \hyperlink{tox-bootstrapd_8c_a1bdc61234638275814834465df95908a}{DEFAULT\_KEYS\_FILE\_PATH};
291     \}
292 
293     *keys\_file\_path = malloc(strlen(tmp\_keys\_file) + 1);
294     strcpy(*keys\_file\_path, tmp\_keys\_file);
295 
296     \textcolor{comment}{// Get IPv6 option}
297     \textcolor{keywordflow}{if} (config\_lookup\_bool(&cfg, NAME\_ENABLE\_IPV6, enable\_ipv6) == CONFIG\_FALSE) \{
298         syslog(\hyperlink{logger_8h_aa5a9053636a30269210c54e734e0d583a8f6fe15bfe15104da6d1b360194a5400}{LOG\_WARNING}, \textcolor{stringliteral}{"No '%s' setting in configuration file.\(\backslash\)n"}, NAME\_ENABLE\_IPV6);
299         syslog(\hyperlink{logger_8h_aa5a9053636a30269210c54e734e0d583a8f6fe15bfe15104da6d1b360194a5400}{LOG\_WARNING}, \textcolor{stringliteral}{"Using default '%s': %s\(\backslash\)n"}, NAME\_ENABLE\_IPV6, 
      \hyperlink{tox-bootstrapd_8c_a67663ba00c576efce1226a3fd856cba6}{DEFAULT\_ENABLE\_IPV6} ? \textcolor{stringliteral}{"true"} : \textcolor{stringliteral}{"false"});
300         *enable\_ipv6 = \hyperlink{tox-bootstrapd_8c_a67663ba00c576efce1226a3fd856cba6}{DEFAULT\_ENABLE\_IPV6};
301     \}
302 
303     \textcolor{comment}{// Get IPv4 fallback option}
304     \textcolor{keywordflow}{if} (config\_lookup\_bool(&cfg, NAME\_ENABLE\_IPV4\_FALLBACK, enable\_ipv4\_fallback) == CONFIG\_FALSE) \{
305         syslog(\hyperlink{logger_8h_aa5a9053636a30269210c54e734e0d583a8f6fe15bfe15104da6d1b360194a5400}{LOG\_WARNING}, \textcolor{stringliteral}{"No '%s' setting in configuration file.\(\backslash\)n"}, 
      NAME\_ENABLE\_IPV4\_FALLBACK);
306         syslog(\hyperlink{logger_8h_aa5a9053636a30269210c54e734e0d583a8f6fe15bfe15104da6d1b360194a5400}{LOG\_WARNING}, \textcolor{stringliteral}{"Using default '%s': %s\(\backslash\)n"}, NAME\_ENABLE\_IPV4\_FALLBACK,
307                \hyperlink{tox-bootstrapd_8c_a51d848d37bbf1d506ca14f83ddd2e342}{DEFAULT\_ENABLE\_IPV4\_FALLBACK} ? \textcolor{stringliteral}{"true"} : \textcolor{stringliteral}{"false"});
308         *enable\_ipv4\_fallback = \hyperlink{tox-bootstrapd_8c_a51d848d37bbf1d506ca14f83ddd2e342}{DEFAULT\_ENABLE\_IPV4\_FALLBACK};
309     \}
310 
311     \textcolor{comment}{// Get LAN discovery option}
312     \textcolor{keywordflow}{if} (config\_lookup\_bool(&cfg, NAME\_ENABLE\_LAN\_DISCOVERY, enable\_lan\_discovery) == CONFIG\_FALSE) \{
313         syslog(\hyperlink{logger_8h_aa5a9053636a30269210c54e734e0d583a8f6fe15bfe15104da6d1b360194a5400}{LOG\_WARNING}, \textcolor{stringliteral}{"No '%s' setting in configuration file.\(\backslash\)n"}, 
      NAME\_ENABLE\_LAN\_DISCOVERY);
314         syslog(\hyperlink{logger_8h_aa5a9053636a30269210c54e734e0d583a8f6fe15bfe15104da6d1b360194a5400}{LOG\_WARNING}, \textcolor{stringliteral}{"Using default '%s': %s\(\backslash\)n"}, NAME\_ENABLE\_LAN\_DISCOVERY,
315                \hyperlink{tox-bootstrapd_8c_a78c8c9f7a2ece92a6e6cab895c88962e}{DEFAULT\_ENABLE\_LAN\_DISCOVERY} ? \textcolor{stringliteral}{"true"} : \textcolor{stringliteral}{"false"});
316         *enable\_lan\_discovery = \hyperlink{tox-bootstrapd_8c_a78c8c9f7a2ece92a6e6cab895c88962e}{DEFAULT\_ENABLE\_LAN\_DISCOVERY};
317     \}
318 
319     \textcolor{comment}{// Get TCP relay option}
320     \textcolor{keywordflow}{if} (config\_lookup\_bool(&cfg, NAME\_ENABLE\_TCP\_RELAY, enable\_tcp\_relay) == CONFIG\_FALSE) \{
321         syslog(\hyperlink{logger_8h_aa5a9053636a30269210c54e734e0d583a8f6fe15bfe15104da6d1b360194a5400}{LOG\_WARNING}, \textcolor{stringliteral}{"No '%s' setting in configuration file.\(\backslash\)n"}, NAME\_ENABLE\_TCP\_RELAY);
322         syslog(\hyperlink{logger_8h_aa5a9053636a30269210c54e734e0d583a8f6fe15bfe15104da6d1b360194a5400}{LOG\_WARNING}, \textcolor{stringliteral}{"Using default '%s': %s\(\backslash\)n"}, NAME\_ENABLE\_TCP\_RELAY,
323                \hyperlink{tox-bootstrapd_8c_acfa79b0cd7c40eb8d55462d8b8fa0e17}{DEFAULT\_ENABLE\_TCP\_RELAY} ? \textcolor{stringliteral}{"true"} : \textcolor{stringliteral}{"false"});
324         *enable\_tcp\_relay = \hyperlink{tox-bootstrapd_8c_acfa79b0cd7c40eb8d55462d8b8fa0e17}{DEFAULT\_ENABLE\_TCP\_RELAY};
325     \}
326 
327     \textcolor{keywordflow}{if} (*enable\_tcp\_relay) \{
328         \hyperlink{tox-bootstrapd_8c_a21026d73be31f649ba809b1c56cbdbe6}{parse\_tcp\_relay\_ports\_config}(&cfg, tcp\_relay\_ports, 
      tcp\_relay\_port\_count);
329     \} \textcolor{keywordflow}{else} \{
330         *tcp\_relay\_port\_count = 0;
331     \}
332 
333     \textcolor{comment}{// Get MOTD option}
334     \textcolor{keywordflow}{if} (config\_lookup\_bool(&cfg, NAME\_ENABLE\_MOTD, enable\_motd) == CONFIG\_FALSE) \{
335         syslog(\hyperlink{logger_8h_aa5a9053636a30269210c54e734e0d583a8f6fe15bfe15104da6d1b360194a5400}{LOG\_WARNING}, \textcolor{stringliteral}{"No '%s' setting in configuration file.\(\backslash\)n"}, NAME\_ENABLE\_MOTD);
336         syslog(\hyperlink{logger_8h_aa5a9053636a30269210c54e734e0d583a8f6fe15bfe15104da6d1b360194a5400}{LOG\_WARNING}, \textcolor{stringliteral}{"Using default '%s': %s\(\backslash\)n"}, NAME\_ENABLE\_MOTD,
337                \hyperlink{tox-bootstrapd_8c_a1014d7c1334195d6330fb4b7d05d210c}{DEFAULT\_ENABLE\_MOTD} ? \textcolor{stringliteral}{"true"} : \textcolor{stringliteral}{"false"});
338         *enable\_motd = \hyperlink{tox-bootstrapd_8c_a1014d7c1334195d6330fb4b7d05d210c}{DEFAULT\_ENABLE\_MOTD};
339     \}
340 
341     \textcolor{keywordflow}{if} (*enable\_motd) \{
342         \textcolor{comment}{// Get MOTD}
343         \textcolor{keyword}{const} \textcolor{keywordtype}{char} *tmp\_motd;
344 
345         \textcolor{keywordflow}{if} (config\_lookup\_string(&cfg, NAME\_MOTD, &tmp\_motd) == CONFIG\_FALSE) \{
346             syslog(\hyperlink{logger_8h_aa5a9053636a30269210c54e734e0d583a8f6fe15bfe15104da6d1b360194a5400}{LOG\_WARNING}, \textcolor{stringliteral}{"No '%s' setting in configuration file.\(\backslash\)n"}, NAME\_MOTD);
347             syslog(\hyperlink{logger_8h_aa5a9053636a30269210c54e734e0d583a8f6fe15bfe15104da6d1b360194a5400}{LOG\_WARNING}, \textcolor{stringliteral}{"Using default '%s': %s\(\backslash\)n"}, NAME\_MOTD, 
      \hyperlink{tox-bootstrapd_8c_a91de4e54937ebc70859c64e252a85941}{DEFAULT\_MOTD});
348             tmp\_motd = \hyperlink{tox-bootstrapd_8c_a91de4e54937ebc70859c64e252a85941}{DEFAULT\_MOTD};
349         \}
350 
351         \textcolor{keywordtype}{size\_t} tmp\_motd\_length = strlen(tmp\_motd) + 1;
352         \textcolor{keywordtype}{size\_t} motd\_length = tmp\_motd\_length > \hyperlink{bootstrap__node__packets_8c_aa75b75f88f6c7c32c4c23631de425982}{MAX\_MOTD\_LENGTH} ? 
      \hyperlink{bootstrap__node__packets_8c_aa75b75f88f6c7c32c4c23631de425982}{MAX\_MOTD\_LENGTH} : tmp\_motd\_length;
353         *\hyperlink{namespacebootstrap__node__info_aa2d2b1afbc1ef82443acef646943f3fe}{motd} = malloc(motd\_length);
354         strncpy(*\hyperlink{namespacebootstrap__node__info_aa2d2b1afbc1ef82443acef646943f3fe}{motd}, tmp\_motd, motd\_length);
355         (*motd)[motd\_length - 1] = \textcolor{charliteral}{'\(\backslash\)0'};
356     \}
357 
358     config\_destroy(&cfg);
359 
360     syslog(\hyperlink{logger_8h_aa5a9053636a30269210c54e734e0d583ab9f002c6ffbfd511da8090213227454e}{LOG\_DEBUG}, \textcolor{stringliteral}{"Successfully read:\(\backslash\)n"});
361     syslog(\hyperlink{logger_8h_aa5a9053636a30269210c54e734e0d583ab9f002c6ffbfd511da8090213227454e}{LOG\_DEBUG}, \textcolor{stringliteral}{"'%s': %s\(\backslash\)n"}, NAME\_PID\_FILE\_PATH,        *pid\_file\_path);
362     syslog(\hyperlink{logger_8h_aa5a9053636a30269210c54e734e0d583ab9f002c6ffbfd511da8090213227454e}{LOG\_DEBUG}, \textcolor{stringliteral}{"'%s': %s\(\backslash\)n"}, NAME\_KEYS\_FILE\_PATH,       *keys\_file\_path);
363     syslog(\hyperlink{logger_8h_aa5a9053636a30269210c54e734e0d583ab9f002c6ffbfd511da8090213227454e}{LOG\_DEBUG}, \textcolor{stringliteral}{"'%s': %d\(\backslash\)n"}, NAME\_PORT,                 *\hyperlink{irc__syncbot_8c_a8e0798404bf2cf5dabb84c5ba9a4f236}{port});
364     syslog(\hyperlink{logger_8h_aa5a9053636a30269210c54e734e0d583ab9f002c6ffbfd511da8090213227454e}{LOG\_DEBUG}, \textcolor{stringliteral}{"'%s': %s\(\backslash\)n"}, NAME\_ENABLE\_IPV6,          *enable\_ipv6          ? \textcolor{stringliteral}{"true"} : \textcolor{stringliteral}{"
      false"});
365     syslog(\hyperlink{logger_8h_aa5a9053636a30269210c54e734e0d583ab9f002c6ffbfd511da8090213227454e}{LOG\_DEBUG}, \textcolor{stringliteral}{"'%s': %s\(\backslash\)n"}, NAME\_ENABLE\_IPV4\_FALLBACK, *enable\_ipv4\_fallback ? \textcolor{stringliteral}{"true"} : \textcolor{stringliteral}{"
      false"});
366     syslog(\hyperlink{logger_8h_aa5a9053636a30269210c54e734e0d583ab9f002c6ffbfd511da8090213227454e}{LOG\_DEBUG}, \textcolor{stringliteral}{"'%s': %s\(\backslash\)n"}, NAME\_ENABLE\_LAN\_DISCOVERY, *enable\_lan\_discovery ? \textcolor{stringliteral}{"true"} : \textcolor{stringliteral}{"
      false"});
367 
368     syslog(\hyperlink{logger_8h_aa5a9053636a30269210c54e734e0d583ab9f002c6ffbfd511da8090213227454e}{LOG\_DEBUG}, \textcolor{stringliteral}{"'%s': %s\(\backslash\)n"}, NAME\_ENABLE\_TCP\_RELAY,     *enable\_tcp\_relay     ? \textcolor{stringliteral}{"true"} : \textcolor{stringliteral}{"
      false"});
369 
370     \textcolor{comment}{// show info about tcp ports only if tcp relay is enabled}
371     \textcolor{keywordflow}{if} (*enable\_tcp\_relay) \{
372         \textcolor{keywordflow}{if} (*tcp\_relay\_port\_count == 0) \{
373             syslog(\hyperlink{logger_8h_aa5a9053636a30269210c54e734e0d583ab9f002c6ffbfd511da8090213227454e}{LOG\_DEBUG}, \textcolor{stringliteral}{"No TCP ports could be read.\(\backslash\)n"});
374         \} \textcolor{keywordflow}{else} \{
375             syslog(\hyperlink{logger_8h_aa5a9053636a30269210c54e734e0d583ab9f002c6ffbfd511da8090213227454e}{LOG\_DEBUG}, \textcolor{stringliteral}{"Read %d TCP ports:\(\backslash\)n"}, *tcp\_relay\_port\_count);
376             \textcolor{keywordtype}{int} \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
377 
378             \textcolor{keywordflow}{for} (i = 0; i < *tcp\_relay\_port\_count; i ++) \{
379                 syslog(\hyperlink{logger_8h_aa5a9053636a30269210c54e734e0d583ab9f002c6ffbfd511da8090213227454e}{LOG\_DEBUG}, \textcolor{stringliteral}{"Port #%d: %u\(\backslash\)n"}, i, (*tcp\_relay\_ports)[i]);
380             \}
381         \}
382     \}
383 
384     syslog(\hyperlink{logger_8h_aa5a9053636a30269210c54e734e0d583ab9f002c6ffbfd511da8090213227454e}{LOG\_DEBUG}, \textcolor{stringliteral}{"'%s': %s\(\backslash\)n"}, NAME\_ENABLE\_MOTD,          *enable\_motd          ? \textcolor{stringliteral}{"true"} : \textcolor{stringliteral}{"
      false"});
385 
386     \textcolor{keywordflow}{if} (*enable\_motd) \{
387         syslog(\hyperlink{logger_8h_aa5a9053636a30269210c54e734e0d583ab9f002c6ffbfd511da8090213227454e}{LOG\_DEBUG}, \textcolor{stringliteral}{"'%s': %s\(\backslash\)n"}, NAME\_MOTD, *\hyperlink{namespacebootstrap__node__info_aa2d2b1afbc1ef82443acef646943f3fe}{motd});
388     \}
389 
390     \textcolor{keywordflow}{return} 1;
391 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=327pt]{d1/d36/tox-bootstrapd_8c_a6d074c4305e232b55bc9894bef6dc957_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=252pt]{d1/d36/tox-bootstrapd_8c_a6d074c4305e232b55bc9894bef6dc957_icgraph}
\end{center}
\end{figure}


\hypertarget{tox-bootstrapd_8c_a0ddf1224851353fc92bfbff6f499fa97}{\index{tox-\/bootstrapd.\+c@{tox-\/bootstrapd.\+c}!main@{main}}
\index{main@{main}!tox-\/bootstrapd.\+c@{tox-\/bootstrapd.\+c}}
\subsubsection[{main}]{\setlength{\rightskip}{0pt plus 5cm}int main (
\begin{DoxyParamCaption}
\item[{int}]{argc, }
\item[{char $\ast$}]{argv\mbox{[}$\,$\mbox{]}}
\end{DoxyParamCaption}
)}}\label{tox-bootstrapd_8c_a0ddf1224851353fc92bfbff6f499fa97}


Definition at line 519 of file tox-\/bootstrapd.\+c.



References bootstrap\+\_\+from\+\_\+config(), bootstrap\+\_\+set\+\_\+callbacks(), D\+A\+E\+M\+O\+N\+\_\+\+N\+A\+M\+E, D\+A\+E\+M\+O\+N\+\_\+\+V\+E\+R\+S\+I\+O\+N\+\_\+\+N\+U\+M\+B\+E\+R, D\+H\+T\+\_\+isconnected(), do\+\_\+\+D\+H\+T(), do\+\_\+\+T\+C\+P\+\_\+server(), get\+\_\+general\+\_\+config(), ip, ip\+\_\+init(), is\+\_\+timeout(), L\+A\+N\+\_\+\+D\+I\+S\+C\+O\+V\+E\+R\+Y\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L, L\+A\+Ndiscovery\+\_\+init(), L\+O\+G\+\_\+\+D\+E\+B\+U\+G, L\+O\+G\+\_\+\+I\+N\+F\+O, manage\+\_\+keys(), M\+A\+X\+\_\+\+A\+L\+L\+O\+W\+E\+D\+\_\+\+P\+O\+R\+T, M\+I\+N\+\_\+\+A\+L\+L\+O\+W\+E\+D\+\_\+\+P\+O\+R\+T, bootstrap\+\_\+node\+\_\+info\+::motd, D\+H\+T\+::net, networking\+\_\+poll(), new\+\_\+\+D\+H\+T(), new\+\_\+networking(), new\+\_\+onion(), new\+\_\+onion\+\_\+announce(), new\+\_\+\+T\+C\+P\+\_\+server(), port, print\+\_\+public\+\_\+key(), D\+H\+T\+::self\+\_\+public\+\_\+key, D\+H\+T\+::self\+\_\+secret\+\_\+key, send\+\_\+\+L\+A\+Ndiscovery(), sleep, and unix\+\_\+time().


\begin{DoxyCode}
520 \{
521     openlog(\hyperlink{tox-bootstrapd_8c_a5ea777c6fb1dd39fda46cdf97a6949a5}{DAEMON\_NAME}, LOG\_NOWAIT | LOG\_PID, LOG\_DAEMON);
522 
523     syslog(\hyperlink{logger_8h_aa5a9053636a30269210c54e734e0d583a6e98ff471e3ce6c4ef2d75c37ee51837}{LOG\_INFO}, \textcolor{stringliteral}{"Running \(\backslash\)"%s\(\backslash\)" version %lu.\(\backslash\)n"}, \hyperlink{tox-bootstrapd_8c_a5ea777c6fb1dd39fda46cdf97a6949a5}{DAEMON\_NAME}, 
      \hyperlink{tox-bootstrapd_8c_a63112447ca129c284247c8b29b32b838}{DAEMON\_VERSION\_NUMBER});
524 
525     \textcolor{keywordflow}{if} (argc < 2) \{
526         syslog(LOG\_ERR, \textcolor{stringliteral}{"Please specify a path to a configuration file as the first argument. Exiting.\(\backslash\)n"});
527         \textcolor{keywordflow}{return} 1;
528     \}
529 
530     \textcolor{keyword}{const} \textcolor{keywordtype}{char} *cfg\_file\_path = argv[1];
531     \textcolor{keywordtype}{char} *pid\_file\_path, *keys\_file\_path;
532     \textcolor{keywordtype}{int} \hyperlink{irc__syncbot_8c_a8e0798404bf2cf5dabb84c5ba9a4f236}{port};
533     \textcolor{keywordtype}{int} enable\_ipv6;
534     \textcolor{keywordtype}{int} enable\_ipv4\_fallback;
535     \textcolor{keywordtype}{int} enable\_lan\_discovery;
536     \textcolor{keywordtype}{int} enable\_tcp\_relay;
537     uint16\_t *tcp\_relay\_ports;
538     \textcolor{keywordtype}{int} tcp\_relay\_port\_count;
539     \textcolor{keywordtype}{int} enable\_motd;
540     \textcolor{keywordtype}{char} *\hyperlink{namespacebootstrap__node__info_aa2d2b1afbc1ef82443acef646943f3fe}{motd};
541 
542     \textcolor{keywordflow}{if} (\hyperlink{tox-bootstrapd_8c_a6d074c4305e232b55bc9894bef6dc957}{get\_general\_config}(cfg\_file\_path, &pid\_file\_path, &keys\_file\_path, &port, &
      enable\_ipv6, &enable\_ipv4\_fallback,
543                            &enable\_lan\_discovery, &enable\_tcp\_relay, &tcp\_relay\_ports, &
      tcp\_relay\_port\_count, &enable\_motd, &motd)) \{
544         syslog(\hyperlink{logger_8h_aa5a9053636a30269210c54e734e0d583ab9f002c6ffbfd511da8090213227454e}{LOG\_DEBUG}, \textcolor{stringliteral}{"General config read successfully\(\backslash\)n"});
545     \} \textcolor{keywordflow}{else} \{
546         syslog(LOG\_ERR, \textcolor{stringliteral}{"Couldn't read config file: %s. Exiting.\(\backslash\)n"}, cfg\_file\_path);
547         \textcolor{keywordflow}{return} 1;
548     \}
549 
550     \textcolor{keywordflow}{if} (port < MIN\_ALLOWED\_PORT || port > \hyperlink{tox-bootstrapd_8c_a83828e6f5b4b788b1781b298a3a221cd}{MAX\_ALLOWED\_PORT}) \{
551         syslog(LOG\_ERR, \textcolor{stringliteral}{"Invalid port: %d, should be in [%d, %d]. Exiting.\(\backslash\)n"}, port, 
      \hyperlink{tox-bootstrapd_8c_a3ef213aa33f9321104faf75dfe823623}{MIN\_ALLOWED\_PORT}, MAX\_ALLOWED\_PORT);
552         \textcolor{keywordflow}{return} 1;
553     \}
554 
555     \textcolor{comment}{// Check if the PID file exists}
556     FILE *pid\_file;
557 
558     \textcolor{keywordflow}{if} ((pid\_file = fopen(pid\_file\_path, \textcolor{stringliteral}{"r"}))) \{
559         syslog(LOG\_ERR, \textcolor{stringliteral}{"Another instance of the daemon is already running, PID file %s exists.\(\backslash\)n"}, 
      pid\_file\_path);
560         fclose(pid\_file);
561     \}
562 
563     \hyperlink{struct_i_p}{IP} \hyperlink{irc__syncbot_8c_ae81515e082f9bc33e8968181945586da}{ip};
564     \hyperlink{network_8c_a6aa0dce9c25e370af93bf4a14f79c709}{ip\_init}(&ip, enable\_ipv6);
565 
566     \hyperlink{struct_networking___core}{Networking\_Core} *net = \hyperlink{network_8c_a0c272a560dd4b2c18c6546a91656c1b5}{new\_networking}(ip, port);
567 
568     \textcolor{keywordflow}{if} (net == NULL) \{
569         \textcolor{keywordflow}{if} (enable\_ipv6 && enable\_ipv4\_fallback) \{
570             syslog(\hyperlink{logger_8h_aa5a9053636a30269210c54e734e0d583ab9f002c6ffbfd511da8090213227454e}{LOG\_DEBUG}, \textcolor{stringliteral}{"Couldn't initialize IPv6 networking. Falling back to using IPv4.\(\backslash\)n"}
      );
571             enable\_ipv6 = 0;
572             \hyperlink{network_8c_a6aa0dce9c25e370af93bf4a14f79c709}{ip\_init}(&ip, enable\_ipv6);
573             net = \hyperlink{network_8c_a0c272a560dd4b2c18c6546a91656c1b5}{new\_networking}(ip, port);
574 
575             \textcolor{keywordflow}{if} (net == NULL) \{
576                 syslog(\hyperlink{logger_8h_aa5a9053636a30269210c54e734e0d583ab9f002c6ffbfd511da8090213227454e}{LOG\_DEBUG}, \textcolor{stringliteral}{"Couldn't fallback to IPv4. Exiting.\(\backslash\)n"});
577                 \textcolor{keywordflow}{return} 1;
578             \}
579         \} \textcolor{keywordflow}{else} \{
580             syslog(\hyperlink{logger_8h_aa5a9053636a30269210c54e734e0d583ab9f002c6ffbfd511da8090213227454e}{LOG\_DEBUG}, \textcolor{stringliteral}{"Couldn't initialize networking. Exiting.\(\backslash\)n"});
581             \textcolor{keywordflow}{return} 1;
582         \}
583     \}
584 
585 
586     \hyperlink{struct_d_h_t}{DHT} *dht = \hyperlink{_d_h_t_8c_adad04fa897751b06948a172044bf1c58}{new\_DHT}(net);
587 
588     \textcolor{keywordflow}{if} (dht == NULL) \{
589         syslog(LOG\_ERR, \textcolor{stringliteral}{"Couldn't initialize Tox DHT instance. Exiting.\(\backslash\)n"});
590         \textcolor{keywordflow}{return} 1;
591     \}
592 
593     \hyperlink{struct_onion}{Onion} *onion = \hyperlink{onion_8c_a71877ec5931feec418ed1ae10b0963d8}{new\_onion}(dht);
594     \hyperlink{struct_onion___announce}{Onion\_Announce} *onion\_a = \hyperlink{onion__announce_8c_a1807a1d99b93e29c2a27648afe3e6c2c}{new\_onion\_announce}(dht);
595 
596     \textcolor{keywordflow}{if} (!(onion && onion\_a)) \{
597         syslog(LOG\_ERR, \textcolor{stringliteral}{"Couldn't initialize Tox Onion. Exiting.\(\backslash\)n"});
598         \textcolor{keywordflow}{return} 1;
599     \}
600 
601     \textcolor{keywordflow}{if} (enable\_motd) \{
602         \textcolor{keywordflow}{if} (\hyperlink{bootstrap__node__packets_8c_af45f0ce6a723f57dc9f667f2fcd4772c}{bootstrap\_set\_callbacks}(dht->\hyperlink{struct_d_h_t_aa14ea2f67950f57fe4235d7375a2216c}{net}, 
      \hyperlink{tox-bootstrapd_8c_a63112447ca129c284247c8b29b32b838}{DAEMON\_VERSION\_NUMBER}, (uint8\_t *)motd, strlen(motd) + 1) == 0) \{
603             syslog(\hyperlink{logger_8h_aa5a9053636a30269210c54e734e0d583ab9f002c6ffbfd511da8090213227454e}{LOG\_DEBUG}, \textcolor{stringliteral}{"Set MOTD successfully.\(\backslash\)n"});
604         \} \textcolor{keywordflow}{else} \{
605             syslog(LOG\_ERR, \textcolor{stringliteral}{"Couldn't set MOTD: %s. Exiting.\(\backslash\)n"}, motd);
606             \textcolor{keywordflow}{return} 1;
607         \}
608 
609         free(motd);
610     \}
611 
612     \textcolor{keywordflow}{if} (\hyperlink{tox-bootstrapd_8c_a0a4dac6d686a3a976d578eb81322a81e}{manage\_keys}(dht, keys\_file\_path)) \{
613         syslog(\hyperlink{logger_8h_aa5a9053636a30269210c54e734e0d583ab9f002c6ffbfd511da8090213227454e}{LOG\_DEBUG}, \textcolor{stringliteral}{"Keys are managed successfully.\(\backslash\)n"});
614     \} \textcolor{keywordflow}{else} \{
615         syslog(LOG\_ERR, \textcolor{stringliteral}{"Couldn't read/write: %s. Exiting.\(\backslash\)n"}, keys\_file\_path);
616         \textcolor{keywordflow}{return} 1;
617     \}
618 
619     \hyperlink{struct_t_c_p___server}{TCP\_Server} *tcp\_server = NULL;
620 
621     \textcolor{keywordflow}{if} (enable\_tcp\_relay) \{
622         \textcolor{keywordflow}{if} (tcp\_relay\_port\_count == 0) \{
623             syslog(LOG\_ERR, \textcolor{stringliteral}{"No TCP relay ports read. Exiting.\(\backslash\)n"});
624             \textcolor{keywordflow}{return} 1;
625         \}
626 
627         tcp\_server = \hyperlink{_t_c_p__server_8c_a148e632f4c51645cbc1b414bc3584b60}{new\_TCP\_server}(enable\_ipv6, tcp\_relay\_port\_count, tcp\_relay\_ports, dht->
      \hyperlink{struct_d_h_t_aa05050f86513ff53fe9da81f73c72267}{self\_secret\_key}, onion);
628 
629         \textcolor{comment}{// tcp\_relay\_port\_count != 0 at this point}
630         free(tcp\_relay\_ports);
631 
632         \textcolor{keywordflow}{if} (tcp\_server != NULL) \{
633             syslog(\hyperlink{logger_8h_aa5a9053636a30269210c54e734e0d583ab9f002c6ffbfd511da8090213227454e}{LOG\_DEBUG}, \textcolor{stringliteral}{"Initialized Tox TCP server successfully.\(\backslash\)n"});
634         \} \textcolor{keywordflow}{else} \{
635             syslog(LOG\_ERR, \textcolor{stringliteral}{"Couldn't initialize Tox TCP server. Exiting.\(\backslash\)n"});
636             \textcolor{keywordflow}{return} 1;
637         \}
638     \}
639 
640     \textcolor{keywordflow}{if} (\hyperlink{tox-bootstrapd_8c_a3b29f8b1522a8d051f35cc76a54f846a}{bootstrap\_from\_config}(cfg\_file\_path, dht, enable\_ipv6)) \{
641         syslog(\hyperlink{logger_8h_aa5a9053636a30269210c54e734e0d583ab9f002c6ffbfd511da8090213227454e}{LOG\_DEBUG}, \textcolor{stringliteral}{"List of bootstrap nodes read successfully.\(\backslash\)n"});
642     \} \textcolor{keywordflow}{else} \{
643         syslog(LOG\_ERR, \textcolor{stringliteral}{"Couldn't read list of bootstrap nodes in %s. Exiting.\(\backslash\)n"}, cfg\_file\_path);
644         \textcolor{keywordflow}{return} 1;
645     \}
646 
647     \hyperlink{tox-bootstrapd_8c_adac86c780017ad2c55d81005ba02ac89}{print\_public\_key}(dht->\hyperlink{struct_d_h_t_ae726df8bdc26380e5a6c3187a00d6881}{self\_public\_key});
648 
649     \textcolor{comment}{// Write the PID file}
650     FILE *pidf = fopen(pid\_file\_path, \textcolor{stringliteral}{"a+"});
651 
652     \textcolor{keywordflow}{if} (pidf == NULL) \{
653         syslog(LOG\_ERR, \textcolor{stringliteral}{"Couldn't open the PID file for writing: %s. Exiting.\(\backslash\)n"}, pid\_file\_path);
654         \textcolor{keywordflow}{return} 1;
655     \}
656 
657     free(pid\_file\_path);
658     free(keys\_file\_path);
659 
660     \textcolor{comment}{// Fork off from the parent process}
661     \textcolor{keyword}{const} pid\_t pid = fork();
662 
663     \textcolor{keywordflow}{if} (pid > 0) \{
664         fprintf(pidf, \textcolor{stringliteral}{"%d"}, pid);
665         fclose(pidf);
666         syslog(\hyperlink{logger_8h_aa5a9053636a30269210c54e734e0d583ab9f002c6ffbfd511da8090213227454e}{LOG\_DEBUG}, \textcolor{stringliteral}{"Forked successfully: PID: %d.\(\backslash\)n"}, pid);
667         \textcolor{keywordflow}{return} 0;
668     \} \textcolor{keywordflow}{else} \{
669         fclose(pidf);
670     \}
671 
672     \textcolor{keywordflow}{if} (pid < 0) \{
673         syslog(LOG\_ERR, \textcolor{stringliteral}{"Forking failed. Exiting.\(\backslash\)n"});
674         \textcolor{keywordflow}{return} 1;
675     \}
676 
677     \textcolor{comment}{// Change the file mode mask}
678     umask(0);
679 
680     \textcolor{comment}{// Create a new SID for the child process}
681     \textcolor{keywordflow}{if} (setsid() < 0) \{
682         syslog(LOG\_ERR, \textcolor{stringliteral}{"SID creation failure. Exiting.\(\backslash\)n"});
683         \textcolor{keywordflow}{return} 1;
684     \}
685 
686     \textcolor{comment}{// Change the current working directory}
687     \textcolor{keywordflow}{if} ((chdir(\textcolor{stringliteral}{"/"})) < 0) \{
688         syslog(LOG\_ERR, \textcolor{stringliteral}{"Couldn't change working directory to '/'. Exiting.\(\backslash\)n"});
689         \textcolor{keywordflow}{return} 1;
690     \}
691 
692     \textcolor{comment}{// Go quiet}
693     close(STDOUT\_FILENO);
694     close(STDIN\_FILENO);
695     close(STDERR\_FILENO);
696 
697     uint64\_t last\_LANdiscovery = 0;
698     \textcolor{keyword}{const} uint16\_t htons\_port = htons(port);
699 
700     \textcolor{keywordtype}{int} waiting\_for\_dht\_connection = 1;
701 
702     \textcolor{keywordflow}{if} (enable\_lan\_discovery) \{
703         \hyperlink{_l_a_n__discovery_8c_ab5177e8d5fc82b7c156f777f13649912}{LANdiscovery\_init}(dht);
704         syslog(\hyperlink{logger_8h_aa5a9053636a30269210c54e734e0d583ab9f002c6ffbfd511da8090213227454e}{LOG\_DEBUG}, \textcolor{stringliteral}{"Initialized LAN discovery.\(\backslash\)n"});
705     \}
706 
707     \textcolor{keywordflow}{while} (1) \{
708         \hyperlink{_d_h_t_8c_a5be9dfb66fbf1fa7c267b016f3357534}{do\_DHT}(dht);
709 
710         \textcolor{keywordflow}{if} (enable\_lan\_discovery && \hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(last\_LANdiscovery, 
      \hyperlink{_l_a_n__discovery_8h_a603390b71ba701f06b39520052b813c4}{LAN\_DISCOVERY\_INTERVAL})) \{
711             \hyperlink{_l_a_n__discovery_8c_a929a14971d13e5aad2661e834e406391}{send\_LANdiscovery}(htons\_port, dht);
712             last\_LANdiscovery = \hyperlink{util_8c_ac958d9f8847cb8039444bfa3d304233a}{unix\_time}();
713         \}
714 
715         \textcolor{keywordflow}{if} (enable\_tcp\_relay) \{
716             \hyperlink{_t_c_p__server_8c_a40e8a0302a359dd4f712eb1e9c346fe5}{do\_TCP\_server}(tcp\_server);
717         \}
718 
719         \hyperlink{network_8c_ab6765fe4b08536210a20ac728f991e13}{networking\_poll}(dht->\hyperlink{struct_d_h_t_aa14ea2f67950f57fe4235d7375a2216c}{net});
720 
721         \textcolor{keywordflow}{if} (waiting\_for\_dht\_connection && \hyperlink{_d_h_t_8c_a93770fe498d41d1c6b420275680967b6}{DHT\_isconnected}(dht)) \{
722             syslog(\hyperlink{logger_8h_aa5a9053636a30269210c54e734e0d583ab9f002c6ffbfd511da8090213227454e}{LOG\_DEBUG}, \textcolor{stringliteral}{"Connected to other bootstrap node successfully.\(\backslash\)n"});
723             waiting\_for\_dht\_connection = 0;
724         \}
725 
726         \hyperlink{tox-bootstrapd_8c_acc8612feeec5f569b1e096e3110d0dca}{sleep};
727     \}
728 
729     \textcolor{keywordflow}{return} 1;
730 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=550pt]{d1/d36/tox-bootstrapd_8c_a0ddf1224851353fc92bfbff6f499fa97_cgraph}
\end{center}
\end{figure}


\hypertarget{tox-bootstrapd_8c_a0a4dac6d686a3a976d578eb81322a81e}{\index{tox-\/bootstrapd.\+c@{tox-\/bootstrapd.\+c}!manage\+\_\+keys@{manage\+\_\+keys}}
\index{manage\+\_\+keys@{manage\+\_\+keys}!tox-\/bootstrapd.\+c@{tox-\/bootstrapd.\+c}}
\subsubsection[{manage\+\_\+keys}]{\setlength{\rightskip}{0pt plus 5cm}int manage\+\_\+keys (
\begin{DoxyParamCaption}
\item[{{\bf D\+H\+T} $\ast$}]{dht, }
\item[{char $\ast$}]{keys\+\_\+file\+\_\+path}
\end{DoxyParamCaption}
)}}\label{tox-bootstrapd_8c_a0a4dac6d686a3a976d578eb81322a81e}


Definition at line 82 of file tox-\/bootstrapd.\+c.



References D\+H\+T\+::self\+\_\+public\+\_\+key, and D\+H\+T\+::self\+\_\+secret\+\_\+key.



Referenced by main().


\begin{DoxyCode}
83 \{
84     \textcolor{keyword}{const} uint32\_t KEYS\_SIZE = crypto\_box\_PUBLICKEYBYTES + crypto\_box\_SECRETKEYBYTES;
85     uint8\_t keys[KEYS\_SIZE];
86     FILE *keys\_file;
87 
88     \textcolor{comment}{// Check if file exits, proceed to open and load keys}
89     keys\_file = fopen(keys\_file\_path, \textcolor{stringliteral}{"r"});
90 
91     \textcolor{keywordflow}{if} (keys\_file != NULL) \{
92         \textcolor{keyword}{const} \textcolor{keywordtype}{size\_t} read\_size = fread(keys, \textcolor{keyword}{sizeof}(uint8\_t), KEYS\_SIZE, keys\_file);
93 
94         \textcolor{keywordflow}{if} (read\_size != KEYS\_SIZE) \{
95             fclose(keys\_file);
96             \textcolor{keywordflow}{return} 0;
97         \}
98 
99         memcpy(dht->\hyperlink{struct_d_h_t_ae726df8bdc26380e5a6c3187a00d6881}{self\_public\_key}, keys, crypto\_box\_PUBLICKEYBYTES);
100         memcpy(dht->\hyperlink{struct_d_h_t_aa05050f86513ff53fe9da81f73c72267}{self\_secret\_key}, keys + crypto\_box\_PUBLICKEYBYTES, 
      crypto\_box\_SECRETKEYBYTES);
101     \} \textcolor{keywordflow}{else} \{
102         \textcolor{comment}{// Otherwise save new keys}
103         memcpy(keys, dht->\hyperlink{struct_d_h_t_ae726df8bdc26380e5a6c3187a00d6881}{self\_public\_key}, crypto\_box\_PUBLICKEYBYTES);
104         memcpy(keys + crypto\_box\_PUBLICKEYBYTES, dht->\hyperlink{struct_d_h_t_aa05050f86513ff53fe9da81f73c72267}{self\_secret\_key}, 
      crypto\_box\_SECRETKEYBYTES);
105 
106         keys\_file = fopen(keys\_file\_path, \textcolor{stringliteral}{"w"});
107 
108         \textcolor{keywordflow}{if} (!keys\_file)
109             \textcolor{keywordflow}{return} 0;
110 
111         \textcolor{keyword}{const} \textcolor{keywordtype}{size\_t} write\_size = fwrite(keys, \textcolor{keyword}{sizeof}(uint8\_t), KEYS\_SIZE, keys\_file);
112 
113         \textcolor{keywordflow}{if} (write\_size != KEYS\_SIZE) \{
114             fclose(keys\_file);
115             \textcolor{keywordflow}{return} 0;
116         \}
117     \}
118 
119     fclose(keys\_file);
120 
121     \textcolor{keywordflow}{return} 1;
122 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=231pt]{d1/d36/tox-bootstrapd_8c_a0a4dac6d686a3a976d578eb81322a81e_icgraph}
\end{center}
\end{figure}


\hypertarget{tox-bootstrapd_8c_a21026d73be31f649ba809b1c56cbdbe6}{\index{tox-\/bootstrapd.\+c@{tox-\/bootstrapd.\+c}!parse\+\_\+tcp\+\_\+relay\+\_\+ports\+\_\+config@{parse\+\_\+tcp\+\_\+relay\+\_\+ports\+\_\+config}}
\index{parse\+\_\+tcp\+\_\+relay\+\_\+ports\+\_\+config@{parse\+\_\+tcp\+\_\+relay\+\_\+ports\+\_\+config}!tox-\/bootstrapd.\+c@{tox-\/bootstrapd.\+c}}
\subsubsection[{parse\+\_\+tcp\+\_\+relay\+\_\+ports\+\_\+config}]{\setlength{\rightskip}{0pt plus 5cm}void parse\+\_\+tcp\+\_\+relay\+\_\+ports\+\_\+config (
\begin{DoxyParamCaption}
\item[{config\+\_\+t $\ast$}]{cfg, }
\item[{uint16\+\_\+t $\ast$$\ast$}]{tcp\+\_\+relay\+\_\+ports, }
\item[{int $\ast$}]{tcp\+\_\+relay\+\_\+port\+\_\+count}
\end{DoxyParamCaption}
)}}\label{tox-bootstrapd_8c_a21026d73be31f649ba809b1c56cbdbe6}


Definition at line 130 of file tox-\/bootstrapd.\+c.



References D\+E\+F\+A\+U\+L\+T\+\_\+\+T\+C\+P\+\_\+\+R\+E\+L\+A\+Y\+\_\+\+P\+O\+R\+T\+S, D\+E\+F\+A\+U\+L\+T\+\_\+\+T\+C\+P\+\_\+\+R\+E\+L\+A\+Y\+\_\+\+P\+O\+R\+T\+S\+\_\+\+C\+O\+U\+N\+T, i, L\+O\+G\+\_\+\+W\+A\+R\+N\+I\+N\+G, M\+A\+X\+\_\+\+A\+L\+L\+O\+W\+E\+D\+\_\+\+P\+O\+R\+T, and M\+I\+N\+\_\+\+A\+L\+L\+O\+W\+E\+D\+\_\+\+P\+O\+R\+T.



Referenced by get\+\_\+general\+\_\+config().


\begin{DoxyCode}
131 \{
132     \textcolor{keyword}{const} \textcolor{keywordtype}{char} *NAME\_TCP\_RELAY\_PORTS = \textcolor{stringliteral}{"tcp\_relay\_ports"};
133 
134     *tcp\_relay\_port\_count = 0;
135 
136     config\_setting\_t *ports\_array = config\_lookup(cfg, NAME\_TCP\_RELAY\_PORTS);
137 
138     \textcolor{keywordflow}{if} (ports\_array == NULL) \{
139         syslog(\hyperlink{logger_8h_aa5a9053636a30269210c54e734e0d583a8f6fe15bfe15104da6d1b360194a5400}{LOG\_WARNING}, \textcolor{stringliteral}{"No '%s' setting in the configuration file.\(\backslash\)n"}, NAME\_TCP\_RELAY\_PORTS
      );
140         syslog(\hyperlink{logger_8h_aa5a9053636a30269210c54e734e0d583a8f6fe15bfe15104da6d1b360194a5400}{LOG\_WARNING}, \textcolor{stringliteral}{"Using default '%s':\(\backslash\)n"}, NAME\_TCP\_RELAY\_PORTS);
141 
142         uint16\_t default\_ports[\hyperlink{tox-bootstrapd_8c_a8cd528f2dfb339311387dcb43608ceef}{DEFAULT\_TCP\_RELAY\_PORTS\_COUNT}] = \{
      \hyperlink{tox-bootstrapd_8c_a2d597b4c5dbb34d2f7e5387e8aa8d13d}{DEFAULT\_TCP\_RELAY\_PORTS}\};
143 
144         \textcolor{keywordtype}{int} \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
145 
146         \textcolor{keywordflow}{for} (i = 0; i < \hyperlink{tox-bootstrapd_8c_a8cd528f2dfb339311387dcb43608ceef}{DEFAULT\_TCP\_RELAY\_PORTS\_COUNT}; i ++) \{
147             syslog(\hyperlink{logger_8h_aa5a9053636a30269210c54e734e0d583a8f6fe15bfe15104da6d1b360194a5400}{LOG\_WARNING}, \textcolor{stringliteral}{"Port #%d: %u\(\backslash\)n"}, i, default\_ports[i]);
148         \}
149 
150         \textcolor{comment}{// similar procedure to the one of reading config file below}
151         *tcp\_relay\_ports = malloc(DEFAULT\_TCP\_RELAY\_PORTS\_COUNT * \textcolor{keyword}{sizeof}(uint16\_t));
152 
153         \textcolor{keywordflow}{for} (i = 0; i < \hyperlink{tox-bootstrapd_8c_a8cd528f2dfb339311387dcb43608ceef}{DEFAULT\_TCP\_RELAY\_PORTS\_COUNT}; i ++) \{
154 
155             (*tcp\_relay\_ports)[*tcp\_relay\_port\_count] = default\_ports[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}];
156 
157             \textcolor{keywordflow}{if} ((*tcp\_relay\_ports)[*tcp\_relay\_port\_count] < \hyperlink{tox-bootstrapd_8c_a3ef213aa33f9321104faf75dfe823623}{MIN\_ALLOWED\_PORT}
158                     || (*tcp\_relay\_ports)[*tcp\_relay\_port\_count] > 
      \hyperlink{tox-bootstrapd_8c_a83828e6f5b4b788b1781b298a3a221cd}{MAX\_ALLOWED\_PORT}) \{
159                 syslog(\hyperlink{logger_8h_aa5a9053636a30269210c54e734e0d583a8f6fe15bfe15104da6d1b360194a5400}{LOG\_WARNING}, \textcolor{stringliteral}{"Port #%d: Invalid port: %u, should be in [%d, %d].
       Skipping.\(\backslash\)n"}, i,
160                        (*tcp\_relay\_ports)[*tcp\_relay\_port\_count], 
      \hyperlink{tox-bootstrapd_8c_a3ef213aa33f9321104faf75dfe823623}{MIN\_ALLOWED\_PORT}, \hyperlink{tox-bootstrapd_8c_a83828e6f5b4b788b1781b298a3a221cd}{MAX\_ALLOWED\_PORT});
161                 \textcolor{keywordflow}{continue};
162             \}
163 
164             (*tcp\_relay\_port\_count) ++;
165         \}
166 
167         \textcolor{comment}{// the loop above skips invalid ports, so we adjust the allocated memory size}
168         \textcolor{keywordflow}{if} ((*tcp\_relay\_port\_count) > 0) \{
169             *tcp\_relay\_ports = realloc(*tcp\_relay\_ports, (*tcp\_relay\_port\_count) * \textcolor{keyword}{sizeof}(uint16\_t));
170         \} \textcolor{keywordflow}{else} \{
171             free(*tcp\_relay\_ports);
172             *tcp\_relay\_ports = NULL;
173         \}
174 
175         \textcolor{keywordflow}{return};
176     \}
177 
178     \textcolor{keywordflow}{if} (config\_setting\_is\_array(ports\_array) == CONFIG\_FALSE) \{
179         syslog(\hyperlink{logger_8h_aa5a9053636a30269210c54e734e0d583a8f6fe15bfe15104da6d1b360194a5400}{LOG\_WARNING}, \textcolor{stringliteral}{"'%s' setting should be an array. Array syntax: 'setting = [value1,
       value2, ...]'.\(\backslash\)n"},
180                NAME\_TCP\_RELAY\_PORTS);
181         \textcolor{keywordflow}{return};
182     \}
183 
184     \textcolor{keywordtype}{int} config\_port\_count = config\_setting\_length(ports\_array);
185 
186     \textcolor{keywordflow}{if} (config\_port\_count == 0) \{
187         syslog(\hyperlink{logger_8h_aa5a9053636a30269210c54e734e0d583a8f6fe15bfe15104da6d1b360194a5400}{LOG\_WARNING}, \textcolor{stringliteral}{"'%s' is empty.\(\backslash\)n"}, NAME\_TCP\_RELAY\_PORTS);
188         \textcolor{keywordflow}{return};
189     \}
190 
191     *tcp\_relay\_ports = malloc(config\_port\_count * \textcolor{keyword}{sizeof}(uint16\_t));
192 
193     \textcolor{keywordtype}{int} \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
194 
195     \textcolor{keywordflow}{for} (i = 0; i < config\_port\_count; i ++) \{
196         config\_setting\_t *elem = config\_setting\_get\_elem(ports\_array, i);
197 
198         \textcolor{keywordflow}{if} (elem == NULL) \{
199             \textcolor{comment}{// it's NULL if `ports\_array` is not an array (we have that check earlier) or if `i` is out of
       range, which should not be}
200             syslog(\hyperlink{logger_8h_aa5a9053636a30269210c54e734e0d583a8f6fe15bfe15104da6d1b360194a5400}{LOG\_WARNING}, \textcolor{stringliteral}{"Port #%d: Something went wrong while parsing the port. Stopping
       reading ports.\(\backslash\)n"}, i);
201             \textcolor{keywordflow}{break};
202         \}
203 
204         \textcolor{keywordflow}{if} (config\_setting\_is\_number(elem) == CONFIG\_FALSE) \{
205             syslog(\hyperlink{logger_8h_aa5a9053636a30269210c54e734e0d583a8f6fe15bfe15104da6d1b360194a5400}{LOG\_WARNING}, \textcolor{stringliteral}{"Port #%d: Not a number. Skipping.\(\backslash\)n"}, i);
206             \textcolor{keywordflow}{continue};
207         \}
208 
209         (*tcp\_relay\_ports)[*tcp\_relay\_port\_count] = config\_setting\_get\_int(elem);
210 
211         \textcolor{keywordflow}{if} ((*tcp\_relay\_ports)[*tcp\_relay\_port\_count] < \hyperlink{tox-bootstrapd_8c_a3ef213aa33f9321104faf75dfe823623}{MIN\_ALLOWED\_PORT}
212                 || (*tcp\_relay\_ports)[*tcp\_relay\_port\_count] > \hyperlink{tox-bootstrapd_8c_a83828e6f5b4b788b1781b298a3a221cd}{MAX\_ALLOWED\_PORT}) \{
213             syslog(\hyperlink{logger_8h_aa5a9053636a30269210c54e734e0d583a8f6fe15bfe15104da6d1b360194a5400}{LOG\_WARNING}, \textcolor{stringliteral}{"Port #%d: Invalid port: %u, should be in [%d, %d]. Skipping.\(\backslash\)n"}
      , i,
214                    (*tcp\_relay\_ports)[*tcp\_relay\_port\_count], \hyperlink{tox-bootstrapd_8c_a3ef213aa33f9321104faf75dfe823623}{MIN\_ALLOWED\_PORT}, 
      \hyperlink{tox-bootstrapd_8c_a83828e6f5b4b788b1781b298a3a221cd}{MAX\_ALLOWED\_PORT});
215             \textcolor{keywordflow}{continue};
216         \}
217 
218         (*tcp\_relay\_port\_count) ++;
219     \}
220 
221     \textcolor{comment}{// the loop above skips invalid ports, so we adjust the allocated memory size}
222     \textcolor{keywordflow}{if} ((*tcp\_relay\_port\_count) > 0) \{
223         *tcp\_relay\_ports = realloc(*tcp\_relay\_ports, (*tcp\_relay\_port\_count) * \textcolor{keyword}{sizeof}(uint16\_t));
224     \} \textcolor{keywordflow}{else} \{
225         free(*tcp\_relay\_ports);
226         *tcp\_relay\_ports = NULL;
227     \}
228 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d1/d36/tox-bootstrapd_8c_a21026d73be31f649ba809b1c56cbdbe6_icgraph}
\end{center}
\end{figure}


\hypertarget{tox-bootstrapd_8c_adac86c780017ad2c55d81005ba02ac89}{\index{tox-\/bootstrapd.\+c@{tox-\/bootstrapd.\+c}!print\+\_\+public\+\_\+key@{print\+\_\+public\+\_\+key}}
\index{print\+\_\+public\+\_\+key@{print\+\_\+public\+\_\+key}!tox-\/bootstrapd.\+c@{tox-\/bootstrapd.\+c}}
\subsubsection[{print\+\_\+public\+\_\+key}]{\setlength{\rightskip}{0pt plus 5cm}void print\+\_\+public\+\_\+key (
\begin{DoxyParamCaption}
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key}
\end{DoxyParamCaption}
)}}\label{tox-bootstrapd_8c_adac86c780017ad2c55d81005ba02ac89}


Definition at line 503 of file tox-\/bootstrapd.\+c.



References i, and L\+O\+G\+\_\+\+I\+N\+F\+O.



Referenced by main().


\begin{DoxyCode}
504 \{
505     \textcolor{keywordtype}{char} buffer[2 * crypto\_box\_PUBLICKEYBYTES + 1];
506     \textcolor{keywordtype}{int} index = 0;
507 
508     \textcolor{keywordtype}{size\_t} \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
509 
510     \textcolor{keywordflow}{for} (i = 0; i < crypto\_box\_PUBLICKEYBYTES; i++) \{
511         index += sprintf(buffer + index, \textcolor{stringliteral}{"%02hhX"}, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}[i]);
512     \}
513 
514     syslog(\hyperlink{logger_8h_aa5a9053636a30269210c54e734e0d583a6e98ff471e3ce6c4ef2d75c37ee51837}{LOG\_INFO}, \textcolor{stringliteral}{"Public Key: %s\(\backslash\)n"}, buffer);
515 
516     \textcolor{keywordflow}{return};
517 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=241pt]{d1/d36/tox-bootstrapd_8c_adac86c780017ad2c55d81005ba02ac89_icgraph}
\end{center}
\end{figure}


