\hypertarget{_l_a_n__discovery_8c}{\section{toxcore/\+L\+A\+N\+\_\+discovery.c File Reference}
\label{_l_a_n__discovery_8c}\index{toxcore/\+L\+A\+N\+\_\+discovery.\+c@{toxcore/\+L\+A\+N\+\_\+discovery.\+c}}
}
{\ttfamily \#include \char`\"{}L\+A\+N\+\_\+discovery.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}util.\+h\char`\"{}}\\*
Include dependency graph for L\+A\+N\+\_\+discovery.\+c\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d7/dc2/_l_a_n__discovery_8c__incl}
\end{center}
\end{figure}
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{_l_a_n__discovery_8c_a10bf2917a6a4297e21e03f60c487f591}{M\+A\+X\+\_\+\+I\+N\+T\+E\+R\+F\+A\+C\+E\+S}~16
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
static void \hyperlink{_l_a_n__discovery_8c_a32a9c5eecb426198ce85d4f5d9abb3b9}{fetch\+\_\+broadcast\+\_\+info} (uint16\+\_\+t \hyperlink{irc__syncbot_8c_a8e0798404bf2cf5dabb84c5ba9a4f236}{port})
\item 
static uint32\+\_\+t \hyperlink{_l_a_n__discovery_8c_a1fc7e8d37a627f59ac5afa2c7b204568}{send\+\_\+broadcasts} (\hyperlink{struct_networking___core}{Networking\+\_\+\+Core} $\ast$net, uint16\+\_\+t \hyperlink{irc__syncbot_8c_a8e0798404bf2cf5dabb84c5ba9a4f236}{port}, const uint8\+\_\+t $\ast$data, uint16\+\_\+t length)
\item 
static \hyperlink{struct_i_p}{I\+P} \hyperlink{_l_a_n__discovery_8c_a9fa84b6ea98e56c412f2c45673c180cc}{broadcast\+\_\+ip} (sa\+\_\+family\+\_\+t family\+\_\+socket, sa\+\_\+family\+\_\+t family\+\_\+broadcast)
\item 
\+\_\+\+Bool \hyperlink{_l_a_n__discovery_8c_a56fb8ae3cd774c1b1d5670b9c4fb8959}{Local\+\_\+ip} (\hyperlink{struct_i_p}{I\+P} \hyperlink{irc__syncbot_8c_ae81515e082f9bc33e8968181945586da}{ip})
\item 
int \hyperlink{_l_a_n__discovery_8c_a2d80a53390598eb8ededbc63f4e9c152}{L\+A\+N\+\_\+ip} (\hyperlink{struct_i_p}{I\+P} \hyperlink{irc__syncbot_8c_ae81515e082f9bc33e8968181945586da}{ip})
\item 
static int \hyperlink{_l_a_n__discovery_8c_aeb11042ae0d160b28f8943da6ae29499}{handle\+\_\+\+L\+A\+Ndiscovery} (void $\ast$object, \hyperlink{struct_i_p___port}{I\+P\+\_\+\+Port} source, const uint8\+\_\+t $\ast$packet, uint16\+\_\+t length)
\item 
int \hyperlink{_l_a_n__discovery_8c_a929a14971d13e5aad2661e834e406391}{send\+\_\+\+L\+A\+Ndiscovery} (uint16\+\_\+t \hyperlink{irc__syncbot_8c_a8e0798404bf2cf5dabb84c5ba9a4f236}{port}, \hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht)
\item 
void \hyperlink{_l_a_n__discovery_8c_ab5177e8d5fc82b7c156f777f13649912}{L\+A\+Ndiscovery\+\_\+init} (\hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht)
\item 
void \hyperlink{_l_a_n__discovery_8c_af2a395c13cd4dff580e3638f41ef02d0}{L\+A\+Ndiscovery\+\_\+kill} (\hyperlink{struct_d_h_t}{D\+H\+T} $\ast$dht)
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
static int \hyperlink{_l_a_n__discovery_8c_aea1a218dd0a10d7769dd2cb6e5f3bd6e}{broadcast\+\_\+count} = -\/1
\item 
static \hyperlink{struct_i_p___port}{I\+P\+\_\+\+Port} \hyperlink{_l_a_n__discovery_8c_aa6a32d3f8b5409a706f2a3e17a54fe8d}{broadcast\+\_\+ip\+\_\+port} \mbox{[}\hyperlink{_l_a_n__discovery_8c_a10bf2917a6a4297e21e03f60c487f591}{M\+A\+X\+\_\+\+I\+N\+T\+E\+R\+F\+A\+C\+E\+S}\mbox{]}
\end{DoxyCompactItemize}


\subsection{Macro Definition Documentation}
\hypertarget{_l_a_n__discovery_8c_a10bf2917a6a4297e21e03f60c487f591}{\index{L\+A\+N\+\_\+discovery.\+c@{L\+A\+N\+\_\+discovery.\+c}!M\+A\+X\+\_\+\+I\+N\+T\+E\+R\+F\+A\+C\+E\+S@{M\+A\+X\+\_\+\+I\+N\+T\+E\+R\+F\+A\+C\+E\+S}}
\index{M\+A\+X\+\_\+\+I\+N\+T\+E\+R\+F\+A\+C\+E\+S@{M\+A\+X\+\_\+\+I\+N\+T\+E\+R\+F\+A\+C\+E\+S}!L\+A\+N\+\_\+discovery.\+c@{L\+A\+N\+\_\+discovery.\+c}}
\subsubsection[{M\+A\+X\+\_\+\+I\+N\+T\+E\+R\+F\+A\+C\+E\+S}]{\setlength{\rightskip}{0pt plus 5cm}\#define M\+A\+X\+\_\+\+I\+N\+T\+E\+R\+F\+A\+C\+E\+S~16}}\label{_l_a_n__discovery_8c_a10bf2917a6a4297e21e03f60c487f591}


Definition at line 38 of file L\+A\+N\+\_\+discovery.\+c.



\subsection{Function Documentation}
\hypertarget{_l_a_n__discovery_8c_a9fa84b6ea98e56c412f2c45673c180cc}{\index{L\+A\+N\+\_\+discovery.\+c@{L\+A\+N\+\_\+discovery.\+c}!broadcast\+\_\+ip@{broadcast\+\_\+ip}}
\index{broadcast\+\_\+ip@{broadcast\+\_\+ip}!L\+A\+N\+\_\+discovery.\+c@{L\+A\+N\+\_\+discovery.\+c}}
\subsubsection[{broadcast\+\_\+ip}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf I\+P} broadcast\+\_\+ip (
\begin{DoxyParamCaption}
\item[{sa\+\_\+family\+\_\+t}]{family\+\_\+socket, }
\item[{sa\+\_\+family\+\_\+t}]{family\+\_\+broadcast}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_l_a_n__discovery_8c_a9fa84b6ea98e56c412f2c45673c180cc}


Definition at line 199 of file L\+A\+N\+\_\+discovery.\+c.



References I\+P\+::family, ip, I\+P\+::ip4, I\+P\+::ip6, ip\+\_\+reset(), I\+P4\+::uint32, I\+P6\+::uint32, and I\+P6\+::uint8.



Referenced by send\+\_\+\+L\+A\+Ndiscovery().


\begin{DoxyCode}
200 \{
201     \hyperlink{struct_i_p}{IP} \hyperlink{irc__syncbot_8c_ae81515e082f9bc33e8968181945586da}{ip};
202     \hyperlink{network_8c_a2bfd1efbce5b035b10c879a7e85c08df}{ip\_reset}(&ip);
203 
204     \textcolor{keywordflow}{if} (family\_socket == AF\_INET6) \{
205         \textcolor{keywordflow}{if} (family\_broadcast == AF\_INET6) \{
206             ip.\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} = AF\_INET6;
207             \textcolor{comment}{/* FF02::1 is - according to RFC 4291 - multicast all-nodes link-local */}
208             \textcolor{comment}{/* FE80::*: MUST be exact, for that we would need to look over all}
209 \textcolor{comment}{             * interfaces and check in which status they are */}
210             ip.\hyperlink{struct_i_p_a14c606eb5ffb078c38ad854dc4e79507}{ip6}.\hyperlink{union_i_p6_a6b067d428eefbf1754aa09429b1ba524}{uint8}[ 0] = 0xFF;
211             ip.\hyperlink{struct_i_p_a14c606eb5ffb078c38ad854dc4e79507}{ip6}.\hyperlink{union_i_p6_a6b067d428eefbf1754aa09429b1ba524}{uint8}[ 1] = 0x02;
212             ip.\hyperlink{struct_i_p_a14c606eb5ffb078c38ad854dc4e79507}{ip6}.\hyperlink{union_i_p6_a6b067d428eefbf1754aa09429b1ba524}{uint8}[15] = 0x01;
213         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (family\_broadcast == AF\_INET) \{
214             ip.\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} = AF\_INET6;
215             ip.\hyperlink{struct_i_p_a14c606eb5ffb078c38ad854dc4e79507}{ip6}.\hyperlink{union_i_p6_a1d8ab1f6c1da5565bed41e7095610dea}{uint32}[0] = 0;
216             ip.\hyperlink{struct_i_p_a14c606eb5ffb078c38ad854dc4e79507}{ip6}.\hyperlink{union_i_p6_a1d8ab1f6c1da5565bed41e7095610dea}{uint32}[1] = 0;
217             ip.\hyperlink{struct_i_p_a14c606eb5ffb078c38ad854dc4e79507}{ip6}.\hyperlink{union_i_p6_a1d8ab1f6c1da5565bed41e7095610dea}{uint32}[2] = htonl(0xFFFF);
218             ip.\hyperlink{struct_i_p_a14c606eb5ffb078c38ad854dc4e79507}{ip6}.\hyperlink{union_i_p6_a1d8ab1f6c1da5565bed41e7095610dea}{uint32}[3] = INADDR\_BROADCAST;
219         \}
220     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (family\_socket == AF\_INET) \{
221         \textcolor{keywordflow}{if} (family\_broadcast == AF\_INET) \{
222             ip.\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} = AF\_INET;
223             ip.\hyperlink{struct_i_p_aca19646000f55aa927406e68fc41ecf9}{ip4}.\hyperlink{union_i_p4_a5ad776be1fb768f3399aafcd1b58b3a2}{uint32} = INADDR\_BROADCAST;
224         \}
225     \}
226 
227     \textcolor{keywordflow}{return} \hyperlink{irc__syncbot_8c_ae81515e082f9bc33e8968181945586da}{ip};
228 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=239pt]{d1/de5/_l_a_n__discovery_8c_a9fa84b6ea98e56c412f2c45673c180cc_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d1/de5/_l_a_n__discovery_8c_a9fa84b6ea98e56c412f2c45673c180cc_icgraph}
\end{center}
\end{figure}


\hypertarget{_l_a_n__discovery_8c_a32a9c5eecb426198ce85d4f5d9abb3b9}{\index{L\+A\+N\+\_\+discovery.\+c@{L\+A\+N\+\_\+discovery.\+c}!fetch\+\_\+broadcast\+\_\+info@{fetch\+\_\+broadcast\+\_\+info}}
\index{fetch\+\_\+broadcast\+\_\+info@{fetch\+\_\+broadcast\+\_\+info}!L\+A\+N\+\_\+discovery.\+c@{L\+A\+N\+\_\+discovery.\+c}}
\subsubsection[{fetch\+\_\+broadcast\+\_\+info}]{\setlength{\rightskip}{0pt plus 5cm}static void fetch\+\_\+broadcast\+\_\+info (
\begin{DoxyParamCaption}
\item[{uint16\+\_\+t}]{port}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_l_a_n__discovery_8c_a32a9c5eecb426198ce85d4f5d9abb3b9}


Definition at line 169 of file L\+A\+N\+\_\+discovery.\+c.



References broadcast\+\_\+count.



Referenced by send\+\_\+broadcasts().


\begin{DoxyCode}
170 \{
171     \hyperlink{_l_a_n__discovery_8c_aea1a218dd0a10d7769dd2cb6e5f3bd6e}{broadcast\_count} = 0;
172 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d1/de5/_l_a_n__discovery_8c_a32a9c5eecb426198ce85d4f5d9abb3b9_icgraph}
\end{center}
\end{figure}


\hypertarget{_l_a_n__discovery_8c_aeb11042ae0d160b28f8943da6ae29499}{\index{L\+A\+N\+\_\+discovery.\+c@{L\+A\+N\+\_\+discovery.\+c}!handle\+\_\+\+L\+A\+Ndiscovery@{handle\+\_\+\+L\+A\+Ndiscovery}}
\index{handle\+\_\+\+L\+A\+Ndiscovery@{handle\+\_\+\+L\+A\+Ndiscovery}!L\+A\+N\+\_\+discovery.\+c@{L\+A\+N\+\_\+discovery.\+c}}
\subsubsection[{handle\+\_\+\+L\+A\+Ndiscovery}]{\setlength{\rightskip}{0pt plus 5cm}static int handle\+\_\+\+L\+A\+Ndiscovery (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{object, }
\item[{{\bf I\+P\+\_\+\+Port}}]{source, }
\item[{const uint8\+\_\+t $\ast$}]{packet, }
\item[{uint16\+\_\+t}]{length}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_l_a_n__discovery_8c_aeb11042ae0d160b28f8943da6ae29499}


Definition at line 309 of file L\+A\+N\+\_\+discovery.\+c.



References D\+H\+T\+\_\+bootstrap(), I\+P\+\_\+\+Port\+::ip, and L\+A\+N\+\_\+ip().



Referenced by L\+A\+Ndiscovery\+\_\+init().


\begin{DoxyCode}
310 \{
311     \hyperlink{struct_d_h_t}{DHT} *dht = object;
312 
313     \textcolor{keywordflow}{if} (\hyperlink{_l_a_n__discovery_8c_a2d80a53390598eb8ededbc63f4e9c152}{LAN\_ip}(source.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}) == -1)
314         \textcolor{keywordflow}{return} 1;
315 
316     \textcolor{keywordflow}{if} (length != crypto\_box\_PUBLICKEYBYTES + 1)
317         \textcolor{keywordflow}{return} 1;
318 
319     \hyperlink{_d_h_t_8c_ab6d732074bab2377a7884c41c219cf96}{DHT\_bootstrap}(dht, source, packet + 1);
320     \textcolor{keywordflow}{return} 0;
321 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d1/de5/_l_a_n__discovery_8c_aeb11042ae0d160b28f8943da6ae29499_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d1/de5/_l_a_n__discovery_8c_aeb11042ae0d160b28f8943da6ae29499_icgraph}
\end{center}
\end{figure}


\hypertarget{_l_a_n__discovery_8c_a2d80a53390598eb8ededbc63f4e9c152}{\index{L\+A\+N\+\_\+discovery.\+c@{L\+A\+N\+\_\+discovery.\+c}!L\+A\+N\+\_\+ip@{L\+A\+N\+\_\+ip}}
\index{L\+A\+N\+\_\+ip@{L\+A\+N\+\_\+ip}!L\+A\+N\+\_\+discovery.\+c@{L\+A\+N\+\_\+discovery.\+c}}
\subsubsection[{L\+A\+N\+\_\+ip}]{\setlength{\rightskip}{0pt plus 5cm}int L\+A\+N\+\_\+ip (
\begin{DoxyParamCaption}
\item[{{\bf I\+P}}]{ip}
\end{DoxyParamCaption}
)}}\label{_l_a_n__discovery_8c_a2d80a53390598eb8ededbc63f4e9c152}


Definition at line 259 of file L\+A\+N\+\_\+discovery.\+c.



References I\+P\+::family, I\+P\+::ip4, I\+P\+::ip6, I\+P\+V6\+\_\+\+I\+P\+V4\+\_\+\+I\+N\+\_\+\+V6, L\+A\+N\+\_\+ip(), Local\+\_\+ip(), I\+P4\+::uint32, I\+P6\+::uint32, I\+P4\+::uint8, and I\+P6\+::uint8.



Referenced by Assoc\+\_\+get\+\_\+close\+\_\+entries(), client\+\_\+or\+\_\+ip\+\_\+port\+\_\+in\+\_\+list(), client\+\_\+ping\+\_\+nodes(), D\+H\+T\+\_\+non\+\_\+lan\+\_\+connected(), entry\+\_\+heard\+\_\+store(), get\+\_\+close\+\_\+nodes\+\_\+inner(), handle\+\_\+announce\+\_\+request(), handle\+\_\+\+L\+A\+Ndiscovery(), handle\+\_\+sendnodes\+\_\+ipv6(), L\+A\+N\+\_\+ip(), sendnodes\+\_\+ipv6(), and set\+\_\+direct\+\_\+ip\+\_\+port().


\begin{DoxyCode}
260 \{
261     \textcolor{keywordflow}{if} (\hyperlink{_l_a_n__discovery_8c_a56fb8ae3cd774c1b1d5670b9c4fb8959}{Local\_ip}(ip))
262         \textcolor{keywordflow}{return} 0;
263 
264     \textcolor{keywordflow}{if} (ip.\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} == AF\_INET) \{
265         \hyperlink{union_i_p4}{IP4} ip4 = ip.\hyperlink{struct_i_p_aca19646000f55aa927406e68fc41ecf9}{ip4};
266 
267         \textcolor{comment}{/* 10.0.0.0 to 10.255.255.255 range. */}
268         \textcolor{keywordflow}{if} (ip4.\hyperlink{union_i_p4_a73b9a57544f1edd6e2187aca636c75ef}{uint8}[0] == 10)
269             \textcolor{keywordflow}{return} 0;
270 
271         \textcolor{comment}{/* 172.16.0.0 to 172.31.255.255 range. */}
272         \textcolor{keywordflow}{if} (ip4.\hyperlink{union_i_p4_a73b9a57544f1edd6e2187aca636c75ef}{uint8}[0] == 172 && ip4.\hyperlink{union_i_p4_a73b9a57544f1edd6e2187aca636c75ef}{uint8}[1] >= 16 && ip4.\hyperlink{union_i_p4_a73b9a57544f1edd6e2187aca636c75ef}{uint8}[1] <= 31)
273             \textcolor{keywordflow}{return} 0;
274 
275         \textcolor{comment}{/* 192.168.0.0 to 192.168.255.255 range. */}
276         \textcolor{keywordflow}{if} (ip4.\hyperlink{union_i_p4_a73b9a57544f1edd6e2187aca636c75ef}{uint8}[0] == 192 && ip4.\hyperlink{union_i_p4_a73b9a57544f1edd6e2187aca636c75ef}{uint8}[1] == 168)
277             \textcolor{keywordflow}{return} 0;
278 
279         \textcolor{comment}{/* 169.254.1.0 to 169.254.254.255 range. */}
280         \textcolor{keywordflow}{if} (ip4.\hyperlink{union_i_p4_a73b9a57544f1edd6e2187aca636c75ef}{uint8}[0] == 169 && ip4.\hyperlink{union_i_p4_a73b9a57544f1edd6e2187aca636c75ef}{uint8}[1] == 254 && ip4.\hyperlink{union_i_p4_a73b9a57544f1edd6e2187aca636c75ef}{uint8}[2] != 0
281                 && ip4.\hyperlink{union_i_p4_a73b9a57544f1edd6e2187aca636c75ef}{uint8}[2] != 255)
282             \textcolor{keywordflow}{return} 0;
283 
284         \textcolor{comment}{/* RFC 6598: 100.64.0.0 to 100.127.255.255 (100.64.0.0/10)}
285 \textcolor{comment}{         * (shared address space to stack another layer of NAT) */}
286         \textcolor{keywordflow}{if} ((ip4.\hyperlink{union_i_p4_a73b9a57544f1edd6e2187aca636c75ef}{uint8}[0] == 100) && ((ip4.\hyperlink{union_i_p4_a73b9a57544f1edd6e2187aca636c75ef}{uint8}[1] & 0xC0) == 0x40))
287             \textcolor{keywordflow}{return} 0;
288 
289     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (ip.\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} == AF\_INET6) \{
290 
291         \textcolor{comment}{/* autogenerated for each interface: FE80::* (up to FEBF::*)}
292 \textcolor{comment}{           FF02::1 is - according to RFC 4291 - multicast all-nodes link-local */}
293         \textcolor{keywordflow}{if} (((ip.\hyperlink{struct_i_p_a14c606eb5ffb078c38ad854dc4e79507}{ip6}.\hyperlink{union_i_p6_a6b067d428eefbf1754aa09429b1ba524}{uint8}[0] == 0xFF) && (ip.\hyperlink{struct_i_p_a14c606eb5ffb078c38ad854dc4e79507}{ip6}.\hyperlink{union_i_p6_a6b067d428eefbf1754aa09429b1ba524}{uint8}[1] < 3) && (ip.
      \hyperlink{struct_i_p_a14c606eb5ffb078c38ad854dc4e79507}{ip6}.\hyperlink{union_i_p6_a6b067d428eefbf1754aa09429b1ba524}{uint8}[15] == 1)) ||
294                 ((ip.\hyperlink{struct_i_p_a14c606eb5ffb078c38ad854dc4e79507}{ip6}.\hyperlink{union_i_p6_a6b067d428eefbf1754aa09429b1ba524}{uint8}[0] == 0xFE) && ((ip.\hyperlink{struct_i_p_a14c606eb5ffb078c38ad854dc4e79507}{ip6}.\hyperlink{union_i_p6_a6b067d428eefbf1754aa09429b1ba524}{uint8}[1] & 0xC0) == 0x80)))
295             \textcolor{keywordflow}{return} 0;
296 
297         \textcolor{comment}{/* embedded IPv4-in-IPv6 */}
298         \textcolor{keywordflow}{if} (\hyperlink{network_8h_aaaf5ca9c91edc4f8a7529206d7799805}{IPV6\_IPV4\_IN\_V6}(ip.\hyperlink{struct_i_p_a14c606eb5ffb078c38ad854dc4e79507}{ip6})) \{
299             \hyperlink{struct_i_p}{IP} ip4;
300             ip4.\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} = AF\_INET;
301             ip4.\hyperlink{struct_i_p_aca19646000f55aa927406e68fc41ecf9}{ip4}.\hyperlink{union_i_p4_a5ad776be1fb768f3399aafcd1b58b3a2}{uint32} = ip.\hyperlink{struct_i_p_a14c606eb5ffb078c38ad854dc4e79507}{ip6}.\hyperlink{union_i_p6_a1d8ab1f6c1da5565bed41e7095610dea}{uint32}[3];
302             \textcolor{keywordflow}{return} \hyperlink{_l_a_n__discovery_8c_a2d80a53390598eb8ededbc63f4e9c152}{LAN\_ip}(ip4);
303         \}
304     \}
305 
306     \textcolor{keywordflow}{return} -1;
307 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=218pt]{d1/de5/_l_a_n__discovery_8c_a2d80a53390598eb8ededbc63f4e9c152_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d1/de5/_l_a_n__discovery_8c_a2d80a53390598eb8ededbc63f4e9c152_icgraph}
\end{center}
\end{figure}


\hypertarget{_l_a_n__discovery_8c_ab5177e8d5fc82b7c156f777f13649912}{\index{L\+A\+N\+\_\+discovery.\+c@{L\+A\+N\+\_\+discovery.\+c}!L\+A\+Ndiscovery\+\_\+init@{L\+A\+Ndiscovery\+\_\+init}}
\index{L\+A\+Ndiscovery\+\_\+init@{L\+A\+Ndiscovery\+\_\+init}!L\+A\+N\+\_\+discovery.\+c@{L\+A\+N\+\_\+discovery.\+c}}
\subsubsection[{L\+A\+Ndiscovery\+\_\+init}]{\setlength{\rightskip}{0pt plus 5cm}void L\+A\+Ndiscovery\+\_\+init (
\begin{DoxyParamCaption}
\item[{{\bf D\+H\+T} $\ast$}]{dht}
\end{DoxyParamCaption}
)}}\label{_l_a_n__discovery_8c_ab5177e8d5fc82b7c156f777f13649912}


Definition at line 356 of file L\+A\+N\+\_\+discovery.\+c.



References handle\+\_\+\+L\+A\+Ndiscovery(), D\+H\+T\+::net, N\+E\+T\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+L\+A\+N\+\_\+\+D\+I\+S\+C\+O\+V\+E\+R\+Y, and networking\+\_\+registerhandler().



Referenced by main(), and new\+\_\+friend\+\_\+connections().


\begin{DoxyCode}
357 \{
358     \hyperlink{network_8c_a230a192ca9463ec4985d4f86de439733}{networking\_registerhandler}(dht->\hyperlink{struct_d_h_t_aa14ea2f67950f57fe4235d7375a2216c}{net}, 
      \hyperlink{network_8h_a16dc7e6f46489ec54301367eeeac6fbd}{NET\_PACKET\_LAN\_DISCOVERY}, &\hyperlink{_l_a_n__discovery_8c_aeb11042ae0d160b28f8943da6ae29499}{handle\_LANdiscovery}, dht);
359 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d1/de5/_l_a_n__discovery_8c_ab5177e8d5fc82b7c156f777f13649912_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d1/de5/_l_a_n__discovery_8c_ab5177e8d5fc82b7c156f777f13649912_icgraph}
\end{center}
\end{figure}


\hypertarget{_l_a_n__discovery_8c_af2a395c13cd4dff580e3638f41ef02d0}{\index{L\+A\+N\+\_\+discovery.\+c@{L\+A\+N\+\_\+discovery.\+c}!L\+A\+Ndiscovery\+\_\+kill@{L\+A\+Ndiscovery\+\_\+kill}}
\index{L\+A\+Ndiscovery\+\_\+kill@{L\+A\+Ndiscovery\+\_\+kill}!L\+A\+N\+\_\+discovery.\+c@{L\+A\+N\+\_\+discovery.\+c}}
\subsubsection[{L\+A\+Ndiscovery\+\_\+kill}]{\setlength{\rightskip}{0pt plus 5cm}void L\+A\+Ndiscovery\+\_\+kill (
\begin{DoxyParamCaption}
\item[{{\bf D\+H\+T} $\ast$}]{dht}
\end{DoxyParamCaption}
)}}\label{_l_a_n__discovery_8c_af2a395c13cd4dff580e3638f41ef02d0}


Definition at line 361 of file L\+A\+N\+\_\+discovery.\+c.



References D\+H\+T\+::net, N\+E\+T\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+L\+A\+N\+\_\+\+D\+I\+S\+C\+O\+V\+E\+R\+Y, and networking\+\_\+registerhandler().



Referenced by kill\+\_\+friend\+\_\+connections().


\begin{DoxyCode}
362 \{
363     \hyperlink{network_8c_a230a192ca9463ec4985d4f86de439733}{networking\_registerhandler}(dht->\hyperlink{struct_d_h_t_aa14ea2f67950f57fe4235d7375a2216c}{net}, 
      \hyperlink{network_8h_a16dc7e6f46489ec54301367eeeac6fbd}{NET\_PACKET\_LAN\_DISCOVERY}, NULL, NULL);
364 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=344pt]{d1/de5/_l_a_n__discovery_8c_af2a395c13cd4dff580e3638f41ef02d0_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d1/de5/_l_a_n__discovery_8c_af2a395c13cd4dff580e3638f41ef02d0_icgraph}
\end{center}
\end{figure}


\hypertarget{_l_a_n__discovery_8c_a56fb8ae3cd774c1b1d5670b9c4fb8959}{\index{L\+A\+N\+\_\+discovery.\+c@{L\+A\+N\+\_\+discovery.\+c}!Local\+\_\+ip@{Local\+\_\+ip}}
\index{Local\+\_\+ip@{Local\+\_\+ip}!L\+A\+N\+\_\+discovery.\+c@{L\+A\+N\+\_\+discovery.\+c}}
\subsubsection[{Local\+\_\+ip}]{\setlength{\rightskip}{0pt plus 5cm}\+\_\+\+Bool Local\+\_\+ip (
\begin{DoxyParamCaption}
\item[{{\bf I\+P}}]{ip}
\end{DoxyParamCaption}
)}}\label{_l_a_n__discovery_8c_a56fb8ae3cd774c1b1d5670b9c4fb8959}


Definition at line 231 of file L\+A\+N\+\_\+discovery.\+c.



References I\+P\+::family, I\+P\+::ip4, I\+P\+::ip6, I\+P\+V6\+\_\+\+I\+P\+V4\+\_\+\+I\+N\+\_\+\+V6, Local\+\_\+ip(), I\+P4\+::uint32, I\+P6\+::uint32, I\+P6\+::uint64, and I\+P4\+::uint8.



Referenced by friend\+\_\+add\+\_\+tcp\+\_\+relay(), L\+A\+N\+\_\+ip(), and Local\+\_\+ip().


\begin{DoxyCode}
232 \{
233     \textcolor{keywordflow}{if} (ip.\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} == AF\_INET) \{
234         \hyperlink{union_i_p4}{IP4} ip4 = ip.\hyperlink{struct_i_p_aca19646000f55aa927406e68fc41ecf9}{ip4};
235 
236         \textcolor{comment}{/* Loopback. */}
237         \textcolor{keywordflow}{if} (ip4.\hyperlink{union_i_p4_a73b9a57544f1edd6e2187aca636c75ef}{uint8}[0] == 127)
238             \textcolor{keywordflow}{return} 1;
239     \} \textcolor{keywordflow}{else} \{
240         \textcolor{comment}{/* embedded IPv4-in-IPv6 */}
241         \textcolor{keywordflow}{if} (\hyperlink{network_8h_aaaf5ca9c91edc4f8a7529206d7799805}{IPV6\_IPV4\_IN\_V6}(ip.\hyperlink{struct_i_p_a14c606eb5ffb078c38ad854dc4e79507}{ip6})) \{
242             \hyperlink{struct_i_p}{IP} ip4;
243             ip4.\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} = AF\_INET;
244             ip4.\hyperlink{struct_i_p_aca19646000f55aa927406e68fc41ecf9}{ip4}.\hyperlink{union_i_p4_a5ad776be1fb768f3399aafcd1b58b3a2}{uint32} = ip.\hyperlink{struct_i_p_a14c606eb5ffb078c38ad854dc4e79507}{ip6}.\hyperlink{union_i_p6_a1d8ab1f6c1da5565bed41e7095610dea}{uint32}[3];
245             \textcolor{keywordflow}{return} \hyperlink{_l_a_n__discovery_8c_a56fb8ae3cd774c1b1d5670b9c4fb8959}{Local\_ip}(ip4);
246         \}
247 
248         \textcolor{comment}{/* localhost in IPv6 (::1) */}
249         \textcolor{keywordflow}{if} (ip.\hyperlink{struct_i_p_a14c606eb5ffb078c38ad854dc4e79507}{ip6}.\hyperlink{union_i_p6_a36c7a85cc2c5062edd5ebf13d46fa343}{uint64}[0] == 0 && ip.\hyperlink{struct_i_p_a14c606eb5ffb078c38ad854dc4e79507}{ip6}.\hyperlink{union_i_p6_a1d8ab1f6c1da5565bed41e7095610dea}{uint32}[2] == 0 && ip.
      \hyperlink{struct_i_p_a14c606eb5ffb078c38ad854dc4e79507}{ip6}.\hyperlink{union_i_p6_a1d8ab1f6c1da5565bed41e7095610dea}{uint32}[3] == htonl(1))
250             \textcolor{keywordflow}{return} 1;
251     \}
252 
253     \textcolor{keywordflow}{return} 0;
254 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=133pt]{d1/de5/_l_a_n__discovery_8c_a56fb8ae3cd774c1b1d5670b9c4fb8959_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d1/de5/_l_a_n__discovery_8c_a56fb8ae3cd774c1b1d5670b9c4fb8959_icgraph}
\end{center}
\end{figure}


\hypertarget{_l_a_n__discovery_8c_a1fc7e8d37a627f59ac5afa2c7b204568}{\index{L\+A\+N\+\_\+discovery.\+c@{L\+A\+N\+\_\+discovery.\+c}!send\+\_\+broadcasts@{send\+\_\+broadcasts}}
\index{send\+\_\+broadcasts@{send\+\_\+broadcasts}!L\+A\+N\+\_\+discovery.\+c@{L\+A\+N\+\_\+discovery.\+c}}
\subsubsection[{send\+\_\+broadcasts}]{\setlength{\rightskip}{0pt plus 5cm}static uint32\+\_\+t send\+\_\+broadcasts (
\begin{DoxyParamCaption}
\item[{{\bf Networking\+\_\+\+Core} $\ast$}]{net, }
\item[{uint16\+\_\+t}]{port, }
\item[{const uint8\+\_\+t $\ast$}]{data, }
\item[{uint16\+\_\+t}]{length}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_l_a_n__discovery_8c_a1fc7e8d37a627f59ac5afa2c7b204568}


Definition at line 180 of file L\+A\+N\+\_\+discovery.\+c.



References broadcast\+\_\+count, fetch\+\_\+broadcast\+\_\+info(), i, and sendpacket().



Referenced by send\+\_\+\+L\+A\+Ndiscovery().


\begin{DoxyCode}
181 \{
182     \textcolor{comment}{/* fetch only once? on every packet? every X seconds?}
183 \textcolor{comment}{     * old: every packet, new: once */}
184     \textcolor{keywordflow}{if} (\hyperlink{_l_a_n__discovery_8c_aea1a218dd0a10d7769dd2cb6e5f3bd6e}{broadcast\_count} < 0)
185         \hyperlink{_l_a_n__discovery_8c_a32a9c5eecb426198ce85d4f5d9abb3b9}{fetch\_broadcast\_info}(\hyperlink{irc__syncbot_8c_a8e0798404bf2cf5dabb84c5ba9a4f236}{port});
186 
187     \textcolor{keywordflow}{if} (!\hyperlink{_l_a_n__discovery_8c_aea1a218dd0a10d7769dd2cb6e5f3bd6e}{broadcast\_count})
188         \textcolor{keywordflow}{return} 0;
189 
190     \textcolor{keywordtype}{int} \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
191 
192     \textcolor{keywordflow}{for} (i = 0; i < \hyperlink{_l_a_n__discovery_8c_aea1a218dd0a10d7769dd2cb6e5f3bd6e}{broadcast\_count}; i++)
193         \hyperlink{network_8c_a7b90f87f3ba60cc5c66dd6dd77cd5cb1}{sendpacket}(net, \hyperlink{_l_a_n__discovery_8c_aa6a32d3f8b5409a706f2a3e17a54fe8d}{broadcast\_ip\_port}[i], \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}, length);
194 
195     \textcolor{keywordflow}{return} 1;
196 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=314pt]{d1/de5/_l_a_n__discovery_8c_a1fc7e8d37a627f59ac5afa2c7b204568_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d1/de5/_l_a_n__discovery_8c_a1fc7e8d37a627f59ac5afa2c7b204568_icgraph}
\end{center}
\end{figure}


\hypertarget{_l_a_n__discovery_8c_a929a14971d13e5aad2661e834e406391}{\index{L\+A\+N\+\_\+discovery.\+c@{L\+A\+N\+\_\+discovery.\+c}!send\+\_\+\+L\+A\+Ndiscovery@{send\+\_\+\+L\+A\+Ndiscovery}}
\index{send\+\_\+\+L\+A\+Ndiscovery@{send\+\_\+\+L\+A\+Ndiscovery}!L\+A\+N\+\_\+discovery.\+c@{L\+A\+N\+\_\+discovery.\+c}}
\subsubsection[{send\+\_\+\+L\+A\+Ndiscovery}]{\setlength{\rightskip}{0pt plus 5cm}int send\+\_\+\+L\+A\+Ndiscovery (
\begin{DoxyParamCaption}
\item[{uint16\+\_\+t}]{port, }
\item[{{\bf D\+H\+T} $\ast$}]{dht}
\end{DoxyParamCaption}
)}}\label{_l_a_n__discovery_8c_a929a14971d13e5aad2661e834e406391}


Definition at line 324 of file L\+A\+N\+\_\+discovery.\+c.



References broadcast\+\_\+ip(), make-\/funny-\/savefile\+::data, Networking\+\_\+\+Core\+::family, id\+\_\+copy(), I\+P\+\_\+\+Port\+::ip, ip\+\_\+isset(), D\+H\+T\+::net, N\+E\+T\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+L\+A\+N\+\_\+\+D\+I\+S\+C\+O\+V\+E\+R\+Y, port, I\+P\+\_\+\+Port\+::port, D\+H\+T\+::self\+\_\+public\+\_\+key, send\+\_\+broadcasts(), and sendpacket().



Referenced by L\+A\+Ndiscovery(), and main().


\begin{DoxyCode}
325 \{
326     uint8\_t \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[crypto\_box\_PUBLICKEYBYTES + 1];
327     data[0] = \hyperlink{network_8h_a16dc7e6f46489ec54301367eeeac6fbd}{NET\_PACKET\_LAN\_DISCOVERY};
328     \hyperlink{util_8c_aa30049b8c1d82c280d6d872feea3353b}{id\_copy}(data + 1, dht->\hyperlink{struct_d_h_t_ae726df8bdc26380e5a6c3187a00d6881}{self\_public\_key});
329 
330     \hyperlink{_l_a_n__discovery_8c_a1fc7e8d37a627f59ac5afa2c7b204568}{send\_broadcasts}(dht->\hyperlink{struct_d_h_t_aa14ea2f67950f57fe4235d7375a2216c}{net}, \hyperlink{irc__syncbot_8c_a8e0798404bf2cf5dabb84c5ba9a4f236}{port}, data, 1 + crypto\_box\_PUBLICKEYBYTES);
331 
332     \textcolor{keywordtype}{int} res = -1;
333     \hyperlink{struct_i_p___port}{IP\_Port} ip\_port;
334     ip\_port.\hyperlink{struct_i_p___port_a8e0798404bf2cf5dabb84c5ba9a4f236}{port} = \hyperlink{irc__syncbot_8c_a8e0798404bf2cf5dabb84c5ba9a4f236}{port};
335 
336     \textcolor{comment}{/* IPv6 multicast */}
337     \textcolor{keywordflow}{if} (dht->\hyperlink{struct_d_h_t_aa14ea2f67950f57fe4235d7375a2216c}{net}->\hyperlink{struct_networking___core_a59fa33606a579e9080aced9a5d2659de}{family} == AF\_INET6) \{
338         ip\_port.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip} = \hyperlink{_l_a_n__discovery_8c_a9fa84b6ea98e56c412f2c45673c180cc}{broadcast\_ip}(AF\_INET6, AF\_INET6);
339 
340         \textcolor{keywordflow}{if} (\hyperlink{network_8c_ac56c677f4bc8bf8311370ee105ae7cbb}{ip\_isset}(&ip\_port.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}))
341             \textcolor{keywordflow}{if} (\hyperlink{network_8c_a7b90f87f3ba60cc5c66dd6dd77cd5cb1}{sendpacket}(dht->\hyperlink{struct_d_h_t_aa14ea2f67950f57fe4235d7375a2216c}{net}, ip\_port, data, 1 + crypto\_box\_PUBLICKEYBYTES) > 0)
342                 res = 1;
343     \}
344 
345     \textcolor{comment}{/* IPv4 broadcast (has to be IPv4-in-IPv6 mapping if socket is AF\_INET6 */}
346     ip\_port.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip} = \hyperlink{_l_a_n__discovery_8c_a9fa84b6ea98e56c412f2c45673c180cc}{broadcast\_ip}(dht->\hyperlink{struct_d_h_t_aa14ea2f67950f57fe4235d7375a2216c}{net}->\hyperlink{struct_networking___core_a59fa33606a579e9080aced9a5d2659de}{family}, AF\_INET);
347 
348     \textcolor{keywordflow}{if} (\hyperlink{network_8c_ac56c677f4bc8bf8311370ee105ae7cbb}{ip\_isset}(&ip\_port.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}))
349         \textcolor{keywordflow}{if} (\hyperlink{network_8c_a7b90f87f3ba60cc5c66dd6dd77cd5cb1}{sendpacket}(dht->\hyperlink{struct_d_h_t_aa14ea2f67950f57fe4235d7375a2216c}{net}, ip\_port, data, 1 + crypto\_box\_PUBLICKEYBYTES))
350             res = 1;
351 
352     \textcolor{keywordflow}{return} res;
353 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d1/de5/_l_a_n__discovery_8c_a929a14971d13e5aad2661e834e406391_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d1/de5/_l_a_n__discovery_8c_a929a14971d13e5aad2661e834e406391_icgraph}
\end{center}
\end{figure}




\subsection{Variable Documentation}
\hypertarget{_l_a_n__discovery_8c_aea1a218dd0a10d7769dd2cb6e5f3bd6e}{\index{L\+A\+N\+\_\+discovery.\+c@{L\+A\+N\+\_\+discovery.\+c}!broadcast\+\_\+count@{broadcast\+\_\+count}}
\index{broadcast\+\_\+count@{broadcast\+\_\+count}!L\+A\+N\+\_\+discovery.\+c@{L\+A\+N\+\_\+discovery.\+c}}
\subsubsection[{broadcast\+\_\+count}]{\setlength{\rightskip}{0pt plus 5cm}int broadcast\+\_\+count = -\/1\hspace{0.3cm}{\ttfamily [static]}}}\label{_l_a_n__discovery_8c_aea1a218dd0a10d7769dd2cb6e5f3bd6e}


Definition at line 41 of file L\+A\+N\+\_\+discovery.\+c.



Referenced by fetch\+\_\+broadcast\+\_\+info(), and send\+\_\+broadcasts().

\hypertarget{_l_a_n__discovery_8c_aa6a32d3f8b5409a706f2a3e17a54fe8d}{\index{L\+A\+N\+\_\+discovery.\+c@{L\+A\+N\+\_\+discovery.\+c}!broadcast\+\_\+ip\+\_\+port@{broadcast\+\_\+ip\+\_\+port}}
\index{broadcast\+\_\+ip\+\_\+port@{broadcast\+\_\+ip\+\_\+port}!L\+A\+N\+\_\+discovery.\+c@{L\+A\+N\+\_\+discovery.\+c}}
\subsubsection[{broadcast\+\_\+ip\+\_\+port}]{\setlength{\rightskip}{0pt plus 5cm}{\bf I\+P\+\_\+\+Port} broadcast\+\_\+ip\+\_\+port\mbox{[}{\bf M\+A\+X\+\_\+\+I\+N\+T\+E\+R\+F\+A\+C\+E\+S}\mbox{]}\hspace{0.3cm}{\ttfamily [static]}}}\label{_l_a_n__discovery_8c_aa6a32d3f8b5409a706f2a3e17a54fe8d}


Definition at line 42 of file L\+A\+N\+\_\+discovery.\+c.

