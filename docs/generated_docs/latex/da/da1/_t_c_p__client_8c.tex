\hypertarget{_t_c_p__client_8c}{\section{toxcore/\+T\+C\+P\+\_\+client.c File Reference}
\label{_t_c_p__client_8c}\index{toxcore/\+T\+C\+P\+\_\+client.\+c@{toxcore/\+T\+C\+P\+\_\+client.\+c}}
}
{\ttfamily \#include \char`\"{}T\+C\+P\+\_\+client.\+h\char`\"{}}\\*
{\ttfamily \#include $<$sys/ioctl.\+h$>$}\\*
{\ttfamily \#include \char`\"{}util.\+h\char`\"{}}\\*
Include dependency graph for T\+C\+P\+\_\+client.\+c\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d3/dcb/_t_c_p__client_8c__incl}
\end{center}
\end{figure}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
static int \hyperlink{_t_c_p__client_8c_a60b303142f843cad13249065ddeefb17}{connect\+\_\+sock\+\_\+to} (\hyperlink{network_8h_ae5faf8a8d23da59c3e3025a62039d8c1}{sock\+\_\+t} \hyperlink{irc__syncbot_8c_a5903d0b282fc5eae503de618f896b5e1}{sock}, \hyperlink{struct_i_p___port}{I\+P\+\_\+\+Port} ip\+\_\+port, \hyperlink{struct_t_c_p___proxy___info}{T\+C\+P\+\_\+\+Proxy\+\_\+\+Info} $\ast$proxy\+\_\+info)
\item 
static int \hyperlink{_t_c_p__client_8c_a3000ce77c7c25ee8a08da815cbd0c7cb}{proxy\+\_\+http\+\_\+generate\+\_\+connection\+\_\+request} (\hyperlink{struct_t_c_p___client___connection}{T\+C\+P\+\_\+\+Client\+\_\+\+Connection} $\ast$T\+C\+P\+\_\+conn)
\item 
static int \hyperlink{_t_c_p__client_8c_a39080f686c09274aa55d7b352fcadd56}{proxy\+\_\+http\+\_\+read\+\_\+connection\+\_\+response} (\hyperlink{struct_t_c_p___client___connection}{T\+C\+P\+\_\+\+Client\+\_\+\+Connection} $\ast$T\+C\+P\+\_\+conn)
\item 
static void \hyperlink{_t_c_p__client_8c_a76c75a8969ec140e5799744179ba8048}{proxy\+\_\+socks5\+\_\+generate\+\_\+handshake} (\hyperlink{struct_t_c_p___client___connection}{T\+C\+P\+\_\+\+Client\+\_\+\+Connection} $\ast$T\+C\+P\+\_\+conn)
\item 
static int \hyperlink{_t_c_p__client_8c_ada9457c0effffd236ca9c4a004ee8942}{socks5\+\_\+read\+\_\+handshake\+\_\+response} (\hyperlink{struct_t_c_p___client___connection}{T\+C\+P\+\_\+\+Client\+\_\+\+Connection} $\ast$T\+C\+P\+\_\+conn)
\item 
static void \hyperlink{_t_c_p__client_8c_a07b625ae786316d0942152868af0226b}{proxy\+\_\+socks5\+\_\+generate\+\_\+connection\+\_\+request} (\hyperlink{struct_t_c_p___client___connection}{T\+C\+P\+\_\+\+Client\+\_\+\+Connection} $\ast$T\+C\+P\+\_\+conn)
\item 
static int \hyperlink{_t_c_p__client_8c_a258117084993caf09bd2d1c04425d7f0}{proxy\+\_\+socks5\+\_\+read\+\_\+connection\+\_\+response} (\hyperlink{struct_t_c_p___client___connection}{T\+C\+P\+\_\+\+Client\+\_\+\+Connection} $\ast$T\+C\+P\+\_\+conn)
\item 
static int \hyperlink{_t_c_p__client_8c_aec632a758fda6b73153ec16180750366}{generate\+\_\+handshake} (\hyperlink{struct_t_c_p___client___connection}{T\+C\+P\+\_\+\+Client\+\_\+\+Connection} $\ast$T\+C\+P\+\_\+conn)
\item 
static int \hyperlink{_t_c_p__client_8c_a4f324d76d4f1f967dab83e064d09c58a}{handle\+\_\+handshake} (\hyperlink{struct_t_c_p___client___connection}{T\+C\+P\+\_\+\+Client\+\_\+\+Connection} $\ast$T\+C\+P\+\_\+conn, const uint8\+\_\+t $\ast$data)
\item 
static int \hyperlink{_t_c_p__client_8c_a531708d11982cfb4c8d31ac915c25386}{send\+\_\+pending\+\_\+data\+\_\+nonpriority} (\hyperlink{struct_t_c_p___client___connection}{T\+C\+P\+\_\+\+Client\+\_\+\+Connection} $\ast$con)
\item 
static int \hyperlink{_t_c_p__client_8c_a878656cc36ac482c8063082d0d86850f}{send\+\_\+pending\+\_\+data} (\hyperlink{struct_t_c_p___client___connection}{T\+C\+P\+\_\+\+Client\+\_\+\+Connection} $\ast$con)
\item 
static \+\_\+\+Bool \hyperlink{_t_c_p__client_8c_a87e67ddfe8fdabe9f2d32080097c3970}{add\+\_\+priority} (\hyperlink{struct_t_c_p___client___connection}{T\+C\+P\+\_\+\+Client\+\_\+\+Connection} $\ast$con, const uint8\+\_\+t $\ast$packet, uint16\+\_\+t size, uint16\+\_\+t sent)
\item 
static void \hyperlink{_t_c_p__client_8c_aaf4385f749c6f9c21f4f4ac17b31a77b}{wipe\+\_\+priority\+\_\+list} (\hyperlink{struct_t_c_p___client___connection}{T\+C\+P\+\_\+\+Client\+\_\+\+Connection} $\ast$con)
\item 
static int \hyperlink{_t_c_p__client_8c_ab959397449cc23b5811168e4395bdaea}{write\+\_\+packet\+\_\+\+T\+C\+P\+\_\+secure\+\_\+connection} (\hyperlink{struct_t_c_p___client___connection}{T\+C\+P\+\_\+\+Client\+\_\+\+Connection} $\ast$con, const uint8\+\_\+t $\ast$data, uint16\+\_\+t length, \+\_\+\+Bool priority)
\item 
int \hyperlink{_t_c_p__client_8c_a0dc7de6475c22a0a31722bbf7ebb8dc5}{send\+\_\+routing\+\_\+request} (\hyperlink{struct_t_c_p___client___connection}{T\+C\+P\+\_\+\+Client\+\_\+\+Connection} $\ast$con, uint8\+\_\+t $\ast$public\+\_\+key)
\item 
void \hyperlink{_t_c_p__client_8c_ac795068d9a0ba7b00db3db7bb5e217a7}{routing\+\_\+response\+\_\+handler} (\hyperlink{struct_t_c_p___client___connection}{T\+C\+P\+\_\+\+Client\+\_\+\+Connection} $\ast$con, int($\ast$\hyperlink{_t_c_p__test_8c_aabbbe757608283acb298ba44b3b01706}{response\+\_\+callback})(void $\ast$object, uint8\+\_\+t connection\+\_\+id, const uint8\+\_\+t $\ast$public\+\_\+key), void $\ast$object)
\item 
void \hyperlink{_t_c_p__client_8c_a263bc470c2cc015cbb0f975ab5632eb8}{routing\+\_\+status\+\_\+handler} (\hyperlink{struct_t_c_p___client___connection}{T\+C\+P\+\_\+\+Client\+\_\+\+Connection} $\ast$con, int($\ast$\hyperlink{_t_c_p__test_8c_ae4f12b6805a17277d33e73ac030d7aca}{status\+\_\+callback})(void $\ast$object, uint32\+\_\+t number, uint8\+\_\+t connection\+\_\+id, uint8\+\_\+t status), void $\ast$object)
\item 
static int \hyperlink{_t_c_p__client_8c_a8e1ca90aa8db34a58b3b38cfcb1bb9de}{send\+\_\+ping\+\_\+response} (\hyperlink{struct_t_c_p___client___connection}{T\+C\+P\+\_\+\+Client\+\_\+\+Connection} $\ast$con)
\item 
static int \hyperlink{_t_c_p__client_8c_a5aad81831c1333b763c9fd5eaf41603f}{send\+\_\+ping\+\_\+request} (\hyperlink{struct_t_c_p___client___connection}{T\+C\+P\+\_\+\+Client\+\_\+\+Connection} $\ast$con)
\item 
int \hyperlink{_t_c_p__client_8c_aea842652030d00bd8302e3c0201f95b9}{send\+\_\+data} (\hyperlink{struct_t_c_p___client___connection}{T\+C\+P\+\_\+\+Client\+\_\+\+Connection} $\ast$con, uint8\+\_\+t con\+\_\+id, const uint8\+\_\+t $\ast$data, uint16\+\_\+t length)
\item 
int \hyperlink{_t_c_p__client_8c_a7818a314434c2bb01c3ea406744f076b}{send\+\_\+oob\+\_\+packet} (\hyperlink{struct_t_c_p___client___connection}{T\+C\+P\+\_\+\+Client\+\_\+\+Connection} $\ast$con, const uint8\+\_\+t $\ast$public\+\_\+key, const uint8\+\_\+t $\ast$data, uint16\+\_\+t length)
\item 
int \hyperlink{_t_c_p__client_8c_a52921fadd1366f32c75e66d9c4340ed2}{set\+\_\+tcp\+\_\+connection\+\_\+number} (\hyperlink{struct_t_c_p___client___connection}{T\+C\+P\+\_\+\+Client\+\_\+\+Connection} $\ast$con, uint8\+\_\+t con\+\_\+id, uint32\+\_\+t number)
\item 
void \hyperlink{_t_c_p__client_8c_ab913946e478e2ead06cb9eccb7b7249b}{routing\+\_\+data\+\_\+handler} (\hyperlink{struct_t_c_p___client___connection}{T\+C\+P\+\_\+\+Client\+\_\+\+Connection} $\ast$con, int($\ast$\hyperlink{_t_c_p__test_8c_a36ed22ce4a6bec3fb113a4eaf29df5e1}{data\+\_\+callback})(void $\ast$object, uint32\+\_\+t number, uint8\+\_\+t connection\+\_\+id, const uint8\+\_\+t $\ast$data, uint16\+\_\+t length), void $\ast$object)
\item 
void \hyperlink{_t_c_p__client_8c_a34d78d05e93ac72b24092da391b05aa8}{oob\+\_\+data\+\_\+handler} (\hyperlink{struct_t_c_p___client___connection}{T\+C\+P\+\_\+\+Client\+\_\+\+Connection} $\ast$con, int($\ast$\hyperlink{_t_c_p__test_8c_a7a0dc2152e401dc318c450f172b3c124}{oob\+\_\+data\+\_\+callback})(void $\ast$object, const uint8\+\_\+t $\ast$public\+\_\+key, const uint8\+\_\+t $\ast$data, uint16\+\_\+t length), void $\ast$object)
\item 
static int \hyperlink{_t_c_p__client_8c_abe305661e19883349d213c74c44ff93f}{send\+\_\+disconnect\+\_\+notification} (\hyperlink{struct_t_c_p___client___connection}{T\+C\+P\+\_\+\+Client\+\_\+\+Connection} $\ast$con, uint8\+\_\+t id)
\item 
int \hyperlink{_t_c_p__client_8c_af83d9fac2256a46428ad95bf337c05b7}{send\+\_\+disconnect\+\_\+request} (\hyperlink{struct_t_c_p___client___connection}{T\+C\+P\+\_\+\+Client\+\_\+\+Connection} $\ast$con, uint8\+\_\+t con\+\_\+id)
\item 
int \hyperlink{_t_c_p__client_8c_a236ad67f85cc718a03fda2da3ade0787}{send\+\_\+onion\+\_\+request} (\hyperlink{struct_t_c_p___client___connection}{T\+C\+P\+\_\+\+Client\+\_\+\+Connection} $\ast$con, const uint8\+\_\+t $\ast$data, uint16\+\_\+t length)
\item 
void \hyperlink{_t_c_p__client_8c_ac71909171dbe8b0bdd4b349a9995634f}{onion\+\_\+response\+\_\+handler} (\hyperlink{struct_t_c_p___client___connection}{T\+C\+P\+\_\+\+Client\+\_\+\+Connection} $\ast$con, int($\ast$onion\+\_\+callback)(void $\ast$object, const uint8\+\_\+t $\ast$data, uint16\+\_\+t length), void $\ast$object)
\item 
\hyperlink{struct_t_c_p___client___connection}{T\+C\+P\+\_\+\+Client\+\_\+\+Connection} $\ast$ \hyperlink{_t_c_p__client_8c_aedb0d5c54ac7754bb342517247ac632d}{new\+\_\+\+T\+C\+P\+\_\+connection} (\hyperlink{struct_i_p___port}{I\+P\+\_\+\+Port} ip\+\_\+port, const uint8\+\_\+t $\ast$public\+\_\+key, const uint8\+\_\+t $\ast$self\+\_\+public\+\_\+key, const uint8\+\_\+t $\ast$self\+\_\+secret\+\_\+key, \hyperlink{struct_t_c_p___proxy___info}{T\+C\+P\+\_\+\+Proxy\+\_\+\+Info} $\ast$proxy\+\_\+info)
\item 
static int \hyperlink{_t_c_p__client_8c_a05bbb283dd70d0c6d7ed850b89368e3d}{handle\+\_\+\+T\+C\+P\+\_\+packet} (\hyperlink{struct_t_c_p___client___connection}{T\+C\+P\+\_\+\+Client\+\_\+\+Connection} $\ast$conn, const uint8\+\_\+t $\ast$data, uint16\+\_\+t length)
\item 
static int \hyperlink{_t_c_p__client_8c_a8fef95bc96c35d09a2705f79d7e08a5a}{do\+\_\+confirmed\+\_\+\+T\+C\+P} (\hyperlink{struct_t_c_p___client___connection}{T\+C\+P\+\_\+\+Client\+\_\+\+Connection} $\ast$conn)
\item 
void \hyperlink{_t_c_p__client_8c_a3333858c51935f9f546cf923b07ed845}{do\+\_\+\+T\+C\+P\+\_\+connection} (\hyperlink{struct_t_c_p___client___connection}{T\+C\+P\+\_\+\+Client\+\_\+\+Connection} $\ast$T\+C\+P\+\_\+connection)
\item 
void \hyperlink{_t_c_p__client_8c_a437ba55ccf24fb881acf298f3e225a63}{kill\+\_\+\+T\+C\+P\+\_\+connection} (\hyperlink{struct_t_c_p___client___connection}{T\+C\+P\+\_\+\+Client\+\_\+\+Connection} $\ast$T\+C\+P\+\_\+connection)
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\hypertarget{_t_c_p__client_8c_a87e67ddfe8fdabe9f2d32080097c3970}{\index{T\+C\+P\+\_\+client.\+c@{T\+C\+P\+\_\+client.\+c}!add\+\_\+priority@{add\+\_\+priority}}
\index{add\+\_\+priority@{add\+\_\+priority}!T\+C\+P\+\_\+client.\+c@{T\+C\+P\+\_\+client.\+c}}
\subsubsection[{add\+\_\+priority}]{\setlength{\rightskip}{0pt plus 5cm}static \+\_\+\+Bool add\+\_\+priority (
\begin{DoxyParamCaption}
\item[{{\bf T\+C\+P\+\_\+\+Client\+\_\+\+Connection} $\ast$}]{con, }
\item[{const uint8\+\_\+t $\ast$}]{packet, }
\item[{uint16\+\_\+t}]{size, }
\item[{uint16\+\_\+t}]{sent}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_t_c_p__client_8c_a87e67ddfe8fdabe9f2d32080097c3970}


Definition at line 325 of file T\+C\+P\+\_\+client.\+c.



References T\+C\+P\+\_\+\+Priority\+\_\+\+List\+::next, T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::priority\+\_\+queue\+\_\+end, and T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::priority\+\_\+queue\+\_\+start.



Referenced by write\+\_\+packet\+\_\+\+T\+C\+P\+\_\+secure\+\_\+connection().


\begin{DoxyCode}
326 \{
327     \hyperlink{struct_t_c_p___priority___list}{TCP\_Priority\_List} *p = con->\hyperlink{struct_t_c_p___client___connection_a049dfdaebf54337c3024e077370c62d7}{priority\_queue\_end}, *\textcolor{keyword}{new};
328     \textcolor{keyword}{new} = malloc(\textcolor{keyword}{sizeof}(\hyperlink{struct_t_c_p___priority___list}{TCP\_Priority\_List}) + size);
329 
330     \textcolor{keywordflow}{if} (!\textcolor{keyword}{new}) \{
331         \textcolor{keywordflow}{return} 0;
332     \}
333 
334     \textcolor{keyword}{new}->next = NULL;
335     \textcolor{keyword}{new}->size = size;
336     \textcolor{keyword}{new}->sent = sent;
337     memcpy(new->data, packet, size);
338 
339     \textcolor{keywordflow}{if} (p) \{
340         p->\hyperlink{struct_t_c_p___priority___list_ac4565314423a94bcf735245b8b9b4c53}{next} = \textcolor{keyword}{new};
341     \} \textcolor{keywordflow}{else} \{
342         con->\hyperlink{struct_t_c_p___client___connection_a5e19017835c72dc03d9dfd9a93abeb3c}{priority\_queue\_start} = \textcolor{keyword}{new};
343     \}
344 
345     con->\hyperlink{struct_t_c_p___client___connection_a049dfdaebf54337c3024e077370c62d7}{priority\_queue\_end} = \textcolor{keyword}{new};
346     \textcolor{keywordflow}{return} 1;
347 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{da/da1/_t_c_p__client_8c_a87e67ddfe8fdabe9f2d32080097c3970_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__client_8c_a60b303142f843cad13249065ddeefb17}{\index{T\+C\+P\+\_\+client.\+c@{T\+C\+P\+\_\+client.\+c}!connect\+\_\+sock\+\_\+to@{connect\+\_\+sock\+\_\+to}}
\index{connect\+\_\+sock\+\_\+to@{connect\+\_\+sock\+\_\+to}!T\+C\+P\+\_\+client.\+c@{T\+C\+P\+\_\+client.\+c}}
\subsubsection[{connect\+\_\+sock\+\_\+to}]{\setlength{\rightskip}{0pt plus 5cm}static int connect\+\_\+sock\+\_\+to (
\begin{DoxyParamCaption}
\item[{{\bf sock\+\_\+t}}]{sock, }
\item[{{\bf I\+P\+\_\+\+Port}}]{ip\+\_\+port, }
\item[{{\bf T\+C\+P\+\_\+\+Proxy\+\_\+\+Info} $\ast$}]{proxy\+\_\+info}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_t_c_p__client_8c_a60b303142f843cad13249065ddeefb17}


Definition at line 38 of file T\+C\+P\+\_\+client.\+c.



References I\+P\+::family, I\+P6\+::in6\+\_\+addr, I\+P4\+::in\+\_\+addr, I\+P\+\_\+\+Port\+::ip, I\+P\+::ip4, I\+P\+::ip6, T\+C\+P\+\_\+\+Proxy\+\_\+\+Info\+::ip\+\_\+port, I\+P\+\_\+\+Port\+::port, T\+C\+P\+\_\+\+Proxy\+\_\+\+Info\+::proxy\+\_\+type, and T\+C\+P\+\_\+\+P\+R\+O\+X\+Y\+\_\+\+N\+O\+N\+E.



Referenced by new\+\_\+\+T\+C\+P\+\_\+connection().


\begin{DoxyCode}
39 \{
40     \textcolor{keywordflow}{if} (proxy\_info->\hyperlink{struct_t_c_p___proxy___info_a23a098bd0536ae2000e1944e353b7d8b}{proxy\_type} != \hyperlink{_t_c_p__client_8h_ae3f1e841d616cab3ff982b5560aa215fa03246331c1cd872e9461ec9cd79f1f7c}{TCP\_PROXY\_NONE}) \{
41         ip\_port = proxy\_info->\hyperlink{struct_t_c_p___proxy___info_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port};
42     \}
43 
44     \textcolor{keyword}{struct }sockaddr\_storage addr = \{0\};
45 
46     \textcolor{keywordtype}{size\_t} addrsize;
47 
48     \textcolor{keywordflow}{if} (ip\_port.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} == AF\_INET) \{
49         \textcolor{keyword}{struct }sockaddr\_in *addr4 = (\textcolor{keyword}{struct }sockaddr\_in *)&addr;
50 
51         addrsize = \textcolor{keyword}{sizeof}(\textcolor{keyword}{struct }sockaddr\_in);
52         addr4->sin\_family = AF\_INET;
53         addr4->sin\_addr = ip\_port.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_aca19646000f55aa927406e68fc41ecf9}{ip4}.\hyperlink{union_i_p4_a5a47f63dce37e6eb6be40f022434b1c5}{in\_addr};
54         addr4->sin\_port = ip\_port.\hyperlink{struct_i_p___port_a8e0798404bf2cf5dabb84c5ba9a4f236}{port};
55     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (ip\_port.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} == AF\_INET6) \{
56         \textcolor{keyword}{struct }sockaddr\_in6 *addr6 = (\textcolor{keyword}{struct }sockaddr\_in6 *)&addr;
57 
58         addrsize = \textcolor{keyword}{sizeof}(\textcolor{keyword}{struct }sockaddr\_in6);
59         addr6->sin6\_family = AF\_INET6;
60         addr6->sin6\_addr = ip\_port.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_a14c606eb5ffb078c38ad854dc4e79507}{ip6}.\hyperlink{union_i_p6_ac312c20ade57f180c50585e9ea42314c}{in6\_addr};
61         addr6->sin6\_port = ip\_port.\hyperlink{struct_i_p___port_a8e0798404bf2cf5dabb84c5ba9a4f236}{port};
62     \} \textcolor{keywordflow}{else} \{
63         \textcolor{keywordflow}{return} 0;
64     \}
65 
66     \textcolor{comment}{/* nonblocking socket, connect will never return success */}
67     connect(\hyperlink{irc__syncbot_8c_a5903d0b282fc5eae503de618f896b5e1}{sock}, (\textcolor{keyword}{struct} sockaddr *)&addr, addrsize);
68     \textcolor{keywordflow}{return} 1;
69 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{da/da1/_t_c_p__client_8c_a60b303142f843cad13249065ddeefb17_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__client_8c_a8fef95bc96c35d09a2705f79d7e08a5a}{\index{T\+C\+P\+\_\+client.\+c@{T\+C\+P\+\_\+client.\+c}!do\+\_\+confirmed\+\_\+\+T\+C\+P@{do\+\_\+confirmed\+\_\+\+T\+C\+P}}
\index{do\+\_\+confirmed\+\_\+\+T\+C\+P@{do\+\_\+confirmed\+\_\+\+T\+C\+P}!T\+C\+P\+\_\+client.\+c@{T\+C\+P\+\_\+client.\+c}}
\subsubsection[{do\+\_\+confirmed\+\_\+\+T\+C\+P}]{\setlength{\rightskip}{0pt plus 5cm}static int do\+\_\+confirmed\+\_\+\+T\+C\+P (
\begin{DoxyParamCaption}
\item[{{\bf T\+C\+P\+\_\+\+Client\+\_\+\+Connection} $\ast$}]{conn}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_t_c_p__client_8c_a8fef95bc96c35d09a2705f79d7e08a5a}


Definition at line 827 of file T\+C\+P\+\_\+client.\+c.



References handle\+\_\+\+T\+C\+P\+\_\+packet(), is\+\_\+timeout(), T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::last\+\_\+pinged, M\+A\+X\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+S\+I\+Z\+E, T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::next\+\_\+packet\+\_\+length, T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::ping\+\_\+id, T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::ping\+\_\+request\+\_\+id, random\+\_\+64b(), read\+\_\+packet\+\_\+\+T\+C\+P\+\_\+secure\+\_\+connection(), T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::recv\+\_\+nonce, send\+\_\+pending\+\_\+data(), send\+\_\+ping\+\_\+request(), send\+\_\+ping\+\_\+response(), T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::shared\+\_\+key, T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::sock, T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::status, T\+C\+P\+\_\+\+C\+L\+I\+E\+N\+T\+\_\+\+D\+I\+S\+C\+O\+N\+N\+E\+C\+T\+E\+D, T\+C\+P\+\_\+\+P\+I\+N\+G\+\_\+\+F\+R\+E\+Q\+U\+E\+N\+C\+Y, T\+C\+P\+\_\+\+P\+I\+N\+G\+\_\+\+T\+I\+M\+E\+O\+U\+T, and unix\+\_\+time().



Referenced by do\+\_\+\+T\+C\+P\+\_\+connection().


\begin{DoxyCode}
828 \{
829     \hyperlink{_t_c_p__client_8c_a878656cc36ac482c8063082d0d86850f}{send\_pending\_data}(conn);
830     \hyperlink{_t_c_p__client_8c_a8e1ca90aa8db34a58b3b38cfcb1bb9de}{send\_ping\_response}(conn);
831     \hyperlink{_t_c_p__client_8c_a5aad81831c1333b763c9fd5eaf41603f}{send\_ping\_request}(conn);
832 
833     uint8\_t packet[\hyperlink{_t_c_p__server_8h_a879456c3b8e2853f7044d764e9c180d4}{MAX\_PACKET\_SIZE}];
834     \textcolor{keywordtype}{int} len;
835 
836     \textcolor{keywordflow}{if} (\hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(conn->\hyperlink{struct_t_c_p___client___connection_a4049204f6c392628d31be6c39f03e031}{last\_pinged}, \hyperlink{_t_c_p__server_8h_a779366bdff0863c4e36c9313b25fcb29}{TCP\_PING\_FREQUENCY})) \{
837         uint64\_t ping\_id = \hyperlink{crypto__core_8c_a1ce51b34ab2247e750b9c2a25121eb9e}{random\_64b}();
838 
839         \textcolor{keywordflow}{if} (!ping\_id)
840             ++ping\_id;
841 
842         conn->\hyperlink{struct_t_c_p___client___connection_a8695cc319f7cab1ea66cb80e403d455b}{ping\_request\_id} = conn->\hyperlink{struct_t_c_p___client___connection_acec02fbdff648ca71a6d8e5a0d63d634}{ping\_id} = ping\_id;
843         \hyperlink{_t_c_p__client_8c_a5aad81831c1333b763c9fd5eaf41603f}{send\_ping\_request}(conn);
844         conn->\hyperlink{struct_t_c_p___client___connection_a4049204f6c392628d31be6c39f03e031}{last\_pinged} = \hyperlink{util_8c_ac958d9f8847cb8039444bfa3d304233a}{unix\_time}();
845     \}
846 
847     \textcolor{keywordflow}{if} (conn->\hyperlink{struct_t_c_p___client___connection_acec02fbdff648ca71a6d8e5a0d63d634}{ping\_id} && \hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(conn->\hyperlink{struct_t_c_p___client___connection_a4049204f6c392628d31be6c39f03e031}{last\_pinged}, 
      \hyperlink{_t_c_p__server_8h_a09b714899296b82866bab0a4d294c917}{TCP\_PING\_TIMEOUT})) \{
848         conn->\hyperlink{struct_t_c_p___client___connection_ade818037fd6c985038ff29656089758d}{status} = \hyperlink{_t_c_p__client_8h_ae4d5251432e1a9e6803c0240cc492e18a066a0f8bc9d1c9b8e46e6eba719e703c}{TCP\_CLIENT\_DISCONNECTED};
849         \textcolor{keywordflow}{return} 0;
850     \}
851 
852     \textcolor{keywordflow}{while} ((len = \hyperlink{_t_c_p__server_8c_a2acbecbd76fe539293b5d92d0e0b6c5e}{read\_packet\_TCP\_secure\_connection}(conn->
      \hyperlink{struct_t_c_p___client___connection_a35b19d84fb632ca8ce5cab237f7089a5}{sock}, &conn->\hyperlink{struct_t_c_p___client___connection_a1d1e3047af3c935db36ae7b2360aaec7}{next\_packet\_length}, conn->\hyperlink{struct_t_c_p___client___connection_a81ead9fac55a0cedc30a96253a2c5119}{shared\_key},
853                   conn->\hyperlink{struct_t_c_p___client___connection_aae0467706f97aa3ef23e5dc9c3c199d7}{recv\_nonce}, packet, \textcolor{keyword}{sizeof}(packet)))) \{
854         \textcolor{keywordflow}{if} (len == -1) \{
855             conn->\hyperlink{struct_t_c_p___client___connection_ade818037fd6c985038ff29656089758d}{status} = \hyperlink{_t_c_p__client_8h_ae4d5251432e1a9e6803c0240cc492e18a066a0f8bc9d1c9b8e46e6eba719e703c}{TCP\_CLIENT\_DISCONNECTED};
856             \textcolor{keywordflow}{break};
857         \}
858 
859         \textcolor{keywordflow}{if} (\hyperlink{_t_c_p__client_8c_a05bbb283dd70d0c6d7ed850b89368e3d}{handle\_TCP\_packet}(conn, packet, len) == -1) \{
860             conn->\hyperlink{struct_t_c_p___client___connection_ade818037fd6c985038ff29656089758d}{status} = \hyperlink{_t_c_p__client_8h_ae4d5251432e1a9e6803c0240cc492e18a066a0f8bc9d1c9b8e46e6eba719e703c}{TCP\_CLIENT\_DISCONNECTED};
861             \textcolor{keywordflow}{break};
862         \}
863     \}
864 
865     \textcolor{keywordflow}{return} 0;
866 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{da/da1/_t_c_p__client_8c_a8fef95bc96c35d09a2705f79d7e08a5a_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{da/da1/_t_c_p__client_8c_a8fef95bc96c35d09a2705f79d7e08a5a_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__client_8c_a3333858c51935f9f546cf923b07ed845}{\index{T\+C\+P\+\_\+client.\+c@{T\+C\+P\+\_\+client.\+c}!do\+\_\+\+T\+C\+P\+\_\+connection@{do\+\_\+\+T\+C\+P\+\_\+connection}}
\index{do\+\_\+\+T\+C\+P\+\_\+connection@{do\+\_\+\+T\+C\+P\+\_\+connection}!T\+C\+P\+\_\+client.\+c@{T\+C\+P\+\_\+client.\+c}}
\subsubsection[{do\+\_\+\+T\+C\+P\+\_\+connection}]{\setlength{\rightskip}{0pt plus 5cm}void do\+\_\+\+T\+C\+P\+\_\+connection (
\begin{DoxyParamCaption}
\item[{{\bf T\+C\+P\+\_\+\+Client\+\_\+\+Connection} $\ast$}]{T\+C\+P\+\_\+connection}
\end{DoxyParamCaption}
)}}\label{_t_c_p__client_8c_a3333858c51935f9f546cf923b07ed845}


Definition at line 870 of file T\+C\+P\+\_\+client.\+c.



References make-\/funny-\/savefile\+::data, do\+\_\+confirmed\+\_\+\+T\+C\+P(), generate\+\_\+handshake(), handle\+\_\+handshake(), T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::kill\+\_\+at, proxy\+\_\+http\+\_\+read\+\_\+connection\+\_\+response(), proxy\+\_\+socks5\+\_\+generate\+\_\+connection\+\_\+request(), proxy\+\_\+socks5\+\_\+read\+\_\+connection\+\_\+response(), read\+\_\+\+T\+C\+P\+\_\+packet(), send\+\_\+pending\+\_\+data(), T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::sock, socks5\+\_\+read\+\_\+handshake\+\_\+response(), T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::status, T\+C\+P\+\_\+\+C\+L\+I\+E\+N\+T\+\_\+\+C\+O\+N\+F\+I\+R\+M\+E\+D, T\+C\+P\+\_\+\+C\+L\+I\+E\+N\+T\+\_\+\+C\+O\+N\+N\+E\+C\+T\+I\+N\+G, T\+C\+P\+\_\+\+C\+L\+I\+E\+N\+T\+\_\+\+D\+I\+S\+C\+O\+N\+N\+E\+C\+T\+E\+D, T\+C\+P\+\_\+\+C\+L\+I\+E\+N\+T\+\_\+\+P\+R\+O\+X\+Y\+\_\+\+H\+T\+T\+P\+\_\+\+C\+O\+N\+N\+E\+C\+T\+I\+N\+G, T\+C\+P\+\_\+\+C\+L\+I\+E\+N\+T\+\_\+\+P\+R\+O\+X\+Y\+\_\+\+S\+O\+C\+K\+S5\+\_\+\+C\+O\+N\+N\+E\+C\+T\+I\+N\+G, T\+C\+P\+\_\+\+C\+L\+I\+E\+N\+T\+\_\+\+P\+R\+O\+X\+Y\+\_\+\+S\+O\+C\+K\+S5\+\_\+\+U\+N\+C\+O\+N\+F\+I\+R\+M\+E\+D, T\+C\+P\+\_\+\+C\+L\+I\+E\+N\+T\+\_\+\+U\+N\+C\+O\+N\+F\+I\+R\+M\+E\+D, T\+C\+P\+\_\+\+S\+E\+R\+V\+E\+R\+\_\+\+H\+A\+N\+D\+S\+H\+A\+K\+E\+\_\+\+S\+I\+Z\+E, unix\+\_\+time(), and unix\+\_\+time\+\_\+update().



Referenced by do\+\_\+tcp\+\_\+conns(), and S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T().


\begin{DoxyCode}
871 \{
872     \hyperlink{util_8c_a849af10dd491723cf3abdef599846897}{unix\_time\_update}();
873 
874     \textcolor{keywordflow}{if} (TCP\_connection->\hyperlink{struct_t_c_p___client___connection_ade818037fd6c985038ff29656089758d}{status} == \hyperlink{_t_c_p__client_8h_ae4d5251432e1a9e6803c0240cc492e18a066a0f8bc9d1c9b8e46e6eba719e703c}{TCP\_CLIENT\_DISCONNECTED}) \{
875         \textcolor{keywordflow}{return};
876     \}
877 
878     \textcolor{keywordflow}{if} (TCP\_connection->\hyperlink{struct_t_c_p___client___connection_ade818037fd6c985038ff29656089758d}{status} == \hyperlink{_t_c_p__client_8h_ae4d5251432e1a9e6803c0240cc492e18acbb2a0d8636aaaf83994cc2fee5cc12a}{TCP\_CLIENT\_PROXY\_HTTP\_CONNECTING}) \{
879         \textcolor{keywordflow}{if} (\hyperlink{_t_c_p__client_8c_a878656cc36ac482c8063082d0d86850f}{send\_pending\_data}(TCP\_connection) == 0) \{
880             \textcolor{keywordtype}{int} ret = \hyperlink{_t_c_p__client_8c_a39080f686c09274aa55d7b352fcadd56}{proxy\_http\_read\_connection\_response}(TCP\_connection
      );
881 
882             \textcolor{keywordflow}{if} (ret == -1) \{
883                 TCP\_connection->\hyperlink{struct_t_c_p___client___connection_a2da98b8c0615e4e5fe47dd5f3bdebfab}{kill\_at} = 0;
884                 TCP\_connection->\hyperlink{struct_t_c_p___client___connection_ade818037fd6c985038ff29656089758d}{status} = \hyperlink{_t_c_p__client_8h_ae4d5251432e1a9e6803c0240cc492e18a066a0f8bc9d1c9b8e46e6eba719e703c}{TCP\_CLIENT\_DISCONNECTED};
885             \}
886 
887             \textcolor{keywordflow}{if} (ret == 1) \{
888                 \hyperlink{_t_c_p__client_8c_aec632a758fda6b73153ec16180750366}{generate\_handshake}(TCP\_connection);
889                 TCP\_connection->\hyperlink{struct_t_c_p___client___connection_ade818037fd6c985038ff29656089758d}{status} = \hyperlink{_t_c_p__client_8h_ae4d5251432e1a9e6803c0240cc492e18a9430d92af78e28f5ac054a303886c124}{TCP\_CLIENT\_CONNECTING};
890             \}
891         \}
892     \}
893 
894     \textcolor{keywordflow}{if} (TCP\_connection->\hyperlink{struct_t_c_p___client___connection_ade818037fd6c985038ff29656089758d}{status} == \hyperlink{_t_c_p__client_8h_ae4d5251432e1a9e6803c0240cc492e18acdc6053e3ea63e538d6515ff9a4b02ce}{TCP\_CLIENT\_PROXY\_SOCKS5\_CONNECTING}
      ) \{
895         \textcolor{keywordflow}{if} (\hyperlink{_t_c_p__client_8c_a878656cc36ac482c8063082d0d86850f}{send\_pending\_data}(TCP\_connection) == 0) \{
896             \textcolor{keywordtype}{int} ret = \hyperlink{_t_c_p__client_8c_ada9457c0effffd236ca9c4a004ee8942}{socks5\_read\_handshake\_response}(TCP\_connection);
897 
898             \textcolor{keywordflow}{if} (ret == -1) \{
899                 TCP\_connection->\hyperlink{struct_t_c_p___client___connection_a2da98b8c0615e4e5fe47dd5f3bdebfab}{kill\_at} = 0;
900                 TCP\_connection->\hyperlink{struct_t_c_p___client___connection_ade818037fd6c985038ff29656089758d}{status} = \hyperlink{_t_c_p__client_8h_ae4d5251432e1a9e6803c0240cc492e18a066a0f8bc9d1c9b8e46e6eba719e703c}{TCP\_CLIENT\_DISCONNECTED};
901             \}
902 
903             \textcolor{keywordflow}{if} (ret == 1) \{
904                 \hyperlink{_t_c_p__client_8c_a07b625ae786316d0942152868af0226b}{proxy\_socks5\_generate\_connection\_request}(
      TCP\_connection);
905                 TCP\_connection->\hyperlink{struct_t_c_p___client___connection_ade818037fd6c985038ff29656089758d}{status} = 
      \hyperlink{_t_c_p__client_8h_ae4d5251432e1a9e6803c0240cc492e18a998aec1006122df9892c2ffc4f94c6cb}{TCP\_CLIENT\_PROXY\_SOCKS5\_UNCONFIRMED};
906             \}
907         \}
908     \}
909 
910     \textcolor{keywordflow}{if} (TCP\_connection->\hyperlink{struct_t_c_p___client___connection_ade818037fd6c985038ff29656089758d}{status} == \hyperlink{_t_c_p__client_8h_ae4d5251432e1a9e6803c0240cc492e18a998aec1006122df9892c2ffc4f94c6cb}{TCP\_CLIENT\_PROXY\_SOCKS5\_UNCONFIRMED}
      ) \{
911         \textcolor{keywordflow}{if} (\hyperlink{_t_c_p__client_8c_a878656cc36ac482c8063082d0d86850f}{send\_pending\_data}(TCP\_connection) == 0) \{
912             \textcolor{keywordtype}{int} ret = \hyperlink{_t_c_p__client_8c_a258117084993caf09bd2d1c04425d7f0}{proxy\_socks5\_read\_connection\_response}(
      TCP\_connection);
913 
914             \textcolor{keywordflow}{if} (ret == -1) \{
915                 TCP\_connection->\hyperlink{struct_t_c_p___client___connection_a2da98b8c0615e4e5fe47dd5f3bdebfab}{kill\_at} = 0;
916                 TCP\_connection->\hyperlink{struct_t_c_p___client___connection_ade818037fd6c985038ff29656089758d}{status} = \hyperlink{_t_c_p__client_8h_ae4d5251432e1a9e6803c0240cc492e18a066a0f8bc9d1c9b8e46e6eba719e703c}{TCP\_CLIENT\_DISCONNECTED};
917             \}
918 
919             \textcolor{keywordflow}{if} (ret == 1) \{
920                 \hyperlink{_t_c_p__client_8c_aec632a758fda6b73153ec16180750366}{generate\_handshake}(TCP\_connection);
921                 TCP\_connection->\hyperlink{struct_t_c_p___client___connection_ade818037fd6c985038ff29656089758d}{status} = \hyperlink{_t_c_p__client_8h_ae4d5251432e1a9e6803c0240cc492e18a9430d92af78e28f5ac054a303886c124}{TCP\_CLIENT\_CONNECTING};
922             \}
923         \}
924     \}
925 
926     \textcolor{keywordflow}{if} (TCP\_connection->\hyperlink{struct_t_c_p___client___connection_ade818037fd6c985038ff29656089758d}{status} == \hyperlink{_t_c_p__client_8h_ae4d5251432e1a9e6803c0240cc492e18a9430d92af78e28f5ac054a303886c124}{TCP\_CLIENT\_CONNECTING}) \{
927         \textcolor{keywordflow}{if} (\hyperlink{_t_c_p__client_8c_a878656cc36ac482c8063082d0d86850f}{send\_pending\_data}(TCP\_connection) == 0) \{
928             TCP\_connection->\hyperlink{struct_t_c_p___client___connection_ade818037fd6c985038ff29656089758d}{status} = \hyperlink{_t_c_p__client_8h_ae4d5251432e1a9e6803c0240cc492e18a1d498784503bcb95d53252e4fee9ef31}{TCP\_CLIENT\_UNCONFIRMED};
929         \}
930     \}
931 
932     \textcolor{keywordflow}{if} (TCP\_connection->\hyperlink{struct_t_c_p___client___connection_ade818037fd6c985038ff29656089758d}{status} == \hyperlink{_t_c_p__client_8h_ae4d5251432e1a9e6803c0240cc492e18a1d498784503bcb95d53252e4fee9ef31}{TCP\_CLIENT\_UNCONFIRMED}) \{
933         uint8\_t \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[\hyperlink{_t_c_p__server_8h_a88a61b02e465cd8c05fbae1def1066f2}{TCP\_SERVER\_HANDSHAKE\_SIZE}];
934         \textcolor{keywordtype}{int} len = \hyperlink{_t_c_p__server_8c_a88eda37b476d8dcfdba94899e740dd9e}{read\_TCP\_packet}(TCP\_connection->\hyperlink{struct_t_c_p___client___connection_a35b19d84fb632ca8ce5cab237f7089a5}{sock}, data, \textcolor{keyword}{sizeof}(data));
935 
936         \textcolor{keywordflow}{if} (\textcolor{keyword}{sizeof}(data) == len) \{
937             \textcolor{keywordflow}{if} (\hyperlink{_t_c_p__client_8c_a4f324d76d4f1f967dab83e064d09c58a}{handle\_handshake}(TCP\_connection, data) == 0) \{
938                 TCP\_connection->\hyperlink{struct_t_c_p___client___connection_a2da98b8c0615e4e5fe47dd5f3bdebfab}{kill\_at} = ~0;
939                 TCP\_connection->\hyperlink{struct_t_c_p___client___connection_ade818037fd6c985038ff29656089758d}{status} = \hyperlink{_t_c_p__client_8h_ae4d5251432e1a9e6803c0240cc492e18a5751b9ce4d04cb2496f4eeec142ddaf1}{TCP\_CLIENT\_CONFIRMED};
940             \} \textcolor{keywordflow}{else} \{
941                 TCP\_connection->\hyperlink{struct_t_c_p___client___connection_a2da98b8c0615e4e5fe47dd5f3bdebfab}{kill\_at} = 0;
942                 TCP\_connection->\hyperlink{struct_t_c_p___client___connection_ade818037fd6c985038ff29656089758d}{status} = \hyperlink{_t_c_p__client_8h_ae4d5251432e1a9e6803c0240cc492e18a066a0f8bc9d1c9b8e46e6eba719e703c}{TCP\_CLIENT\_DISCONNECTED};
943             \}
944         \}
945     \}
946 
947     \textcolor{keywordflow}{if} (TCP\_connection->\hyperlink{struct_t_c_p___client___connection_ade818037fd6c985038ff29656089758d}{status} == \hyperlink{_t_c_p__client_8h_ae4d5251432e1a9e6803c0240cc492e18a5751b9ce4d04cb2496f4eeec142ddaf1}{TCP\_CLIENT\_CONFIRMED}) \{
948         \hyperlink{_t_c_p__client_8c_a8fef95bc96c35d09a2705f79d7e08a5a}{do\_confirmed\_TCP}(TCP\_connection);
949     \}
950 
951     \textcolor{keywordflow}{if} (TCP\_connection->\hyperlink{struct_t_c_p___client___connection_a2da98b8c0615e4e5fe47dd5f3bdebfab}{kill\_at} <= \hyperlink{util_8c_ac958d9f8847cb8039444bfa3d304233a}{unix\_time}()) \{
952         TCP\_connection->\hyperlink{struct_t_c_p___client___connection_ade818037fd6c985038ff29656089758d}{status} = \hyperlink{_t_c_p__client_8h_ae4d5251432e1a9e6803c0240cc492e18a066a0f8bc9d1c9b8e46e6eba719e703c}{TCP\_CLIENT\_DISCONNECTED};
953     \}
954 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{da/da1/_t_c_p__client_8c_a3333858c51935f9f546cf923b07ed845_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{da/da1/_t_c_p__client_8c_a3333858c51935f9f546cf923b07ed845_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__client_8c_aec632a758fda6b73153ec16180750366}{\index{T\+C\+P\+\_\+client.\+c@{T\+C\+P\+\_\+client.\+c}!generate\+\_\+handshake@{generate\+\_\+handshake}}
\index{generate\+\_\+handshake@{generate\+\_\+handshake}!T\+C\+P\+\_\+client.\+c@{T\+C\+P\+\_\+client.\+c}}
\subsubsection[{generate\+\_\+handshake}]{\setlength{\rightskip}{0pt plus 5cm}static int generate\+\_\+handshake (
\begin{DoxyParamCaption}
\item[{{\bf T\+C\+P\+\_\+\+Client\+\_\+\+Connection} $\ast$}]{T\+C\+P\+\_\+conn}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_t_c_p__client_8c_aec632a758fda6b73153ec16180750366}


Definition at line 219 of file T\+C\+P\+\_\+client.\+c.



References encrypt\+\_\+data\+\_\+symmetric(), T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::last\+\_\+packet, T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::last\+\_\+packet\+\_\+length, T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::last\+\_\+packet\+\_\+sent, new\+\_\+nonce(), random\+\_\+nonce(), T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::self\+\_\+public\+\_\+key, T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::sent\+\_\+nonce, T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::shared\+\_\+key, and T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::temp\+\_\+secret\+\_\+key.



Referenced by do\+\_\+\+T\+C\+P\+\_\+connection(), and new\+\_\+\+T\+C\+P\+\_\+connection().


\begin{DoxyCode}
220 \{
221     uint8\_t plain[crypto\_box\_PUBLICKEYBYTES + crypto\_box\_NONCEBYTES];
222     crypto\_box\_keypair(plain, TCP\_conn->\hyperlink{struct_t_c_p___client___connection_a6de303feb7b7892cc6a38228554b3e78}{temp\_secret\_key});
223     \hyperlink{crypto__core_8c_a15ef255ab026d4881a16b99148b05dd7}{random\_nonce}(TCP\_conn->\hyperlink{struct_t_c_p___client___connection_a9df0e00e8f493ed6cd1ff45e7da33c0d}{sent\_nonce});
224     memcpy(plain + crypto\_box\_PUBLICKEYBYTES, TCP\_conn->\hyperlink{struct_t_c_p___client___connection_a9df0e00e8f493ed6cd1ff45e7da33c0d}{sent\_nonce}, crypto\_box\_NONCEBYTES);
225     memcpy(TCP\_conn->\hyperlink{struct_t_c_p___client___connection_af7b6d103d243e4267b112f6efe1573e2}{last\_packet}, TCP\_conn->\hyperlink{struct_t_c_p___client___connection_ae726df8bdc26380e5a6c3187a00d6881}{self\_public\_key}, 
      crypto\_box\_PUBLICKEYBYTES);
226     \hyperlink{crypto__core_8c_a8b1033efb47c625779d11be7d8eb9e24}{new\_nonce}(TCP\_conn->\hyperlink{struct_t_c_p___client___connection_af7b6d103d243e4267b112f6efe1573e2}{last\_packet} + crypto\_box\_PUBLICKEYBYTES);
227     \textcolor{keywordtype}{int} len = \hyperlink{crypto__core_8c_a81efc0a4a6e0efe372651e26e342a6e5}{encrypt\_data\_symmetric}(TCP\_conn->\hyperlink{struct_t_c_p___client___connection_a81ead9fac55a0cedc30a96253a2c5119}{shared\_key}, TCP\_conn->
      \hyperlink{struct_t_c_p___client___connection_af7b6d103d243e4267b112f6efe1573e2}{last\_packet} + crypto\_box\_PUBLICKEYBYTES, plain,
228                                      \textcolor{keyword}{sizeof}(plain), TCP\_conn->\hyperlink{struct_t_c_p___client___connection_af7b6d103d243e4267b112f6efe1573e2}{last\_packet} + 
      crypto\_box\_PUBLICKEYBYTES + crypto\_box\_NONCEBYTES);
229 
230     \textcolor{keywordflow}{if} (len != \textcolor{keyword}{sizeof}(plain) + crypto\_box\_MACBYTES)
231         \textcolor{keywordflow}{return} -1;
232 
233     TCP\_conn->\hyperlink{struct_t_c_p___client___connection_a78d503fe4c8d935701480b58a0461775}{last\_packet\_length} = crypto\_box\_PUBLICKEYBYTES + crypto\_box\_NONCEBYTES + \textcolor{keyword}{
      sizeof}(plain) + crypto\_box\_MACBYTES;
234     TCP\_conn->\hyperlink{struct_t_c_p___client___connection_a80b55fa7d5b8e4c3de6b51c99d7670cc}{last\_packet\_sent} = 0;
235     \textcolor{keywordflow}{return} 0;
236 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{da/da1/_t_c_p__client_8c_aec632a758fda6b73153ec16180750366_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{da/da1/_t_c_p__client_8c_aec632a758fda6b73153ec16180750366_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__client_8c_a4f324d76d4f1f967dab83e064d09c58a}{\index{T\+C\+P\+\_\+client.\+c@{T\+C\+P\+\_\+client.\+c}!handle\+\_\+handshake@{handle\+\_\+handshake}}
\index{handle\+\_\+handshake@{handle\+\_\+handshake}!T\+C\+P\+\_\+client.\+c@{T\+C\+P\+\_\+client.\+c}}
\subsubsection[{handle\+\_\+handshake}]{\setlength{\rightskip}{0pt plus 5cm}static int handle\+\_\+handshake (
\begin{DoxyParamCaption}
\item[{{\bf T\+C\+P\+\_\+\+Client\+\_\+\+Connection} $\ast$}]{T\+C\+P\+\_\+conn, }
\item[{const uint8\+\_\+t $\ast$}]{data}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_t_c_p__client_8c_a4f324d76d4f1f967dab83e064d09c58a}


Definition at line 243 of file T\+C\+P\+\_\+client.\+c.



References decrypt\+\_\+data\+\_\+symmetric(), encrypt\+\_\+precompute(), T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::recv\+\_\+nonce, T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::shared\+\_\+key, T\+C\+P\+\_\+\+S\+E\+R\+V\+E\+R\+\_\+\+H\+A\+N\+D\+S\+H\+A\+K\+E\+\_\+\+S\+I\+Z\+E, and T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::temp\+\_\+secret\+\_\+key.



Referenced by do\+\_\+\+T\+C\+P\+\_\+connection().


\begin{DoxyCode}
244 \{
245     uint8\_t plain[crypto\_box\_PUBLICKEYBYTES + crypto\_box\_NONCEBYTES];
246     \textcolor{keywordtype}{int} len = \hyperlink{crypto__core_8c_a824b257fcff74b9d17c5247223fbed29}{decrypt\_data\_symmetric}(TCP\_conn->\hyperlink{struct_t_c_p___client___connection_a81ead9fac55a0cedc30a96253a2c5119}{shared\_key}, 
      \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} + crypto\_box\_NONCEBYTES,
247                                      \hyperlink{_t_c_p__server_8h_a88a61b02e465cd8c05fbae1def1066f2}{TCP\_SERVER\_HANDSHAKE\_SIZE} - 
      crypto\_box\_NONCEBYTES, plain);
248 
249     \textcolor{keywordflow}{if} (len != \textcolor{keyword}{sizeof}(plain))
250         \textcolor{keywordflow}{return} -1;
251 
252     memcpy(TCP\_conn->\hyperlink{struct_t_c_p___client___connection_aae0467706f97aa3ef23e5dc9c3c199d7}{recv\_nonce}, plain + crypto\_box\_PUBLICKEYBYTES, crypto\_box\_NONCEBYTES);
253     \hyperlink{crypto__core_8c_a0d8eaef49981c5dc3ada078866b42f6d}{encrypt\_precompute}(plain, TCP\_conn->\hyperlink{struct_t_c_p___client___connection_a6de303feb7b7892cc6a38228554b3e78}{temp\_secret\_key}, TCP\_conn->
      \hyperlink{struct_t_c_p___client___connection_a81ead9fac55a0cedc30a96253a2c5119}{shared\_key});
254     memset(TCP\_conn->\hyperlink{struct_t_c_p___client___connection_a6de303feb7b7892cc6a38228554b3e78}{temp\_secret\_key}, 0, crypto\_box\_SECRETKEYBYTES);
255     \textcolor{keywordflow}{return} 0;
256 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=338pt]{da/da1/_t_c_p__client_8c_a4f324d76d4f1f967dab83e064d09c58a_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{da/da1/_t_c_p__client_8c_a4f324d76d4f1f967dab83e064d09c58a_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__client_8c_a05bbb283dd70d0c6d7ed850b89368e3d}{\index{T\+C\+P\+\_\+client.\+c@{T\+C\+P\+\_\+client.\+c}!handle\+\_\+\+T\+C\+P\+\_\+packet@{handle\+\_\+\+T\+C\+P\+\_\+packet}}
\index{handle\+\_\+\+T\+C\+P\+\_\+packet@{handle\+\_\+\+T\+C\+P\+\_\+packet}!T\+C\+P\+\_\+client.\+c@{T\+C\+P\+\_\+client.\+c}}
\subsubsection[{handle\+\_\+\+T\+C\+P\+\_\+packet}]{\setlength{\rightskip}{0pt plus 5cm}static int handle\+\_\+\+T\+C\+P\+\_\+packet (
\begin{DoxyParamCaption}
\item[{{\bf T\+C\+P\+\_\+\+Client\+\_\+\+Connection} $\ast$}]{conn, }
\item[{const uint8\+\_\+t $\ast$}]{data, }
\item[{uint16\+\_\+t}]{length}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_t_c_p__client_8c_a05bbb283dd70d0c6d7ed850b89368e3d}


Definition at line 695 of file T\+C\+P\+\_\+client.\+c.



References T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::connections, T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::data\+\_\+callback, T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::data\+\_\+callback\+\_\+object, N\+U\+M\+\_\+\+R\+E\+S\+E\+R\+V\+E\+D\+\_\+\+P\+O\+R\+T\+S, T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::number, T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::onion\+\_\+callback, T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::onion\+\_\+callback\+\_\+object, T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::oob\+\_\+data\+\_\+callback, T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::oob\+\_\+data\+\_\+callback\+\_\+object, T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::ping\+\_\+id, T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::ping\+\_\+response\+\_\+id, T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::public\+\_\+key, T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::response\+\_\+callback, T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::response\+\_\+callback\+\_\+object, send\+\_\+ping\+\_\+response(), T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::status, T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::status\+\_\+callback, T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::status\+\_\+callback\+\_\+object, T\+C\+P\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+C\+O\+N\+N\+E\+C\+T\+I\+O\+N\+\_\+\+N\+O\+T\+I\+F\+I\+C\+A\+T\+I\+O\+N, T\+C\+P\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+D\+I\+S\+C\+O\+N\+N\+E\+C\+T\+\_\+\+N\+O\+T\+I\+F\+I\+C\+A\+T\+I\+O\+N, T\+C\+P\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+O\+N\+I\+O\+N\+\_\+\+R\+E\+S\+P\+O\+N\+S\+E, T\+C\+P\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+O\+O\+B\+\_\+\+R\+E\+C\+V, T\+C\+P\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+P\+I\+N\+G, T\+C\+P\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+P\+O\+N\+G, and T\+C\+P\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+R\+O\+U\+T\+I\+N\+G\+\_\+\+R\+E\+S\+P\+O\+N\+S\+E.



Referenced by do\+\_\+confirmed\+\_\+\+T\+C\+P().


\begin{DoxyCode}
696 \{
697     \textcolor{keywordflow}{if} (length <= 1)
698         \textcolor{keywordflow}{return} -1;
699 
700     \textcolor{keywordflow}{switch} (\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[0]) \{
701         \textcolor{keywordflow}{case} \hyperlink{_t_c_p__server_8h_ad288b46b857552d69e64135b3a329d83}{TCP\_PACKET\_ROUTING\_RESPONSE}: \{
702             \textcolor{keywordflow}{if} (length != 1 + 1 + crypto\_box\_PUBLICKEYBYTES)
703                 \textcolor{keywordflow}{return} -1;
704 
705             \textcolor{keywordflow}{if} (\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[1] < \hyperlink{_t_c_p__server_8h_a41d07eb7b13b1998b771080dfaef6b7b}{NUM\_RESERVED\_PORTS})
706                 \textcolor{keywordflow}{return} 0;
707 
708             uint8\_t con\_id = \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[1] - \hyperlink{_t_c_p__server_8h_a41d07eb7b13b1998b771080dfaef6b7b}{NUM\_RESERVED\_PORTS};
709 
710             \textcolor{keywordflow}{if} (conn->\hyperlink{struct_t_c_p___client___connection_a5b7b7af3e8287597e380502eb776cd7a}{connections}[con\_id].\hyperlink{struct_t_c_p___client___connection_ade818037fd6c985038ff29656089758d}{status} != 0)
711                 \textcolor{keywordflow}{return} 0;
712 
713             conn->\hyperlink{struct_t_c_p___client___connection_a5b7b7af3e8287597e380502eb776cd7a}{connections}[con\_id].\hyperlink{struct_t_c_p___client___connection_ade818037fd6c985038ff29656089758d}{status} = 1;
714             conn->\hyperlink{struct_t_c_p___client___connection_a5b7b7af3e8287597e380502eb776cd7a}{connections}[con\_id].\hyperlink{struct_t_c_p___client___connection_ad50c630d233a71112a7df136970caefc}{number} = ~0;
715             memcpy(conn->\hyperlink{struct_t_c_p___client___connection_a5b7b7af3e8287597e380502eb776cd7a}{connections}[con\_id].\hyperlink{struct_t_c_p___client___connection_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, 
      \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} + 2, crypto\_box\_PUBLICKEYBYTES);
716 
717             \textcolor{keywordflow}{if} (conn->\hyperlink{struct_t_c_p___client___connection_ab32747bc59a98c0c7127293859eccb85}{response\_callback})
718                 conn->\hyperlink{struct_t_c_p___client___connection_ab32747bc59a98c0c7127293859eccb85}{response\_callback}(conn->
      \hyperlink{struct_t_c_p___client___connection_a60ca473249fab46aefe6f89158bd5a52}{response\_callback\_object}, con\_id, conn->\hyperlink{struct_t_c_p___client___connection_a5b7b7af3e8287597e380502eb776cd7a}{connections}[con\_id].
      \hyperlink{struct_t_c_p___client___connection_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key});
719 
720             \textcolor{keywordflow}{return} 0;
721         \}
722 
723         \textcolor{keywordflow}{case} \hyperlink{_t_c_p__server_8h_ae03ebbe7438d78a242e6970f35eb6dfa}{TCP\_PACKET\_CONNECTION\_NOTIFICATION}: \{
724             \textcolor{keywordflow}{if} (length != 1 + 1)
725                 \textcolor{keywordflow}{return} -1;
726 
727             \textcolor{keywordflow}{if} (\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[1] < NUM\_RESERVED\_PORTS)
728                 \textcolor{keywordflow}{return} -1;
729 
730             uint8\_t con\_id = \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[1] - \hyperlink{_t_c_p__server_8h_a41d07eb7b13b1998b771080dfaef6b7b}{NUM\_RESERVED\_PORTS};
731 
732             \textcolor{keywordflow}{if} (conn->\hyperlink{struct_t_c_p___client___connection_a5b7b7af3e8287597e380502eb776cd7a}{connections}[con\_id].\hyperlink{struct_t_c_p___client___connection_ade818037fd6c985038ff29656089758d}{status} != 1)
733                 \textcolor{keywordflow}{return} 0;
734 
735             conn->\hyperlink{struct_t_c_p___client___connection_a5b7b7af3e8287597e380502eb776cd7a}{connections}[con\_id].\hyperlink{struct_t_c_p___client___connection_ade818037fd6c985038ff29656089758d}{status} = 2;
736 
737             \textcolor{keywordflow}{if} (conn->\hyperlink{struct_t_c_p___client___connection_a8c56af2094f8d2846998b395dbcaef18}{status\_callback})
738                 conn->\hyperlink{struct_t_c_p___client___connection_a8c56af2094f8d2846998b395dbcaef18}{status\_callback}(conn->
      \hyperlink{struct_t_c_p___client___connection_a73f125475af5ebdac27d2c2a9060039b}{status\_callback\_object}, conn->\hyperlink{struct_t_c_p___client___connection_a5b7b7af3e8287597e380502eb776cd7a}{connections}[con\_id].
      \hyperlink{struct_t_c_p___client___connection_ad50c630d233a71112a7df136970caefc}{number}, con\_id,
739                                       conn->\hyperlink{struct_t_c_p___client___connection_a5b7b7af3e8287597e380502eb776cd7a}{connections}[con\_id].
      \hyperlink{struct_t_c_p___client___connection_ade818037fd6c985038ff29656089758d}{status});
740 
741             \textcolor{keywordflow}{return} 0;
742         \}
743 
744         \textcolor{keywordflow}{case} \hyperlink{_t_c_p__server_8h_a65b6df680eaecb9563dfcc8c5fcfba3d}{TCP\_PACKET\_DISCONNECT\_NOTIFICATION}: \{
745             \textcolor{keywordflow}{if} (length != 1 + 1)
746                 \textcolor{keywordflow}{return} -1;
747 
748             \textcolor{keywordflow}{if} (\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[1] < NUM\_RESERVED\_PORTS)
749                 \textcolor{keywordflow}{return} -1;
750 
751             uint8\_t con\_id = \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[1] - \hyperlink{_t_c_p__server_8h_a41d07eb7b13b1998b771080dfaef6b7b}{NUM\_RESERVED\_PORTS};
752 
753             \textcolor{keywordflow}{if} (conn->\hyperlink{struct_t_c_p___client___connection_a5b7b7af3e8287597e380502eb776cd7a}{connections}[con\_id].\hyperlink{struct_t_c_p___client___connection_ade818037fd6c985038ff29656089758d}{status} == 0)
754                 \textcolor{keywordflow}{return} 0;
755 
756             \textcolor{keywordflow}{if} (conn->\hyperlink{struct_t_c_p___client___connection_a5b7b7af3e8287597e380502eb776cd7a}{connections}[con\_id].\hyperlink{struct_t_c_p___client___connection_ade818037fd6c985038ff29656089758d}{status} != 2)
757                 \textcolor{keywordflow}{return} 0;
758 
759             conn->\hyperlink{struct_t_c_p___client___connection_a5b7b7af3e8287597e380502eb776cd7a}{connections}[con\_id].\hyperlink{struct_t_c_p___client___connection_ade818037fd6c985038ff29656089758d}{status} = 1;
760 
761             \textcolor{keywordflow}{if} (conn->\hyperlink{struct_t_c_p___client___connection_a8c56af2094f8d2846998b395dbcaef18}{status\_callback})
762                 conn->\hyperlink{struct_t_c_p___client___connection_a8c56af2094f8d2846998b395dbcaef18}{status\_callback}(conn->
      \hyperlink{struct_t_c_p___client___connection_a73f125475af5ebdac27d2c2a9060039b}{status\_callback\_object}, conn->\hyperlink{struct_t_c_p___client___connection_a5b7b7af3e8287597e380502eb776cd7a}{connections}[con\_id].
      \hyperlink{struct_t_c_p___client___connection_ad50c630d233a71112a7df136970caefc}{number}, con\_id,
763                                       conn->\hyperlink{struct_t_c_p___client___connection_a5b7b7af3e8287597e380502eb776cd7a}{connections}[con\_id].
      \hyperlink{struct_t_c_p___client___connection_ade818037fd6c985038ff29656089758d}{status});
764 
765             \textcolor{keywordflow}{return} 0;
766         \}
767 
768         \textcolor{keywordflow}{case} \hyperlink{_t_c_p__server_8h_aa1328be3bbb33d8e47490408376c3553}{TCP\_PACKET\_PING}: \{
769             \textcolor{keywordflow}{if} (length != 1 + \textcolor{keyword}{sizeof}(uint64\_t))
770                 \textcolor{keywordflow}{return} -1;
771 
772             uint64\_t ping\_id;
773             memcpy(&ping\_id, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} + 1, \textcolor{keyword}{sizeof}(uint64\_t));
774             conn->\hyperlink{struct_t_c_p___client___connection_a39a52d8f19b6b09a91980f9798ec5b50}{ping\_response\_id} = ping\_id;
775             \hyperlink{_t_c_p__client_8c_a8e1ca90aa8db34a58b3b38cfcb1bb9de}{send\_ping\_response}(conn);
776             \textcolor{keywordflow}{return} 0;
777         \}
778 
779         \textcolor{keywordflow}{case} \hyperlink{_t_c_p__server_8h_a783819134f7296fb82cfc3149f6fbb62}{TCP\_PACKET\_PONG}: \{
780             \textcolor{keywordflow}{if} (length != 1 + \textcolor{keyword}{sizeof}(uint64\_t))
781                 \textcolor{keywordflow}{return} -1;
782 
783             uint64\_t ping\_id;
784             memcpy(&ping\_id, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} + 1, \textcolor{keyword}{sizeof}(uint64\_t));
785 
786             \textcolor{keywordflow}{if} (ping\_id) \{
787                 \textcolor{keywordflow}{if} (ping\_id == conn->\hyperlink{struct_t_c_p___client___connection_acec02fbdff648ca71a6d8e5a0d63d634}{ping\_id}) \{
788                     conn->\hyperlink{struct_t_c_p___client___connection_acec02fbdff648ca71a6d8e5a0d63d634}{ping\_id} = 0;
789                 \}
790 
791                 \textcolor{keywordflow}{return} 0;
792             \} \textcolor{keywordflow}{else} \{
793                 \textcolor{keywordflow}{return} -1;
794             \}
795         \}
796 
797         \textcolor{keywordflow}{case} \hyperlink{_t_c_p__server_8h_a6d824009f914ddf664d60adf6695189c}{TCP\_PACKET\_OOB\_RECV}: \{
798             \textcolor{keywordflow}{if} (length <= 1 + crypto\_box\_PUBLICKEYBYTES)
799                 \textcolor{keywordflow}{return} -1;
800 
801             \textcolor{keywordflow}{if} (conn->\hyperlink{struct_t_c_p___client___connection_a3f8394ec4439b5730e80f10d6951b845}{oob\_data\_callback})
802                 conn->\hyperlink{struct_t_c_p___client___connection_a3f8394ec4439b5730e80f10d6951b845}{oob\_data\_callback}(conn->
      \hyperlink{struct_t_c_p___client___connection_a3bd56ba2917797a0eea802a7192ef031}{oob\_data\_callback\_object}, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} + 1, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} + 1 + crypto\_box\_PUBLICKEYBYTES,
803                                         length - (1 + crypto\_box\_PUBLICKEYBYTES));
804 
805             \textcolor{keywordflow}{return} 0;
806         \}
807 
808         \textcolor{keywordflow}{case} \hyperlink{_t_c_p__server_8h_acbe72759c701ff843abf6a80dafee7e8}{TCP\_PACKET\_ONION\_RESPONSE}: \{
809             conn->\hyperlink{struct_t_c_p___client___connection_ab6dd4883cc217ef4c036cb404f036a47}{onion\_callback}(conn->\hyperlink{struct_t_c_p___client___connection_a975f7347f9eee77bcd1eb36b5e913021}{onion\_callback\_object}, 
      \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} + 1, length - 1);
810             \textcolor{keywordflow}{return} 0;
811         \}
812 
813         \textcolor{keywordflow}{default}: \{
814             \textcolor{keywordflow}{if} (\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[0] < NUM\_RESERVED\_PORTS)
815                 \textcolor{keywordflow}{return} -1;
816 
817             uint8\_t con\_id = \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[0] - \hyperlink{_t_c_p__server_8h_a41d07eb7b13b1998b771080dfaef6b7b}{NUM\_RESERVED\_PORTS};
818 
819             \textcolor{keywordflow}{if} (conn->\hyperlink{struct_t_c_p___client___connection_a2da80454e9a05921b2c6616ffb021eec}{data\_callback})
820                 conn->\hyperlink{struct_t_c_p___client___connection_a2da80454e9a05921b2c6616ffb021eec}{data\_callback}(conn->\hyperlink{struct_t_c_p___client___connection_a9135a1782241a1b2d5e9bcedef0c29a5}{data\_callback\_object}, conn->
      \hyperlink{struct_t_c_p___client___connection_a5b7b7af3e8287597e380502eb776cd7a}{connections}[con\_id].\hyperlink{struct_t_c_p___client___connection_ad50c630d233a71112a7df136970caefc}{number}, con\_id, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} + 1, length - 1);
821         \}
822     \}
823 
824     \textcolor{keywordflow}{return} 0;
825 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{da/da1/_t_c_p__client_8c_a05bbb283dd70d0c6d7ed850b89368e3d_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{da/da1/_t_c_p__client_8c_a05bbb283dd70d0c6d7ed850b89368e3d_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__client_8c_a437ba55ccf24fb881acf298f3e225a63}{\index{T\+C\+P\+\_\+client.\+c@{T\+C\+P\+\_\+client.\+c}!kill\+\_\+\+T\+C\+P\+\_\+connection@{kill\+\_\+\+T\+C\+P\+\_\+connection}}
\index{kill\+\_\+\+T\+C\+P\+\_\+connection@{kill\+\_\+\+T\+C\+P\+\_\+connection}!T\+C\+P\+\_\+client.\+c@{T\+C\+P\+\_\+client.\+c}}
\subsubsection[{kill\+\_\+\+T\+C\+P\+\_\+connection}]{\setlength{\rightskip}{0pt plus 5cm}void kill\+\_\+\+T\+C\+P\+\_\+connection (
\begin{DoxyParamCaption}
\item[{{\bf T\+C\+P\+\_\+\+Client\+\_\+\+Connection} $\ast$}]{T\+C\+P\+\_\+connection}
\end{DoxyParamCaption}
)}}\label{_t_c_p__client_8c_a437ba55ccf24fb881acf298f3e225a63}


Definition at line 958 of file T\+C\+P\+\_\+client.\+c.



References kill\+\_\+sock(), T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::sock, and wipe\+\_\+priority\+\_\+list().



Referenced by kill\+\_\+tcp\+\_\+connections(), kill\+\_\+tcp\+\_\+relay\+\_\+connection(), reconnect\+\_\+tcp\+\_\+relay\+\_\+connection(), sleep\+\_\+tcp\+\_\+relay\+\_\+connection(), and S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T().


\begin{DoxyCode}
959 \{
960     \textcolor{keywordflow}{if} (TCP\_connection == NULL)
961         \textcolor{keywordflow}{return};
962 
963     \hyperlink{_t_c_p__client_8c_aaf4385f749c6f9c21f4f4ac17b31a77b}{wipe\_priority\_list}(TCP\_connection);
964     \hyperlink{network_8c_a512d8ea12392ba9ddfadd83bb7c92b2e}{kill\_sock}(TCP\_connection->\hyperlink{struct_t_c_p___client___connection_a35b19d84fb632ca8ce5cab237f7089a5}{sock});
965     memset(TCP\_connection, 0, \textcolor{keyword}{sizeof}(\hyperlink{struct_t_c_p___client___connection}{TCP\_Client\_Connection}));
966     free(TCP\_connection);
967 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=312pt]{da/da1/_t_c_p__client_8c_a437ba55ccf24fb881acf298f3e225a63_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{da/da1/_t_c_p__client_8c_a437ba55ccf24fb881acf298f3e225a63_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__client_8c_aedb0d5c54ac7754bb342517247ac632d}{\index{T\+C\+P\+\_\+client.\+c@{T\+C\+P\+\_\+client.\+c}!new\+\_\+\+T\+C\+P\+\_\+connection@{new\+\_\+\+T\+C\+P\+\_\+connection}}
\index{new\+\_\+\+T\+C\+P\+\_\+connection@{new\+\_\+\+T\+C\+P\+\_\+connection}!T\+C\+P\+\_\+client.\+c@{T\+C\+P\+\_\+client.\+c}}
\subsubsection[{new\+\_\+\+T\+C\+P\+\_\+connection}]{\setlength{\rightskip}{0pt plus 5cm}{\bf T\+C\+P\+\_\+\+Client\+\_\+\+Connection}$\ast$ new\+\_\+\+T\+C\+P\+\_\+connection (
\begin{DoxyParamCaption}
\item[{{\bf I\+P\+\_\+\+Port}}]{ip\+\_\+port, }
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key, }
\item[{const uint8\+\_\+t $\ast$}]{self\+\_\+public\+\_\+key, }
\item[{const uint8\+\_\+t $\ast$}]{self\+\_\+secret\+\_\+key, }
\item[{{\bf T\+C\+P\+\_\+\+Proxy\+\_\+\+Info} $\ast$}]{proxy\+\_\+info}
\end{DoxyParamCaption}
)}}\label{_t_c_p__client_8c_aedb0d5c54ac7754bb342517247ac632d}


Definition at line 611 of file T\+C\+P\+\_\+client.\+c.



References connect\+\_\+sock\+\_\+to(), encrypt\+\_\+precompute(), I\+P\+::family, generate\+\_\+handshake(), I\+P\+\_\+\+Port\+::ip, T\+C\+P\+\_\+\+Proxy\+\_\+\+Info\+::ip\+\_\+port, T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::ip\+\_\+port, T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::kill\+\_\+at, kill\+\_\+sock(), networking\+\_\+at\+\_\+startup(), proxy\+\_\+http\+\_\+generate\+\_\+connection\+\_\+request(), T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::proxy\+\_\+info, proxy\+\_\+socks5\+\_\+generate\+\_\+handshake(), T\+C\+P\+\_\+\+Proxy\+\_\+\+Info\+::proxy\+\_\+type, T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::public\+\_\+key, T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::self\+\_\+public\+\_\+key, set\+\_\+socket\+\_\+nonblock(), set\+\_\+socket\+\_\+nosigpipe(), T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::shared\+\_\+key, sock, T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::sock, sock\+\_\+valid(), T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::status, T\+C\+P\+\_\+\+C\+L\+I\+E\+N\+T\+\_\+\+C\+O\+N\+N\+E\+C\+T\+I\+N\+G, T\+C\+P\+\_\+\+C\+L\+I\+E\+N\+T\+\_\+\+P\+R\+O\+X\+Y\+\_\+\+H\+T\+T\+P\+\_\+\+C\+O\+N\+N\+E\+C\+T\+I\+N\+G, T\+C\+P\+\_\+\+C\+L\+I\+E\+N\+T\+\_\+\+P\+R\+O\+X\+Y\+\_\+\+S\+O\+C\+K\+S5\+\_\+\+C\+O\+N\+N\+E\+C\+T\+I\+N\+G, T\+C\+P\+\_\+\+C\+O\+N\+N\+E\+C\+T\+I\+O\+N\+\_\+\+T\+I\+M\+E\+O\+U\+T, T\+C\+P\+\_\+\+P\+R\+O\+X\+Y\+\_\+\+H\+T\+T\+P, T\+C\+P\+\_\+\+P\+R\+O\+X\+Y\+\_\+\+N\+O\+N\+E, T\+C\+P\+\_\+\+P\+R\+O\+X\+Y\+\_\+\+S\+O\+C\+K\+S5, and unix\+\_\+time().



Referenced by add\+\_\+tcp\+\_\+relay\+\_\+instance(), reconnect\+\_\+tcp\+\_\+relay\+\_\+connection(), S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T(), and unsleep\+\_\+tcp\+\_\+relay\+\_\+connection().


\begin{DoxyCode}
613 \{
614     \textcolor{keywordflow}{if} (\hyperlink{network_8c_ad953dedd6d25d03cf441960dd1e1fed1}{networking\_at\_startup}() != 0) \{
615         \textcolor{keywordflow}{return} NULL;
616     \}
617 
618     \textcolor{keywordflow}{if} (ip\_port.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} != AF\_INET && ip\_port.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} != AF\_INET6)
619         \textcolor{keywordflow}{return} NULL;
620 
621     uint8\_t family = ip\_port.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family};
622 
623     \hyperlink{struct_t_c_p___proxy___info}{TCP\_Proxy\_Info} default\_proxyinfo;
624 
625     \textcolor{keywordflow}{if} (proxy\_info == NULL) \{
626         default\_proxyinfo.\hyperlink{struct_t_c_p___proxy___info_a23a098bd0536ae2000e1944e353b7d8b}{proxy\_type} = \hyperlink{_t_c_p__client_8h_ae3f1e841d616cab3ff982b5560aa215fa03246331c1cd872e9461ec9cd79f1f7c}{TCP\_PROXY\_NONE};
627         proxy\_info = &default\_proxyinfo;
628     \}
629 
630     \textcolor{keywordflow}{if} (proxy\_info->\hyperlink{struct_t_c_p___proxy___info_a23a098bd0536ae2000e1944e353b7d8b}{proxy\_type} != \hyperlink{_t_c_p__client_8h_ae3f1e841d616cab3ff982b5560aa215fa03246331c1cd872e9461ec9cd79f1f7c}{TCP\_PROXY\_NONE}) \{
631         family = proxy\_info->\hyperlink{struct_t_c_p___proxy___info_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family};
632     \}
633 
634     \hyperlink{network_8h_ae5faf8a8d23da59c3e3025a62039d8c1}{sock\_t} \hyperlink{irc__syncbot_8c_a5903d0b282fc5eae503de618f896b5e1}{sock} = \hyperlink{namespacesocket}{socket}(family, SOCK\_STREAM, IPPROTO\_TCP);
635 
636     \textcolor{keywordflow}{if} (!\hyperlink{network_8c_a84c3240a3325cbdaaa8a206c96980cd1}{sock\_valid}(sock)) \{
637         \textcolor{keywordflow}{return} NULL;
638     \}
639 
640     \textcolor{keywordflow}{if} (!\hyperlink{network_8c_a379153c027c17d7c71797cb0e3ea41a3}{set\_socket\_nosigpipe}(sock)) \{
641         \hyperlink{network_8c_a512d8ea12392ba9ddfadd83bb7c92b2e}{kill\_sock}(sock);
642         \textcolor{keywordflow}{return} 0;
643     \}
644 
645     \textcolor{keywordflow}{if} (!(\hyperlink{network_8c_a6a50bb1345f2d5192fe1ec23ac7a1da9}{set\_socket\_nonblock}(sock) && \hyperlink{_t_c_p__client_8c_a60b303142f843cad13249065ddeefb17}{connect\_sock\_to}(sock, ip\_port, 
      proxy\_info))) \{
646         \hyperlink{network_8c_a512d8ea12392ba9ddfadd83bb7c92b2e}{kill\_sock}(sock);
647         \textcolor{keywordflow}{return} NULL;
648     \}
649 
650     \hyperlink{struct_t_c_p___client___connection}{TCP\_Client\_Connection} *temp = calloc(\textcolor{keyword}{sizeof}(
      \hyperlink{struct_t_c_p___client___connection}{TCP\_Client\_Connection}), 1);
651 
652     \textcolor{keywordflow}{if} (temp == NULL) \{
653         \hyperlink{network_8c_a512d8ea12392ba9ddfadd83bb7c92b2e}{kill\_sock}(sock);
654         \textcolor{keywordflow}{return} NULL;
655     \}
656 
657     temp->\hyperlink{struct_t_c_p___client___connection_a35b19d84fb632ca8ce5cab237f7089a5}{sock} = \hyperlink{irc__syncbot_8c_a5903d0b282fc5eae503de618f896b5e1}{sock};
658     memcpy(temp->\hyperlink{struct_t_c_p___client___connection_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, crypto\_box\_PUBLICKEYBYTES);
659     memcpy(temp->\hyperlink{struct_t_c_p___client___connection_ae726df8bdc26380e5a6c3187a00d6881}{self\_public\_key}, self\_public\_key, crypto\_box\_PUBLICKEYBYTES);
660     \hyperlink{crypto__core_8c_a0d8eaef49981c5dc3ada078866b42f6d}{encrypt\_precompute}(temp->\hyperlink{struct_t_c_p___client___connection_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, self\_secret\_key, temp->
      \hyperlink{struct_t_c_p___client___connection_a81ead9fac55a0cedc30a96253a2c5119}{shared\_key});
661     temp->\hyperlink{struct_t_c_p___client___connection_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port} = ip\_port;
662     temp->\hyperlink{struct_t_c_p___client___connection_aa737023350cf47e63993e3b4dc9a7472}{proxy\_info} = *proxy\_info;
663 
664     \textcolor{keywordflow}{switch} (proxy\_info->\hyperlink{struct_t_c_p___proxy___info_a23a098bd0536ae2000e1944e353b7d8b}{proxy\_type}) \{
665         \textcolor{keywordflow}{case} \hyperlink{_t_c_p__client_8h_ae3f1e841d616cab3ff982b5560aa215fa1363fcd35acf73fb657e6ad4276a390a}{TCP\_PROXY\_HTTP}:
666             temp->\hyperlink{struct_t_c_p___client___connection_ade818037fd6c985038ff29656089758d}{status} = \hyperlink{_t_c_p__client_8h_ae4d5251432e1a9e6803c0240cc492e18acbb2a0d8636aaaf83994cc2fee5cc12a}{TCP\_CLIENT\_PROXY\_HTTP\_CONNECTING};
667             \hyperlink{_t_c_p__client_8c_a3000ce77c7c25ee8a08da815cbd0c7cb}{proxy\_http\_generate\_connection\_request}(temp);
668             \textcolor{keywordflow}{break};
669 
670         \textcolor{keywordflow}{case} \hyperlink{_t_c_p__client_8h_ae3f1e841d616cab3ff982b5560aa215fa6b5dc5d756064d1b8619a5b18d0a9c2d}{TCP\_PROXY\_SOCKS5}:
671             temp->\hyperlink{struct_t_c_p___client___connection_ade818037fd6c985038ff29656089758d}{status} = \hyperlink{_t_c_p__client_8h_ae4d5251432e1a9e6803c0240cc492e18acdc6053e3ea63e538d6515ff9a4b02ce}{TCP\_CLIENT\_PROXY\_SOCKS5\_CONNECTING};
672             \hyperlink{_t_c_p__client_8c_a76c75a8969ec140e5799744179ba8048}{proxy\_socks5\_generate\_handshake}(temp);
673             \textcolor{keywordflow}{break};
674 
675         \textcolor{keywordflow}{case} \hyperlink{_t_c_p__client_8h_ae3f1e841d616cab3ff982b5560aa215fa03246331c1cd872e9461ec9cd79f1f7c}{TCP\_PROXY\_NONE}:
676             temp->\hyperlink{struct_t_c_p___client___connection_ade818037fd6c985038ff29656089758d}{status} = \hyperlink{_t_c_p__client_8h_ae4d5251432e1a9e6803c0240cc492e18a9430d92af78e28f5ac054a303886c124}{TCP\_CLIENT\_CONNECTING};
677 
678             \textcolor{keywordflow}{if} (\hyperlink{_t_c_p__client_8c_aec632a758fda6b73153ec16180750366}{generate\_handshake}(temp) == -1) \{
679                 \hyperlink{network_8c_a512d8ea12392ba9ddfadd83bb7c92b2e}{kill\_sock}(sock);
680                 free(temp);
681                 \textcolor{keywordflow}{return} NULL;
682             \}
683 
684             \textcolor{keywordflow}{break};
685     \}
686 
687     temp->\hyperlink{struct_t_c_p___client___connection_a2da98b8c0615e4e5fe47dd5f3bdebfab}{kill\_at} = \hyperlink{util_8c_ac958d9f8847cb8039444bfa3d304233a}{unix\_time}() + \hyperlink{_t_c_p__client_8h_a635ecd17e7464eb39a48fbab171ddeb6}{TCP\_CONNECTION\_TIMEOUT};
688 
689     \textcolor{keywordflow}{return} temp;
690 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{da/da1/_t_c_p__client_8c_aedb0d5c54ac7754bb342517247ac632d_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{da/da1/_t_c_p__client_8c_aedb0d5c54ac7754bb342517247ac632d_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__client_8c_ac71909171dbe8b0bdd4b349a9995634f}{\index{T\+C\+P\+\_\+client.\+c@{T\+C\+P\+\_\+client.\+c}!onion\+\_\+response\+\_\+handler@{onion\+\_\+response\+\_\+handler}}
\index{onion\+\_\+response\+\_\+handler@{onion\+\_\+response\+\_\+handler}!T\+C\+P\+\_\+client.\+c@{T\+C\+P\+\_\+client.\+c}}
\subsubsection[{onion\+\_\+response\+\_\+handler}]{\setlength{\rightskip}{0pt plus 5cm}void onion\+\_\+response\+\_\+handler (
\begin{DoxyParamCaption}
\item[{{\bf T\+C\+P\+\_\+\+Client\+\_\+\+Connection} $\ast$}]{con, }
\item[{int($\ast$)(void $\ast$object, const uint8\+\_\+t $\ast$data, uint16\+\_\+t length)}]{onion\+\_\+callback, }
\item[{void $\ast$}]{object}
\end{DoxyParamCaption}
)}}\label{_t_c_p__client_8c_ac71909171dbe8b0bdd4b349a9995634f}


Definition at line 602 of file T\+C\+P\+\_\+client.\+c.



References T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::onion\+\_\+callback, and T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::onion\+\_\+callback\+\_\+object.



Referenced by tcp\+\_\+relay\+\_\+set\+\_\+callbacks().


\begin{DoxyCode}
604 \{
605     con->\hyperlink{struct_t_c_p___client___connection_ab6dd4883cc217ef4c036cb404f036a47}{onion\_callback} = onion\_callback;
606     con->\hyperlink{struct_t_c_p___client___connection_a975f7347f9eee77bcd1eb36b5e913021}{onion\_callback\_object} = object;
607 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{da/da1/_t_c_p__client_8c_ac71909171dbe8b0bdd4b349a9995634f_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__client_8c_a34d78d05e93ac72b24092da391b05aa8}{\index{T\+C\+P\+\_\+client.\+c@{T\+C\+P\+\_\+client.\+c}!oob\+\_\+data\+\_\+handler@{oob\+\_\+data\+\_\+handler}}
\index{oob\+\_\+data\+\_\+handler@{oob\+\_\+data\+\_\+handler}!T\+C\+P\+\_\+client.\+c@{T\+C\+P\+\_\+client.\+c}}
\subsubsection[{oob\+\_\+data\+\_\+handler}]{\setlength{\rightskip}{0pt plus 5cm}void oob\+\_\+data\+\_\+handler (
\begin{DoxyParamCaption}
\item[{{\bf T\+C\+P\+\_\+\+Client\+\_\+\+Connection} $\ast$}]{con, }
\item[{int($\ast$)(void $\ast$object, const uint8\+\_\+t $\ast$public\+\_\+key, const uint8\+\_\+t $\ast$data, uint16\+\_\+t length)}]{oob\+\_\+data\+\_\+callback, }
\item[{void $\ast$}]{object}
\end{DoxyParamCaption}
)}}\label{_t_c_p__client_8c_a34d78d05e93ac72b24092da391b05aa8}


Definition at line 515 of file T\+C\+P\+\_\+client.\+c.



References T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::oob\+\_\+data\+\_\+callback, oob\+\_\+data\+\_\+callback(), and T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::oob\+\_\+data\+\_\+callback\+\_\+object.



Referenced by S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T(), and tcp\+\_\+relay\+\_\+set\+\_\+callbacks().


\begin{DoxyCode}
517 \{
518     con->\hyperlink{struct_t_c_p___client___connection_a3f8394ec4439b5730e80f10d6951b845}{oob\_data\_callback} = \hyperlink{_t_c_p__test_8c_a7a0dc2152e401dc318c450f172b3c124}{oob\_data\_callback};
519     con->\hyperlink{struct_t_c_p___client___connection_a3bd56ba2917797a0eea802a7192ef031}{oob\_data\_callback\_object} = object;
520 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=307pt]{da/da1/_t_c_p__client_8c_a34d78d05e93ac72b24092da391b05aa8_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{da/da1/_t_c_p__client_8c_a34d78d05e93ac72b24092da391b05aa8_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__client_8c_a3000ce77c7c25ee8a08da815cbd0c7cb}{\index{T\+C\+P\+\_\+client.\+c@{T\+C\+P\+\_\+client.\+c}!proxy\+\_\+http\+\_\+generate\+\_\+connection\+\_\+request@{proxy\+\_\+http\+\_\+generate\+\_\+connection\+\_\+request}}
\index{proxy\+\_\+http\+\_\+generate\+\_\+connection\+\_\+request@{proxy\+\_\+http\+\_\+generate\+\_\+connection\+\_\+request}!T\+C\+P\+\_\+client.\+c@{T\+C\+P\+\_\+client.\+c}}
\subsubsection[{proxy\+\_\+http\+\_\+generate\+\_\+connection\+\_\+request}]{\setlength{\rightskip}{0pt plus 5cm}static int proxy\+\_\+http\+\_\+generate\+\_\+connection\+\_\+request (
\begin{DoxyParamCaption}
\item[{{\bf T\+C\+P\+\_\+\+Client\+\_\+\+Connection} $\ast$}]{T\+C\+P\+\_\+conn}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_t_c_p__client_8c_a3000ce77c7c25ee8a08da815cbd0c7cb}


Definition at line 74 of file T\+C\+P\+\_\+client.\+c.



References ip, I\+P\+\_\+\+Port\+::ip, ip\+\_\+parse\+\_\+addr(), T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::ip\+\_\+port, T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::last\+\_\+packet, T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::last\+\_\+packet\+\_\+length, T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::last\+\_\+packet\+\_\+sent, M\+A\+X\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+S\+I\+Z\+E, port, and I\+P\+\_\+\+Port\+::port.



Referenced by new\+\_\+\+T\+C\+P\+\_\+connection().


\begin{DoxyCode}
75 \{
76     \textcolor{keywordtype}{char} one[] = \textcolor{stringliteral}{"CONNECT "};
77     \textcolor{keywordtype}{char} two[] = \textcolor{stringliteral}{" HTTP/1.1\(\backslash\)nHost: "};
78     \textcolor{keywordtype}{char} three[] = \textcolor{stringliteral}{"\(\backslash\)r\(\backslash\)n\(\backslash\)r\(\backslash\)n"};
79 
80     \textcolor{keywordtype}{char} \hyperlink{irc__syncbot_8c_ae81515e082f9bc33e8968181945586da}{ip}[INET6\_ADDRSTRLEN];
81 
82     \textcolor{keywordflow}{if} (!\hyperlink{network_8c_ae25cce1bbb77b6a8b441bb940a75783f}{ip\_parse\_addr}(&TCP\_conn->\hyperlink{struct_t_c_p___client___connection_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}, ip, \textcolor{keyword}{sizeof}(ip))) \{
83         \textcolor{keywordflow}{return} 0;
84     \}
85 
86     \textcolor{keyword}{const} uint16\_t \hyperlink{irc__syncbot_8c_a8e0798404bf2cf5dabb84c5ba9a4f236}{port} = ntohs(TCP\_conn->\hyperlink{struct_t_c_p___client___connection_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}.\hyperlink{struct_i_p___port_a8e0798404bf2cf5dabb84c5ba9a4f236}{port});
87     \textcolor{keyword}{const} \textcolor{keywordtype}{int} written = snprintf((\textcolor{keywordtype}{char} *)TCP\_conn->\hyperlink{struct_t_c_p___client___connection_af7b6d103d243e4267b112f6efe1573e2}{last\_packet}, 
      \hyperlink{_t_c_p__server_8h_a879456c3b8e2853f7044d764e9c180d4}{MAX\_PACKET\_SIZE}, \textcolor{stringliteral}{"%s%s:%hu%s%s:%hu%s"}, one, ip, port, two,
88                                  ip, port, three);
89 
90     \textcolor{keywordflow}{if} (written < 0 || \hyperlink{_t_c_p__server_8h_a879456c3b8e2853f7044d764e9c180d4}{MAX\_PACKET\_SIZE} < written) \{
91         \textcolor{keywordflow}{return} 0;
92     \}
93 
94     TCP\_conn->\hyperlink{struct_t_c_p___client___connection_a78d503fe4c8d935701480b58a0461775}{last\_packet\_length} = written;
95     TCP\_conn->\hyperlink{struct_t_c_p___client___connection_a80b55fa7d5b8e4c3de6b51c99d7670cc}{last\_packet\_sent} = 0;
96 
97     \textcolor{keywordflow}{return} 1;
98 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=300pt]{da/da1/_t_c_p__client_8c_a3000ce77c7c25ee8a08da815cbd0c7cb_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{da/da1/_t_c_p__client_8c_a3000ce77c7c25ee8a08da815cbd0c7cb_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__client_8c_a39080f686c09274aa55d7b352fcadd56}{\index{T\+C\+P\+\_\+client.\+c@{T\+C\+P\+\_\+client.\+c}!proxy\+\_\+http\+\_\+read\+\_\+connection\+\_\+response@{proxy\+\_\+http\+\_\+read\+\_\+connection\+\_\+response}}
\index{proxy\+\_\+http\+\_\+read\+\_\+connection\+\_\+response@{proxy\+\_\+http\+\_\+read\+\_\+connection\+\_\+response}!T\+C\+P\+\_\+client.\+c@{T\+C\+P\+\_\+client.\+c}}
\subsubsection[{proxy\+\_\+http\+\_\+read\+\_\+connection\+\_\+response}]{\setlength{\rightskip}{0pt plus 5cm}static int proxy\+\_\+http\+\_\+read\+\_\+connection\+\_\+response (
\begin{DoxyParamCaption}
\item[{{\bf T\+C\+P\+\_\+\+Client\+\_\+\+Connection} $\ast$}]{T\+C\+P\+\_\+conn}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_t_c_p__client_8c_a39080f686c09274aa55d7b352fcadd56}


Definition at line 104 of file T\+C\+P\+\_\+client.\+c.



References make-\/funny-\/savefile\+::data, read\+\_\+\+T\+C\+P\+\_\+packet(), T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::sock, and T\+C\+P\+\_\+socket\+\_\+data\+\_\+recv\+\_\+buffer().



Referenced by do\+\_\+\+T\+C\+P\+\_\+connection().


\begin{DoxyCode}
105 \{
106     \textcolor{keywordtype}{char} success[] = \textcolor{stringliteral}{"200"};
107     uint8\_t \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[16]; \textcolor{comment}{// draining works the best if the length is a power of 2}
108 
109     \textcolor{keywordtype}{int} ret = \hyperlink{_t_c_p__server_8c_a88eda37b476d8dcfdba94899e740dd9e}{read\_TCP\_packet}(TCP\_conn->\hyperlink{struct_t_c_p___client___connection_a35b19d84fb632ca8ce5cab237f7089a5}{sock}, data, \textcolor{keyword}{sizeof}(data) - 1);
110 
111     \textcolor{keywordflow}{if} (ret == -1) \{
112         \textcolor{keywordflow}{return} 0;
113     \}
114 
115     data[\textcolor{keyword}{sizeof}(\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}) - 1] = 0;
116 
117     \textcolor{keywordflow}{if} (strstr((\textcolor{keywordtype}{char} *)data, success)) \{
118         \textcolor{comment}{// drain all data}
119         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} data\_left = \hyperlink{_t_c_p__server_8c_ae80fe7119d00d2a7788c0839a90e0782}{TCP\_socket\_data\_recv\_buffer}(TCP\_conn->
      \hyperlink{struct_t_c_p___client___connection_a35b19d84fb632ca8ce5cab237f7089a5}{sock});
120 
121         \textcolor{keywordflow}{if} (data\_left) \{
122             uint8\_t temp\_data[data\_left];
123             \hyperlink{_t_c_p__server_8c_a88eda37b476d8dcfdba94899e740dd9e}{read\_TCP\_packet}(TCP\_conn->\hyperlink{struct_t_c_p___client___connection_a35b19d84fb632ca8ce5cab237f7089a5}{sock}, temp\_data, data\_left);
124         \}
125 
126         \textcolor{keywordflow}{return} 1;
127     \}
128 
129     \textcolor{keywordflow}{return} -1;
130 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{da/da1/_t_c_p__client_8c_a39080f686c09274aa55d7b352fcadd56_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{da/da1/_t_c_p__client_8c_a39080f686c09274aa55d7b352fcadd56_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__client_8c_a07b625ae786316d0942152868af0226b}{\index{T\+C\+P\+\_\+client.\+c@{T\+C\+P\+\_\+client.\+c}!proxy\+\_\+socks5\+\_\+generate\+\_\+connection\+\_\+request@{proxy\+\_\+socks5\+\_\+generate\+\_\+connection\+\_\+request}}
\index{proxy\+\_\+socks5\+\_\+generate\+\_\+connection\+\_\+request@{proxy\+\_\+socks5\+\_\+generate\+\_\+connection\+\_\+request}!T\+C\+P\+\_\+client.\+c@{T\+C\+P\+\_\+client.\+c}}
\subsubsection[{proxy\+\_\+socks5\+\_\+generate\+\_\+connection\+\_\+request}]{\setlength{\rightskip}{0pt plus 5cm}static void proxy\+\_\+socks5\+\_\+generate\+\_\+connection\+\_\+request (
\begin{DoxyParamCaption}
\item[{{\bf T\+C\+P\+\_\+\+Client\+\_\+\+Connection} $\ast$}]{T\+C\+P\+\_\+conn}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_t_c_p__client_8c_a07b625ae786316d0942152868af0226b}


Definition at line 160 of file T\+C\+P\+\_\+client.\+c.



References I\+P\+::family, I\+P\+\_\+\+Port\+::ip, I\+P\+::ip4, I\+P\+::ip6, T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::ip\+\_\+port, T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::last\+\_\+packet, T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::last\+\_\+packet\+\_\+length, T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::last\+\_\+packet\+\_\+sent, I\+P\+\_\+\+Port\+::port, I\+P4\+::uint8, and I\+P6\+::uint8.



Referenced by do\+\_\+\+T\+C\+P\+\_\+connection().


\begin{DoxyCode}
161 \{
162     TCP\_conn->\hyperlink{struct_t_c_p___client___connection_af7b6d103d243e4267b112f6efe1573e2}{last\_packet}[0] = 5; \textcolor{comment}{/* SOCKSv5 */}
163     TCP\_conn->\hyperlink{struct_t_c_p___client___connection_af7b6d103d243e4267b112f6efe1573e2}{last\_packet}[1] = 1; \textcolor{comment}{/* command code: establish a TCP/IP stream connection */}
164     TCP\_conn->\hyperlink{struct_t_c_p___client___connection_af7b6d103d243e4267b112f6efe1573e2}{last\_packet}[2] = 0; \textcolor{comment}{/* reserved, must be 0 */}
165     uint16\_t length = 3;
166 
167     \textcolor{keywordflow}{if} (TCP\_conn->\hyperlink{struct_t_c_p___client___connection_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} == AF\_INET) \{
168         TCP\_conn->\hyperlink{struct_t_c_p___client___connection_af7b6d103d243e4267b112f6efe1573e2}{last\_packet}[3] = 1; \textcolor{comment}{/* IPv4 address */}
169         ++length;
170         memcpy(TCP\_conn->\hyperlink{struct_t_c_p___client___connection_af7b6d103d243e4267b112f6efe1573e2}{last\_packet} + length, TCP\_conn->\hyperlink{struct_t_c_p___client___connection_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}.
      \hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_aca19646000f55aa927406e68fc41ecf9}{ip4}.\hyperlink{union_i_p4_a73b9a57544f1edd6e2187aca636c75ef}{uint8}, \textcolor{keyword}{sizeof}(\hyperlink{union_i_p4}{IP4}));
171         length += \textcolor{keyword}{sizeof}(\hyperlink{union_i_p4}{IP4});
172     \} \textcolor{keywordflow}{else} \{
173         TCP\_conn->\hyperlink{struct_t_c_p___client___connection_af7b6d103d243e4267b112f6efe1573e2}{last\_packet}[3] = 4; \textcolor{comment}{/* IPv6 address */}
174         ++length;
175         memcpy(TCP\_conn->\hyperlink{struct_t_c_p___client___connection_af7b6d103d243e4267b112f6efe1573e2}{last\_packet} + length, TCP\_conn->\hyperlink{struct_t_c_p___client___connection_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}.
      \hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_a14c606eb5ffb078c38ad854dc4e79507}{ip6}.\hyperlink{union_i_p6_a6b067d428eefbf1754aa09429b1ba524}{uint8}, \textcolor{keyword}{sizeof}(\hyperlink{union_i_p6}{IP6}));
176         length += \textcolor{keyword}{sizeof}(\hyperlink{union_i_p6}{IP6});
177     \}
178 
179     memcpy(TCP\_conn->\hyperlink{struct_t_c_p___client___connection_af7b6d103d243e4267b112f6efe1573e2}{last\_packet} + length, &TCP\_conn->\hyperlink{struct_t_c_p___client___connection_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}.
      \hyperlink{struct_i_p___port_a8e0798404bf2cf5dabb84c5ba9a4f236}{port}, \textcolor{keyword}{sizeof}(uint16\_t));
180     length += \textcolor{keyword}{sizeof}(uint16\_t);
181 
182     TCP\_conn->\hyperlink{struct_t_c_p___client___connection_a78d503fe4c8d935701480b58a0461775}{last\_packet\_length} = length;
183     TCP\_conn->\hyperlink{struct_t_c_p___client___connection_a80b55fa7d5b8e4c3de6b51c99d7670cc}{last\_packet\_sent} = 0;
184 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{da/da1/_t_c_p__client_8c_a07b625ae786316d0942152868af0226b_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__client_8c_a76c75a8969ec140e5799744179ba8048}{\index{T\+C\+P\+\_\+client.\+c@{T\+C\+P\+\_\+client.\+c}!proxy\+\_\+socks5\+\_\+generate\+\_\+handshake@{proxy\+\_\+socks5\+\_\+generate\+\_\+handshake}}
\index{proxy\+\_\+socks5\+\_\+generate\+\_\+handshake@{proxy\+\_\+socks5\+\_\+generate\+\_\+handshake}!T\+C\+P\+\_\+client.\+c@{T\+C\+P\+\_\+client.\+c}}
\subsubsection[{proxy\+\_\+socks5\+\_\+generate\+\_\+handshake}]{\setlength{\rightskip}{0pt plus 5cm}static void proxy\+\_\+socks5\+\_\+generate\+\_\+handshake (
\begin{DoxyParamCaption}
\item[{{\bf T\+C\+P\+\_\+\+Client\+\_\+\+Connection} $\ast$}]{T\+C\+P\+\_\+conn}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_t_c_p__client_8c_a76c75a8969ec140e5799744179ba8048}


Definition at line 132 of file T\+C\+P\+\_\+client.\+c.



References T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::last\+\_\+packet, T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::last\+\_\+packet\+\_\+length, and T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::last\+\_\+packet\+\_\+sent.



Referenced by new\+\_\+\+T\+C\+P\+\_\+connection().


\begin{DoxyCode}
133 \{
134     TCP\_conn->\hyperlink{struct_t_c_p___client___connection_af7b6d103d243e4267b112f6efe1573e2}{last\_packet}[0] = 5; \textcolor{comment}{/* SOCKSv5 */}
135     TCP\_conn->\hyperlink{struct_t_c_p___client___connection_af7b6d103d243e4267b112f6efe1573e2}{last\_packet}[1] = 1; \textcolor{comment}{/* number of authentication methods supported */}
136     TCP\_conn->\hyperlink{struct_t_c_p___client___connection_af7b6d103d243e4267b112f6efe1573e2}{last\_packet}[2] = 0; \textcolor{comment}{/* No authentication */}
137 
138     TCP\_conn->\hyperlink{struct_t_c_p___client___connection_a78d503fe4c8d935701480b58a0461775}{last\_packet\_length} = 3;
139     TCP\_conn->\hyperlink{struct_t_c_p___client___connection_a80b55fa7d5b8e4c3de6b51c99d7670cc}{last\_packet\_sent} = 0;
140 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{da/da1/_t_c_p__client_8c_a76c75a8969ec140e5799744179ba8048_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__client_8c_a258117084993caf09bd2d1c04425d7f0}{\index{T\+C\+P\+\_\+client.\+c@{T\+C\+P\+\_\+client.\+c}!proxy\+\_\+socks5\+\_\+read\+\_\+connection\+\_\+response@{proxy\+\_\+socks5\+\_\+read\+\_\+connection\+\_\+response}}
\index{proxy\+\_\+socks5\+\_\+read\+\_\+connection\+\_\+response@{proxy\+\_\+socks5\+\_\+read\+\_\+connection\+\_\+response}!T\+C\+P\+\_\+client.\+c@{T\+C\+P\+\_\+client.\+c}}
\subsubsection[{proxy\+\_\+socks5\+\_\+read\+\_\+connection\+\_\+response}]{\setlength{\rightskip}{0pt plus 5cm}static int proxy\+\_\+socks5\+\_\+read\+\_\+connection\+\_\+response (
\begin{DoxyParamCaption}
\item[{{\bf T\+C\+P\+\_\+\+Client\+\_\+\+Connection} $\ast$}]{T\+C\+P\+\_\+conn}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_t_c_p__client_8c_a258117084993caf09bd2d1c04425d7f0}


Definition at line 190 of file T\+C\+P\+\_\+client.\+c.



References make-\/funny-\/savefile\+::data, I\+P\+::family, I\+P\+\_\+\+Port\+::ip, T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::ip\+\_\+port, read\+\_\+\+T\+C\+P\+\_\+packet(), and T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::sock.



Referenced by do\+\_\+\+T\+C\+P\+\_\+connection().


\begin{DoxyCode}
191 \{
192     \textcolor{keywordflow}{if} (TCP\_conn->\hyperlink{struct_t_c_p___client___connection_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} == AF\_INET) \{
193         uint8\_t \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[4 + \textcolor{keyword}{sizeof}(\hyperlink{union_i_p4}{IP4}) + \textcolor{keyword}{sizeof}(uint16\_t)];
194         \textcolor{keywordtype}{int} ret = \hyperlink{_t_c_p__server_8c_a88eda37b476d8dcfdba94899e740dd9e}{read\_TCP\_packet}(TCP\_conn->\hyperlink{struct_t_c_p___client___connection_a35b19d84fb632ca8ce5cab237f7089a5}{sock}, data, \textcolor{keyword}{sizeof}(data));
195 
196         \textcolor{keywordflow}{if} (ret == -1)
197             \textcolor{keywordflow}{return} 0;
198 
199         \textcolor{keywordflow}{if} (data[0] == 5 && data[1] == 0)
200             \textcolor{keywordflow}{return} 1;
201 
202     \} \textcolor{keywordflow}{else} \{
203         uint8\_t data[4 + \textcolor{keyword}{sizeof}(\hyperlink{union_i_p6}{IP6}) + \textcolor{keyword}{sizeof}(uint16\_t)];
204         \textcolor{keywordtype}{int} ret = \hyperlink{_t_c_p__server_8c_a88eda37b476d8dcfdba94899e740dd9e}{read\_TCP\_packet}(TCP\_conn->\hyperlink{struct_t_c_p___client___connection_a35b19d84fb632ca8ce5cab237f7089a5}{sock}, data, \textcolor{keyword}{sizeof}(data));
205 
206         \textcolor{keywordflow}{if} (ret == -1)
207             \textcolor{keywordflow}{return} 0;
208 
209         \textcolor{keywordflow}{if} (data[0] == 5 && data[1] == 0)
210             \textcolor{keywordflow}{return} 1;
211     \}
212 
213     \textcolor{keywordflow}{return} -1;
214 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{da/da1/_t_c_p__client_8c_a258117084993caf09bd2d1c04425d7f0_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{da/da1/_t_c_p__client_8c_a258117084993caf09bd2d1c04425d7f0_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__client_8c_ab913946e478e2ead06cb9eccb7b7249b}{\index{T\+C\+P\+\_\+client.\+c@{T\+C\+P\+\_\+client.\+c}!routing\+\_\+data\+\_\+handler@{routing\+\_\+data\+\_\+handler}}
\index{routing\+\_\+data\+\_\+handler@{routing\+\_\+data\+\_\+handler}!T\+C\+P\+\_\+client.\+c@{T\+C\+P\+\_\+client.\+c}}
\subsubsection[{routing\+\_\+data\+\_\+handler}]{\setlength{\rightskip}{0pt plus 5cm}void routing\+\_\+data\+\_\+handler (
\begin{DoxyParamCaption}
\item[{{\bf T\+C\+P\+\_\+\+Client\+\_\+\+Connection} $\ast$}]{con, }
\item[{int($\ast$)(void $\ast$object, uint32\+\_\+t number, uint8\+\_\+t connection\+\_\+id, const uint8\+\_\+t $\ast$data, uint16\+\_\+t length)}]{data\+\_\+callback, }
\item[{void $\ast$}]{object}
\end{DoxyParamCaption}
)}}\label{_t_c_p__client_8c_ab913946e478e2ead06cb9eccb7b7249b}


Definition at line 508 of file T\+C\+P\+\_\+client.\+c.



References T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::data\+\_\+callback, data\+\_\+callback(), and T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::data\+\_\+callback\+\_\+object.



Referenced by S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T(), and tcp\+\_\+relay\+\_\+set\+\_\+callbacks().


\begin{DoxyCode}
510 \{
511     con->\hyperlink{struct_t_c_p___client___connection_a2da80454e9a05921b2c6616ffb021eec}{data\_callback} = \hyperlink{_t_c_p__test_8c_a36ed22ce4a6bec3fb113a4eaf29df5e1}{data\_callback};
512     con->\hyperlink{struct_t_c_p___client___connection_a9135a1782241a1b2d5e9bcedef0c29a5}{data\_callback\_object} = object;
513 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=300pt]{da/da1/_t_c_p__client_8c_ab913946e478e2ead06cb9eccb7b7249b_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{da/da1/_t_c_p__client_8c_ab913946e478e2ead06cb9eccb7b7249b_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__client_8c_ac795068d9a0ba7b00db3db7bb5e217a7}{\index{T\+C\+P\+\_\+client.\+c@{T\+C\+P\+\_\+client.\+c}!routing\+\_\+response\+\_\+handler@{routing\+\_\+response\+\_\+handler}}
\index{routing\+\_\+response\+\_\+handler@{routing\+\_\+response\+\_\+handler}!T\+C\+P\+\_\+client.\+c@{T\+C\+P\+\_\+client.\+c}}
\subsubsection[{routing\+\_\+response\+\_\+handler}]{\setlength{\rightskip}{0pt plus 5cm}void routing\+\_\+response\+\_\+handler (
\begin{DoxyParamCaption}
\item[{{\bf T\+C\+P\+\_\+\+Client\+\_\+\+Connection} $\ast$}]{con, }
\item[{int($\ast$)(void $\ast$object, uint8\+\_\+t connection\+\_\+id, const uint8\+\_\+t $\ast$public\+\_\+key)}]{response\+\_\+callback, }
\item[{void $\ast$}]{object}
\end{DoxyParamCaption}
)}}\label{_t_c_p__client_8c_ac795068d9a0ba7b00db3db7bb5e217a7}


Definition at line 434 of file T\+C\+P\+\_\+client.\+c.



References T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::response\+\_\+callback, response\+\_\+callback(), and T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::response\+\_\+callback\+\_\+object.



Referenced by S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T(), and tcp\+\_\+relay\+\_\+set\+\_\+callbacks().


\begin{DoxyCode}
436 \{
437     con->\hyperlink{struct_t_c_p___client___connection_ab32747bc59a98c0c7127293859eccb85}{response\_callback} = \hyperlink{_t_c_p__test_8c_aabbbe757608283acb298ba44b3b01706}{response\_callback};
438     con->\hyperlink{struct_t_c_p___client___connection_a60ca473249fab46aefe6f89158bd5a52}{response\_callback\_object} = object;
439 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{da/da1/_t_c_p__client_8c_ac795068d9a0ba7b00db3db7bb5e217a7_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{da/da1/_t_c_p__client_8c_ac795068d9a0ba7b00db3db7bb5e217a7_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__client_8c_a263bc470c2cc015cbb0f975ab5632eb8}{\index{T\+C\+P\+\_\+client.\+c@{T\+C\+P\+\_\+client.\+c}!routing\+\_\+status\+\_\+handler@{routing\+\_\+status\+\_\+handler}}
\index{routing\+\_\+status\+\_\+handler@{routing\+\_\+status\+\_\+handler}!T\+C\+P\+\_\+client.\+c@{T\+C\+P\+\_\+client.\+c}}
\subsubsection[{routing\+\_\+status\+\_\+handler}]{\setlength{\rightskip}{0pt plus 5cm}void routing\+\_\+status\+\_\+handler (
\begin{DoxyParamCaption}
\item[{{\bf T\+C\+P\+\_\+\+Client\+\_\+\+Connection} $\ast$}]{con, }
\item[{int($\ast$)(void $\ast$object, uint32\+\_\+t number, uint8\+\_\+t connection\+\_\+id, uint8\+\_\+t status)}]{status\+\_\+callback, }
\item[{void $\ast$}]{object}
\end{DoxyParamCaption}
)}}\label{_t_c_p__client_8c_a263bc470c2cc015cbb0f975ab5632eb8}


Definition at line 441 of file T\+C\+P\+\_\+client.\+c.



References T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::status\+\_\+callback, status\+\_\+callback(), and T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::status\+\_\+callback\+\_\+object.



Referenced by S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T(), and tcp\+\_\+relay\+\_\+set\+\_\+callbacks().


\begin{DoxyCode}
443 \{
444     con->\hyperlink{struct_t_c_p___client___connection_a8c56af2094f8d2846998b395dbcaef18}{status\_callback} = \hyperlink{_t_c_p__test_8c_ae4f12b6805a17277d33e73ac030d7aca}{status\_callback};
445     con->\hyperlink{struct_t_c_p___client___connection_a73f125475af5ebdac27d2c2a9060039b}{status\_callback\_object} = object;
446 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=316pt]{da/da1/_t_c_p__client_8c_a263bc470c2cc015cbb0f975ab5632eb8_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{da/da1/_t_c_p__client_8c_a263bc470c2cc015cbb0f975ab5632eb8_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__client_8c_aea842652030d00bd8302e3c0201f95b9}{\index{T\+C\+P\+\_\+client.\+c@{T\+C\+P\+\_\+client.\+c}!send\+\_\+data@{send\+\_\+data}}
\index{send\+\_\+data@{send\+\_\+data}!T\+C\+P\+\_\+client.\+c@{T\+C\+P\+\_\+client.\+c}}
\subsubsection[{send\+\_\+data}]{\setlength{\rightskip}{0pt plus 5cm}int send\+\_\+data (
\begin{DoxyParamCaption}
\item[{{\bf T\+C\+P\+\_\+\+Client\+\_\+\+Connection} $\ast$}]{con, }
\item[{uint8\+\_\+t}]{con\+\_\+id, }
\item[{const uint8\+\_\+t $\ast$}]{data, }
\item[{uint16\+\_\+t}]{length}
\end{DoxyParamCaption}
)}}\label{_t_c_p__client_8c_aea842652030d00bd8302e3c0201f95b9}


Definition at line 455 of file T\+C\+P\+\_\+client.\+c.



References T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::connections, N\+U\+M\+\_\+\+C\+L\+I\+E\+N\+T\+\_\+\+C\+O\+N\+N\+E\+C\+T\+I\+O\+N\+S, N\+U\+M\+\_\+\+R\+E\+S\+E\+R\+V\+E\+D\+\_\+\+P\+O\+R\+T\+S, send\+\_\+ping\+\_\+request(), send\+\_\+ping\+\_\+response(), T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::status, and write\+\_\+packet\+\_\+\+T\+C\+P\+\_\+secure\+\_\+connection().



Referenced by send\+\_\+packet\+\_\+tcp\+\_\+connection(), and S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T().


\begin{DoxyCode}
456 \{
457     \textcolor{keywordflow}{if} (con\_id >= \hyperlink{_t_c_p__server_8h_aad3362495a10d80b0edac21c8f896ae1}{NUM\_CLIENT\_CONNECTIONS})
458         \textcolor{keywordflow}{return} -1;
459 
460     \textcolor{keywordflow}{if} (con->\hyperlink{struct_t_c_p___client___connection_a5b7b7af3e8287597e380502eb776cd7a}{connections}[con\_id].\hyperlink{struct_t_c_p___client___connection_ade818037fd6c985038ff29656089758d}{status} != 2)
461         \textcolor{keywordflow}{return} -1;
462 
463     \textcolor{keywordflow}{if} (\hyperlink{_t_c_p__client_8c_a8e1ca90aa8db34a58b3b38cfcb1bb9de}{send\_ping\_response}(con) == 0 || \hyperlink{_t_c_p__client_8c_a5aad81831c1333b763c9fd5eaf41603f}{send\_ping\_request}(con) == 0)
464         \textcolor{keywordflow}{return} 0;
465 
466     uint8\_t packet[1 + length];
467     packet[0] = con\_id + \hyperlink{_t_c_p__server_8h_a41d07eb7b13b1998b771080dfaef6b7b}{NUM\_RESERVED\_PORTS};
468     memcpy(packet + 1, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}, length);
469     \textcolor{keywordflow}{return} \hyperlink{_t_c_p__client_8c_ab959397449cc23b5811168e4395bdaea}{write\_packet\_TCP\_secure\_connection}(con, packet, \textcolor{keyword}{sizeof}(packet)
      , 0);
470 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{da/da1/_t_c_p__client_8c_aea842652030d00bd8302e3c0201f95b9_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{da/da1/_t_c_p__client_8c_aea842652030d00bd8302e3c0201f95b9_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__client_8c_abe305661e19883349d213c74c44ff93f}{\index{T\+C\+P\+\_\+client.\+c@{T\+C\+P\+\_\+client.\+c}!send\+\_\+disconnect\+\_\+notification@{send\+\_\+disconnect\+\_\+notification}}
\index{send\+\_\+disconnect\+\_\+notification@{send\+\_\+disconnect\+\_\+notification}!T\+C\+P\+\_\+client.\+c@{T\+C\+P\+\_\+client.\+c}}
\subsubsection[{send\+\_\+disconnect\+\_\+notification}]{\setlength{\rightskip}{0pt plus 5cm}static int send\+\_\+disconnect\+\_\+notification (
\begin{DoxyParamCaption}
\item[{{\bf T\+C\+P\+\_\+\+Client\+\_\+\+Connection} $\ast$}]{con, }
\item[{uint8\+\_\+t}]{id}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_t_c_p__client_8c_abe305661e19883349d213c74c44ff93f}


Definition at line 526 of file T\+C\+P\+\_\+client.\+c.



References T\+C\+P\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+D\+I\+S\+C\+O\+N\+N\+E\+C\+T\+\_\+\+N\+O\+T\+I\+F\+I\+C\+A\+T\+I\+O\+N, and write\+\_\+packet\+\_\+\+T\+C\+P\+\_\+secure\+\_\+connection().



Referenced by send\+\_\+disconnect\+\_\+request().


\begin{DoxyCode}
527 \{
528     uint8\_t packet[1 + 1];
529     packet[0] = \hyperlink{_t_c_p__server_8h_a65b6df680eaecb9563dfcc8c5fcfba3d}{TCP\_PACKET\_DISCONNECT\_NOTIFICATION};
530     packet[1] = id;
531     \textcolor{keywordflow}{return} \hyperlink{_t_c_p__client_8c_ab959397449cc23b5811168e4395bdaea}{write\_packet\_TCP\_secure\_connection}(con, packet, \textcolor{keyword}{sizeof}(packet)
      , 1);
532 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{da/da1/_t_c_p__client_8c_abe305661e19883349d213c74c44ff93f_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{da/da1/_t_c_p__client_8c_abe305661e19883349d213c74c44ff93f_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__client_8c_af83d9fac2256a46428ad95bf337c05b7}{\index{T\+C\+P\+\_\+client.\+c@{T\+C\+P\+\_\+client.\+c}!send\+\_\+disconnect\+\_\+request@{send\+\_\+disconnect\+\_\+request}}
\index{send\+\_\+disconnect\+\_\+request@{send\+\_\+disconnect\+\_\+request}!T\+C\+P\+\_\+client.\+c@{T\+C\+P\+\_\+client.\+c}}
\subsubsection[{send\+\_\+disconnect\+\_\+request}]{\setlength{\rightskip}{0pt plus 5cm}int send\+\_\+disconnect\+\_\+request (
\begin{DoxyParamCaption}
\item[{{\bf T\+C\+P\+\_\+\+Client\+\_\+\+Connection} $\ast$}]{con, }
\item[{uint8\+\_\+t}]{con\+\_\+id}
\end{DoxyParamCaption}
)}}\label{_t_c_p__client_8c_af83d9fac2256a46428ad95bf337c05b7}


Definition at line 580 of file T\+C\+P\+\_\+client.\+c.



References T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::connections, N\+U\+M\+\_\+\+C\+L\+I\+E\+N\+T\+\_\+\+C\+O\+N\+N\+E\+C\+T\+I\+O\+N\+S, N\+U\+M\+\_\+\+R\+E\+S\+E\+R\+V\+E\+D\+\_\+\+P\+O\+R\+T\+S, T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::number, send\+\_\+disconnect\+\_\+notification(), and T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::status.



Referenced by kill\+\_\+tcp\+\_\+connection\+\_\+to(), and S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T().


\begin{DoxyCode}
581 \{
582     \textcolor{keywordflow}{if} (con\_id >= \hyperlink{_t_c_p__server_8h_aad3362495a10d80b0edac21c8f896ae1}{NUM\_CLIENT\_CONNECTIONS})
583         \textcolor{keywordflow}{return} -1;
584 
585     con->\hyperlink{struct_t_c_p___client___connection_a5b7b7af3e8287597e380502eb776cd7a}{connections}[con\_id].\hyperlink{struct_t_c_p___client___connection_ade818037fd6c985038ff29656089758d}{status} = 0;
586     con->\hyperlink{struct_t_c_p___client___connection_a5b7b7af3e8287597e380502eb776cd7a}{connections}[con\_id].\hyperlink{struct_t_c_p___client___connection_ad50c630d233a71112a7df136970caefc}{number} = 0;
587     \textcolor{keywordflow}{return} \hyperlink{_t_c_p__client_8c_abe305661e19883349d213c74c44ff93f}{send\_disconnect\_notification}(con, con\_id + 
      \hyperlink{_t_c_p__server_8h_a41d07eb7b13b1998b771080dfaef6b7b}{NUM\_RESERVED\_PORTS});
588 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{da/da1/_t_c_p__client_8c_af83d9fac2256a46428ad95bf337c05b7_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{da/da1/_t_c_p__client_8c_af83d9fac2256a46428ad95bf337c05b7_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__client_8c_a236ad67f85cc718a03fda2da3ade0787}{\index{T\+C\+P\+\_\+client.\+c@{T\+C\+P\+\_\+client.\+c}!send\+\_\+onion\+\_\+request@{send\+\_\+onion\+\_\+request}}
\index{send\+\_\+onion\+\_\+request@{send\+\_\+onion\+\_\+request}!T\+C\+P\+\_\+client.\+c@{T\+C\+P\+\_\+client.\+c}}
\subsubsection[{send\+\_\+onion\+\_\+request}]{\setlength{\rightskip}{0pt plus 5cm}int send\+\_\+onion\+\_\+request (
\begin{DoxyParamCaption}
\item[{{\bf T\+C\+P\+\_\+\+Client\+\_\+\+Connection} $\ast$}]{con, }
\item[{const uint8\+\_\+t $\ast$}]{data, }
\item[{uint16\+\_\+t}]{length}
\end{DoxyParamCaption}
)}}\label{_t_c_p__client_8c_a236ad67f85cc718a03fda2da3ade0787}


Definition at line 594 of file T\+C\+P\+\_\+client.\+c.



References T\+C\+P\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+O\+N\+I\+O\+N\+\_\+\+R\+E\+Q\+U\+E\+S\+T, and write\+\_\+packet\+\_\+\+T\+C\+P\+\_\+secure\+\_\+connection().



Referenced by tcp\+\_\+send\+\_\+onion\+\_\+request().


\begin{DoxyCode}
595 \{
596     uint8\_t packet[1 + length];
597     packet[0] = \hyperlink{_t_c_p__server_8h_a879315f1b7234dad07a45d63a6d0aed5}{TCP\_PACKET\_ONION\_REQUEST};
598     memcpy(packet + 1, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}, length);
599     \textcolor{keywordflow}{return} \hyperlink{_t_c_p__client_8c_ab959397449cc23b5811168e4395bdaea}{write\_packet\_TCP\_secure\_connection}(con, packet, \textcolor{keyword}{sizeof}(packet)
      , 0);
600 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{da/da1/_t_c_p__client_8c_a236ad67f85cc718a03fda2da3ade0787_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{da/da1/_t_c_p__client_8c_a236ad67f85cc718a03fda2da3ade0787_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__client_8c_a7818a314434c2bb01c3ea406744f076b}{\index{T\+C\+P\+\_\+client.\+c@{T\+C\+P\+\_\+client.\+c}!send\+\_\+oob\+\_\+packet@{send\+\_\+oob\+\_\+packet}}
\index{send\+\_\+oob\+\_\+packet@{send\+\_\+oob\+\_\+packet}!T\+C\+P\+\_\+client.\+c@{T\+C\+P\+\_\+client.\+c}}
\subsubsection[{send\+\_\+oob\+\_\+packet}]{\setlength{\rightskip}{0pt plus 5cm}int send\+\_\+oob\+\_\+packet (
\begin{DoxyParamCaption}
\item[{{\bf T\+C\+P\+\_\+\+Client\+\_\+\+Connection} $\ast$}]{con, }
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key, }
\item[{const uint8\+\_\+t $\ast$}]{data, }
\item[{uint16\+\_\+t}]{length}
\end{DoxyParamCaption}
)}}\label{_t_c_p__client_8c_a7818a314434c2bb01c3ea406744f076b}


Definition at line 476 of file T\+C\+P\+\_\+client.\+c.



References T\+C\+P\+\_\+\+M\+A\+X\+\_\+\+O\+O\+B\+\_\+\+D\+A\+T\+A\+\_\+\+L\+E\+N\+G\+T\+H, T\+C\+P\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+O\+O\+B\+\_\+\+S\+E\+N\+D, and write\+\_\+packet\+\_\+\+T\+C\+P\+\_\+secure\+\_\+connection().



Referenced by send\+\_\+packet\+\_\+tcp\+\_\+connection(), S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T(), and tcp\+\_\+send\+\_\+oob\+\_\+packet().


\begin{DoxyCode}
477 \{
478     \textcolor{keywordflow}{if} (length == 0 || length > \hyperlink{_t_c_p__server_8h_a9f050748925b02db21564fa5f6c78e4e}{TCP\_MAX\_OOB\_DATA\_LENGTH})
479         \textcolor{keywordflow}{return} -1;
480 
481     uint8\_t packet[1 + crypto\_box\_PUBLICKEYBYTES + length];
482     packet[0] = \hyperlink{_t_c_p__server_8h_a5961d2c3587485c79194c5479a8b0973}{TCP\_PACKET\_OOB\_SEND};
483     memcpy(packet + 1, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, crypto\_box\_PUBLICKEYBYTES);
484     memcpy(packet + 1 + crypto\_box\_PUBLICKEYBYTES, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}, length);
485     \textcolor{keywordflow}{return} \hyperlink{_t_c_p__client_8c_ab959397449cc23b5811168e4395bdaea}{write\_packet\_TCP\_secure\_connection}(con, packet, \textcolor{keyword}{sizeof}(packet)
      , 0);
486 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{da/da1/_t_c_p__client_8c_a7818a314434c2bb01c3ea406744f076b_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{da/da1/_t_c_p__client_8c_a7818a314434c2bb01c3ea406744f076b_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__client_8c_a878656cc36ac482c8063082d0d86850f}{\index{T\+C\+P\+\_\+client.\+c@{T\+C\+P\+\_\+client.\+c}!send\+\_\+pending\+\_\+data@{send\+\_\+pending\+\_\+data}}
\index{send\+\_\+pending\+\_\+data@{send\+\_\+pending\+\_\+data}!T\+C\+P\+\_\+client.\+c@{T\+C\+P\+\_\+client.\+c}}
\subsubsection[{send\+\_\+pending\+\_\+data}]{\setlength{\rightskip}{0pt plus 5cm}static int send\+\_\+pending\+\_\+data (
\begin{DoxyParamCaption}
\item[{{\bf T\+C\+P\+\_\+\+Client\+\_\+\+Connection} $\ast$}]{con}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_t_c_p__client_8c_a878656cc36ac482c8063082d0d86850f}


Definition at line 286 of file T\+C\+P\+\_\+client.\+c.



References T\+C\+P\+\_\+\+Priority\+\_\+\+List\+::data, T\+C\+P\+\_\+\+Priority\+\_\+\+List\+::next, T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::priority\+\_\+queue\+\_\+end, T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::priority\+\_\+queue\+\_\+start, send\+\_\+pending\+\_\+data\+\_\+nonpriority(), T\+C\+P\+\_\+\+Priority\+\_\+\+List\+::sent, T\+C\+P\+\_\+\+Priority\+\_\+\+List\+::size, and T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::sock.



Referenced by do\+\_\+confirmed\+\_\+\+T\+C\+P(), do\+\_\+\+T\+C\+P\+\_\+connection(), and write\+\_\+packet\+\_\+\+T\+C\+P\+\_\+secure\+\_\+connection().


\begin{DoxyCode}
287 \{
288     \textcolor{comment}{/* finish sending current non-priority packet */}
289     \textcolor{keywordflow}{if} (\hyperlink{_t_c_p__client_8c_a531708d11982cfb4c8d31ac915c25386}{send\_pending\_data\_nonpriority}(con) == -1) \{
290         \textcolor{keywordflow}{return} -1;
291     \}
292 
293     \hyperlink{struct_t_c_p___priority___list}{TCP\_Priority\_List} *p = con->\hyperlink{struct_t_c_p___client___connection_a5e19017835c72dc03d9dfd9a93abeb3c}{priority\_queue\_start};
294 
295     \textcolor{keywordflow}{while} (p) \{
296         uint16\_t left = p->\hyperlink{struct_t_c_p___priority___list_aaba88b24a21a6c70c895c0d55f4a69a0}{size} - p->\hyperlink{struct_t_c_p___priority___list_a61e6f322b3c26ac891710463676b5185}{sent};
297         \textcolor{keywordtype}{int} len = send(con->\hyperlink{struct_t_c_p___client___connection_a35b19d84fb632ca8ce5cab237f7089a5}{sock}, p->\hyperlink{struct_t_c_p___priority___list_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data} + p->\hyperlink{struct_t_c_p___priority___list_a61e6f322b3c26ac891710463676b5185}{sent}, left, MSG\_NOSIGNAL);
298 
299         \textcolor{keywordflow}{if} (len != left) \{
300             \textcolor{keywordflow}{if} (len > 0) \{
301                 p->\hyperlink{struct_t_c_p___priority___list_a61e6f322b3c26ac891710463676b5185}{sent} += len;
302             \}
303 
304             \textcolor{keywordflow}{break};
305         \}
306 
307         \hyperlink{struct_t_c_p___priority___list}{TCP\_Priority\_List} *pp = p;
308         p = p->\hyperlink{struct_t_c_p___priority___list_ac4565314423a94bcf735245b8b9b4c53}{next};
309         free(pp);
310     \}
311 
312     con->\hyperlink{struct_t_c_p___client___connection_a5e19017835c72dc03d9dfd9a93abeb3c}{priority\_queue\_start} = p;
313 
314     \textcolor{keywordflow}{if} (!p) \{
315         con->\hyperlink{struct_t_c_p___client___connection_a049dfdaebf54337c3024e077370c62d7}{priority\_queue\_end} = NULL;
316         \textcolor{keywordflow}{return} 0;
317     \}
318 
319     \textcolor{keywordflow}{return} -1;
320 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{da/da1/_t_c_p__client_8c_a878656cc36ac482c8063082d0d86850f_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{da/da1/_t_c_p__client_8c_a878656cc36ac482c8063082d0d86850f_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__client_8c_a531708d11982cfb4c8d31ac915c25386}{\index{T\+C\+P\+\_\+client.\+c@{T\+C\+P\+\_\+client.\+c}!send\+\_\+pending\+\_\+data\+\_\+nonpriority@{send\+\_\+pending\+\_\+data\+\_\+nonpriority}}
\index{send\+\_\+pending\+\_\+data\+\_\+nonpriority@{send\+\_\+pending\+\_\+data\+\_\+nonpriority}!T\+C\+P\+\_\+client.\+c@{T\+C\+P\+\_\+client.\+c}}
\subsubsection[{send\+\_\+pending\+\_\+data\+\_\+nonpriority}]{\setlength{\rightskip}{0pt plus 5cm}static int send\+\_\+pending\+\_\+data\+\_\+nonpriority (
\begin{DoxyParamCaption}
\item[{{\bf T\+C\+P\+\_\+\+Client\+\_\+\+Connection} $\ast$}]{con}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_t_c_p__client_8c_a531708d11982cfb4c8d31ac915c25386}


Definition at line 261 of file T\+C\+P\+\_\+client.\+c.



References T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::last\+\_\+packet, T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::last\+\_\+packet\+\_\+length, T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::last\+\_\+packet\+\_\+sent, and T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::sock.



Referenced by send\+\_\+pending\+\_\+data().


\begin{DoxyCode}
262 \{
263     \textcolor{keywordflow}{if} (con->\hyperlink{struct_t_c_p___client___connection_a78d503fe4c8d935701480b58a0461775}{last\_packet\_length} == 0) \{
264         \textcolor{keywordflow}{return} 0;
265     \}
266 
267     uint16\_t left = con->\hyperlink{struct_t_c_p___client___connection_a78d503fe4c8d935701480b58a0461775}{last\_packet\_length} - con->
      \hyperlink{struct_t_c_p___client___connection_a80b55fa7d5b8e4c3de6b51c99d7670cc}{last\_packet\_sent};
268     \textcolor{keywordtype}{int} len = send(con->\hyperlink{struct_t_c_p___client___connection_a35b19d84fb632ca8ce5cab237f7089a5}{sock}, con->\hyperlink{struct_t_c_p___client___connection_af7b6d103d243e4267b112f6efe1573e2}{last\_packet} + con->
      \hyperlink{struct_t_c_p___client___connection_a80b55fa7d5b8e4c3de6b51c99d7670cc}{last\_packet\_sent}, left, MSG\_NOSIGNAL);
269 
270     \textcolor{keywordflow}{if} (len <= 0)
271         \textcolor{keywordflow}{return} -1;
272 
273     \textcolor{keywordflow}{if} (len == left) \{
274         con->\hyperlink{struct_t_c_p___client___connection_a78d503fe4c8d935701480b58a0461775}{last\_packet\_length} = 0;
275         con->\hyperlink{struct_t_c_p___client___connection_a80b55fa7d5b8e4c3de6b51c99d7670cc}{last\_packet\_sent} = 0;
276         \textcolor{keywordflow}{return} 0;
277     \}
278 
279     con->\hyperlink{struct_t_c_p___client___connection_a80b55fa7d5b8e4c3de6b51c99d7670cc}{last\_packet\_sent} += len;
280     \textcolor{keywordflow}{return} -1;
281 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{da/da1/_t_c_p__client_8c_a531708d11982cfb4c8d31ac915c25386_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__client_8c_a5aad81831c1333b763c9fd5eaf41603f}{\index{T\+C\+P\+\_\+client.\+c@{T\+C\+P\+\_\+client.\+c}!send\+\_\+ping\+\_\+request@{send\+\_\+ping\+\_\+request}}
\index{send\+\_\+ping\+\_\+request@{send\+\_\+ping\+\_\+request}!T\+C\+P\+\_\+client.\+c@{T\+C\+P\+\_\+client.\+c}}
\subsubsection[{send\+\_\+ping\+\_\+request}]{\setlength{\rightskip}{0pt plus 5cm}static int send\+\_\+ping\+\_\+request (
\begin{DoxyParamCaption}
\item[{{\bf T\+C\+P\+\_\+\+Client\+\_\+\+Connection} $\ast$}]{con}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_t_c_p__client_8c_a5aad81831c1333b763c9fd5eaf41603f}


Definition at line 538 of file T\+C\+P\+\_\+client.\+c.



References T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::ping\+\_\+request\+\_\+id, T\+C\+P\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+P\+I\+N\+G, and write\+\_\+packet\+\_\+\+T\+C\+P\+\_\+secure\+\_\+connection().



Referenced by do\+\_\+confirmed\+\_\+\+T\+C\+P(), and send\+\_\+data().


\begin{DoxyCode}
539 \{
540     \textcolor{keywordflow}{if} (!con->\hyperlink{struct_t_c_p___client___connection_a8695cc319f7cab1ea66cb80e403d455b}{ping\_request\_id})
541         \textcolor{keywordflow}{return} 1;
542 
543     uint8\_t packet[1 + \textcolor{keyword}{sizeof}(uint64\_t)];
544     packet[0] = \hyperlink{_t_c_p__server_8h_aa1328be3bbb33d8e47490408376c3553}{TCP\_PACKET\_PING};
545     memcpy(packet + 1, &con->\hyperlink{struct_t_c_p___client___connection_a8695cc319f7cab1ea66cb80e403d455b}{ping\_request\_id}, \textcolor{keyword}{sizeof}(uint64\_t));
546     \textcolor{keywordtype}{int} ret;
547 
548     \textcolor{keywordflow}{if} ((ret = \hyperlink{_t_c_p__client_8c_ab959397449cc23b5811168e4395bdaea}{write\_packet\_TCP\_secure\_connection}(con, packet, \textcolor{keyword}{sizeof}(
      packet), 1)) == 1) \{
549         con->\hyperlink{struct_t_c_p___client___connection_a8695cc319f7cab1ea66cb80e403d455b}{ping\_request\_id} = 0;
550     \}
551 
552     \textcolor{keywordflow}{return} ret;
553 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{da/da1/_t_c_p__client_8c_a5aad81831c1333b763c9fd5eaf41603f_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{da/da1/_t_c_p__client_8c_a5aad81831c1333b763c9fd5eaf41603f_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__client_8c_a8e1ca90aa8db34a58b3b38cfcb1bb9de}{\index{T\+C\+P\+\_\+client.\+c@{T\+C\+P\+\_\+client.\+c}!send\+\_\+ping\+\_\+response@{send\+\_\+ping\+\_\+response}}
\index{send\+\_\+ping\+\_\+response@{send\+\_\+ping\+\_\+response}!T\+C\+P\+\_\+client.\+c@{T\+C\+P\+\_\+client.\+c}}
\subsubsection[{send\+\_\+ping\+\_\+response}]{\setlength{\rightskip}{0pt plus 5cm}static int send\+\_\+ping\+\_\+response (
\begin{DoxyParamCaption}
\item[{{\bf T\+C\+P\+\_\+\+Client\+\_\+\+Connection} $\ast$}]{con}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_t_c_p__client_8c_a8e1ca90aa8db34a58b3b38cfcb1bb9de}


Definition at line 559 of file T\+C\+P\+\_\+client.\+c.



References T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::ping\+\_\+response\+\_\+id, T\+C\+P\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+P\+O\+N\+G, and write\+\_\+packet\+\_\+\+T\+C\+P\+\_\+secure\+\_\+connection().



Referenced by do\+\_\+confirmed\+\_\+\+T\+C\+P(), handle\+\_\+\+T\+C\+P\+\_\+packet(), and send\+\_\+data().


\begin{DoxyCode}
560 \{
561     \textcolor{keywordflow}{if} (!con->\hyperlink{struct_t_c_p___client___connection_a39a52d8f19b6b09a91980f9798ec5b50}{ping\_response\_id})
562         \textcolor{keywordflow}{return} 1;
563 
564     uint8\_t packet[1 + \textcolor{keyword}{sizeof}(uint64\_t)];
565     packet[0] = \hyperlink{_t_c_p__server_8h_a783819134f7296fb82cfc3149f6fbb62}{TCP\_PACKET\_PONG};
566     memcpy(packet + 1, &con->\hyperlink{struct_t_c_p___client___connection_a39a52d8f19b6b09a91980f9798ec5b50}{ping\_response\_id}, \textcolor{keyword}{sizeof}(uint64\_t));
567     \textcolor{keywordtype}{int} ret;
568 
569     \textcolor{keywordflow}{if} ((ret = \hyperlink{_t_c_p__client_8c_ab959397449cc23b5811168e4395bdaea}{write\_packet\_TCP\_secure\_connection}(con, packet, \textcolor{keyword}{sizeof}(
      packet), 1)) == 1) \{
570         con->\hyperlink{struct_t_c_p___client___connection_a39a52d8f19b6b09a91980f9798ec5b50}{ping\_response\_id} = 0;
571     \}
572 
573     \textcolor{keywordflow}{return} ret;
574 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{da/da1/_t_c_p__client_8c_a8e1ca90aa8db34a58b3b38cfcb1bb9de_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{da/da1/_t_c_p__client_8c_a8e1ca90aa8db34a58b3b38cfcb1bb9de_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__client_8c_a0dc7de6475c22a0a31722bbf7ebb8dc5}{\index{T\+C\+P\+\_\+client.\+c@{T\+C\+P\+\_\+client.\+c}!send\+\_\+routing\+\_\+request@{send\+\_\+routing\+\_\+request}}
\index{send\+\_\+routing\+\_\+request@{send\+\_\+routing\+\_\+request}!T\+C\+P\+\_\+client.\+c@{T\+C\+P\+\_\+client.\+c}}
\subsubsection[{send\+\_\+routing\+\_\+request}]{\setlength{\rightskip}{0pt plus 5cm}int send\+\_\+routing\+\_\+request (
\begin{DoxyParamCaption}
\item[{{\bf T\+C\+P\+\_\+\+Client\+\_\+\+Connection} $\ast$}]{con, }
\item[{uint8\+\_\+t $\ast$}]{public\+\_\+key}
\end{DoxyParamCaption}
)}}\label{_t_c_p__client_8c_a0dc7de6475c22a0a31722bbf7ebb8dc5}


Definition at line 426 of file T\+C\+P\+\_\+client.\+c.



References T\+C\+P\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+R\+O\+U\+T\+I\+N\+G\+\_\+\+R\+E\+Q\+U\+E\+S\+T, and write\+\_\+packet\+\_\+\+T\+C\+P\+\_\+secure\+\_\+connection().



Referenced by send\+\_\+tcp\+\_\+relay\+\_\+routing\+\_\+request(), and S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T().


\begin{DoxyCode}
427 \{
428     uint8\_t packet[1 + crypto\_box\_PUBLICKEYBYTES];
429     packet[0] = \hyperlink{_t_c_p__server_8h_a808af5b9484311a39abb96dac1ecd426}{TCP\_PACKET\_ROUTING\_REQUEST};
430     memcpy(packet + 1, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, crypto\_box\_PUBLICKEYBYTES);
431     \textcolor{keywordflow}{return} \hyperlink{_t_c_p__client_8c_ab959397449cc23b5811168e4395bdaea}{write\_packet\_TCP\_secure\_connection}(con, packet, \textcolor{keyword}{sizeof}(packet)
      , 1);
432 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{da/da1/_t_c_p__client_8c_a0dc7de6475c22a0a31722bbf7ebb8dc5_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{da/da1/_t_c_p__client_8c_a0dc7de6475c22a0a31722bbf7ebb8dc5_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__client_8c_a52921fadd1366f32c75e66d9c4340ed2}{\index{T\+C\+P\+\_\+client.\+c@{T\+C\+P\+\_\+client.\+c}!set\+\_\+tcp\+\_\+connection\+\_\+number@{set\+\_\+tcp\+\_\+connection\+\_\+number}}
\index{set\+\_\+tcp\+\_\+connection\+\_\+number@{set\+\_\+tcp\+\_\+connection\+\_\+number}!T\+C\+P\+\_\+client.\+c@{T\+C\+P\+\_\+client.\+c}}
\subsubsection[{set\+\_\+tcp\+\_\+connection\+\_\+number}]{\setlength{\rightskip}{0pt plus 5cm}int set\+\_\+tcp\+\_\+connection\+\_\+number (
\begin{DoxyParamCaption}
\item[{{\bf T\+C\+P\+\_\+\+Client\+\_\+\+Connection} $\ast$}]{con, }
\item[{uint8\+\_\+t}]{con\+\_\+id, }
\item[{uint32\+\_\+t}]{number}
\end{DoxyParamCaption}
)}}\label{_t_c_p__client_8c_a52921fadd1366f32c75e66d9c4340ed2}


Definition at line 496 of file T\+C\+P\+\_\+client.\+c.



References T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::connections, N\+U\+M\+\_\+\+C\+L\+I\+E\+N\+T\+\_\+\+C\+O\+N\+N\+E\+C\+T\+I\+O\+N\+S, T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::number, and T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::status.



Referenced by response\+\_\+callback(), and tcp\+\_\+response\+\_\+callback().


\begin{DoxyCode}
497 \{
498     \textcolor{keywordflow}{if} (con\_id >= \hyperlink{_t_c_p__server_8h_aad3362495a10d80b0edac21c8f896ae1}{NUM\_CLIENT\_CONNECTIONS})
499         \textcolor{keywordflow}{return} -1;
500 
501     \textcolor{keywordflow}{if} (con->\hyperlink{struct_t_c_p___client___connection_a5b7b7af3e8287597e380502eb776cd7a}{connections}[con\_id].\hyperlink{struct_t_c_p___client___connection_ade818037fd6c985038ff29656089758d}{status} == 0)
502         \textcolor{keywordflow}{return} -1;
503 
504     con->\hyperlink{struct_t_c_p___client___connection_a5b7b7af3e8287597e380502eb776cd7a}{connections}[con\_id].\hyperlink{struct_t_c_p___client___connection_ad50c630d233a71112a7df136970caefc}{number} = number;
505     \textcolor{keywordflow}{return} 0;
506 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{da/da1/_t_c_p__client_8c_a52921fadd1366f32c75e66d9c4340ed2_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__client_8c_ada9457c0effffd236ca9c4a004ee8942}{\index{T\+C\+P\+\_\+client.\+c@{T\+C\+P\+\_\+client.\+c}!socks5\+\_\+read\+\_\+handshake\+\_\+response@{socks5\+\_\+read\+\_\+handshake\+\_\+response}}
\index{socks5\+\_\+read\+\_\+handshake\+\_\+response@{socks5\+\_\+read\+\_\+handshake\+\_\+response}!T\+C\+P\+\_\+client.\+c@{T\+C\+P\+\_\+client.\+c}}
\subsubsection[{socks5\+\_\+read\+\_\+handshake\+\_\+response}]{\setlength{\rightskip}{0pt plus 5cm}static int socks5\+\_\+read\+\_\+handshake\+\_\+response (
\begin{DoxyParamCaption}
\item[{{\bf T\+C\+P\+\_\+\+Client\+\_\+\+Connection} $\ast$}]{T\+C\+P\+\_\+conn}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_t_c_p__client_8c_ada9457c0effffd236ca9c4a004ee8942}


Definition at line 146 of file T\+C\+P\+\_\+client.\+c.



References make-\/funny-\/savefile\+::data, read\+\_\+\+T\+C\+P\+\_\+packet(), and T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::sock.



Referenced by do\+\_\+\+T\+C\+P\+\_\+connection().


\begin{DoxyCode}
147 \{
148     uint8\_t \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[2];
149     \textcolor{keywordtype}{int} ret = \hyperlink{_t_c_p__server_8c_a88eda37b476d8dcfdba94899e740dd9e}{read\_TCP\_packet}(TCP\_conn->\hyperlink{struct_t_c_p___client___connection_a35b19d84fb632ca8ce5cab237f7089a5}{sock}, data, \textcolor{keyword}{sizeof}(data));
150 
151     \textcolor{keywordflow}{if} (ret == -1)
152         \textcolor{keywordflow}{return} 0;
153 
154     \textcolor{keywordflow}{if} (data[0] == 5 && data[1] == 0)
155         \textcolor{keywordflow}{return} 1;
156 
157     \textcolor{keywordflow}{return} -1;
158 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{da/da1/_t_c_p__client_8c_ada9457c0effffd236ca9c4a004ee8942_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{da/da1/_t_c_p__client_8c_ada9457c0effffd236ca9c4a004ee8942_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__client_8c_aaf4385f749c6f9c21f4f4ac17b31a77b}{\index{T\+C\+P\+\_\+client.\+c@{T\+C\+P\+\_\+client.\+c}!wipe\+\_\+priority\+\_\+list@{wipe\+\_\+priority\+\_\+list}}
\index{wipe\+\_\+priority\+\_\+list@{wipe\+\_\+priority\+\_\+list}!T\+C\+P\+\_\+client.\+c@{T\+C\+P\+\_\+client.\+c}}
\subsubsection[{wipe\+\_\+priority\+\_\+list}]{\setlength{\rightskip}{0pt plus 5cm}static void wipe\+\_\+priority\+\_\+list (
\begin{DoxyParamCaption}
\item[{{\bf T\+C\+P\+\_\+\+Client\+\_\+\+Connection} $\ast$}]{con}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_t_c_p__client_8c_aaf4385f749c6f9c21f4f4ac17b31a77b}


Definition at line 349 of file T\+C\+P\+\_\+client.\+c.



References T\+C\+P\+\_\+\+Priority\+\_\+\+List\+::next, and T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::priority\+\_\+queue\+\_\+start.



Referenced by kill\+\_\+\+T\+C\+P\+\_\+connection().


\begin{DoxyCode}
350 \{
351     \hyperlink{struct_t_c_p___priority___list}{TCP\_Priority\_List} *p = con->\hyperlink{struct_t_c_p___client___connection_a5e19017835c72dc03d9dfd9a93abeb3c}{priority\_queue\_start};
352 
353     \textcolor{keywordflow}{while} (p) \{
354         \hyperlink{struct_t_c_p___priority___list}{TCP\_Priority\_List} *pp = p;
355         p = p->\hyperlink{struct_t_c_p___priority___list_ac4565314423a94bcf735245b8b9b4c53}{next};
356         free(pp);
357     \}
358 
359 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{da/da1/_t_c_p__client_8c_aaf4385f749c6f9c21f4f4ac17b31a77b_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__client_8c_ab959397449cc23b5811168e4395bdaea}{\index{T\+C\+P\+\_\+client.\+c@{T\+C\+P\+\_\+client.\+c}!write\+\_\+packet\+\_\+\+T\+C\+P\+\_\+secure\+\_\+connection@{write\+\_\+packet\+\_\+\+T\+C\+P\+\_\+secure\+\_\+connection}}
\index{write\+\_\+packet\+\_\+\+T\+C\+P\+\_\+secure\+\_\+connection@{write\+\_\+packet\+\_\+\+T\+C\+P\+\_\+secure\+\_\+connection}!T\+C\+P\+\_\+client.\+c@{T\+C\+P\+\_\+client.\+c}}
\subsubsection[{write\+\_\+packet\+\_\+\+T\+C\+P\+\_\+secure\+\_\+connection}]{\setlength{\rightskip}{0pt plus 5cm}static int write\+\_\+packet\+\_\+\+T\+C\+P\+\_\+secure\+\_\+connection (
\begin{DoxyParamCaption}
\item[{{\bf T\+C\+P\+\_\+\+Client\+\_\+\+Connection} $\ast$}]{con, }
\item[{const uint8\+\_\+t $\ast$}]{data, }
\item[{uint16\+\_\+t}]{length, }
\item[{\+\_\+\+Bool}]{priority}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_t_c_p__client_8c_ab959397449cc23b5811168e4395bdaea}


Definition at line 365 of file T\+C\+P\+\_\+client.\+c.



References add\+\_\+priority(), encrypt\+\_\+data\+\_\+symmetric(), increment\+\_\+nonce(), T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::last\+\_\+packet, T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::last\+\_\+packet\+\_\+length, T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::last\+\_\+packet\+\_\+sent, M\+A\+X\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+S\+I\+Z\+E, send\+\_\+pending\+\_\+data(), T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::sent\+\_\+nonce, T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::shared\+\_\+key, and T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::sock.



Referenced by send\+\_\+data(), send\+\_\+disconnect\+\_\+notification(), send\+\_\+onion\+\_\+request(), send\+\_\+oob\+\_\+packet(), send\+\_\+ping\+\_\+request(), send\+\_\+ping\+\_\+response(), and send\+\_\+routing\+\_\+request().


\begin{DoxyCode}
367 \{
368     \textcolor{keywordflow}{if} (length + crypto\_box\_MACBYTES > \hyperlink{_t_c_p__server_8h_a879456c3b8e2853f7044d764e9c180d4}{MAX\_PACKET\_SIZE})
369         \textcolor{keywordflow}{return} -1;
370 
371     \_Bool sendpriority = 1;
372 
373     \textcolor{keywordflow}{if} (\hyperlink{_t_c_p__client_8c_a878656cc36ac482c8063082d0d86850f}{send\_pending\_data}(con) == -1) \{
374         \textcolor{keywordflow}{if} (priority) \{
375             sendpriority = 0;
376         \} \textcolor{keywordflow}{else} \{
377             \textcolor{keywordflow}{return} 0;
378         \}
379     \}
380 
381     uint8\_t packet[\textcolor{keyword}{sizeof}(uint16\_t) + length + crypto\_box\_MACBYTES];
382 
383     uint16\_t c\_length = htons(length + crypto\_box\_MACBYTES);
384     memcpy(packet, &c\_length, \textcolor{keyword}{sizeof}(uint16\_t));
385     \textcolor{keywordtype}{int} len = \hyperlink{crypto__core_8c_a81efc0a4a6e0efe372651e26e342a6e5}{encrypt\_data\_symmetric}(con->\hyperlink{struct_t_c_p___client___connection_a81ead9fac55a0cedc30a96253a2c5119}{shared\_key}, con->
      \hyperlink{struct_t_c_p___client___connection_a9df0e00e8f493ed6cd1ff45e7da33c0d}{sent\_nonce}, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}, length, packet + \textcolor{keyword}{sizeof}(uint16\_t));
386 
387     \textcolor{keywordflow}{if} ((\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int})len != (\textcolor{keyword}{sizeof}(packet) - \textcolor{keyword}{sizeof}(uint16\_t)))
388         \textcolor{keywordflow}{return} -1;
389 
390     \textcolor{keywordflow}{if} (priority) \{
391         len = sendpriority ? send(con->\hyperlink{struct_t_c_p___client___connection_a35b19d84fb632ca8ce5cab237f7089a5}{sock}, packet, \textcolor{keyword}{sizeof}(packet), MSG\_NOSIGNAL) : 0;
392 
393         \textcolor{keywordflow}{if} (len <= 0) \{
394             len = 0;
395         \}
396 
397         \hyperlink{crypto__core_8c_ab953f1e92b8a9a193f69f02323b9c980}{increment\_nonce}(con->\hyperlink{struct_t_c_p___client___connection_a9df0e00e8f493ed6cd1ff45e7da33c0d}{sent\_nonce});
398 
399         \textcolor{keywordflow}{if} ((\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int})len == \textcolor{keyword}{sizeof}(packet)) \{
400             \textcolor{keywordflow}{return} 1;
401         \}
402 
403         \textcolor{keywordflow}{return} \hyperlink{_t_c_p__client_8c_a87e67ddfe8fdabe9f2d32080097c3970}{add\_priority}(con, packet, \textcolor{keyword}{sizeof}(packet), len);
404     \}
405 
406     len = send(con->\hyperlink{struct_t_c_p___client___connection_a35b19d84fb632ca8ce5cab237f7089a5}{sock}, packet, \textcolor{keyword}{sizeof}(packet), MSG\_NOSIGNAL);
407 
408     \textcolor{keywordflow}{if} (len <= 0)
409         \textcolor{keywordflow}{return} 0;
410 
411     \hyperlink{crypto__core_8c_ab953f1e92b8a9a193f69f02323b9c980}{increment\_nonce}(con->\hyperlink{struct_t_c_p___client___connection_a9df0e00e8f493ed6cd1ff45e7da33c0d}{sent\_nonce});
412 
413     \textcolor{keywordflow}{if} ((\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int})len == \textcolor{keyword}{sizeof}(packet))
414         \textcolor{keywordflow}{return} 1;
415 
416     memcpy(con->\hyperlink{struct_t_c_p___client___connection_af7b6d103d243e4267b112f6efe1573e2}{last\_packet}, packet, \textcolor{keyword}{sizeof}(packet));
417     con->\hyperlink{struct_t_c_p___client___connection_a78d503fe4c8d935701480b58a0461775}{last\_packet\_length} = \textcolor{keyword}{sizeof}(packet);
418     con->\hyperlink{struct_t_c_p___client___connection_a80b55fa7d5b8e4c3de6b51c99d7670cc}{last\_packet\_sent} = len;
419     \textcolor{keywordflow}{return} 1;
420 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{da/da1/_t_c_p__client_8c_ab959397449cc23b5811168e4395bdaea_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{da/da1/_t_c_p__client_8c_ab959397449cc23b5811168e4395bdaea_icgraph}
\end{center}
\end{figure}


