\hypertarget{onion__client_8c}{\section{toxcore/onion\+\_\+client.c File Reference}
\label{onion__client_8c}\index{toxcore/onion\+\_\+client.\+c@{toxcore/onion\+\_\+client.\+c}}
}
{\ttfamily \#include \char`\"{}onion\+\_\+client.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}util.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}L\+A\+N\+\_\+discovery.\+h\char`\"{}}\\*
Include dependency graph for onion\+\_\+client.\+c\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d9/d1d/onion__client_8c__incl}
\end{center}
\end{figure}
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{onion__client_8c_a55f5b7df3f8a34dccc636e32ea48cbd4}{A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+A\+R\+R\+A\+Y\+\_\+\+S\+I\+Z\+E}~256
\item 
\#define \hyperlink{onion__client_8c_a7cb15d415c27b3aacfad91b0d5d150cd}{A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T}~10
\item 
\#define \hyperlink{onion__client_8c_ab7a046054431d84cc9e9c0404ebc5002}{D\+A\+T\+A\+\_\+\+I\+N\+\_\+\+R\+E\+S\+P\+O\+N\+S\+E\+\_\+\+M\+I\+N\+\_\+\+S\+I\+Z\+E}~\hyperlink{onion__client_8h_acf455f967a05c7f179b4ae799857df22}{O\+N\+I\+O\+N\+\_\+\+D\+A\+T\+A\+\_\+\+I\+N\+\_\+\+R\+E\+S\+P\+O\+N\+S\+E\+\_\+\+M\+I\+N\+\_\+\+S\+I\+Z\+E}
\item 
\#define \hyperlink{onion__client_8c_a76335ad8705aea17b952e4993fef52ff}{D\+H\+T\+P\+K\+\_\+\+D\+A\+T\+A\+\_\+\+M\+I\+N\+\_\+\+L\+E\+N\+G\+T\+H}~(1 + sizeof(uint64\+\_\+t) + crypto\+\_\+box\+\_\+\+P\+U\+B\+L\+I\+C\+K\+E\+Y\+B\+Y\+T\+E\+S)
\item 
\#define \hyperlink{onion__client_8c_a33fc9507f55ea8592e426f78dfe70f79}{D\+H\+T\+P\+K\+\_\+\+D\+A\+T\+A\+\_\+\+M\+A\+X\+\_\+\+L\+E\+N\+G\+T\+H}~(\hyperlink{onion__client_8c_a76335ad8705aea17b952e4993fef52ff}{D\+H\+T\+P\+K\+\_\+\+D\+A\+T\+A\+\_\+\+M\+I\+N\+\_\+\+L\+E\+N\+G\+T\+H} + sizeof(\hyperlink{struct_node__format}{Node\+\_\+format})$\ast$\hyperlink{_d_h_t_8h_a57f4cf16e79a384d7d59a3cc585ea5a3}{M\+A\+X\+\_\+\+S\+E\+N\+T\+\_\+\+N\+O\+D\+E\+S})
\item 
\#define \hyperlink{onion__client_8c_a89562b3d1da87946099316523c47fc4f}{A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+F\+R\+I\+E\+N\+D}~(\hyperlink{onion__client_8h_abe6f3db92bf33a9f48958a8df2ae5f50}{O\+N\+I\+O\+N\+\_\+\+N\+O\+D\+E\+\_\+\+P\+I\+N\+G\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L} $\ast$ 6)
\item 
\#define \hyperlink{onion__client_8c_a3d4afef54c4c6134fc3d4024ec65ff61}{A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+B\+E\+G\+I\+N\+N\+I\+N\+G}~3
\item 
\#define \hyperlink{onion__client_8c_adb819c7e131c2c65764b9cf92eb73e65}{F\+R\+I\+E\+N\+D\+\_\+\+O\+N\+I\+O\+N\+\_\+\+N\+O\+D\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T}~(\hyperlink{onion__client_8h_a96ede75aa4a66f24cefc164af1d4e41d}{O\+N\+I\+O\+N\+\_\+\+N\+O\+D\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T} $\ast$ 6)
\item 
\#define \hyperlink{onion__client_8c_acd0565214383a01ecc72df8ffbab884b}{R\+U\+N\+\_\+\+C\+O\+U\+N\+T\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+B\+E\+G\+I\+N\+N\+I\+N\+G}~17
\item 
\#define \hyperlink{onion__client_8c_adde3021afad81f683c60bb00ab4ecbb6}{A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L\+\_\+\+N\+O\+T\+\_\+\+A\+N\+N\+O\+U\+N\+C\+E\+D}~3
\item 
\#define \hyperlink{onion__client_8c_a3793bf4bf316da2ae4d2ad5f2c8ab55a}{A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L\+\_\+\+A\+N\+N\+O\+U\+N\+C\+E\+D}~\hyperlink{onion__client_8h_abe6f3db92bf33a9f48958a8df2ae5f50}{O\+N\+I\+O\+N\+\_\+\+N\+O\+D\+E\+\_\+\+P\+I\+N\+G\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L}
\item 
\#define \hyperlink{onion__client_8c_a14673162b8f41519787e7c18e6806e59}{O\+N\+I\+O\+N\+\_\+\+C\+O\+N\+N\+E\+C\+T\+I\+O\+N\+\_\+\+S\+E\+C\+O\+N\+D\+S}~2
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{onion__client_8c_accbc9c20b5933ea088d718ea09abd6b8}{onion\+\_\+add\+\_\+bs\+\_\+path\+\_\+node} (\hyperlink{struct_onion___client}{Onion\+\_\+\+Client} $\ast$onion\+\_\+c, \hyperlink{struct_i_p___port}{I\+P\+\_\+\+Port} ip\+\_\+port, const uint8\+\_\+t $\ast$public\+\_\+key)
\item 
static int \hyperlink{onion__client_8c_a5f6d509093a5e8a3491d21cc21afc7b1}{onion\+\_\+add\+\_\+path\+\_\+node} (\hyperlink{struct_onion___client}{Onion\+\_\+\+Client} $\ast$onion\+\_\+c, \hyperlink{struct_i_p___port}{I\+P\+\_\+\+Port} ip\+\_\+port, const uint8\+\_\+t $\ast$public\+\_\+key)
\item 
uint16\+\_\+t \hyperlink{onion__client_8c_ad93584ad916d224037dd7a6e5caeebcf}{onion\+\_\+backup\+\_\+nodes} (const \hyperlink{struct_onion___client}{Onion\+\_\+\+Client} $\ast$onion\+\_\+c, \hyperlink{struct_node__format}{Node\+\_\+format} $\ast$nodes, uint16\+\_\+t max\+\_\+num)
\item 
static uint16\+\_\+t \hyperlink{onion__client_8c_a62aaed2b6aee07c4c0fb8ffd97a03172}{random\+\_\+nodes\+\_\+path\+\_\+onion} (const \hyperlink{struct_onion___client}{Onion\+\_\+\+Client} $\ast$onion\+\_\+c, \hyperlink{struct_node__format}{Node\+\_\+format} $\ast$nodes, uint16\+\_\+t max\+\_\+num)
\item 
static int \hyperlink{onion__client_8c_ae8d66f9bb925deae2911c9c00a9a9dc9}{is\+\_\+path\+\_\+used} (const \hyperlink{struct_onion___client___paths}{Onion\+\_\+\+Client\+\_\+\+Paths} $\ast$onion\+\_\+paths, const \hyperlink{struct_node__format}{Node\+\_\+format} $\ast$nodes)
\item 
static \+\_\+\+Bool \hyperlink{onion__client_8c_a31170965be8e022295d36b508b432a1e}{path\+\_\+timed\+\_\+out} (\hyperlink{struct_onion___client___paths}{Onion\+\_\+\+Client\+\_\+\+Paths} $\ast$onion\+\_\+paths, uint32\+\_\+t pathnum)
\item 
static int \hyperlink{onion__client_8c_a0ec6065dac34021e69682691f70b667c}{random\+\_\+path} (const \hyperlink{struct_onion___client}{Onion\+\_\+\+Client} $\ast$onion\+\_\+c, \hyperlink{struct_onion___client___paths}{Onion\+\_\+\+Client\+\_\+\+Paths} $\ast$onion\+\_\+paths, uint32\+\_\+t pathnum, \hyperlink{struct_onion___path}{Onion\+\_\+\+Path} $\ast$\hyperlink{tox__sync_8c_a6f50c85874ef8f3405625e5a26febbcb}{path})
\item 
static \+\_\+\+Bool \hyperlink{onion__client_8c_a359fb95e06e99e4a5e9391c7b9bafaa6}{path\+\_\+exists} (\hyperlink{struct_onion___client___paths}{Onion\+\_\+\+Client\+\_\+\+Paths} $\ast$onion\+\_\+paths, uint32\+\_\+t path\+\_\+num)
\item 
static uint32\+\_\+t \hyperlink{onion__client_8c_a79b0950c5eea44ddc315ef8a9b2e47f1}{set\+\_\+path\+\_\+timeouts} (\hyperlink{struct_onion___client}{Onion\+\_\+\+Client} $\ast$onion\+\_\+c, uint32\+\_\+t \hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num}, uint32\+\_\+t path\+\_\+num)
\item 
static int \hyperlink{onion__client_8c_a4be9a76607f006a407f4f96dd49f25da}{send\+\_\+onion\+\_\+packet\+\_\+tcp\+\_\+udp} (const \hyperlink{struct_onion___client}{Onion\+\_\+\+Client} $\ast$onion\+\_\+c, const \hyperlink{struct_onion___path}{Onion\+\_\+\+Path} $\ast$\hyperlink{tox__sync_8c_a6f50c85874ef8f3405625e5a26febbcb}{path}, \hyperlink{struct_i_p___port}{I\+P\+\_\+\+Port} dest, const uint8\+\_\+t $\ast$data, uint16\+\_\+t length)
\item 
static int \hyperlink{onion__client_8c_acf73e72ebf38831539c211179d5559b9}{new\+\_\+sendback} (\hyperlink{struct_onion___client}{Onion\+\_\+\+Client} $\ast$onion\+\_\+c, uint32\+\_\+t \hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num}, const uint8\+\_\+t $\ast$public\+\_\+key, \hyperlink{struct_i_p___port}{I\+P\+\_\+\+Port} ip\+\_\+port, uint32\+\_\+t path\+\_\+num, uint64\+\_\+t $\ast$sendback)
\item 
static uint32\+\_\+t \hyperlink{onion__client_8c_a10e005a8f58bdbec1322c8ae599bad6c}{check\+\_\+sendback} (\hyperlink{struct_onion___client}{Onion\+\_\+\+Client} $\ast$onion\+\_\+c, const uint8\+\_\+t $\ast$sendback, uint8\+\_\+t $\ast$ret\+\_\+pubkey, \hyperlink{struct_i_p___port}{I\+P\+\_\+\+Port} $\ast$ret\+\_\+ip\+\_\+port, uint32\+\_\+t $\ast$path\+\_\+num)
\item 
static int \hyperlink{onion__client_8c_a4253f1739f978c9aac584c97b7a55f48}{client\+\_\+send\+\_\+announce\+\_\+request} (\hyperlink{struct_onion___client}{Onion\+\_\+\+Client} $\ast$onion\+\_\+c, uint32\+\_\+t \hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num}, \hyperlink{struct_i_p___port}{I\+P\+\_\+\+Port} dest, const uint8\+\_\+t $\ast$dest\+\_\+pubkey, const uint8\+\_\+t $\ast$ping\+\_\+id, uint32\+\_\+t pathnum)
\item 
static int \hyperlink{onion__client_8c_a8b4a60d685081d29b3b61256241acaf5}{cmp\+\_\+entry} (const void $\ast$a, const void $\ast$b)
\item 
static int \hyperlink{onion__client_8c_a4f1e9a581f96d31f2f822ca6be9cc0eb}{client\+\_\+add\+\_\+to\+\_\+list} (\hyperlink{struct_onion___client}{Onion\+\_\+\+Client} $\ast$onion\+\_\+c, uint32\+\_\+t \hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num}, const uint8\+\_\+t $\ast$public\+\_\+key, \hyperlink{struct_i_p___port}{I\+P\+\_\+\+Port} ip\+\_\+port, uint8\+\_\+t is\+\_\+stored, const uint8\+\_\+t $\ast$pingid\+\_\+or\+\_\+key, uint32\+\_\+t path\+\_\+num)
\item 
static int \hyperlink{onion__client_8c_ad2e57716c800e26c60ee6e1c8c7c6bf1}{good\+\_\+to\+\_\+ping} (\hyperlink{struct_last___pinged}{Last\+\_\+\+Pinged} $\ast$last\+\_\+pinged, uint8\+\_\+t $\ast$last\+\_\+pinged\+\_\+index, const uint8\+\_\+t $\ast$public\+\_\+key)
\item 
static int \hyperlink{onion__client_8c_a934df896ad375a9dbd82f563fb27144f}{client\+\_\+ping\+\_\+nodes} (\hyperlink{struct_onion___client}{Onion\+\_\+\+Client} $\ast$onion\+\_\+c, uint32\+\_\+t \hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num}, const \hyperlink{struct_node__format}{Node\+\_\+format} $\ast$nodes, uint16\+\_\+t num\+\_\+nodes, \hyperlink{struct_i_p___port}{I\+P\+\_\+\+Port} source)
\item 
static int \hyperlink{onion__client_8c_acef82e3853e62dce8cd45450ff028f97}{handle\+\_\+announce\+\_\+response} (void $\ast$object, \hyperlink{struct_i_p___port}{I\+P\+\_\+\+Port} source, const uint8\+\_\+t $\ast$packet, uint16\+\_\+t length)
\item 
static int \hyperlink{onion__client_8c_a6b443c4d4d5f83acb988fad87d2c1054}{handle\+\_\+data\+\_\+response} (void $\ast$object, \hyperlink{struct_i_p___port}{I\+P\+\_\+\+Port} source, const uint8\+\_\+t $\ast$packet, uint16\+\_\+t length)
\item 
static int \hyperlink{onion__client_8c_ac9b7f86cb71b27c5db73d341b910745c}{handle\+\_\+dhtpk\+\_\+announce} (void $\ast$object, const uint8\+\_\+t $\ast$source\+\_\+pubkey, const uint8\+\_\+t $\ast$data, uint16\+\_\+t length)
\item 
static int \hyperlink{onion__client_8c_a3519dd95525df398b46b0e4a928f54f0}{handle\+\_\+tcp\+\_\+onion} (void $\ast$object, const uint8\+\_\+t $\ast$data, uint16\+\_\+t length)
\item 
int \hyperlink{onion__client_8c_aa1be42b5ea93bd068f47271831157927}{send\+\_\+onion\+\_\+data} (\hyperlink{struct_onion___client}{Onion\+\_\+\+Client} $\ast$onion\+\_\+c, int friend\+\_\+num, const uint8\+\_\+t $\ast$data, uint16\+\_\+t length)
\item 
static int \hyperlink{onion__client_8c_a35bf565e3fc2b84ba3434d7cb38ba0e4}{send\+\_\+dht\+\_\+dhtpk} (const \hyperlink{struct_onion___client}{Onion\+\_\+\+Client} $\ast$onion\+\_\+c, int friend\+\_\+num, const uint8\+\_\+t $\ast$data, uint16\+\_\+t length)
\item 
static int \hyperlink{onion__client_8c_a0686761fa3196a2bded47c2b95c7edc4}{handle\+\_\+dht\+\_\+dhtpk} (void $\ast$object, \hyperlink{struct_i_p___port}{I\+P\+\_\+\+Port} source, const uint8\+\_\+t $\ast$source\+\_\+pubkey, const uint8\+\_\+t $\ast$packet, uint16\+\_\+t length)
\item 
static int \hyperlink{onion__client_8c_a64e317f7dd22c983c325f62aed9ecfae}{send\+\_\+dhtpk\+\_\+announce} (\hyperlink{struct_onion___client}{Onion\+\_\+\+Client} $\ast$onion\+\_\+c, uint16\+\_\+t friend\+\_\+num, uint8\+\_\+t onion\+\_\+dht\+\_\+both)
\item 
int \hyperlink{onion__client_8c_a5c2b07b25a5892051b8e132361c54d53}{onion\+\_\+friend\+\_\+num} (const \hyperlink{struct_onion___client}{Onion\+\_\+\+Client} $\ast$onion\+\_\+c, const uint8\+\_\+t $\ast$public\+\_\+key)
\item 
static int \hyperlink{onion__client_8c_aa5f27f182606ab701dfc948bfb3a1b42}{realloc\+\_\+onion\+\_\+friends} (\hyperlink{struct_onion___client}{Onion\+\_\+\+Client} $\ast$onion\+\_\+c, uint32\+\_\+t \hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num})
\item 
int \hyperlink{onion__client_8c_a4dd8a80061f115daba3ffb2a3f611b38}{onion\+\_\+addfriend} (\hyperlink{struct_onion___client}{Onion\+\_\+\+Client} $\ast$onion\+\_\+c, const uint8\+\_\+t $\ast$public\+\_\+key)
\item 
int \hyperlink{onion__client_8c_a986bc935dff33db8070c431fcd2363eb}{onion\+\_\+delfriend} (\hyperlink{struct_onion___client}{Onion\+\_\+\+Client} $\ast$onion\+\_\+c, int friend\+\_\+num)
\item 
int \hyperlink{onion__client_8c_a7bb680d62616d0dfbb6f7d2ff097107c}{recv\+\_\+tcp\+\_\+relay\+\_\+handler} (\hyperlink{struct_onion___client}{Onion\+\_\+\+Client} $\ast$onion\+\_\+c, int friend\+\_\+num, int($\ast$\hyperlink{friend__connection_8c_a9360ec098f2b1082b480b4e36b0a5f07}{tcp\+\_\+relay\+\_\+node\+\_\+callback})(void $\ast$object, uint32\+\_\+t number, \hyperlink{struct_i_p___port}{I\+P\+\_\+\+Port} ip\+\_\+port, const uint8\+\_\+t $\ast$public\+\_\+key), void $\ast$object, uint32\+\_\+t number)
\item 
int \hyperlink{onion__client_8c_a08895281211a01749ee466338fedbeec}{onion\+\_\+dht\+\_\+pk\+\_\+callback} (\hyperlink{struct_onion___client}{Onion\+\_\+\+Client} $\ast$onion\+\_\+c, int friend\+\_\+num, void($\ast$function)(void $\ast$data, int32\+\_\+t number, const uint8\+\_\+t $\ast$dht\+\_\+public\+\_\+key), void $\ast$object, uint32\+\_\+t number)
\item 
int \hyperlink{onion__client_8c_a1c5dc5e030ac14db475a4b45214f2a88}{onion\+\_\+set\+\_\+friend\+\_\+\+D\+H\+T\+\_\+pubkey} (\hyperlink{struct_onion___client}{Onion\+\_\+\+Client} $\ast$onion\+\_\+c, int friend\+\_\+num, const uint8\+\_\+t $\ast$dht\+\_\+key)
\item 
unsigned int \hyperlink{onion__client_8c_aed6b3a90411af009433f7df95753909a}{onion\+\_\+getfriend\+\_\+\+D\+H\+T\+\_\+pubkey} (const \hyperlink{struct_onion___client}{Onion\+\_\+\+Client} $\ast$onion\+\_\+c, int friend\+\_\+num, uint8\+\_\+t $\ast$dht\+\_\+key)
\item 
int \hyperlink{onion__client_8c_a729c34e35841408f6d775179f4e7a48b}{onion\+\_\+getfriendip} (const \hyperlink{struct_onion___client}{Onion\+\_\+\+Client} $\ast$onion\+\_\+c, int friend\+\_\+num, \hyperlink{struct_i_p___port}{I\+P\+\_\+\+Port} $\ast$ip\+\_\+port)
\item 
int \hyperlink{onion__client_8c_a8b91a1e598508b83e0408fc65316ae73}{onion\+\_\+set\+\_\+friend\+\_\+online} (\hyperlink{struct_onion___client}{Onion\+\_\+\+Client} $\ast$onion\+\_\+c, int friend\+\_\+num, uint8\+\_\+t is\+\_\+online)
\item 
static void \hyperlink{onion__client_8c_a18daedee61cc5670d52904fc89e4b32b}{populate\+\_\+path\+\_\+nodes} (\hyperlink{struct_onion___client}{Onion\+\_\+\+Client} $\ast$onion\+\_\+c)
\item 
static void \hyperlink{onion__client_8c_aa10b37a1195f854626985f6707487b2c}{populate\+\_\+path\+\_\+nodes\+\_\+tcp} (\hyperlink{struct_onion___client}{Onion\+\_\+\+Client} $\ast$onion\+\_\+c)
\item 
static void \hyperlink{onion__client_8c_a02301d507ab3c11bfee8112560f36f87}{do\+\_\+friend} (\hyperlink{struct_onion___client}{Onion\+\_\+\+Client} $\ast$onion\+\_\+c, uint16\+\_\+t friendnum)
\item 
void \hyperlink{onion__client_8c_a2dfcba5e4eb429f5f2ae79ae999149c4}{oniondata\+\_\+registerhandler} (\hyperlink{struct_onion___client}{Onion\+\_\+\+Client} $\ast$onion\+\_\+c, uint8\+\_\+t byte, \hyperlink{onion__client_8h_a588c94e2cf9542398b7b8951126a751e}{oniondata\+\_\+handler\+\_\+callback} cb, void $\ast$object)
\item 
static void \hyperlink{onion__client_8c_ae37f00e2304222b24cef2cce370e58d3}{do\+\_\+announce} (\hyperlink{struct_onion___client}{Onion\+\_\+\+Client} $\ast$onion\+\_\+c)
\item 
static int \hyperlink{onion__client_8c_a431d923b0d1456565facb61cf7409af2}{onion\+\_\+isconnected} (const \hyperlink{struct_onion___client}{Onion\+\_\+\+Client} $\ast$onion\+\_\+c)
\item 
unsigned int \hyperlink{onion__client_8c_a851cc0015a7360b9abfb7d92b997b2b4}{onion\+\_\+connection\+\_\+status} (const \hyperlink{struct_onion___client}{Onion\+\_\+\+Client} $\ast$onion\+\_\+c)
\item 
void \hyperlink{onion__client_8c_aa1771a7c1ebf446973e8d2bbb7ea8c2d}{do\+\_\+onion\+\_\+client} (\hyperlink{struct_onion___client}{Onion\+\_\+\+Client} $\ast$onion\+\_\+c)
\item 
\hyperlink{struct_onion___client}{Onion\+\_\+\+Client} $\ast$ \hyperlink{onion__client_8c_a9a6ae3a9c70a5221a65bd1c9be751a2e}{new\+\_\+onion\+\_\+client} (\hyperlink{struct_net___crypto}{Net\+\_\+\+Crypto} $\ast$c)
\item 
void \hyperlink{onion__client_8c_a591041f85e43cf886ab4c72fb3b8d468}{kill\+\_\+onion\+\_\+client} (\hyperlink{struct_onion___client}{Onion\+\_\+\+Client} $\ast$onion\+\_\+c)
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
static uint8\+\_\+t \hyperlink{onion__client_8c_a3551f15862efa7b58779722fe9763c45}{cmp\+\_\+public\+\_\+key} \mbox{[}crypto\+\_\+box\+\_\+\+P\+U\+B\+L\+I\+C\+K\+E\+Y\+B\+Y\+T\+E\+S\mbox{]}
\end{DoxyCompactItemize}


\subsection{Macro Definition Documentation}
\hypertarget{onion__client_8c_a55f5b7df3f8a34dccc636e32ea48cbd4}{\index{onion\+\_\+client.\+c@{onion\+\_\+client.\+c}!A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+A\+R\+R\+A\+Y\+\_\+\+S\+I\+Z\+E@{A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+A\+R\+R\+A\+Y\+\_\+\+S\+I\+Z\+E}}
\index{A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+A\+R\+R\+A\+Y\+\_\+\+S\+I\+Z\+E@{A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+A\+R\+R\+A\+Y\+\_\+\+S\+I\+Z\+E}!onion\+\_\+client.\+c@{onion\+\_\+client.\+c}}
\subsubsection[{A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+A\+R\+R\+A\+Y\+\_\+\+S\+I\+Z\+E}]{\setlength{\rightskip}{0pt plus 5cm}\#define A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+A\+R\+R\+A\+Y\+\_\+\+S\+I\+Z\+E~256}}\label{onion__client_8c_a55f5b7df3f8a34dccc636e32ea48cbd4}


Definition at line 33 of file onion\+\_\+client.\+c.



Referenced by new\+\_\+onion\+\_\+client().

\hypertarget{onion__client_8c_a89562b3d1da87946099316523c47fc4f}{\index{onion\+\_\+client.\+c@{onion\+\_\+client.\+c}!A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+F\+R\+I\+E\+N\+D@{A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+F\+R\+I\+E\+N\+D}}
\index{A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+F\+R\+I\+E\+N\+D@{A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+F\+R\+I\+E\+N\+D}!onion\+\_\+client.\+c@{onion\+\_\+client.\+c}}
\subsubsection[{A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+F\+R\+I\+E\+N\+D}]{\setlength{\rightskip}{0pt plus 5cm}\#define A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+F\+R\+I\+E\+N\+D~({\bf O\+N\+I\+O\+N\+\_\+\+N\+O\+D\+E\+\_\+\+P\+I\+N\+G\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L} $\ast$ 6)}}\label{onion__client_8c_a89562b3d1da87946099316523c47fc4f}


Definition at line 1231 of file onion\+\_\+client.\+c.



Referenced by do\+\_\+friend().

\hypertarget{onion__client_8c_a3d4afef54c4c6134fc3d4024ec65ff61}{\index{onion\+\_\+client.\+c@{onion\+\_\+client.\+c}!A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+B\+E\+G\+I\+N\+N\+I\+N\+G@{A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+B\+E\+G\+I\+N\+N\+I\+N\+G}}
\index{A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+B\+E\+G\+I\+N\+N\+I\+N\+G@{A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+B\+E\+G\+I\+N\+N\+I\+N\+G}!onion\+\_\+client.\+c@{onion\+\_\+client.\+c}}
\subsubsection[{A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+B\+E\+G\+I\+N\+N\+I\+N\+G}]{\setlength{\rightskip}{0pt plus 5cm}\#define A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+B\+E\+G\+I\+N\+N\+I\+N\+G~3}}\label{onion__client_8c_a3d4afef54c4c6134fc3d4024ec65ff61}


Definition at line 1232 of file onion\+\_\+client.\+c.



Referenced by do\+\_\+friend().

\hypertarget{onion__client_8c_a3793bf4bf316da2ae4d2ad5f2c8ab55a}{\index{onion\+\_\+client.\+c@{onion\+\_\+client.\+c}!A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L\+\_\+\+A\+N\+N\+O\+U\+N\+C\+E\+D@{A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L\+\_\+\+A\+N\+N\+O\+U\+N\+C\+E\+D}}
\index{A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L\+\_\+\+A\+N\+N\+O\+U\+N\+C\+E\+D@{A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L\+\_\+\+A\+N\+N\+O\+U\+N\+C\+E\+D}!onion\+\_\+client.\+c@{onion\+\_\+client.\+c}}
\subsubsection[{A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L\+\_\+\+A\+N\+N\+O\+U\+N\+C\+E\+D}]{\setlength{\rightskip}{0pt plus 5cm}\#define A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L\+\_\+\+A\+N\+N\+O\+U\+N\+C\+E\+D~{\bf O\+N\+I\+O\+N\+\_\+\+N\+O\+D\+E\+\_\+\+P\+I\+N\+G\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L}}}\label{onion__client_8c_a3793bf4bf316da2ae4d2ad5f2c8ab55a}


Definition at line 1317 of file onion\+\_\+client.\+c.



Referenced by do\+\_\+announce().

\hypertarget{onion__client_8c_adde3021afad81f683c60bb00ab4ecbb6}{\index{onion\+\_\+client.\+c@{onion\+\_\+client.\+c}!A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L\+\_\+\+N\+O\+T\+\_\+\+A\+N\+N\+O\+U\+N\+C\+E\+D@{A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L\+\_\+\+N\+O\+T\+\_\+\+A\+N\+N\+O\+U\+N\+C\+E\+D}}
\index{A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L\+\_\+\+N\+O\+T\+\_\+\+A\+N\+N\+O\+U\+N\+C\+E\+D@{A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L\+\_\+\+N\+O\+T\+\_\+\+A\+N\+N\+O\+U\+N\+C\+E\+D}!onion\+\_\+client.\+c@{onion\+\_\+client.\+c}}
\subsubsection[{A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L\+\_\+\+N\+O\+T\+\_\+\+A\+N\+N\+O\+U\+N\+C\+E\+D}]{\setlength{\rightskip}{0pt plus 5cm}\#define A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L\+\_\+\+N\+O\+T\+\_\+\+A\+N\+N\+O\+U\+N\+C\+E\+D~3}}\label{onion__client_8c_adde3021afad81f683c60bb00ab4ecbb6}


Definition at line 1316 of file onion\+\_\+client.\+c.



Referenced by do\+\_\+announce().

\hypertarget{onion__client_8c_a7cb15d415c27b3aacfad91b0d5d150cd}{\index{onion\+\_\+client.\+c@{onion\+\_\+client.\+c}!A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T@{A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T}}
\index{A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T@{A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T}!onion\+\_\+client.\+c@{onion\+\_\+client.\+c}}
\subsubsection[{A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T}]{\setlength{\rightskip}{0pt plus 5cm}\#define A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T~10}}\label{onion__client_8c_a7cb15d415c27b3aacfad91b0d5d150cd}


Definition at line 34 of file onion\+\_\+client.\+c.



Referenced by new\+\_\+onion\+\_\+client().

\hypertarget{onion__client_8c_ab7a046054431d84cc9e9c0404ebc5002}{\index{onion\+\_\+client.\+c@{onion\+\_\+client.\+c}!D\+A\+T\+A\+\_\+\+I\+N\+\_\+\+R\+E\+S\+P\+O\+N\+S\+E\+\_\+\+M\+I\+N\+\_\+\+S\+I\+Z\+E@{D\+A\+T\+A\+\_\+\+I\+N\+\_\+\+R\+E\+S\+P\+O\+N\+S\+E\+\_\+\+M\+I\+N\+\_\+\+S\+I\+Z\+E}}
\index{D\+A\+T\+A\+\_\+\+I\+N\+\_\+\+R\+E\+S\+P\+O\+N\+S\+E\+\_\+\+M\+I\+N\+\_\+\+S\+I\+Z\+E@{D\+A\+T\+A\+\_\+\+I\+N\+\_\+\+R\+E\+S\+P\+O\+N\+S\+E\+\_\+\+M\+I\+N\+\_\+\+S\+I\+Z\+E}!onion\+\_\+client.\+c@{onion\+\_\+client.\+c}}
\subsubsection[{D\+A\+T\+A\+\_\+\+I\+N\+\_\+\+R\+E\+S\+P\+O\+N\+S\+E\+\_\+\+M\+I\+N\+\_\+\+S\+I\+Z\+E}]{\setlength{\rightskip}{0pt plus 5cm}\#define D\+A\+T\+A\+\_\+\+I\+N\+\_\+\+R\+E\+S\+P\+O\+N\+S\+E\+\_\+\+M\+I\+N\+\_\+\+S\+I\+Z\+E~{\bf O\+N\+I\+O\+N\+\_\+\+D\+A\+T\+A\+\_\+\+I\+N\+\_\+\+R\+E\+S\+P\+O\+N\+S\+E\+\_\+\+M\+I\+N\+\_\+\+S\+I\+Z\+E}}}\label{onion__client_8c_ab7a046054431d84cc9e9c0404ebc5002}


Definition at line 667 of file onion\+\_\+client.\+c.



Referenced by handle\+\_\+data\+\_\+response(), handle\+\_\+dht\+\_\+dhtpk(), send\+\_\+dht\+\_\+dhtpk(), and send\+\_\+onion\+\_\+data().

\hypertarget{onion__client_8c_a33fc9507f55ea8592e426f78dfe70f79}{\index{onion\+\_\+client.\+c@{onion\+\_\+client.\+c}!D\+H\+T\+P\+K\+\_\+\+D\+A\+T\+A\+\_\+\+M\+A\+X\+\_\+\+L\+E\+N\+G\+T\+H@{D\+H\+T\+P\+K\+\_\+\+D\+A\+T\+A\+\_\+\+M\+A\+X\+\_\+\+L\+E\+N\+G\+T\+H}}
\index{D\+H\+T\+P\+K\+\_\+\+D\+A\+T\+A\+\_\+\+M\+A\+X\+\_\+\+L\+E\+N\+G\+T\+H@{D\+H\+T\+P\+K\+\_\+\+D\+A\+T\+A\+\_\+\+M\+A\+X\+\_\+\+L\+E\+N\+G\+T\+H}!onion\+\_\+client.\+c@{onion\+\_\+client.\+c}}
\subsubsection[{D\+H\+T\+P\+K\+\_\+\+D\+A\+T\+A\+\_\+\+M\+A\+X\+\_\+\+L\+E\+N\+G\+T\+H}]{\setlength{\rightskip}{0pt plus 5cm}\#define D\+H\+T\+P\+K\+\_\+\+D\+A\+T\+A\+\_\+\+M\+A\+X\+\_\+\+L\+E\+N\+G\+T\+H~({\bf D\+H\+T\+P\+K\+\_\+\+D\+A\+T\+A\+\_\+\+M\+I\+N\+\_\+\+L\+E\+N\+G\+T\+H} + sizeof({\bf Node\+\_\+format})$\ast${\bf M\+A\+X\+\_\+\+S\+E\+N\+T\+\_\+\+N\+O\+D\+E\+S})}}\label{onion__client_8c_a33fc9507f55ea8592e426f78dfe70f79}


Definition at line 702 of file onion\+\_\+client.\+c.



Referenced by handle\+\_\+dht\+\_\+dhtpk(), handle\+\_\+dhtpk\+\_\+announce(), and send\+\_\+dhtpk\+\_\+announce().

\hypertarget{onion__client_8c_a76335ad8705aea17b952e4993fef52ff}{\index{onion\+\_\+client.\+c@{onion\+\_\+client.\+c}!D\+H\+T\+P\+K\+\_\+\+D\+A\+T\+A\+\_\+\+M\+I\+N\+\_\+\+L\+E\+N\+G\+T\+H@{D\+H\+T\+P\+K\+\_\+\+D\+A\+T\+A\+\_\+\+M\+I\+N\+\_\+\+L\+E\+N\+G\+T\+H}}
\index{D\+H\+T\+P\+K\+\_\+\+D\+A\+T\+A\+\_\+\+M\+I\+N\+\_\+\+L\+E\+N\+G\+T\+H@{D\+H\+T\+P\+K\+\_\+\+D\+A\+T\+A\+\_\+\+M\+I\+N\+\_\+\+L\+E\+N\+G\+T\+H}!onion\+\_\+client.\+c@{onion\+\_\+client.\+c}}
\subsubsection[{D\+H\+T\+P\+K\+\_\+\+D\+A\+T\+A\+\_\+\+M\+I\+N\+\_\+\+L\+E\+N\+G\+T\+H}]{\setlength{\rightskip}{0pt plus 5cm}\#define D\+H\+T\+P\+K\+\_\+\+D\+A\+T\+A\+\_\+\+M\+I\+N\+\_\+\+L\+E\+N\+G\+T\+H~(1 + sizeof(uint64\+\_\+t) + crypto\+\_\+box\+\_\+\+P\+U\+B\+L\+I\+C\+K\+E\+Y\+B\+Y\+T\+E\+S)}}\label{onion__client_8c_a76335ad8705aea17b952e4993fef52ff}


Definition at line 701 of file onion\+\_\+client.\+c.



Referenced by handle\+\_\+dht\+\_\+dhtpk(), handle\+\_\+dhtpk\+\_\+announce(), and send\+\_\+dhtpk\+\_\+announce().

\hypertarget{onion__client_8c_adb819c7e131c2c65764b9cf92eb73e65}{\index{onion\+\_\+client.\+c@{onion\+\_\+client.\+c}!F\+R\+I\+E\+N\+D\+\_\+\+O\+N\+I\+O\+N\+\_\+\+N\+O\+D\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T@{F\+R\+I\+E\+N\+D\+\_\+\+O\+N\+I\+O\+N\+\_\+\+N\+O\+D\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T}}
\index{F\+R\+I\+E\+N\+D\+\_\+\+O\+N\+I\+O\+N\+\_\+\+N\+O\+D\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T@{F\+R\+I\+E\+N\+D\+\_\+\+O\+N\+I\+O\+N\+\_\+\+N\+O\+D\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T}!onion\+\_\+client.\+c@{onion\+\_\+client.\+c}}
\subsubsection[{F\+R\+I\+E\+N\+D\+\_\+\+O\+N\+I\+O\+N\+\_\+\+N\+O\+D\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T}]{\setlength{\rightskip}{0pt plus 5cm}\#define F\+R\+I\+E\+N\+D\+\_\+\+O\+N\+I\+O\+N\+\_\+\+N\+O\+D\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T~({\bf O\+N\+I\+O\+N\+\_\+\+N\+O\+D\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T} $\ast$ 6)}}\label{onion__client_8c_adb819c7e131c2c65764b9cf92eb73e65}


Definition at line 1233 of file onion\+\_\+client.\+c.



Referenced by do\+\_\+friend().

\hypertarget{onion__client_8c_a14673162b8f41519787e7c18e6806e59}{\index{onion\+\_\+client.\+c@{onion\+\_\+client.\+c}!O\+N\+I\+O\+N\+\_\+\+C\+O\+N\+N\+E\+C\+T\+I\+O\+N\+\_\+\+S\+E\+C\+O\+N\+D\+S@{O\+N\+I\+O\+N\+\_\+\+C\+O\+N\+N\+E\+C\+T\+I\+O\+N\+\_\+\+S\+E\+C\+O\+N\+D\+S}}
\index{O\+N\+I\+O\+N\+\_\+\+C\+O\+N\+N\+E\+C\+T\+I\+O\+N\+\_\+\+S\+E\+C\+O\+N\+D\+S@{O\+N\+I\+O\+N\+\_\+\+C\+O\+N\+N\+E\+C\+T\+I\+O\+N\+\_\+\+S\+E\+C\+O\+N\+D\+S}!onion\+\_\+client.\+c@{onion\+\_\+client.\+c}}
\subsubsection[{O\+N\+I\+O\+N\+\_\+\+C\+O\+N\+N\+E\+C\+T\+I\+O\+N\+\_\+\+S\+E\+C\+O\+N\+D\+S}]{\setlength{\rightskip}{0pt plus 5cm}\#define O\+N\+I\+O\+N\+\_\+\+C\+O\+N\+N\+E\+C\+T\+I\+O\+N\+\_\+\+S\+E\+C\+O\+N\+D\+S~2}}\label{onion__client_8c_a14673162b8f41519787e7c18e6806e59}


Definition at line 1412 of file onion\+\_\+client.\+c.



Referenced by do\+\_\+onion\+\_\+client(), and onion\+\_\+connection\+\_\+status().

\hypertarget{onion__client_8c_acd0565214383a01ecc72df8ffbab884b}{\index{onion\+\_\+client.\+c@{onion\+\_\+client.\+c}!R\+U\+N\+\_\+\+C\+O\+U\+N\+T\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+B\+E\+G\+I\+N\+N\+I\+N\+G@{R\+U\+N\+\_\+\+C\+O\+U\+N\+T\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+B\+E\+G\+I\+N\+N\+I\+N\+G}}
\index{R\+U\+N\+\_\+\+C\+O\+U\+N\+T\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+B\+E\+G\+I\+N\+N\+I\+N\+G@{R\+U\+N\+\_\+\+C\+O\+U\+N\+T\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+B\+E\+G\+I\+N\+N\+I\+N\+G}!onion\+\_\+client.\+c@{onion\+\_\+client.\+c}}
\subsubsection[{R\+U\+N\+\_\+\+C\+O\+U\+N\+T\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+B\+E\+G\+I\+N\+N\+I\+N\+G}]{\setlength{\rightskip}{0pt plus 5cm}\#define R\+U\+N\+\_\+\+C\+O\+U\+N\+T\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+B\+E\+G\+I\+N\+N\+I\+N\+G~17}}\label{onion__client_8c_acd0565214383a01ecc72df8ffbab884b}


Definition at line 1235 of file onion\+\_\+client.\+c.



Referenced by do\+\_\+friend().



\subsection{Function Documentation}
\hypertarget{onion__client_8c_a10e005a8f58bdbec1322c8ae599bad6c}{\index{onion\+\_\+client.\+c@{onion\+\_\+client.\+c}!check\+\_\+sendback@{check\+\_\+sendback}}
\index{check\+\_\+sendback@{check\+\_\+sendback}!onion\+\_\+client.\+c@{onion\+\_\+client.\+c}}
\subsubsection[{check\+\_\+sendback}]{\setlength{\rightskip}{0pt plus 5cm}static uint32\+\_\+t check\+\_\+sendback (
\begin{DoxyParamCaption}
\item[{{\bf Onion\+\_\+\+Client} $\ast$}]{onion\+\_\+c, }
\item[{const uint8\+\_\+t $\ast$}]{sendback, }
\item[{uint8\+\_\+t $\ast$}]{ret\+\_\+pubkey, }
\item[{{\bf I\+P\+\_\+\+Port} $\ast$}]{ret\+\_\+ip\+\_\+port, }
\item[{uint32\+\_\+t $\ast$}]{path\+\_\+num}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{onion__client_8c_a10e005a8f58bdbec1322c8ae599bad6c}


Definition at line 379 of file onion\+\_\+client.\+c.



References Onion\+\_\+\+Client\+::announce\+\_\+ping\+\_\+array, make-\/funny-\/savefile\+::data, num, and ping\+\_\+array\+\_\+check().



Referenced by handle\+\_\+announce\+\_\+response().


\begin{DoxyCode}
381 \{
382     uint64\_t sback;
383     memcpy(&sback, sendback, \textcolor{keyword}{sizeof}(uint64\_t));
384     uint8\_t \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[\textcolor{keyword}{sizeof}(uint32\_t) + crypto\_box\_PUBLICKEYBYTES + \textcolor{keyword}{sizeof}(
      \hyperlink{struct_i_p___port}{IP\_Port}) + \textcolor{keyword}{sizeof}(uint32\_t)];
385 
386     \textcolor{keywordflow}{if} (\hyperlink{ping__array_8c_a3d5c40ba255810816fddd02116ec2d22}{ping\_array\_check}(\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}, \textcolor{keyword}{sizeof}(\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}), &onion\_c->
      \hyperlink{struct_onion___client_a01eafc8a6b041139be5bc6d72c2eafdf}{announce\_ping\_array}, sback) != \textcolor{keyword}{sizeof}(\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}))
387         \textcolor{keywordflow}{return} ~0;
388 
389     memcpy(ret\_pubkey, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} + \textcolor{keyword}{sizeof}(uint32\_t), crypto\_box\_PUBLICKEYBYTES);
390     memcpy(ret\_ip\_port, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} + \textcolor{keyword}{sizeof}(uint32\_t) + crypto\_box\_PUBLICKEYBYTES, \textcolor{keyword}{sizeof}(
      \hyperlink{struct_i_p___port}{IP\_Port}));
391     memcpy(path\_num, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} + \textcolor{keyword}{sizeof}(uint32\_t) + crypto\_box\_PUBLICKEYBYTES + \textcolor{keyword}{sizeof}(
      \hyperlink{struct_i_p___port}{IP\_Port}), \textcolor{keyword}{sizeof}(uint32\_t));
392 
393     uint32\_t \hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num};
394     memcpy(&num, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}, \textcolor{keyword}{sizeof}(uint32\_t));
395     \textcolor{keywordflow}{return} \hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num};
396 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_a10e005a8f58bdbec1322c8ae599bad6c_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_a10e005a8f58bdbec1322c8ae599bad6c_icgraph}
\end{center}
\end{figure}


\hypertarget{onion__client_8c_a4f1e9a581f96d31f2f822ca6be9cc0eb}{\index{onion\+\_\+client.\+c@{onion\+\_\+client.\+c}!client\+\_\+add\+\_\+to\+\_\+list@{client\+\_\+add\+\_\+to\+\_\+list}}
\index{client\+\_\+add\+\_\+to\+\_\+list@{client\+\_\+add\+\_\+to\+\_\+list}!onion\+\_\+client.\+c@{onion\+\_\+client.\+c}}
\subsubsection[{client\+\_\+add\+\_\+to\+\_\+list}]{\setlength{\rightskip}{0pt plus 5cm}static int client\+\_\+add\+\_\+to\+\_\+list (
\begin{DoxyParamCaption}
\item[{{\bf Onion\+\_\+\+Client} $\ast$}]{onion\+\_\+c, }
\item[{uint32\+\_\+t}]{num, }
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key, }
\item[{{\bf I\+P\+\_\+\+Port}}]{ip\+\_\+port, }
\item[{uint8\+\_\+t}]{is\+\_\+stored, }
\item[{const uint8\+\_\+t $\ast$}]{pingid\+\_\+or\+\_\+key, }
\item[{uint32\+\_\+t}]{path\+\_\+num}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{onion__client_8c_a4f1e9a581f96d31f2f822ca6be9cc0eb}


Definition at line 472 of file onion\+\_\+client.\+c.



References Onion\+\_\+\+Client\+::c, Onion\+\_\+\+Client\+::clients\+\_\+announce\+\_\+list, Onion\+\_\+\+Friend\+::clients\+\_\+list, cmp\+\_\+entry(), cmp\+\_\+public\+\_\+key, Onion\+\_\+\+Client\+::friends\+\_\+list, i, id\+\_\+closest(), Onion\+\_\+\+Node\+::ip\+\_\+port, Onion\+\_\+\+Node\+::is\+\_\+stored, is\+\_\+timeout(), Onion\+\_\+\+Node\+::last\+\_\+pinged, M\+A\+X\+\_\+\+O\+N\+I\+O\+N\+\_\+\+C\+L\+I\+E\+N\+T\+S, Onion\+\_\+\+Client\+::num\+\_\+friends, onion\+\_\+add\+\_\+path\+\_\+node(), O\+N\+I\+O\+N\+\_\+\+N\+O\+D\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T, O\+N\+I\+O\+N\+\_\+\+P\+I\+N\+G\+\_\+\+I\+D\+\_\+\+S\+I\+Z\+E, Onion\+\_\+\+Node\+::path\+\_\+used, Onion\+\_\+\+Friend\+::real\+\_\+public\+\_\+key, Net\+\_\+\+Crypto\+::self\+\_\+public\+\_\+key, set\+\_\+path\+\_\+timeouts(), Onion\+\_\+\+Client\+::temp\+\_\+public\+\_\+key, Onion\+\_\+\+Node\+::timestamp, and unix\+\_\+time().



Referenced by handle\+\_\+announce\+\_\+response().


\begin{DoxyCode}
474 \{
475     \textcolor{keywordflow}{if} (\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num} > onion\_c->\hyperlink{struct_onion___client_a8ee1f2d7e543bce350c591a8eaac0cf8}{num\_friends})
476         \textcolor{keywordflow}{return} -1;
477 
478     \hyperlink{struct_onion___node}{Onion\_Node} *list\_nodes = NULL;
479     uint8\_t *reference\_id = NULL;
480 
481     \textcolor{keywordflow}{if} (\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num} == 0) \{
482         list\_nodes = onion\_c->\hyperlink{struct_onion___client_a21a83b6615ce3ab53739031a355aeabd}{clients\_announce\_list};
483         reference\_id = onion\_c->\hyperlink{struct_onion___client_a0f5b9349eb586149cef9017eed2abdfe}{c}->\hyperlink{struct_net___crypto_ae726df8bdc26380e5a6c3187a00d6881}{self\_public\_key};
484 
485         \textcolor{keywordflow}{if} (is\_stored == 1 && memcmp(pingid\_or\_key, onion\_c->\hyperlink{struct_onion___client_afc342de3f1533c0adfd762a6fd0d20ab}{temp\_public\_key}, 
      crypto\_box\_PUBLICKEYBYTES) != 0) \{
486             is\_stored = 0;
487         \}
488 
489     \} \textcolor{keywordflow}{else} \{
490         \textcolor{keywordflow}{if} (is\_stored >= 2)
491             \textcolor{keywordflow}{return} -1;
492 
493         list\_nodes = onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num} - 1].\hyperlink{struct_onion___friend_a6797ac2f59ba5ef59a8a70cd6515ca25}{clients\_list};
494         reference\_id = onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num} - 1].
      \hyperlink{struct_onion___friend_a996dcaefa2a5954a199e2beb584c1feb}{real\_public\_key};
495     \}
496 
497     memcpy(\hyperlink{onion__client_8c_a3551f15862efa7b58779722fe9763c45}{cmp\_public\_key}, reference\_id, crypto\_box\_PUBLICKEYBYTES);
498     qsort(list\_nodes, \hyperlink{onion__client_8h_ab1de7815e06277ced6779ba201b0b716}{MAX\_ONION\_CLIENTS}, \textcolor{keyword}{sizeof}(\hyperlink{struct_onion___node}{Onion\_Node}), 
      \hyperlink{onion__client_8c_a8b4a60d685081d29b3b61256241acaf5}{cmp\_entry});
499 
500     \textcolor{keywordtype}{int} index = -1, stored = 0;
501     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
502 
503     \textcolor{keywordflow}{if} (\hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(list\_nodes[0].timestamp, \hyperlink{onion__client_8h_a96ede75aa4a66f24cefc164af1d4e41d}{ONION\_NODE\_TIMEOUT})
504             || \hyperlink{_d_h_t_8c_a903a5bc580826fe447adb841b7782333}{id\_closest}(reference\_id, list\_nodes[0].\hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, public\_key) == 2) \{
505         index = 0;
506     \}
507 
508     \textcolor{keywordflow}{for} (i = 0; i < \hyperlink{onion__client_8h_ab1de7815e06277ced6779ba201b0b716}{MAX\_ONION\_CLIENTS}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
509         \textcolor{keywordflow}{if} (memcmp(list\_nodes[i].public\_key, public\_key, crypto\_box\_PUBLICKEYBYTES) == 0) \{
510             index = \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
511             stored = 1;
512             \textcolor{keywordflow}{break};
513         \}
514     \}
515 
516     \textcolor{keywordflow}{if} (index == -1)
517         \textcolor{keywordflow}{return} 0;
518 
519     memcpy(list\_nodes[index].public\_key, public\_key, crypto\_box\_PUBLICKEYBYTES);
520     list\_nodes[index].\hyperlink{struct_onion___node_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port} = ip\_port;
521 
522     \textcolor{comment}{//TODO: remove this and find a better source of nodes to use for paths.}
523     \hyperlink{onion__client_8c_a5f6d509093a5e8a3491d21cc21afc7b1}{onion\_add\_path\_node}(onion\_c, ip\_port, public\_key);
524 
525     \textcolor{keywordflow}{if} (is\_stored == 1) \{
526         memcpy(list\_nodes[index].data\_public\_key, pingid\_or\_key, crypto\_box\_PUBLICKEYBYTES);
527     \} \textcolor{keywordflow}{else} \{
528         memcpy(list\_nodes[index].ping\_id, pingid\_or\_key, \hyperlink{onion__announce_8h_a53426e5a269d092b0b862a3516549716}{ONION\_PING\_ID\_SIZE});
529     \}
530 
531     list\_nodes[index].\hyperlink{struct_onion___node_ada3701a9ce02699f1b7e8f55a41379bf}{is\_stored} = is\_stored;
532     list\_nodes[index].\hyperlink{struct_onion___node_a465bef81f6478756e5443025b1f2ddfa}{timestamp} = \hyperlink{util_8c_ac958d9f8847cb8039444bfa3d304233a}{unix\_time}();
533 
534     \textcolor{keywordflow}{if} (!stored)
535         list\_nodes[index].\hyperlink{struct_onion___node_a4049204f6c392628d31be6c39f03e031}{last\_pinged} = 0;
536 
537     list\_nodes[index].\hyperlink{struct_onion___node_a75c3cb4fcbcf13c47379cc14737926d9}{path\_used} = \hyperlink{onion__client_8c_a79b0950c5eea44ddc315ef8a9b2e47f1}{set\_path\_timeouts}(onion\_c, 
      \hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num}, path\_num);
538     \textcolor{keywordflow}{return} 0;
539 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_a4f1e9a581f96d31f2f822ca6be9cc0eb_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_a4f1e9a581f96d31f2f822ca6be9cc0eb_icgraph}
\end{center}
\end{figure}


\hypertarget{onion__client_8c_a934df896ad375a9dbd82f563fb27144f}{\index{onion\+\_\+client.\+c@{onion\+\_\+client.\+c}!client\+\_\+ping\+\_\+nodes@{client\+\_\+ping\+\_\+nodes}}
\index{client\+\_\+ping\+\_\+nodes@{client\+\_\+ping\+\_\+nodes}!onion\+\_\+client.\+c@{onion\+\_\+client.\+c}}
\subsubsection[{client\+\_\+ping\+\_\+nodes}]{\setlength{\rightskip}{0pt plus 5cm}static int client\+\_\+ping\+\_\+nodes (
\begin{DoxyParamCaption}
\item[{{\bf Onion\+\_\+\+Client} $\ast$}]{onion\+\_\+c, }
\item[{uint32\+\_\+t}]{num, }
\item[{const {\bf Node\+\_\+format} $\ast$}]{nodes, }
\item[{uint16\+\_\+t}]{num\+\_\+nodes, }
\item[{{\bf I\+P\+\_\+\+Port}}]{source}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{onion__client_8c_a934df896ad375a9dbd82f563fb27144f}


Definition at line 557 of file onion\+\_\+client.\+c.



References Onion\+\_\+\+Client\+::c, client\+\_\+send\+\_\+announce\+\_\+request(), Onion\+\_\+\+Client\+::clients\+\_\+announce\+\_\+list, Onion\+\_\+\+Friend\+::clients\+\_\+list, Onion\+\_\+\+Client\+::friends\+\_\+list, good\+\_\+to\+\_\+ping(), i, id\+\_\+closest(), I\+P\+\_\+\+Port\+::ip, is\+\_\+timeout(), L\+A\+N\+\_\+ip(), Onion\+\_\+\+Friend\+::last\+\_\+pinged, Onion\+\_\+\+Client\+::last\+\_\+pinged, Onion\+\_\+\+Friend\+::last\+\_\+pinged\+\_\+index, Onion\+\_\+\+Client\+::last\+\_\+pinged\+\_\+index, M\+A\+X\+\_\+\+O\+N\+I\+O\+N\+\_\+\+C\+L\+I\+E\+N\+T\+S, Onion\+\_\+\+Client\+::num\+\_\+friends, O\+N\+I\+O\+N\+\_\+\+N\+O\+D\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T, make-\/funny-\/savefile\+::public\+\_\+key, Onion\+\_\+\+Friend\+::real\+\_\+public\+\_\+key, and Net\+\_\+\+Crypto\+::self\+\_\+public\+\_\+key.



Referenced by handle\+\_\+announce\+\_\+response().


\begin{DoxyCode}
559 \{
560     \textcolor{keywordflow}{if} (\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num} > onion\_c->\hyperlink{struct_onion___client_a8ee1f2d7e543bce350c591a8eaac0cf8}{num\_friends})
561         \textcolor{keywordflow}{return} -1;
562 
563     \textcolor{keywordflow}{if} (num\_nodes == 0)
564         \textcolor{keywordflow}{return} 0;
565 
566     \hyperlink{struct_onion___node}{Onion\_Node} *list\_nodes = NULL;
567     uint8\_t *reference\_id = NULL;
568 
569     \hyperlink{struct_last___pinged}{Last\_Pinged} *last\_pinged = NULL;
570     uint8\_t *last\_pinged\_index = NULL;
571 
572     \textcolor{keywordflow}{if} (\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num} == 0) \{
573         list\_nodes = onion\_c->\hyperlink{struct_onion___client_a21a83b6615ce3ab53739031a355aeabd}{clients\_announce\_list};
574         reference\_id = onion\_c->\hyperlink{struct_onion___client_a0f5b9349eb586149cef9017eed2abdfe}{c}->\hyperlink{struct_net___crypto_ae726df8bdc26380e5a6c3187a00d6881}{self\_public\_key};
575         last\_pinged = onion\_c->\hyperlink{struct_onion___client_a27015cced65360814a59652b662ef143}{last\_pinged};
576         last\_pinged\_index = &onion\_c->\hyperlink{struct_onion___client_a6e0a5214a3dffa151dd52dc4c230145b}{last\_pinged\_index};
577     \} \textcolor{keywordflow}{else} \{
578         list\_nodes = onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num} - 1].\hyperlink{struct_onion___friend_a6797ac2f59ba5ef59a8a70cd6515ca25}{clients\_list};
579         reference\_id = onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num} - 1].
      \hyperlink{struct_onion___friend_a996dcaefa2a5954a199e2beb584c1feb}{real\_public\_key};
580         last\_pinged = onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num} - 1].\hyperlink{struct_onion___friend_a27015cced65360814a59652b662ef143}{last\_pinged};
581         last\_pinged\_index = &onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num} - 1].
      \hyperlink{struct_onion___friend_a6e0a5214a3dffa151dd52dc4c230145b}{last\_pinged\_index};
582     \}
583 
584     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}, j;
585     \textcolor{keywordtype}{int} lan\_ips\_accepted = (\hyperlink{_l_a_n__discovery_8c_a2d80a53390598eb8ededbc63f4e9c152}{LAN\_ip}(source.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}) == 0);
586 
587     \textcolor{keywordflow}{for} (i = 0; i < num\_nodes; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
588 
589         \textcolor{keywordflow}{if} (!lan\_ips\_accepted)
590             \textcolor{keywordflow}{if} (\hyperlink{_l_a_n__discovery_8c_a2d80a53390598eb8ededbc63f4e9c152}{LAN\_ip}(nodes[i].ip\_port.ip) == 0)
591                 \textcolor{keywordflow}{continue};
592 
593         \textcolor{keywordflow}{if} (\hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(list\_nodes[0].timestamp, \hyperlink{onion__client_8h_a96ede75aa4a66f24cefc164af1d4e41d}{ONION\_NODE\_TIMEOUT})
594                 || \hyperlink{_d_h_t_8c_a903a5bc580826fe447adb841b7782333}{id\_closest}(reference\_id, list\_nodes[0].\hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, nodes[i].
      public\_key) == 2) \{
595             \textcolor{comment}{/* check if node is already in list. */}
596             \textcolor{keywordflow}{for} (j = 0; j < \hyperlink{onion__client_8h_ab1de7815e06277ced6779ba201b0b716}{MAX\_ONION\_CLIENTS}; ++j) \{
597                 \textcolor{keywordflow}{if} (memcmp(list\_nodes[j].\hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, nodes[i].public\_key, 
      crypto\_box\_PUBLICKEYBYTES) == 0) \{
598                     \textcolor{keywordflow}{break};
599                 \}
600             \}
601 
602             \textcolor{keywordflow}{if} (j == MAX\_ONION\_CLIENTS && \hyperlink{onion__client_8c_ad2e57716c800e26c60ee6e1c8c7c6bf1}{good\_to\_ping}(last\_pinged, last\_pinged\_index, nodes[i]
      .\hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key})) \{
603                 \hyperlink{onion__client_8c_a4253f1739f978c9aac584c97b7a55f48}{client\_send\_announce\_request}(onion\_c, 
      \hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num}, nodes[i].ip\_port, nodes[i].public\_key, NULL, ~0);
604             \}
605         \}
606     \}
607 
608     \textcolor{keywordflow}{return} 0;
609 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_a934df896ad375a9dbd82f563fb27144f_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_a934df896ad375a9dbd82f563fb27144f_icgraph}
\end{center}
\end{figure}


\hypertarget{onion__client_8c_a4253f1739f978c9aac584c97b7a55f48}{\index{onion\+\_\+client.\+c@{onion\+\_\+client.\+c}!client\+\_\+send\+\_\+announce\+\_\+request@{client\+\_\+send\+\_\+announce\+\_\+request}}
\index{client\+\_\+send\+\_\+announce\+\_\+request@{client\+\_\+send\+\_\+announce\+\_\+request}!onion\+\_\+client.\+c@{onion\+\_\+client.\+c}}
\subsubsection[{client\+\_\+send\+\_\+announce\+\_\+request}]{\setlength{\rightskip}{0pt plus 5cm}static int client\+\_\+send\+\_\+announce\+\_\+request (
\begin{DoxyParamCaption}
\item[{{\bf Onion\+\_\+\+Client} $\ast$}]{onion\+\_\+c, }
\item[{uint32\+\_\+t}]{num, }
\item[{{\bf I\+P\+\_\+\+Port}}]{dest, }
\item[{const uint8\+\_\+t $\ast$}]{dest\+\_\+pubkey, }
\item[{const uint8\+\_\+t $\ast$}]{ping\+\_\+id, }
\item[{uint32\+\_\+t}]{pathnum}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{onion__client_8c_a4253f1739f978c9aac584c97b7a55f48}


Definition at line 398 of file onion\+\_\+client.\+c.



References Onion\+\_\+\+Client\+::c, create\+\_\+announce\+\_\+request(), Onion\+\_\+\+Client\+::friends\+\_\+list, new\+\_\+sendback(), Onion\+\_\+\+Client\+::num\+\_\+friends, O\+N\+I\+O\+N\+\_\+\+A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+S\+I\+Z\+E, Onion\+\_\+\+Client\+::onion\+\_\+paths\+\_\+friends, Onion\+\_\+\+Client\+::onion\+\_\+paths\+\_\+self, O\+N\+I\+O\+N\+\_\+\+P\+I\+N\+G\+\_\+\+I\+D\+\_\+\+S\+I\+Z\+E, path, Onion\+\_\+\+Path\+::path\+\_\+num, random\+\_\+path(), Onion\+\_\+\+Friend\+::real\+\_\+public\+\_\+key, Net\+\_\+\+Crypto\+::self\+\_\+public\+\_\+key, Net\+\_\+\+Crypto\+::self\+\_\+secret\+\_\+key, send\+\_\+onion\+\_\+packet\+\_\+tcp\+\_\+udp(), Onion\+\_\+\+Friend\+::temp\+\_\+public\+\_\+key, Onion\+\_\+\+Client\+::temp\+\_\+public\+\_\+key, and Onion\+\_\+\+Friend\+::temp\+\_\+secret\+\_\+key.



Referenced by client\+\_\+ping\+\_\+nodes(), do\+\_\+announce(), and do\+\_\+friend().


\begin{DoxyCode}
400 \{
401     \textcolor{keywordflow}{if} (\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num} > onion\_c->\hyperlink{struct_onion___client_a8ee1f2d7e543bce350c591a8eaac0cf8}{num\_friends})
402         \textcolor{keywordflow}{return} -1;
403 
404     uint64\_t sendback;
405     \hyperlink{struct_onion___path}{Onion\_Path} \hyperlink{tox__sync_8c_a6f50c85874ef8f3405625e5a26febbcb}{path};
406 
407     \textcolor{keywordflow}{if} (\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num} == 0) \{
408         \textcolor{keywordflow}{if} (\hyperlink{onion__client_8c_a0ec6065dac34021e69682691f70b667c}{random\_path}(onion\_c, &onion\_c->\hyperlink{struct_onion___client_a917f02fe81d007c9668083e0ac9ff0c7}{onion\_paths\_self}, pathnum, &path) == 
      -1)
409             \textcolor{keywordflow}{return} -1;
410     \} \textcolor{keywordflow}{else} \{
411         \textcolor{keywordflow}{if} (\hyperlink{onion__client_8c_a0ec6065dac34021e69682691f70b667c}{random\_path}(onion\_c, &onion\_c->\hyperlink{struct_onion___client_a52bae59a292facb41ff98ea0efe8e68f}{onion\_paths\_friends}, pathnum, &
      path) == -1)
412             \textcolor{keywordflow}{return} -1;
413     \}
414 
415     \textcolor{keywordflow}{if} (\hyperlink{onion__client_8c_acf73e72ebf38831539c211179d5559b9}{new\_sendback}(onion\_c, \hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num}, dest\_pubkey, dest, path.
      \hyperlink{struct_onion___path_a6d69f3ea5100411c3599020055b8b78c}{path\_num}, &sendback) == -1)
416         \textcolor{keywordflow}{return} -1;
417 
418     uint8\_t zero\_ping\_id[\hyperlink{onion__announce_8h_a53426e5a269d092b0b862a3516549716}{ONION\_PING\_ID\_SIZE}] = \{0\};
419 
420     \textcolor{keywordflow}{if} (ping\_id == NULL)
421         ping\_id = zero\_ping\_id;
422 
423     uint8\_t request[\hyperlink{onion__announce_8h_a561fc355e3538d55f7206dea279bb04c}{ONION\_ANNOUNCE\_REQUEST\_SIZE}];
424     \textcolor{keywordtype}{int} len;
425 
426     \textcolor{keywordflow}{if} (\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num} == 0) \{
427         len = \hyperlink{onion__announce_8c_ad4ee12caef533a0866e8a746041c92d8}{create\_announce\_request}(request, \textcolor{keyword}{sizeof}(request), dest\_pubkey, onion\_c
      ->\hyperlink{struct_onion___client_a0f5b9349eb586149cef9017eed2abdfe}{c}->\hyperlink{struct_net___crypto_ae726df8bdc26380e5a6c3187a00d6881}{self\_public\_key},
428                                       onion\_c->\hyperlink{struct_onion___client_a0f5b9349eb586149cef9017eed2abdfe}{c}->\hyperlink{struct_net___crypto_aa05050f86513ff53fe9da81f73c72267}{self\_secret\_key}, ping\_id, onion\_c->
      \hyperlink{struct_onion___client_a0f5b9349eb586149cef9017eed2abdfe}{c}->\hyperlink{struct_net___crypto_ae726df8bdc26380e5a6c3187a00d6881}{self\_public\_key}, onion\_c->\hyperlink{struct_onion___client_afc342de3f1533c0adfd762a6fd0d20ab}{temp\_public\_key}, sendback);
429 
430     \} \textcolor{keywordflow}{else} \{
431         len = \hyperlink{onion__announce_8c_ad4ee12caef533a0866e8a746041c92d8}{create\_announce\_request}(request, \textcolor{keyword}{sizeof}(request), dest\_pubkey, onion\_c
      ->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num} - 1].\hyperlink{struct_onion___friend_afc342de3f1533c0adfd762a6fd0d20ab}{temp\_public\_key},
432                                       onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num} - 1].
      \hyperlink{struct_onion___friend_a6de303feb7b7892cc6a38228554b3e78}{temp\_secret\_key}, ping\_id, onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num} - 1].
      \hyperlink{struct_onion___friend_a996dcaefa2a5954a199e2beb584c1feb}{real\_public\_key}, zero\_ping\_id,
433                                       sendback);
434     \}
435 
436     \textcolor{keywordflow}{if} (len == -1) \{
437         \textcolor{keywordflow}{return} -1;
438     \}
439 
440     \textcolor{keywordflow}{return} \hyperlink{onion__client_8c_a4be9a76607f006a407f4f96dd49f25da}{send\_onion\_packet\_tcp\_udp}(onion\_c, &path, dest, request, len);
441 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_a4253f1739f978c9aac584c97b7a55f48_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_a4253f1739f978c9aac584c97b7a55f48_icgraph}
\end{center}
\end{figure}


\hypertarget{onion__client_8c_a8b4a60d685081d29b3b61256241acaf5}{\index{onion\+\_\+client.\+c@{onion\+\_\+client.\+c}!cmp\+\_\+entry@{cmp\+\_\+entry}}
\index{cmp\+\_\+entry@{cmp\+\_\+entry}!onion\+\_\+client.\+c@{onion\+\_\+client.\+c}}
\subsubsection[{cmp\+\_\+entry}]{\setlength{\rightskip}{0pt plus 5cm}static int cmp\+\_\+entry (
\begin{DoxyParamCaption}
\item[{const void $\ast$}]{a, }
\item[{const void $\ast$}]{b}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{onion__client_8c_a8b4a60d685081d29b3b61256241acaf5}


Definition at line 444 of file onion\+\_\+client.\+c.



References cmp\+\_\+public\+\_\+key, id\+\_\+closest(), is\+\_\+timeout(), O\+N\+I\+O\+N\+\_\+\+N\+O\+D\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T, Onion\+\_\+\+Node\+::public\+\_\+key, and Onion\+\_\+\+Node\+::timestamp.



Referenced by client\+\_\+add\+\_\+to\+\_\+list().


\begin{DoxyCode}
445 \{
446     \hyperlink{struct_onion___node}{Onion\_Node} entry1, entry2;
447     memcpy(&entry1, a, \textcolor{keyword}{sizeof}(\hyperlink{struct_onion___node}{Onion\_Node}));
448     memcpy(&entry2, b, \textcolor{keyword}{sizeof}(\hyperlink{struct_onion___node}{Onion\_Node}));
449     \textcolor{keywordtype}{int} t1 = \hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(entry1.\hyperlink{struct_onion___node_a465bef81f6478756e5443025b1f2ddfa}{timestamp}, \hyperlink{onion__client_8h_a96ede75aa4a66f24cefc164af1d4e41d}{ONION\_NODE\_TIMEOUT});
450     \textcolor{keywordtype}{int} t2 = \hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(entry2.\hyperlink{struct_onion___node_a465bef81f6478756e5443025b1f2ddfa}{timestamp}, \hyperlink{onion__client_8h_a96ede75aa4a66f24cefc164af1d4e41d}{ONION\_NODE\_TIMEOUT});
451 
452     \textcolor{keywordflow}{if} (t1 && t2)
453         \textcolor{keywordflow}{return} 0;
454 
455     \textcolor{keywordflow}{if} (t1)
456         \textcolor{keywordflow}{return} -1;
457 
458     \textcolor{keywordflow}{if} (t2)
459         \textcolor{keywordflow}{return} 1;
460 
461     \textcolor{keywordtype}{int} close = \hyperlink{_d_h_t_8c_a903a5bc580826fe447adb841b7782333}{id\_closest}(\hyperlink{onion__client_8c_a3551f15862efa7b58779722fe9763c45}{cmp\_public\_key}, entry1.
      \hyperlink{struct_onion___node_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, entry2.\hyperlink{struct_onion___node_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key});
462 
463     \textcolor{keywordflow}{if} (close == 1)
464         \textcolor{keywordflow}{return} 1;
465 
466     \textcolor{keywordflow}{if} (close == 2)
467         \textcolor{keywordflow}{return} -1;
468 
469     \textcolor{keywordflow}{return} 0;
470 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=335pt]{db/d79/onion__client_8c_a8b4a60d685081d29b3b61256241acaf5_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_a8b4a60d685081d29b3b61256241acaf5_icgraph}
\end{center}
\end{figure}


\hypertarget{onion__client_8c_ae37f00e2304222b24cef2cce370e58d3}{\index{onion\+\_\+client.\+c@{onion\+\_\+client.\+c}!do\+\_\+announce@{do\+\_\+announce}}
\index{do\+\_\+announce@{do\+\_\+announce}!onion\+\_\+client.\+c@{onion\+\_\+client.\+c}}
\subsubsection[{do\+\_\+announce}]{\setlength{\rightskip}{0pt plus 5cm}static void do\+\_\+announce (
\begin{DoxyParamCaption}
\item[{{\bf Onion\+\_\+\+Client} $\ast$}]{onion\+\_\+c}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{onion__client_8c_ae37f00e2304222b24cef2cce370e58d3}


Definition at line 1319 of file onion\+\_\+client.\+c.



References A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L\+\_\+\+A\+N\+N\+O\+U\+N\+C\+E\+D, A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L\+\_\+\+N\+O\+T\+\_\+\+A\+N\+N\+O\+U\+N\+C\+E\+D, client\+\_\+send\+\_\+announce\+\_\+request(), Onion\+\_\+\+Client\+::clients\+\_\+announce\+\_\+list, i, is\+\_\+timeout(), Onion\+\_\+\+Node\+::last\+\_\+pinged, M\+A\+X\+\_\+\+O\+N\+I\+O\+N\+\_\+\+C\+L\+I\+E\+N\+T\+S, M\+A\+X\+\_\+\+P\+A\+T\+H\+\_\+\+N\+O\+D\+E\+S, num, O\+N\+I\+O\+N\+\_\+\+N\+O\+D\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T, Onion\+\_\+\+Client\+::onion\+\_\+paths\+\_\+self, path\+\_\+exists(), Onion\+\_\+\+Client\+::path\+\_\+nodes, Onion\+\_\+\+Client\+::path\+\_\+nodes\+\_\+bs, Onion\+\_\+\+Client\+::path\+\_\+nodes\+\_\+index, Onion\+\_\+\+Client\+::path\+\_\+nodes\+\_\+index\+\_\+bs, Onion\+\_\+\+Node\+::path\+\_\+used, make-\/funny-\/savefile\+::public\+\_\+key, and unix\+\_\+time().



Referenced by do\+\_\+onion\+\_\+client().


\begin{DoxyCode}
1320 \{
1321     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}, count = 0;
1322     \hyperlink{struct_onion___node}{Onion\_Node} *list\_nodes = onion\_c->\hyperlink{struct_onion___client_a21a83b6615ce3ab53739031a355aeabd}{clients\_announce\_list};
1323 
1324     \textcolor{keywordflow}{for} (i = 0; i < \hyperlink{onion__client_8h_ab1de7815e06277ced6779ba201b0b716}{MAX\_ONION\_CLIENTS}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
1325         \textcolor{keywordflow}{if} (\hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(list\_nodes[i].timestamp, \hyperlink{onion__client_8h_a96ede75aa4a66f24cefc164af1d4e41d}{ONION\_NODE\_TIMEOUT}))
1326             \textcolor{keywordflow}{continue};
1327 
1328         ++count;
1329 
1330         \textcolor{comment}{/* Don't announce ourselves the first time this is run to new peers */}
1331         \textcolor{keywordflow}{if} (list\_nodes[i].last\_pinged == 0) \{
1332             list\_nodes[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}].\hyperlink{struct_onion___node_a4049204f6c392628d31be6c39f03e031}{last\_pinged} = 1;
1333             \textcolor{keywordflow}{continue};
1334         \}
1335 
1336         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} interval = \hyperlink{onion__client_8c_adde3021afad81f683c60bb00ab4ecbb6}{ANNOUNCE\_INTERVAL\_NOT\_ANNOUNCED};
1337 
1338         \textcolor{keywordflow}{if} (list\_nodes[i].is\_stored && \hyperlink{onion__client_8c_a359fb95e06e99e4a5e9391c7b9bafaa6}{path\_exists}(&onion\_c->
      \hyperlink{struct_onion___client_a917f02fe81d007c9668083e0ac9ff0c7}{onion\_paths\_self}, list\_nodes[i].\hyperlink{struct_onion___node_a75c3cb4fcbcf13c47379cc14737926d9}{path\_used})) \{
1339             interval = \hyperlink{onion__client_8c_a3793bf4bf316da2ae4d2ad5f2c8ab55a}{ANNOUNCE\_INTERVAL\_ANNOUNCED};
1340         \}
1341 
1342         \textcolor{keywordflow}{if} (\hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(list\_nodes[i].last\_pinged, interval)) \{
1343             \textcolor{keywordflow}{if} (\hyperlink{onion__client_8c_a4253f1739f978c9aac584c97b7a55f48}{client\_send\_announce\_request}(onion\_c, 0, list\_nodes[i].ip\_port,
       list\_nodes[i].\hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key},
1344                                              list\_nodes[i].ping\_id, list\_nodes[i].path\_used) == 0) \{
1345                 list\_nodes[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}].\hyperlink{struct_onion___node_a4049204f6c392628d31be6c39f03e031}{last\_pinged} = \hyperlink{util_8c_ac958d9f8847cb8039444bfa3d304233a}{unix\_time}();
1346             \}
1347         \}
1348     \}
1349 
1350     \textcolor{keywordflow}{if} (count != MAX\_ONION\_CLIENTS) \{
1351         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} num\_nodes;
1352         \hyperlink{struct_node__format}{Node\_format} *path\_nodes;
1353 
1354         \textcolor{keywordflow}{if} (rand() % 2 == 0 || onion\_c->\hyperlink{struct_onion___client_aaeb9402a72e98e04eb5cbc4ff0aac70e}{path\_nodes\_index} == 0) \{
1355             num\_nodes = (onion\_c->\hyperlink{struct_onion___client_aa6cb02170665d966dec231613d9d229e}{path\_nodes\_index\_bs} < 
      \hyperlink{onion__client_8h_ac5f0e3c41d8db63d3af45c98df53d719}{MAX\_PATH\_NODES}) ? onion\_c->\hyperlink{struct_onion___client_aa6cb02170665d966dec231613d9d229e}{path\_nodes\_index\_bs} : 
      \hyperlink{onion__client_8h_ac5f0e3c41d8db63d3af45c98df53d719}{MAX\_PATH\_NODES};
1356             path\_nodes = onion\_c->\hyperlink{struct_onion___client_adc82bddd48395ce29a9d609cd6f39a12}{path\_nodes\_bs};
1357         \} \textcolor{keywordflow}{else} \{
1358             num\_nodes = (onion\_c->\hyperlink{struct_onion___client_aaeb9402a72e98e04eb5cbc4ff0aac70e}{path\_nodes\_index} < 
      \hyperlink{onion__client_8h_ac5f0e3c41d8db63d3af45c98df53d719}{MAX\_PATH\_NODES}) ? onion\_c->\hyperlink{struct_onion___client_aaeb9402a72e98e04eb5cbc4ff0aac70e}{path\_nodes\_index} : 
      \hyperlink{onion__client_8h_ac5f0e3c41d8db63d3af45c98df53d719}{MAX\_PATH\_NODES};
1359             path\_nodes = onion\_c->\hyperlink{struct_onion___client_a1baee18cb7db8dad6b0847fa977b7f16}{path\_nodes};
1360         \}
1361 
1362         \textcolor{keywordflow}{if} (count < (uint32\_t)rand() % \hyperlink{onion__client_8h_ab1de7815e06277ced6779ba201b0b716}{MAX\_ONION\_CLIENTS}) \{
1363             \textcolor{keywordflow}{if} (num\_nodes != 0) \{
1364                 \textcolor{keywordflow}{for} (i = 0; i < (MAX\_ONION\_CLIENTS / 2); ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
1365                     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num} = rand() % num\_nodes;
1366                     \hyperlink{onion__client_8c_a4253f1739f978c9aac584c97b7a55f48}{client\_send\_announce\_request}(onion\_c, 0, path\_nodes[num].
      ip\_port, path\_nodes[num].\hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, 0, ~0);
1367                 \}
1368             \}
1369         \}
1370     \}
1371 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_ae37f00e2304222b24cef2cce370e58d3_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_ae37f00e2304222b24cef2cce370e58d3_icgraph}
\end{center}
\end{figure}


\hypertarget{onion__client_8c_a02301d507ab3c11bfee8112560f36f87}{\index{onion\+\_\+client.\+c@{onion\+\_\+client.\+c}!do\+\_\+friend@{do\+\_\+friend}}
\index{do\+\_\+friend@{do\+\_\+friend}!onion\+\_\+client.\+c@{onion\+\_\+client.\+c}}
\subsubsection[{do\+\_\+friend}]{\setlength{\rightskip}{0pt plus 5cm}static void do\+\_\+friend (
\begin{DoxyParamCaption}
\item[{{\bf Onion\+\_\+\+Client} $\ast$}]{onion\+\_\+c, }
\item[{uint16\+\_\+t}]{friendnum}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{onion__client_8c_a02301d507ab3c11bfee8112560f36f87}


Definition at line 1237 of file onion\+\_\+client.\+c.



References A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+F\+R\+I\+E\+N\+D, A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+B\+E\+G\+I\+N\+N\+I\+N\+G, client\+\_\+send\+\_\+announce\+\_\+request(), Onion\+\_\+\+Friend\+::clients\+\_\+list, D\+H\+T\+\_\+\+D\+H\+T\+P\+K\+\_\+\+S\+E\+N\+D\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L, F\+R\+I\+E\+N\+D\+\_\+\+O\+N\+I\+O\+N\+\_\+\+N\+O\+D\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T, Onion\+\_\+\+Client\+::friends\+\_\+list, i, Node\+\_\+format\+::ip\+\_\+port, Onion\+\_\+\+Friend\+::is\+\_\+online, is\+\_\+timeout(), Onion\+\_\+\+Friend\+::last\+\_\+dht\+\_\+pk\+\_\+dht\+\_\+sent, Onion\+\_\+\+Friend\+::last\+\_\+dht\+\_\+pk\+\_\+onion\+\_\+sent, Onion\+\_\+\+Node\+::last\+\_\+pinged, M\+A\+X\+\_\+\+O\+N\+I\+O\+N\+\_\+\+C\+L\+I\+E\+N\+T\+S, M\+A\+X\+\_\+\+P\+A\+T\+H\+\_\+\+N\+O\+D\+E\+S, num, Onion\+\_\+\+Client\+::num\+\_\+friends, O\+N\+I\+O\+N\+\_\+\+D\+H\+T\+P\+K\+\_\+\+S\+E\+N\+D\+\_\+\+I\+N\+T\+E\+R\+V\+A\+L, Onion\+\_\+\+Client\+::path\+\_\+nodes, Onion\+\_\+\+Client\+::path\+\_\+nodes\+\_\+index, make-\/funny-\/savefile\+::public\+\_\+key, Node\+\_\+format\+::public\+\_\+key, Onion\+\_\+\+Friend\+::run\+\_\+count, R\+U\+N\+\_\+\+C\+O\+U\+N\+T\+\_\+\+F\+R\+I\+E\+N\+D\+\_\+\+A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+B\+E\+G\+I\+N\+N\+I\+N\+G, send\+\_\+dhtpk\+\_\+announce(), Onion\+\_\+\+Friend\+::status, and unix\+\_\+time().



Referenced by do\+\_\+onion\+\_\+client().


\begin{DoxyCode}
1238 \{
1239     \textcolor{keywordflow}{if} (friendnum >= onion\_c->\hyperlink{struct_onion___client_a8ee1f2d7e543bce350c591a8eaac0cf8}{num\_friends})
1240         \textcolor{keywordflow}{return};
1241 
1242     \textcolor{keywordflow}{if} (onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[friendnum].\hyperlink{struct_onion___friend_ade818037fd6c985038ff29656089758d}{status} == 0)
1243         \textcolor{keywordflow}{return};
1244 
1245     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} interval = \hyperlink{onion__client_8c_a89562b3d1da87946099316523c47fc4f}{ANNOUNCE\_FRIEND};
1246 
1247     \textcolor{keywordflow}{if} (onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[friendnum].\hyperlink{struct_onion___friend_a9b6e91b90249c9b72d98611ba5ed7176}{run\_count} < 
      \hyperlink{onion__client_8c_acd0565214383a01ecc72df8ffbab884b}{RUN\_COUNT\_FRIEND\_ANNOUNCE\_BEGINNING})
1248         interval = \hyperlink{onion__client_8c_a3d4afef54c4c6134fc3d4024ec65ff61}{ANNOUNCE\_FRIEND\_BEGINNING};
1249 
1250     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}, count = 0;
1251     \hyperlink{struct_onion___node}{Onion\_Node} *list\_nodes = onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[friendnum].
      \hyperlink{struct_onion___friend_a6797ac2f59ba5ef59a8a70cd6515ca25}{clients\_list};
1252 
1253     \textcolor{keywordflow}{if} (!onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[friendnum].\hyperlink{struct_onion___friend_a6e539a068fed61fab47b62f467c1d208}{is\_online}) \{
1254         \textcolor{keywordflow}{for} (i = 0; i < \hyperlink{onion__client_8h_ab1de7815e06277ced6779ba201b0b716}{MAX\_ONION\_CLIENTS}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
1255             \textcolor{keywordflow}{if} (\hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(list\_nodes[i].timestamp, 
      \hyperlink{onion__client_8c_adb819c7e131c2c65764b9cf92eb73e65}{FRIEND\_ONION\_NODE\_TIMEOUT}))
1256                 \textcolor{keywordflow}{continue};
1257 
1258             ++count;
1259 
1260 
1261             \textcolor{keywordflow}{if} (list\_nodes[i].last\_pinged == 0) \{
1262                 list\_nodes[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}].\hyperlink{struct_onion___node_a4049204f6c392628d31be6c39f03e031}{last\_pinged} = \hyperlink{util_8c_ac958d9f8847cb8039444bfa3d304233a}{unix\_time}();
1263                 \textcolor{keywordflow}{continue};
1264             \}
1265 
1266             \textcolor{keywordflow}{if} (\hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(list\_nodes[i].last\_pinged, interval)) \{
1267                 \textcolor{keywordflow}{if} (\hyperlink{onion__client_8c_a4253f1739f978c9aac584c97b7a55f48}{client\_send\_announce\_request}(onion\_c, friendnum + 1, 
      list\_nodes[i].ip\_port, list\_nodes[i].\hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, 0, ~0) == 0) \{
1268                     list\_nodes[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}].\hyperlink{struct_onion___node_a4049204f6c392628d31be6c39f03e031}{last\_pinged} = \hyperlink{util_8c_ac958d9f8847cb8039444bfa3d304233a}{unix\_time}();
1269                 \}
1270             \}
1271         \}
1272 
1273         \textcolor{keywordflow}{if} (count != MAX\_ONION\_CLIENTS) \{
1274             \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} num\_nodes = (onion\_c->\hyperlink{struct_onion___client_aaeb9402a72e98e04eb5cbc4ff0aac70e}{path\_nodes\_index} < 
      \hyperlink{onion__client_8h_ac5f0e3c41d8db63d3af45c98df53d719}{MAX\_PATH\_NODES}) ? onion\_c->\hyperlink{struct_onion___client_aaeb9402a72e98e04eb5cbc4ff0aac70e}{path\_nodes\_index} : 
      \hyperlink{onion__client_8h_ac5f0e3c41d8db63d3af45c98df53d719}{MAX\_PATH\_NODES};
1275 
1276             \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} n = num\_nodes;
1277 
1278             if (num\_nodes > (MAX\_ONION\_CLIENTS / 2))
1279                 n = (MAX\_ONION\_CLIENTS / 2);
1280 
1281             \textcolor{keywordflow}{if} (num\_nodes != 0) \{
1282                 \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} j;
1283 
1284                 \textcolor{keywordflow}{for} (j = 0; j < n; ++j) \{
1285                     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num} = rand() % num\_nodes;
1286                     \hyperlink{onion__client_8c_a4253f1739f978c9aac584c97b7a55f48}{client\_send\_announce\_request}(onion\_c, friendnum + 1, 
      onion\_c->\hyperlink{struct_onion___client_a1baee18cb7db8dad6b0847fa977b7f16}{path\_nodes}[num].\hyperlink{struct_node__format_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port},
1287                                                  onion\_c->\hyperlink{struct_onion___client_a1baee18cb7db8dad6b0847fa977b7f16}{path\_nodes}[num].
      \hyperlink{struct_node__format_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, 0, ~0);
1288                 \}
1289 
1290                 ++onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[friendnum].\hyperlink{struct_onion___friend_a9b6e91b90249c9b72d98611ba5ed7176}{run\_count};
1291             \}
1292         \} \textcolor{keywordflow}{else} \{
1293             ++onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[friendnum].\hyperlink{struct_onion___friend_a9b6e91b90249c9b72d98611ba5ed7176}{run\_count};
1294         \}
1295 
1296         \textcolor{comment}{/* send packets to friend telling them our DHT public key. */}
1297         \textcolor{keywordflow}{if} (\hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[friendnum].
      \hyperlink{struct_onion___friend_ac83f72b06d86503ee29943ccbe7f1a7a}{last\_dht\_pk\_onion\_sent}, \hyperlink{onion__client_8h_afdf828ede726b2356e8202c493a8e6bc}{ONION\_DHTPK\_SEND\_INTERVAL}))
1298             \textcolor{keywordflow}{if} (\hyperlink{onion__client_8c_a64e317f7dd22c983c325f62aed9ecfae}{send\_dhtpk\_announce}(onion\_c, friendnum, 0) >= 1)
1299                 onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[friendnum].
      \hyperlink{struct_onion___friend_ac83f72b06d86503ee29943ccbe7f1a7a}{last\_dht\_pk\_onion\_sent} = \hyperlink{util_8c_ac958d9f8847cb8039444bfa3d304233a}{unix\_time}();
1300 
1301         \textcolor{keywordflow}{if} (\hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[friendnum].
      \hyperlink{struct_onion___friend_a412168e37e1bdf5545f814c9c487aaeb}{last\_dht\_pk\_dht\_sent}, \hyperlink{onion__client_8h_a6a4b332acde8b07da83ebe0e2e27b121}{DHT\_DHTPK\_SEND\_INTERVAL}))
1302             \textcolor{keywordflow}{if} (\hyperlink{onion__client_8c_a64e317f7dd22c983c325f62aed9ecfae}{send\_dhtpk\_announce}(onion\_c, friendnum, 1) >= 1)
1303                 onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[friendnum].
      \hyperlink{struct_onion___friend_a412168e37e1bdf5545f814c9c487aaeb}{last\_dht\_pk\_dht\_sent} = \hyperlink{util_8c_ac958d9f8847cb8039444bfa3d304233a}{unix\_time}();
1304 
1305     \}
1306 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_a02301d507ab3c11bfee8112560f36f87_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_a02301d507ab3c11bfee8112560f36f87_icgraph}
\end{center}
\end{figure}


\hypertarget{onion__client_8c_aa1771a7c1ebf446973e8d2bbb7ea8c2d}{\index{onion\+\_\+client.\+c@{onion\+\_\+client.\+c}!do\+\_\+onion\+\_\+client@{do\+\_\+onion\+\_\+client}}
\index{do\+\_\+onion\+\_\+client@{do\+\_\+onion\+\_\+client}!onion\+\_\+client.\+c@{onion\+\_\+client.\+c}}
\subsubsection[{do\+\_\+onion\+\_\+client}]{\setlength{\rightskip}{0pt plus 5cm}void do\+\_\+onion\+\_\+client (
\begin{DoxyParamCaption}
\item[{{\bf Onion\+\_\+\+Client} $\ast$}]{onion\+\_\+c}
\end{DoxyParamCaption}
)}}\label{onion__client_8c_aa1771a7c1ebf446973e8d2bbb7ea8c2d}


Definition at line 1431 of file onion\+\_\+client.\+c.



References Onion\+\_\+\+Client\+::c, Onion\+\_\+\+Client\+::dht, D\+H\+T\+\_\+non\+\_\+lan\+\_\+connected(), do\+\_\+announce(), do\+\_\+friend(), Onion\+\_\+\+Client\+::first\+\_\+run, get\+\_\+random\+\_\+tcp\+\_\+onion\+\_\+conn\+\_\+number(), i, is\+\_\+timeout(), Onion\+\_\+\+Client\+::last\+\_\+run, Onion\+\_\+\+Client\+::num\+\_\+friends, Onion\+\_\+\+Client\+::onion\+\_\+connected, O\+N\+I\+O\+N\+\_\+\+C\+O\+N\+N\+E\+C\+T\+I\+O\+N\+\_\+\+S\+E\+C\+O\+N\+D\+S, onion\+\_\+connection\+\_\+status(), onion\+\_\+isconnected(), populate\+\_\+path\+\_\+nodes(), populate\+\_\+path\+\_\+nodes\+\_\+tcp(), set\+\_\+tcp\+\_\+onion\+\_\+status(), Net\+\_\+\+Crypto\+::tcp\+\_\+c, Onion\+\_\+\+Client\+::\+U\+D\+P\+\_\+connected, and unix\+\_\+time().



Referenced by do\+\_\+messenger(), and do\+\_\+onions().


\begin{DoxyCode}
1432 \{
1433     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
1434 
1435     \textcolor{keywordflow}{if} (onion\_c->\hyperlink{struct_onion___client_a73e8197b772061572cb931a378ade3e4}{last\_run} == \hyperlink{util_8c_ac958d9f8847cb8039444bfa3d304233a}{unix\_time}())
1436         \textcolor{keywordflow}{return};
1437 
1438     \hyperlink{onion__client_8c_a18daedee61cc5670d52904fc89e4b32b}{populate\_path\_nodes}(onion\_c);
1439 
1440     \hyperlink{onion__client_8c_ae37f00e2304222b24cef2cce370e58d3}{do\_announce}(onion\_c);
1441 
1442     \textcolor{keywordflow}{if} (\hyperlink{onion__client_8c_a431d923b0d1456565facb61cf7409af2}{onion\_isconnected}(onion\_c)) \{
1443         \textcolor{keywordflow}{if} (onion\_c->\hyperlink{struct_onion___client_a1a57f09aaa51824a5069ba1503d52513}{onion\_connected} < \hyperlink{onion__client_8c_a14673162b8f41519787e7c18e6806e59}{ONION\_CONNECTION\_SECONDS} * 2)
       \{
1444             ++onion\_c->\hyperlink{struct_onion___client_a1a57f09aaa51824a5069ba1503d52513}{onion\_connected};
1445         \}
1446 
1447     \} \textcolor{keywordflow}{else} \{
1448         \hyperlink{onion__client_8c_aa10b37a1195f854626985f6707487b2c}{populate\_path\_nodes\_tcp}(onion\_c);
1449 
1450         \textcolor{keywordflow}{if} (onion\_c->\hyperlink{struct_onion___client_a1a57f09aaa51824a5069ba1503d52513}{onion\_connected} != 0) \{
1451             --onion\_c->\hyperlink{struct_onion___client_a1a57f09aaa51824a5069ba1503d52513}{onion\_connected};
1452         \}
1453     \}
1454 
1455     \_Bool UDP\_connected = \hyperlink{_d_h_t_8c_a90cd93b83fdec619c4924fd20c4fc005}{DHT\_non\_lan\_connected}(onion\_c->
      \hyperlink{struct_onion___client_a8b3d6ce8745acc52695e252bdb1531b6}{dht});
1456 
1457     \textcolor{keywordflow}{if} (\hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(onion\_c->\hyperlink{struct_onion___client_abd365b47c75ee96603245d7137d6e21c}{first\_run}, 
      \hyperlink{onion__client_8c_a14673162b8f41519787e7c18e6806e59}{ONION\_CONNECTION\_SECONDS})) \{
1458         \hyperlink{_t_c_p__connection_8c_a4ee7de722248f32b3bfedb25bdb59994}{set\_tcp\_onion\_status}(onion\_c->\hyperlink{struct_onion___client_a0f5b9349eb586149cef9017eed2abdfe}{c}->\hyperlink{struct_net___crypto_a179982a02be89eaf6617ed81bd3c0961}{tcp\_c}, !UDP\_connected);
1459     \}
1460 
1461     onion\_c->\hyperlink{struct_onion___client_ab561b9f2ae6e811457653ddacc1e7f6c}{UDP\_connected} = UDP\_connected
1462                              || \hyperlink{_t_c_p__connection_8c_a84992bb55c148bb9f7a1b442d255865f}{get\_random\_tcp\_onion\_conn\_number}(onion\_c->
      \hyperlink{struct_onion___client_a0f5b9349eb586149cef9017eed2abdfe}{c}->\hyperlink{struct_net___crypto_a179982a02be89eaf6617ed81bd3c0961}{tcp\_c}) == -1; \textcolor{comment}{/* Check if connected to any TCP relays. */}
1463 
1464     \textcolor{keywordflow}{if} (\hyperlink{onion__client_8c_a851cc0015a7360b9abfb7d92b997b2b4}{onion\_connection\_status}(onion\_c)) \{
1465         \textcolor{keywordflow}{for} (i = 0; i < onion\_c->\hyperlink{struct_onion___client_a8ee1f2d7e543bce350c591a8eaac0cf8}{num\_friends}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
1466             \hyperlink{onion__client_8c_a02301d507ab3c11bfee8112560f36f87}{do\_friend}(onion\_c, i);
1467         \}
1468     \}
1469 
1470     \textcolor{keywordflow}{if} (onion\_c->\hyperlink{struct_onion___client_a73e8197b772061572cb931a378ade3e4}{last\_run} == 0) \{
1471         onion\_c->\hyperlink{struct_onion___client_abd365b47c75ee96603245d7137d6e21c}{first\_run} = \hyperlink{util_8c_ac958d9f8847cb8039444bfa3d304233a}{unix\_time}();
1472     \}
1473 
1474     onion\_c->\hyperlink{struct_onion___client_a73e8197b772061572cb931a378ade3e4}{last\_run} = \hyperlink{util_8c_ac958d9f8847cb8039444bfa3d304233a}{unix\_time}();
1475 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_aa1771a7c1ebf446973e8d2bbb7ea8c2d_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_aa1771a7c1ebf446973e8d2bbb7ea8c2d_icgraph}
\end{center}
\end{figure}


\hypertarget{onion__client_8c_ad2e57716c800e26c60ee6e1c8c7c6bf1}{\index{onion\+\_\+client.\+c@{onion\+\_\+client.\+c}!good\+\_\+to\+\_\+ping@{good\+\_\+to\+\_\+ping}}
\index{good\+\_\+to\+\_\+ping@{good\+\_\+to\+\_\+ping}!onion\+\_\+client.\+c@{onion\+\_\+client.\+c}}
\subsubsection[{good\+\_\+to\+\_\+ping}]{\setlength{\rightskip}{0pt plus 5cm}static int good\+\_\+to\+\_\+ping (
\begin{DoxyParamCaption}
\item[{{\bf Last\+\_\+\+Pinged} $\ast$}]{last\+\_\+pinged, }
\item[{uint8\+\_\+t $\ast$}]{last\+\_\+pinged\+\_\+index, }
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{onion__client_8c_ad2e57716c800e26c60ee6e1c8c7c6bf1}


Definition at line 541 of file onion\+\_\+client.\+c.



References i, is\+\_\+timeout(), M\+A\+X\+\_\+\+S\+T\+O\+R\+E\+D\+\_\+\+P\+I\+N\+G\+E\+D\+\_\+\+N\+O\+D\+E\+S, M\+I\+N\+\_\+\+N\+O\+D\+E\+\_\+\+P\+I\+N\+G\+\_\+\+T\+I\+M\+E, Last\+\_\+\+Pinged\+::timestamp, and unix\+\_\+time().



Referenced by client\+\_\+ping\+\_\+nodes().


\begin{DoxyCode}
542 \{
543     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
544 
545     \textcolor{keywordflow}{for} (i = 0; i < \hyperlink{onion__client_8h_a95b6f5386cd87cd64fcee1c2b7ee2a31}{MAX\_STORED\_PINGED\_NODES}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
546         \textcolor{keywordflow}{if} (!\hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(last\_pinged[i].timestamp, \hyperlink{onion__client_8h_aa452040b89e169a7fa8f270183f10022}{MIN\_NODE\_PING\_TIME}))
547             \textcolor{keywordflow}{if} (memcmp(last\_pinged[i].\hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, public\_key, crypto\_box\_PUBLICKEYBYTES) == 0)
548                 \textcolor{keywordflow}{return} 0;
549     \}
550 
551     memcpy(last\_pinged[*last\_pinged\_index % MAX\_STORED\_PINGED\_NODES].\hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, public\_key, 
      crypto\_box\_PUBLICKEYBYTES);
552     last\_pinged[*last\_pinged\_index % \hyperlink{onion__client_8h_a95b6f5386cd87cd64fcee1c2b7ee2a31}{MAX\_STORED\_PINGED\_NODES}].
      \hyperlink{struct_last___pinged_a465bef81f6478756e5443025b1f2ddfa}{timestamp} = \hyperlink{util_8c_ac958d9f8847cb8039444bfa3d304233a}{unix\_time}();
553     ++*last\_pinged\_index;
554     \textcolor{keywordflow}{return} 1;
555 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=347pt]{db/d79/onion__client_8c_ad2e57716c800e26c60ee6e1c8c7c6bf1_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_ad2e57716c800e26c60ee6e1c8c7c6bf1_icgraph}
\end{center}
\end{figure}


\hypertarget{onion__client_8c_acef82e3853e62dce8cd45450ff028f97}{\index{onion\+\_\+client.\+c@{onion\+\_\+client.\+c}!handle\+\_\+announce\+\_\+response@{handle\+\_\+announce\+\_\+response}}
\index{handle\+\_\+announce\+\_\+response@{handle\+\_\+announce\+\_\+response}!onion\+\_\+client.\+c@{onion\+\_\+client.\+c}}
\subsubsection[{handle\+\_\+announce\+\_\+response}]{\setlength{\rightskip}{0pt plus 5cm}static int handle\+\_\+announce\+\_\+response (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{object, }
\item[{{\bf I\+P\+\_\+\+Port}}]{source, }
\item[{const uint8\+\_\+t $\ast$}]{packet, }
\item[{uint16\+\_\+t}]{length}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{onion__client_8c_acef82e3853e62dce8cd45450ff028f97}


Definition at line 611 of file onion\+\_\+client.\+c.



References Onion\+\_\+\+Client\+::c, check\+\_\+sendback(), client\+\_\+add\+\_\+to\+\_\+list(), client\+\_\+ping\+\_\+nodes(), decrypt\+\_\+data(), Onion\+\_\+\+Client\+::friends\+\_\+list, Onion\+\_\+\+Client\+::last\+\_\+packet\+\_\+recv, M\+A\+X\+\_\+\+S\+E\+N\+T\+\_\+\+N\+O\+D\+E\+S, num, Onion\+\_\+\+Client\+::num\+\_\+friends, O\+N\+I\+O\+N\+\_\+\+A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+R\+E\+S\+P\+O\+N\+S\+E\+\_\+\+M\+A\+X\+\_\+\+S\+I\+Z\+E, O\+N\+I\+O\+N\+\_\+\+A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+R\+E\+S\+P\+O\+N\+S\+E\+\_\+\+M\+I\+N\+\_\+\+S\+I\+Z\+E, O\+N\+I\+O\+N\+\_\+\+A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+S\+E\+N\+D\+B\+A\+C\+K\+\_\+\+D\+A\+T\+A\+\_\+\+L\+E\+N\+G\+T\+H, O\+N\+I\+O\+N\+\_\+\+P\+I\+N\+G\+\_\+\+I\+D\+\_\+\+S\+I\+Z\+E, make-\/funny-\/savefile\+::public\+\_\+key, Net\+\_\+\+Crypto\+::self\+\_\+secret\+\_\+key, Onion\+\_\+\+Friend\+::status, Onion\+\_\+\+Friend\+::temp\+\_\+secret\+\_\+key, unix\+\_\+time(), and unpack\+\_\+nodes().



Referenced by handle\+\_\+tcp\+\_\+onion(), and new\+\_\+onion\+\_\+client().


\begin{DoxyCode}
612 \{
613     \hyperlink{struct_onion___client}{Onion\_Client} *onion\_c = object;
614 
615     \textcolor{keywordflow}{if} (length < ONION\_ANNOUNCE\_RESPONSE\_MIN\_SIZE || length > 
      \hyperlink{onion__announce_8h_ab13ab0a532ac4dbc33d3e927f7a86aff}{ONION\_ANNOUNCE\_RESPONSE\_MAX\_SIZE})
616         \textcolor{keywordflow}{return} 1;
617 
618     uint16\_t len\_nodes = length - \hyperlink{onion__announce_8h_ae9fed00b9581eaec767c1bdf4e5645e7}{ONION\_ANNOUNCE\_RESPONSE\_MIN\_SIZE};
619 
620     uint8\_t \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}[crypto\_box\_PUBLICKEYBYTES];
621     \hyperlink{struct_i_p___port}{IP\_Port} ip\_port;
622     uint32\_t path\_num;
623     uint32\_t \hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num} = \hyperlink{onion__client_8c_a10e005a8f58bdbec1322c8ae599bad6c}{check\_sendback}(onion\_c, packet + 1, public\_key, &ip\_port, &path\_num);
624 
625     \textcolor{keywordflow}{if} (num > onion\_c->\hyperlink{struct_onion___client_a8ee1f2d7e543bce350c591a8eaac0cf8}{num\_friends})
626         \textcolor{keywordflow}{return} 1;
627 
628     uint8\_t plain[1 + \hyperlink{onion__announce_8h_a53426e5a269d092b0b862a3516549716}{ONION\_PING\_ID\_SIZE} + len\_nodes];
629     \textcolor{keywordtype}{int} len = -1;
630 
631     \textcolor{keywordflow}{if} (num == 0) \{
632         len = \hyperlink{crypto__core_8c_ab0aff79180f3852c24ad8f6fd88caf18}{decrypt\_data}(public\_key, onion\_c->\hyperlink{struct_onion___client_a0f5b9349eb586149cef9017eed2abdfe}{c}->\hyperlink{struct_net___crypto_aa05050f86513ff53fe9da81f73c72267}{self\_secret\_key}, packet + 1 
      + \hyperlink{onion__announce_8h_ab9b62113adfb38a74f55b0688c7f306b}{ONION\_ANNOUNCE\_SENDBACK\_DATA\_LENGTH},
633                            packet + 1 + \hyperlink{onion__announce_8h_ab9b62113adfb38a74f55b0688c7f306b}{ONION\_ANNOUNCE\_SENDBACK\_DATA\_LENGTH}
       + crypto\_box\_NONCEBYTES,
634                            length - (1 + \hyperlink{onion__announce_8h_ab9b62113adfb38a74f55b0688c7f306b}{ONION\_ANNOUNCE\_SENDBACK\_DATA\_LENGTH}
       + crypto\_box\_NONCEBYTES), plain);
635     \} \textcolor{keywordflow}{else} \{
636         \textcolor{keywordflow}{if} (onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[num - 1].\hyperlink{struct_onion___friend_ade818037fd6c985038ff29656089758d}{status} == 0)
637             \textcolor{keywordflow}{return} 1;
638 
639         len = \hyperlink{crypto__core_8c_ab0aff79180f3852c24ad8f6fd88caf18}{decrypt\_data}(public\_key, onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[num - 1].
      \hyperlink{struct_onion___friend_a6de303feb7b7892cc6a38228554b3e78}{temp\_secret\_key},
640                            packet + 1 + \hyperlink{onion__announce_8h_ab9b62113adfb38a74f55b0688c7f306b}{ONION\_ANNOUNCE\_SENDBACK\_DATA\_LENGTH}
      ,
641                            packet + 1 + \hyperlink{onion__announce_8h_ab9b62113adfb38a74f55b0688c7f306b}{ONION\_ANNOUNCE\_SENDBACK\_DATA\_LENGTH}
       + crypto\_box\_NONCEBYTES,
642                            length - (1 + \hyperlink{onion__announce_8h_ab9b62113adfb38a74f55b0688c7f306b}{ONION\_ANNOUNCE\_SENDBACK\_DATA\_LENGTH}
       + crypto\_box\_NONCEBYTES), plain);
643     \}
644 
645     \textcolor{keywordflow}{if} ((uint32\_t)len != \textcolor{keyword}{sizeof}(plain))
646         \textcolor{keywordflow}{return} 1;
647 
648     \textcolor{keywordflow}{if} (\hyperlink{onion__client_8c_a4f1e9a581f96d31f2f822ca6be9cc0eb}{client\_add\_to\_list}(onion\_c, num, public\_key, ip\_port, plain[0], plain + 1, 
      path\_num) == -1)
649         \textcolor{keywordflow}{return} 1;
650 
651     \textcolor{keywordflow}{if} (len\_nodes != 0) \{
652         \hyperlink{struct_node__format}{Node\_format} nodes[\hyperlink{_d_h_t_8h_a57f4cf16e79a384d7d59a3cc585ea5a3}{MAX\_SENT\_NODES}];
653         \textcolor{keywordtype}{int} num\_nodes = \hyperlink{_d_h_t_8c_a45b33af842c0289c78c70f81e854ed62}{unpack\_nodes}(nodes, \hyperlink{_d_h_t_8h_a57f4cf16e79a384d7d59a3cc585ea5a3}{MAX\_SENT\_NODES}, 0, plain + 1 + 
      \hyperlink{onion__announce_8h_a53426e5a269d092b0b862a3516549716}{ONION\_PING\_ID\_SIZE}, len\_nodes, 0);
654 
655         \textcolor{keywordflow}{if} (num\_nodes <= 0)
656             \textcolor{keywordflow}{return} 1;
657 
658         \textcolor{keywordflow}{if} (\hyperlink{onion__client_8c_a934df896ad375a9dbd82f563fb27144f}{client\_ping\_nodes}(onion\_c, num, nodes, num\_nodes, source) == -1)
659             \textcolor{keywordflow}{return} 1;
660     \}
661 
662     \textcolor{comment}{//TODO: LAN vs non LAN ips?, if we are connected only to LAN, are we offline?}
663     onion\_c->\hyperlink{struct_onion___client_ace034948b31137d0ad356f59a3d08af5}{last\_packet\_recv} = \hyperlink{util_8c_ac958d9f8847cb8039444bfa3d304233a}{unix\_time}();
664     \textcolor{keywordflow}{return} 0;
665 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_acef82e3853e62dce8cd45450ff028f97_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_acef82e3853e62dce8cd45450ff028f97_icgraph}
\end{center}
\end{figure}


\hypertarget{onion__client_8c_a6b443c4d4d5f83acb988fad87d2c1054}{\index{onion\+\_\+client.\+c@{onion\+\_\+client.\+c}!handle\+\_\+data\+\_\+response@{handle\+\_\+data\+\_\+response}}
\index{handle\+\_\+data\+\_\+response@{handle\+\_\+data\+\_\+response}!onion\+\_\+client.\+c@{onion\+\_\+client.\+c}}
\subsubsection[{handle\+\_\+data\+\_\+response}]{\setlength{\rightskip}{0pt plus 5cm}static int handle\+\_\+data\+\_\+response (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{object, }
\item[{{\bf I\+P\+\_\+\+Port}}]{source, }
\item[{const uint8\+\_\+t $\ast$}]{packet, }
\item[{uint16\+\_\+t}]{length}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{onion__client_8c_a6b443c4d4d5f83acb988fad87d2c1054}


Definition at line 669 of file onion\+\_\+client.\+c.



References Onion\+\_\+\+Client\+::c, D\+A\+T\+A\+\_\+\+I\+N\+\_\+\+R\+E\+S\+P\+O\+N\+S\+E\+\_\+\+M\+I\+N\+\_\+\+S\+I\+Z\+E, decrypt\+\_\+data(), Onion\+\_\+\+Client\+::function, M\+A\+X\+\_\+\+D\+A\+T\+A\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+S\+I\+Z\+E, Onion\+\_\+\+Client\+::object, Onion\+\_\+\+Client\+::\+Onion\+\_\+\+Data\+\_\+\+Handlers, O\+N\+I\+O\+N\+\_\+\+D\+A\+T\+A\+\_\+\+R\+E\+S\+P\+O\+N\+S\+E\+\_\+\+M\+I\+N\+\_\+\+S\+I\+Z\+E, Net\+\_\+\+Crypto\+::self\+\_\+secret\+\_\+key, and Onion\+\_\+\+Client\+::temp\+\_\+secret\+\_\+key.



Referenced by handle\+\_\+tcp\+\_\+onion(), and new\+\_\+onion\+\_\+client().


\begin{DoxyCode}
670 \{
671     \hyperlink{struct_onion___client}{Onion\_Client} *onion\_c = object;
672 
673     \textcolor{keywordflow}{if} (length <= (\hyperlink{onion__announce_8h_af73b9fe6a26072679b1ddecb166f2467}{ONION\_DATA\_RESPONSE\_MIN\_SIZE} + 
      \hyperlink{onion__client_8c_ab7a046054431d84cc9e9c0404ebc5002}{DATA\_IN\_RESPONSE\_MIN\_SIZE}))
674         \textcolor{keywordflow}{return} 1;
675 
676     \textcolor{keywordflow}{if} (length > \hyperlink{onion__announce_8h_a31078d9d153443e3ca9b750308d2f5b2}{MAX\_DATA\_REQUEST\_SIZE})
677         \textcolor{keywordflow}{return} 1;
678 
679     uint8\_t temp\_plain[length - \hyperlink{onion__announce_8h_af73b9fe6a26072679b1ddecb166f2467}{ONION\_DATA\_RESPONSE\_MIN\_SIZE}];
680     \textcolor{keywordtype}{int} len = \hyperlink{crypto__core_8c_ab0aff79180f3852c24ad8f6fd88caf18}{decrypt\_data}(packet + 1 + crypto\_box\_NONCEBYTES, onion\_c->
      \hyperlink{struct_onion___client_a6de303feb7b7892cc6a38228554b3e78}{temp\_secret\_key}, packet + 1,
681                            packet + 1 + crypto\_box\_NONCEBYTES + crypto\_box\_PUBLICKEYBYTES,
682                            length - (1 + crypto\_box\_NONCEBYTES + crypto\_box\_PUBLICKEYBYTES), temp\_plain);
683 
684     \textcolor{keywordflow}{if} ((uint32\_t)len != \textcolor{keyword}{sizeof}(temp\_plain))
685         \textcolor{keywordflow}{return} 1;
686 
687     uint8\_t plain[\textcolor{keyword}{sizeof}(temp\_plain) - \hyperlink{onion__client_8c_ab7a046054431d84cc9e9c0404ebc5002}{DATA\_IN\_RESPONSE\_MIN\_SIZE}];
688     len = \hyperlink{crypto__core_8c_ab0aff79180f3852c24ad8f6fd88caf18}{decrypt\_data}(temp\_plain, onion\_c->\hyperlink{struct_onion___client_a0f5b9349eb586149cef9017eed2abdfe}{c}->\hyperlink{struct_net___crypto_aa05050f86513ff53fe9da81f73c72267}{self\_secret\_key}, packet + 1, 
      temp\_plain + crypto\_box\_PUBLICKEYBYTES,
689                        \textcolor{keyword}{sizeof}(temp\_plain) - crypto\_box\_PUBLICKEYBYTES, plain);
690 
691     \textcolor{keywordflow}{if} ((uint32\_t)len != \textcolor{keyword}{sizeof}(plain))
692         \textcolor{keywordflow}{return} 1;
693 
694     \textcolor{keywordflow}{if} (!onion\_c->\hyperlink{struct_onion___client_a8576150a4360326b1a759d4bfc7c5e59}{Onion\_Data\_Handlers}[plain[0]].\hyperlink{struct_onion___client_a016f61b22111ceb83b172007e8135e73}{function})
695         \textcolor{keywordflow}{return} 1;
696 
697     \textcolor{keywordflow}{return} onion\_c->\hyperlink{struct_onion___client_a8576150a4360326b1a759d4bfc7c5e59}{Onion\_Data\_Handlers}[plain[0]].\hyperlink{struct_onion___client_a016f61b22111ceb83b172007e8135e73}{function}(onion\_c->
      \hyperlink{struct_onion___client_a8576150a4360326b1a759d4bfc7c5e59}{Onion\_Data\_Handlers}[plain[0]].\hyperlink{struct_onion___client_a077376d12464f945e2414d5499c79b3f}{object}, temp\_plain, plain,
698             \textcolor{keyword}{sizeof}(plain));
699 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_a6b443c4d4d5f83acb988fad87d2c1054_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_a6b443c4d4d5f83acb988fad87d2c1054_icgraph}
\end{center}
\end{figure}


\hypertarget{onion__client_8c_a0686761fa3196a2bded47c2b95c7edc4}{\index{onion\+\_\+client.\+c@{onion\+\_\+client.\+c}!handle\+\_\+dht\+\_\+dhtpk@{handle\+\_\+dht\+\_\+dhtpk}}
\index{handle\+\_\+dht\+\_\+dhtpk@{handle\+\_\+dht\+\_\+dhtpk}!onion\+\_\+client.\+c@{onion\+\_\+client.\+c}}
\subsubsection[{handle\+\_\+dht\+\_\+dhtpk}]{\setlength{\rightskip}{0pt plus 5cm}static int handle\+\_\+dht\+\_\+dhtpk (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{object, }
\item[{{\bf I\+P\+\_\+\+Port}}]{source, }
\item[{const uint8\+\_\+t $\ast$}]{source\+\_\+pubkey, }
\item[{const uint8\+\_\+t $\ast$}]{packet, }
\item[{uint16\+\_\+t}]{length}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{onion__client_8c_a0686761fa3196a2bded47c2b95c7edc4}


Definition at line 888 of file onion\+\_\+client.\+c.



References Onion\+\_\+\+Client\+::c, D\+A\+T\+A\+\_\+\+I\+N\+\_\+\+R\+E\+S\+P\+O\+N\+S\+E\+\_\+\+M\+I\+N\+\_\+\+S\+I\+Z\+E, decrypt\+\_\+data(), D\+H\+T\+P\+K\+\_\+\+D\+A\+T\+A\+\_\+\+M\+A\+X\+\_\+\+L\+E\+N\+G\+T\+H, D\+H\+T\+P\+K\+\_\+\+D\+A\+T\+A\+\_\+\+M\+I\+N\+\_\+\+L\+E\+N\+G\+T\+H, handle\+\_\+dhtpk\+\_\+announce(), and Net\+\_\+\+Crypto\+::self\+\_\+secret\+\_\+key.



Referenced by new\+\_\+onion\+\_\+client().


\begin{DoxyCode}
890 \{
891     \hyperlink{struct_onion___client}{Onion\_Client} *onion\_c = object;
892 
893     \textcolor{keywordflow}{if} (length < \hyperlink{onion__client_8c_a76335ad8705aea17b952e4993fef52ff}{DHTPK\_DATA\_MIN\_LENGTH} + 
      \hyperlink{onion__client_8c_ab7a046054431d84cc9e9c0404ebc5002}{DATA\_IN\_RESPONSE\_MIN\_SIZE} + crypto\_box\_NONCEBYTES)
894         \textcolor{keywordflow}{return} 1;
895 
896     \textcolor{keywordflow}{if} (length > \hyperlink{onion__client_8c_a33fc9507f55ea8592e426f78dfe70f79}{DHTPK\_DATA\_MAX\_LENGTH} + 
      \hyperlink{onion__client_8c_ab7a046054431d84cc9e9c0404ebc5002}{DATA\_IN\_RESPONSE\_MIN\_SIZE} + crypto\_box\_NONCEBYTES)
897         \textcolor{keywordflow}{return} 1;
898 
899     uint8\_t plain[\hyperlink{onion__client_8c_a33fc9507f55ea8592e426f78dfe70f79}{DHTPK\_DATA\_MAX\_LENGTH}];
900     \textcolor{keywordtype}{int} len = \hyperlink{crypto__core_8c_ab0aff79180f3852c24ad8f6fd88caf18}{decrypt\_data}(packet, onion\_c->\hyperlink{struct_onion___client_a0f5b9349eb586149cef9017eed2abdfe}{c}->\hyperlink{struct_net___crypto_aa05050f86513ff53fe9da81f73c72267}{self\_secret\_key}, packet + 
      crypto\_box\_PUBLICKEYBYTES,
901                            packet + crypto\_box\_PUBLICKEYBYTES + crypto\_box\_NONCEBYTES,
902                            length - (crypto\_box\_PUBLICKEYBYTES + crypto\_box\_NONCEBYTES), plain);
903 
904     \textcolor{keywordflow}{if} (len != length - (\hyperlink{onion__client_8c_ab7a046054431d84cc9e9c0404ebc5002}{DATA\_IN\_RESPONSE\_MIN\_SIZE} + crypto\_box\_NONCEBYTES))
905         \textcolor{keywordflow}{return} 1;
906 
907     \textcolor{keywordflow}{if} (memcmp(source\_pubkey, plain + 1 + \textcolor{keyword}{sizeof}(uint64\_t), crypto\_box\_PUBLICKEYBYTES) != 0)
908         \textcolor{keywordflow}{return} 1;
909 
910     \textcolor{keywordflow}{return} \hyperlink{onion__client_8c_ac9b7f86cb71b27c5db73d341b910745c}{handle\_dhtpk\_announce}(onion\_c, packet, plain, len);
911 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_a0686761fa3196a2bded47c2b95c7edc4_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_a0686761fa3196a2bded47c2b95c7edc4_icgraph}
\end{center}
\end{figure}


\hypertarget{onion__client_8c_ac9b7f86cb71b27c5db73d341b910745c}{\index{onion\+\_\+client.\+c@{onion\+\_\+client.\+c}!handle\+\_\+dhtpk\+\_\+announce@{handle\+\_\+dhtpk\+\_\+announce}}
\index{handle\+\_\+dhtpk\+\_\+announce@{handle\+\_\+dhtpk\+\_\+announce}!onion\+\_\+client.\+c@{onion\+\_\+client.\+c}}
\subsubsection[{handle\+\_\+dhtpk\+\_\+announce}]{\setlength{\rightskip}{0pt plus 5cm}static int handle\+\_\+dhtpk\+\_\+announce (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{object, }
\item[{const uint8\+\_\+t $\ast$}]{source\+\_\+pubkey, }
\item[{const uint8\+\_\+t $\ast$}]{data, }
\item[{uint16\+\_\+t}]{length}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{onion__client_8c_ac9b7f86cb71b27c5db73d341b910745c}


Definition at line 703 of file onion\+\_\+client.\+c.



References Onion\+\_\+\+Client\+::dht, D\+H\+T\+\_\+getnodes(), Onion\+\_\+\+Friend\+::dht\+\_\+pk\+\_\+callback, Onion\+\_\+\+Friend\+::dht\+\_\+pk\+\_\+callback\+\_\+number, Onion\+\_\+\+Friend\+::dht\+\_\+pk\+\_\+callback\+\_\+object, Onion\+\_\+\+Friend\+::dht\+\_\+public\+\_\+key, D\+H\+T\+P\+K\+\_\+\+D\+A\+T\+A\+\_\+\+M\+A\+X\+\_\+\+L\+E\+N\+G\+T\+H, D\+H\+T\+P\+K\+\_\+\+D\+A\+T\+A\+\_\+\+M\+I\+N\+\_\+\+L\+E\+N\+G\+T\+H, I\+P\+::family, Onion\+\_\+\+Client\+::friends\+\_\+list, i, I\+P\+\_\+\+Port\+::ip, Node\+\_\+format\+::ip\+\_\+port, Onion\+\_\+\+Friend\+::last\+\_\+noreplay, Onion\+\_\+\+Friend\+::last\+\_\+seen, M\+A\+X\+\_\+\+S\+E\+N\+T\+\_\+\+N\+O\+D\+E\+S, net\+\_\+to\+\_\+host, onion\+\_\+friend\+\_\+num(), onion\+\_\+set\+\_\+friend\+\_\+\+D\+H\+T\+\_\+pubkey(), make-\/funny-\/savefile\+::public\+\_\+key, Node\+\_\+format\+::public\+\_\+key, T\+C\+P\+\_\+\+I\+N\+E\+T, T\+C\+P\+\_\+\+I\+N\+E\+T6, Onion\+\_\+\+Friend\+::tcp\+\_\+relay\+\_\+node\+\_\+callback, Onion\+\_\+\+Friend\+::tcp\+\_\+relay\+\_\+node\+\_\+callback\+\_\+number, Onion\+\_\+\+Friend\+::tcp\+\_\+relay\+\_\+node\+\_\+callback\+\_\+object, unix\+\_\+time(), and unpack\+\_\+nodes().



Referenced by handle\+\_\+dht\+\_\+dhtpk(), and new\+\_\+onion\+\_\+client().


\begin{DoxyCode}
704 \{
705     \hyperlink{struct_onion___client}{Onion\_Client} *onion\_c = object;
706 
707     \textcolor{keywordflow}{if} (length < \hyperlink{onion__client_8c_a76335ad8705aea17b952e4993fef52ff}{DHTPK\_DATA\_MIN\_LENGTH})
708         \textcolor{keywordflow}{return} 1;
709 
710     \textcolor{keywordflow}{if} (length > \hyperlink{onion__client_8c_a33fc9507f55ea8592e426f78dfe70f79}{DHTPK\_DATA\_MAX\_LENGTH})
711         \textcolor{keywordflow}{return} 1;
712 
713     \textcolor{keywordtype}{int} friend\_num = \hyperlink{onion__client_8c_a5c2b07b25a5892051b8e132361c54d53}{onion\_friend\_num}(onion\_c, source\_pubkey);
714 
715     \textcolor{keywordflow}{if} (friend\_num == -1)
716         \textcolor{keywordflow}{return} 1;
717 
718     uint64\_t no\_replay;
719     memcpy(&no\_replay, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} + 1, \textcolor{keyword}{sizeof}(uint64\_t));
720     \hyperlink{util_8h_a997aabaef0c91865b7db6f52da01c65b}{net\_to\_host}((uint8\_t *) &no\_replay, \textcolor{keyword}{sizeof}(no\_replay));
721 
722     \textcolor{keywordflow}{if} (no\_replay <= onion\_c->friends\_list[friend\_num].last\_noreplay)
723         \textcolor{keywordflow}{return} 1;
724 
725     onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[friend\_num].\hyperlink{struct_onion___friend_afeea50a96c079a530de60cf6389ec1bd}{last\_noreplay} = no\_replay;
726 
727     \textcolor{keywordflow}{if} (onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[friend\_num].\hyperlink{struct_onion___friend_ab0f780a41ece58bf84d8460e71cbdbb3}{dht\_pk\_callback})
728         onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[friend\_num].\hyperlink{struct_onion___friend_ab0f780a41ece58bf84d8460e71cbdbb3}{dht\_pk\_callback}(onion\_c->
      \hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[friend\_num].\hyperlink{struct_onion___friend_ab5d618d73b8d83fb07209433e7b448ee}{dht\_pk\_callback\_object},
729                 onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[friend\_num].
      \hyperlink{struct_onion___friend_ab0413da421baacf312141b8ae3ec7762}{dht\_pk\_callback\_number}, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} + 1 + \textcolor{keyword}{sizeof}(uint64\_t));
730 
731     \hyperlink{onion__client_8c_a1c5dc5e030ac14db475a4b45214f2a88}{onion\_set\_friend\_DHT\_pubkey}(onion\_c, friend\_num, 
      \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} + 1 + \textcolor{keyword}{sizeof}(uint64\_t));
732     onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[friend\_num].\hyperlink{struct_onion___friend_a7418e248decb1dc63d1e1c8960092c33}{last\_seen} = \hyperlink{util_8c_ac958d9f8847cb8039444bfa3d304233a}{unix\_time}();
733 
734     uint16\_t len\_nodes = length - \hyperlink{onion__client_8c_a76335ad8705aea17b952e4993fef52ff}{DHTPK\_DATA\_MIN\_LENGTH};
735 
736     \textcolor{keywordflow}{if} (len\_nodes != 0) \{
737         \hyperlink{struct_node__format}{Node\_format} nodes[\hyperlink{_d_h_t_8h_a57f4cf16e79a384d7d59a3cc585ea5a3}{MAX\_SENT\_NODES}];
738         \textcolor{keywordtype}{int} num\_nodes = \hyperlink{_d_h_t_8c_a45b33af842c0289c78c70f81e854ed62}{unpack\_nodes}(nodes, \hyperlink{_d_h_t_8h_a57f4cf16e79a384d7d59a3cc585ea5a3}{MAX\_SENT\_NODES}, 0, 
      \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} + 1 + \textcolor{keyword}{sizeof}(uint64\_t) + crypto\_box\_PUBLICKEYBYTES,
739                                      len\_nodes, 1);
740 
741         \textcolor{keywordflow}{if} (num\_nodes <= 0)
742             \textcolor{keywordflow}{return} 1;
743 
744         \textcolor{keywordtype}{int} \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
745 
746         \textcolor{keywordflow}{for} (i = 0; i < num\_nodes; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
747             uint8\_t family = nodes[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}].\hyperlink{struct_node__format_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family};
748 
749             \textcolor{keywordflow}{if} (family == AF\_INET || family == AF\_INET6) \{
750                 \hyperlink{_d_h_t_8c_a769ef744f969e1b4c55547cb74abee59}{DHT\_getnodes}(onion\_c->\hyperlink{struct_onion___client_a8b3d6ce8745acc52695e252bdb1531b6}{dht}, &nodes[i].\hyperlink{struct_node__format_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}, nodes[i].
      \hyperlink{struct_node__format_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[friend\_num].
      \hyperlink{struct_onion___friend_ab2ecaa07625ad0ed5e07d3a1f0dcc939}{dht\_public\_key});
751             \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (family == \hyperlink{network_8h_a38cdd2f189180d6790d5b181f55ca047}{TCP\_INET} || family == \hyperlink{network_8h_a7cd884776d628ca50049592d963c10cc}{TCP\_INET6}) \{
752                 \textcolor{keywordflow}{if} (onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[friend\_num].
      \hyperlink{struct_onion___friend_a62001c45ecd44d4c6321ca2358f4df5f}{tcp\_relay\_node\_callback}) \{
753                     \textcolor{keywordtype}{void} *obj = onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[friend\_num].
      \hyperlink{struct_onion___friend_a0da74cebd5ec2859b1de5db74c0dc528}{tcp\_relay\_node\_callback\_object};
754                     uint32\_t number = onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[friend\_num].
      \hyperlink{struct_onion___friend_ab673fb84fe578fb5e7848f9f04c093cf}{tcp\_relay\_node\_callback\_number};
755                     onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[friend\_num].
      \hyperlink{struct_onion___friend_a62001c45ecd44d4c6321ca2358f4df5f}{tcp\_relay\_node\_callback}(obj, number, nodes[i].ip\_port, nodes[i].
      \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key});
756                 \}
757             \}
758         \}
759     \}
760 
761     \textcolor{keywordflow}{return} 0;
762 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_ac9b7f86cb71b27c5db73d341b910745c_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_ac9b7f86cb71b27c5db73d341b910745c_icgraph}
\end{center}
\end{figure}


\hypertarget{onion__client_8c_a3519dd95525df398b46b0e4a928f54f0}{\index{onion\+\_\+client.\+c@{onion\+\_\+client.\+c}!handle\+\_\+tcp\+\_\+onion@{handle\+\_\+tcp\+\_\+onion}}
\index{handle\+\_\+tcp\+\_\+onion@{handle\+\_\+tcp\+\_\+onion}!onion\+\_\+client.\+c@{onion\+\_\+client.\+c}}
\subsubsection[{handle\+\_\+tcp\+\_\+onion}]{\setlength{\rightskip}{0pt plus 5cm}static int handle\+\_\+tcp\+\_\+onion (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{object, }
\item[{const uint8\+\_\+t $\ast$}]{data, }
\item[{uint16\+\_\+t}]{length}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{onion__client_8c_a3519dd95525df398b46b0e4a928f54f0}


Definition at line 764 of file onion\+\_\+client.\+c.



References I\+P\+::family, handle\+\_\+announce\+\_\+response(), handle\+\_\+data\+\_\+response(), I\+P\+\_\+\+Port\+::ip, N\+E\+T\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+R\+E\+S\+P\+O\+N\+S\+E, N\+E\+T\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+O\+N\+I\+O\+N\+\_\+\+D\+A\+T\+A\+\_\+\+R\+E\+S\+P\+O\+N\+S\+E, and T\+C\+P\+\_\+\+F\+A\+M\+I\+L\+Y.



Referenced by new\+\_\+onion\+\_\+client().


\begin{DoxyCode}
765 \{
766     \textcolor{keywordflow}{if} (length == 0)
767         \textcolor{keywordflow}{return} 1;
768 
769     \hyperlink{struct_i_p___port}{IP\_Port} ip\_port = \{0\};
770     ip\_port.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} = \hyperlink{network_8h_a8b8d4bdf23eea1681ac4126938f587ec}{TCP\_FAMILY};
771 
772     \textcolor{keywordflow}{if} (\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[0] == \hyperlink{network_8h_af56fecaf9aa0b3c4741474e20d0ec43d}{NET\_PACKET\_ANNOUNCE\_RESPONSE}) \{
773         \textcolor{keywordflow}{return} \hyperlink{onion__client_8c_acef82e3853e62dce8cd45450ff028f97}{handle\_announce\_response}(\textcolor{keywordtype}{object}, ip\_port, 
      \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}, length);
774     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[0] == \hyperlink{network_8h_acc89dafa34d1a75935fb4cdef938d424}{NET\_PACKET\_ONION\_DATA\_RESPONSE}) \{
775         \textcolor{keywordflow}{return} \hyperlink{onion__client_8c_a6b443c4d4d5f83acb988fad87d2c1054}{handle\_data\_response}(\textcolor{keywordtype}{object}, ip\_port, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}, length);
776     \}
777 
778     \textcolor{keywordflow}{return} 1;
779 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_a3519dd95525df398b46b0e4a928f54f0_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_a3519dd95525df398b46b0e4a928f54f0_icgraph}
\end{center}
\end{figure}


\hypertarget{onion__client_8c_ae8d66f9bb925deae2911c9c00a9a9dc9}{\index{onion\+\_\+client.\+c@{onion\+\_\+client.\+c}!is\+\_\+path\+\_\+used@{is\+\_\+path\+\_\+used}}
\index{is\+\_\+path\+\_\+used@{is\+\_\+path\+\_\+used}!onion\+\_\+client.\+c@{onion\+\_\+client.\+c}}
\subsubsection[{is\+\_\+path\+\_\+used}]{\setlength{\rightskip}{0pt plus 5cm}static int is\+\_\+path\+\_\+used (
\begin{DoxyParamCaption}
\item[{const {\bf Onion\+\_\+\+Client\+\_\+\+Paths} $\ast$}]{onion\+\_\+paths, }
\item[{const {\bf Node\+\_\+format} $\ast$}]{nodes}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{onion__client_8c_ae8d66f9bb925deae2911c9c00a9a9dc9}


Definition at line 180 of file onion\+\_\+client.\+c.



References i, Node\+\_\+format\+::ip\+\_\+port, Onion\+\_\+\+Path\+::ip\+\_\+port1, ipport\+\_\+equal(), is\+\_\+timeout(), Onion\+\_\+\+Client\+\_\+\+Paths\+::last\+\_\+path\+\_\+success, N\+U\+M\+B\+E\+R\+\_\+\+O\+N\+I\+O\+N\+\_\+\+P\+A\+T\+H\+S, O\+N\+I\+O\+N\+\_\+\+P\+A\+T\+H\+\_\+\+L\+E\+N\+G\+T\+H, O\+N\+I\+O\+N\+\_\+\+P\+A\+T\+H\+\_\+\+M\+A\+X\+\_\+\+L\+I\+F\+E\+T\+I\+M\+E, O\+N\+I\+O\+N\+\_\+\+P\+A\+T\+H\+\_\+\+T\+I\+M\+E\+O\+U\+T, Onion\+\_\+\+Client\+\_\+\+Paths\+::path\+\_\+creation\+\_\+time, and Onion\+\_\+\+Client\+\_\+\+Paths\+::paths.



Referenced by random\+\_\+path().


\begin{DoxyCode}
181 \{
182     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
183 
184     \textcolor{keywordflow}{for} (i = 0; i < \hyperlink{onion__client_8h_a69d73a99a8788ce76768d6cd589da123}{NUMBER\_ONION\_PATHS}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
185         \textcolor{keywordflow}{if} (\hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(onion\_paths->\hyperlink{struct_onion___client___paths_afbee813e09086f6993c94cdaafe2ae36}{last\_path\_success}[i], 
      \hyperlink{onion__client_8h_abfe3e118c0cdb63720124be77c6d10a8}{ONION\_PATH\_TIMEOUT})) \{
186             \textcolor{keywordflow}{continue};
187         \}
188 
189         \textcolor{keywordflow}{if} (\hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(onion\_paths->\hyperlink{struct_onion___client___paths_abc272861ece76f9d9bac356f7297ce3e}{path\_creation\_time}[i], 
      \hyperlink{onion__client_8h_a0e3b30f16437ba0a47672b15f4396eb1}{ONION\_PATH\_MAX\_LIFETIME})) \{
190             \textcolor{keywordflow}{continue};
191         \}
192 
193         \textcolor{keywordflow}{if} (\hyperlink{network_8c_a6913335cf0b2a76303f5f61d18ea2277}{ipport\_equal}(&onion\_paths->\hyperlink{struct_onion___client___paths_afaa8c1f23d89bd5acee1f956e8872061}{paths}[i].\hyperlink{struct_onion___path_ad7670c0a1a9d05b2a807a9c1a7950b79}{ip\_port1}, &nodes[
      \hyperlink{onion_8h_abe0dd1f2cbadfda52425e7c2fed7d8c3}{ONION\_PATH\_LENGTH} - 1].\hyperlink{struct_node__format_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port})) \{
194             \textcolor{keywordflow}{return} \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
195         \}
196     \}
197 
198     \textcolor{keywordflow}{return} -1;
199 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_ae8d66f9bb925deae2911c9c00a9a9dc9_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_ae8d66f9bb925deae2911c9c00a9a9dc9_icgraph}
\end{center}
\end{figure}


\hypertarget{onion__client_8c_a591041f85e43cf886ab4c72fb3b8d468}{\index{onion\+\_\+client.\+c@{onion\+\_\+client.\+c}!kill\+\_\+onion\+\_\+client@{kill\+\_\+onion\+\_\+client}}
\index{kill\+\_\+onion\+\_\+client@{kill\+\_\+onion\+\_\+client}!onion\+\_\+client.\+c@{onion\+\_\+client.\+c}}
\subsubsection[{kill\+\_\+onion\+\_\+client}]{\setlength{\rightskip}{0pt plus 5cm}void kill\+\_\+onion\+\_\+client (
\begin{DoxyParamCaption}
\item[{{\bf Onion\+\_\+\+Client} $\ast$}]{onion\+\_\+c}
\end{DoxyParamCaption}
)}}\label{onion__client_8c_a591041f85e43cf886ab4c72fb3b8d468}


Definition at line 1506 of file onion\+\_\+client.\+c.



References Onion\+\_\+\+Client\+::announce\+\_\+ping\+\_\+array, Onion\+\_\+\+Client\+::c, C\+R\+Y\+P\+T\+O\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+D\+H\+T\+P\+K, cryptopacket\+\_\+registerhandler(), Onion\+\_\+\+Client\+::dht, Onion\+\_\+\+Client\+::net, N\+E\+T\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+R\+E\+S\+P\+O\+N\+S\+E, N\+E\+T\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+O\+N\+I\+O\+N\+\_\+\+D\+A\+T\+A\+\_\+\+R\+E\+S\+P\+O\+N\+S\+E, networking\+\_\+registerhandler(), O\+N\+I\+O\+N\+\_\+\+D\+A\+T\+A\+\_\+\+D\+H\+T\+P\+K, oniondata\+\_\+registerhandler(), ping\+\_\+array\+\_\+free\+\_\+all(), realloc\+\_\+onion\+\_\+friends(), set\+\_\+onion\+\_\+packet\+\_\+tcp\+\_\+connection\+\_\+callback(), and Net\+\_\+\+Crypto\+::tcp\+\_\+c.



Referenced by kill\+\_\+messenger(), kill\+\_\+onions(), and new\+\_\+messenger().


\begin{DoxyCode}
1507 \{
1508     \textcolor{keywordflow}{if} (onion\_c == NULL)
1509         \textcolor{keywordflow}{return};
1510 
1511     \hyperlink{ping__array_8c_a7e093974e6d616c5bbcadfd434b49824}{ping\_array\_free\_all}(&onion\_c->\hyperlink{struct_onion___client_a01eafc8a6b041139be5bc6d72c2eafdf}{announce\_ping\_array});
1512     \hyperlink{onion__client_8c_aa5f27f182606ab701dfc948bfb3a1b42}{realloc\_onion\_friends}(onion\_c, 0);
1513     \hyperlink{network_8c_a230a192ca9463ec4985d4f86de439733}{networking\_registerhandler}(onion\_c->\hyperlink{struct_onion___client_aa14ea2f67950f57fe4235d7375a2216c}{net}, 
      \hyperlink{network_8h_af56fecaf9aa0b3c4741474e20d0ec43d}{NET\_PACKET\_ANNOUNCE\_RESPONSE}, NULL, NULL);
1514     \hyperlink{network_8c_a230a192ca9463ec4985d4f86de439733}{networking\_registerhandler}(onion\_c->\hyperlink{struct_onion___client_aa14ea2f67950f57fe4235d7375a2216c}{net}, 
      \hyperlink{network_8h_acc89dafa34d1a75935fb4cdef938d424}{NET\_PACKET\_ONION\_DATA\_RESPONSE}, NULL, NULL);
1515     \hyperlink{onion__client_8c_a2dfcba5e4eb429f5f2ae79ae999149c4}{oniondata\_registerhandler}(onion\_c, \hyperlink{onion__client_8h_a6a9200c8776f22228852fcd9360c814d}{ONION\_DATA\_DHTPK}, NULL, 
      NULL);
1516     \hyperlink{_d_h_t_8c_a097913efd03d5106a66c15eb48b0e104}{cryptopacket\_registerhandler}(onion\_c->\hyperlink{struct_onion___client_a8b3d6ce8745acc52695e252bdb1531b6}{dht}, 
      \hyperlink{crypto__core_8h_a9c7c84cef4b149dce556b4c78e33dd6b}{CRYPTO\_PACKET\_DHTPK}, NULL, NULL);
1517     \hyperlink{_t_c_p__connection_8c_a9c229dba32e28baa8cd90ae74429d803}{set\_onion\_packet\_tcp\_connection\_callback}(onion\_c->
      \hyperlink{struct_onion___client_a0f5b9349eb586149cef9017eed2abdfe}{c}->\hyperlink{struct_net___crypto_a179982a02be89eaf6617ed81bd3c0961}{tcp\_c}, NULL, NULL);
1518     memset(onion\_c, 0, \textcolor{keyword}{sizeof}(\hyperlink{struct_onion___client}{Onion\_Client}));
1519     free(onion\_c);
1520 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_a591041f85e43cf886ab4c72fb3b8d468_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_a591041f85e43cf886ab4c72fb3b8d468_icgraph}
\end{center}
\end{figure}


\hypertarget{onion__client_8c_a9a6ae3a9c70a5221a65bd1c9be751a2e}{\index{onion\+\_\+client.\+c@{onion\+\_\+client.\+c}!new\+\_\+onion\+\_\+client@{new\+\_\+onion\+\_\+client}}
\index{new\+\_\+onion\+\_\+client@{new\+\_\+onion\+\_\+client}!onion\+\_\+client.\+c@{onion\+\_\+client.\+c}}
\subsubsection[{new\+\_\+onion\+\_\+client}]{\setlength{\rightskip}{0pt plus 5cm}{\bf Onion\+\_\+\+Client}$\ast$ new\+\_\+onion\+\_\+client (
\begin{DoxyParamCaption}
\item[{{\bf Net\+\_\+\+Crypto} $\ast$}]{c}
\end{DoxyParamCaption}
)}}\label{onion__client_8c_a9a6ae3a9c70a5221a65bd1c9be751a2e}


Definition at line 1477 of file onion\+\_\+client.\+c.



References A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+A\+R\+R\+A\+Y\+\_\+\+S\+I\+Z\+E, Onion\+\_\+\+Client\+::announce\+\_\+ping\+\_\+array, A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T, Onion\+\_\+\+Client\+::c, C\+R\+Y\+P\+T\+O\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+D\+H\+T\+P\+K, cryptopacket\+\_\+registerhandler(), Onion\+\_\+\+Client\+::dht, Net\+\_\+\+Crypto\+::dht, handle\+\_\+announce\+\_\+response(), handle\+\_\+data\+\_\+response(), handle\+\_\+dht\+\_\+dhtpk(), handle\+\_\+dhtpk\+\_\+announce(), handle\+\_\+tcp\+\_\+onion(), Onion\+\_\+\+Client\+::net, D\+H\+T\+::net, N\+E\+T\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+A\+N\+N\+O\+U\+N\+C\+E\+\_\+\+R\+E\+S\+P\+O\+N\+S\+E, N\+E\+T\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+O\+N\+I\+O\+N\+\_\+\+D\+A\+T\+A\+\_\+\+R\+E\+S\+P\+O\+N\+S\+E, networking\+\_\+registerhandler(), new\+\_\+symmetric\+\_\+key(), O\+N\+I\+O\+N\+\_\+\+D\+A\+T\+A\+\_\+\+D\+H\+T\+P\+K, oniondata\+\_\+registerhandler(), ping\+\_\+array\+\_\+init(), Onion\+\_\+\+Client\+::secret\+\_\+symmetric\+\_\+key, set\+\_\+onion\+\_\+packet\+\_\+tcp\+\_\+connection\+\_\+callback(), Net\+\_\+\+Crypto\+::tcp\+\_\+c, Onion\+\_\+\+Client\+::temp\+\_\+public\+\_\+key, and Onion\+\_\+\+Client\+::temp\+\_\+secret\+\_\+key.



Referenced by new\+\_\+messenger(), and new\+\_\+onions().


\begin{DoxyCode}
1478 \{
1479     \textcolor{keywordflow}{if} (c == NULL)
1480         \textcolor{keywordflow}{return} NULL;
1481 
1482     \hyperlink{struct_onion___client}{Onion\_Client} *onion\_c = calloc(1, \textcolor{keyword}{sizeof}(\hyperlink{struct_onion___client}{Onion\_Client}));
1483 
1484     \textcolor{keywordflow}{if} (onion\_c == NULL)
1485         \textcolor{keywordflow}{return} NULL;
1486 
1487     \textcolor{keywordflow}{if} (\hyperlink{ping__array_8c_a2d42b1adf1e6ff6a690fc515b9bb2570}{ping\_array\_init}(&onion\_c->\hyperlink{struct_onion___client_a01eafc8a6b041139be5bc6d72c2eafdf}{announce\_ping\_array}, 
      \hyperlink{onion__client_8c_a55f5b7df3f8a34dccc636e32ea48cbd4}{ANNOUNCE\_ARRAY\_SIZE}, \hyperlink{onion__client_8c_a7cb15d415c27b3aacfad91b0d5d150cd}{ANNOUNCE\_TIMEOUT}) != 0) \{
1488         free(onion\_c);
1489         \textcolor{keywordflow}{return} NULL;
1490     \}
1491 
1492     onion\_c->\hyperlink{struct_onion___client_a8b3d6ce8745acc52695e252bdb1531b6}{dht} = c->\hyperlink{struct_net___crypto_a8b3d6ce8745acc52695e252bdb1531b6}{dht};
1493     onion\_c->\hyperlink{struct_onion___client_aa14ea2f67950f57fe4235d7375a2216c}{net} = c->\hyperlink{struct_net___crypto_a8b3d6ce8745acc52695e252bdb1531b6}{dht}->\hyperlink{struct_d_h_t_aa14ea2f67950f57fe4235d7375a2216c}{net};
1494     onion\_c->\hyperlink{struct_onion___client_a0f5b9349eb586149cef9017eed2abdfe}{c} = c;
1495     \hyperlink{crypto__core_8c_a89b4a1a4a7d8bfabdf0e1b60f074e531}{new\_symmetric\_key}(onion\_c->\hyperlink{struct_onion___client_ab9f2ff47bc0b1e5110202a6e4be86390}{secret\_symmetric\_key});
1496     crypto\_box\_keypair(onion\_c->\hyperlink{struct_onion___client_afc342de3f1533c0adfd762a6fd0d20ab}{temp\_public\_key}, onion\_c->
      \hyperlink{struct_onion___client_a6de303feb7b7892cc6a38228554b3e78}{temp\_secret\_key});
1497     \hyperlink{network_8c_a230a192ca9463ec4985d4f86de439733}{networking\_registerhandler}(onion\_c->\hyperlink{struct_onion___client_aa14ea2f67950f57fe4235d7375a2216c}{net}, 
      \hyperlink{network_8h_af56fecaf9aa0b3c4741474e20d0ec43d}{NET\_PACKET\_ANNOUNCE\_RESPONSE}, &
      \hyperlink{onion__client_8c_acef82e3853e62dce8cd45450ff028f97}{handle\_announce\_response}, onion\_c);
1498     \hyperlink{network_8c_a230a192ca9463ec4985d4f86de439733}{networking\_registerhandler}(onion\_c->\hyperlink{struct_onion___client_aa14ea2f67950f57fe4235d7375a2216c}{net}, 
      \hyperlink{network_8h_acc89dafa34d1a75935fb4cdef938d424}{NET\_PACKET\_ONION\_DATA\_RESPONSE}, &
      \hyperlink{onion__client_8c_a6b443c4d4d5f83acb988fad87d2c1054}{handle\_data\_response}, onion\_c);
1499     \hyperlink{onion__client_8c_a2dfcba5e4eb429f5f2ae79ae999149c4}{oniondata\_registerhandler}(onion\_c, \hyperlink{onion__client_8h_a6a9200c8776f22228852fcd9360c814d}{ONION\_DATA\_DHTPK}, &
      \hyperlink{onion__client_8c_ac9b7f86cb71b27c5db73d341b910745c}{handle\_dhtpk\_announce}, onion\_c);
1500     \hyperlink{_d_h_t_8c_a097913efd03d5106a66c15eb48b0e104}{cryptopacket\_registerhandler}(onion\_c->\hyperlink{struct_onion___client_a8b3d6ce8745acc52695e252bdb1531b6}{dht}, 
      \hyperlink{crypto__core_8h_a9c7c84cef4b149dce556b4c78e33dd6b}{CRYPTO\_PACKET\_DHTPK}, &\hyperlink{onion__client_8c_a0686761fa3196a2bded47c2b95c7edc4}{handle\_dht\_dhtpk}, onion\_c);
1501     \hyperlink{_t_c_p__connection_8c_a9c229dba32e28baa8cd90ae74429d803}{set\_onion\_packet\_tcp\_connection\_callback}(onion\_c->
      \hyperlink{struct_onion___client_a0f5b9349eb586149cef9017eed2abdfe}{c}->\hyperlink{struct_net___crypto_a179982a02be89eaf6617ed81bd3c0961}{tcp\_c}, &\hyperlink{onion__client_8c_a3519dd95525df398b46b0e4a928f54f0}{handle\_tcp\_onion}, onion\_c);
1502 
1503     \textcolor{keywordflow}{return} onion\_c;
1504 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_a9a6ae3a9c70a5221a65bd1c9be751a2e_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_a9a6ae3a9c70a5221a65bd1c9be751a2e_icgraph}
\end{center}
\end{figure}


\hypertarget{onion__client_8c_acf73e72ebf38831539c211179d5559b9}{\index{onion\+\_\+client.\+c@{onion\+\_\+client.\+c}!new\+\_\+sendback@{new\+\_\+sendback}}
\index{new\+\_\+sendback@{new\+\_\+sendback}!onion\+\_\+client.\+c@{onion\+\_\+client.\+c}}
\subsubsection[{new\+\_\+sendback}]{\setlength{\rightskip}{0pt plus 5cm}static int new\+\_\+sendback (
\begin{DoxyParamCaption}
\item[{{\bf Onion\+\_\+\+Client} $\ast$}]{onion\+\_\+c, }
\item[{uint32\+\_\+t}]{num, }
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key, }
\item[{{\bf I\+P\+\_\+\+Port}}]{ip\+\_\+port, }
\item[{uint32\+\_\+t}]{path\+\_\+num, }
\item[{uint64\+\_\+t $\ast$}]{sendback}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{onion__client_8c_acf73e72ebf38831539c211179d5559b9}


Definition at line 353 of file onion\+\_\+client.\+c.



References Onion\+\_\+\+Client\+::announce\+\_\+ping\+\_\+array, make-\/funny-\/savefile\+::data, and ping\+\_\+array\+\_\+add().



Referenced by client\+\_\+send\+\_\+announce\+\_\+request().


\begin{DoxyCode}
355 \{
356     uint8\_t \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[\textcolor{keyword}{sizeof}(uint32\_t) + crypto\_box\_PUBLICKEYBYTES + \textcolor{keyword}{sizeof}(
      \hyperlink{struct_i_p___port}{IP\_Port}) + \textcolor{keyword}{sizeof}(uint32\_t)];
357     memcpy(\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}, &\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num}, \textcolor{keyword}{sizeof}(uint32\_t));
358     memcpy(\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} + \textcolor{keyword}{sizeof}(uint32\_t), \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, crypto\_box\_PUBLICKEYBYTES);
359     memcpy(\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} + \textcolor{keyword}{sizeof}(uint32\_t) + crypto\_box\_PUBLICKEYBYTES, &ip\_port, \textcolor{keyword}{sizeof}(
      \hyperlink{struct_i_p___port}{IP\_Port}));
360     memcpy(\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} + \textcolor{keyword}{sizeof}(uint32\_t) + crypto\_box\_PUBLICKEYBYTES + \textcolor{keyword}{sizeof}(
      \hyperlink{struct_i_p___port}{IP\_Port}), &path\_num, \textcolor{keyword}{sizeof}(uint32\_t));
361     *sendback = \hyperlink{ping__array_8c_a67470d42ee0e3e61bedfa598f3039266}{ping\_array\_add}(&onion\_c->\hyperlink{struct_onion___client_a01eafc8a6b041139be5bc6d72c2eafdf}{announce\_ping\_array}, 
      \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}, \textcolor{keyword}{sizeof}(\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}));
362 
363     \textcolor{keywordflow}{if} (*sendback == 0)
364         \textcolor{keywordflow}{return} -1;
365 
366     \textcolor{keywordflow}{return} 0;
367 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_acf73e72ebf38831539c211179d5559b9_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_acf73e72ebf38831539c211179d5559b9_icgraph}
\end{center}
\end{figure}


\hypertarget{onion__client_8c_accbc9c20b5933ea088d718ea09abd6b8}{\index{onion\+\_\+client.\+c@{onion\+\_\+client.\+c}!onion\+\_\+add\+\_\+bs\+\_\+path\+\_\+node@{onion\+\_\+add\+\_\+bs\+\_\+path\+\_\+node}}
\index{onion\+\_\+add\+\_\+bs\+\_\+path\+\_\+node@{onion\+\_\+add\+\_\+bs\+\_\+path\+\_\+node}!onion\+\_\+client.\+c@{onion\+\_\+client.\+c}}
\subsubsection[{onion\+\_\+add\+\_\+bs\+\_\+path\+\_\+node}]{\setlength{\rightskip}{0pt plus 5cm}int onion\+\_\+add\+\_\+bs\+\_\+path\+\_\+node (
\begin{DoxyParamCaption}
\item[{{\bf Onion\+\_\+\+Client} $\ast$}]{onion\+\_\+c, }
\item[{{\bf I\+P\+\_\+\+Port}}]{ip\+\_\+port, }
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key}
\end{DoxyParamCaption}
)}}\label{onion__client_8c_accbc9c20b5933ea088d718ea09abd6b8}


Definition at line 41 of file onion\+\_\+client.\+c.



References I\+P\+::family, i, I\+P\+\_\+\+Port\+::ip, Node\+\_\+format\+::ip\+\_\+port, last, M\+A\+X\+\_\+\+P\+A\+T\+H\+\_\+\+N\+O\+D\+E\+S, Onion\+\_\+\+Client\+::path\+\_\+nodes\+\_\+bs, Onion\+\_\+\+Client\+::path\+\_\+nodes\+\_\+index\+\_\+bs, and Node\+\_\+format\+::public\+\_\+key.



Referenced by messenger\+\_\+load\+\_\+state\+\_\+callback(), populate\+\_\+path\+\_\+nodes\+\_\+tcp(), and tox\+\_\+bootstrap().


\begin{DoxyCode}
42 \{
43     \textcolor{keywordflow}{if} (ip\_port.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} != AF\_INET && ip\_port.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} != AF\_INET6)
44         \textcolor{keywordflow}{return} -1;
45 
46     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
47 
48     \textcolor{keywordflow}{for} (i = 0; i < \hyperlink{onion__client_8h_ac5f0e3c41d8db63d3af45c98df53d719}{MAX\_PATH\_NODES}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
49         \textcolor{keywordflow}{if} (memcmp(\hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, onion\_c->\hyperlink{struct_onion___client_adc82bddd48395ce29a9d609cd6f39a12}{path\_nodes\_bs}[i].
      \hyperlink{struct_node__format_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, crypto\_box\_PUBLICKEYBYTES) == 0)
50             \textcolor{keywordflow}{return} -1;
51     \}
52 
53     onion\_c->\hyperlink{struct_onion___client_adc82bddd48395ce29a9d609cd6f39a12}{path\_nodes\_bs}[onion\_c->\hyperlink{struct_onion___client_aa6cb02170665d966dec231613d9d229e}{path\_nodes\_index\_bs} % 
      \hyperlink{onion__client_8h_ac5f0e3c41d8db63d3af45c98df53d719}{MAX\_PATH\_NODES}].\hyperlink{struct_node__format_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port} = ip\_port;
54     memcpy(onion\_c->\hyperlink{struct_onion___client_adc82bddd48395ce29a9d609cd6f39a12}{path\_nodes\_bs}[onion\_c->\hyperlink{struct_onion___client_aa6cb02170665d966dec231613d9d229e}{path\_nodes\_index\_bs} % 
      MAX\_PATH\_NODES].\hyperlink{struct_node__format_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key},
55            crypto\_box\_PUBLICKEYBYTES);
56 
57     uint16\_t \hyperlink{onion__test_8c_ab2133dedc5ff8edd0101195aaa5e101c}{last} = onion\_c->\hyperlink{struct_onion___client_aa6cb02170665d966dec231613d9d229e}{path\_nodes\_index\_bs};
58     ++onion\_c->\hyperlink{struct_onion___client_aa6cb02170665d966dec231613d9d229e}{path\_nodes\_index\_bs};
59 
60     \textcolor{keywordflow}{if} (onion\_c->\hyperlink{struct_onion___client_aa6cb02170665d966dec231613d9d229e}{path\_nodes\_index\_bs} < last)
61         onion\_c->\hyperlink{struct_onion___client_aa6cb02170665d966dec231613d9d229e}{path\_nodes\_index\_bs} = MAX\_PATH\_NODES + 1;
62 
63     \textcolor{keywordflow}{return} 0;
64 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_accbc9c20b5933ea088d718ea09abd6b8_icgraph}
\end{center}
\end{figure}


\hypertarget{onion__client_8c_a5f6d509093a5e8a3491d21cc21afc7b1}{\index{onion\+\_\+client.\+c@{onion\+\_\+client.\+c}!onion\+\_\+add\+\_\+path\+\_\+node@{onion\+\_\+add\+\_\+path\+\_\+node}}
\index{onion\+\_\+add\+\_\+path\+\_\+node@{onion\+\_\+add\+\_\+path\+\_\+node}!onion\+\_\+client.\+c@{onion\+\_\+client.\+c}}
\subsubsection[{onion\+\_\+add\+\_\+path\+\_\+node}]{\setlength{\rightskip}{0pt plus 5cm}static int onion\+\_\+add\+\_\+path\+\_\+node (
\begin{DoxyParamCaption}
\item[{{\bf Onion\+\_\+\+Client} $\ast$}]{onion\+\_\+c, }
\item[{{\bf I\+P\+\_\+\+Port}}]{ip\+\_\+port, }
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{onion__client_8c_a5f6d509093a5e8a3491d21cc21afc7b1}


Definition at line 71 of file onion\+\_\+client.\+c.



References I\+P\+::family, i, I\+P\+\_\+\+Port\+::ip, Node\+\_\+format\+::ip\+\_\+port, last, M\+A\+X\+\_\+\+P\+A\+T\+H\+\_\+\+N\+O\+D\+E\+S, Onion\+\_\+\+Client\+::path\+\_\+nodes, Onion\+\_\+\+Client\+::path\+\_\+nodes\+\_\+index, and Node\+\_\+format\+::public\+\_\+key.



Referenced by client\+\_\+add\+\_\+to\+\_\+list(), populate\+\_\+path\+\_\+nodes(), and set\+\_\+path\+\_\+timeouts().


\begin{DoxyCode}
72 \{
73     \textcolor{keywordflow}{if} (ip\_port.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} != AF\_INET && ip\_port.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} != AF\_INET6)
74         \textcolor{keywordflow}{return} -1;
75 
76     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
77 
78     \textcolor{keywordflow}{for} (i = 0; i < \hyperlink{onion__client_8h_ac5f0e3c41d8db63d3af45c98df53d719}{MAX\_PATH\_NODES}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
79         \textcolor{keywordflow}{if} (memcmp(\hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, onion\_c->\hyperlink{struct_onion___client_a1baee18cb7db8dad6b0847fa977b7f16}{path\_nodes}[i].
      \hyperlink{struct_node__format_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, crypto\_box\_PUBLICKEYBYTES) == 0)
80             \textcolor{keywordflow}{return} -1;
81     \}
82 
83     onion\_c->\hyperlink{struct_onion___client_a1baee18cb7db8dad6b0847fa977b7f16}{path\_nodes}[onion\_c->\hyperlink{struct_onion___client_aaeb9402a72e98e04eb5cbc4ff0aac70e}{path\_nodes\_index} % 
      \hyperlink{onion__client_8h_ac5f0e3c41d8db63d3af45c98df53d719}{MAX\_PATH\_NODES}].\hyperlink{struct_node__format_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port} = ip\_port;
84     memcpy(onion\_c->\hyperlink{struct_onion___client_a1baee18cb7db8dad6b0847fa977b7f16}{path\_nodes}[onion\_c->\hyperlink{struct_onion___client_aaeb9402a72e98e04eb5cbc4ff0aac70e}{path\_nodes\_index} % MAX\_PATH\_NODES].
      \hyperlink{struct_node__format_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key},
85            crypto\_box\_PUBLICKEYBYTES);
86 
87     uint16\_t \hyperlink{onion__test_8c_ab2133dedc5ff8edd0101195aaa5e101c}{last} = onion\_c->\hyperlink{struct_onion___client_aaeb9402a72e98e04eb5cbc4ff0aac70e}{path\_nodes\_index};
88     ++onion\_c->\hyperlink{struct_onion___client_aaeb9402a72e98e04eb5cbc4ff0aac70e}{path\_nodes\_index};
89 
90     \textcolor{keywordflow}{if} (onion\_c->\hyperlink{struct_onion___client_aaeb9402a72e98e04eb5cbc4ff0aac70e}{path\_nodes\_index} < last)
91         onion\_c->\hyperlink{struct_onion___client_aaeb9402a72e98e04eb5cbc4ff0aac70e}{path\_nodes\_index} = MAX\_PATH\_NODES + 1;
92 
93     \textcolor{keywordflow}{return} 0;
94 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_a5f6d509093a5e8a3491d21cc21afc7b1_icgraph}
\end{center}
\end{figure}


\hypertarget{onion__client_8c_a4dd8a80061f115daba3ffb2a3f611b38}{\index{onion\+\_\+client.\+c@{onion\+\_\+client.\+c}!onion\+\_\+addfriend@{onion\+\_\+addfriend}}
\index{onion\+\_\+addfriend@{onion\+\_\+addfriend}!onion\+\_\+client.\+c@{onion\+\_\+client.\+c}}
\subsubsection[{onion\+\_\+addfriend}]{\setlength{\rightskip}{0pt plus 5cm}int onion\+\_\+addfriend (
\begin{DoxyParamCaption}
\item[{{\bf Onion\+\_\+\+Client} $\ast$}]{onion\+\_\+c, }
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key}
\end{DoxyParamCaption}
)}}\label{onion__client_8c_a4dd8a80061f115daba3ffb2a3f611b38}


Definition at line 1010 of file onion\+\_\+client.\+c.



References Onion\+\_\+\+Client\+::friends\+\_\+list, i, num, Onion\+\_\+\+Client\+::num\+\_\+friends, onion\+\_\+friend\+\_\+num(), Onion\+\_\+\+Friend\+::real\+\_\+public\+\_\+key, realloc\+\_\+onion\+\_\+friends(), Onion\+\_\+\+Friend\+::status, Onion\+\_\+\+Friend\+::temp\+\_\+public\+\_\+key, and Onion\+\_\+\+Friend\+::temp\+\_\+secret\+\_\+key.



Referenced by new\+\_\+friend\+\_\+connection(), and S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T().


\begin{DoxyCode}
1011 \{
1012     \textcolor{keywordtype}{int} \hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num} = \hyperlink{onion__client_8c_a5c2b07b25a5892051b8e132361c54d53}{onion\_friend\_num}(onion\_c, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key});
1013 
1014     \textcolor{keywordflow}{if} (num != -1)
1015         \textcolor{keywordflow}{return} \hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num};
1016 
1017     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}, index = ~0;
1018 
1019     \textcolor{keywordflow}{for} (i = 0; i < onion\_c->\hyperlink{struct_onion___client_a8ee1f2d7e543bce350c591a8eaac0cf8}{num\_friends}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
1020         \textcolor{keywordflow}{if} (onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[i].\hyperlink{struct_onion___friend_ade818037fd6c985038ff29656089758d}{status} == 0) \{
1021             index = \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
1022             \textcolor{keywordflow}{break};
1023         \}
1024     \}
1025 
1026     \textcolor{keywordflow}{if} (index == (uint32\_t)~0) \{
1027         \textcolor{keywordflow}{if} (\hyperlink{onion__client_8c_aa5f27f182606ab701dfc948bfb3a1b42}{realloc\_onion\_friends}(onion\_c, onion\_c->
      \hyperlink{struct_onion___client_a8ee1f2d7e543bce350c591a8eaac0cf8}{num\_friends} + 1) == -1)
1028             \textcolor{keywordflow}{return} -1;
1029 
1030         index = onion\_c->\hyperlink{struct_onion___client_a8ee1f2d7e543bce350c591a8eaac0cf8}{num\_friends};
1031         memset(&(onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[onion\_c->\hyperlink{struct_onion___client_a8ee1f2d7e543bce350c591a8eaac0cf8}{num\_friends}]), 0, \textcolor{keyword}{sizeof}(
      \hyperlink{struct_onion___friend}{Onion\_Friend}));
1032         ++onion\_c->\hyperlink{struct_onion___client_a8ee1f2d7e543bce350c591a8eaac0cf8}{num\_friends};
1033     \}
1034 
1035     onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[index].\hyperlink{struct_onion___friend_ade818037fd6c985038ff29656089758d}{status} = 1;
1036     memcpy(onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[index].\hyperlink{struct_onion___friend_a996dcaefa2a5954a199e2beb584c1feb}{real\_public\_key}, 
      \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, crypto\_box\_PUBLICKEYBYTES);
1037     crypto\_box\_keypair(onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[index].\hyperlink{struct_onion___friend_afc342de3f1533c0adfd762a6fd0d20ab}{temp\_public\_key}, onion\_c->
      \hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[index].\hyperlink{struct_onion___friend_a6de303feb7b7892cc6a38228554b3e78}{temp\_secret\_key});
1038     \textcolor{keywordflow}{return} index;
1039 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=309pt]{db/d79/onion__client_8c_a4dd8a80061f115daba3ffb2a3f611b38_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_a4dd8a80061f115daba3ffb2a3f611b38_icgraph}
\end{center}
\end{figure}


\hypertarget{onion__client_8c_ad93584ad916d224037dd7a6e5caeebcf}{\index{onion\+\_\+client.\+c@{onion\+\_\+client.\+c}!onion\+\_\+backup\+\_\+nodes@{onion\+\_\+backup\+\_\+nodes}}
\index{onion\+\_\+backup\+\_\+nodes@{onion\+\_\+backup\+\_\+nodes}!onion\+\_\+client.\+c@{onion\+\_\+client.\+c}}
\subsubsection[{onion\+\_\+backup\+\_\+nodes}]{\setlength{\rightskip}{0pt plus 5cm}uint16\+\_\+t onion\+\_\+backup\+\_\+nodes (
\begin{DoxyParamCaption}
\item[{const {\bf Onion\+\_\+\+Client} $\ast$}]{onion\+\_\+c, }
\item[{{\bf Node\+\_\+format} $\ast$}]{nodes, }
\item[{uint16\+\_\+t}]{max\+\_\+num}
\end{DoxyParamCaption}
)}}\label{onion__client_8c_ad93584ad916d224037dd7a6e5caeebcf}


Definition at line 100 of file onion\+\_\+client.\+c.



References i, M\+A\+X\+\_\+\+P\+A\+T\+H\+\_\+\+N\+O\+D\+E\+S, Onion\+\_\+\+Client\+::path\+\_\+nodes, and Onion\+\_\+\+Client\+::path\+\_\+nodes\+\_\+index.



Referenced by messenger\+\_\+save().


\begin{DoxyCode}
101 \{
102     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
103 
104     \textcolor{keywordflow}{if} (!max\_num)
105         \textcolor{keywordflow}{return} 0;
106 
107     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} num\_nodes = (onion\_c->\hyperlink{struct_onion___client_aaeb9402a72e98e04eb5cbc4ff0aac70e}{path\_nodes\_index} < 
      \hyperlink{onion__client_8h_ac5f0e3c41d8db63d3af45c98df53d719}{MAX\_PATH\_NODES}) ? onion\_c->\hyperlink{struct_onion___client_aaeb9402a72e98e04eb5cbc4ff0aac70e}{path\_nodes\_index} : 
      \hyperlink{onion__client_8h_ac5f0e3c41d8db63d3af45c98df53d719}{MAX\_PATH\_NODES};
108 
109     if (num\_nodes == 0)
110         \textcolor{keywordflow}{return} 0;
111 
112     \textcolor{keywordflow}{if} (num\_nodes < max\_num)
113         max\_num = num\_nodes;
114 
115     \textcolor{keywordflow}{for} (i = 0; i < max\_num; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
116         nodes[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}] = onion\_c->\hyperlink{struct_onion___client_a1baee18cb7db8dad6b0847fa977b7f16}{path\_nodes}[(onion\_c->\hyperlink{struct_onion___client_aaeb9402a72e98e04eb5cbc4ff0aac70e}{path\_nodes\_index} - (1 + 
      \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i})) % num\_nodes];
117     \}
118 
119     \textcolor{keywordflow}{return} max\_num;
120 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_ad93584ad916d224037dd7a6e5caeebcf_icgraph}
\end{center}
\end{figure}


\hypertarget{onion__client_8c_a851cc0015a7360b9abfb7d92b997b2b4}{\index{onion\+\_\+client.\+c@{onion\+\_\+client.\+c}!onion\+\_\+connection\+\_\+status@{onion\+\_\+connection\+\_\+status}}
\index{onion\+\_\+connection\+\_\+status@{onion\+\_\+connection\+\_\+status}!onion\+\_\+client.\+c@{onion\+\_\+client.\+c}}
\subsubsection[{onion\+\_\+connection\+\_\+status}]{\setlength{\rightskip}{0pt plus 5cm}unsigned int onion\+\_\+connection\+\_\+status (
\begin{DoxyParamCaption}
\item[{const {\bf Onion\+\_\+\+Client} $\ast$}]{onion\+\_\+c}
\end{DoxyParamCaption}
)}}\label{onion__client_8c_a851cc0015a7360b9abfb7d92b997b2b4}


Definition at line 1418 of file onion\+\_\+client.\+c.



References Onion\+\_\+\+Client\+::onion\+\_\+connected, O\+N\+I\+O\+N\+\_\+\+C\+O\+N\+N\+E\+C\+T\+I\+O\+N\+\_\+\+S\+E\+C\+O\+N\+D\+S, and Onion\+\_\+\+Client\+::\+U\+D\+P\+\_\+connected.



Referenced by connection\+\_\+status\+\_\+cb(), do\+\_\+onion\+\_\+client(), and tox\+\_\+self\+\_\+get\+\_\+connection\+\_\+status().


\begin{DoxyCode}
1419 \{
1420     \textcolor{keywordflow}{if} (onion\_c->\hyperlink{struct_onion___client_a1a57f09aaa51824a5069ba1503d52513}{onion\_connected} >= \hyperlink{onion__client_8c_a14673162b8f41519787e7c18e6806e59}{ONION\_CONNECTION\_SECONDS}) \{
1421         \textcolor{keywordflow}{if} (onion\_c->\hyperlink{struct_onion___client_ab561b9f2ae6e811457653ddacc1e7f6c}{UDP\_connected}) \{
1422             \textcolor{keywordflow}{return} 2;
1423         \} \textcolor{keywordflow}{else} \{
1424             \textcolor{keywordflow}{return} 1;
1425         \}
1426     \}
1427 
1428     \textcolor{keywordflow}{return} 0;
1429 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_a851cc0015a7360b9abfb7d92b997b2b4_icgraph}
\end{center}
\end{figure}


\hypertarget{onion__client_8c_a986bc935dff33db8070c431fcd2363eb}{\index{onion\+\_\+client.\+c@{onion\+\_\+client.\+c}!onion\+\_\+delfriend@{onion\+\_\+delfriend}}
\index{onion\+\_\+delfriend@{onion\+\_\+delfriend}!onion\+\_\+client.\+c@{onion\+\_\+client.\+c}}
\subsubsection[{onion\+\_\+delfriend}]{\setlength{\rightskip}{0pt plus 5cm}int onion\+\_\+delfriend (
\begin{DoxyParamCaption}
\item[{{\bf Onion\+\_\+\+Client} $\ast$}]{onion\+\_\+c, }
\item[{int}]{friend\+\_\+num}
\end{DoxyParamCaption}
)}}\label{onion__client_8c_a986bc935dff33db8070c431fcd2363eb}


Definition at line 1046 of file onion\+\_\+client.\+c.



References Onion\+\_\+\+Client\+::friends\+\_\+list, i, Onion\+\_\+\+Client\+::num\+\_\+friends, realloc\+\_\+onion\+\_\+friends(), and Onion\+\_\+\+Friend\+::status.



Referenced by kill\+\_\+friend\+\_\+connection().


\begin{DoxyCode}
1047 \{
1048     \textcolor{keywordflow}{if} ((uint32\_t)friend\_num >= onion\_c->\hyperlink{struct_onion___client_a8ee1f2d7e543bce350c591a8eaac0cf8}{num\_friends})
1049         \textcolor{keywordflow}{return} -1;
1050 
1051     \textcolor{comment}{//if (onion\_c->friends\_list[friend\_num].know\_dht\_public\_key)}
1052     \textcolor{comment}{//    DHT\_delfriend(onion\_c->dht, onion\_c->friends\_list[friend\_num].dht\_public\_key, 0);}
1053 
1054     memset(&(onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[friend\_num]), 0, \textcolor{keyword}{sizeof}(
      \hyperlink{struct_onion___friend}{Onion\_Friend}));
1055     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
1056 
1057     \textcolor{keywordflow}{for} (i = onion\_c->\hyperlink{struct_onion___client_a8ee1f2d7e543bce350c591a8eaac0cf8}{num\_friends}; i != 0; --i) \{
1058         \textcolor{keywordflow}{if} (onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[i - 1].\hyperlink{struct_onion___friend_ade818037fd6c985038ff29656089758d}{status} != 0)
1059             \textcolor{keywordflow}{break};
1060     \}
1061 
1062     \textcolor{keywordflow}{if} (onion\_c->\hyperlink{struct_onion___client_a8ee1f2d7e543bce350c591a8eaac0cf8}{num\_friends} != i) \{
1063         onion\_c->\hyperlink{struct_onion___client_a8ee1f2d7e543bce350c591a8eaac0cf8}{num\_friends} = \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
1064         \hyperlink{onion__client_8c_aa5f27f182606ab701dfc948bfb3a1b42}{realloc\_onion\_friends}(onion\_c, onion\_c->\hyperlink{struct_onion___client_a8ee1f2d7e543bce350c591a8eaac0cf8}{num\_friends});
1065     \}
1066 
1067     \textcolor{keywordflow}{return} friend\_num;
1068 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=306pt]{db/d79/onion__client_8c_a986bc935dff33db8070c431fcd2363eb_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_a986bc935dff33db8070c431fcd2363eb_icgraph}
\end{center}
\end{figure}


\hypertarget{onion__client_8c_a08895281211a01749ee466338fedbeec}{\index{onion\+\_\+client.\+c@{onion\+\_\+client.\+c}!onion\+\_\+dht\+\_\+pk\+\_\+callback@{onion\+\_\+dht\+\_\+pk\+\_\+callback}}
\index{onion\+\_\+dht\+\_\+pk\+\_\+callback@{onion\+\_\+dht\+\_\+pk\+\_\+callback}!onion\+\_\+client.\+c@{onion\+\_\+client.\+c}}
\subsubsection[{onion\+\_\+dht\+\_\+pk\+\_\+callback}]{\setlength{\rightskip}{0pt plus 5cm}int onion\+\_\+dht\+\_\+pk\+\_\+callback (
\begin{DoxyParamCaption}
\item[{{\bf Onion\+\_\+\+Client} $\ast$}]{onion\+\_\+c, }
\item[{int}]{friend\+\_\+num, }
\item[{void($\ast$)(void $\ast$data, int32\+\_\+t number, const uint8\+\_\+t $\ast$dht\+\_\+public\+\_\+key)}]{function, }
\item[{void $\ast$}]{object, }
\item[{uint32\+\_\+t}]{number}
\end{DoxyParamCaption}
)}}\label{onion__client_8c_a08895281211a01749ee466338fedbeec}


Definition at line 1098 of file onion\+\_\+client.\+c.



References Onion\+\_\+\+Friend\+::dht\+\_\+pk\+\_\+callback, Onion\+\_\+\+Friend\+::dht\+\_\+pk\+\_\+callback\+\_\+number, Onion\+\_\+\+Friend\+::dht\+\_\+pk\+\_\+callback\+\_\+object, Onion\+\_\+\+Client\+::friends\+\_\+list, and Onion\+\_\+\+Client\+::num\+\_\+friends.



Referenced by new\+\_\+friend\+\_\+connection(), and S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T().


\begin{DoxyCode}
1100 \{
1101     \textcolor{keywordflow}{if} ((uint32\_t)friend\_num >= onion\_c->\hyperlink{struct_onion___client_a8ee1f2d7e543bce350c591a8eaac0cf8}{num\_friends})
1102         \textcolor{keywordflow}{return} -1;
1103 
1104     onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[friend\_num].\hyperlink{struct_onion___friend_ab0f780a41ece58bf84d8460e71cbdbb3}{dht\_pk\_callback} = \textcolor{keyword}{function};
1105     onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[friend\_num].\hyperlink{struct_onion___friend_ab5d618d73b8d83fb07209433e7b448ee}{dht\_pk\_callback\_object} = object;
1106     onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[friend\_num].\hyperlink{struct_onion___friend_ab0413da421baacf312141b8ae3ec7762}{dht\_pk\_callback\_number} = number;
1107     \textcolor{keywordflow}{return} 0;
1108 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_a08895281211a01749ee466338fedbeec_icgraph}
\end{center}
\end{figure}


\hypertarget{onion__client_8c_a5c2b07b25a5892051b8e132361c54d53}{\index{onion\+\_\+client.\+c@{onion\+\_\+client.\+c}!onion\+\_\+friend\+\_\+num@{onion\+\_\+friend\+\_\+num}}
\index{onion\+\_\+friend\+\_\+num@{onion\+\_\+friend\+\_\+num}!onion\+\_\+client.\+c@{onion\+\_\+client.\+c}}
\subsubsection[{onion\+\_\+friend\+\_\+num}]{\setlength{\rightskip}{0pt plus 5cm}int onion\+\_\+friend\+\_\+num (
\begin{DoxyParamCaption}
\item[{const {\bf Onion\+\_\+\+Client} $\ast$}]{onion\+\_\+c, }
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key}
\end{DoxyParamCaption}
)}}\label{onion__client_8c_a5c2b07b25a5892051b8e132361c54d53}


Definition at line 968 of file onion\+\_\+client.\+c.



References Onion\+\_\+\+Client\+::friends\+\_\+list, i, Onion\+\_\+\+Client\+::num\+\_\+friends, Onion\+\_\+\+Friend\+::real\+\_\+public\+\_\+key, and Onion\+\_\+\+Friend\+::status.



Referenced by handle\+\_\+dhtpk\+\_\+announce(), and onion\+\_\+addfriend().


\begin{DoxyCode}
969 \{
970     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
971 
972     \textcolor{keywordflow}{for} (i = 0; i < onion\_c->\hyperlink{struct_onion___client_a8ee1f2d7e543bce350c591a8eaac0cf8}{num\_friends}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
973         \textcolor{keywordflow}{if} (onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[i].\hyperlink{struct_onion___friend_ade818037fd6c985038ff29656089758d}{status} == 0)
974             \textcolor{keywordflow}{continue};
975 
976         \textcolor{keywordflow}{if} (memcmp(\hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[i].
      \hyperlink{struct_onion___friend_a996dcaefa2a5954a199e2beb584c1feb}{real\_public\_key}, crypto\_box\_PUBLICKEYBYTES) == 0)
977             \textcolor{keywordflow}{return} \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
978     \}
979 
980     \textcolor{keywordflow}{return} -1;
981 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_a5c2b07b25a5892051b8e132361c54d53_icgraph}
\end{center}
\end{figure}


\hypertarget{onion__client_8c_aed6b3a90411af009433f7df95753909a}{\index{onion\+\_\+client.\+c@{onion\+\_\+client.\+c}!onion\+\_\+getfriend\+\_\+\+D\+H\+T\+\_\+pubkey@{onion\+\_\+getfriend\+\_\+\+D\+H\+T\+\_\+pubkey}}
\index{onion\+\_\+getfriend\+\_\+\+D\+H\+T\+\_\+pubkey@{onion\+\_\+getfriend\+\_\+\+D\+H\+T\+\_\+pubkey}!onion\+\_\+client.\+c@{onion\+\_\+client.\+c}}
\subsubsection[{onion\+\_\+getfriend\+\_\+\+D\+H\+T\+\_\+pubkey}]{\setlength{\rightskip}{0pt plus 5cm}unsigned int onion\+\_\+getfriend\+\_\+\+D\+H\+T\+\_\+pubkey (
\begin{DoxyParamCaption}
\item[{const {\bf Onion\+\_\+\+Client} $\ast$}]{onion\+\_\+c, }
\item[{int}]{friend\+\_\+num, }
\item[{uint8\+\_\+t $\ast$}]{dht\+\_\+key}
\end{DoxyParamCaption}
)}}\label{onion__client_8c_aed6b3a90411af009433f7df95753909a}


Definition at line 1143 of file onion\+\_\+client.\+c.



References Onion\+\_\+\+Friend\+::dht\+\_\+public\+\_\+key, Onion\+\_\+\+Client\+::friends\+\_\+list, Onion\+\_\+\+Friend\+::know\+\_\+dht\+\_\+public\+\_\+key, Onion\+\_\+\+Client\+::num\+\_\+friends, and Onion\+\_\+\+Friend\+::status.



Referenced by onion\+\_\+getfriendip().


\begin{DoxyCode}
1144 \{
1145     \textcolor{keywordflow}{if} ((uint32\_t)friend\_num >= onion\_c->\hyperlink{struct_onion___client_a8ee1f2d7e543bce350c591a8eaac0cf8}{num\_friends})
1146         \textcolor{keywordflow}{return} 0;
1147 
1148     \textcolor{keywordflow}{if} (onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[friend\_num].\hyperlink{struct_onion___friend_ade818037fd6c985038ff29656089758d}{status} == 0)
1149         \textcolor{keywordflow}{return} 0;
1150 
1151     \textcolor{keywordflow}{if} (!onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[friend\_num].\hyperlink{struct_onion___friend_a1b66769a2b6f8e5c7306ffcfb7ac0956}{know\_dht\_public\_key})
1152         \textcolor{keywordflow}{return} 0;
1153 
1154     memcpy(dht\_key, onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[friend\_num].\hyperlink{struct_onion___friend_ab2ecaa07625ad0ed5e07d3a1f0dcc939}{dht\_public\_key}, 
      crypto\_box\_PUBLICKEYBYTES);
1155     \textcolor{keywordflow}{return} 1;
1156 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_aed6b3a90411af009433f7df95753909a_icgraph}
\end{center}
\end{figure}


\hypertarget{onion__client_8c_a729c34e35841408f6d775179f4e7a48b}{\index{onion\+\_\+client.\+c@{onion\+\_\+client.\+c}!onion\+\_\+getfriendip@{onion\+\_\+getfriendip}}
\index{onion\+\_\+getfriendip@{onion\+\_\+getfriendip}!onion\+\_\+client.\+c@{onion\+\_\+client.\+c}}
\subsubsection[{onion\+\_\+getfriendip}]{\setlength{\rightskip}{0pt plus 5cm}int onion\+\_\+getfriendip (
\begin{DoxyParamCaption}
\item[{const {\bf Onion\+\_\+\+Client} $\ast$}]{onion\+\_\+c, }
\item[{int}]{friend\+\_\+num, }
\item[{{\bf I\+P\+\_\+\+Port} $\ast$}]{ip\+\_\+port}
\end{DoxyParamCaption}
)}}\label{onion__client_8c_a729c34e35841408f6d775179f4e7a48b}


Definition at line 1165 of file onion\+\_\+client.\+c.



References Onion\+\_\+\+Client\+::dht, D\+H\+T\+\_\+getfriendip(), and onion\+\_\+getfriend\+\_\+\+D\+H\+T\+\_\+pubkey().



Referenced by S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T().


\begin{DoxyCode}
1166 \{
1167     uint8\_t dht\_public\_key[crypto\_box\_PUBLICKEYBYTES];
1168 
1169     \textcolor{keywordflow}{if} (\hyperlink{onion__client_8c_aed6b3a90411af009433f7df95753909a}{onion\_getfriend\_DHT\_pubkey}(onion\_c, friend\_num, dht\_public\_key) == 0)
1170         \textcolor{keywordflow}{return} -1;
1171 
1172     \textcolor{keywordflow}{return} \hyperlink{_d_h_t_8c_a963cf2afd9283277f69a94381e3fc5f0}{DHT\_getfriendip}(onion\_c->\hyperlink{struct_onion___client_a8b3d6ce8745acc52695e252bdb1531b6}{dht}, dht\_public\_key, ip\_port);
1173 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_a729c34e35841408f6d775179f4e7a48b_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=286pt]{db/d79/onion__client_8c_a729c34e35841408f6d775179f4e7a48b_icgraph}
\end{center}
\end{figure}


\hypertarget{onion__client_8c_a431d923b0d1456565facb61cf7409af2}{\index{onion\+\_\+client.\+c@{onion\+\_\+client.\+c}!onion\+\_\+isconnected@{onion\+\_\+isconnected}}
\index{onion\+\_\+isconnected@{onion\+\_\+isconnected}!onion\+\_\+client.\+c@{onion\+\_\+client.\+c}}
\subsubsection[{onion\+\_\+isconnected}]{\setlength{\rightskip}{0pt plus 5cm}static int onion\+\_\+isconnected (
\begin{DoxyParamCaption}
\item[{const {\bf Onion\+\_\+\+Client} $\ast$}]{onion\+\_\+c}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{onion__client_8c_a431d923b0d1456565facb61cf7409af2}


Definition at line 1376 of file onion\+\_\+client.\+c.



References Onion\+\_\+\+Client\+::clients\+\_\+announce\+\_\+list, i, Onion\+\_\+\+Node\+::is\+\_\+stored, is\+\_\+timeout(), Onion\+\_\+\+Client\+::last\+\_\+packet\+\_\+recv, M\+A\+X\+\_\+\+O\+N\+I\+O\+N\+\_\+\+C\+L\+I\+E\+N\+T\+S, num, O\+N\+I\+O\+N\+\_\+\+N\+O\+D\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T, O\+N\+I\+O\+N\+\_\+\+O\+F\+F\+L\+I\+N\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T, Onion\+\_\+\+Client\+::path\+\_\+nodes\+\_\+index, and Onion\+\_\+\+Node\+::timestamp.



Referenced by do\+\_\+onion\+\_\+client().


\begin{DoxyCode}
1377 \{
1378     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}, \hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num} = 0, announced = 0;
1379 
1380     \textcolor{keywordflow}{if} (\hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(onion\_c->\hyperlink{struct_onion___client_ace034948b31137d0ad356f59a3d08af5}{last\_packet\_recv}, 
      \hyperlink{onion__client_8h_a90dcf5301d61aa57f69c07c054e87bbc}{ONION\_OFFLINE\_TIMEOUT}))
1381         \textcolor{keywordflow}{return} 0;
1382 
1383     \textcolor{keywordflow}{if} (onion\_c->\hyperlink{struct_onion___client_aaeb9402a72e98e04eb5cbc4ff0aac70e}{path\_nodes\_index} == 0)
1384         \textcolor{keywordflow}{return} 0;
1385 
1386     \textcolor{keywordflow}{for} (i = 0; i < \hyperlink{onion__client_8h_ab1de7815e06277ced6779ba201b0b716}{MAX\_ONION\_CLIENTS}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
1387         \textcolor{keywordflow}{if} (!\hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(onion\_c->\hyperlink{struct_onion___client_a21a83b6615ce3ab53739031a355aeabd}{clients\_announce\_list}[i].
      \hyperlink{struct_onion___node_a465bef81f6478756e5443025b1f2ddfa}{timestamp}, \hyperlink{onion__client_8h_a96ede75aa4a66f24cefc164af1d4e41d}{ONION\_NODE\_TIMEOUT})) \{
1388             ++\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num};
1389 
1390             \textcolor{keywordflow}{if} (onion\_c->\hyperlink{struct_onion___client_a21a83b6615ce3ab53739031a355aeabd}{clients\_announce\_list}[i].\hyperlink{struct_onion___node_ada3701a9ce02699f1b7e8f55a41379bf}{is\_stored}) \{
1391                 ++announced;
1392             \}
1393         \}
1394     \}
1395 
1396     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} pnodes = onion\_c->\hyperlink{struct_onion___client_aaeb9402a72e98e04eb5cbc4ff0aac70e}{path\_nodes\_index};
1397 
1398     \textcolor{keywordflow}{if} (pnodes > MAX\_ONION\_CLIENTS) \{
1399         pnodes = \hyperlink{onion__client_8h_ab1de7815e06277ced6779ba201b0b716}{MAX\_ONION\_CLIENTS};
1400     \}
1401 
1402     \textcolor{comment}{/* Consider ourselves online if we are announced to half or more nodes}
1403 \textcolor{comment}{      we are connected to */}
1404     \textcolor{keywordflow}{if} (num && announced) \{
1405         \textcolor{keywordflow}{if} ((num / 2) <= announced && (pnodes / 2) <= num)
1406             \textcolor{keywordflow}{return} 1;
1407     \}
1408 
1409     \textcolor{keywordflow}{return} 0;
1410 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_a431d923b0d1456565facb61cf7409af2_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_a431d923b0d1456565facb61cf7409af2_icgraph}
\end{center}
\end{figure}


\hypertarget{onion__client_8c_a1c5dc5e030ac14db475a4b45214f2a88}{\index{onion\+\_\+client.\+c@{onion\+\_\+client.\+c}!onion\+\_\+set\+\_\+friend\+\_\+\+D\+H\+T\+\_\+pubkey@{onion\+\_\+set\+\_\+friend\+\_\+\+D\+H\+T\+\_\+pubkey}}
\index{onion\+\_\+set\+\_\+friend\+\_\+\+D\+H\+T\+\_\+pubkey@{onion\+\_\+set\+\_\+friend\+\_\+\+D\+H\+T\+\_\+pubkey}!onion\+\_\+client.\+c@{onion\+\_\+client.\+c}}
\subsubsection[{onion\+\_\+set\+\_\+friend\+\_\+\+D\+H\+T\+\_\+pubkey}]{\setlength{\rightskip}{0pt plus 5cm}int onion\+\_\+set\+\_\+friend\+\_\+\+D\+H\+T\+\_\+pubkey (
\begin{DoxyParamCaption}
\item[{{\bf Onion\+\_\+\+Client} $\ast$}]{onion\+\_\+c, }
\item[{int}]{friend\+\_\+num, }
\item[{const uint8\+\_\+t $\ast$}]{dht\+\_\+key}
\end{DoxyParamCaption}
)}}\label{onion__client_8c_a1c5dc5e030ac14db475a4b45214f2a88}


Definition at line 1115 of file onion\+\_\+client.\+c.



References Onion\+\_\+\+Friend\+::dht\+\_\+public\+\_\+key, Onion\+\_\+\+Client\+::friends\+\_\+list, Onion\+\_\+\+Friend\+::know\+\_\+dht\+\_\+public\+\_\+key, Onion\+\_\+\+Friend\+::last\+\_\+seen, Onion\+\_\+\+Client\+::num\+\_\+friends, Onion\+\_\+\+Friend\+::status, and unix\+\_\+time().



Referenced by dht\+\_\+pk\+\_\+callback(), and handle\+\_\+dhtpk\+\_\+announce().


\begin{DoxyCode}
1116 \{
1117     \textcolor{keywordflow}{if} ((uint32\_t)friend\_num >= onion\_c->\hyperlink{struct_onion___client_a8ee1f2d7e543bce350c591a8eaac0cf8}{num\_friends})
1118         \textcolor{keywordflow}{return} -1;
1119 
1120     \textcolor{keywordflow}{if} (onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[friend\_num].\hyperlink{struct_onion___friend_ade818037fd6c985038ff29656089758d}{status} == 0)
1121         \textcolor{keywordflow}{return} -1;
1122 
1123     \textcolor{keywordflow}{if} (onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[friend\_num].\hyperlink{struct_onion___friend_a1b66769a2b6f8e5c7306ffcfb7ac0956}{know\_dht\_public\_key}) \{
1124         \textcolor{keywordflow}{if} (memcmp(dht\_key, onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[friend\_num].
      \hyperlink{struct_onion___friend_ab2ecaa07625ad0ed5e07d3a1f0dcc939}{dht\_public\_key}, crypto\_box\_PUBLICKEYBYTES) == 0) \{
1125             \textcolor{keywordflow}{return} -1;
1126         \}
1127 
1128         onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[friend\_num].\hyperlink{struct_onion___friend_a1b66769a2b6f8e5c7306ffcfb7ac0956}{know\_dht\_public\_key} = 0;
1129     \}
1130 
1131     onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[friend\_num].\hyperlink{struct_onion___friend_a7418e248decb1dc63d1e1c8960092c33}{last\_seen} = \hyperlink{util_8c_ac958d9f8847cb8039444bfa3d304233a}{unix\_time}();
1132     onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[friend\_num].\hyperlink{struct_onion___friend_a1b66769a2b6f8e5c7306ffcfb7ac0956}{know\_dht\_public\_key} = 1;
1133     memcpy(onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[friend\_num].\hyperlink{struct_onion___friend_ab2ecaa07625ad0ed5e07d3a1f0dcc939}{dht\_public\_key}, dht\_key, 
      crypto\_box\_PUBLICKEYBYTES);
1134 
1135     \textcolor{keywordflow}{return} 0;
1136 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=289pt]{db/d79/onion__client_8c_a1c5dc5e030ac14db475a4b45214f2a88_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_a1c5dc5e030ac14db475a4b45214f2a88_icgraph}
\end{center}
\end{figure}


\hypertarget{onion__client_8c_a8b91a1e598508b83e0408fc65316ae73}{\index{onion\+\_\+client.\+c@{onion\+\_\+client.\+c}!onion\+\_\+set\+\_\+friend\+\_\+online@{onion\+\_\+set\+\_\+friend\+\_\+online}}
\index{onion\+\_\+set\+\_\+friend\+\_\+online@{onion\+\_\+set\+\_\+friend\+\_\+online}!onion\+\_\+client.\+c@{onion\+\_\+client.\+c}}
\subsubsection[{onion\+\_\+set\+\_\+friend\+\_\+online}]{\setlength{\rightskip}{0pt plus 5cm}int onion\+\_\+set\+\_\+friend\+\_\+online (
\begin{DoxyParamCaption}
\item[{{\bf Onion\+\_\+\+Client} $\ast$}]{onion\+\_\+c, }
\item[{int}]{friend\+\_\+num, }
\item[{uint8\+\_\+t}]{is\+\_\+online}
\end{DoxyParamCaption}
)}}\label{onion__client_8c_a8b91a1e598508b83e0408fc65316ae73}


Definition at line 1185 of file onion\+\_\+client.\+c.



References Onion\+\_\+\+Client\+::friends\+\_\+list, Onion\+\_\+\+Friend\+::is\+\_\+online, Onion\+\_\+\+Friend\+::last\+\_\+noreplay, Onion\+\_\+\+Friend\+::last\+\_\+seen, Onion\+\_\+\+Client\+::num\+\_\+friends, Onion\+\_\+\+Friend\+::run\+\_\+count, and unix\+\_\+time().



Referenced by handle\+\_\+status().


\begin{DoxyCode}
1186 \{
1187     \textcolor{keywordflow}{if} ((uint32\_t)friend\_num >= onion\_c->\hyperlink{struct_onion___client_a8ee1f2d7e543bce350c591a8eaac0cf8}{num\_friends})
1188         \textcolor{keywordflow}{return} -1;
1189 
1190     \textcolor{keywordflow}{if} (is\_online == 0 && onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[friend\_num].
      \hyperlink{struct_onion___friend_a6e539a068fed61fab47b62f467c1d208}{is\_online} == 1)
1191         onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[friend\_num].\hyperlink{struct_onion___friend_a7418e248decb1dc63d1e1c8960092c33}{last\_seen} = 
      \hyperlink{util_8c_ac958d9f8847cb8039444bfa3d304233a}{unix\_time}();
1192 
1193     onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[friend\_num].\hyperlink{struct_onion___friend_a6e539a068fed61fab47b62f467c1d208}{is\_online} = is\_online;
1194 
1195     \textcolor{comment}{/* This should prevent some clock related issues */}
1196     \textcolor{keywordflow}{if} (!is\_online) \{
1197         onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[friend\_num].\hyperlink{struct_onion___friend_afeea50a96c079a530de60cf6389ec1bd}{last\_noreplay} = 0;
1198         onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[friend\_num].\hyperlink{struct_onion___friend_a9b6e91b90249c9b72d98611ba5ed7176}{run\_count} = 0;
1199     \}
1200 
1201     \textcolor{keywordflow}{return} 0;
1202 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=294pt]{db/d79/onion__client_8c_a8b91a1e598508b83e0408fc65316ae73_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_a8b91a1e598508b83e0408fc65316ae73_icgraph}
\end{center}
\end{figure}


\hypertarget{onion__client_8c_a2dfcba5e4eb429f5f2ae79ae999149c4}{\index{onion\+\_\+client.\+c@{onion\+\_\+client.\+c}!oniondata\+\_\+registerhandler@{oniondata\+\_\+registerhandler}}
\index{oniondata\+\_\+registerhandler@{oniondata\+\_\+registerhandler}!onion\+\_\+client.\+c@{onion\+\_\+client.\+c}}
\subsubsection[{oniondata\+\_\+registerhandler}]{\setlength{\rightskip}{0pt plus 5cm}void oniondata\+\_\+registerhandler (
\begin{DoxyParamCaption}
\item[{{\bf Onion\+\_\+\+Client} $\ast$}]{onion\+\_\+c, }
\item[{uint8\+\_\+t}]{byte, }
\item[{{\bf oniondata\+\_\+handler\+\_\+callback}}]{cb, }
\item[{void $\ast$}]{object}
\end{DoxyParamCaption}
)}}\label{onion__client_8c_a2dfcba5e4eb429f5f2ae79ae999149c4}


Definition at line 1310 of file onion\+\_\+client.\+c.



References Onion\+\_\+\+Client\+::function, Onion\+\_\+\+Client\+::object, and Onion\+\_\+\+Client\+::\+Onion\+\_\+\+Data\+\_\+\+Handlers.



Referenced by kill\+\_\+onion\+\_\+client(), new\+\_\+onion\+\_\+client(), and set\+\_\+friend\+\_\+request\+\_\+callback().


\begin{DoxyCode}
1311 \{
1312     onion\_c->\hyperlink{struct_onion___client_a8576150a4360326b1a759d4bfc7c5e59}{Onion\_Data\_Handlers}[byte].\hyperlink{struct_onion___client_a016f61b22111ceb83b172007e8135e73}{function} = cb;
1313     onion\_c->\hyperlink{struct_onion___client_a8576150a4360326b1a759d4bfc7c5e59}{Onion\_Data\_Handlers}[byte].\hyperlink{struct_onion___client_a077376d12464f945e2414d5499c79b3f}{object} = object;
1314 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_a2dfcba5e4eb429f5f2ae79ae999149c4_icgraph}
\end{center}
\end{figure}


\hypertarget{onion__client_8c_a359fb95e06e99e4a5e9391c7b9bafaa6}{\index{onion\+\_\+client.\+c@{onion\+\_\+client.\+c}!path\+\_\+exists@{path\+\_\+exists}}
\index{path\+\_\+exists@{path\+\_\+exists}!onion\+\_\+client.\+c@{onion\+\_\+client.\+c}}
\subsubsection[{path\+\_\+exists}]{\setlength{\rightskip}{0pt plus 5cm}static \+\_\+\+Bool path\+\_\+exists (
\begin{DoxyParamCaption}
\item[{{\bf Onion\+\_\+\+Client\+\_\+\+Paths} $\ast$}]{onion\+\_\+paths, }
\item[{uint32\+\_\+t}]{path\+\_\+num}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{onion__client_8c_a359fb95e06e99e4a5e9391c7b9bafaa6}


Definition at line 262 of file onion\+\_\+client.\+c.



References N\+U\+M\+B\+E\+R\+\_\+\+O\+N\+I\+O\+N\+\_\+\+P\+A\+T\+H\+S, Onion\+\_\+\+Path\+::path\+\_\+num, path\+\_\+timed\+\_\+out(), and Onion\+\_\+\+Client\+\_\+\+Paths\+::paths.



Referenced by do\+\_\+announce().


\begin{DoxyCode}
263 \{
264     \textcolor{keywordflow}{if} (\hyperlink{onion__client_8c_a31170965be8e022295d36b508b432a1e}{path\_timed\_out}(onion\_paths, path\_num))
265         \textcolor{keywordflow}{return} 0;
266 
267     \textcolor{keywordflow}{return} onion\_paths->\hyperlink{struct_onion___client___paths_afaa8c1f23d89bd5acee1f956e8872061}{paths}[path\_num % \hyperlink{onion__client_8h_a69d73a99a8788ce76768d6cd589da123}{NUMBER\_ONION\_PATHS}].
      \hyperlink{struct_onion___path_a6d69f3ea5100411c3599020055b8b78c}{path\_num} == path\_num;
268 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_a359fb95e06e99e4a5e9391c7b9bafaa6_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_a359fb95e06e99e4a5e9391c7b9bafaa6_icgraph}
\end{center}
\end{figure}


\hypertarget{onion__client_8c_a31170965be8e022295d36b508b432a1e}{\index{onion\+\_\+client.\+c@{onion\+\_\+client.\+c}!path\+\_\+timed\+\_\+out@{path\+\_\+timed\+\_\+out}}
\index{path\+\_\+timed\+\_\+out@{path\+\_\+timed\+\_\+out}!onion\+\_\+client.\+c@{onion\+\_\+client.\+c}}
\subsubsection[{path\+\_\+timed\+\_\+out}]{\setlength{\rightskip}{0pt plus 5cm}static \+\_\+\+Bool path\+\_\+timed\+\_\+out (
\begin{DoxyParamCaption}
\item[{{\bf Onion\+\_\+\+Client\+\_\+\+Paths} $\ast$}]{onion\+\_\+paths, }
\item[{uint32\+\_\+t}]{pathnum}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{onion__client_8c_a31170965be8e022295d36b508b432a1e}


Definition at line 202 of file onion\+\_\+client.\+c.



References is\+\_\+timeout(), Onion\+\_\+\+Client\+\_\+\+Paths\+::last\+\_\+path\+\_\+success, Onion\+\_\+\+Client\+\_\+\+Paths\+::last\+\_\+path\+\_\+used\+\_\+times, N\+U\+M\+B\+E\+R\+\_\+\+O\+N\+I\+O\+N\+\_\+\+P\+A\+T\+H\+S, O\+N\+I\+O\+N\+\_\+\+P\+A\+T\+H\+\_\+\+M\+A\+X\+\_\+\+L\+I\+F\+E\+T\+I\+M\+E, O\+N\+I\+O\+N\+\_\+\+P\+A\+T\+H\+\_\+\+M\+A\+X\+\_\+\+N\+O\+\_\+\+R\+E\+S\+P\+O\+N\+S\+E\+\_\+\+U\+S\+E\+S, and Onion\+\_\+\+Client\+\_\+\+Paths\+::path\+\_\+creation\+\_\+time.



Referenced by path\+\_\+exists(), and random\+\_\+path().


\begin{DoxyCode}
203 \{
204     pathnum = pathnum % \hyperlink{onion__client_8h_a69d73a99a8788ce76768d6cd589da123}{NUMBER\_ONION\_PATHS};
205 
206     \textcolor{keywordflow}{return} ((onion\_paths->\hyperlink{struct_onion___client___paths_afbee813e09086f6993c94cdaafe2ae36}{last\_path\_success}[pathnum] + ONION\_PATH\_TIMEOUT < onion\_paths->
      last\_path\_used[pathnum]
207              && onion\_paths->\hyperlink{struct_onion___client___paths_a3a947792d864563f1c4d6984cc9c638a}{last\_path\_used\_times}[pathnum] >= 
      \hyperlink{onion__client_8h_add95ff74da07e30fc1fcd518b04403a7}{ONION\_PATH\_MAX\_NO\_RESPONSE\_USES})
208             || \hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(onion\_paths->\hyperlink{struct_onion___client___paths_abc272861ece76f9d9bac356f7297ce3e}{path\_creation\_time}[pathnum], 
      \hyperlink{onion__client_8h_a0e3b30f16437ba0a47672b15f4396eb1}{ONION\_PATH\_MAX\_LIFETIME}));
209 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_a31170965be8e022295d36b508b432a1e_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_a31170965be8e022295d36b508b432a1e_icgraph}
\end{center}
\end{figure}


\hypertarget{onion__client_8c_a18daedee61cc5670d52904fc89e4b32b}{\index{onion\+\_\+client.\+c@{onion\+\_\+client.\+c}!populate\+\_\+path\+\_\+nodes@{populate\+\_\+path\+\_\+nodes}}
\index{populate\+\_\+path\+\_\+nodes@{populate\+\_\+path\+\_\+nodes}!onion\+\_\+client.\+c@{onion\+\_\+client.\+c}}
\subsubsection[{populate\+\_\+path\+\_\+nodes}]{\setlength{\rightskip}{0pt plus 5cm}static void populate\+\_\+path\+\_\+nodes (
\begin{DoxyParamCaption}
\item[{{\bf Onion\+\_\+\+Client} $\ast$}]{onion\+\_\+c}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{onion__client_8c_a18daedee61cc5670d52904fc89e4b32b}


Definition at line 1204 of file onion\+\_\+client.\+c.



References Onion\+\_\+\+Client\+::dht, get\+\_\+close\+\_\+nodes(), i, M\+A\+X\+\_\+\+S\+E\+N\+T\+\_\+\+N\+O\+D\+E\+S, onion\+\_\+add\+\_\+path\+\_\+node(), and make-\/funny-\/savefile\+::public\+\_\+key.



Referenced by do\+\_\+onion\+\_\+client().


\begin{DoxyCode}
1205 \{
1206     \hyperlink{struct_node__format}{Node\_format} nodes\_list[\hyperlink{_d_h_t_8h_a57f4cf16e79a384d7d59a3cc585ea5a3}{MAX\_SENT\_NODES}];
1207     uint8\_t \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}[crypto\_box\_PUBLICKEYBYTES];
1208     uint32\_t random\_num = rand();
1209     memcpy(public\_key, &random\_num, \textcolor{keyword}{sizeof}(random\_num));
1210 
1211     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} num\_nodes = \hyperlink{_d_h_t_8c_a8abfc9cea3784b0cae354670bd4643cd}{get\_close\_nodes}(onion\_c->\hyperlink{struct_onion___client_a8b3d6ce8745acc52695e252bdb1531b6}{dht}, public\_key, nodes\_list, (rand(
      ) % 2) ? AF\_INET : AF\_INET6, 1, 0);
1212     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
1213 
1214     \textcolor{keywordflow}{for} (i = 0; i < num\_nodes; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
1215         \hyperlink{onion__client_8c_a5f6d509093a5e8a3491d21cc21afc7b1}{onion\_add\_path\_node}(onion\_c, nodes\_list[i].ip\_port, nodes\_list[i].public\_key);
1216     \}
1217 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_a18daedee61cc5670d52904fc89e4b32b_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_a18daedee61cc5670d52904fc89e4b32b_icgraph}
\end{center}
\end{figure}


\hypertarget{onion__client_8c_aa10b37a1195f854626985f6707487b2c}{\index{onion\+\_\+client.\+c@{onion\+\_\+client.\+c}!populate\+\_\+path\+\_\+nodes\+\_\+tcp@{populate\+\_\+path\+\_\+nodes\+\_\+tcp}}
\index{populate\+\_\+path\+\_\+nodes\+\_\+tcp@{populate\+\_\+path\+\_\+nodes\+\_\+tcp}!onion\+\_\+client.\+c@{onion\+\_\+client.\+c}}
\subsubsection[{populate\+\_\+path\+\_\+nodes\+\_\+tcp}]{\setlength{\rightskip}{0pt plus 5cm}static void populate\+\_\+path\+\_\+nodes\+\_\+tcp (
\begin{DoxyParamCaption}
\item[{{\bf Onion\+\_\+\+Client} $\ast$}]{onion\+\_\+c}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{onion__client_8c_aa10b37a1195f854626985f6707487b2c}


Definition at line 1219 of file onion\+\_\+client.\+c.



References Onion\+\_\+\+Client\+::c, copy\+\_\+connected\+\_\+tcp\+\_\+relays(), i, M\+A\+X\+\_\+\+S\+E\+N\+T\+\_\+\+N\+O\+D\+E\+S, onion\+\_\+add\+\_\+bs\+\_\+path\+\_\+node(), and make-\/funny-\/savefile\+::public\+\_\+key.



Referenced by do\+\_\+onion\+\_\+client().


\begin{DoxyCode}
1220 \{
1221     \hyperlink{struct_node__format}{Node\_format} nodes\_list[\hyperlink{_d_h_t_8h_a57f4cf16e79a384d7d59a3cc585ea5a3}{MAX\_SENT\_NODES}];
1222 
1223     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} num\_nodes = \hyperlink{net__crypto_8c_ac398e442ae77ace2af0156b9ce7f604c}{copy\_connected\_tcp\_relays}(onion\_c->
      \hyperlink{struct_onion___client_a0f5b9349eb586149cef9017eed2abdfe}{c}, nodes\_list, \hyperlink{_d_h_t_8h_a57f4cf16e79a384d7d59a3cc585ea5a3}{MAX\_SENT\_NODES});;
1224     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
1225 
1226     \textcolor{keywordflow}{for} (i = 0; i < num\_nodes; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
1227         \hyperlink{onion__client_8c_accbc9c20b5933ea088d718ea09abd6b8}{onion\_add\_bs\_path\_node}(onion\_c, nodes\_list[i].ip\_port, nodes\_list[i].
      \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key});
1228     \}
1229 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_aa10b37a1195f854626985f6707487b2c_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_aa10b37a1195f854626985f6707487b2c_icgraph}
\end{center}
\end{figure}


\hypertarget{onion__client_8c_a62aaed2b6aee07c4c0fb8ffd97a03172}{\index{onion\+\_\+client.\+c@{onion\+\_\+client.\+c}!random\+\_\+nodes\+\_\+path\+\_\+onion@{random\+\_\+nodes\+\_\+path\+\_\+onion}}
\index{random\+\_\+nodes\+\_\+path\+\_\+onion@{random\+\_\+nodes\+\_\+path\+\_\+onion}!onion\+\_\+client.\+c@{onion\+\_\+client.\+c}}
\subsubsection[{random\+\_\+nodes\+\_\+path\+\_\+onion}]{\setlength{\rightskip}{0pt plus 5cm}static uint16\+\_\+t random\+\_\+nodes\+\_\+path\+\_\+onion (
\begin{DoxyParamCaption}
\item[{const {\bf Onion\+\_\+\+Client} $\ast$}]{onion\+\_\+c, }
\item[{{\bf Node\+\_\+format} $\ast$}]{nodes, }
\item[{uint16\+\_\+t}]{max\+\_\+num}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{onion__client_8c_a62aaed2b6aee07c4c0fb8ffd97a03172}


Definition at line 126 of file onion\+\_\+client.\+c.



References Onion\+\_\+\+Client\+::c, Onion\+\_\+\+Client\+::dht, D\+H\+T\+\_\+isconnected(), I\+P\+::family, get\+\_\+random\+\_\+tcp\+\_\+con\+\_\+number(), i, I\+P\+\_\+\+Port\+::ip, I\+P\+::ip4, Node\+\_\+format\+::ip\+\_\+port, M\+A\+X\+\_\+\+P\+A\+T\+H\+\_\+\+N\+O\+D\+E\+S, Onion\+\_\+\+Client\+::path\+\_\+nodes, Onion\+\_\+\+Client\+::path\+\_\+nodes\+\_\+bs, Onion\+\_\+\+Client\+::path\+\_\+nodes\+\_\+index, Onion\+\_\+\+Client\+::path\+\_\+nodes\+\_\+index\+\_\+bs, T\+C\+P\+\_\+\+F\+A\+M\+I\+L\+Y, and I\+P4\+::uint32.



Referenced by random\+\_\+path().


\begin{DoxyCode}
127 \{
128     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
129 
130     \textcolor{keywordflow}{if} (!max\_num)
131         \textcolor{keywordflow}{return} 0;
132 
133     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} num\_nodes = (onion\_c->\hyperlink{struct_onion___client_aaeb9402a72e98e04eb5cbc4ff0aac70e}{path\_nodes\_index} < 
      \hyperlink{onion__client_8h_ac5f0e3c41d8db63d3af45c98df53d719}{MAX\_PATH\_NODES}) ? onion\_c->\hyperlink{struct_onion___client_aaeb9402a72e98e04eb5cbc4ff0aac70e}{path\_nodes\_index} : 
      \hyperlink{onion__client_8h_ac5f0e3c41d8db63d3af45c98df53d719}{MAX\_PATH\_NODES};
134 
135     \textcolor{comment}{//if (DHT\_non\_lan\_connected(onion\_c->dht)) \{}
136     if (\hyperlink{_d_h_t_8c_a93770fe498d41d1c6b420275680967b6}{DHT\_isconnected}(onion\_c->\hyperlink{struct_onion___client_a8b3d6ce8745acc52695e252bdb1531b6}{dht})) \{
137         \textcolor{keywordflow}{if} (num\_nodes == 0)
138             \textcolor{keywordflow}{return} 0;
139 
140         \textcolor{keywordflow}{for} (i = 0; i < max\_num; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
141             nodes[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}] = onion\_c->\hyperlink{struct_onion___client_a1baee18cb7db8dad6b0847fa977b7f16}{path\_nodes}[rand() % num\_nodes];
142         \}
143     \} \textcolor{keywordflow}{else} \{
144         \textcolor{keywordtype}{int} random\_tcp = \hyperlink{net__crypto_8c_ad1a4103f75eb81ae93a0f1701b259db0}{get\_random\_tcp\_con\_number}(onion\_c->
      \hyperlink{struct_onion___client_a0f5b9349eb586149cef9017eed2abdfe}{c});
145 
146         \textcolor{keywordflow}{if} (random\_tcp == -1) \{
147             \textcolor{keywordflow}{return} 0;
148         \}
149 
150         \textcolor{keywordflow}{if} (num\_nodes >= 2) \{
151             nodes[0].\hyperlink{struct_node__format_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} = \hyperlink{network_8h_a8b8d4bdf23eea1681ac4126938f587ec}{TCP\_FAMILY};
152             nodes[0].\hyperlink{struct_node__format_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_aca19646000f55aa927406e68fc41ecf9}{ip4}.\hyperlink{union_i_p4_a5ad776be1fb768f3399aafcd1b58b3a2}{uint32} = random\_tcp;
153 
154             \textcolor{keywordflow}{for} (i = 1; i < max\_num; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
155                 nodes[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}] = onion\_c->\hyperlink{struct_onion___client_a1baee18cb7db8dad6b0847fa977b7f16}{path\_nodes}[rand() % num\_nodes];
156             \}
157         \} \textcolor{keywordflow}{else} \{
158             \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} num\_nodes\_bs = (onion\_c->\hyperlink{struct_onion___client_aa6cb02170665d966dec231613d9d229e}{path\_nodes\_index\_bs} < 
      \hyperlink{onion__client_8h_ac5f0e3c41d8db63d3af45c98df53d719}{MAX\_PATH\_NODES}) ? onion\_c->\hyperlink{struct_onion___client_aa6cb02170665d966dec231613d9d229e}{path\_nodes\_index\_bs} :
159                                         \hyperlink{onion__client_8h_ac5f0e3c41d8db63d3af45c98df53d719}{MAX\_PATH\_NODES};
160 
161             if (num\_nodes\_bs == 0)
162                 \textcolor{keywordflow}{return} 0;
163 
164             nodes[0].\hyperlink{struct_node__format_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} = \hyperlink{network_8h_a8b8d4bdf23eea1681ac4126938f587ec}{TCP\_FAMILY};
165             nodes[0].\hyperlink{struct_node__format_a86e2a5a56c0dd22df6e8b8a10e40f9e4}{ip\_port}.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_aca19646000f55aa927406e68fc41ecf9}{ip4}.\hyperlink{union_i_p4_a5ad776be1fb768f3399aafcd1b58b3a2}{uint32} = random\_tcp;
166 
167             \textcolor{keywordflow}{for} (i = 1; i < max\_num; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
168                 nodes[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}] = onion\_c->\hyperlink{struct_onion___client_adc82bddd48395ce29a9d609cd6f39a12}{path\_nodes\_bs}[rand() % num\_nodes\_bs];
169             \}
170         \}
171     \}
172 
173     \textcolor{keywordflow}{return} max\_num;
174 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_a62aaed2b6aee07c4c0fb8ffd97a03172_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_a62aaed2b6aee07c4c0fb8ffd97a03172_icgraph}
\end{center}
\end{figure}


\hypertarget{onion__client_8c_a0ec6065dac34021e69682691f70b667c}{\index{onion\+\_\+client.\+c@{onion\+\_\+client.\+c}!random\+\_\+path@{random\+\_\+path}}
\index{random\+\_\+path@{random\+\_\+path}!onion\+\_\+client.\+c@{onion\+\_\+client.\+c}}
\subsubsection[{random\+\_\+path}]{\setlength{\rightskip}{0pt plus 5cm}static int random\+\_\+path (
\begin{DoxyParamCaption}
\item[{const {\bf Onion\+\_\+\+Client} $\ast$}]{onion\+\_\+c, }
\item[{{\bf Onion\+\_\+\+Client\+\_\+\+Paths} $\ast$}]{onion\+\_\+paths, }
\item[{uint32\+\_\+t}]{pathnum, }
\item[{{\bf Onion\+\_\+\+Path} $\ast$}]{path}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{onion__client_8c_a0ec6065dac34021e69682691f70b667c}


Definition at line 220 of file onion\+\_\+client.\+c.



References create\+\_\+onion\+\_\+path(), Onion\+\_\+\+Client\+::dht, is\+\_\+path\+\_\+used(), Onion\+\_\+\+Client\+\_\+\+Paths\+::last\+\_\+path\+\_\+success, Onion\+\_\+\+Client\+\_\+\+Paths\+::last\+\_\+path\+\_\+used, Onion\+\_\+\+Client\+\_\+\+Paths\+::last\+\_\+path\+\_\+used\+\_\+times, N\+U\+M\+B\+E\+R\+\_\+\+O\+N\+I\+O\+N\+\_\+\+P\+A\+T\+H\+S, O\+N\+I\+O\+N\+\_\+\+P\+A\+T\+H\+\_\+\+F\+I\+R\+S\+T\+\_\+\+T\+I\+M\+E\+O\+U\+T, O\+N\+I\+O\+N\+\_\+\+P\+A\+T\+H\+\_\+\+L\+E\+N\+G\+T\+H, O\+N\+I\+O\+N\+\_\+\+P\+A\+T\+H\+\_\+\+M\+A\+X\+\_\+\+N\+O\+\_\+\+R\+E\+S\+P\+O\+N\+S\+E\+\_\+\+U\+S\+E\+S, O\+N\+I\+O\+N\+\_\+\+P\+A\+T\+H\+\_\+\+T\+I\+M\+E\+O\+U\+T, Onion\+\_\+\+Client\+\_\+\+Paths\+::path\+\_\+creation\+\_\+time, Onion\+\_\+\+Path\+::path\+\_\+num, path\+\_\+timed\+\_\+out(), Onion\+\_\+\+Client\+\_\+\+Paths\+::paths, random\+\_\+nodes\+\_\+path\+\_\+onion(), and unix\+\_\+time().



Referenced by client\+\_\+send\+\_\+announce\+\_\+request(), and send\+\_\+onion\+\_\+data().


\begin{DoxyCode}
221 \{
222     \textcolor{keywordflow}{if} (pathnum == UINT32\_MAX) \{
223         pathnum = rand() % \hyperlink{onion__client_8h_a69d73a99a8788ce76768d6cd589da123}{NUMBER\_ONION\_PATHS};
224     \} \textcolor{keywordflow}{else} \{
225         pathnum = pathnum % \hyperlink{onion__client_8h_a69d73a99a8788ce76768d6cd589da123}{NUMBER\_ONION\_PATHS};
226     \}
227 
228     \textcolor{keywordflow}{if} (\hyperlink{onion__client_8c_a31170965be8e022295d36b508b432a1e}{path\_timed\_out}(onion\_paths, pathnum)) \{
229         \hyperlink{struct_node__format}{Node\_format} nodes[\hyperlink{onion_8h_abe0dd1f2cbadfda52425e7c2fed7d8c3}{ONION\_PATH\_LENGTH}];
230 
231         \textcolor{keywordflow}{if} (\hyperlink{onion__client_8c_a62aaed2b6aee07c4c0fb8ffd97a03172}{random\_nodes\_path\_onion}(onion\_c, nodes, 
      \hyperlink{onion_8h_abe0dd1f2cbadfda52425e7c2fed7d8c3}{ONION\_PATH\_LENGTH}) != \hyperlink{onion_8h_abe0dd1f2cbadfda52425e7c2fed7d8c3}{ONION\_PATH\_LENGTH})
232             \textcolor{keywordflow}{return} -1;
233 
234         \textcolor{keywordtype}{int} n = \hyperlink{onion__client_8c_ae8d66f9bb925deae2911c9c00a9a9dc9}{is\_path\_used}(onion\_paths, nodes);
235 
236         \textcolor{keywordflow}{if} (n == -1) \{
237             \textcolor{keywordflow}{if} (\hyperlink{onion_8c_a2637801832f6ad6ad6fce79e76565d84}{create\_onion\_path}(onion\_c->\hyperlink{struct_onion___client_a8b3d6ce8745acc52695e252bdb1531b6}{dht}, &onion\_paths->
      \hyperlink{struct_onion___client___paths_afaa8c1f23d89bd5acee1f956e8872061}{paths}[pathnum], nodes) == -1)
238                 \textcolor{keywordflow}{return} -1;
239 
240             onion\_paths->\hyperlink{struct_onion___client___paths_afbee813e09086f6993c94cdaafe2ae36}{last\_path\_success}[pathnum] = \hyperlink{util_8c_ac958d9f8847cb8039444bfa3d304233a}{unix\_time}() + 
      \hyperlink{onion__client_8h_a4fc1aa49d1de137b0e5d5ccb5ec6f42b}{ONION\_PATH\_FIRST\_TIMEOUT} - \hyperlink{onion__client_8h_abfe3e118c0cdb63720124be77c6d10a8}{ONION\_PATH\_TIMEOUT};
241             onion\_paths->\hyperlink{struct_onion___client___paths_abc272861ece76f9d9bac356f7297ce3e}{path\_creation\_time}[pathnum] = 
      \hyperlink{util_8c_ac958d9f8847cb8039444bfa3d304233a}{unix\_time}();
242             onion\_paths->\hyperlink{struct_onion___client___paths_a3a947792d864563f1c4d6984cc9c638a}{last\_path\_used\_times}[pathnum] = 
      \hyperlink{onion__client_8h_add95ff74da07e30fc1fcd518b04403a7}{ONION\_PATH\_MAX\_NO\_RESPONSE\_USES} / 2;
243 
244             uint32\_t path\_num = rand();
245             path\_num /= \hyperlink{onion__client_8h_a69d73a99a8788ce76768d6cd589da123}{NUMBER\_ONION\_PATHS};
246             path\_num *= \hyperlink{onion__client_8h_a69d73a99a8788ce76768d6cd589da123}{NUMBER\_ONION\_PATHS};
247             path\_num += pathnum;
248 
249             onion\_paths->\hyperlink{struct_onion___client___paths_afaa8c1f23d89bd5acee1f956e8872061}{paths}[pathnum].\hyperlink{struct_onion___path_a6d69f3ea5100411c3599020055b8b78c}{path\_num} = path\_num;
250         \} \textcolor{keywordflow}{else} \{
251             pathnum = n;
252         \}
253     \}
254 
255     ++onion\_paths->\hyperlink{struct_onion___client___paths_a3a947792d864563f1c4d6984cc9c638a}{last\_path\_used\_times}[pathnum];
256     onion\_paths->\hyperlink{struct_onion___client___paths_a3e3d1429ce10f2adad7b1c02df8f5417}{last\_path\_used}[pathnum] = \hyperlink{util_8c_ac958d9f8847cb8039444bfa3d304233a}{unix\_time}();
257     memcpy(path, &onion\_paths->\hyperlink{struct_onion___client___paths_afaa8c1f23d89bd5acee1f956e8872061}{paths}[pathnum], \textcolor{keyword}{sizeof}(\hyperlink{struct_onion___path}{Onion\_Path}));
258     \textcolor{keywordflow}{return} 0;
259 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_a0ec6065dac34021e69682691f70b667c_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_a0ec6065dac34021e69682691f70b667c_icgraph}
\end{center}
\end{figure}


\hypertarget{onion__client_8c_aa5f27f182606ab701dfc948bfb3a1b42}{\index{onion\+\_\+client.\+c@{onion\+\_\+client.\+c}!realloc\+\_\+onion\+\_\+friends@{realloc\+\_\+onion\+\_\+friends}}
\index{realloc\+\_\+onion\+\_\+friends@{realloc\+\_\+onion\+\_\+friends}!onion\+\_\+client.\+c@{onion\+\_\+client.\+c}}
\subsubsection[{realloc\+\_\+onion\+\_\+friends}]{\setlength{\rightskip}{0pt plus 5cm}static int realloc\+\_\+onion\+\_\+friends (
\begin{DoxyParamCaption}
\item[{{\bf Onion\+\_\+\+Client} $\ast$}]{onion\+\_\+c, }
\item[{uint32\+\_\+t}]{num}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{onion__client_8c_aa5f27f182606ab701dfc948bfb3a1b42}


Definition at line 988 of file onion\+\_\+client.\+c.



References Onion\+\_\+\+Client\+::friends\+\_\+list.



Referenced by kill\+\_\+onion\+\_\+client(), onion\+\_\+addfriend(), and onion\+\_\+delfriend().


\begin{DoxyCode}
989 \{
990     \textcolor{keywordflow}{if} (\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num} == 0) \{
991         free(onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list});
992         onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list} = NULL;
993         \textcolor{keywordflow}{return} 0;
994     \}
995 
996     \hyperlink{struct_onion___friend}{Onion\_Friend} *newonion\_friends = realloc(onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}, 
      \hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num} * \textcolor{keyword}{sizeof}(\hyperlink{struct_onion___friend}{Onion\_Friend}));
997 
998     \textcolor{keywordflow}{if} (newonion\_friends == NULL)
999         \textcolor{keywordflow}{return} -1;
1000 
1001     onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list} = newonion\_friends;
1002     \textcolor{keywordflow}{return} 0;
1003 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_aa5f27f182606ab701dfc948bfb3a1b42_icgraph}
\end{center}
\end{figure}


\hypertarget{onion__client_8c_a7bb680d62616d0dfbb6f7d2ff097107c}{\index{onion\+\_\+client.\+c@{onion\+\_\+client.\+c}!recv\+\_\+tcp\+\_\+relay\+\_\+handler@{recv\+\_\+tcp\+\_\+relay\+\_\+handler}}
\index{recv\+\_\+tcp\+\_\+relay\+\_\+handler@{recv\+\_\+tcp\+\_\+relay\+\_\+handler}!onion\+\_\+client.\+c@{onion\+\_\+client.\+c}}
\subsubsection[{recv\+\_\+tcp\+\_\+relay\+\_\+handler}]{\setlength{\rightskip}{0pt plus 5cm}int recv\+\_\+tcp\+\_\+relay\+\_\+handler (
\begin{DoxyParamCaption}
\item[{{\bf Onion\+\_\+\+Client} $\ast$}]{onion\+\_\+c, }
\item[{int}]{friend\+\_\+num, }
\item[{int($\ast$)(void $\ast$object, uint32\+\_\+t number, {\bf I\+P\+\_\+\+Port} ip\+\_\+port, const uint8\+\_\+t $\ast$public\+\_\+key)}]{tcp\+\_\+relay\+\_\+node\+\_\+callback, }
\item[{void $\ast$}]{object, }
\item[{uint32\+\_\+t}]{number}
\end{DoxyParamCaption}
)}}\label{onion__client_8c_a7bb680d62616d0dfbb6f7d2ff097107c}


Definition at line 1078 of file onion\+\_\+client.\+c.



References Onion\+\_\+\+Client\+::friends\+\_\+list, Onion\+\_\+\+Client\+::num\+\_\+friends, Onion\+\_\+\+Friend\+::tcp\+\_\+relay\+\_\+node\+\_\+callback, tcp\+\_\+relay\+\_\+node\+\_\+callback(), Onion\+\_\+\+Friend\+::tcp\+\_\+relay\+\_\+node\+\_\+callback\+\_\+number, and Onion\+\_\+\+Friend\+::tcp\+\_\+relay\+\_\+node\+\_\+callback\+\_\+object.



Referenced by new\+\_\+friend\+\_\+connection().


\begin{DoxyCode}
1080 \{
1081     \textcolor{keywordflow}{if} ((uint32\_t)friend\_num >= onion\_c->\hyperlink{struct_onion___client_a8ee1f2d7e543bce350c591a8eaac0cf8}{num\_friends})
1082         \textcolor{keywordflow}{return} -1;
1083 
1084     onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[friend\_num].\hyperlink{struct_onion___friend_a62001c45ecd44d4c6321ca2358f4df5f}{tcp\_relay\_node\_callback} = 
      \hyperlink{friend__connection_8c_a9360ec098f2b1082b480b4e36b0a5f07}{tcp\_relay\_node\_callback};
1085     onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[friend\_num].\hyperlink{struct_onion___friend_a0da74cebd5ec2859b1de5db74c0dc528}{tcp\_relay\_node\_callback\_object}
       = object;
1086     onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[friend\_num].\hyperlink{struct_onion___friend_ab673fb84fe578fb5e7848f9f04c093cf}{tcp\_relay\_node\_callback\_number}
       = number;
1087     \textcolor{keywordflow}{return} 0;
1088 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_a7bb680d62616d0dfbb6f7d2ff097107c_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_a7bb680d62616d0dfbb6f7d2ff097107c_icgraph}
\end{center}
\end{figure}


\hypertarget{onion__client_8c_a35bf565e3fc2b84ba3434d7cb38ba0e4}{\index{onion\+\_\+client.\+c@{onion\+\_\+client.\+c}!send\+\_\+dht\+\_\+dhtpk@{send\+\_\+dht\+\_\+dhtpk}}
\index{send\+\_\+dht\+\_\+dhtpk@{send\+\_\+dht\+\_\+dhtpk}!onion\+\_\+client.\+c@{onion\+\_\+client.\+c}}
\subsubsection[{send\+\_\+dht\+\_\+dhtpk}]{\setlength{\rightskip}{0pt plus 5cm}static int send\+\_\+dht\+\_\+dhtpk (
\begin{DoxyParamCaption}
\item[{const {\bf Onion\+\_\+\+Client} $\ast$}]{onion\+\_\+c, }
\item[{int}]{friend\+\_\+num, }
\item[{const uint8\+\_\+t $\ast$}]{data, }
\item[{uint16\+\_\+t}]{length}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{onion__client_8c_a35bf565e3fc2b84ba3434d7cb38ba0e4}


Definition at line 858 of file onion\+\_\+client.\+c.



References Onion\+\_\+\+Client\+::c, create\+\_\+request(), C\+R\+Y\+P\+T\+O\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+D\+H\+T\+P\+K, D\+A\+T\+A\+\_\+\+I\+N\+\_\+\+R\+E\+S\+P\+O\+N\+S\+E\+\_\+\+M\+I\+N\+\_\+\+S\+I\+Z\+E, Onion\+\_\+\+Client\+::dht, Onion\+\_\+\+Friend\+::dht\+\_\+public\+\_\+key, encrypt\+\_\+data(), Onion\+\_\+\+Client\+::friends\+\_\+list, Onion\+\_\+\+Friend\+::know\+\_\+dht\+\_\+public\+\_\+key, M\+A\+X\+\_\+\+C\+R\+Y\+P\+T\+O\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+S\+I\+Z\+E, new\+\_\+nonce(), nonce, Onion\+\_\+\+Client\+::num\+\_\+friends, Onion\+\_\+\+Friend\+::real\+\_\+public\+\_\+key, route\+\_\+tofriend(), Net\+\_\+\+Crypto\+::self\+\_\+public\+\_\+key, D\+H\+T\+::self\+\_\+public\+\_\+key, Net\+\_\+\+Crypto\+::self\+\_\+secret\+\_\+key, and D\+H\+T\+::self\+\_\+secret\+\_\+key.



Referenced by send\+\_\+dhtpk\+\_\+announce().


\begin{DoxyCode}
859 \{
860     \textcolor{keywordflow}{if} ((uint32\_t)friend\_num >= onion\_c->\hyperlink{struct_onion___client_a8ee1f2d7e543bce350c591a8eaac0cf8}{num\_friends})
861         \textcolor{keywordflow}{return} -1;
862 
863     \textcolor{keywordflow}{if} (!onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[friend\_num].\hyperlink{struct_onion___friend_a1b66769a2b6f8e5c7306ffcfb7ac0956}{know\_dht\_public\_key})
864         \textcolor{keywordflow}{return} -1;
865 
866     uint8\_t \hyperlink{crypto__test_8c_a7932c523f7065073a396e571319201ce}{nonce}[crypto\_box\_NONCEBYTES];
867     \hyperlink{crypto__core_8c_a8b1033efb47c625779d11be7d8eb9e24}{new\_nonce}(nonce);
868 
869     uint8\_t temp[\hyperlink{onion__client_8c_ab7a046054431d84cc9e9c0404ebc5002}{DATA\_IN\_RESPONSE\_MIN\_SIZE} + crypto\_box\_NONCEBYTES + length];
870     memcpy(temp, onion\_c->\hyperlink{struct_onion___client_a0f5b9349eb586149cef9017eed2abdfe}{c}->\hyperlink{struct_net___crypto_ae726df8bdc26380e5a6c3187a00d6881}{self\_public\_key}, crypto\_box\_PUBLICKEYBYTES);
871     memcpy(temp + crypto\_box\_PUBLICKEYBYTES, nonce, crypto\_box\_NONCEBYTES);
872     \textcolor{keywordtype}{int} len = \hyperlink{crypto__core_8c_a014149333522d211490304255e139ec3}{encrypt\_data}(onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[friend\_num].
      \hyperlink{struct_onion___friend_a996dcaefa2a5954a199e2beb584c1feb}{real\_public\_key}, onion\_c->\hyperlink{struct_onion___client_a0f5b9349eb586149cef9017eed2abdfe}{c}->\hyperlink{struct_net___crypto_aa05050f86513ff53fe9da81f73c72267}{self\_secret\_key}, nonce, 
      \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data},
873                            length, temp + crypto\_box\_PUBLICKEYBYTES + crypto\_box\_NONCEBYTES);
874 
875     \textcolor{keywordflow}{if} ((uint32\_t)len + crypto\_box\_PUBLICKEYBYTES + crypto\_box\_NONCEBYTES != \textcolor{keyword}{sizeof}(temp))
876         \textcolor{keywordflow}{return} -1;
877 
878     uint8\_t packet[\hyperlink{crypto__core_8h_a2c79bc4b1111d42efd5fa7600398afcc}{MAX\_CRYPTO\_REQUEST\_SIZE}];
879     len = \hyperlink{crypto__core_8c_a73129647dfd9e436ae6abc908daa4c21}{create\_request}(onion\_c->\hyperlink{struct_onion___client_a8b3d6ce8745acc52695e252bdb1531b6}{dht}->\hyperlink{struct_d_h_t_ae726df8bdc26380e5a6c3187a00d6881}{self\_public\_key}, onion\_c->
      \hyperlink{struct_onion___client_a8b3d6ce8745acc52695e252bdb1531b6}{dht}->\hyperlink{struct_d_h_t_aa05050f86513ff53fe9da81f73c72267}{self\_secret\_key}, packet,
880                          onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[friend\_num].
      \hyperlink{struct_onion___friend_ab2ecaa07625ad0ed5e07d3a1f0dcc939}{dht\_public\_key}, temp, \textcolor{keyword}{sizeof}(temp), \hyperlink{crypto__core_8h_a9c7c84cef4b149dce556b4c78e33dd6b}{CRYPTO\_PACKET\_DHTPK});
881 
882     \textcolor{keywordflow}{if} (len == -1)
883         \textcolor{keywordflow}{return} -1;
884 
885     \textcolor{keywordflow}{return} \hyperlink{_d_h_t_8c_aee23d763e291eefd141227cd9e3684ab}{route\_tofriend}(onion\_c->\hyperlink{struct_onion___client_a8b3d6ce8745acc52695e252bdb1531b6}{dht}, onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[friend\_num].
      \hyperlink{struct_onion___friend_ab2ecaa07625ad0ed5e07d3a1f0dcc939}{dht\_public\_key}, packet, len);
886 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_a35bf565e3fc2b84ba3434d7cb38ba0e4_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_a35bf565e3fc2b84ba3434d7cb38ba0e4_icgraph}
\end{center}
\end{figure}


\hypertarget{onion__client_8c_a64e317f7dd22c983c325f62aed9ecfae}{\index{onion\+\_\+client.\+c@{onion\+\_\+client.\+c}!send\+\_\+dhtpk\+\_\+announce@{send\+\_\+dhtpk\+\_\+announce}}
\index{send\+\_\+dhtpk\+\_\+announce@{send\+\_\+dhtpk\+\_\+announce}!onion\+\_\+client.\+c@{onion\+\_\+client.\+c}}
\subsubsection[{send\+\_\+dhtpk\+\_\+announce}]{\setlength{\rightskip}{0pt plus 5cm}static int send\+\_\+dhtpk\+\_\+announce (
\begin{DoxyParamCaption}
\item[{{\bf Onion\+\_\+\+Client} $\ast$}]{onion\+\_\+c, }
\item[{uint16\+\_\+t}]{friend\+\_\+num, }
\item[{uint8\+\_\+t}]{onion\+\_\+dht\+\_\+both}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{onion__client_8c_a64e317f7dd22c983c325f62aed9ecfae}


Definition at line 921 of file onion\+\_\+client.\+c.



References Onion\+\_\+\+Client\+::c, closelist\+\_\+nodes(), copy\+\_\+connected\+\_\+tcp\+\_\+relays(), make-\/funny-\/savefile\+::data, Onion\+\_\+\+Client\+::dht, D\+H\+T\+P\+K\+\_\+\+D\+A\+T\+A\+\_\+\+M\+A\+X\+\_\+\+L\+E\+N\+G\+T\+H, D\+H\+T\+P\+K\+\_\+\+D\+A\+T\+A\+\_\+\+M\+I\+N\+\_\+\+L\+E\+N\+G\+T\+H, host\+\_\+to\+\_\+net(), M\+A\+X\+\_\+\+S\+E\+N\+T\+\_\+\+N\+O\+D\+E\+S, Onion\+\_\+\+Client\+::num\+\_\+friends, O\+N\+I\+O\+N\+\_\+\+D\+A\+T\+A\+\_\+\+D\+H\+T\+P\+K, pack\+\_\+nodes(), D\+H\+T\+::self\+\_\+public\+\_\+key, send\+\_\+dht\+\_\+dhtpk(), send\+\_\+onion\+\_\+data(), and unix\+\_\+time().



Referenced by do\+\_\+friend().


\begin{DoxyCode}
922 \{
923     \textcolor{keywordflow}{if} (friend\_num >= onion\_c->\hyperlink{struct_onion___client_a8ee1f2d7e543bce350c591a8eaac0cf8}{num\_friends})
924         \textcolor{keywordflow}{return} -1;
925 
926     uint8\_t \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[\hyperlink{onion__client_8c_a33fc9507f55ea8592e426f78dfe70f79}{DHTPK\_DATA\_MAX\_LENGTH}];
927     data[0] = \hyperlink{onion__client_8h_a6a9200c8776f22228852fcd9360c814d}{ONION\_DATA\_DHTPK};
928     uint64\_t no\_replay = \hyperlink{util_8c_ac958d9f8847cb8039444bfa3d304233a}{unix\_time}();
929     \hyperlink{util_8c_aa199044077924fcae89d59d2a5af5629}{host\_to\_net}((uint8\_t *)&no\_replay, \textcolor{keyword}{sizeof}(no\_replay));
930     memcpy(data + 1, &no\_replay, \textcolor{keyword}{sizeof}(no\_replay));
931     memcpy(data + 1 + \textcolor{keyword}{sizeof}(uint64\_t), onion\_c->\hyperlink{struct_onion___client_a8b3d6ce8745acc52695e252bdb1531b6}{dht}->\hyperlink{struct_d_h_t_ae726df8bdc26380e5a6c3187a00d6881}{self\_public\_key}, 
      crypto\_box\_PUBLICKEYBYTES);
932     \hyperlink{struct_node__format}{Node\_format} nodes[\hyperlink{_d_h_t_8h_a57f4cf16e79a384d7d59a3cc585ea5a3}{MAX\_SENT\_NODES}];
933     uint16\_t num\_relays = \hyperlink{net__crypto_8c_ac398e442ae77ace2af0156b9ce7f604c}{copy\_connected\_tcp\_relays}(onion\_c->
      \hyperlink{struct_onion___client_a0f5b9349eb586149cef9017eed2abdfe}{c}, nodes, (\hyperlink{_d_h_t_8h_a57f4cf16e79a384d7d59a3cc585ea5a3}{MAX\_SENT\_NODES} / 2));
934     uint16\_t num\_nodes = \hyperlink{_d_h_t_8c_a2b03f88384f04514e392abd12ef30140}{closelist\_nodes}(onion\_c->\hyperlink{struct_onion___client_a8b3d6ce8745acc52695e252bdb1531b6}{dht}, &nodes[num\_relays], 
      \hyperlink{_d_h_t_8h_a57f4cf16e79a384d7d59a3cc585ea5a3}{MAX\_SENT\_NODES} - num\_relays);
935     num\_nodes += num\_relays;
936     \textcolor{keywordtype}{int} nodes\_len = 0;
937 
938     \textcolor{keywordflow}{if} (num\_nodes != 0) \{
939         nodes\_len = \hyperlink{_d_h_t_8c_a1d6f2fcb008c989f333ae89e840f94b4}{pack\_nodes}(data + \hyperlink{onion__client_8c_a76335ad8705aea17b952e4993fef52ff}{DHTPK\_DATA\_MIN\_LENGTH}, 
      \hyperlink{onion__client_8c_a33fc9507f55ea8592e426f78dfe70f79}{DHTPK\_DATA\_MAX\_LENGTH} - \hyperlink{onion__client_8c_a76335ad8705aea17b952e4993fef52ff}{DHTPK\_DATA\_MIN\_LENGTH}, nodes,
940                                num\_nodes);
941 
942         \textcolor{keywordflow}{if} (nodes\_len <= 0)
943             \textcolor{keywordflow}{return} -1;
944     \}
945 
946     \textcolor{keywordtype}{int} num1 = -1, num2 = -1;
947 
948     \textcolor{keywordflow}{if} (onion\_dht\_both != 1)
949         num1 = \hyperlink{onion__client_8c_aa1be42b5ea93bd068f47271831157927}{send\_onion\_data}(onion\_c, friend\_num, data, 
      \hyperlink{onion__client_8c_a76335ad8705aea17b952e4993fef52ff}{DHTPK\_DATA\_MIN\_LENGTH} + nodes\_len);
950 
951     \textcolor{keywordflow}{if} (onion\_dht\_both != 0)
952         num2 = \hyperlink{onion__client_8c_a35bf565e3fc2b84ba3434d7cb38ba0e4}{send\_dht\_dhtpk}(onion\_c, friend\_num, data, 
      \hyperlink{onion__client_8c_a76335ad8705aea17b952e4993fef52ff}{DHTPK\_DATA\_MIN\_LENGTH} + nodes\_len);
953 
954     \textcolor{keywordflow}{if} (num1 == -1)
955         \textcolor{keywordflow}{return} num2;
956 
957     \textcolor{keywordflow}{if} (num2 == -1)
958         \textcolor{keywordflow}{return} num1;
959 
960     \textcolor{keywordflow}{return} num1 + num2;
961 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_a64e317f7dd22c983c325f62aed9ecfae_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_a64e317f7dd22c983c325f62aed9ecfae_icgraph}
\end{center}
\end{figure}


\hypertarget{onion__client_8c_aa1be42b5ea93bd068f47271831157927}{\index{onion\+\_\+client.\+c@{onion\+\_\+client.\+c}!send\+\_\+onion\+\_\+data@{send\+\_\+onion\+\_\+data}}
\index{send\+\_\+onion\+\_\+data@{send\+\_\+onion\+\_\+data}!onion\+\_\+client.\+c@{onion\+\_\+client.\+c}}
\subsubsection[{send\+\_\+onion\+\_\+data}]{\setlength{\rightskip}{0pt plus 5cm}int send\+\_\+onion\+\_\+data (
\begin{DoxyParamCaption}
\item[{{\bf Onion\+\_\+\+Client} $\ast$}]{onion\+\_\+c, }
\item[{int}]{friend\+\_\+num, }
\item[{const uint8\+\_\+t $\ast$}]{data, }
\item[{uint16\+\_\+t}]{length}
\end{DoxyParamCaption}
)}}\label{onion__client_8c_aa1be42b5ea93bd068f47271831157927}


Definition at line 789 of file onion\+\_\+client.\+c.



References Onion\+\_\+\+Client\+::c, Onion\+\_\+\+Friend\+::clients\+\_\+list, create\+\_\+data\+\_\+request(), D\+A\+T\+A\+\_\+\+I\+N\+\_\+\+R\+E\+S\+P\+O\+N\+S\+E\+\_\+\+M\+I\+N\+\_\+\+S\+I\+Z\+E, Onion\+\_\+\+Node\+::data\+\_\+public\+\_\+key, encrypt\+\_\+data(), Onion\+\_\+\+Client\+::friends\+\_\+list, i, is\+\_\+timeout(), M\+A\+X\+\_\+\+D\+A\+T\+A\+\_\+\+R\+E\+Q\+U\+E\+S\+T\+\_\+\+S\+I\+Z\+E, M\+A\+X\+\_\+\+O\+N\+I\+O\+N\+\_\+\+C\+L\+I\+E\+N\+T\+S, nonce, Onion\+\_\+\+Client\+::num\+\_\+friends, O\+N\+I\+O\+N\+\_\+\+M\+A\+X\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+S\+I\+Z\+E, O\+N\+I\+O\+N\+\_\+\+N\+O\+D\+E\+\_\+\+T\+I\+M\+E\+O\+U\+T, Onion\+\_\+\+Client\+::onion\+\_\+paths\+\_\+friends, path, random\+\_\+nonce(), random\+\_\+path(), Onion\+\_\+\+Friend\+::real\+\_\+public\+\_\+key, Net\+\_\+\+Crypto\+::self\+\_\+public\+\_\+key, Net\+\_\+\+Crypto\+::self\+\_\+secret\+\_\+key, and send\+\_\+onion\+\_\+packet\+\_\+tcp\+\_\+udp().



Referenced by send\+\_\+dhtpk\+\_\+announce(), and send\+\_\+friend\+\_\+request\+\_\+packet().


\begin{DoxyCode}
790 \{
791     \textcolor{keywordflow}{if} ((uint32\_t)friend\_num >= onion\_c->\hyperlink{struct_onion___client_a8ee1f2d7e543bce350c591a8eaac0cf8}{num\_friends})
792         \textcolor{keywordflow}{return} -1;
793 
794     \textcolor{keywordflow}{if} (length + \hyperlink{onion__client_8c_ab7a046054431d84cc9e9c0404ebc5002}{DATA\_IN\_RESPONSE\_MIN\_SIZE} > 
      \hyperlink{onion__announce_8h_a31078d9d153443e3ca9b750308d2f5b2}{MAX\_DATA\_REQUEST\_SIZE})
795         \textcolor{keywordflow}{return} -1;
796 
797     \textcolor{keywordflow}{if} (length == 0)
798         \textcolor{keywordflow}{return} -1;
799 
800     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}, good\_nodes[\hyperlink{onion__client_8h_ab1de7815e06277ced6779ba201b0b716}{MAX\_ONION\_CLIENTS}], num\_good = 0, num\_nodes = 0;
801     \hyperlink{struct_onion___node}{Onion\_Node} *list\_nodes = onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[friend\_num].
      \hyperlink{struct_onion___friend_a6797ac2f59ba5ef59a8a70cd6515ca25}{clients\_list};
802 
803     \textcolor{keywordflow}{for} (i = 0; i < \hyperlink{onion__client_8h_ab1de7815e06277ced6779ba201b0b716}{MAX\_ONION\_CLIENTS}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
804         \textcolor{keywordflow}{if} (\hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(list\_nodes[i].timestamp, \hyperlink{onion__client_8h_a96ede75aa4a66f24cefc164af1d4e41d}{ONION\_NODE\_TIMEOUT}))
805             \textcolor{keywordflow}{continue};
806 
807         ++num\_nodes;
808 
809         \textcolor{keywordflow}{if} (list\_nodes[i].is\_stored) \{
810             good\_nodes[num\_good] = \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
811             ++num\_good;
812         \}
813     \}
814 
815     \textcolor{keywordflow}{if} (num\_good < (num\_nodes / 4) + 1)
816         \textcolor{keywordflow}{return} -1;
817 
818     uint8\_t \hyperlink{crypto__test_8c_a7932c523f7065073a396e571319201ce}{nonce}[crypto\_box\_NONCEBYTES];
819     \hyperlink{crypto__core_8c_a15ef255ab026d4881a16b99148b05dd7}{random\_nonce}(nonce);
820 
821     uint8\_t packet[\hyperlink{onion__client_8c_ab7a046054431d84cc9e9c0404ebc5002}{DATA\_IN\_RESPONSE\_MIN\_SIZE} + length];
822     memcpy(packet, onion\_c->\hyperlink{struct_onion___client_a0f5b9349eb586149cef9017eed2abdfe}{c}->\hyperlink{struct_net___crypto_ae726df8bdc26380e5a6c3187a00d6881}{self\_public\_key}, crypto\_box\_PUBLICKEYBYTES);
823     \textcolor{keywordtype}{int} len = \hyperlink{crypto__core_8c_a014149333522d211490304255e139ec3}{encrypt\_data}(onion\_c->\hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[friend\_num].
      \hyperlink{struct_onion___friend_a996dcaefa2a5954a199e2beb584c1feb}{real\_public\_key}, onion\_c->\hyperlink{struct_onion___client_a0f5b9349eb586149cef9017eed2abdfe}{c}->\hyperlink{struct_net___crypto_aa05050f86513ff53fe9da81f73c72267}{self\_secret\_key}, nonce, 
      \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data},
824                            length, packet + crypto\_box\_PUBLICKEYBYTES);
825 
826     \textcolor{keywordflow}{if} ((uint32\_t)len + crypto\_box\_PUBLICKEYBYTES != \textcolor{keyword}{sizeof}(packet))
827         \textcolor{keywordflow}{return} -1;
828 
829     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} good = 0;
830 
831     \textcolor{keywordflow}{for} (i = 0; i < num\_good; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
832         \hyperlink{struct_onion___path}{Onion\_Path} \hyperlink{tox__sync_8c_a6f50c85874ef8f3405625e5a26febbcb}{path};
833 
834         \textcolor{keywordflow}{if} (\hyperlink{onion__client_8c_a0ec6065dac34021e69682691f70b667c}{random\_path}(onion\_c, &onion\_c->\hyperlink{struct_onion___client_a52bae59a292facb41ff98ea0efe8e68f}{onion\_paths\_friends}, ~0, &path) ==
       -1)
835             \textcolor{keywordflow}{continue};
836 
837         uint8\_t o\_packet[\hyperlink{onion_8h_a48fdc4b34dbecf0a3417a557b83a4ff4}{ONION\_MAX\_PACKET\_SIZE}];
838         len = \hyperlink{onion__announce_8c_a036c483b853b8b14de8d1e4256cc59a7}{create\_data\_request}(o\_packet, \textcolor{keyword}{sizeof}(o\_packet), onion\_c->
      \hyperlink{struct_onion___client_ad2d8940ddd914d8b046938ef4f9d313d}{friends\_list}[friend\_num].\hyperlink{struct_onion___friend_a996dcaefa2a5954a199e2beb584c1feb}{real\_public\_key},
839                                   list\_nodes[good\_nodes[i]].\hyperlink{struct_onion___node_add8f6d39a7818b6d3ff0fca42a0aadf4}{data\_public\_key}, nonce, packet, \textcolor{keyword}{
      sizeof}(packet));
840 
841         \textcolor{keywordflow}{if} (len == -1)
842             \textcolor{keywordflow}{continue};
843 
844         \textcolor{keywordflow}{if} (\hyperlink{onion__client_8c_a4be9a76607f006a407f4f96dd49f25da}{send\_onion\_packet\_tcp\_udp}(onion\_c, &path, list\_nodes[good\_nodes[i]].
      ip\_port, o\_packet, len) == 0)
845             ++good;
846     \}
847 
848     \textcolor{keywordflow}{return} good;
849 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_aa1be42b5ea93bd068f47271831157927_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_aa1be42b5ea93bd068f47271831157927_icgraph}
\end{center}
\end{figure}


\hypertarget{onion__client_8c_a4be9a76607f006a407f4f96dd49f25da}{\index{onion\+\_\+client.\+c@{onion\+\_\+client.\+c}!send\+\_\+onion\+\_\+packet\+\_\+tcp\+\_\+udp@{send\+\_\+onion\+\_\+packet\+\_\+tcp\+\_\+udp}}
\index{send\+\_\+onion\+\_\+packet\+\_\+tcp\+\_\+udp@{send\+\_\+onion\+\_\+packet\+\_\+tcp\+\_\+udp}!onion\+\_\+client.\+c@{onion\+\_\+client.\+c}}
\subsubsection[{send\+\_\+onion\+\_\+packet\+\_\+tcp\+\_\+udp}]{\setlength{\rightskip}{0pt plus 5cm}static int send\+\_\+onion\+\_\+packet\+\_\+tcp\+\_\+udp (
\begin{DoxyParamCaption}
\item[{const {\bf Onion\+\_\+\+Client} $\ast$}]{onion\+\_\+c, }
\item[{const {\bf Onion\+\_\+\+Path} $\ast$}]{path, }
\item[{{\bf I\+P\+\_\+\+Port}}]{dest, }
\item[{const uint8\+\_\+t $\ast$}]{data, }
\item[{uint16\+\_\+t}]{length}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{onion__client_8c_a4be9a76607f006a407f4f96dd49f25da}


Definition at line 311 of file onion\+\_\+client.\+c.



References Onion\+\_\+\+Client\+::c, create\+\_\+onion\+\_\+packet(), create\+\_\+onion\+\_\+packet\+\_\+tcp(), I\+P\+::family, I\+P\+\_\+\+Port\+::ip, I\+P\+::ip4, Onion\+\_\+\+Path\+::ip\+\_\+port1, Onion\+\_\+\+Client\+::net, O\+N\+I\+O\+N\+\_\+\+M\+A\+X\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+S\+I\+Z\+E, send\+\_\+tcp\+\_\+onion\+\_\+request(), sendpacket(), T\+C\+P\+\_\+\+F\+A\+M\+I\+L\+Y, and I\+P4\+::uint32.



Referenced by client\+\_\+send\+\_\+announce\+\_\+request(), and send\+\_\+onion\+\_\+data().


\begin{DoxyCode}
313 \{
314     \textcolor{keywordflow}{if} (path->\hyperlink{struct_onion___path_ad7670c0a1a9d05b2a807a9c1a7950b79}{ip\_port1}.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} == AF\_INET || path->\hyperlink{struct_onion___path_ad7670c0a1a9d05b2a807a9c1a7950b79}{ip\_port1}.
      \hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} == AF\_INET6) \{
315         uint8\_t packet[\hyperlink{onion_8h_a48fdc4b34dbecf0a3417a557b83a4ff4}{ONION\_MAX\_PACKET\_SIZE}];
316         \textcolor{keywordtype}{int} len = \hyperlink{onion_8c_a34cf7934690ab5336b99844383a445a8}{create\_onion\_packet}(packet, \textcolor{keyword}{sizeof}(packet), path, dest, 
      \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}, length);
317 
318         \textcolor{keywordflow}{if} (len == -1)
319             \textcolor{keywordflow}{return} -1;
320 
321         \textcolor{keywordflow}{if} (\hyperlink{network_8c_a7b90f87f3ba60cc5c66dd6dd77cd5cb1}{sendpacket}(onion\_c->\hyperlink{struct_onion___client_aa14ea2f67950f57fe4235d7375a2216c}{net}, path->\hyperlink{struct_onion___path_ad7670c0a1a9d05b2a807a9c1a7950b79}{ip\_port1}, packet, len) != len)
322             \textcolor{keywordflow}{return} -1;
323 
324         \textcolor{keywordflow}{return} 0;
325     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (path->\hyperlink{struct_onion___path_ad7670c0a1a9d05b2a807a9c1a7950b79}{ip\_port1}.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} == \hyperlink{network_8h_a8b8d4bdf23eea1681ac4126938f587ec}{TCP\_FAMILY}) \{
326         uint8\_t packet[\hyperlink{onion_8h_a48fdc4b34dbecf0a3417a557b83a4ff4}{ONION\_MAX\_PACKET\_SIZE}];
327         \textcolor{keywordtype}{int} len = \hyperlink{onion_8c_ab04a946f429ee9f9e79ac83e95ec6271}{create\_onion\_packet\_tcp}(packet, \textcolor{keyword}{sizeof}(packet), path, dest, 
      \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}, length);
328 
329         \textcolor{keywordflow}{if} (len == -1)
330             \textcolor{keywordflow}{return} -1;
331 
332         \textcolor{keywordflow}{return} \hyperlink{net__crypto_8c_ae25dcb51c019c3c59fd07da846bbe0df}{send\_tcp\_onion\_request}(onion\_c->\hyperlink{struct_onion___client_a0f5b9349eb586149cef9017eed2abdfe}{c}, path->
      \hyperlink{struct_onion___path_ad7670c0a1a9d05b2a807a9c1a7950b79}{ip\_port1}.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_aca19646000f55aa927406e68fc41ecf9}{ip4}.\hyperlink{union_i_p4_a5ad776be1fb768f3399aafcd1b58b3a2}{uint32}, packet, len);
333     \} \textcolor{keywordflow}{else} \{
334         \textcolor{keywordflow}{return} -1;
335     \}
336 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_a4be9a76607f006a407f4f96dd49f25da_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_a4be9a76607f006a407f4f96dd49f25da_icgraph}
\end{center}
\end{figure}


\hypertarget{onion__client_8c_a79b0950c5eea44ddc315ef8a9b2e47f1}{\index{onion\+\_\+client.\+c@{onion\+\_\+client.\+c}!set\+\_\+path\+\_\+timeouts@{set\+\_\+path\+\_\+timeouts}}
\index{set\+\_\+path\+\_\+timeouts@{set\+\_\+path\+\_\+timeouts}!onion\+\_\+client.\+c@{onion\+\_\+client.\+c}}
\subsubsection[{set\+\_\+path\+\_\+timeouts}]{\setlength{\rightskip}{0pt plus 5cm}static uint32\+\_\+t set\+\_\+path\+\_\+timeouts (
\begin{DoxyParamCaption}
\item[{{\bf Onion\+\_\+\+Client} $\ast$}]{onion\+\_\+c, }
\item[{uint32\+\_\+t}]{num, }
\item[{uint32\+\_\+t}]{path\+\_\+num}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{onion__client_8c_a79b0950c5eea44ddc315ef8a9b2e47f1}


Definition at line 273 of file onion\+\_\+client.\+c.



References i, Onion\+\_\+\+Client\+\_\+\+Paths\+::last\+\_\+path\+\_\+success, Onion\+\_\+\+Client\+\_\+\+Paths\+::last\+\_\+path\+\_\+used\+\_\+times, Onion\+\_\+\+Client\+::num\+\_\+friends, N\+U\+M\+B\+E\+R\+\_\+\+O\+N\+I\+O\+N\+\_\+\+P\+A\+T\+H\+S, onion\+\_\+add\+\_\+path\+\_\+node(), O\+N\+I\+O\+N\+\_\+\+P\+A\+T\+H\+\_\+\+L\+E\+N\+G\+T\+H, onion\+\_\+path\+\_\+to\+\_\+nodes(), Onion\+\_\+\+Client\+::onion\+\_\+paths\+\_\+friends, Onion\+\_\+\+Client\+::onion\+\_\+paths\+\_\+self, Onion\+\_\+\+Path\+::path\+\_\+num, Onion\+\_\+\+Client\+\_\+\+Paths\+::paths, make-\/funny-\/savefile\+::public\+\_\+key, and unix\+\_\+time().



Referenced by client\+\_\+add\+\_\+to\+\_\+list().


\begin{DoxyCode}
274 \{
275     \textcolor{keywordflow}{if} (\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num} > onion\_c->\hyperlink{struct_onion___client_a8ee1f2d7e543bce350c591a8eaac0cf8}{num\_friends})
276         \textcolor{keywordflow}{return} -1;
277 
278     \hyperlink{struct_onion___client___paths}{Onion\_Client\_Paths} *onion\_paths;
279 
280     \textcolor{keywordflow}{if} (\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num} == 0) \{
281         onion\_paths = &onion\_c->\hyperlink{struct_onion___client_a917f02fe81d007c9668083e0ac9ff0c7}{onion\_paths\_self};
282     \} \textcolor{keywordflow}{else} \{
283         onion\_paths = &onion\_c->\hyperlink{struct_onion___client_a52bae59a292facb41ff98ea0efe8e68f}{onion\_paths\_friends};
284     \}
285 
286     \textcolor{keywordflow}{if} (onion\_paths->\hyperlink{struct_onion___client___paths_afaa8c1f23d89bd5acee1f956e8872061}{paths}[path\_num % \hyperlink{onion__client_8h_a69d73a99a8788ce76768d6cd589da123}{NUMBER\_ONION\_PATHS}].
      \hyperlink{struct_onion___path_a6d69f3ea5100411c3599020055b8b78c}{path\_num} == path\_num) \{
287         onion\_paths->\hyperlink{struct_onion___client___paths_afbee813e09086f6993c94cdaafe2ae36}{last\_path\_success}[path\_num % 
      \hyperlink{onion__client_8h_a69d73a99a8788ce76768d6cd589da123}{NUMBER\_ONION\_PATHS}] = \hyperlink{util_8c_ac958d9f8847cb8039444bfa3d304233a}{unix\_time}();
288         onion\_paths->\hyperlink{struct_onion___client___paths_a3a947792d864563f1c4d6984cc9c638a}{last\_path\_used\_times}[path\_num % 
      \hyperlink{onion__client_8h_a69d73a99a8788ce76768d6cd589da123}{NUMBER\_ONION\_PATHS}] = 0;
289 
290         \hyperlink{struct_node__format}{Node\_format} nodes[\hyperlink{onion_8h_abe0dd1f2cbadfda52425e7c2fed7d8c3}{ONION\_PATH\_LENGTH}];
291 
292         \textcolor{keywordflow}{if} (\hyperlink{onion_8c_a0037270c6e9bca59c4e0cd118ebfa593}{onion\_path\_to\_nodes}(nodes, \hyperlink{onion_8h_abe0dd1f2cbadfda52425e7c2fed7d8c3}{ONION\_PATH\_LENGTH}, &onion\_paths
      ->\hyperlink{struct_onion___client___paths_afaa8c1f23d89bd5acee1f956e8872061}{paths}[path\_num % \hyperlink{onion__client_8h_a69d73a99a8788ce76768d6cd589da123}{NUMBER\_ONION\_PATHS}]) == 0) \{
293             \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
294 
295             \textcolor{keywordflow}{for} (i = 0; i < \hyperlink{onion_8h_abe0dd1f2cbadfda52425e7c2fed7d8c3}{ONION\_PATH\_LENGTH}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
296                 \hyperlink{onion__client_8c_a5f6d509093a5e8a3491d21cc21afc7b1}{onion\_add\_path\_node}(onion\_c, nodes[i].ip\_port, nodes[i].
      \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key});
297             \}
298         \}
299 
300         \textcolor{keywordflow}{return} path\_num;
301     \}
302 
303     \textcolor{keywordflow}{return} ~0;
304 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=324pt]{db/d79/onion__client_8c_a79b0950c5eea44ddc315ef8a9b2e47f1_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d79/onion__client_8c_a79b0950c5eea44ddc315ef8a9b2e47f1_icgraph}
\end{center}
\end{figure}




\subsection{Variable Documentation}
\hypertarget{onion__client_8c_a3551f15862efa7b58779722fe9763c45}{\index{onion\+\_\+client.\+c@{onion\+\_\+client.\+c}!cmp\+\_\+public\+\_\+key@{cmp\+\_\+public\+\_\+key}}
\index{cmp\+\_\+public\+\_\+key@{cmp\+\_\+public\+\_\+key}!onion\+\_\+client.\+c@{onion\+\_\+client.\+c}}
\subsubsection[{cmp\+\_\+public\+\_\+key}]{\setlength{\rightskip}{0pt plus 5cm}uint8\+\_\+t cmp\+\_\+public\+\_\+key\mbox{[}crypto\+\_\+box\+\_\+\+P\+U\+B\+L\+I\+C\+K\+E\+Y\+B\+Y\+T\+E\+S\mbox{]}\hspace{0.3cm}{\ttfamily [static]}}}\label{onion__client_8c_a3551f15862efa7b58779722fe9763c45}


Definition at line 443 of file onion\+\_\+client.\+c.



Referenced by client\+\_\+add\+\_\+to\+\_\+list(), and cmp\+\_\+entry().

