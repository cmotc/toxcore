\hypertarget{_t_c_p__server_8c}{\section{toxcore/\+T\+C\+P\+\_\+server.c File Reference}
\label{_t_c_p__server_8c}\index{toxcore/\+T\+C\+P\+\_\+server.\+c@{toxcore/\+T\+C\+P\+\_\+server.\+c}}
}
{\ttfamily \#include \char`\"{}T\+C\+P\+\_\+server.\+h\char`\"{}}\\*
{\ttfamily \#include $<$sys/ioctl.\+h$>$}\\*
{\ttfamily \#include \char`\"{}util.\+h\char`\"{}}\\*
Include dependency graph for T\+C\+P\+\_\+server.\+c\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d50/_t_c_p__server_8c__incl}
\end{center}
\end{figure}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
static int \hyperlink{_t_c_p__server_8c_a944f17c26a170be923cc64f9921e001b}{bind\+\_\+to\+\_\+port} (\hyperlink{network_8h_ae5faf8a8d23da59c3e3025a62039d8c1}{sock\+\_\+t} \hyperlink{irc__syncbot_8c_a5903d0b282fc5eae503de618f896b5e1}{sock}, int family, uint16\+\_\+t \hyperlink{irc__syncbot_8c_a8e0798404bf2cf5dabb84c5ba9a4f236}{port})
\item 
static int \hyperlink{_t_c_p__server_8c_abdfaa164f396557d6499a8e5e3145b49}{realloc\+\_\+connection} (\hyperlink{struct_t_c_p___server}{T\+C\+P\+\_\+\+Server} $\ast$T\+C\+P\+\_\+server, uint32\+\_\+t \hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num})
\item 
static int \hyperlink{_t_c_p__server_8c_a11f81fcb9060389c52d55b079e1b8f3b}{get\+\_\+\+T\+C\+P\+\_\+connection\+\_\+index} (const \hyperlink{struct_t_c_p___server}{T\+C\+P\+\_\+\+Server} $\ast$T\+C\+P\+\_\+server, const uint8\+\_\+t $\ast$public\+\_\+key)
\item 
static int \hyperlink{_t_c_p__server_8c_a2f45b38fbf8f1646a682172973fd7a25}{kill\+\_\+accepted} (\hyperlink{struct_t_c_p___server}{T\+C\+P\+\_\+\+Server} $\ast$T\+C\+P\+\_\+server, int index)
\item 
static int \hyperlink{_t_c_p__server_8c_a1ae92403cba7d9cf7248d594f15b0d62}{add\+\_\+accepted} (\hyperlink{struct_t_c_p___server}{T\+C\+P\+\_\+\+Server} $\ast$T\+C\+P\+\_\+server, const \hyperlink{struct_t_c_p___secure___connection}{T\+C\+P\+\_\+\+Secure\+\_\+\+Connection} $\ast$con)
\item 
static int \hyperlink{_t_c_p__server_8c_a8fbde82c141c5368acc8ea8e8ad58fd2}{del\+\_\+accepted} (\hyperlink{struct_t_c_p___server}{T\+C\+P\+\_\+\+Server} $\ast$T\+C\+P\+\_\+server, int index)
\item 
unsigned int \hyperlink{_t_c_p__server_8c_ae80fe7119d00d2a7788c0839a90e0782}{T\+C\+P\+\_\+socket\+\_\+data\+\_\+recv\+\_\+buffer} (\hyperlink{network_8h_ae5faf8a8d23da59c3e3025a62039d8c1}{sock\+\_\+t} \hyperlink{irc__syncbot_8c_a5903d0b282fc5eae503de618f896b5e1}{sock})
\item 
uint16\+\_\+t \hyperlink{_t_c_p__server_8c_a984a0b6fc27b03e09170579ec9494093}{read\+\_\+\+T\+C\+P\+\_\+length} (\hyperlink{network_8h_ae5faf8a8d23da59c3e3025a62039d8c1}{sock\+\_\+t} \hyperlink{irc__syncbot_8c_a5903d0b282fc5eae503de618f896b5e1}{sock})
\item 
int \hyperlink{_t_c_p__server_8c_a88eda37b476d8dcfdba94899e740dd9e}{read\+\_\+\+T\+C\+P\+\_\+packet} (\hyperlink{network_8h_ae5faf8a8d23da59c3e3025a62039d8c1}{sock\+\_\+t} \hyperlink{irc__syncbot_8c_a5903d0b282fc5eae503de618f896b5e1}{sock}, uint8\+\_\+t $\ast$data, uint16\+\_\+t length)
\item 
int \hyperlink{_t_c_p__server_8c_a2acbecbd76fe539293b5d92d0e0b6c5e}{read\+\_\+packet\+\_\+\+T\+C\+P\+\_\+secure\+\_\+connection} (\hyperlink{network_8h_ae5faf8a8d23da59c3e3025a62039d8c1}{sock\+\_\+t} \hyperlink{irc__syncbot_8c_a5903d0b282fc5eae503de618f896b5e1}{sock}, uint16\+\_\+t $\ast$next\+\_\+packet\+\_\+length, const uint8\+\_\+t $\ast$shared\+\_\+key, uint8\+\_\+t $\ast$recv\+\_\+nonce, uint8\+\_\+t $\ast$data, uint16\+\_\+t max\+\_\+len)
\item 
static int \hyperlink{_t_c_p__server_8c_a127449a3fca8398acf0ba361be8c5c83}{send\+\_\+pending\+\_\+data\+\_\+nonpriority} (\hyperlink{struct_t_c_p___secure___connection}{T\+C\+P\+\_\+\+Secure\+\_\+\+Connection} $\ast$con)
\item 
static int \hyperlink{_t_c_p__server_8c_a80fa82b117432f080f39f481ab5d9fef}{send\+\_\+pending\+\_\+data} (\hyperlink{struct_t_c_p___secure___connection}{T\+C\+P\+\_\+\+Secure\+\_\+\+Connection} $\ast$con)
\item 
static \+\_\+\+Bool \hyperlink{_t_c_p__server_8c_ac9f38bf2eaf3cd2603c380091ae6ebad}{add\+\_\+priority} (\hyperlink{struct_t_c_p___secure___connection}{T\+C\+P\+\_\+\+Secure\+\_\+\+Connection} $\ast$con, const uint8\+\_\+t $\ast$packet, uint16\+\_\+t size, uint16\+\_\+t sent)
\item 
static int \hyperlink{_t_c_p__server_8c_a1b2fd7984b9d3eb39bf588fc9bc5e21f}{write\+\_\+packet\+\_\+\+T\+C\+P\+\_\+secure\+\_\+connection} (\hyperlink{struct_t_c_p___secure___connection}{T\+C\+P\+\_\+\+Secure\+\_\+\+Connection} $\ast$con, const uint8\+\_\+t $\ast$data, uint16\+\_\+t length, \+\_\+\+Bool priority)
\item 
static void \hyperlink{_t_c_p__server_8c_a51bace7dc1f6b7e7049430de070f3864}{kill\+\_\+\+T\+C\+P\+\_\+connection} (\hyperlink{struct_t_c_p___secure___connection}{T\+C\+P\+\_\+\+Secure\+\_\+\+Connection} $\ast$con)
\item 
static int \hyperlink{_t_c_p__server_8c_a537d1f47612f3dbb19a92e557b062c20}{rm\+\_\+connection\+\_\+index} (\hyperlink{struct_t_c_p___server}{T\+C\+P\+\_\+\+Server} $\ast$T\+C\+P\+\_\+server, \hyperlink{struct_t_c_p___secure___connection}{T\+C\+P\+\_\+\+Secure\+\_\+\+Connection} $\ast$con, uint8\+\_\+t con\+\_\+number)
\item 
static int \hyperlink{_t_c_p__server_8c_ad83c5da554cb68b07d7bef24c99c8ad8}{handle\+\_\+\+T\+C\+P\+\_\+handshake} (\hyperlink{struct_t_c_p___secure___connection}{T\+C\+P\+\_\+\+Secure\+\_\+\+Connection} $\ast$con, const uint8\+\_\+t $\ast$data, uint16\+\_\+t length, const uint8\+\_\+t $\ast$self\+\_\+secret\+\_\+key)
\item 
static int \hyperlink{_t_c_p__server_8c_ab6e95a3eda0dace913cf12bf3e6088ff}{read\+\_\+connection\+\_\+handshake} (\hyperlink{struct_t_c_p___secure___connection}{T\+C\+P\+\_\+\+Secure\+\_\+\+Connection} $\ast$con, const uint8\+\_\+t $\ast$self\+\_\+secret\+\_\+key)
\item 
static int \hyperlink{_t_c_p__server_8c_a378a47bb3e63730aa104d8da7d10f384}{send\+\_\+routing\+\_\+response} (\hyperlink{struct_t_c_p___secure___connection}{T\+C\+P\+\_\+\+Secure\+\_\+\+Connection} $\ast$con, uint8\+\_\+t rpid, const uint8\+\_\+t $\ast$public\+\_\+key)
\item 
static int \hyperlink{_t_c_p__server_8c_aebc23608e1cc6d5fc35210e9c28e8960}{send\+\_\+connect\+\_\+notification} (\hyperlink{struct_t_c_p___secure___connection}{T\+C\+P\+\_\+\+Secure\+\_\+\+Connection} $\ast$con, uint8\+\_\+t id)
\item 
static int \hyperlink{_t_c_p__server_8c_aad6cd0a2a98d4da60235be8000f2c66f}{send\+\_\+disconnect\+\_\+notification} (\hyperlink{struct_t_c_p___secure___connection}{T\+C\+P\+\_\+\+Secure\+\_\+\+Connection} $\ast$con, uint8\+\_\+t id)
\item 
static int \hyperlink{_t_c_p__server_8c_af925f101a4e90d1fa2381536ef23a794}{handle\+\_\+\+T\+C\+P\+\_\+routing\+\_\+req} (\hyperlink{struct_t_c_p___server}{T\+C\+P\+\_\+\+Server} $\ast$T\+C\+P\+\_\+server, uint32\+\_\+t con\+\_\+id, const uint8\+\_\+t $\ast$public\+\_\+key)
\item 
static int \hyperlink{_t_c_p__server_8c_a7631710481101de4b345f7e318fdb88a}{handle\+\_\+\+T\+C\+P\+\_\+oob\+\_\+send} (\hyperlink{struct_t_c_p___server}{T\+C\+P\+\_\+\+Server} $\ast$T\+C\+P\+\_\+server, uint32\+\_\+t con\+\_\+id, const uint8\+\_\+t $\ast$public\+\_\+key, const uint8\+\_\+t $\ast$data, uint16\+\_\+t length)
\item 
static int \hyperlink{_t_c_p__server_8c_aaee6d8849ed25c44203b345808d79bed}{handle\+\_\+onion\+\_\+recv\+\_\+1} (void $\ast$object, \hyperlink{struct_i_p___port}{I\+P\+\_\+\+Port} dest, const uint8\+\_\+t $\ast$data, uint16\+\_\+t length)
\item 
static int \hyperlink{_t_c_p__server_8c_a904af6fcbd24cb3f75c4a04470be46de}{handle\+\_\+\+T\+C\+P\+\_\+packet} (\hyperlink{struct_t_c_p___server}{T\+C\+P\+\_\+\+Server} $\ast$T\+C\+P\+\_\+server, uint32\+\_\+t con\+\_\+id, const uint8\+\_\+t $\ast$data, uint16\+\_\+t length)
\item 
static int \hyperlink{_t_c_p__server_8c_a00813f259948ef060f6ab7ec40da2f2c}{confirm\+\_\+\+T\+C\+P\+\_\+connection} (\hyperlink{struct_t_c_p___server}{T\+C\+P\+\_\+\+Server} $\ast$T\+C\+P\+\_\+server, \hyperlink{struct_t_c_p___secure___connection}{T\+C\+P\+\_\+\+Secure\+\_\+\+Connection} $\ast$con, const uint8\+\_\+t $\ast$data, uint16\+\_\+t length)
\item 
static int \hyperlink{_t_c_p__server_8c_ad3971e4c18ffe30a530ef41da1008bf7}{accept\+\_\+connection} (\hyperlink{struct_t_c_p___server}{T\+C\+P\+\_\+\+Server} $\ast$T\+C\+P\+\_\+server, \hyperlink{network_8h_ae5faf8a8d23da59c3e3025a62039d8c1}{sock\+\_\+t} \hyperlink{irc__syncbot_8c_a5903d0b282fc5eae503de618f896b5e1}{sock})
\item 
static \hyperlink{network_8h_ae5faf8a8d23da59c3e3025a62039d8c1}{sock\+\_\+t} \hyperlink{_t_c_p__server_8c_aa6d558b4e988007697894aff27271927}{new\+\_\+listening\+\_\+\+T\+C\+P\+\_\+socket} (int family, uint16\+\_\+t \hyperlink{irc__syncbot_8c_a8e0798404bf2cf5dabb84c5ba9a4f236}{port})
\item 
\hyperlink{struct_t_c_p___server}{T\+C\+P\+\_\+\+Server} $\ast$ \hyperlink{_t_c_p__server_8c_a148e632f4c51645cbc1b414bc3584b60}{new\+\_\+\+T\+C\+P\+\_\+server} (uint8\+\_\+t ipv6\+\_\+enabled, uint16\+\_\+t num\+\_\+sockets, const uint16\+\_\+t $\ast$\hyperlink{_t_c_p__test_8c_a04e5444bf6a826487066ba973577f674}{ports}, const uint8\+\_\+t $\ast$secret\+\_\+key, \hyperlink{struct_onion}{Onion} $\ast$onion)
\item 
static void \hyperlink{_t_c_p__server_8c_a8bcfa0b79de4e0fad8720af7d1ed1d70}{do\+\_\+\+T\+C\+P\+\_\+accept\+\_\+new} (\hyperlink{struct_t_c_p___server}{T\+C\+P\+\_\+\+Server} $\ast$T\+C\+P\+\_\+server)
\item 
static int \hyperlink{_t_c_p__server_8c_a02fab0695a22b7f75c83439b2b6937ca}{do\+\_\+incoming} (\hyperlink{struct_t_c_p___server}{T\+C\+P\+\_\+\+Server} $\ast$T\+C\+P\+\_\+server, uint32\+\_\+t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i})
\item 
static int \hyperlink{_t_c_p__server_8c_a8cdae1ef768b85b02dcc79ff2258606f}{do\+\_\+unconfirmed} (\hyperlink{struct_t_c_p___server}{T\+C\+P\+\_\+\+Server} $\ast$T\+C\+P\+\_\+server, uint32\+\_\+t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i})
\item 
static void \hyperlink{_t_c_p__server_8c_ab84742dd52ed6c8e83287ea5202e4326}{do\+\_\+confirmed\+\_\+recv} (\hyperlink{struct_t_c_p___server}{T\+C\+P\+\_\+\+Server} $\ast$T\+C\+P\+\_\+server, uint32\+\_\+t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i})
\item 
static void \hyperlink{_t_c_p__server_8c_affc332b8c3280bd44fa933413d678796}{do\+\_\+\+T\+C\+P\+\_\+incomming} (\hyperlink{struct_t_c_p___server}{T\+C\+P\+\_\+\+Server} $\ast$T\+C\+P\+\_\+server)
\item 
static void \hyperlink{_t_c_p__server_8c_aed90b296bcb98bcb905565ae68548c9a}{do\+\_\+\+T\+C\+P\+\_\+unconfirmed} (\hyperlink{struct_t_c_p___server}{T\+C\+P\+\_\+\+Server} $\ast$T\+C\+P\+\_\+server)
\item 
static void \hyperlink{_t_c_p__server_8c_a001f38d27860442b6fe9fe7dd030a7a0}{do\+\_\+\+T\+C\+P\+\_\+confirmed} (\hyperlink{struct_t_c_p___server}{T\+C\+P\+\_\+\+Server} $\ast$T\+C\+P\+\_\+server)
\item 
void \hyperlink{_t_c_p__server_8c_a40e8a0302a359dd4f712eb1e9c346fe5}{do\+\_\+\+T\+C\+P\+\_\+server} (\hyperlink{struct_t_c_p___server}{T\+C\+P\+\_\+\+Server} $\ast$T\+C\+P\+\_\+server)
\item 
void \hyperlink{_t_c_p__server_8c_af6df6382ad309456dcf5b7b350313714}{kill\+\_\+\+T\+C\+P\+\_\+server} (\hyperlink{struct_t_c_p___server}{T\+C\+P\+\_\+\+Server} $\ast$T\+C\+P\+\_\+server)
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\hypertarget{_t_c_p__server_8c_ad3971e4c18ffe30a530ef41da1008bf7}{\index{T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}!accept\+\_\+connection@{accept\+\_\+connection}}
\index{accept\+\_\+connection@{accept\+\_\+connection}!T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}}
\subsubsection[{accept\+\_\+connection}]{\setlength{\rightskip}{0pt plus 5cm}static int accept\+\_\+connection (
\begin{DoxyParamCaption}
\item[{{\bf T\+C\+P\+\_\+\+Server} $\ast$}]{T\+C\+P\+\_\+server, }
\item[{{\bf sock\+\_\+t}}]{sock}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_t_c_p__server_8c_ad3971e4c18ffe30a530ef41da1008bf7}


Definition at line 884 of file T\+C\+P\+\_\+server.\+c.



References T\+C\+P\+\_\+\+Server\+::incomming\+\_\+connection\+\_\+queue, T\+C\+P\+\_\+\+Server\+::incomming\+\_\+connection\+\_\+queue\+\_\+index, kill\+\_\+sock(), kill\+\_\+\+T\+C\+P\+\_\+connection(), M\+A\+X\+\_\+\+I\+N\+C\+O\+M\+M\+I\+N\+G\+\_\+\+C\+O\+N\+N\+E\+C\+T\+I\+O\+N\+S, T\+C\+P\+\_\+\+Secure\+\_\+\+Connection\+::next\+\_\+packet\+\_\+length, set\+\_\+socket\+\_\+nonblock(), set\+\_\+socket\+\_\+nosigpipe(), sock, T\+C\+P\+\_\+\+Secure\+\_\+\+Connection\+::sock, sock\+\_\+valid(), T\+C\+P\+\_\+\+Secure\+\_\+\+Connection\+::status, T\+C\+P\+\_\+\+S\+T\+A\+T\+U\+S\+\_\+\+C\+O\+N\+N\+E\+C\+T\+E\+D, and T\+C\+P\+\_\+\+S\+T\+A\+T\+U\+S\+\_\+\+N\+O\+\_\+\+S\+T\+A\+T\+U\+S.



Referenced by do\+\_\+\+T\+C\+P\+\_\+accept\+\_\+new().


\begin{DoxyCode}
885 \{
886     \textcolor{keywordflow}{if} (!\hyperlink{network_8c_a84c3240a3325cbdaaa8a206c96980cd1}{sock\_valid}(\hyperlink{irc__syncbot_8c_a5903d0b282fc5eae503de618f896b5e1}{sock}))
887         \textcolor{keywordflow}{return} -1;
888 
889     \textcolor{keywordflow}{if} (!\hyperlink{network_8c_a6a50bb1345f2d5192fe1ec23ac7a1da9}{set\_socket\_nonblock}(\hyperlink{irc__syncbot_8c_a5903d0b282fc5eae503de618f896b5e1}{sock})) \{
890         \hyperlink{network_8c_a512d8ea12392ba9ddfadd83bb7c92b2e}{kill\_sock}(\hyperlink{irc__syncbot_8c_a5903d0b282fc5eae503de618f896b5e1}{sock});
891         \textcolor{keywordflow}{return} -1;
892     \}
893 
894     \textcolor{keywordflow}{if} (!\hyperlink{network_8c_a379153c027c17d7c71797cb0e3ea41a3}{set\_socket\_nosigpipe}(\hyperlink{irc__syncbot_8c_a5903d0b282fc5eae503de618f896b5e1}{sock})) \{
895         \hyperlink{network_8c_a512d8ea12392ba9ddfadd83bb7c92b2e}{kill\_sock}(\hyperlink{irc__syncbot_8c_a5903d0b282fc5eae503de618f896b5e1}{sock});
896         \textcolor{keywordflow}{return} -1;
897     \}
898 
899     uint16\_t index = TCP\_server->\hyperlink{struct_t_c_p___server_a3365834b14a58220182399bdc98198f9}{incomming\_connection\_queue\_index} % 
      \hyperlink{_t_c_p__server_8h_a2c62883bf7895f3582975a14ec316bef}{MAX\_INCOMMING\_CONNECTIONS};
900 
901     \hyperlink{struct_t_c_p___secure___connection}{TCP\_Secure\_Connection} *conn = &TCP\_server->
      \hyperlink{struct_t_c_p___server_aee7190e93d63765a9a2642895d6ec8b0}{incomming\_connection\_queue}[index];
902 
903     \textcolor{keywordflow}{if} (conn->\hyperlink{struct_t_c_p___secure___connection_ade818037fd6c985038ff29656089758d}{status} != \hyperlink{_t_c_p__server_8h_a5d76b81b0ad4c19007a781d4edb8181fa20692881561141ef7621446ae15f78bc}{TCP\_STATUS\_NO\_STATUS})
904         \hyperlink{_t_c_p__server_8c_a51bace7dc1f6b7e7049430de070f3864}{kill\_TCP\_connection}(conn);
905 
906     conn->\hyperlink{struct_t_c_p___secure___connection_ade818037fd6c985038ff29656089758d}{status} = \hyperlink{_t_c_p__server_8h_a5d76b81b0ad4c19007a781d4edb8181fab5e948cd81931f0c7e6a827e90c24616}{TCP\_STATUS\_CONNECTED};
907     conn->\hyperlink{struct_t_c_p___secure___connection_a35b19d84fb632ca8ce5cab237f7089a5}{sock} = \hyperlink{irc__syncbot_8c_a5903d0b282fc5eae503de618f896b5e1}{sock};
908     conn->\hyperlink{struct_t_c_p___secure___connection_a1d1e3047af3c935db36ae7b2360aaec7}{next\_packet\_length} = 0;
909 
910     ++TCP\_server->\hyperlink{struct_t_c_p___server_a3365834b14a58220182399bdc98198f9}{incomming\_connection\_queue\_index};
911     \textcolor{keywordflow}{return} index;
912 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_ad3971e4c18ffe30a530ef41da1008bf7_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_ad3971e4c18ffe30a530ef41da1008bf7_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__server_8c_a1ae92403cba7d9cf7248d594f15b0d62}{\index{T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}!add\+\_\+accepted@{add\+\_\+accepted}}
\index{add\+\_\+accepted@{add\+\_\+accepted}!T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}}
\subsubsection[{add\+\_\+accepted}]{\setlength{\rightskip}{0pt plus 5cm}static int add\+\_\+accepted (
\begin{DoxyParamCaption}
\item[{{\bf T\+C\+P\+\_\+\+Server} $\ast$}]{T\+C\+P\+\_\+server, }
\item[{const {\bf T\+C\+P\+\_\+\+Secure\+\_\+\+Connection} $\ast$}]{con}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_t_c_p__server_8c_a1ae92403cba7d9cf7248d594f15b0d62}


Definition at line 113 of file T\+C\+P\+\_\+server.\+c.



References T\+C\+P\+\_\+\+Server\+::accepted\+\_\+connection\+\_\+array, T\+C\+P\+\_\+\+Server\+::accepted\+\_\+key\+\_\+list, bs\+\_\+list\+\_\+add(), T\+C\+P\+\_\+\+Server\+::counter, get\+\_\+\+T\+C\+P\+\_\+connection\+\_\+index(), i, T\+C\+P\+\_\+\+Secure\+\_\+\+Connection\+::identifier, kill\+\_\+accepted(), T\+C\+P\+\_\+\+Secure\+\_\+\+Connection\+::last\+\_\+pinged, T\+C\+P\+\_\+\+Server\+::num\+\_\+accepted\+\_\+connections, T\+C\+P\+\_\+\+Secure\+\_\+\+Connection\+::ping\+\_\+id, T\+C\+P\+\_\+\+Secure\+\_\+\+Connection\+::public\+\_\+key, realloc\+\_\+connection(), T\+C\+P\+\_\+\+Server\+::size\+\_\+accepted\+\_\+connections, T\+C\+P\+\_\+\+Secure\+\_\+\+Connection\+::status, T\+C\+P\+\_\+\+S\+T\+A\+T\+U\+S\+\_\+\+C\+O\+N\+F\+I\+R\+M\+E\+D, T\+C\+P\+\_\+\+S\+T\+A\+T\+U\+S\+\_\+\+N\+O\+\_\+\+S\+T\+A\+T\+U\+S, and unix\+\_\+time().



Referenced by confirm\+\_\+\+T\+C\+P\+\_\+connection().


\begin{DoxyCode}
114 \{
115     \textcolor{keywordtype}{int} index = \hyperlink{_t_c_p__server_8c_a11f81fcb9060389c52d55b079e1b8f3b}{get\_TCP\_connection\_index}(TCP\_server, con->
      \hyperlink{struct_t_c_p___secure___connection_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key});
116 
117     \textcolor{keywordflow}{if} (index != -1) \{ \textcolor{comment}{/* If an old connection to the same public key exists, kill it. */}
118         \hyperlink{_t_c_p__server_8c_a2f45b38fbf8f1646a682172973fd7a25}{kill\_accepted}(TCP\_server, index);
119         index = -1;
120     \}
121 
122     \textcolor{keywordflow}{if} (TCP\_server->\hyperlink{struct_t_c_p___server_a6348c77f7067c2876de893aedb559972}{size\_accepted\_connections} == TCP\_server->
      \hyperlink{struct_t_c_p___server_a77b20b49521cea9c12823bae50db6557}{num\_accepted\_connections}) \{
123         \textcolor{keywordflow}{if} (\hyperlink{_t_c_p__server_8c_abdfaa164f396557d6499a8e5e3145b49}{realloc\_connection}(TCP\_server, TCP\_server->
      \hyperlink{struct_t_c_p___server_a6348c77f7067c2876de893aedb559972}{size\_accepted\_connections} + 4) == -1)
124             \textcolor{keywordflow}{return} -1;
125 
126         index = TCP\_server->\hyperlink{struct_t_c_p___server_a77b20b49521cea9c12823bae50db6557}{num\_accepted\_connections};
127     \} \textcolor{keywordflow}{else} \{
128         uint32\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
129 
130         \textcolor{keywordflow}{for} (i = TCP\_server->\hyperlink{struct_t_c_p___server_a6348c77f7067c2876de893aedb559972}{size\_accepted\_connections}; i != 0; --i) \{
131             \textcolor{keywordflow}{if} (TCP\_server->\hyperlink{struct_t_c_p___server_aaec24f8b80a7853d1b7da87e903c44ee}{accepted\_connection\_array}[i - 1].
      \hyperlink{struct_t_c_p___secure___connection_ade818037fd6c985038ff29656089758d}{status} == \hyperlink{_t_c_p__server_8h_a5d76b81b0ad4c19007a781d4edb8181fa20692881561141ef7621446ae15f78bc}{TCP\_STATUS\_NO\_STATUS}) \{
132                 index = i - 1;
133                 \textcolor{keywordflow}{break};
134             \}
135         \}
136     \}
137 
138     \textcolor{keywordflow}{if} (index == -1) \{
139         fprintf(stderr, \textcolor{stringliteral}{"FAIL index is -1\(\backslash\)n"});
140         \textcolor{keywordflow}{return} -1;
141     \}
142 
143     \textcolor{keywordflow}{if} (!\hyperlink{list_8c_ace05755dd126bff18700a17d6f8edd28}{bs\_list\_add}(&TCP\_server->\hyperlink{struct_t_c_p___server_ae01209a4897757539a5ff199cdcfb64c}{accepted\_key\_list}, con->
      \hyperlink{struct_t_c_p___secure___connection_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, index))
144         \textcolor{keywordflow}{return} -1;
145 
146     memcpy(&TCP\_server->\hyperlink{struct_t_c_p___server_aaec24f8b80a7853d1b7da87e903c44ee}{accepted\_connection\_array}[index], con, \textcolor{keyword}{sizeof}(
      \hyperlink{struct_t_c_p___secure___connection}{TCP\_Secure\_Connection}));
147     TCP\_server->\hyperlink{struct_t_c_p___server_aaec24f8b80a7853d1b7da87e903c44ee}{accepted\_connection\_array}[index].\hyperlink{struct_t_c_p___secure___connection_ade818037fd6c985038ff29656089758d}{status} = 
      \hyperlink{_t_c_p__server_8h_a5d76b81b0ad4c19007a781d4edb8181fa42e6e74e5c62734eb1386045e159a601}{TCP\_STATUS\_CONFIRMED};
148     ++TCP\_server->\hyperlink{struct_t_c_p___server_a77b20b49521cea9c12823bae50db6557}{num\_accepted\_connections};
149     TCP\_server->\hyperlink{struct_t_c_p___server_aaec24f8b80a7853d1b7da87e903c44ee}{accepted\_connection\_array}[index].
      \hyperlink{struct_t_c_p___secure___connection_ad1813f451cfaf8c9700e6329c5ea2f2b}{identifier} = ++TCP\_server->\hyperlink{struct_t_c_p___server_a1944753ac8107ec537f75b7e0201d866}{counter};
150     TCP\_server->\hyperlink{struct_t_c_p___server_aaec24f8b80a7853d1b7da87e903c44ee}{accepted\_connection\_array}[index].
      \hyperlink{struct_t_c_p___secure___connection_a4049204f6c392628d31be6c39f03e031}{last\_pinged} = \hyperlink{util_8c_ac958d9f8847cb8039444bfa3d304233a}{unix\_time}();
151     TCP\_server->\hyperlink{struct_t_c_p___server_aaec24f8b80a7853d1b7da87e903c44ee}{accepted\_connection\_array}[index].
      \hyperlink{struct_t_c_p___secure___connection_acec02fbdff648ca71a6d8e5a0d63d634}{ping\_id} = 0;
152 
153     \textcolor{keywordflow}{return} index;
154 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_a1ae92403cba7d9cf7248d594f15b0d62_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_a1ae92403cba7d9cf7248d594f15b0d62_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__server_8c_ac9f38bf2eaf3cd2603c380091ae6ebad}{\index{T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}!add\+\_\+priority@{add\+\_\+priority}}
\index{add\+\_\+priority@{add\+\_\+priority}!T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}}
\subsubsection[{add\+\_\+priority}]{\setlength{\rightskip}{0pt plus 5cm}static \+\_\+\+Bool add\+\_\+priority (
\begin{DoxyParamCaption}
\item[{{\bf T\+C\+P\+\_\+\+Secure\+\_\+\+Connection} $\ast$}]{con, }
\item[{const uint8\+\_\+t $\ast$}]{packet, }
\item[{uint16\+\_\+t}]{size, }
\item[{uint16\+\_\+t}]{sent}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_t_c_p__server_8c_ac9f38bf2eaf3cd2603c380091ae6ebad}


Definition at line 360 of file T\+C\+P\+\_\+server.\+c.



References T\+C\+P\+\_\+\+Priority\+\_\+\+List\+::next, T\+C\+P\+\_\+\+Secure\+\_\+\+Connection\+::priority\+\_\+queue\+\_\+end, and T\+C\+P\+\_\+\+Secure\+\_\+\+Connection\+::priority\+\_\+queue\+\_\+start.



Referenced by write\+\_\+packet\+\_\+\+T\+C\+P\+\_\+secure\+\_\+connection().


\begin{DoxyCode}
361 \{
362     \hyperlink{struct_t_c_p___priority___list}{TCP\_Priority\_List} *p = con->\hyperlink{struct_t_c_p___secure___connection_a049dfdaebf54337c3024e077370c62d7}{priority\_queue\_end}, *\textcolor{keyword}{new};
363     \textcolor{keyword}{new} = malloc(\textcolor{keyword}{sizeof}(\hyperlink{struct_t_c_p___priority___list}{TCP\_Priority\_List}) + size);
364 
365     \textcolor{keywordflow}{if} (!\textcolor{keyword}{new}) \{
366         \textcolor{keywordflow}{return} 0;
367     \}
368 
369     \textcolor{keyword}{new}->next = NULL;
370     \textcolor{keyword}{new}->size = size;
371     \textcolor{keyword}{new}->sent = sent;
372     memcpy(new->data, packet, size);
373 
374     \textcolor{keywordflow}{if} (p) \{
375         p->\hyperlink{struct_t_c_p___priority___list_ac4565314423a94bcf735245b8b9b4c53}{next} = \textcolor{keyword}{new};
376     \} \textcolor{keywordflow}{else} \{
377         con->\hyperlink{struct_t_c_p___secure___connection_a5e19017835c72dc03d9dfd9a93abeb3c}{priority\_queue\_start} = \textcolor{keyword}{new};
378     \}
379 
380     con->\hyperlink{struct_t_c_p___secure___connection_a049dfdaebf54337c3024e077370c62d7}{priority\_queue\_end} = \textcolor{keyword}{new};
381     \textcolor{keywordflow}{return} 1;
382 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_ac9f38bf2eaf3cd2603c380091ae6ebad_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__server_8c_a944f17c26a170be923cc64f9921e001b}{\index{T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}!bind\+\_\+to\+\_\+port@{bind\+\_\+to\+\_\+port}}
\index{bind\+\_\+to\+\_\+port@{bind\+\_\+to\+\_\+port}!T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}}
\subsubsection[{bind\+\_\+to\+\_\+port}]{\setlength{\rightskip}{0pt plus 5cm}static int bind\+\_\+to\+\_\+port (
\begin{DoxyParamCaption}
\item[{{\bf sock\+\_\+t}}]{sock, }
\item[{int}]{family, }
\item[{uint16\+\_\+t}]{port}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_t_c_p__server_8c_a944f17c26a170be923cc64f9921e001b}


Definition at line 38 of file T\+C\+P\+\_\+server.\+c.



Referenced by new\+\_\+listening\+\_\+\+T\+C\+P\+\_\+socket().


\begin{DoxyCode}
39 \{
40     \textcolor{keyword}{struct }sockaddr\_storage addr = \{0\};
41     \textcolor{keywordtype}{size\_t} addrsize;
42 
43     \textcolor{keywordflow}{if} (family == AF\_INET) \{
44         \textcolor{keyword}{struct }sockaddr\_in *addr4 = (\textcolor{keyword}{struct }sockaddr\_in *)&addr;
45 
46         addrsize = \textcolor{keyword}{sizeof}(\textcolor{keyword}{struct }sockaddr\_in);
47         addr4->sin\_family = AF\_INET;
48         addr4->sin\_port = htons(\hyperlink{irc__syncbot_8c_a8e0798404bf2cf5dabb84c5ba9a4f236}{port});
49     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (family == AF\_INET6) \{
50         \textcolor{keyword}{struct }sockaddr\_in6 *addr6 = (\textcolor{keyword}{struct }sockaddr\_in6 *)&addr;
51 
52         addrsize = \textcolor{keyword}{sizeof}(\textcolor{keyword}{struct }sockaddr\_in6);
53         addr6->sin6\_family = AF\_INET6;
54         addr6->sin6\_port = htons(\hyperlink{irc__syncbot_8c_a8e0798404bf2cf5dabb84c5ba9a4f236}{port});
55     \} \textcolor{keywordflow}{else} \{
56         \textcolor{keywordflow}{return} 0;
57     \}
58 
59     \textcolor{keywordflow}{return} (bind(\hyperlink{irc__syncbot_8c_a5903d0b282fc5eae503de618f896b5e1}{sock}, (\textcolor{keyword}{struct} sockaddr *)&addr, addrsize) == 0);
60 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_a944f17c26a170be923cc64f9921e001b_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__server_8c_a00813f259948ef060f6ab7ec40da2f2c}{\index{T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}!confirm\+\_\+\+T\+C\+P\+\_\+connection@{confirm\+\_\+\+T\+C\+P\+\_\+connection}}
\index{confirm\+\_\+\+T\+C\+P\+\_\+connection@{confirm\+\_\+\+T\+C\+P\+\_\+connection}!T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}}
\subsubsection[{confirm\+\_\+\+T\+C\+P\+\_\+connection}]{\setlength{\rightskip}{0pt plus 5cm}static int confirm\+\_\+\+T\+C\+P\+\_\+connection (
\begin{DoxyParamCaption}
\item[{{\bf T\+C\+P\+\_\+\+Server} $\ast$}]{T\+C\+P\+\_\+server, }
\item[{{\bf T\+C\+P\+\_\+\+Secure\+\_\+\+Connection} $\ast$}]{con, }
\item[{const uint8\+\_\+t $\ast$}]{data, }
\item[{uint16\+\_\+t}]{length}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_t_c_p__server_8c_a00813f259948ef060f6ab7ec40da2f2c}


Definition at line 861 of file T\+C\+P\+\_\+server.\+c.



References add\+\_\+accepted(), handle\+\_\+\+T\+C\+P\+\_\+packet(), kill\+\_\+accepted(), and kill\+\_\+\+T\+C\+P\+\_\+connection().



Referenced by do\+\_\+unconfirmed().


\begin{DoxyCode}
863 \{
864     \textcolor{keywordtype}{int} index = \hyperlink{_t_c_p__server_8c_a1ae92403cba7d9cf7248d594f15b0d62}{add\_accepted}(TCP\_server, con);
865 
866     \textcolor{keywordflow}{if} (index == -1) \{
867         \hyperlink{_t_c_p__server_8c_a51bace7dc1f6b7e7049430de070f3864}{kill\_TCP\_connection}(con);
868         \textcolor{keywordflow}{return} -1;
869     \}
870 
871     memset(con, 0, \textcolor{keyword}{sizeof}(\hyperlink{struct_t_c_p___secure___connection}{TCP\_Secure\_Connection}));
872 
873     \textcolor{keywordflow}{if} (\hyperlink{_t_c_p__server_8c_a904af6fcbd24cb3f75c4a04470be46de}{handle\_TCP\_packet}(TCP\_server, index, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}, length) == -1) \{
874         \hyperlink{_t_c_p__server_8c_a2f45b38fbf8f1646a682172973fd7a25}{kill\_accepted}(TCP\_server, index);
875         \textcolor{keywordflow}{return} -1;
876     \}
877 
878     \textcolor{keywordflow}{return} index;
879 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_a00813f259948ef060f6ab7ec40da2f2c_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_a00813f259948ef060f6ab7ec40da2f2c_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__server_8c_a8fbde82c141c5368acc8ea8e8ad58fd2}{\index{T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}!del\+\_\+accepted@{del\+\_\+accepted}}
\index{del\+\_\+accepted@{del\+\_\+accepted}!T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}}
\subsubsection[{del\+\_\+accepted}]{\setlength{\rightskip}{0pt plus 5cm}static int del\+\_\+accepted (
\begin{DoxyParamCaption}
\item[{{\bf T\+C\+P\+\_\+\+Server} $\ast$}]{T\+C\+P\+\_\+server, }
\item[{int}]{index}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_t_c_p__server_8c_a8fbde82c141c5368acc8ea8e8ad58fd2}


Definition at line 161 of file T\+C\+P\+\_\+server.\+c.



References T\+C\+P\+\_\+\+Server\+::accepted\+\_\+connection\+\_\+array, T\+C\+P\+\_\+\+Server\+::accepted\+\_\+key\+\_\+list, bs\+\_\+list\+\_\+remove(), T\+C\+P\+\_\+\+Server\+::num\+\_\+accepted\+\_\+connections, T\+C\+P\+\_\+\+Secure\+\_\+\+Connection\+::public\+\_\+key, realloc\+\_\+connection(), T\+C\+P\+\_\+\+Server\+::size\+\_\+accepted\+\_\+connections, T\+C\+P\+\_\+\+Secure\+\_\+\+Connection\+::status, and T\+C\+P\+\_\+\+S\+T\+A\+T\+U\+S\+\_\+\+N\+O\+\_\+\+S\+T\+A\+T\+U\+S.



Referenced by kill\+\_\+accepted().


\begin{DoxyCode}
162 \{
163     \textcolor{keywordflow}{if} ((uint32\_t)index >= TCP\_server->\hyperlink{struct_t_c_p___server_a6348c77f7067c2876de893aedb559972}{size\_accepted\_connections})
164         \textcolor{keywordflow}{return} -1;
165 
166     \textcolor{keywordflow}{if} (TCP\_server->\hyperlink{struct_t_c_p___server_aaec24f8b80a7853d1b7da87e903c44ee}{accepted\_connection\_array}[index].
      \hyperlink{struct_t_c_p___secure___connection_ade818037fd6c985038ff29656089758d}{status} == \hyperlink{_t_c_p__server_8h_a5d76b81b0ad4c19007a781d4edb8181fa20692881561141ef7621446ae15f78bc}{TCP\_STATUS\_NO\_STATUS})
167         \textcolor{keywordflow}{return} -1;
168 
169     \textcolor{keywordflow}{if} (!\hyperlink{list_8c_a365995457101cc16f8c6b25ead07fb6f}{bs\_list\_remove}(&TCP\_server->\hyperlink{struct_t_c_p___server_ae01209a4897757539a5ff199cdcfb64c}{accepted\_key\_list}, TCP\_server->
      \hyperlink{struct_t_c_p___server_aaec24f8b80a7853d1b7da87e903c44ee}{accepted\_connection\_array}[index].\hyperlink{struct_t_c_p___secure___connection_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, index))
170         \textcolor{keywordflow}{return} -1;
171 
172     memset(&TCP\_server->\hyperlink{struct_t_c_p___server_aaec24f8b80a7853d1b7da87e903c44ee}{accepted\_connection\_array}[index], 0, \textcolor{keyword}{sizeof}(
      \hyperlink{struct_t_c_p___secure___connection}{TCP\_Secure\_Connection}));
173     --TCP\_server->\hyperlink{struct_t_c_p___server_a77b20b49521cea9c12823bae50db6557}{num\_accepted\_connections};
174 
175     \textcolor{keywordflow}{if} (TCP\_server->\hyperlink{struct_t_c_p___server_a77b20b49521cea9c12823bae50db6557}{num\_accepted\_connections} == 0)
176         \hyperlink{_t_c_p__server_8c_abdfaa164f396557d6499a8e5e3145b49}{realloc\_connection}(TCP\_server, 0);
177 
178     \textcolor{keywordflow}{return} 0;
179 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_a8fbde82c141c5368acc8ea8e8ad58fd2_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_a8fbde82c141c5368acc8ea8e8ad58fd2_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__server_8c_ab84742dd52ed6c8e83287ea5202e4326}{\index{T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}!do\+\_\+confirmed\+\_\+recv@{do\+\_\+confirmed\+\_\+recv}}
\index{do\+\_\+confirmed\+\_\+recv@{do\+\_\+confirmed\+\_\+recv}!T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}}
\subsubsection[{do\+\_\+confirmed\+\_\+recv}]{\setlength{\rightskip}{0pt plus 5cm}static void do\+\_\+confirmed\+\_\+recv (
\begin{DoxyParamCaption}
\item[{{\bf T\+C\+P\+\_\+\+Server} $\ast$}]{T\+C\+P\+\_\+server, }
\item[{uint32\+\_\+t}]{i}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_t_c_p__server_8c_ab84742dd52ed6c8e83287ea5202e4326}


Definition at line 1089 of file T\+C\+P\+\_\+server.\+c.



References T\+C\+P\+\_\+\+Server\+::accepted\+\_\+connection\+\_\+array, handle\+\_\+\+T\+C\+P\+\_\+packet(), i, kill\+\_\+accepted(), M\+A\+X\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+S\+I\+Z\+E, T\+C\+P\+\_\+\+Secure\+\_\+\+Connection\+::next\+\_\+packet\+\_\+length, read\+\_\+packet\+\_\+\+T\+C\+P\+\_\+secure\+\_\+connection(), T\+C\+P\+\_\+\+Secure\+\_\+\+Connection\+::recv\+\_\+nonce, T\+C\+P\+\_\+\+Secure\+\_\+\+Connection\+::shared\+\_\+key, and T\+C\+P\+\_\+\+Secure\+\_\+\+Connection\+::sock.



Referenced by do\+\_\+\+T\+C\+P\+\_\+confirmed().


\begin{DoxyCode}
1090 \{
1091     \hyperlink{struct_t_c_p___secure___connection}{TCP\_Secure\_Connection} *conn = &TCP\_server->
      \hyperlink{struct_t_c_p___server_aaec24f8b80a7853d1b7da87e903c44ee}{accepted\_connection\_array}[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}];
1092 
1093     uint8\_t packet[\hyperlink{_t_c_p__server_8h_a879456c3b8e2853f7044d764e9c180d4}{MAX\_PACKET\_SIZE}];
1094     \textcolor{keywordtype}{int} len;
1095 
1096     \textcolor{keywordflow}{while} ((len = \hyperlink{_t_c_p__server_8c_a2acbecbd76fe539293b5d92d0e0b6c5e}{read\_packet\_TCP\_secure\_connection}(conn->
      \hyperlink{struct_t_c_p___secure___connection_a35b19d84fb632ca8ce5cab237f7089a5}{sock}, &conn->\hyperlink{struct_t_c_p___secure___connection_a1d1e3047af3c935db36ae7b2360aaec7}{next\_packet\_length}, conn->\hyperlink{struct_t_c_p___secure___connection_a81ead9fac55a0cedc30a96253a2c5119}{shared\_key},
1097                   conn->\hyperlink{struct_t_c_p___secure___connection_aae0467706f97aa3ef23e5dc9c3c199d7}{recv\_nonce}, packet, \textcolor{keyword}{sizeof}(packet)))) \{
1098         \textcolor{keywordflow}{if} (len == -1) \{
1099             \hyperlink{_t_c_p__server_8c_a2f45b38fbf8f1646a682172973fd7a25}{kill\_accepted}(TCP\_server, \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i});
1100             \textcolor{keywordflow}{break};
1101         \}
1102 
1103         \textcolor{keywordflow}{if} (\hyperlink{_t_c_p__server_8c_a904af6fcbd24cb3f75c4a04470be46de}{handle\_TCP\_packet}(TCP\_server, \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}, packet, len) == -1) \{
1104             \hyperlink{_t_c_p__server_8c_a2f45b38fbf8f1646a682172973fd7a25}{kill\_accepted}(TCP\_server, \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i});
1105             \textcolor{keywordflow}{break};
1106         \}
1107     \}
1108 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_ab84742dd52ed6c8e83287ea5202e4326_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_ab84742dd52ed6c8e83287ea5202e4326_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__server_8c_a02fab0695a22b7f75c83439b2b6937ca}{\index{T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}!do\+\_\+incoming@{do\+\_\+incoming}}
\index{do\+\_\+incoming@{do\+\_\+incoming}!T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}}
\subsubsection[{do\+\_\+incoming}]{\setlength{\rightskip}{0pt plus 5cm}static int do\+\_\+incoming (
\begin{DoxyParamCaption}
\item[{{\bf T\+C\+P\+\_\+\+Server} $\ast$}]{T\+C\+P\+\_\+server, }
\item[{uint32\+\_\+t}]{i}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_t_c_p__server_8c_a02fab0695a22b7f75c83439b2b6937ca}


Definition at line 1041 of file T\+C\+P\+\_\+server.\+c.



References i, T\+C\+P\+\_\+\+Server\+::incomming\+\_\+connection\+\_\+queue, kill\+\_\+\+T\+C\+P\+\_\+connection(), M\+A\+X\+\_\+\+I\+N\+C\+O\+M\+M\+I\+N\+G\+\_\+\+C\+O\+N\+N\+E\+C\+T\+I\+O\+N\+S, read\+\_\+connection\+\_\+handshake(), T\+C\+P\+\_\+\+Server\+::secret\+\_\+key, T\+C\+P\+\_\+\+Secure\+\_\+\+Connection\+::status, T\+C\+P\+\_\+\+S\+T\+A\+T\+U\+S\+\_\+\+C\+O\+N\+N\+E\+C\+T\+E\+D, T\+C\+P\+\_\+\+S\+T\+A\+T\+U\+S\+\_\+\+N\+O\+\_\+\+S\+T\+A\+T\+U\+S, T\+C\+P\+\_\+\+Server\+::unconfirmed\+\_\+connection\+\_\+queue, and T\+C\+P\+\_\+\+Server\+::unconfirmed\+\_\+connection\+\_\+queue\+\_\+index.



Referenced by do\+\_\+\+T\+C\+P\+\_\+incomming().


\begin{DoxyCode}
1042 \{
1043     \textcolor{keywordflow}{if} (TCP\_server->\hyperlink{struct_t_c_p___server_aee7190e93d63765a9a2642895d6ec8b0}{incomming\_connection\_queue}[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}].
      \hyperlink{struct_t_c_p___secure___connection_ade818037fd6c985038ff29656089758d}{status} != \hyperlink{_t_c_p__server_8h_a5d76b81b0ad4c19007a781d4edb8181fab5e948cd81931f0c7e6a827e90c24616}{TCP\_STATUS\_CONNECTED})
1044         \textcolor{keywordflow}{return} -1;
1045 
1046     \textcolor{keywordtype}{int} ret = \hyperlink{_t_c_p__server_8c_ab6e95a3eda0dace913cf12bf3e6088ff}{read\_connection\_handshake}(&TCP\_server->
      \hyperlink{struct_t_c_p___server_aee7190e93d63765a9a2642895d6ec8b0}{incomming\_connection\_queue}[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}], TCP\_server->\hyperlink{struct_t_c_p___server_a41928223d6ad8bd41837f371deef62ae}{secret\_key});
1047 
1048     \textcolor{keywordflow}{if} (ret == -1) \{
1049         \hyperlink{_t_c_p__server_8c_a51bace7dc1f6b7e7049430de070f3864}{kill\_TCP\_connection}(&TCP\_server->
      \hyperlink{struct_t_c_p___server_aee7190e93d63765a9a2642895d6ec8b0}{incomming\_connection\_queue}[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}]);
1050     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (ret == 1) \{
1051         \textcolor{keywordtype}{int} index\_new = TCP\_server->\hyperlink{struct_t_c_p___server_a86567f857493f585eb843963350a9f0b}{unconfirmed\_connection\_queue\_index} % 
      \hyperlink{_t_c_p__server_8h_a2c62883bf7895f3582975a14ec316bef}{MAX\_INCOMMING\_CONNECTIONS};
1052         \hyperlink{struct_t_c_p___secure___connection}{TCP\_Secure\_Connection} *conn\_old = &TCP\_server->
      \hyperlink{struct_t_c_p___server_aee7190e93d63765a9a2642895d6ec8b0}{incomming\_connection\_queue}[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}];
1053         \hyperlink{struct_t_c_p___secure___connection}{TCP\_Secure\_Connection} *conn\_new = &TCP\_server->
      \hyperlink{struct_t_c_p___server_a8e84d42c724209bf3967de32506beeba}{unconfirmed\_connection\_queue}[index\_new];
1054 
1055         \textcolor{keywordflow}{if} (conn\_new->\hyperlink{struct_t_c_p___secure___connection_ade818037fd6c985038ff29656089758d}{status} != \hyperlink{_t_c_p__server_8h_a5d76b81b0ad4c19007a781d4edb8181fa20692881561141ef7621446ae15f78bc}{TCP\_STATUS\_NO\_STATUS})
1056             \hyperlink{_t_c_p__server_8c_a51bace7dc1f6b7e7049430de070f3864}{kill\_TCP\_connection}(conn\_new);
1057 
1058         memcpy(conn\_new, conn\_old, \textcolor{keyword}{sizeof}(\hyperlink{struct_t_c_p___secure___connection}{TCP\_Secure\_Connection}));
1059         memset(conn\_old, 0, \textcolor{keyword}{sizeof}(\hyperlink{struct_t_c_p___secure___connection}{TCP\_Secure\_Connection}));
1060         ++TCP\_server->\hyperlink{struct_t_c_p___server_a86567f857493f585eb843963350a9f0b}{unconfirmed\_connection\_queue\_index};
1061 
1062         \textcolor{keywordflow}{return} index\_new;
1063     \}
1064 
1065     \textcolor{keywordflow}{return} -1;
1066 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_a02fab0695a22b7f75c83439b2b6937ca_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_a02fab0695a22b7f75c83439b2b6937ca_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__server_8c_a8bcfa0b79de4e0fad8720af7d1ed1d70}{\index{T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}!do\+\_\+\+T\+C\+P\+\_\+accept\+\_\+new@{do\+\_\+\+T\+C\+P\+\_\+accept\+\_\+new}}
\index{do\+\_\+\+T\+C\+P\+\_\+accept\+\_\+new@{do\+\_\+\+T\+C\+P\+\_\+accept\+\_\+new}!T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}}
\subsubsection[{do\+\_\+\+T\+C\+P\+\_\+accept\+\_\+new}]{\setlength{\rightskip}{0pt plus 5cm}static void do\+\_\+\+T\+C\+P\+\_\+accept\+\_\+new (
\begin{DoxyParamCaption}
\item[{{\bf T\+C\+P\+\_\+\+Server} $\ast$}]{T\+C\+P\+\_\+server}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_t_c_p__server_8c_a8bcfa0b79de4e0fad8720af7d1ed1d70}


Definition at line 1026 of file T\+C\+P\+\_\+server.\+c.



References accept\+\_\+connection(), i, T\+C\+P\+\_\+\+Server\+::num\+\_\+listening\+\_\+socks, sock, and T\+C\+P\+\_\+\+Server\+::socks\+\_\+listening.



Referenced by do\+\_\+\+T\+C\+P\+\_\+server().


\begin{DoxyCode}
1027 \{
1028     uint32\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
1029 
1030     \textcolor{keywordflow}{for} (i = 0; i < TCP\_server->\hyperlink{struct_t_c_p___server_a5efc50bc21a4b488b17bb593b2758718}{num\_listening\_socks}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
1031         \textcolor{keyword}{struct }sockaddr\_storage addr;
1032         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} addrlen = \textcolor{keyword}{sizeof}(addr);
1033         \hyperlink{network_8h_ae5faf8a8d23da59c3e3025a62039d8c1}{sock\_t} \hyperlink{irc__syncbot_8c_a5903d0b282fc5eae503de618f896b5e1}{sock};
1034 
1035         \textcolor{keywordflow}{do} \{
1036             sock = accept(TCP\_server->\hyperlink{struct_t_c_p___server_a120d7e1abddb3a838bc0d0442f4ad8e6}{socks\_listening}[i], (\textcolor{keyword}{struct} sockaddr *)&addr, &addrlen
      );
1037         \} \textcolor{keywordflow}{while} (\hyperlink{_t_c_p__server_8c_ad3971e4c18ffe30a530ef41da1008bf7}{accept\_connection}(TCP\_server, sock) != -1);
1038     \}
1039 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_a8bcfa0b79de4e0fad8720af7d1ed1d70_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_a8bcfa0b79de4e0fad8720af7d1ed1d70_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__server_8c_a001f38d27860442b6fe9fe7dd030a7a0}{\index{T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}!do\+\_\+\+T\+C\+P\+\_\+confirmed@{do\+\_\+\+T\+C\+P\+\_\+confirmed}}
\index{do\+\_\+\+T\+C\+P\+\_\+confirmed@{do\+\_\+\+T\+C\+P\+\_\+confirmed}!T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}}
\subsubsection[{do\+\_\+\+T\+C\+P\+\_\+confirmed}]{\setlength{\rightskip}{0pt plus 5cm}static void do\+\_\+\+T\+C\+P\+\_\+confirmed (
\begin{DoxyParamCaption}
\item[{{\bf T\+C\+P\+\_\+\+Server} $\ast$}]{T\+C\+P\+\_\+server}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_t_c_p__server_8c_a001f38d27860442b6fe9fe7dd030a7a0}


Definition at line 1128 of file T\+C\+P\+\_\+server.\+c.



References T\+C\+P\+\_\+\+Server\+::accepted\+\_\+connection\+\_\+array, do\+\_\+confirmed\+\_\+recv(), i, is\+\_\+timeout(), kill\+\_\+accepted(), T\+C\+P\+\_\+\+Secure\+\_\+\+Connection\+::last\+\_\+pinged, T\+C\+P\+\_\+\+Secure\+\_\+\+Connection\+::ping\+\_\+id, random\+\_\+64b(), send\+\_\+pending\+\_\+data(), T\+C\+P\+\_\+\+Server\+::size\+\_\+accepted\+\_\+connections, T\+C\+P\+\_\+\+Secure\+\_\+\+Connection\+::status, T\+C\+P\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+P\+I\+N\+G, T\+C\+P\+\_\+\+P\+I\+N\+G\+\_\+\+F\+R\+E\+Q\+U\+E\+N\+C\+Y, T\+C\+P\+\_\+\+P\+I\+N\+G\+\_\+\+T\+I\+M\+E\+O\+U\+T, T\+C\+P\+\_\+\+S\+T\+A\+T\+U\+S\+\_\+\+C\+O\+N\+F\+I\+R\+M\+E\+D, unix\+\_\+time(), and write\+\_\+packet\+\_\+\+T\+C\+P\+\_\+secure\+\_\+connection().



Referenced by do\+\_\+\+T\+C\+P\+\_\+server().


\begin{DoxyCode}
1129 \{
1130 \textcolor{preprocessor}{#ifdef TCP\_SERVER\_USE\_EPOLL}
1131 
1132     \textcolor{keywordflow}{if} (TCP\_server->last\_run\_pinged == \hyperlink{util_8c_ac958d9f8847cb8039444bfa3d304233a}{unix\_time}())
1133         \textcolor{keywordflow}{return};
1134 
1135     TCP\_server->last\_run\_pinged = \hyperlink{util_8c_ac958d9f8847cb8039444bfa3d304233a}{unix\_time}();
1136 \textcolor{preprocessor}{#endif}
1137     uint32\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
1138 
1139     \textcolor{keywordflow}{for} (i = 0; i < TCP\_server->\hyperlink{struct_t_c_p___server_a6348c77f7067c2876de893aedb559972}{size\_accepted\_connections}; ++
      \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
1140         \hyperlink{struct_t_c_p___secure___connection}{TCP\_Secure\_Connection} *conn = &TCP\_server->
      \hyperlink{struct_t_c_p___server_aaec24f8b80a7853d1b7da87e903c44ee}{accepted\_connection\_array}[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}];
1141 
1142         \textcolor{keywordflow}{if} (conn->\hyperlink{struct_t_c_p___secure___connection_ade818037fd6c985038ff29656089758d}{status} != \hyperlink{_t_c_p__server_8h_a5d76b81b0ad4c19007a781d4edb8181fa42e6e74e5c62734eb1386045e159a601}{TCP\_STATUS\_CONFIRMED})
1143             \textcolor{keywordflow}{continue};
1144 
1145         \textcolor{keywordflow}{if} (\hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(conn->\hyperlink{struct_t_c_p___secure___connection_a4049204f6c392628d31be6c39f03e031}{last\_pinged}, 
      \hyperlink{_t_c_p__server_8h_a779366bdff0863c4e36c9313b25fcb29}{TCP\_PING\_FREQUENCY})) \{
1146             uint8\_t ping[1 + \textcolor{keyword}{sizeof}(uint64\_t)];
1147             ping[0] = \hyperlink{_t_c_p__server_8h_aa1328be3bbb33d8e47490408376c3553}{TCP\_PACKET\_PING};
1148             uint64\_t ping\_id = \hyperlink{crypto__core_8c_a1ce51b34ab2247e750b9c2a25121eb9e}{random\_64b}();
1149 
1150             \textcolor{keywordflow}{if} (!ping\_id)
1151                 ++ping\_id;
1152 
1153             memcpy(ping + 1, &ping\_id, \textcolor{keyword}{sizeof}(uint64\_t));
1154             \textcolor{keywordtype}{int} ret = \hyperlink{_t_c_p__server_8c_a1b2fd7984b9d3eb39bf588fc9bc5e21f}{write\_packet\_TCP\_secure\_connection}(conn, ping, \textcolor{keyword}{
      sizeof}(ping), 1);
1155 
1156             \textcolor{keywordflow}{if} (ret == 1) \{
1157                 conn->\hyperlink{struct_t_c_p___secure___connection_a4049204f6c392628d31be6c39f03e031}{last\_pinged} = \hyperlink{util_8c_ac958d9f8847cb8039444bfa3d304233a}{unix\_time}();
1158                 conn->\hyperlink{struct_t_c_p___secure___connection_acec02fbdff648ca71a6d8e5a0d63d634}{ping\_id} = ping\_id;
1159             \} \textcolor{keywordflow}{else} \{
1160                 \textcolor{keywordflow}{if} (\hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(conn->\hyperlink{struct_t_c_p___secure___connection_a4049204f6c392628d31be6c39f03e031}{last\_pinged}, 
      \hyperlink{_t_c_p__server_8h_a779366bdff0863c4e36c9313b25fcb29}{TCP\_PING\_FREQUENCY} + \hyperlink{_t_c_p__server_8h_a09b714899296b82866bab0a4d294c917}{TCP\_PING\_TIMEOUT})) \{
1161                     \hyperlink{_t_c_p__server_8c_a2f45b38fbf8f1646a682172973fd7a25}{kill\_accepted}(TCP\_server, i);
1162                     \textcolor{keywordflow}{continue};
1163                 \}
1164             \}
1165         \}
1166 
1167         \textcolor{keywordflow}{if} (conn->\hyperlink{struct_t_c_p___secure___connection_acec02fbdff648ca71a6d8e5a0d63d634}{ping\_id} && \hyperlink{util_8c_ab643c84141e04b54ba650c50165ba288}{is\_timeout}(conn->\hyperlink{struct_t_c_p___secure___connection_a4049204f6c392628d31be6c39f03e031}{last\_pinged}, 
      \hyperlink{_t_c_p__server_8h_a09b714899296b82866bab0a4d294c917}{TCP\_PING\_TIMEOUT})) \{
1168             \hyperlink{_t_c_p__server_8c_a2f45b38fbf8f1646a682172973fd7a25}{kill\_accepted}(TCP\_server, i);
1169             \textcolor{keywordflow}{continue};
1170         \}
1171 
1172         \hyperlink{_t_c_p__server_8c_a80fa82b117432f080f39f481ab5d9fef}{send\_pending\_data}(conn);
1173 
1174 \textcolor{preprocessor}{#ifndef TCP\_SERVER\_USE\_EPOLL}
1175 
1176         \hyperlink{_t_c_p__server_8c_ab84742dd52ed6c8e83287ea5202e4326}{do\_confirmed\_recv}(TCP\_server, i);
1177 
1178 \textcolor{preprocessor}{#endif}
1179     \}
1180 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_a001f38d27860442b6fe9fe7dd030a7a0_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_a001f38d27860442b6fe9fe7dd030a7a0_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__server_8c_affc332b8c3280bd44fa933413d678796}{\index{T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}!do\+\_\+\+T\+C\+P\+\_\+incomming@{do\+\_\+\+T\+C\+P\+\_\+incomming}}
\index{do\+\_\+\+T\+C\+P\+\_\+incomming@{do\+\_\+\+T\+C\+P\+\_\+incomming}!T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}}
\subsubsection[{do\+\_\+\+T\+C\+P\+\_\+incomming}]{\setlength{\rightskip}{0pt plus 5cm}static void do\+\_\+\+T\+C\+P\+\_\+incomming (
\begin{DoxyParamCaption}
\item[{{\bf T\+C\+P\+\_\+\+Server} $\ast$}]{T\+C\+P\+\_\+server}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_t_c_p__server_8c_affc332b8c3280bd44fa933413d678796}


Definition at line 1110 of file T\+C\+P\+\_\+server.\+c.



References do\+\_\+incoming(), i, and M\+A\+X\+\_\+\+I\+N\+C\+O\+M\+M\+I\+N\+G\+\_\+\+C\+O\+N\+N\+E\+C\+T\+I\+O\+N\+S.



Referenced by do\+\_\+\+T\+C\+P\+\_\+server().


\begin{DoxyCode}
1111 \{
1112     uint32\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
1113 
1114     \textcolor{keywordflow}{for} (i = 0; i < \hyperlink{_t_c_p__server_8h_a2c62883bf7895f3582975a14ec316bef}{MAX\_INCOMMING\_CONNECTIONS}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
1115         \hyperlink{_t_c_p__server_8c_a02fab0695a22b7f75c83439b2b6937ca}{do\_incoming}(TCP\_server, i);
1116     \}
1117 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_affc332b8c3280bd44fa933413d678796_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_affc332b8c3280bd44fa933413d678796_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__server_8c_a40e8a0302a359dd4f712eb1e9c346fe5}{\index{T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}!do\+\_\+\+T\+C\+P\+\_\+server@{do\+\_\+\+T\+C\+P\+\_\+server}}
\index{do\+\_\+\+T\+C\+P\+\_\+server@{do\+\_\+\+T\+C\+P\+\_\+server}!T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}}
\subsubsection[{do\+\_\+\+T\+C\+P\+\_\+server}]{\setlength{\rightskip}{0pt plus 5cm}void do\+\_\+\+T\+C\+P\+\_\+server (
\begin{DoxyParamCaption}
\item[{{\bf T\+C\+P\+\_\+\+Server} $\ast$}]{T\+C\+P\+\_\+server}
\end{DoxyParamCaption}
)}}\label{_t_c_p__server_8c_a40e8a0302a359dd4f712eb1e9c346fe5}


Definition at line 1305 of file T\+C\+P\+\_\+server.\+c.



References do\+\_\+\+T\+C\+P\+\_\+accept\+\_\+new(), do\+\_\+\+T\+C\+P\+\_\+confirmed(), do\+\_\+\+T\+C\+P\+\_\+incomming(), do\+\_\+\+T\+C\+P\+\_\+unconfirmed(), and unix\+\_\+time\+\_\+update().



Referenced by do\+\_\+messenger(), main(), new\+\_\+\+T\+C\+P\+\_\+con(), and S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T().


\begin{DoxyCode}
1306 \{
1307     \hyperlink{util_8c_a849af10dd491723cf3abdef599846897}{unix\_time\_update}();
1308 
1309 \textcolor{preprocessor}{#ifdef TCP\_SERVER\_USE\_EPOLL}
1310     do\_TCP\_epoll(TCP\_server);
1311 
1312 \textcolor{preprocessor}{#else}
1313     \hyperlink{_t_c_p__server_8c_a8bcfa0b79de4e0fad8720af7d1ed1d70}{do\_TCP\_accept\_new}(TCP\_server);
1314     \hyperlink{_t_c_p__server_8c_affc332b8c3280bd44fa933413d678796}{do\_TCP\_incomming}(TCP\_server);
1315     \hyperlink{_t_c_p__server_8c_aed90b296bcb98bcb905565ae68548c9a}{do\_TCP\_unconfirmed}(TCP\_server);
1316 \textcolor{preprocessor}{#endif}
1317 
1318     \hyperlink{_t_c_p__server_8c_a001f38d27860442b6fe9fe7dd030a7a0}{do\_TCP\_confirmed}(TCP\_server);
1319 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_a40e8a0302a359dd4f712eb1e9c346fe5_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_a40e8a0302a359dd4f712eb1e9c346fe5_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__server_8c_aed90b296bcb98bcb905565ae68548c9a}{\index{T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}!do\+\_\+\+T\+C\+P\+\_\+unconfirmed@{do\+\_\+\+T\+C\+P\+\_\+unconfirmed}}
\index{do\+\_\+\+T\+C\+P\+\_\+unconfirmed@{do\+\_\+\+T\+C\+P\+\_\+unconfirmed}!T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}}
\subsubsection[{do\+\_\+\+T\+C\+P\+\_\+unconfirmed}]{\setlength{\rightskip}{0pt plus 5cm}static void do\+\_\+\+T\+C\+P\+\_\+unconfirmed (
\begin{DoxyParamCaption}
\item[{{\bf T\+C\+P\+\_\+\+Server} $\ast$}]{T\+C\+P\+\_\+server}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_t_c_p__server_8c_aed90b296bcb98bcb905565ae68548c9a}


Definition at line 1119 of file T\+C\+P\+\_\+server.\+c.



References do\+\_\+unconfirmed(), i, and M\+A\+X\+\_\+\+I\+N\+C\+O\+M\+M\+I\+N\+G\+\_\+\+C\+O\+N\+N\+E\+C\+T\+I\+O\+N\+S.



Referenced by do\+\_\+\+T\+C\+P\+\_\+server().


\begin{DoxyCode}
1120 \{
1121     uint32\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
1122 
1123     \textcolor{keywordflow}{for} (i = 0; i < \hyperlink{_t_c_p__server_8h_a2c62883bf7895f3582975a14ec316bef}{MAX\_INCOMMING\_CONNECTIONS}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
1124         \hyperlink{_t_c_p__server_8c_a8cdae1ef768b85b02dcc79ff2258606f}{do\_unconfirmed}(TCP\_server, i);
1125     \}
1126 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_aed90b296bcb98bcb905565ae68548c9a_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_aed90b296bcb98bcb905565ae68548c9a_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__server_8c_a8cdae1ef768b85b02dcc79ff2258606f}{\index{T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}!do\+\_\+unconfirmed@{do\+\_\+unconfirmed}}
\index{do\+\_\+unconfirmed@{do\+\_\+unconfirmed}!T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}}
\subsubsection[{do\+\_\+unconfirmed}]{\setlength{\rightskip}{0pt plus 5cm}static int do\+\_\+unconfirmed (
\begin{DoxyParamCaption}
\item[{{\bf T\+C\+P\+\_\+\+Server} $\ast$}]{T\+C\+P\+\_\+server, }
\item[{uint32\+\_\+t}]{i}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_t_c_p__server_8c_a8cdae1ef768b85b02dcc79ff2258606f}


Definition at line 1068 of file T\+C\+P\+\_\+server.\+c.



References confirm\+\_\+\+T\+C\+P\+\_\+connection(), i, kill\+\_\+\+T\+C\+P\+\_\+connection(), M\+A\+X\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+S\+I\+Z\+E, T\+C\+P\+\_\+\+Secure\+\_\+\+Connection\+::next\+\_\+packet\+\_\+length, read\+\_\+packet\+\_\+\+T\+C\+P\+\_\+secure\+\_\+connection(), T\+C\+P\+\_\+\+Secure\+\_\+\+Connection\+::recv\+\_\+nonce, T\+C\+P\+\_\+\+Secure\+\_\+\+Connection\+::shared\+\_\+key, T\+C\+P\+\_\+\+Secure\+\_\+\+Connection\+::sock, T\+C\+P\+\_\+\+Secure\+\_\+\+Connection\+::status, T\+C\+P\+\_\+\+S\+T\+A\+T\+U\+S\+\_\+\+U\+N\+C\+O\+N\+F\+I\+R\+M\+E\+D, and T\+C\+P\+\_\+\+Server\+::unconfirmed\+\_\+connection\+\_\+queue.



Referenced by do\+\_\+\+T\+C\+P\+\_\+unconfirmed().


\begin{DoxyCode}
1069 \{
1070     \hyperlink{struct_t_c_p___secure___connection}{TCP\_Secure\_Connection} *conn = &TCP\_server->
      \hyperlink{struct_t_c_p___server_a8e84d42c724209bf3967de32506beeba}{unconfirmed\_connection\_queue}[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}];
1071 
1072     \textcolor{keywordflow}{if} (conn->\hyperlink{struct_t_c_p___secure___connection_ade818037fd6c985038ff29656089758d}{status} != \hyperlink{_t_c_p__server_8h_a5d76b81b0ad4c19007a781d4edb8181fa17e64dcb5cb3bb08704b328ff40c8138}{TCP\_STATUS\_UNCONFIRMED})
1073         \textcolor{keywordflow}{return} -1;
1074 
1075     uint8\_t packet[\hyperlink{_t_c_p__server_8h_a879456c3b8e2853f7044d764e9c180d4}{MAX\_PACKET\_SIZE}];
1076     \textcolor{keywordtype}{int} len = \hyperlink{_t_c_p__server_8c_a2acbecbd76fe539293b5d92d0e0b6c5e}{read\_packet\_TCP\_secure\_connection}(conn->
      \hyperlink{struct_t_c_p___secure___connection_a35b19d84fb632ca8ce5cab237f7089a5}{sock}, &conn->\hyperlink{struct_t_c_p___secure___connection_a1d1e3047af3c935db36ae7b2360aaec7}{next\_packet\_length}, conn->\hyperlink{struct_t_c_p___secure___connection_a81ead9fac55a0cedc30a96253a2c5119}{shared\_key}, conn->
      \hyperlink{struct_t_c_p___secure___connection_aae0467706f97aa3ef23e5dc9c3c199d7}{recv\_nonce},
1077               packet, \textcolor{keyword}{sizeof}(packet));
1078 
1079     \textcolor{keywordflow}{if} (len == 0) \{
1080         \textcolor{keywordflow}{return} -1;
1081     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (len == -1) \{
1082         \hyperlink{_t_c_p__server_8c_a51bace7dc1f6b7e7049430de070f3864}{kill\_TCP\_connection}(conn);
1083         \textcolor{keywordflow}{return} -1;
1084     \} \textcolor{keywordflow}{else} \{
1085         \textcolor{keywordflow}{return} \hyperlink{_t_c_p__server_8c_a00813f259948ef060f6ab7ec40da2f2c}{confirm\_TCP\_connection}(TCP\_server, conn, packet, len);
1086     \}
1087 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_a8cdae1ef768b85b02dcc79ff2258606f_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_a8cdae1ef768b85b02dcc79ff2258606f_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__server_8c_a11f81fcb9060389c52d55b079e1b8f3b}{\index{T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}!get\+\_\+\+T\+C\+P\+\_\+connection\+\_\+index@{get\+\_\+\+T\+C\+P\+\_\+connection\+\_\+index}}
\index{get\+\_\+\+T\+C\+P\+\_\+connection\+\_\+index@{get\+\_\+\+T\+C\+P\+\_\+connection\+\_\+index}!T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}}
\subsubsection[{get\+\_\+\+T\+C\+P\+\_\+connection\+\_\+index}]{\setlength{\rightskip}{0pt plus 5cm}static int get\+\_\+\+T\+C\+P\+\_\+connection\+\_\+index (
\begin{DoxyParamCaption}
\item[{const {\bf T\+C\+P\+\_\+\+Server} $\ast$}]{T\+C\+P\+\_\+server, }
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_t_c_p__server_8c_a11f81fcb9060389c52d55b079e1b8f3b}


Definition at line 100 of file T\+C\+P\+\_\+server.\+c.



References T\+C\+P\+\_\+\+Server\+::accepted\+\_\+key\+\_\+list, and bs\+\_\+list\+\_\+find().



Referenced by add\+\_\+accepted(), handle\+\_\+\+T\+C\+P\+\_\+oob\+\_\+send(), and handle\+\_\+\+T\+C\+P\+\_\+routing\+\_\+req().


\begin{DoxyCode}
101 \{
102     \textcolor{keywordflow}{return} \hyperlink{list_8c_aa2ee2cbbc130c7c976f2c69bda129bd1}{bs\_list\_find}(&TCP\_server->\hyperlink{struct_t_c_p___server_ae01209a4897757539a5ff199cdcfb64c}{accepted\_key\_list}, 
      \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key});
103 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_a11f81fcb9060389c52d55b079e1b8f3b_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_a11f81fcb9060389c52d55b079e1b8f3b_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__server_8c_aaee6d8849ed25c44203b345808d79bed}{\index{T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}!handle\+\_\+onion\+\_\+recv\+\_\+1@{handle\+\_\+onion\+\_\+recv\+\_\+1}}
\index{handle\+\_\+onion\+\_\+recv\+\_\+1@{handle\+\_\+onion\+\_\+recv\+\_\+1}!T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}}
\subsubsection[{handle\+\_\+onion\+\_\+recv\+\_\+1}]{\setlength{\rightskip}{0pt plus 5cm}static int handle\+\_\+onion\+\_\+recv\+\_\+1 (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{object, }
\item[{{\bf I\+P\+\_\+\+Port}}]{dest, }
\item[{const uint8\+\_\+t $\ast$}]{data, }
\item[{uint16\+\_\+t}]{length}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_t_c_p__server_8c_aaee6d8849ed25c44203b345808d79bed}


Definition at line 714 of file T\+C\+P\+\_\+server.\+c.



References T\+C\+P\+\_\+\+Server\+::accepted\+\_\+connection\+\_\+array, T\+C\+P\+\_\+\+Secure\+\_\+\+Connection\+::identifier, I\+P\+\_\+\+Port\+::ip, I\+P\+::ip6, T\+C\+P\+\_\+\+Server\+::size\+\_\+accepted\+\_\+connections, T\+C\+P\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+O\+N\+I\+O\+N\+\_\+\+R\+E\+S\+P\+O\+N\+S\+E, I\+P6\+::uint32, I\+P6\+::uint64, and write\+\_\+packet\+\_\+\+T\+C\+P\+\_\+secure\+\_\+connection().



Referenced by new\+\_\+\+T\+C\+P\+\_\+server().


\begin{DoxyCode}
715 \{
716     \hyperlink{struct_t_c_p___server}{TCP\_Server} *TCP\_server = object;
717     uint32\_t index = dest.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_a14c606eb5ffb078c38ad854dc4e79507}{ip6}.\hyperlink{union_i_p6_a1d8ab1f6c1da5565bed41e7095610dea}{uint32}[0];
718 
719     \textcolor{keywordflow}{if} (index >= TCP\_server->\hyperlink{struct_t_c_p___server_a6348c77f7067c2876de893aedb559972}{size\_accepted\_connections})
720         \textcolor{keywordflow}{return} 1;
721 
722     \hyperlink{struct_t_c_p___secure___connection}{TCP\_Secure\_Connection} *con = &TCP\_server->
      \hyperlink{struct_t_c_p___server_aaec24f8b80a7853d1b7da87e903c44ee}{accepted\_connection\_array}[index];
723 
724     \textcolor{keywordflow}{if} (con->\hyperlink{struct_t_c_p___secure___connection_ad1813f451cfaf8c9700e6329c5ea2f2b}{identifier} != dest.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_a14c606eb5ffb078c38ad854dc4e79507}{ip6}.\hyperlink{union_i_p6_a36c7a85cc2c5062edd5ebf13d46fa343}{uint64}[1])
725         \textcolor{keywordflow}{return} 1;
726 
727     uint8\_t packet[1 + length];
728     memcpy(packet + 1, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}, length);
729     packet[0] = \hyperlink{_t_c_p__server_8h_acbe72759c701ff843abf6a80dafee7e8}{TCP\_PACKET\_ONION\_RESPONSE};
730 
731     \textcolor{keywordflow}{if} (\hyperlink{_t_c_p__server_8c_a1b2fd7984b9d3eb39bf588fc9bc5e21f}{write\_packet\_TCP\_secure\_connection}(con, packet, \textcolor{keyword}{sizeof}(packet), 0
      ) != 1)
732         \textcolor{keywordflow}{return} 1;
733 
734     \textcolor{keywordflow}{return} 0;
735 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_aaee6d8849ed25c44203b345808d79bed_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_aaee6d8849ed25c44203b345808d79bed_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__server_8c_ad83c5da554cb68b07d7bef24c99c8ad8}{\index{T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}!handle\+\_\+\+T\+C\+P\+\_\+handshake@{handle\+\_\+\+T\+C\+P\+\_\+handshake}}
\index{handle\+\_\+\+T\+C\+P\+\_\+handshake@{handle\+\_\+\+T\+C\+P\+\_\+handshake}!T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}}
\subsubsection[{handle\+\_\+\+T\+C\+P\+\_\+handshake}]{\setlength{\rightskip}{0pt plus 5cm}static int handle\+\_\+\+T\+C\+P\+\_\+handshake (
\begin{DoxyParamCaption}
\item[{{\bf T\+C\+P\+\_\+\+Secure\+\_\+\+Connection} $\ast$}]{con, }
\item[{const uint8\+\_\+t $\ast$}]{data, }
\item[{uint16\+\_\+t}]{length, }
\item[{const uint8\+\_\+t $\ast$}]{self\+\_\+secret\+\_\+key}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_t_c_p__server_8c_ad83c5da554cb68b07d7bef24c99c8ad8}


Definition at line 483 of file T\+C\+P\+\_\+server.\+c.



References decrypt\+\_\+data\+\_\+symmetric(), encrypt\+\_\+data\+\_\+symmetric(), encrypt\+\_\+precompute(), new\+\_\+nonce(), T\+C\+P\+\_\+\+Secure\+\_\+\+Connection\+::public\+\_\+key, random\+\_\+nonce(), T\+C\+P\+\_\+\+Secure\+\_\+\+Connection\+::recv\+\_\+nonce, T\+C\+P\+\_\+\+Secure\+\_\+\+Connection\+::sent\+\_\+nonce, T\+C\+P\+\_\+\+Secure\+\_\+\+Connection\+::shared\+\_\+key, T\+C\+P\+\_\+\+Secure\+\_\+\+Connection\+::sock, T\+C\+P\+\_\+\+Secure\+\_\+\+Connection\+::status, T\+C\+P\+\_\+\+C\+L\+I\+E\+N\+T\+\_\+\+H\+A\+N\+D\+S\+H\+A\+K\+E\+\_\+\+S\+I\+Z\+E, T\+C\+P\+\_\+\+H\+A\+N\+D\+S\+H\+A\+K\+E\+\_\+\+P\+L\+A\+I\+N\+\_\+\+S\+I\+Z\+E, T\+C\+P\+\_\+\+S\+E\+R\+V\+E\+R\+\_\+\+H\+A\+N\+D\+S\+H\+A\+K\+E\+\_\+\+S\+I\+Z\+E, T\+C\+P\+\_\+\+S\+T\+A\+T\+U\+S\+\_\+\+C\+O\+N\+N\+E\+C\+T\+E\+D, and T\+C\+P\+\_\+\+S\+T\+A\+T\+U\+S\+\_\+\+U\+N\+C\+O\+N\+F\+I\+R\+M\+E\+D.



Referenced by read\+\_\+connection\+\_\+handshake().


\begin{DoxyCode}
485 \{
486     \textcolor{keywordflow}{if} (length != \hyperlink{_t_c_p__server_8h_aa5f4778a5c176dbd24018f61cc7524f7}{TCP\_CLIENT\_HANDSHAKE\_SIZE})
487         \textcolor{keywordflow}{return} -1;
488 
489     \textcolor{keywordflow}{if} (con->\hyperlink{struct_t_c_p___secure___connection_ade818037fd6c985038ff29656089758d}{status} != \hyperlink{_t_c_p__server_8h_a5d76b81b0ad4c19007a781d4edb8181fab5e948cd81931f0c7e6a827e90c24616}{TCP\_STATUS\_CONNECTED})
490         \textcolor{keywordflow}{return} -1;
491 
492     uint8\_t shared\_key[crypto\_box\_BEFORENMBYTES];
493     \hyperlink{crypto__core_8c_a0d8eaef49981c5dc3ada078866b42f6d}{encrypt\_precompute}(\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}, self\_secret\_key, shared\_key);
494     uint8\_t plain[\hyperlink{_t_c_p__server_8h_a9b820bd1123c0fbdfd8391cce314b35b}{TCP\_HANDSHAKE\_PLAIN\_SIZE}];
495     \textcolor{keywordtype}{int} len = \hyperlink{crypto__core_8c_a824b257fcff74b9d17c5247223fbed29}{decrypt\_data\_symmetric}(shared\_key, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} + crypto\_box\_PUBLICKEYBYTES
      ,
496                                      \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} + crypto\_box\_PUBLICKEYBYTES + crypto\_box\_NONCEBYTES, 
      \hyperlink{_t_c_p__server_8h_a9b820bd1123c0fbdfd8391cce314b35b}{TCP\_HANDSHAKE\_PLAIN\_SIZE} + crypto\_box\_MACBYTES, plain);
497 
498     \textcolor{keywordflow}{if} (len != \hyperlink{_t_c_p__server_8h_a9b820bd1123c0fbdfd8391cce314b35b}{TCP\_HANDSHAKE\_PLAIN\_SIZE})
499         \textcolor{keywordflow}{return} -1;
500 
501     memcpy(con->\hyperlink{struct_t_c_p___secure___connection_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}, crypto\_box\_PUBLICKEYBYTES);
502     uint8\_t temp\_secret\_key[crypto\_box\_SECRETKEYBYTES];
503     uint8\_t resp\_plain[\hyperlink{_t_c_p__server_8h_a9b820bd1123c0fbdfd8391cce314b35b}{TCP\_HANDSHAKE\_PLAIN\_SIZE}];
504     crypto\_box\_keypair(resp\_plain, temp\_secret\_key);
505     \hyperlink{crypto__core_8c_a15ef255ab026d4881a16b99148b05dd7}{random\_nonce}(con->\hyperlink{struct_t_c_p___secure___connection_a9df0e00e8f493ed6cd1ff45e7da33c0d}{sent\_nonce});
506     memcpy(resp\_plain + crypto\_box\_PUBLICKEYBYTES, con->\hyperlink{struct_t_c_p___secure___connection_a9df0e00e8f493ed6cd1ff45e7da33c0d}{sent\_nonce}, crypto\_box\_NONCEBYTES);
507     memcpy(con->\hyperlink{struct_t_c_p___secure___connection_aae0467706f97aa3ef23e5dc9c3c199d7}{recv\_nonce}, plain + crypto\_box\_PUBLICKEYBYTES, crypto\_box\_NONCEBYTES);
508 
509     uint8\_t response[\hyperlink{_t_c_p__server_8h_a88a61b02e465cd8c05fbae1def1066f2}{TCP\_SERVER\_HANDSHAKE\_SIZE}];
510     \hyperlink{crypto__core_8c_a8b1033efb47c625779d11be7d8eb9e24}{new\_nonce}(response);
511 
512     len = \hyperlink{crypto__core_8c_a81efc0a4a6e0efe372651e26e342a6e5}{encrypt\_data\_symmetric}(shared\_key, response, resp\_plain, 
      \hyperlink{_t_c_p__server_8h_a9b820bd1123c0fbdfd8391cce314b35b}{TCP\_HANDSHAKE\_PLAIN\_SIZE},
513                                  response + crypto\_box\_NONCEBYTES);
514 
515     \textcolor{keywordflow}{if} (len != \hyperlink{_t_c_p__server_8h_a9b820bd1123c0fbdfd8391cce314b35b}{TCP\_HANDSHAKE\_PLAIN\_SIZE} + crypto\_box\_MACBYTES)
516         \textcolor{keywordflow}{return} -1;
517 
518     \textcolor{keywordflow}{if} (\hyperlink{_t_c_p__server_8h_a88a61b02e465cd8c05fbae1def1066f2}{TCP\_SERVER\_HANDSHAKE\_SIZE} != send(con->\hyperlink{struct_t_c_p___secure___connection_a35b19d84fb632ca8ce5cab237f7089a5}{sock}, response, 
      \hyperlink{_t_c_p__server_8h_a88a61b02e465cd8c05fbae1def1066f2}{TCP\_SERVER\_HANDSHAKE\_SIZE}, MSG\_NOSIGNAL))
519         \textcolor{keywordflow}{return} -1;
520 
521     \hyperlink{crypto__core_8c_a0d8eaef49981c5dc3ada078866b42f6d}{encrypt\_precompute}(plain, temp\_secret\_key, con->\hyperlink{struct_t_c_p___secure___connection_a81ead9fac55a0cedc30a96253a2c5119}{shared\_key});
522     con->\hyperlink{struct_t_c_p___secure___connection_ade818037fd6c985038ff29656089758d}{status} = \hyperlink{_t_c_p__server_8h_a5d76b81b0ad4c19007a781d4edb8181fa17e64dcb5cb3bb08704b328ff40c8138}{TCP\_STATUS\_UNCONFIRMED};
523     \textcolor{keywordflow}{return} 1;
524 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_ad83c5da554cb68b07d7bef24c99c8ad8_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_ad83c5da554cb68b07d7bef24c99c8ad8_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__server_8c_a7631710481101de4b345f7e318fdb88a}{\index{T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}!handle\+\_\+\+T\+C\+P\+\_\+oob\+\_\+send@{handle\+\_\+\+T\+C\+P\+\_\+oob\+\_\+send}}
\index{handle\+\_\+\+T\+C\+P\+\_\+oob\+\_\+send@{handle\+\_\+\+T\+C\+P\+\_\+oob\+\_\+send}!T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}}
\subsubsection[{handle\+\_\+\+T\+C\+P\+\_\+oob\+\_\+send}]{\setlength{\rightskip}{0pt plus 5cm}static int handle\+\_\+\+T\+C\+P\+\_\+oob\+\_\+send (
\begin{DoxyParamCaption}
\item[{{\bf T\+C\+P\+\_\+\+Server} $\ast$}]{T\+C\+P\+\_\+server, }
\item[{uint32\+\_\+t}]{con\+\_\+id, }
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key, }
\item[{const uint8\+\_\+t $\ast$}]{data, }
\item[{uint16\+\_\+t}]{length}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_t_c_p__server_8c_a7631710481101de4b345f7e318fdb88a}


Definition at line 657 of file T\+C\+P\+\_\+server.\+c.



References T\+C\+P\+\_\+\+Server\+::accepted\+\_\+connection\+\_\+array, get\+\_\+\+T\+C\+P\+\_\+connection\+\_\+index(), T\+C\+P\+\_\+\+Secure\+\_\+\+Connection\+::public\+\_\+key, T\+C\+P\+\_\+\+M\+A\+X\+\_\+\+O\+O\+B\+\_\+\+D\+A\+T\+A\+\_\+\+L\+E\+N\+G\+T\+H, T\+C\+P\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+O\+O\+B\+\_\+\+R\+E\+C\+V, and write\+\_\+packet\+\_\+\+T\+C\+P\+\_\+secure\+\_\+connection().



Referenced by handle\+\_\+\+T\+C\+P\+\_\+packet().


\begin{DoxyCode}
659 \{
660     \textcolor{keywordflow}{if} (length == 0 || length > \hyperlink{_t_c_p__server_8h_a9f050748925b02db21564fa5f6c78e4e}{TCP\_MAX\_OOB\_DATA\_LENGTH})
661         \textcolor{keywordflow}{return} -1;
662 
663     \hyperlink{struct_t_c_p___secure___connection}{TCP\_Secure\_Connection} *con = &TCP\_server->
      \hyperlink{struct_t_c_p___server_aaec24f8b80a7853d1b7da87e903c44ee}{accepted\_connection\_array}[con\_id];
664 
665     \textcolor{keywordtype}{int} other\_index = \hyperlink{_t_c_p__server_8c_a11f81fcb9060389c52d55b079e1b8f3b}{get\_TCP\_connection\_index}(TCP\_server, 
      \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key});
666 
667     \textcolor{keywordflow}{if} (other\_index != -1) \{
668         uint8\_t resp\_packet[1 + crypto\_box\_PUBLICKEYBYTES + length];
669         resp\_packet[0] = \hyperlink{_t_c_p__server_8h_a6d824009f914ddf664d60adf6695189c}{TCP\_PACKET\_OOB\_RECV};
670         memcpy(resp\_packet + 1, con->\hyperlink{struct_t_c_p___secure___connection_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, crypto\_box\_PUBLICKEYBYTES);
671         memcpy(resp\_packet + 1 + crypto\_box\_PUBLICKEYBYTES, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}, length);
672         \hyperlink{_t_c_p__server_8c_a1b2fd7984b9d3eb39bf588fc9bc5e21f}{write\_packet\_TCP\_secure\_connection}(&TCP\_server->
      \hyperlink{struct_t_c_p___server_aaec24f8b80a7853d1b7da87e903c44ee}{accepted\_connection\_array}[other\_index], resp\_packet,
673                                            \textcolor{keyword}{sizeof}(resp\_packet), 0);
674     \}
675 
676     \textcolor{keywordflow}{return} 0;
677 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_a7631710481101de4b345f7e318fdb88a_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_a7631710481101de4b345f7e318fdb88a_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__server_8c_a904af6fcbd24cb3f75c4a04470be46de}{\index{T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}!handle\+\_\+\+T\+C\+P\+\_\+packet@{handle\+\_\+\+T\+C\+P\+\_\+packet}}
\index{handle\+\_\+\+T\+C\+P\+\_\+packet@{handle\+\_\+\+T\+C\+P\+\_\+packet}!T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}}
\subsubsection[{handle\+\_\+\+T\+C\+P\+\_\+packet}]{\setlength{\rightskip}{0pt plus 5cm}static int handle\+\_\+\+T\+C\+P\+\_\+packet (
\begin{DoxyParamCaption}
\item[{{\bf T\+C\+P\+\_\+\+Server} $\ast$}]{T\+C\+P\+\_\+server, }
\item[{uint32\+\_\+t}]{con\+\_\+id, }
\item[{const uint8\+\_\+t $\ast$}]{data, }
\item[{uint16\+\_\+t}]{length}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_t_c_p__server_8c_a904af6fcbd24cb3f75c4a04470be46de}


Definition at line 740 of file T\+C\+P\+\_\+server.\+c.



References T\+C\+P\+\_\+\+Server\+::accepted\+\_\+connection\+\_\+array, T\+C\+P\+\_\+\+Secure\+\_\+\+Connection\+::connections, I\+P\+::family, handle\+\_\+\+T\+C\+P\+\_\+oob\+\_\+send(), handle\+\_\+\+T\+C\+P\+\_\+routing\+\_\+req(), T\+C\+P\+\_\+\+Secure\+\_\+\+Connection\+::identifier, T\+C\+P\+\_\+\+Secure\+\_\+\+Connection\+::index, I\+P\+\_\+\+Port\+::ip, I\+P\+::ip6, N\+U\+M\+\_\+\+C\+L\+I\+E\+N\+T\+\_\+\+C\+O\+N\+N\+E\+C\+T\+I\+O\+N\+S, N\+U\+M\+\_\+\+R\+E\+S\+E\+R\+V\+E\+D\+\_\+\+P\+O\+R\+T\+S, T\+C\+P\+\_\+\+Server\+::onion, onion\+\_\+send\+\_\+1(), O\+N\+I\+O\+N\+\_\+\+S\+E\+N\+D\+\_\+\+B\+A\+S\+E, T\+C\+P\+\_\+\+Secure\+\_\+\+Connection\+::other\+\_\+id, T\+C\+P\+\_\+\+Secure\+\_\+\+Connection\+::ping\+\_\+id, I\+P\+\_\+\+Port\+::port, rm\+\_\+connection\+\_\+index(), T\+C\+P\+\_\+\+Secure\+\_\+\+Connection\+::status, T\+C\+P\+\_\+\+O\+N\+I\+O\+N\+\_\+\+F\+A\+M\+I\+L\+Y, T\+C\+P\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+C\+O\+N\+N\+E\+C\+T\+I\+O\+N\+\_\+\+N\+O\+T\+I\+F\+I\+C\+A\+T\+I\+O\+N, T\+C\+P\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+D\+I\+S\+C\+O\+N\+N\+E\+C\+T\+\_\+\+N\+O\+T\+I\+F\+I\+C\+A\+T\+I\+O\+N, T\+C\+P\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+O\+N\+I\+O\+N\+\_\+\+R\+E\+Q\+U\+E\+S\+T, T\+C\+P\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+O\+N\+I\+O\+N\+\_\+\+R\+E\+S\+P\+O\+N\+S\+E, T\+C\+P\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+O\+O\+B\+\_\+\+S\+E\+N\+D, T\+C\+P\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+P\+I\+N\+G, T\+C\+P\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+P\+O\+N\+G, T\+C\+P\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+R\+O\+U\+T\+I\+N\+G\+\_\+\+R\+E\+Q\+U\+E\+S\+T, I\+P6\+::uint32, I\+P6\+::uint64, and write\+\_\+packet\+\_\+\+T\+C\+P\+\_\+secure\+\_\+connection().



Referenced by confirm\+\_\+\+T\+C\+P\+\_\+connection(), and do\+\_\+confirmed\+\_\+recv().


\begin{DoxyCode}
741 \{
742     \textcolor{keywordflow}{if} (length == 0)
743         \textcolor{keywordflow}{return} -1;
744 
745     \hyperlink{struct_t_c_p___secure___connection}{TCP\_Secure\_Connection} *con = &TCP\_server->
      \hyperlink{struct_t_c_p___server_aaec24f8b80a7853d1b7da87e903c44ee}{accepted\_connection\_array}[con\_id];
746 
747     \textcolor{keywordflow}{switch} (\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[0]) \{
748         \textcolor{keywordflow}{case} \hyperlink{_t_c_p__server_8h_a808af5b9484311a39abb96dac1ecd426}{TCP\_PACKET\_ROUTING\_REQUEST}: \{
749             \textcolor{keywordflow}{if} (length != 1 + crypto\_box\_PUBLICKEYBYTES)
750                 \textcolor{keywordflow}{return} -1;
751 
752             \textcolor{keywordflow}{return} \hyperlink{_t_c_p__server_8c_af925f101a4e90d1fa2381536ef23a794}{handle\_TCP\_routing\_req}(TCP\_server, con\_id, 
      \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} + 1);
753         \}
754 
755         \textcolor{keywordflow}{case} \hyperlink{_t_c_p__server_8h_ae03ebbe7438d78a242e6970f35eb6dfa}{TCP\_PACKET\_CONNECTION\_NOTIFICATION}: \{
756             \textcolor{keywordflow}{if} (length != 2)
757                 \textcolor{keywordflow}{return} -1;
758 
759             \textcolor{keywordflow}{break};
760         \}
761 
762         \textcolor{keywordflow}{case} \hyperlink{_t_c_p__server_8h_a65b6df680eaecb9563dfcc8c5fcfba3d}{TCP\_PACKET\_DISCONNECT\_NOTIFICATION}: \{
763             \textcolor{keywordflow}{if} (length != 2)
764                 \textcolor{keywordflow}{return} -1;
765 
766             \textcolor{keywordflow}{return} \hyperlink{_t_c_p__server_8c_a537d1f47612f3dbb19a92e557b062c20}{rm\_connection\_index}(TCP\_server, con, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[1] - 
      \hyperlink{_t_c_p__server_8h_a41d07eb7b13b1998b771080dfaef6b7b}{NUM\_RESERVED\_PORTS});
767         \}
768 
769         \textcolor{keywordflow}{case} \hyperlink{_t_c_p__server_8h_aa1328be3bbb33d8e47490408376c3553}{TCP\_PACKET\_PING}: \{
770             \textcolor{keywordflow}{if} (length != 1 + \textcolor{keyword}{sizeof}(uint64\_t))
771                 \textcolor{keywordflow}{return} -1;
772 
773             uint8\_t response[1 + \textcolor{keyword}{sizeof}(uint64\_t)];
774             response[0] = \hyperlink{_t_c_p__server_8h_a783819134f7296fb82cfc3149f6fbb62}{TCP\_PACKET\_PONG};
775             memcpy(response + 1, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} + 1, \textcolor{keyword}{sizeof}(uint64\_t));
776             \hyperlink{_t_c_p__server_8c_a1b2fd7984b9d3eb39bf588fc9bc5e21f}{write\_packet\_TCP\_secure\_connection}(con, response, \textcolor{keyword}{sizeof}(
      response), 1);
777             \textcolor{keywordflow}{return} 0;
778         \}
779 
780         \textcolor{keywordflow}{case} \hyperlink{_t_c_p__server_8h_a783819134f7296fb82cfc3149f6fbb62}{TCP\_PACKET\_PONG}: \{
781             \textcolor{keywordflow}{if} (length != 1 + \textcolor{keyword}{sizeof}(uint64\_t))
782                 \textcolor{keywordflow}{return} -1;
783 
784             uint64\_t ping\_id;
785             memcpy(&ping\_id, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} + 1, \textcolor{keyword}{sizeof}(uint64\_t));
786 
787             \textcolor{keywordflow}{if} (ping\_id) \{
788                 \textcolor{keywordflow}{if} (ping\_id == con->\hyperlink{struct_t_c_p___secure___connection_acec02fbdff648ca71a6d8e5a0d63d634}{ping\_id}) \{
789                     con->\hyperlink{struct_t_c_p___secure___connection_acec02fbdff648ca71a6d8e5a0d63d634}{ping\_id} = 0;
790                 \}
791 
792                 \textcolor{keywordflow}{return} 0;
793             \} \textcolor{keywordflow}{else} \{
794                 \textcolor{keywordflow}{return} -1;
795             \}
796         \}
797 
798         \textcolor{keywordflow}{case} \hyperlink{_t_c_p__server_8h_a5961d2c3587485c79194c5479a8b0973}{TCP\_PACKET\_OOB\_SEND}: \{
799             \textcolor{keywordflow}{if} (length <= 1 + crypto\_box\_PUBLICKEYBYTES)
800                 \textcolor{keywordflow}{return} -1;
801 
802             \textcolor{keywordflow}{return} \hyperlink{_t_c_p__server_8c_a7631710481101de4b345f7e318fdb88a}{handle\_TCP\_oob\_send}(TCP\_server, con\_id, 
      \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} + 1, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} + 1 + crypto\_box\_PUBLICKEYBYTES,
803                                        length - (1 + crypto\_box\_PUBLICKEYBYTES));
804         \}
805 
806         \textcolor{keywordflow}{case} \hyperlink{_t_c_p__server_8h_a879315f1b7234dad07a45d63a6d0aed5}{TCP\_PACKET\_ONION\_REQUEST}: \{
807             \textcolor{keywordflow}{if} (TCP\_server->\hyperlink{struct_t_c_p___server_a66fb4bf67c711a5ed3e7bbecec7fde30}{onion}) \{
808                 \textcolor{keywordflow}{if} (length <= 1 + crypto\_box\_NONCEBYTES + \hyperlink{onion_8h_ac078bb7fac05e43bda3ef57b9d017ab9}{ONION\_SEND\_BASE} * 2)
809                     \textcolor{keywordflow}{return} -1;
810 
811                 \hyperlink{struct_i_p___port}{IP\_Port} source;
812                 source.\hyperlink{struct_i_p___port_a8e0798404bf2cf5dabb84c5ba9a4f236}{port} = 0;  \textcolor{comment}{// dummy initialise}
813                 source.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} = \hyperlink{network_8h_ab1781daa396d0fa3533c06ed6f74a2a3}{TCP\_ONION\_FAMILY};
814                 source.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_a14c606eb5ffb078c38ad854dc4e79507}{ip6}.\hyperlink{union_i_p6_a1d8ab1f6c1da5565bed41e7095610dea}{uint32}[0] = con\_id;
815                 source.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_a14c606eb5ffb078c38ad854dc4e79507}{ip6}.\hyperlink{union_i_p6_a1d8ab1f6c1da5565bed41e7095610dea}{uint32}[1] = 0;
816                 source.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_a14c606eb5ffb078c38ad854dc4e79507}{ip6}.\hyperlink{union_i_p6_a36c7a85cc2c5062edd5ebf13d46fa343}{uint64}[1] = con->\hyperlink{struct_t_c_p___secure___connection_ad1813f451cfaf8c9700e6329c5ea2f2b}{identifier};
817                 \hyperlink{onion_8c_a112ff3dd6d8a1e104516eb4b465fc2fa}{onion\_send\_1}(TCP\_server->\hyperlink{struct_t_c_p___server_a66fb4bf67c711a5ed3e7bbecec7fde30}{onion}, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} + 1 + crypto\_box\_NONCEBYTES, 
      length - (1 + crypto\_box\_NONCEBYTES), source,
818                              \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} + 1);
819             \}
820 
821             \textcolor{keywordflow}{return} 0;
822         \}
823 
824         \textcolor{keywordflow}{case} \hyperlink{_t_c_p__server_8h_acbe72759c701ff843abf6a80dafee7e8}{TCP\_PACKET\_ONION\_RESPONSE}: \{
825             \textcolor{keywordflow}{return} -1;
826         \}
827 
828         \textcolor{keywordflow}{default}: \{
829             \textcolor{keywordflow}{if} (\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[0] < \hyperlink{_t_c_p__server_8h_a41d07eb7b13b1998b771080dfaef6b7b}{NUM\_RESERVED\_PORTS})
830                 \textcolor{keywordflow}{return} -1;
831 
832             uint8\_t c\_id = \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[0] - \hyperlink{_t_c_p__server_8h_a41d07eb7b13b1998b771080dfaef6b7b}{NUM\_RESERVED\_PORTS};
833 
834             \textcolor{keywordflow}{if} (c\_id >= \hyperlink{_t_c_p__server_8h_aad3362495a10d80b0edac21c8f896ae1}{NUM\_CLIENT\_CONNECTIONS})
835                 \textcolor{keywordflow}{return} -1;
836 
837             \textcolor{keywordflow}{if} (con->\hyperlink{struct_t_c_p___secure___connection_a9238a77824a37f8db533e2fbbf79c4a1}{connections}[c\_id].\hyperlink{struct_t_c_p___secure___connection_ade818037fd6c985038ff29656089758d}{status} == 0)
838                 \textcolor{keywordflow}{return} -1;
839 
840             \textcolor{keywordflow}{if} (con->\hyperlink{struct_t_c_p___secure___connection_a9238a77824a37f8db533e2fbbf79c4a1}{connections}[c\_id].\hyperlink{struct_t_c_p___secure___connection_ade818037fd6c985038ff29656089758d}{status} != 2)
841                 \textcolor{keywordflow}{return} 0;
842 
843             uint32\_t index = con->\hyperlink{struct_t_c_p___secure___connection_a9238a77824a37f8db533e2fbbf79c4a1}{connections}[c\_id].\hyperlink{struct_t_c_p___secure___connection_aafd95f8c7a99b9189ede7cdf0871ebe8}{index};
844             uint8\_t other\_c\_id = con->\hyperlink{struct_t_c_p___secure___connection_a9238a77824a37f8db533e2fbbf79c4a1}{connections}[c\_id].\hyperlink{struct_t_c_p___secure___connection_acc644a8b29d76cc8fb3a5bdfcaa2bfe1}{other\_id} + 
      \hyperlink{_t_c_p__server_8h_a41d07eb7b13b1998b771080dfaef6b7b}{NUM\_RESERVED\_PORTS};
845             uint8\_t new\_data[length];
846             memcpy(new\_data, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}, length);
847             new\_data[0] = other\_c\_id;
848             \textcolor{keywordtype}{int} ret = \hyperlink{_t_c_p__server_8c_a1b2fd7984b9d3eb39bf588fc9bc5e21f}{write\_packet\_TCP\_secure\_connection}(&TCP\_server->
      \hyperlink{struct_t_c_p___server_aaec24f8b80a7853d1b7da87e903c44ee}{accepted\_connection\_array}[index], new\_data, length, 0);
849 
850             \textcolor{keywordflow}{if} (ret == -1)
851                 \textcolor{keywordflow}{return} -1;
852 
853             \textcolor{keywordflow}{return} 0;
854         \}
855     \}
856 
857     \textcolor{keywordflow}{return} 0;
858 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_a904af6fcbd24cb3f75c4a04470be46de_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_a904af6fcbd24cb3f75c4a04470be46de_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__server_8c_af925f101a4e90d1fa2381536ef23a794}{\index{T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}!handle\+\_\+\+T\+C\+P\+\_\+routing\+\_\+req@{handle\+\_\+\+T\+C\+P\+\_\+routing\+\_\+req}}
\index{handle\+\_\+\+T\+C\+P\+\_\+routing\+\_\+req@{handle\+\_\+\+T\+C\+P\+\_\+routing\+\_\+req}!T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}}
\subsubsection[{handle\+\_\+\+T\+C\+P\+\_\+routing\+\_\+req}]{\setlength{\rightskip}{0pt plus 5cm}static int handle\+\_\+\+T\+C\+P\+\_\+routing\+\_\+req (
\begin{DoxyParamCaption}
\item[{{\bf T\+C\+P\+\_\+\+Server} $\ast$}]{T\+C\+P\+\_\+server, }
\item[{uint32\+\_\+t}]{con\+\_\+id, }
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_t_c_p__server_8c_af925f101a4e90d1fa2381536ef23a794}


Definition at line 579 of file T\+C\+P\+\_\+server.\+c.



References T\+C\+P\+\_\+\+Server\+::accepted\+\_\+connection\+\_\+array, T\+C\+P\+\_\+\+Secure\+\_\+\+Connection\+::connections, get\+\_\+\+T\+C\+P\+\_\+connection\+\_\+index(), i, T\+C\+P\+\_\+\+Secure\+\_\+\+Connection\+::index, N\+U\+M\+\_\+\+C\+L\+I\+E\+N\+T\+\_\+\+C\+O\+N\+N\+E\+C\+T\+I\+O\+N\+S, N\+U\+M\+\_\+\+R\+E\+S\+E\+R\+V\+E\+D\+\_\+\+P\+O\+R\+T\+S, T\+C\+P\+\_\+\+Secure\+\_\+\+Connection\+::other\+\_\+id, T\+C\+P\+\_\+\+Secure\+\_\+\+Connection\+::public\+\_\+key, send\+\_\+connect\+\_\+notification(), send\+\_\+routing\+\_\+response(), and T\+C\+P\+\_\+\+Secure\+\_\+\+Connection\+::status.



Referenced by handle\+\_\+\+T\+C\+P\+\_\+packet().


\begin{DoxyCode}
580 \{
581     uint32\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
582     uint32\_t index = ~0;
583     \hyperlink{struct_t_c_p___secure___connection}{TCP\_Secure\_Connection} *con = &TCP\_server->
      \hyperlink{struct_t_c_p___server_aaec24f8b80a7853d1b7da87e903c44ee}{accepted\_connection\_array}[con\_id];
584 
585     \textcolor{comment}{/* If person tries to cennect to himself we deny the request*/}
586     \textcolor{keywordflow}{if} (memcmp(con->\hyperlink{struct_t_c_p___secure___connection_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, crypto\_box\_PUBLICKEYBYTES) == 0) \{
587         \textcolor{keywordflow}{if} (\hyperlink{_t_c_p__server_8c_a378a47bb3e63730aa104d8da7d10f384}{send\_routing\_response}(con, 0, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}) == -1)
588             \textcolor{keywordflow}{return} -1;
589 
590         \textcolor{keywordflow}{return} 0;
591     \}
592 
593     \textcolor{keywordflow}{for} (i = 0; i < \hyperlink{_t_c_p__server_8h_aad3362495a10d80b0edac21c8f896ae1}{NUM\_CLIENT\_CONNECTIONS}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
594         \textcolor{keywordflow}{if} (con->\hyperlink{struct_t_c_p___secure___connection_a9238a77824a37f8db533e2fbbf79c4a1}{connections}[i].\hyperlink{struct_t_c_p___secure___connection_ade818037fd6c985038ff29656089758d}{status} != 0) \{
595             \textcolor{keywordflow}{if} (memcmp(\hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, con->\hyperlink{struct_t_c_p___secure___connection_a9238a77824a37f8db533e2fbbf79c4a1}{connections}[i].
      \hyperlink{struct_t_c_p___secure___connection_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, crypto\_box\_PUBLICKEYBYTES) == 0) \{
596                 \textcolor{keywordflow}{if} (\hyperlink{_t_c_p__server_8c_a378a47bb3e63730aa104d8da7d10f384}{send\_routing\_response}(con, i + 
      \hyperlink{_t_c_p__server_8h_a41d07eb7b13b1998b771080dfaef6b7b}{NUM\_RESERVED\_PORTS}, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}) == -1) \{
597                     \textcolor{keywordflow}{return} -1;
598                 \} \textcolor{keywordflow}{else} \{
599                     \textcolor{keywordflow}{return} 0;
600                 \}
601             \}
602         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (index == (uint32\_t)~0) \{
603             index = \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
604         \}
605     \}
606 
607     \textcolor{keywordflow}{if} (index == (uint32\_t)~0) \{
608         \textcolor{keywordflow}{if} (\hyperlink{_t_c_p__server_8c_a378a47bb3e63730aa104d8da7d10f384}{send\_routing\_response}(con, 0, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}) == -1)
609             \textcolor{keywordflow}{return} -1;
610 
611         \textcolor{keywordflow}{return} 0;
612     \}
613 
614     \textcolor{keywordtype}{int} ret = \hyperlink{_t_c_p__server_8c_a378a47bb3e63730aa104d8da7d10f384}{send\_routing\_response}(con, index + 
      \hyperlink{_t_c_p__server_8h_a41d07eb7b13b1998b771080dfaef6b7b}{NUM\_RESERVED\_PORTS}, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key});
615 
616     \textcolor{keywordflow}{if} (ret == 0)
617         \textcolor{keywordflow}{return} 0;
618 
619     \textcolor{keywordflow}{if} (ret == -1)
620         \textcolor{keywordflow}{return} -1;
621 
622     con->\hyperlink{struct_t_c_p___secure___connection_a9238a77824a37f8db533e2fbbf79c4a1}{connections}[index].\hyperlink{struct_t_c_p___secure___connection_ade818037fd6c985038ff29656089758d}{status} = 1;
623     memcpy(con->\hyperlink{struct_t_c_p___secure___connection_a9238a77824a37f8db533e2fbbf79c4a1}{connections}[index].\hyperlink{struct_t_c_p___secure___connection_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, 
      crypto\_box\_PUBLICKEYBYTES);
624     \textcolor{keywordtype}{int} other\_index = \hyperlink{_t_c_p__server_8c_a11f81fcb9060389c52d55b079e1b8f3b}{get\_TCP\_connection\_index}(TCP\_server, 
      \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key});
625 
626     \textcolor{keywordflow}{if} (other\_index != -1) \{
627         uint32\_t other\_id = ~0;
628         \hyperlink{struct_t_c_p___secure___connection}{TCP\_Secure\_Connection} *other\_conn = &TCP\_server->
      \hyperlink{struct_t_c_p___server_aaec24f8b80a7853d1b7da87e903c44ee}{accepted\_connection\_array}[other\_index];
629 
630         \textcolor{keywordflow}{for} (i = 0; i < \hyperlink{_t_c_p__server_8h_aad3362495a10d80b0edac21c8f896ae1}{NUM\_CLIENT\_CONNECTIONS}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
631             \textcolor{keywordflow}{if} (other\_conn->\hyperlink{struct_t_c_p___secure___connection_a9238a77824a37f8db533e2fbbf79c4a1}{connections}[i].\hyperlink{struct_t_c_p___secure___connection_ade818037fd6c985038ff29656089758d}{status} == 1
632                     && memcmp(other\_conn->\hyperlink{struct_t_c_p___secure___connection_a9238a77824a37f8db533e2fbbf79c4a1}{connections}[i].\hyperlink{struct_t_c_p___secure___connection_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, con->
      \hyperlink{struct_t_c_p___secure___connection_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, crypto\_box\_PUBLICKEYBYTES) == 0) \{
633                 other\_id = \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
634                 \textcolor{keywordflow}{break};
635             \}
636         \}
637 
638         \textcolor{keywordflow}{if} (other\_id != (uint32\_t)~0) \{
639             con->\hyperlink{struct_t_c_p___secure___connection_a9238a77824a37f8db533e2fbbf79c4a1}{connections}[index].\hyperlink{struct_t_c_p___secure___connection_ade818037fd6c985038ff29656089758d}{status} = 2;
640             con->\hyperlink{struct_t_c_p___secure___connection_a9238a77824a37f8db533e2fbbf79c4a1}{connections}[index].\hyperlink{struct_t_c_p___secure___connection_aafd95f8c7a99b9189ede7cdf0871ebe8}{index} = other\_index;
641             con->\hyperlink{struct_t_c_p___secure___connection_a9238a77824a37f8db533e2fbbf79c4a1}{connections}[index].\hyperlink{struct_t_c_p___secure___connection_acc644a8b29d76cc8fb3a5bdfcaa2bfe1}{other\_id} = other\_id;
642             other\_conn->\hyperlink{struct_t_c_p___secure___connection_a9238a77824a37f8db533e2fbbf79c4a1}{connections}[other\_id].\hyperlink{struct_t_c_p___secure___connection_ade818037fd6c985038ff29656089758d}{status} = 2;
643             other\_conn->\hyperlink{struct_t_c_p___secure___connection_a9238a77824a37f8db533e2fbbf79c4a1}{connections}[other\_id].\hyperlink{struct_t_c_p___secure___connection_aafd95f8c7a99b9189ede7cdf0871ebe8}{index} = con\_id;
644             other\_conn->\hyperlink{struct_t_c_p___secure___connection_a9238a77824a37f8db533e2fbbf79c4a1}{connections}[other\_id].\hyperlink{struct_t_c_p___secure___connection_acc644a8b29d76cc8fb3a5bdfcaa2bfe1}{other\_id} = index;
645             \textcolor{comment}{//TODO: return values?}
646             \hyperlink{_t_c_p__server_8c_aebc23608e1cc6d5fc35210e9c28e8960}{send\_connect\_notification}(con, index);
647             \hyperlink{_t_c_p__server_8c_aebc23608e1cc6d5fc35210e9c28e8960}{send\_connect\_notification}(other\_conn, other\_id);
648         \}
649     \}
650 
651     \textcolor{keywordflow}{return} 0;
652 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_af925f101a4e90d1fa2381536ef23a794_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_af925f101a4e90d1fa2381536ef23a794_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__server_8c_a2f45b38fbf8f1646a682172973fd7a25}{\index{T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}!kill\+\_\+accepted@{kill\+\_\+accepted}}
\index{kill\+\_\+accepted@{kill\+\_\+accepted}!T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}}
\subsubsection[{kill\+\_\+accepted}]{\setlength{\rightskip}{0pt plus 5cm}static int kill\+\_\+accepted (
\begin{DoxyParamCaption}
\item[{{\bf T\+C\+P\+\_\+\+Server} $\ast$}]{T\+C\+P\+\_\+server, }
\item[{int}]{index}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_t_c_p__server_8c_a2f45b38fbf8f1646a682172973fd7a25}


Definition at line 460 of file T\+C\+P\+\_\+server.\+c.



References T\+C\+P\+\_\+\+Server\+::accepted\+\_\+connection\+\_\+array, del\+\_\+accepted(), i, kill\+\_\+sock(), N\+U\+M\+\_\+\+C\+L\+I\+E\+N\+T\+\_\+\+C\+O\+N\+N\+E\+C\+T\+I\+O\+N\+S, rm\+\_\+connection\+\_\+index(), T\+C\+P\+\_\+\+Server\+::size\+\_\+accepted\+\_\+connections, sock, and T\+C\+P\+\_\+\+Secure\+\_\+\+Connection\+::sock.



Referenced by add\+\_\+accepted(), confirm\+\_\+\+T\+C\+P\+\_\+connection(), do\+\_\+confirmed\+\_\+recv(), and do\+\_\+\+T\+C\+P\+\_\+confirmed().


\begin{DoxyCode}
461 \{
462     \textcolor{keywordflow}{if} ((uint32\_t)index >= TCP\_server->\hyperlink{struct_t_c_p___server_a6348c77f7067c2876de893aedb559972}{size\_accepted\_connections})
463         \textcolor{keywordflow}{return} -1;
464 
465     uint32\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
466 
467     \textcolor{keywordflow}{for} (i = 0; i < \hyperlink{_t_c_p__server_8h_aad3362495a10d80b0edac21c8f896ae1}{NUM\_CLIENT\_CONNECTIONS}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
468         \hyperlink{_t_c_p__server_8c_a537d1f47612f3dbb19a92e557b062c20}{rm\_connection\_index}(TCP\_server, &TCP\_server->
      \hyperlink{struct_t_c_p___server_aaec24f8b80a7853d1b7da87e903c44ee}{accepted\_connection\_array}[index], i);
469     \}
470 
471     \hyperlink{network_8h_ae5faf8a8d23da59c3e3025a62039d8c1}{sock\_t} \hyperlink{irc__syncbot_8c_a5903d0b282fc5eae503de618f896b5e1}{sock} = TCP\_server->\hyperlink{struct_t_c_p___server_aaec24f8b80a7853d1b7da87e903c44ee}{accepted\_connection\_array}[index].
      \hyperlink{struct_t_c_p___secure___connection_a35b19d84fb632ca8ce5cab237f7089a5}{sock};
472 
473     \textcolor{keywordflow}{if} (\hyperlink{_t_c_p__server_8c_a8fbde82c141c5368acc8ea8e8ad58fd2}{del\_accepted}(TCP\_server, index) != 0)
474         \textcolor{keywordflow}{return} -1;
475 
476     \hyperlink{network_8c_a512d8ea12392ba9ddfadd83bb7c92b2e}{kill\_sock}(sock);
477     \textcolor{keywordflow}{return} 0;
478 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_a2f45b38fbf8f1646a682172973fd7a25_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_a2f45b38fbf8f1646a682172973fd7a25_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__server_8c_a51bace7dc1f6b7e7049430de070f3864}{\index{T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}!kill\+\_\+\+T\+C\+P\+\_\+connection@{kill\+\_\+\+T\+C\+P\+\_\+connection}}
\index{kill\+\_\+\+T\+C\+P\+\_\+connection@{kill\+\_\+\+T\+C\+P\+\_\+connection}!T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}}
\subsubsection[{kill\+\_\+\+T\+C\+P\+\_\+connection}]{\setlength{\rightskip}{0pt plus 5cm}static void kill\+\_\+\+T\+C\+P\+\_\+connection (
\begin{DoxyParamCaption}
\item[{{\bf T\+C\+P\+\_\+\+Secure\+\_\+\+Connection} $\ast$}]{con}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_t_c_p__server_8c_a51bace7dc1f6b7e7049430de070f3864}


Definition at line 447 of file T\+C\+P\+\_\+server.\+c.



References kill\+\_\+sock(), and T\+C\+P\+\_\+\+Secure\+\_\+\+Connection\+::sock.



Referenced by accept\+\_\+connection(), confirm\+\_\+\+T\+C\+P\+\_\+connection(), do\+\_\+incoming(), and do\+\_\+unconfirmed().


\begin{DoxyCode}
448 \{
449     \hyperlink{network_8c_a512d8ea12392ba9ddfadd83bb7c92b2e}{kill\_sock}(con->\hyperlink{struct_t_c_p___secure___connection_a35b19d84fb632ca8ce5cab237f7089a5}{sock});
450     memset(con, 0, \textcolor{keyword}{sizeof}(\hyperlink{struct_t_c_p___secure___connection}{TCP\_Secure\_Connection}));
451 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=278pt]{d4/d40/_t_c_p__server_8c_a51bace7dc1f6b7e7049430de070f3864_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_a51bace7dc1f6b7e7049430de070f3864_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__server_8c_af6df6382ad309456dcf5b7b350313714}{\index{T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}!kill\+\_\+\+T\+C\+P\+\_\+server@{kill\+\_\+\+T\+C\+P\+\_\+server}}
\index{kill\+\_\+\+T\+C\+P\+\_\+server@{kill\+\_\+\+T\+C\+P\+\_\+server}!T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}}
\subsubsection[{kill\+\_\+\+T\+C\+P\+\_\+server}]{\setlength{\rightskip}{0pt plus 5cm}void kill\+\_\+\+T\+C\+P\+\_\+server (
\begin{DoxyParamCaption}
\item[{{\bf T\+C\+P\+\_\+\+Server} $\ast$}]{T\+C\+P\+\_\+server}
\end{DoxyParamCaption}
)}}\label{_t_c_p__server_8c_af6df6382ad309456dcf5b7b350313714}


Definition at line 1321 of file T\+C\+P\+\_\+server.\+c.



References T\+C\+P\+\_\+\+Server\+::accepted\+\_\+connection\+\_\+array, T\+C\+P\+\_\+\+Server\+::accepted\+\_\+key\+\_\+list, bs\+\_\+list\+\_\+free(), i, kill\+\_\+sock(), T\+C\+P\+\_\+\+Server\+::num\+\_\+listening\+\_\+socks, T\+C\+P\+\_\+\+Server\+::onion, set\+\_\+callback\+\_\+handle\+\_\+recv\+\_\+1(), and T\+C\+P\+\_\+\+Server\+::socks\+\_\+listening.



Referenced by kill\+\_\+messenger(), and S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T().


\begin{DoxyCode}
1322 \{
1323     uint32\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
1324 
1325     \textcolor{keywordflow}{for} (i = 0; i < TCP\_server->\hyperlink{struct_t_c_p___server_a5efc50bc21a4b488b17bb593b2758718}{num\_listening\_socks}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
1326         \hyperlink{network_8c_a512d8ea12392ba9ddfadd83bb7c92b2e}{kill\_sock}(TCP\_server->\hyperlink{struct_t_c_p___server_a120d7e1abddb3a838bc0d0442f4ad8e6}{socks\_listening}[i]);
1327     \}
1328 
1329     \textcolor{keywordflow}{if} (TCP\_server->\hyperlink{struct_t_c_p___server_a66fb4bf67c711a5ed3e7bbecec7fde30}{onion}) \{
1330         \hyperlink{onion_8c_ae1b8e562e22bd28deca3f98dace1a421}{set\_callback\_handle\_recv\_1}(TCP\_server->\hyperlink{struct_t_c_p___server_a66fb4bf67c711a5ed3e7bbecec7fde30}{onion}, NULL, NULL);
1331     \}
1332 
1333     \hyperlink{list_8c_a20f4503183113923cd946fc04bf8f2b4}{bs\_list\_free}(&TCP\_server->\hyperlink{struct_t_c_p___server_ae01209a4897757539a5ff199cdcfb64c}{accepted\_key\_list});
1334 
1335 \textcolor{preprocessor}{#ifdef TCP\_SERVER\_USE\_EPOLL}
1336     close(TCP\_server->efd);
1337 \textcolor{preprocessor}{#endif}
1338 
1339     free(TCP\_server->\hyperlink{struct_t_c_p___server_a120d7e1abddb3a838bc0d0442f4ad8e6}{socks\_listening});
1340     free(TCP\_server->\hyperlink{struct_t_c_p___server_aaec24f8b80a7853d1b7da87e903c44ee}{accepted\_connection\_array});
1341     free(TCP\_server);
1342 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=307pt]{d4/d40/_t_c_p__server_8c_af6df6382ad309456dcf5b7b350313714_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_af6df6382ad309456dcf5b7b350313714_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__server_8c_aa6d558b4e988007697894aff27271927}{\index{T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}!new\+\_\+listening\+\_\+\+T\+C\+P\+\_\+socket@{new\+\_\+listening\+\_\+\+T\+C\+P\+\_\+socket}}
\index{new\+\_\+listening\+\_\+\+T\+C\+P\+\_\+socket@{new\+\_\+listening\+\_\+\+T\+C\+P\+\_\+socket}!T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}}
\subsubsection[{new\+\_\+listening\+\_\+\+T\+C\+P\+\_\+socket}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf sock\+\_\+t} new\+\_\+listening\+\_\+\+T\+C\+P\+\_\+socket (
\begin{DoxyParamCaption}
\item[{int}]{family, }
\item[{uint16\+\_\+t}]{port}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_t_c_p__server_8c_aa6d558b4e988007697894aff27271927}


Definition at line 914 of file T\+C\+P\+\_\+server.\+c.



References bind\+\_\+to\+\_\+port(), kill\+\_\+sock(), set\+\_\+socket\+\_\+dualstack(), set\+\_\+socket\+\_\+nonblock(), set\+\_\+socket\+\_\+reuseaddr(), sock, sock\+\_\+valid(), and T\+C\+P\+\_\+\+M\+A\+X\+\_\+\+B\+A\+C\+K\+L\+O\+G.



Referenced by new\+\_\+\+T\+C\+P\+\_\+server().


\begin{DoxyCode}
915 \{
916     \hyperlink{network_8h_ae5faf8a8d23da59c3e3025a62039d8c1}{sock\_t} \hyperlink{irc__syncbot_8c_a5903d0b282fc5eae503de618f896b5e1}{sock} = \hyperlink{namespacesocket}{socket}(family, SOCK\_STREAM, IPPROTO\_TCP);
917 
918     \textcolor{keywordflow}{if} (!\hyperlink{network_8c_a84c3240a3325cbdaaa8a206c96980cd1}{sock\_valid}(sock)) \{
919         \textcolor{keywordflow}{return} ~0;
920     \}
921 
922     \textcolor{keywordtype}{int} ok = \hyperlink{network_8c_a6a50bb1345f2d5192fe1ec23ac7a1da9}{set\_socket\_nonblock}(sock);
923 
924     \textcolor{keywordflow}{if} (ok && family == AF\_INET6) \{
925         ok = \hyperlink{network_8c_ad2f109728a6345e6862686ea4baf5b27}{set\_socket\_dualstack}(sock);
926     \}
927 
928     \textcolor{keywordflow}{if} (ok) \{
929         ok = \hyperlink{network_8c_ac278c3d25e3807f0b2be9d91c9db328f}{set\_socket\_reuseaddr}(sock);
930     \}
931 
932     ok = ok && \hyperlink{_t_c_p__server_8c_a944f17c26a170be923cc64f9921e001b}{bind\_to\_port}(sock, family, \hyperlink{irc__syncbot_8c_a8e0798404bf2cf5dabb84c5ba9a4f236}{port}) && (listen(sock, 
      \hyperlink{_t_c_p__server_8h_ae2850071db896a7e93afd4acc1bfd69b}{TCP\_MAX\_BACKLOG}) == 0);
933 
934     \textcolor{keywordflow}{if} (!ok) \{
935         \hyperlink{network_8c_a512d8ea12392ba9ddfadd83bb7c92b2e}{kill\_sock}(sock);
936         \textcolor{keywordflow}{return} ~0;
937     \}
938 
939     \textcolor{keywordflow}{return} \hyperlink{irc__syncbot_8c_a5903d0b282fc5eae503de618f896b5e1}{sock};
940 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_aa6d558b4e988007697894aff27271927_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_aa6d558b4e988007697894aff27271927_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__server_8c_a148e632f4c51645cbc1b414bc3584b60}{\index{T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}!new\+\_\+\+T\+C\+P\+\_\+server@{new\+\_\+\+T\+C\+P\+\_\+server}}
\index{new\+\_\+\+T\+C\+P\+\_\+server@{new\+\_\+\+T\+C\+P\+\_\+server}!T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}}
\subsubsection[{new\+\_\+\+T\+C\+P\+\_\+server}]{\setlength{\rightskip}{0pt plus 5cm}{\bf T\+C\+P\+\_\+\+Server}$\ast$ new\+\_\+\+T\+C\+P\+\_\+server (
\begin{DoxyParamCaption}
\item[{uint8\+\_\+t}]{ipv6\+\_\+enabled, }
\item[{uint16\+\_\+t}]{num\+\_\+sockets, }
\item[{const uint16\+\_\+t $\ast$}]{ports, }
\item[{const uint8\+\_\+t $\ast$}]{secret\+\_\+key, }
\item[{{\bf Onion} $\ast$}]{onion}
\end{DoxyParamCaption}
)}}\label{_t_c_p__server_8c_a148e632f4c51645cbc1b414bc3584b60}


Definition at line 942 of file T\+C\+P\+\_\+server.\+c.



References T\+C\+P\+\_\+\+Server\+::accepted\+\_\+key\+\_\+list, bs\+\_\+list\+\_\+init(), handle\+\_\+onion\+\_\+recv\+\_\+1(), i, networking\+\_\+at\+\_\+startup(), new\+\_\+listening\+\_\+\+T\+C\+P\+\_\+socket(), T\+C\+P\+\_\+\+Server\+::num\+\_\+listening\+\_\+socks, T\+C\+P\+\_\+\+Server\+::onion, T\+C\+P\+\_\+\+Server\+::public\+\_\+key, T\+C\+P\+\_\+\+Server\+::secret\+\_\+key, set\+\_\+callback\+\_\+handle\+\_\+recv\+\_\+1(), sock, sock\+\_\+valid(), and T\+C\+P\+\_\+\+Server\+::socks\+\_\+listening.



Referenced by main(), new\+\_\+messenger(), and S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T().


\begin{DoxyCode}
944 \{
945     \textcolor{keywordflow}{if} (num\_sockets == 0 || \hyperlink{_t_c_p__test_8c_a04e5444bf6a826487066ba973577f674}{ports} == NULL)
946         \textcolor{keywordflow}{return} NULL;
947 
948     \textcolor{keywordflow}{if} (\hyperlink{network_8c_ad953dedd6d25d03cf441960dd1e1fed1}{networking\_at\_startup}() != 0) \{
949         \textcolor{keywordflow}{return} NULL;
950     \}
951 
952     \hyperlink{struct_t_c_p___server}{TCP\_Server} *temp = calloc(1, \textcolor{keyword}{sizeof}(\hyperlink{struct_t_c_p___server}{TCP\_Server}));
953 
954     \textcolor{keywordflow}{if} (temp == NULL)
955         \textcolor{keywordflow}{return} NULL;
956 
957     temp->\hyperlink{struct_t_c_p___server_a120d7e1abddb3a838bc0d0442f4ad8e6}{socks\_listening} = calloc(num\_sockets, \textcolor{keyword}{sizeof}(\hyperlink{network_8h_ae5faf8a8d23da59c3e3025a62039d8c1}{sock\_t}));
958 
959     \textcolor{keywordflow}{if} (temp->\hyperlink{struct_t_c_p___server_a120d7e1abddb3a838bc0d0442f4ad8e6}{socks\_listening} == NULL) \{
960         free(temp);
961         \textcolor{keywordflow}{return} NULL;
962     \}
963 
964 \textcolor{preprocessor}{#ifdef TCP\_SERVER\_USE\_EPOLL}
965     temp->efd = epoll\_create(8);
966 
967     \textcolor{keywordflow}{if} (temp->efd == -1) \{
968         free(temp->\hyperlink{struct_t_c_p___server_a120d7e1abddb3a838bc0d0442f4ad8e6}{socks\_listening});
969         free(temp);
970         \textcolor{keywordflow}{return} NULL;
971     \}
972 
973 \textcolor{preprocessor}{#endif}
974 
975     uint8\_t family;
976 
977     \textcolor{keywordflow}{if} (ipv6\_enabled) \{
978         family = AF\_INET6;
979     \} \textcolor{keywordflow}{else} \{
980         family = AF\_INET;
981     \}
982 
983     uint32\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
984 \textcolor{preprocessor}{#ifdef TCP\_SERVER\_USE\_EPOLL}
985     \textcolor{keyword}{struct }epoll\_event ev;
986 \textcolor{preprocessor}{#endif}
987 
988     \textcolor{keywordflow}{for} (i = 0; i < num\_sockets; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
989         \hyperlink{network_8h_ae5faf8a8d23da59c3e3025a62039d8c1}{sock\_t} \hyperlink{irc__syncbot_8c_a5903d0b282fc5eae503de618f896b5e1}{sock} = \hyperlink{_t_c_p__server_8c_aa6d558b4e988007697894aff27271927}{new\_listening\_TCP\_socket}(family, 
      \hyperlink{_t_c_p__test_8c_a04e5444bf6a826487066ba973577f674}{ports}[i]);
990 
991         \textcolor{keywordflow}{if} (\hyperlink{network_8c_a84c3240a3325cbdaaa8a206c96980cd1}{sock\_valid}(sock)) \{
992 \textcolor{preprocessor}{#ifdef TCP\_SERVER\_USE\_EPOLL}
993             ev.events = EPOLLIN | EPOLLET;
994             ev.data.u64 = sock | ((uint64\_t)TCP\_SOCKET\_LISTENING << 32);
995 
996             \textcolor{keywordflow}{if} (epoll\_ctl(temp->efd, EPOLL\_CTL\_ADD, sock, &ev) == -1) \{
997                 \textcolor{keywordflow}{continue};
998             \}
999 
1000 \textcolor{preprocessor}{#endif}
1001 
1002             temp->\hyperlink{struct_t_c_p___server_a120d7e1abddb3a838bc0d0442f4ad8e6}{socks\_listening}[temp->\hyperlink{struct_t_c_p___server_a5efc50bc21a4b488b17bb593b2758718}{num\_listening\_socks}] = 
      \hyperlink{irc__syncbot_8c_a5903d0b282fc5eae503de618f896b5e1}{sock};
1003             ++temp->\hyperlink{struct_t_c_p___server_a5efc50bc21a4b488b17bb593b2758718}{num\_listening\_socks};
1004         \}
1005     \}
1006 
1007     \textcolor{keywordflow}{if} (temp->\hyperlink{struct_t_c_p___server_a5efc50bc21a4b488b17bb593b2758718}{num\_listening\_socks} == 0) \{
1008         free(temp->\hyperlink{struct_t_c_p___server_a120d7e1abddb3a838bc0d0442f4ad8e6}{socks\_listening});
1009         free(temp);
1010         \textcolor{keywordflow}{return} NULL;
1011     \}
1012 
1013     \textcolor{keywordflow}{if} (onion) \{
1014         temp->\hyperlink{struct_t_c_p___server_a66fb4bf67c711a5ed3e7bbecec7fde30}{onion} = onion;
1015         \hyperlink{onion_8c_ae1b8e562e22bd28deca3f98dace1a421}{set\_callback\_handle\_recv\_1}(onion, &
      \hyperlink{_t_c_p__server_8c_aaee6d8849ed25c44203b345808d79bed}{handle\_onion\_recv\_1}, temp);
1016     \}
1017 
1018     memcpy(temp->\hyperlink{struct_t_c_p___server_a41928223d6ad8bd41837f371deef62ae}{secret\_key}, secret\_key, crypto\_box\_SECRETKEYBYTES);
1019     crypto\_scalarmult\_curve25519\_base(temp->\hyperlink{struct_t_c_p___server_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, temp->
      \hyperlink{struct_t_c_p___server_a41928223d6ad8bd41837f371deef62ae}{secret\_key});
1020 
1021     \hyperlink{list_8c_a7b07772cffb6af34e279f424dca08895}{bs\_list\_init}(&temp->\hyperlink{struct_t_c_p___server_ae01209a4897757539a5ff199cdcfb64c}{accepted\_key\_list}, crypto\_box\_PUBLICKEYBYTES, 8);
1022 
1023     \textcolor{keywordflow}{return} temp;
1024 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_a148e632f4c51645cbc1b414bc3584b60_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_a148e632f4c51645cbc1b414bc3584b60_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__server_8c_ab6e95a3eda0dace913cf12bf3e6088ff}{\index{T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}!read\+\_\+connection\+\_\+handshake@{read\+\_\+connection\+\_\+handshake}}
\index{read\+\_\+connection\+\_\+handshake@{read\+\_\+connection\+\_\+handshake}!T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}}
\subsubsection[{read\+\_\+connection\+\_\+handshake}]{\setlength{\rightskip}{0pt plus 5cm}static int read\+\_\+connection\+\_\+handshake (
\begin{DoxyParamCaption}
\item[{{\bf T\+C\+P\+\_\+\+Secure\+\_\+\+Connection} $\ast$}]{con, }
\item[{const uint8\+\_\+t $\ast$}]{self\+\_\+secret\+\_\+key}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_t_c_p__server_8c_ab6e95a3eda0dace913cf12bf3e6088ff}


Definition at line 530 of file T\+C\+P\+\_\+server.\+c.



References make-\/funny-\/savefile\+::data, handle\+\_\+\+T\+C\+P\+\_\+handshake(), read\+\_\+\+T\+C\+P\+\_\+packet(), T\+C\+P\+\_\+\+Secure\+\_\+\+Connection\+::sock, and T\+C\+P\+\_\+\+C\+L\+I\+E\+N\+T\+\_\+\+H\+A\+N\+D\+S\+H\+A\+K\+E\+\_\+\+S\+I\+Z\+E.



Referenced by do\+\_\+incoming().


\begin{DoxyCode}
531 \{
532     uint8\_t \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[\hyperlink{_t_c_p__server_8h_aa5f4778a5c176dbd24018f61cc7524f7}{TCP\_CLIENT\_HANDSHAKE\_SIZE}];
533     \textcolor{keywordtype}{int} len = 0;
534 
535     \textcolor{keywordflow}{if} ((len = \hyperlink{_t_c_p__server_8c_a88eda37b476d8dcfdba94899e740dd9e}{read\_TCP\_packet}(con->\hyperlink{struct_t_c_p___secure___connection_a35b19d84fb632ca8ce5cab237f7089a5}{sock}, data, 
      \hyperlink{_t_c_p__server_8h_aa5f4778a5c176dbd24018f61cc7524f7}{TCP\_CLIENT\_HANDSHAKE\_SIZE})) != -1) \{
536         \textcolor{keywordflow}{return} \hyperlink{_t_c_p__server_8c_ad83c5da554cb68b07d7bef24c99c8ad8}{handle\_TCP\_handshake}(con, data, len, self\_secret\_key);
537     \}
538 
539     \textcolor{keywordflow}{return} 0;
540 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_ab6e95a3eda0dace913cf12bf3e6088ff_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_ab6e95a3eda0dace913cf12bf3e6088ff_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__server_8c_a2acbecbd76fe539293b5d92d0e0b6c5e}{\index{T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}!read\+\_\+packet\+\_\+\+T\+C\+P\+\_\+secure\+\_\+connection@{read\+\_\+packet\+\_\+\+T\+C\+P\+\_\+secure\+\_\+connection}}
\index{read\+\_\+packet\+\_\+\+T\+C\+P\+\_\+secure\+\_\+connection@{read\+\_\+packet\+\_\+\+T\+C\+P\+\_\+secure\+\_\+connection}!T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}}
\subsubsection[{read\+\_\+packet\+\_\+\+T\+C\+P\+\_\+secure\+\_\+connection}]{\setlength{\rightskip}{0pt plus 5cm}int read\+\_\+packet\+\_\+\+T\+C\+P\+\_\+secure\+\_\+connection (
\begin{DoxyParamCaption}
\item[{{\bf sock\+\_\+t}}]{sock, }
\item[{uint16\+\_\+t $\ast$}]{next\+\_\+packet\+\_\+length, }
\item[{const uint8\+\_\+t $\ast$}]{shared\+\_\+key, }
\item[{uint8\+\_\+t $\ast$}]{recv\+\_\+nonce, }
\item[{uint8\+\_\+t $\ast$}]{data, }
\item[{uint16\+\_\+t}]{max\+\_\+len}
\end{DoxyParamCaption}
)}}\label{_t_c_p__server_8c_a2acbecbd76fe539293b5d92d0e0b6c5e}


Definition at line 256 of file T\+C\+P\+\_\+server.\+c.



References decrypt\+\_\+data\+\_\+symmetric(), increment\+\_\+nonce(), read\+\_\+\+T\+C\+P\+\_\+length(), and read\+\_\+\+T\+C\+P\+\_\+packet().



Referenced by do\+\_\+confirmed\+\_\+recv(), do\+\_\+confirmed\+\_\+\+T\+C\+P(), and do\+\_\+unconfirmed().


\begin{DoxyCode}
258 \{
259     \textcolor{keywordflow}{if} (*next\_packet\_length == 0) \{
260         uint16\_t len = \hyperlink{_t_c_p__server_8c_a984a0b6fc27b03e09170579ec9494093}{read\_TCP\_length}(\hyperlink{irc__syncbot_8c_a5903d0b282fc5eae503de618f896b5e1}{sock});
261 
262         \textcolor{keywordflow}{if} (len == (uint16\_t)~0)
263             \textcolor{keywordflow}{return} -1;
264 
265         \textcolor{keywordflow}{if} (len == 0)
266             \textcolor{keywordflow}{return} 0;
267 
268         *next\_packet\_length = len;
269     \}
270 
271     \textcolor{keywordflow}{if} (max\_len + crypto\_box\_MACBYTES < *next\_packet\_length)
272         \textcolor{keywordflow}{return} -1;
273 
274     uint8\_t data\_encrypted[*next\_packet\_length];
275     \textcolor{keywordtype}{int} len\_packet = \hyperlink{_t_c_p__server_8c_a88eda37b476d8dcfdba94899e740dd9e}{read\_TCP\_packet}(\hyperlink{irc__syncbot_8c_a5903d0b282fc5eae503de618f896b5e1}{sock}, data\_encrypted, *next\_packet\_length);
276 
277     \textcolor{keywordflow}{if} (len\_packet != *next\_packet\_length)
278         \textcolor{keywordflow}{return} 0;
279 
280     *next\_packet\_length = 0;
281 
282     \textcolor{keywordtype}{int} len = \hyperlink{crypto__core_8c_a824b257fcff74b9d17c5247223fbed29}{decrypt\_data\_symmetric}(shared\_key, recv\_nonce, data\_encrypted, 
      len\_packet, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data});
283 
284     \textcolor{keywordflow}{if} (len + crypto\_box\_MACBYTES != len\_packet)
285         \textcolor{keywordflow}{return} -1;
286 
287     \hyperlink{crypto__core_8c_ab953f1e92b8a9a193f69f02323b9c980}{increment\_nonce}(recv\_nonce);
288 
289     \textcolor{keywordflow}{return} len;
290 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_a2acbecbd76fe539293b5d92d0e0b6c5e_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_a2acbecbd76fe539293b5d92d0e0b6c5e_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__server_8c_a984a0b6fc27b03e09170579ec9494093}{\index{T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}!read\+\_\+\+T\+C\+P\+\_\+length@{read\+\_\+\+T\+C\+P\+\_\+length}}
\index{read\+\_\+\+T\+C\+P\+\_\+length@{read\+\_\+\+T\+C\+P\+\_\+length}!T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}}
\subsubsection[{read\+\_\+\+T\+C\+P\+\_\+length}]{\setlength{\rightskip}{0pt plus 5cm}uint16\+\_\+t read\+\_\+\+T\+C\+P\+\_\+length (
\begin{DoxyParamCaption}
\item[{{\bf sock\+\_\+t}}]{sock}
\end{DoxyParamCaption}
)}}\label{_t_c_p__server_8c_a984a0b6fc27b03e09170579ec9494093}


Definition at line 204 of file T\+C\+P\+\_\+server.\+c.



References M\+A\+X\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+S\+I\+Z\+E, and T\+C\+P\+\_\+socket\+\_\+data\+\_\+recv\+\_\+buffer().



Referenced by read\+\_\+packet\+\_\+\+T\+C\+P\+\_\+secure\+\_\+connection().


\begin{DoxyCode}
205 \{
206     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} count = \hyperlink{_t_c_p__server_8c_ae80fe7119d00d2a7788c0839a90e0782}{TCP\_socket\_data\_recv\_buffer}(
      \hyperlink{irc__syncbot_8c_a5903d0b282fc5eae503de618f896b5e1}{sock});
207 
208     \textcolor{keywordflow}{if} (count >= \textcolor{keyword}{sizeof}(uint16\_t)) \{
209         uint16\_t length;
210         \textcolor{keywordtype}{int} len = recv(\hyperlink{irc__syncbot_8c_a5903d0b282fc5eae503de618f896b5e1}{sock}, (uint8\_t *)&length, \textcolor{keyword}{sizeof}(uint16\_t), MSG\_NOSIGNAL);
211 
212         \textcolor{keywordflow}{if} (len != \textcolor{keyword}{sizeof}(uint16\_t)) \{
213             fprintf(stderr, \textcolor{stringliteral}{"FAIL recv packet\(\backslash\)n"});
214             \textcolor{keywordflow}{return} 0;
215         \}
216 
217         length = ntohs(length);
218 
219         \textcolor{keywordflow}{if} (length > \hyperlink{_t_c_p__server_8h_a879456c3b8e2853f7044d764e9c180d4}{MAX\_PACKET\_SIZE}) \{
220             \textcolor{keywordflow}{return} ~0;
221         \}
222 
223         \textcolor{keywordflow}{return} length;
224     \}
225 
226     \textcolor{keywordflow}{return} 0;
227 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=327pt]{d4/d40/_t_c_p__server_8c_a984a0b6fc27b03e09170579ec9494093_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_a984a0b6fc27b03e09170579ec9494093_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__server_8c_a88eda37b476d8dcfdba94899e740dd9e}{\index{T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}!read\+\_\+\+T\+C\+P\+\_\+packet@{read\+\_\+\+T\+C\+P\+\_\+packet}}
\index{read\+\_\+\+T\+C\+P\+\_\+packet@{read\+\_\+\+T\+C\+P\+\_\+packet}!T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}}
\subsubsection[{read\+\_\+\+T\+C\+P\+\_\+packet}]{\setlength{\rightskip}{0pt plus 5cm}int read\+\_\+\+T\+C\+P\+\_\+packet (
\begin{DoxyParamCaption}
\item[{{\bf sock\+\_\+t}}]{sock, }
\item[{uint8\+\_\+t $\ast$}]{data, }
\item[{uint16\+\_\+t}]{length}
\end{DoxyParamCaption}
)}}\label{_t_c_p__server_8c_a88eda37b476d8dcfdba94899e740dd9e}


Definition at line 234 of file T\+C\+P\+\_\+server.\+c.



References T\+C\+P\+\_\+socket\+\_\+data\+\_\+recv\+\_\+buffer().



Referenced by do\+\_\+\+T\+C\+P\+\_\+connection(), proxy\+\_\+http\+\_\+read\+\_\+connection\+\_\+response(), proxy\+\_\+socks5\+\_\+read\+\_\+connection\+\_\+response(), read\+\_\+connection\+\_\+handshake(), read\+\_\+packet\+\_\+\+T\+C\+P\+\_\+secure\+\_\+connection(), and socks5\+\_\+read\+\_\+handshake\+\_\+response().


\begin{DoxyCode}
235 \{
236     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} count = \hyperlink{_t_c_p__server_8c_ae80fe7119d00d2a7788c0839a90e0782}{TCP\_socket\_data\_recv\_buffer}(
      \hyperlink{irc__syncbot_8c_a5903d0b282fc5eae503de618f896b5e1}{sock});
237 
238     \textcolor{keywordflow}{if} (count >= length) \{
239         \textcolor{keywordtype}{int} len = recv(\hyperlink{irc__syncbot_8c_a5903d0b282fc5eae503de618f896b5e1}{sock}, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}, length, MSG\_NOSIGNAL);
240 
241         \textcolor{keywordflow}{if} (len != length) \{
242             fprintf(stderr, \textcolor{stringliteral}{"FAIL recv packet\(\backslash\)n"});
243             \textcolor{keywordflow}{return} -1;
244         \}
245 
246         \textcolor{keywordflow}{return} len;
247     \}
248 
249     \textcolor{keywordflow}{return} -1;
250 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=330pt]{d4/d40/_t_c_p__server_8c_a88eda37b476d8dcfdba94899e740dd9e_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_a88eda37b476d8dcfdba94899e740dd9e_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__server_8c_abdfaa164f396557d6499a8e5e3145b49}{\index{T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}!realloc\+\_\+connection@{realloc\+\_\+connection}}
\index{realloc\+\_\+connection@{realloc\+\_\+connection}!T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}}
\subsubsection[{realloc\+\_\+connection}]{\setlength{\rightskip}{0pt plus 5cm}static int realloc\+\_\+connection (
\begin{DoxyParamCaption}
\item[{{\bf T\+C\+P\+\_\+\+Server} $\ast$}]{T\+C\+P\+\_\+server, }
\item[{uint32\+\_\+t}]{num}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_t_c_p__server_8c_abdfaa164f396557d6499a8e5e3145b49}


Definition at line 67 of file T\+C\+P\+\_\+server.\+c.



References T\+C\+P\+\_\+\+Server\+::accepted\+\_\+connection\+\_\+array, num, and T\+C\+P\+\_\+\+Server\+::size\+\_\+accepted\+\_\+connections.



Referenced by add\+\_\+accepted(), and del\+\_\+accepted().


\begin{DoxyCode}
68 \{
69     \textcolor{keywordflow}{if} (\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num} == 0) \{
70         free(TCP\_server->\hyperlink{struct_t_c_p___server_aaec24f8b80a7853d1b7da87e903c44ee}{accepted\_connection\_array});
71         TCP\_server->\hyperlink{struct_t_c_p___server_aaec24f8b80a7853d1b7da87e903c44ee}{accepted\_connection\_array} = NULL;
72         TCP\_server->\hyperlink{struct_t_c_p___server_a6348c77f7067c2876de893aedb559972}{size\_accepted\_connections} = 0;
73         \textcolor{keywordflow}{return} 0;
74     \}
75 
76     \textcolor{keywordflow}{if} (\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num} == TCP\_server->\hyperlink{struct_t_c_p___server_a6348c77f7067c2876de893aedb559972}{size\_accepted\_connections}) \{
77         \textcolor{keywordflow}{return} 0;
78     \}
79 
80     \hyperlink{struct_t_c_p___secure___connection}{TCP\_Secure\_Connection} *new\_connections = realloc(TCP\_server->
      \hyperlink{struct_t_c_p___server_aaec24f8b80a7853d1b7da87e903c44ee}{accepted\_connection\_array},
81             \hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num} * \textcolor{keyword}{sizeof}(\hyperlink{struct_t_c_p___secure___connection}{TCP\_Secure\_Connection}));
82 
83     \textcolor{keywordflow}{if} (new\_connections == NULL)
84         \textcolor{keywordflow}{return} -1;
85 
86     \textcolor{keywordflow}{if} (\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num} > TCP\_server->\hyperlink{struct_t_c_p___server_a6348c77f7067c2876de893aedb559972}{size\_accepted\_connections}) \{
87         uint32\_t old\_size = TCP\_server->\hyperlink{struct_t_c_p___server_a6348c77f7067c2876de893aedb559972}{size\_accepted\_connections};
88         uint32\_t size\_new\_entries = (\hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num} - old\_size) * \textcolor{keyword}{sizeof}(
      \hyperlink{struct_t_c_p___secure___connection}{TCP\_Secure\_Connection});
89         memset(new\_connections + old\_size, 0, size\_new\_entries);
90     \}
91 
92     TCP\_server->\hyperlink{struct_t_c_p___server_aaec24f8b80a7853d1b7da87e903c44ee}{accepted\_connection\_array} = new\_connections;
93     TCP\_server->\hyperlink{struct_t_c_p___server_a6348c77f7067c2876de893aedb559972}{size\_accepted\_connections} = \hyperlink{tox__test_8c_abea371f9030e15a5d2a4c181576833d8}{num};
94     \textcolor{keywordflow}{return} 0;
95 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_abdfaa164f396557d6499a8e5e3145b49_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__server_8c_a537d1f47612f3dbb19a92e557b062c20}{\index{T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}!rm\+\_\+connection\+\_\+index@{rm\+\_\+connection\+\_\+index}}
\index{rm\+\_\+connection\+\_\+index@{rm\+\_\+connection\+\_\+index}!T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}}
\subsubsection[{rm\+\_\+connection\+\_\+index}]{\setlength{\rightskip}{0pt plus 5cm}static int rm\+\_\+connection\+\_\+index (
\begin{DoxyParamCaption}
\item[{{\bf T\+C\+P\+\_\+\+Server} $\ast$}]{T\+C\+P\+\_\+server, }
\item[{{\bf T\+C\+P\+\_\+\+Secure\+\_\+\+Connection} $\ast$}]{con, }
\item[{uint8\+\_\+t}]{con\+\_\+number}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_t_c_p__server_8c_a537d1f47612f3dbb19a92e557b062c20}


Definition at line 684 of file T\+C\+P\+\_\+server.\+c.



References T\+C\+P\+\_\+\+Server\+::accepted\+\_\+connection\+\_\+array, T\+C\+P\+\_\+\+Secure\+\_\+\+Connection\+::connections, T\+C\+P\+\_\+\+Secure\+\_\+\+Connection\+::index, N\+U\+M\+\_\+\+C\+L\+I\+E\+N\+T\+\_\+\+C\+O\+N\+N\+E\+C\+T\+I\+O\+N\+S, T\+C\+P\+\_\+\+Secure\+\_\+\+Connection\+::other\+\_\+id, send\+\_\+disconnect\+\_\+notification(), T\+C\+P\+\_\+\+Server\+::size\+\_\+accepted\+\_\+connections, and T\+C\+P\+\_\+\+Secure\+\_\+\+Connection\+::status.



Referenced by handle\+\_\+\+T\+C\+P\+\_\+packet(), and kill\+\_\+accepted().


\begin{DoxyCode}
685 \{
686     \textcolor{keywordflow}{if} (con\_number >= \hyperlink{_t_c_p__server_8h_aad3362495a10d80b0edac21c8f896ae1}{NUM\_CLIENT\_CONNECTIONS})
687         \textcolor{keywordflow}{return} -1;
688 
689     \textcolor{keywordflow}{if} (con->\hyperlink{struct_t_c_p___secure___connection_a9238a77824a37f8db533e2fbbf79c4a1}{connections}[con\_number].\hyperlink{struct_t_c_p___secure___connection_ade818037fd6c985038ff29656089758d}{status}) \{
690         uint32\_t index = con->\hyperlink{struct_t_c_p___secure___connection_a9238a77824a37f8db533e2fbbf79c4a1}{connections}[con\_number].\hyperlink{struct_t_c_p___secure___connection_aafd95f8c7a99b9189ede7cdf0871ebe8}{index};
691         uint8\_t other\_id = con->\hyperlink{struct_t_c_p___secure___connection_a9238a77824a37f8db533e2fbbf79c4a1}{connections}[con\_number].\hyperlink{struct_t_c_p___secure___connection_acc644a8b29d76cc8fb3a5bdfcaa2bfe1}{other\_id};
692 
693         \textcolor{keywordflow}{if} (con->\hyperlink{struct_t_c_p___secure___connection_a9238a77824a37f8db533e2fbbf79c4a1}{connections}[con\_number].\hyperlink{struct_t_c_p___secure___connection_ade818037fd6c985038ff29656089758d}{status} == 2) \{
694 
695             \textcolor{keywordflow}{if} (index >= TCP\_server->\hyperlink{struct_t_c_p___server_a6348c77f7067c2876de893aedb559972}{size\_accepted\_connections})
696                 \textcolor{keywordflow}{return} -1;
697 
698             TCP\_server->\hyperlink{struct_t_c_p___server_aaec24f8b80a7853d1b7da87e903c44ee}{accepted\_connection\_array}[index].
      \hyperlink{struct_t_c_p___secure___connection_a9238a77824a37f8db533e2fbbf79c4a1}{connections}[other\_id].\hyperlink{struct_t_c_p___secure___connection_acc644a8b29d76cc8fb3a5bdfcaa2bfe1}{other\_id} = 0;
699             TCP\_server->\hyperlink{struct_t_c_p___server_aaec24f8b80a7853d1b7da87e903c44ee}{accepted\_connection\_array}[index].
      \hyperlink{struct_t_c_p___secure___connection_a9238a77824a37f8db533e2fbbf79c4a1}{connections}[other\_id].\hyperlink{struct_t_c_p___secure___connection_aafd95f8c7a99b9189ede7cdf0871ebe8}{index} = 0;
700             TCP\_server->\hyperlink{struct_t_c_p___server_aaec24f8b80a7853d1b7da87e903c44ee}{accepted\_connection\_array}[index].
      \hyperlink{struct_t_c_p___secure___connection_a9238a77824a37f8db533e2fbbf79c4a1}{connections}[other\_id].\hyperlink{struct_t_c_p___secure___connection_ade818037fd6c985038ff29656089758d}{status} = 1;
701             \textcolor{comment}{//TODO: return values?}
702             \hyperlink{_t_c_p__server_8c_aad6cd0a2a98d4da60235be8000f2c66f}{send\_disconnect\_notification}(&TCP\_server->
      \hyperlink{struct_t_c_p___server_aaec24f8b80a7853d1b7da87e903c44ee}{accepted\_connection\_array}[index], other\_id);
703         \}
704 
705         con->\hyperlink{struct_t_c_p___secure___connection_a9238a77824a37f8db533e2fbbf79c4a1}{connections}[con\_number].\hyperlink{struct_t_c_p___secure___connection_aafd95f8c7a99b9189ede7cdf0871ebe8}{index} = 0;
706         con->\hyperlink{struct_t_c_p___secure___connection_a9238a77824a37f8db533e2fbbf79c4a1}{connections}[con\_number].\hyperlink{struct_t_c_p___secure___connection_acc644a8b29d76cc8fb3a5bdfcaa2bfe1}{other\_id} = 0;
707         con->\hyperlink{struct_t_c_p___secure___connection_a9238a77824a37f8db533e2fbbf79c4a1}{connections}[con\_number].\hyperlink{struct_t_c_p___secure___connection_ade818037fd6c985038ff29656089758d}{status} = 0;
708         \textcolor{keywordflow}{return} 0;
709     \} \textcolor{keywordflow}{else} \{
710         \textcolor{keywordflow}{return} -1;
711     \}
712 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_a537d1f47612f3dbb19a92e557b062c20_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_a537d1f47612f3dbb19a92e557b062c20_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__server_8c_aebc23608e1cc6d5fc35210e9c28e8960}{\index{T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}!send\+\_\+connect\+\_\+notification@{send\+\_\+connect\+\_\+notification}}
\index{send\+\_\+connect\+\_\+notification@{send\+\_\+connect\+\_\+notification}!T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}}
\subsubsection[{send\+\_\+connect\+\_\+notification}]{\setlength{\rightskip}{0pt plus 5cm}static int send\+\_\+connect\+\_\+notification (
\begin{DoxyParamCaption}
\item[{{\bf T\+C\+P\+\_\+\+Secure\+\_\+\+Connection} $\ast$}]{con, }
\item[{uint8\+\_\+t}]{id}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_t_c_p__server_8c_aebc23608e1cc6d5fc35210e9c28e8960}


Definition at line 560 of file T\+C\+P\+\_\+server.\+c.



References make-\/funny-\/savefile\+::data, N\+U\+M\+\_\+\+R\+E\+S\+E\+R\+V\+E\+D\+\_\+\+P\+O\+R\+T\+S, T\+C\+P\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+C\+O\+N\+N\+E\+C\+T\+I\+O\+N\+\_\+\+N\+O\+T\+I\+F\+I\+C\+A\+T\+I\+O\+N, and write\+\_\+packet\+\_\+\+T\+C\+P\+\_\+secure\+\_\+connection().



Referenced by handle\+\_\+\+T\+C\+P\+\_\+routing\+\_\+req().


\begin{DoxyCode}
561 \{
562     uint8\_t \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[2] = \{\hyperlink{_t_c_p__server_8h_ae03ebbe7438d78a242e6970f35eb6dfa}{TCP\_PACKET\_CONNECTION\_NOTIFICATION}, \textcolor{keywordtype}{id} + 
      \hyperlink{_t_c_p__server_8h_a41d07eb7b13b1998b771080dfaef6b7b}{NUM\_RESERVED\_PORTS}\};
563     \textcolor{keywordflow}{return} \hyperlink{_t_c_p__server_8c_a1b2fd7984b9d3eb39bf588fc9bc5e21f}{write\_packet\_TCP\_secure\_connection}(con, data, \textcolor{keyword}{sizeof}(data), 1)
      ;
564 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_aebc23608e1cc6d5fc35210e9c28e8960_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_aebc23608e1cc6d5fc35210e9c28e8960_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__server_8c_aad6cd0a2a98d4da60235be8000f2c66f}{\index{T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}!send\+\_\+disconnect\+\_\+notification@{send\+\_\+disconnect\+\_\+notification}}
\index{send\+\_\+disconnect\+\_\+notification@{send\+\_\+disconnect\+\_\+notification}!T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}}
\subsubsection[{send\+\_\+disconnect\+\_\+notification}]{\setlength{\rightskip}{0pt plus 5cm}static int send\+\_\+disconnect\+\_\+notification (
\begin{DoxyParamCaption}
\item[{{\bf T\+C\+P\+\_\+\+Secure\+\_\+\+Connection} $\ast$}]{con, }
\item[{uint8\+\_\+t}]{id}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_t_c_p__server_8c_aad6cd0a2a98d4da60235be8000f2c66f}


Definition at line 570 of file T\+C\+P\+\_\+server.\+c.



References make-\/funny-\/savefile\+::data, N\+U\+M\+\_\+\+R\+E\+S\+E\+R\+V\+E\+D\+\_\+\+P\+O\+R\+T\+S, T\+C\+P\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+D\+I\+S\+C\+O\+N\+N\+E\+C\+T\+\_\+\+N\+O\+T\+I\+F\+I\+C\+A\+T\+I\+O\+N, and write\+\_\+packet\+\_\+\+T\+C\+P\+\_\+secure\+\_\+connection().



Referenced by rm\+\_\+connection\+\_\+index().


\begin{DoxyCode}
571 \{
572     uint8\_t \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[2] = \{\hyperlink{_t_c_p__server_8h_a65b6df680eaecb9563dfcc8c5fcfba3d}{TCP\_PACKET\_DISCONNECT\_NOTIFICATION}, \textcolor{keywordtype}{id} + 
      \hyperlink{_t_c_p__server_8h_a41d07eb7b13b1998b771080dfaef6b7b}{NUM\_RESERVED\_PORTS}\};
573     \textcolor{keywordflow}{return} \hyperlink{_t_c_p__server_8c_a1b2fd7984b9d3eb39bf588fc9bc5e21f}{write\_packet\_TCP\_secure\_connection}(con, data, \textcolor{keyword}{sizeof}(data), 1)
      ;
574 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_aad6cd0a2a98d4da60235be8000f2c66f_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_aad6cd0a2a98d4da60235be8000f2c66f_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__server_8c_a80fa82b117432f080f39f481ab5d9fef}{\index{T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}!send\+\_\+pending\+\_\+data@{send\+\_\+pending\+\_\+data}}
\index{send\+\_\+pending\+\_\+data@{send\+\_\+pending\+\_\+data}!T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}}
\subsubsection[{send\+\_\+pending\+\_\+data}]{\setlength{\rightskip}{0pt plus 5cm}static int send\+\_\+pending\+\_\+data (
\begin{DoxyParamCaption}
\item[{{\bf T\+C\+P\+\_\+\+Secure\+\_\+\+Connection} $\ast$}]{con}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_t_c_p__server_8c_a80fa82b117432f080f39f481ab5d9fef}


Definition at line 321 of file T\+C\+P\+\_\+server.\+c.



References T\+C\+P\+\_\+\+Priority\+\_\+\+List\+::data, T\+C\+P\+\_\+\+Priority\+\_\+\+List\+::next, T\+C\+P\+\_\+\+Secure\+\_\+\+Connection\+::priority\+\_\+queue\+\_\+end, T\+C\+P\+\_\+\+Secure\+\_\+\+Connection\+::priority\+\_\+queue\+\_\+start, send\+\_\+pending\+\_\+data\+\_\+nonpriority(), T\+C\+P\+\_\+\+Priority\+\_\+\+List\+::sent, T\+C\+P\+\_\+\+Priority\+\_\+\+List\+::size, and T\+C\+P\+\_\+\+Secure\+\_\+\+Connection\+::sock.



Referenced by do\+\_\+\+T\+C\+P\+\_\+confirmed(), and write\+\_\+packet\+\_\+\+T\+C\+P\+\_\+secure\+\_\+connection().


\begin{DoxyCode}
322 \{
323     \textcolor{comment}{/* finish sending current non-priority packet */}
324     \textcolor{keywordflow}{if} (\hyperlink{_t_c_p__server_8c_a127449a3fca8398acf0ba361be8c5c83}{send\_pending\_data\_nonpriority}(con) == -1) \{
325         \textcolor{keywordflow}{return} -1;
326     \}
327 
328     \hyperlink{struct_t_c_p___priority___list}{TCP\_Priority\_List} *p = con->\hyperlink{struct_t_c_p___secure___connection_a5e19017835c72dc03d9dfd9a93abeb3c}{priority\_queue\_start};
329 
330     \textcolor{keywordflow}{while} (p) \{
331         uint16\_t left = p->\hyperlink{struct_t_c_p___priority___list_aaba88b24a21a6c70c895c0d55f4a69a0}{size} - p->\hyperlink{struct_t_c_p___priority___list_a61e6f322b3c26ac891710463676b5185}{sent};
332         \textcolor{keywordtype}{int} len = send(con->\hyperlink{struct_t_c_p___secure___connection_a35b19d84fb632ca8ce5cab237f7089a5}{sock}, p->\hyperlink{struct_t_c_p___priority___list_a5c239a1bb87b52b0f1d6d68c4749cd2a}{data} + p->\hyperlink{struct_t_c_p___priority___list_a61e6f322b3c26ac891710463676b5185}{sent}, left, MSG\_NOSIGNAL);
333 
334         \textcolor{keywordflow}{if} (len != left) \{
335             \textcolor{keywordflow}{if} (len > 0) \{
336                 p->\hyperlink{struct_t_c_p___priority___list_a61e6f322b3c26ac891710463676b5185}{sent} += len;
337             \}
338 
339             \textcolor{keywordflow}{break};
340         \}
341 
342         \hyperlink{struct_t_c_p___priority___list}{TCP\_Priority\_List} *pp = p;
343         p = p->\hyperlink{struct_t_c_p___priority___list_ac4565314423a94bcf735245b8b9b4c53}{next};
344         free(pp);
345     \}
346 
347     con->\hyperlink{struct_t_c_p___secure___connection_a5e19017835c72dc03d9dfd9a93abeb3c}{priority\_queue\_start} = p;
348 
349     \textcolor{keywordflow}{if} (!p) \{
350         con->\hyperlink{struct_t_c_p___secure___connection_a049dfdaebf54337c3024e077370c62d7}{priority\_queue\_end} = NULL;
351         \textcolor{keywordflow}{return} 0;
352     \}
353 
354     \textcolor{keywordflow}{return} -1;
355 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_a80fa82b117432f080f39f481ab5d9fef_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_a80fa82b117432f080f39f481ab5d9fef_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__server_8c_a127449a3fca8398acf0ba361be8c5c83}{\index{T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}!send\+\_\+pending\+\_\+data\+\_\+nonpriority@{send\+\_\+pending\+\_\+data\+\_\+nonpriority}}
\index{send\+\_\+pending\+\_\+data\+\_\+nonpriority@{send\+\_\+pending\+\_\+data\+\_\+nonpriority}!T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}}
\subsubsection[{send\+\_\+pending\+\_\+data\+\_\+nonpriority}]{\setlength{\rightskip}{0pt plus 5cm}static int send\+\_\+pending\+\_\+data\+\_\+nonpriority (
\begin{DoxyParamCaption}
\item[{{\bf T\+C\+P\+\_\+\+Secure\+\_\+\+Connection} $\ast$}]{con}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_t_c_p__server_8c_a127449a3fca8398acf0ba361be8c5c83}


Definition at line 295 of file T\+C\+P\+\_\+server.\+c.



References T\+C\+P\+\_\+\+Secure\+\_\+\+Connection\+::last\+\_\+packet, T\+C\+P\+\_\+\+Secure\+\_\+\+Connection\+::last\+\_\+packet\+\_\+length, T\+C\+P\+\_\+\+Secure\+\_\+\+Connection\+::last\+\_\+packet\+\_\+sent, and T\+C\+P\+\_\+\+Secure\+\_\+\+Connection\+::sock.



Referenced by send\+\_\+pending\+\_\+data().


\begin{DoxyCode}
296 \{
297     \textcolor{keywordflow}{if} (con->\hyperlink{struct_t_c_p___secure___connection_a78d503fe4c8d935701480b58a0461775}{last\_packet\_length} == 0) \{
298         \textcolor{keywordflow}{return} 0;
299     \}
300 
301     uint16\_t left = con->\hyperlink{struct_t_c_p___secure___connection_a78d503fe4c8d935701480b58a0461775}{last\_packet\_length} - con->
      \hyperlink{struct_t_c_p___secure___connection_a80b55fa7d5b8e4c3de6b51c99d7670cc}{last\_packet\_sent};
302     \textcolor{keywordtype}{int} len = send(con->\hyperlink{struct_t_c_p___secure___connection_a35b19d84fb632ca8ce5cab237f7089a5}{sock}, con->\hyperlink{struct_t_c_p___secure___connection_af7b6d103d243e4267b112f6efe1573e2}{last\_packet} + con->
      \hyperlink{struct_t_c_p___secure___connection_a80b55fa7d5b8e4c3de6b51c99d7670cc}{last\_packet\_sent}, left, MSG\_NOSIGNAL);
303 
304     \textcolor{keywordflow}{if} (len <= 0)
305         \textcolor{keywordflow}{return} -1;
306 
307     \textcolor{keywordflow}{if} (len == left) \{
308         con->\hyperlink{struct_t_c_p___secure___connection_a78d503fe4c8d935701480b58a0461775}{last\_packet\_length} = 0;
309         con->\hyperlink{struct_t_c_p___secure___connection_a80b55fa7d5b8e4c3de6b51c99d7670cc}{last\_packet\_sent} = 0;
310         \textcolor{keywordflow}{return} 0;
311     \}
312 
313     con->\hyperlink{struct_t_c_p___secure___connection_a80b55fa7d5b8e4c3de6b51c99d7670cc}{last\_packet\_sent} += len;
314     \textcolor{keywordflow}{return} -1;
315 
316 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_a127449a3fca8398acf0ba361be8c5c83_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__server_8c_a378a47bb3e63730aa104d8da7d10f384}{\index{T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}!send\+\_\+routing\+\_\+response@{send\+\_\+routing\+\_\+response}}
\index{send\+\_\+routing\+\_\+response@{send\+\_\+routing\+\_\+response}!T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}}
\subsubsection[{send\+\_\+routing\+\_\+response}]{\setlength{\rightskip}{0pt plus 5cm}static int send\+\_\+routing\+\_\+response (
\begin{DoxyParamCaption}
\item[{{\bf T\+C\+P\+\_\+\+Secure\+\_\+\+Connection} $\ast$}]{con, }
\item[{uint8\+\_\+t}]{rpid, }
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_t_c_p__server_8c_a378a47bb3e63730aa104d8da7d10f384}


Definition at line 546 of file T\+C\+P\+\_\+server.\+c.



References make-\/funny-\/savefile\+::data, T\+C\+P\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+R\+O\+U\+T\+I\+N\+G\+\_\+\+R\+E\+S\+P\+O\+N\+S\+E, and write\+\_\+packet\+\_\+\+T\+C\+P\+\_\+secure\+\_\+connection().



Referenced by handle\+\_\+\+T\+C\+P\+\_\+routing\+\_\+req().


\begin{DoxyCode}
547 \{
548     uint8\_t \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[1 + 1 + crypto\_box\_PUBLICKEYBYTES];
549     data[0] = \hyperlink{_t_c_p__server_8h_ad288b46b857552d69e64135b3a329d83}{TCP\_PACKET\_ROUTING\_RESPONSE};
550     data[1] = rpid;
551     memcpy(data + 2, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, crypto\_box\_PUBLICKEYBYTES);
552 
553     \textcolor{keywordflow}{return} \hyperlink{_t_c_p__server_8c_a1b2fd7984b9d3eb39bf588fc9bc5e21f}{write\_packet\_TCP\_secure\_connection}(con, data, \textcolor{keyword}{sizeof}(data), 1)
      ;
554 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_a378a47bb3e63730aa104d8da7d10f384_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_a378a47bb3e63730aa104d8da7d10f384_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__server_8c_ae80fe7119d00d2a7788c0839a90e0782}{\index{T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}!T\+C\+P\+\_\+socket\+\_\+data\+\_\+recv\+\_\+buffer@{T\+C\+P\+\_\+socket\+\_\+data\+\_\+recv\+\_\+buffer}}
\index{T\+C\+P\+\_\+socket\+\_\+data\+\_\+recv\+\_\+buffer@{T\+C\+P\+\_\+socket\+\_\+data\+\_\+recv\+\_\+buffer}!T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}}
\subsubsection[{T\+C\+P\+\_\+socket\+\_\+data\+\_\+recv\+\_\+buffer}]{\setlength{\rightskip}{0pt plus 5cm}unsigned int T\+C\+P\+\_\+socket\+\_\+data\+\_\+recv\+\_\+buffer (
\begin{DoxyParamCaption}
\item[{{\bf sock\+\_\+t}}]{sock}
\end{DoxyParamCaption}
)}}\label{_t_c_p__server_8c_ae80fe7119d00d2a7788c0839a90e0782}


Definition at line 184 of file T\+C\+P\+\_\+server.\+c.



Referenced by proxy\+\_\+http\+\_\+read\+\_\+connection\+\_\+response(), read\+\_\+\+T\+C\+P\+\_\+length(), and read\+\_\+\+T\+C\+P\+\_\+packet().


\begin{DoxyCode}
185 \{
186 \textcolor{preprocessor}{#if defined(\_WIN32) || defined(\_\_WIN32\_\_) || defined (WIN32)}
187     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} count = 0;
188     ioctlsocket(\hyperlink{irc__syncbot_8c_a5903d0b282fc5eae503de618f896b5e1}{sock}, FIONREAD, &count);
189 \textcolor{preprocessor}{#else}
190     \textcolor{keywordtype}{int} count = 0;
191     ioctl(\hyperlink{irc__syncbot_8c_a5903d0b282fc5eae503de618f896b5e1}{sock}, FIONREAD, &count);
192 \textcolor{preprocessor}{#endif}
193 
194     \textcolor{keywordflow}{return} count;
195 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_ae80fe7119d00d2a7788c0839a90e0782_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__server_8c_a1b2fd7984b9d3eb39bf588fc9bc5e21f}{\index{T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}!write\+\_\+packet\+\_\+\+T\+C\+P\+\_\+secure\+\_\+connection@{write\+\_\+packet\+\_\+\+T\+C\+P\+\_\+secure\+\_\+connection}}
\index{write\+\_\+packet\+\_\+\+T\+C\+P\+\_\+secure\+\_\+connection@{write\+\_\+packet\+\_\+\+T\+C\+P\+\_\+secure\+\_\+connection}!T\+C\+P\+\_\+server.\+c@{T\+C\+P\+\_\+server.\+c}}
\subsubsection[{write\+\_\+packet\+\_\+\+T\+C\+P\+\_\+secure\+\_\+connection}]{\setlength{\rightskip}{0pt plus 5cm}static int write\+\_\+packet\+\_\+\+T\+C\+P\+\_\+secure\+\_\+connection (
\begin{DoxyParamCaption}
\item[{{\bf T\+C\+P\+\_\+\+Secure\+\_\+\+Connection} $\ast$}]{con, }
\item[{const uint8\+\_\+t $\ast$}]{data, }
\item[{uint16\+\_\+t}]{length, }
\item[{\+\_\+\+Bool}]{priority}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_t_c_p__server_8c_a1b2fd7984b9d3eb39bf588fc9bc5e21f}


Definition at line 388 of file T\+C\+P\+\_\+server.\+c.



References add\+\_\+priority(), encrypt\+\_\+data\+\_\+symmetric(), increment\+\_\+nonce(), T\+C\+P\+\_\+\+Secure\+\_\+\+Connection\+::last\+\_\+packet, T\+C\+P\+\_\+\+Secure\+\_\+\+Connection\+::last\+\_\+packet\+\_\+length, T\+C\+P\+\_\+\+Secure\+\_\+\+Connection\+::last\+\_\+packet\+\_\+sent, M\+A\+X\+\_\+\+P\+A\+C\+K\+E\+T\+\_\+\+S\+I\+Z\+E, send\+\_\+pending\+\_\+data(), T\+C\+P\+\_\+\+Secure\+\_\+\+Connection\+::sent\+\_\+nonce, T\+C\+P\+\_\+\+Secure\+\_\+\+Connection\+::shared\+\_\+key, and T\+C\+P\+\_\+\+Secure\+\_\+\+Connection\+::sock.



Referenced by do\+\_\+\+T\+C\+P\+\_\+confirmed(), handle\+\_\+onion\+\_\+recv\+\_\+1(), handle\+\_\+\+T\+C\+P\+\_\+oob\+\_\+send(), handle\+\_\+\+T\+C\+P\+\_\+packet(), send\+\_\+connect\+\_\+notification(), send\+\_\+disconnect\+\_\+notification(), and send\+\_\+routing\+\_\+response().


\begin{DoxyCode}
390 \{
391     \textcolor{keywordflow}{if} (length + crypto\_box\_MACBYTES > \hyperlink{_t_c_p__server_8h_a879456c3b8e2853f7044d764e9c180d4}{MAX\_PACKET\_SIZE})
392         \textcolor{keywordflow}{return} -1;
393 
394     \_Bool sendpriority = 1;
395 
396     \textcolor{keywordflow}{if} (\hyperlink{_t_c_p__server_8c_a80fa82b117432f080f39f481ab5d9fef}{send\_pending\_data}(con) == -1) \{
397         \textcolor{keywordflow}{if} (priority) \{
398             sendpriority = 0;
399         \} \textcolor{keywordflow}{else} \{
400             \textcolor{keywordflow}{return} 0;
401         \}
402     \}
403 
404     uint8\_t packet[\textcolor{keyword}{sizeof}(uint16\_t) + length + crypto\_box\_MACBYTES];
405 
406     uint16\_t c\_length = htons(length + crypto\_box\_MACBYTES);
407     memcpy(packet, &c\_length, \textcolor{keyword}{sizeof}(uint16\_t));
408     \textcolor{keywordtype}{int} len = \hyperlink{crypto__core_8c_a81efc0a4a6e0efe372651e26e342a6e5}{encrypt\_data\_symmetric}(con->\hyperlink{struct_t_c_p___secure___connection_a81ead9fac55a0cedc30a96253a2c5119}{shared\_key}, con->
      \hyperlink{struct_t_c_p___secure___connection_a9df0e00e8f493ed6cd1ff45e7da33c0d}{sent\_nonce}, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}, length, packet + \textcolor{keyword}{sizeof}(uint16\_t));
409 
410     \textcolor{keywordflow}{if} ((\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int})len != (\textcolor{keyword}{sizeof}(packet) - \textcolor{keyword}{sizeof}(uint16\_t)))
411         \textcolor{keywordflow}{return} -1;
412 
413     \textcolor{keywordflow}{if} (priority) \{
414         len = sendpriority ? send(con->\hyperlink{struct_t_c_p___secure___connection_a35b19d84fb632ca8ce5cab237f7089a5}{sock}, packet, \textcolor{keyword}{sizeof}(packet), MSG\_NOSIGNAL) : 0;
415 
416         \textcolor{keywordflow}{if} (len <= 0) \{
417             len = 0;
418         \}
419 
420         \hyperlink{crypto__core_8c_ab953f1e92b8a9a193f69f02323b9c980}{increment\_nonce}(con->\hyperlink{struct_t_c_p___secure___connection_a9df0e00e8f493ed6cd1ff45e7da33c0d}{sent\_nonce});
421 
422         \textcolor{keywordflow}{if} ((\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int})len == \textcolor{keyword}{sizeof}(packet)) \{
423             \textcolor{keywordflow}{return} 1;
424         \}
425 
426         \textcolor{keywordflow}{return} \hyperlink{_t_c_p__server_8c_ac9f38bf2eaf3cd2603c380091ae6ebad}{add\_priority}(con, packet, \textcolor{keyword}{sizeof}(packet), len);
427     \}
428 
429     len = send(con->\hyperlink{struct_t_c_p___secure___connection_a35b19d84fb632ca8ce5cab237f7089a5}{sock}, packet, \textcolor{keyword}{sizeof}(packet), MSG\_NOSIGNAL);
430 
431     \textcolor{keywordflow}{if} (len <= 0)
432         \textcolor{keywordflow}{return} 0;
433 
434     \hyperlink{crypto__core_8c_ab953f1e92b8a9a193f69f02323b9c980}{increment\_nonce}(con->\hyperlink{struct_t_c_p___secure___connection_a9df0e00e8f493ed6cd1ff45e7da33c0d}{sent\_nonce});
435 
436     \textcolor{keywordflow}{if} ((\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int})len == \textcolor{keyword}{sizeof}(packet))
437         \textcolor{keywordflow}{return} 1;
438 
439     memcpy(con->\hyperlink{struct_t_c_p___secure___connection_af7b6d103d243e4267b112f6efe1573e2}{last\_packet}, packet, \textcolor{keyword}{sizeof}(packet));
440     con->\hyperlink{struct_t_c_p___secure___connection_a78d503fe4c8d935701480b58a0461775}{last\_packet\_length} = \textcolor{keyword}{sizeof}(packet);
441     con->\hyperlink{struct_t_c_p___secure___connection_a80b55fa7d5b8e4c3de6b51c99d7670cc}{last\_packet\_sent} = len;
442     \textcolor{keywordflow}{return} 1;
443 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_a1b2fd7984b9d3eb39bf588fc9bc5e21f_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d40/_t_c_p__server_8c_a1b2fd7984b9d3eb39bf588fc9bc5e21f_icgraph}
\end{center}
\end{figure}


