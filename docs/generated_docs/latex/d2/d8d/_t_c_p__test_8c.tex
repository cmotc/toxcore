\hypertarget{_t_c_p__test_8c}{\section{auto\+\_\+tests/\+T\+C\+P\+\_\+test.c File Reference}
\label{_t_c_p__test_8c}\index{auto\+\_\+tests/\+T\+C\+P\+\_\+test.\+c@{auto\+\_\+tests/\+T\+C\+P\+\_\+test.\+c}}
}
{\ttfamily \#include $<$sys/types.\+h$>$}\\*
{\ttfamily \#include $<$stdint.\+h$>$}\\*
{\ttfamily \#include $<$string.\+h$>$}\\*
{\ttfamily \#include $<$check.\+h$>$}\\*
{\ttfamily \#include $<$stdlib.\+h$>$}\\*
{\ttfamily \#include $<$time.\+h$>$}\\*
{\ttfamily \#include \char`\"{}../toxcore/\+T\+C\+P\+\_\+server.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}../toxcore/\+T\+C\+P\+\_\+client.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}../toxcore/util.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}helpers.\+h\char`\"{}}\\*
{\ttfamily \#include $<$unistd.\+h$>$}\\*
{\ttfamily \#include \char`\"{}../toxcore/\+T\+C\+P\+\_\+connection.\+h\char`\"{}}\\*
Include dependency graph for T\+C\+P\+\_\+test.\+c\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{dd/dfc/_t_c_p__test_8c__incl}
\end{center}
\end{figure}
\subsection*{Data Structures}
\begin{DoxyCompactItemize}
\item 
struct \hyperlink{structsec___t_c_p__con}{sec\+\_\+\+T\+C\+P\+\_\+con}
\end{DoxyCompactItemize}
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{_t_c_p__test_8c_a5d21ea3d7da27fbd9f40c59aaa04da62}{c\+\_\+sleep}(\hyperlink{n_tox_8c_a6150e0515f7202e2fb518f7206ed97dc}{x})~usleep(1000$\ast$\hyperlink{n_tox_8c_a6150e0515f7202e2fb518f7206ed97dc}{x})
\item 
\#define \hyperlink{_t_c_p__test_8c_af89985dbf9e670e3e7baebb0e05a0f46}{N\+U\+M\+\_\+\+P\+O\+R\+T\+S}~3
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{_t_c_p__test_8c_ad7475d1539db4bb3bcf8673dd7f7cf68}{S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T} (test\+\_\+basic)
\item 
struct \hyperlink{structsec___t_c_p__con}{sec\+\_\+\+T\+C\+P\+\_\+con} $\ast$ \hyperlink{_t_c_p__test_8c_a8958ca530ce6534e81eaa06e582a26ad}{new\+\_\+\+T\+C\+P\+\_\+con} (\hyperlink{struct_t_c_p___server}{T\+C\+P\+\_\+\+Server} $\ast$tcp\+\_\+s)
\item 
void \hyperlink{_t_c_p__test_8c_a45b16f4a525767c13ad26ad71c7045f2}{kill\+\_\+\+T\+C\+P\+\_\+con} (struct \hyperlink{structsec___t_c_p__con}{sec\+\_\+\+T\+C\+P\+\_\+con} $\ast$con)
\item 
int \hyperlink{_t_c_p__test_8c_aa54773b9420df5d5d443bc0cfcec1784}{write\+\_\+packet\+\_\+\+T\+C\+P\+\_\+secure\+\_\+connection} (struct \hyperlink{structsec___t_c_p__con}{sec\+\_\+\+T\+C\+P\+\_\+con} $\ast$con, uint8\+\_\+t $\ast$data, uint16\+\_\+t length)
\item 
int \hyperlink{_t_c_p__test_8c_a18769b8a942f1fc9a296f5e807e3b575}{read\+\_\+packet\+\_\+sec\+\_\+\+T\+C\+P} (struct \hyperlink{structsec___t_c_p__con}{sec\+\_\+\+T\+C\+P\+\_\+con} $\ast$con, uint8\+\_\+t $\ast$data, uint16\+\_\+t length)
\item 
\hyperlink{_t_c_p__test_8c_a0ee98d716eb7311dd4b6d217289734ff}{S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T} (test\+\_\+some)
\item 
static int \hyperlink{_t_c_p__test_8c_aabbbe757608283acb298ba44b3b01706}{response\+\_\+callback} (void $\ast$object, uint8\+\_\+t connection\+\_\+id, const uint8\+\_\+t $\ast$public\+\_\+key)
\item 
static int \hyperlink{_t_c_p__test_8c_ae4f12b6805a17277d33e73ac030d7aca}{status\+\_\+callback} (void $\ast$object, uint32\+\_\+t number, uint8\+\_\+t connection\+\_\+id, uint8\+\_\+t status)
\item 
static int \hyperlink{_t_c_p__test_8c_a36ed22ce4a6bec3fb113a4eaf29df5e1}{data\+\_\+callback} (void $\ast$object, uint32\+\_\+t number, uint8\+\_\+t connection\+\_\+id, const uint8\+\_\+t $\ast$data, uint16\+\_\+t length)
\item 
static int \hyperlink{_t_c_p__test_8c_a7a0dc2152e401dc318c450f172b3c124}{oob\+\_\+data\+\_\+callback} (void $\ast$object, const uint8\+\_\+t $\ast$public\+\_\+key, const uint8\+\_\+t $\ast$data, uint16\+\_\+t length)
\item 
\hyperlink{_t_c_p__test_8c_a54051584eff6e81044025b36d88c9a2b}{S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T} (test\+\_\+client)
\item 
E\+N\+D\+\_\+\+T\+E\+S\+T \hyperlink{_t_c_p__test_8c_a8d592cfda9af8c42ae12853983f50c87}{S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T} (test\+\_\+client\+\_\+invalid)
\item 
static int \hyperlink{_t_c_p__test_8c_ab2eaad4448a5deca58a00316b522e380}{tcp\+\_\+data\+\_\+callback} (void $\ast$object, int id, const uint8\+\_\+t $\ast$data, uint16\+\_\+t length)
\item 
\hyperlink{_t_c_p__test_8c_a1b7f98a901f4b8685223ec1dac1c1ce3}{S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T} (test\+\_\+tcp\+\_\+connection)
\item 
static int \hyperlink{_t_c_p__test_8c_aa506c7db9407212fb8fd6d767aa974c2}{tcp\+\_\+oobdata\+\_\+callback} (void $\ast$object, const uint8\+\_\+t $\ast$public\+\_\+key, unsigned int id, const uint8\+\_\+t $\ast$data, uint16\+\_\+t length)
\item 
\hyperlink{_t_c_p__test_8c_ac45927e61cae5bb70dbde2b32c8f62ff}{S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T} (test\+\_\+tcp\+\_\+connection2)
\item 
E\+N\+D\+\_\+\+T\+E\+S\+T Suite $\ast$ \hyperlink{_t_c_p__test_8c_a8089614950e49b4d49f390862dc5e352}{T\+C\+P\+\_\+suite} (void)
\item 
int \hyperlink{_t_c_p__test_8c_a0ddf1224851353fc92bfbff6f499fa97}{main} (int argc, char $\ast$argv\mbox{[}$\,$\mbox{]})
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
uint16\+\_\+t \hyperlink{_t_c_p__test_8c_a04e5444bf6a826487066ba973577f674}{ports} \mbox{[}\hyperlink{_d_h_t__bootstrap_8c_af89985dbf9e670e3e7baebb0e05a0f46}{N\+U\+M\+\_\+\+P\+O\+R\+T\+S}\mbox{]} = \{1234, 33445, 25643\}
\item 
static E\+N\+D\+\_\+\+T\+E\+S\+T int \hyperlink{_t_c_p__test_8c_a6cc5f5429af8eac44a61d96130d90892}{response\+\_\+callback\+\_\+good}
\item 
static uint8\+\_\+t \hyperlink{_t_c_p__test_8c_a11a7f4760ef556ac61b828cb15ac883d}{response\+\_\+callback\+\_\+connection\+\_\+id}
\item 
static uint8\+\_\+t \hyperlink{_t_c_p__test_8c_a9b22a226187b8d0a3d0333c9f12d4518}{response\+\_\+callback\+\_\+public\+\_\+key} \mbox{[}crypto\+\_\+box\+\_\+\+P\+U\+B\+L\+I\+C\+K\+E\+Y\+B\+Y\+T\+E\+S\mbox{]}
\item 
static int \hyperlink{_t_c_p__test_8c_a56f484ef0812f6fe7d948f2546fed8d0}{status\+\_\+callback\+\_\+good}
\item 
static uint8\+\_\+t \hyperlink{_t_c_p__test_8c_a785c292a23140df70c0821eba58a4349}{status\+\_\+callback\+\_\+connection\+\_\+id}
\item 
static uint8\+\_\+t \hyperlink{_t_c_p__test_8c_a42d85e1f7a64f14bff24e31b09a3a4f3}{status\+\_\+callback\+\_\+status}
\item 
static int \hyperlink{_t_c_p__test_8c_ad6e4db92d778379939f9bc01b517a0b2}{data\+\_\+callback\+\_\+good}
\item 
static int \hyperlink{_t_c_p__test_8c_abca7ecb374ce72cbc9af98ab83209885}{oob\+\_\+data\+\_\+callback\+\_\+good}
\item 
static uint8\+\_\+t \hyperlink{_t_c_p__test_8c_a17306a75951c9f71ee922cb4e69ff786}{oob\+\_\+pubkey} \mbox{[}crypto\+\_\+box\+\_\+\+P\+U\+B\+L\+I\+C\+K\+E\+Y\+B\+Y\+T\+E\+S\mbox{]}
\item 
E\+N\+D\+\_\+\+T\+E\+S\+T \+\_\+\+Bool \hyperlink{_t_c_p__test_8c_a13b39dc467dbf69283b5399761400315}{tcp\+\_\+data\+\_\+callback\+\_\+called}
\item 
E\+N\+D\+\_\+\+T\+E\+S\+T \+\_\+\+Bool \hyperlink{_t_c_p__test_8c_a8abafa082d888febbe0d3999d7799cc6}{tcp\+\_\+oobdata\+\_\+callback\+\_\+called}
\end{DoxyCompactItemize}


\subsection{Macro Definition Documentation}
\hypertarget{_t_c_p__test_8c_a5d21ea3d7da27fbd9f40c59aaa04da62}{\index{T\+C\+P\+\_\+test.\+c@{T\+C\+P\+\_\+test.\+c}!c\+\_\+sleep@{c\+\_\+sleep}}
\index{c\+\_\+sleep@{c\+\_\+sleep}!T\+C\+P\+\_\+test.\+c@{T\+C\+P\+\_\+test.\+c}}
\subsubsection[{c\+\_\+sleep}]{\setlength{\rightskip}{0pt plus 5cm}\#define c\+\_\+sleep(
\begin{DoxyParamCaption}
\item[{}]{{\bf x}}
\end{DoxyParamCaption}
)~usleep(1000$\ast${\bf x})}}\label{_t_c_p__test_8c_a5d21ea3d7da27fbd9f40c59aaa04da62}


Definition at line 23 of file T\+C\+P\+\_\+test.\+c.



Referenced by new\+\_\+\+T\+C\+P\+\_\+con(), and S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T().

\hypertarget{_t_c_p__test_8c_af89985dbf9e670e3e7baebb0e05a0f46}{\index{T\+C\+P\+\_\+test.\+c@{T\+C\+P\+\_\+test.\+c}!N\+U\+M\+\_\+\+P\+O\+R\+T\+S@{N\+U\+M\+\_\+\+P\+O\+R\+T\+S}}
\index{N\+U\+M\+\_\+\+P\+O\+R\+T\+S@{N\+U\+M\+\_\+\+P\+O\+R\+T\+S}!T\+C\+P\+\_\+test.\+c@{T\+C\+P\+\_\+test.\+c}}
\subsubsection[{N\+U\+M\+\_\+\+P\+O\+R\+T\+S}]{\setlength{\rightskip}{0pt plus 5cm}\#define N\+U\+M\+\_\+\+P\+O\+R\+T\+S~3}}\label{_t_c_p__test_8c_af89985dbf9e670e3e7baebb0e05a0f46}


Definition at line 26 of file T\+C\+P\+\_\+test.\+c.



Referenced by new\+\_\+\+T\+C\+P\+\_\+con(), and S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T().



\subsection{Function Documentation}
\hypertarget{_t_c_p__test_8c_a36ed22ce4a6bec3fb113a4eaf29df5e1}{\index{T\+C\+P\+\_\+test.\+c@{T\+C\+P\+\_\+test.\+c}!data\+\_\+callback@{data\+\_\+callback}}
\index{data\+\_\+callback@{data\+\_\+callback}!T\+C\+P\+\_\+test.\+c@{T\+C\+P\+\_\+test.\+c}}
\subsubsection[{data\+\_\+callback}]{\setlength{\rightskip}{0pt plus 5cm}static int data\+\_\+callback (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{object, }
\item[{uint32\+\_\+t}]{number, }
\item[{uint8\+\_\+t}]{connection\+\_\+id, }
\item[{const uint8\+\_\+t $\ast$}]{data, }
\item[{uint16\+\_\+t}]{length}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_t_c_p__test_8c_a36ed22ce4a6bec3fb113a4eaf29df5e1}


Definition at line 337 of file T\+C\+P\+\_\+test.\+c.



References data\+\_\+callback\+\_\+good.



Referenced by friend\+\_\+connection\+\_\+callbacks(), routing\+\_\+data\+\_\+handler(), and S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T().


\begin{DoxyCode}
338 \{
339     \textcolor{keywordflow}{if} (\textcolor{keywordtype}{object} != (\textcolor{keywordtype}{void} *)3)
340         \textcolor{keywordflow}{return} 1;
341 
342     \textcolor{keywordflow}{if} (number != 7)
343         \textcolor{keywordflow}{return} 1;
344 
345     \textcolor{keywordflow}{if} (length != 5)
346         \textcolor{keywordflow}{return} 1;
347 
348     \textcolor{keywordflow}{if} (\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[0] == 1 && \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[1] == 2 && \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[2] == 3 && \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[3] == 4 && 
      \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[4] == 5) \{
349         \hyperlink{_t_c_p__test_8c_ad6e4db92d778379939f9bc01b517a0b2}{data\_callback\_good}++;
350         \textcolor{keywordflow}{return} 0;
351     \}
352 
353     \textcolor{keywordflow}{return} 1;
354 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d8d/_t_c_p__test_8c_a36ed22ce4a6bec3fb113a4eaf29df5e1_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__test_8c_a45b16f4a525767c13ad26ad71c7045f2}{\index{T\+C\+P\+\_\+test.\+c@{T\+C\+P\+\_\+test.\+c}!kill\+\_\+\+T\+C\+P\+\_\+con@{kill\+\_\+\+T\+C\+P\+\_\+con}}
\index{kill\+\_\+\+T\+C\+P\+\_\+con@{kill\+\_\+\+T\+C\+P\+\_\+con}!T\+C\+P\+\_\+test.\+c@{T\+C\+P\+\_\+test.\+c}}
\subsubsection[{kill\+\_\+\+T\+C\+P\+\_\+con}]{\setlength{\rightskip}{0pt plus 5cm}void kill\+\_\+\+T\+C\+P\+\_\+con (
\begin{DoxyParamCaption}
\item[{struct {\bf sec\+\_\+\+T\+C\+P\+\_\+con} $\ast$}]{con}
\end{DoxyParamCaption}
)}}\label{_t_c_p__test_8c_a45b16f4a525767c13ad26ad71c7045f2}


Definition at line 179 of file T\+C\+P\+\_\+test.\+c.



References kill\+\_\+sock(), and sec\+\_\+\+T\+C\+P\+\_\+con\+::sock.



Referenced by S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T().


\begin{DoxyCode}
180 \{
181     \hyperlink{network_8c_a512d8ea12392ba9ddfadd83bb7c92b2e}{kill\_sock}(con->\hyperlink{structsec___t_c_p__con_a35b19d84fb632ca8ce5cab237f7089a5}{sock});
182     free(con);
183 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=246pt]{d2/d8d/_t_c_p__test_8c_a45b16f4a525767c13ad26ad71c7045f2_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=271pt]{d2/d8d/_t_c_p__test_8c_a45b16f4a525767c13ad26ad71c7045f2_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__test_8c_a0ddf1224851353fc92bfbff6f499fa97}{\index{T\+C\+P\+\_\+test.\+c@{T\+C\+P\+\_\+test.\+c}!main@{main}}
\index{main@{main}!T\+C\+P\+\_\+test.\+c@{T\+C\+P\+\_\+test.\+c}}
\subsubsection[{main}]{\setlength{\rightskip}{0pt plus 5cm}int main (
\begin{DoxyParamCaption}
\item[{int}]{argc, }
\item[{char $\ast$}]{argv\mbox{[}$\,$\mbox{]}}
\end{DoxyParamCaption}
)}}\label{_t_c_p__test_8c_a0ddf1224851353fc92bfbff6f499fa97}


Definition at line 728 of file T\+C\+P\+\_\+test.\+c.



References T\+C\+P\+\_\+suite().


\begin{DoxyCode}
729 \{
730     srand((\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}) time(NULL));
731 
732     Suite *TCP = \hyperlink{_t_c_p__test_8c_a8089614950e49b4d49f390862dc5e352}{TCP\_suite}();
733     SRunner *test\_runner = srunner\_create(TCP);
734 
735     \textcolor{keywordtype}{int} number\_failed = 0;
736     srunner\_run\_all(test\_runner, CK\_NORMAL);
737     number\_failed = srunner\_ntests\_failed(test\_runner);
738 
739     srunner\_free(test\_runner);
740 
741     \textcolor{keywordflow}{return} number\_failed;
742 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=217pt]{d2/d8d/_t_c_p__test_8c_a0ddf1224851353fc92bfbff6f499fa97_cgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__test_8c_a8958ca530ce6534e81eaa06e582a26ad}{\index{T\+C\+P\+\_\+test.\+c@{T\+C\+P\+\_\+test.\+c}!new\+\_\+\+T\+C\+P\+\_\+con@{new\+\_\+\+T\+C\+P\+\_\+con}}
\index{new\+\_\+\+T\+C\+P\+\_\+con@{new\+\_\+\+T\+C\+P\+\_\+con}!T\+C\+P\+\_\+test.\+c@{T\+C\+P\+\_\+test.\+c}}
\subsubsection[{new\+\_\+\+T\+C\+P\+\_\+con}]{\setlength{\rightskip}{0pt plus 5cm}struct {\bf sec\+\_\+\+T\+C\+P\+\_\+con}$\ast$ new\+\_\+\+T\+C\+P\+\_\+con (
\begin{DoxyParamCaption}
\item[{{\bf T\+C\+P\+\_\+\+Server} $\ast$}]{tcp\+\_\+s}
\end{DoxyParamCaption}
)}}\label{_t_c_p__test_8c_a8958ca530ce6534e81eaa06e582a26ad}


Definition at line 133 of file T\+C\+P\+\_\+test.\+c.



References c\+\_\+sleep, ck\+\_\+assert\+\_\+msg(), decrypt\+\_\+data(), do\+\_\+\+T\+C\+P\+\_\+server(), encrypt\+\_\+data(), encrypt\+\_\+precompute(), new\+\_\+nonce(), N\+U\+M\+\_\+\+P\+O\+R\+T\+S, ports, sec\+\_\+\+T\+C\+P\+\_\+con\+::public\+\_\+key, T\+C\+P\+\_\+\+Server\+::public\+\_\+key, random\+\_\+nonce(), sec\+\_\+\+T\+C\+P\+\_\+con\+::recv\+\_\+nonce, sec\+\_\+\+T\+C\+P\+\_\+con\+::sent\+\_\+nonce, sec\+\_\+\+T\+C\+P\+\_\+con\+::shared\+\_\+key, sock, sec\+\_\+\+T\+C\+P\+\_\+con\+::sock, T\+C\+P\+\_\+\+C\+L\+I\+E\+N\+T\+\_\+\+H\+A\+N\+D\+S\+H\+A\+K\+E\+\_\+\+S\+I\+Z\+E, T\+C\+P\+\_\+\+H\+A\+N\+D\+S\+H\+A\+K\+E\+\_\+\+P\+L\+A\+I\+N\+\_\+\+S\+I\+Z\+E, and T\+C\+P\+\_\+\+S\+E\+R\+V\+E\+R\+\_\+\+H\+A\+N\+D\+S\+H\+A\+K\+E\+\_\+\+S\+I\+Z\+E.



Referenced by S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T().


\begin{DoxyCode}
134 \{
135     \textcolor{keyword}{struct }\hyperlink{structsec___t_c_p__con}{sec\_TCP\_con} *sec\_c = malloc(\textcolor{keyword}{sizeof}(\textcolor{keyword}{struct} \hyperlink{structsec___t_c_p__con}{sec\_TCP\_con}));
136     \hyperlink{network_8h_ae5faf8a8d23da59c3e3025a62039d8c1}{sock\_t} \hyperlink{irc__syncbot_8c_a5903d0b282fc5eae503de618f896b5e1}{sock} = \hyperlink{namespacesocket}{socket}(AF\_INET6, SOCK\_STREAM, IPPROTO\_TCP);
137     \textcolor{keyword}{struct }sockaddr\_in6 addr6\_loopback = \{0\};
138     addr6\_loopback.sin6\_family = AF\_INET6;
139     addr6\_loopback.sin6\_port = htons(\hyperlink{_t_c_p__test_8c_a04e5444bf6a826487066ba973577f674}{ports}[rand() % \hyperlink{_t_c_p__test_8c_af89985dbf9e670e3e7baebb0e05a0f46}{NUM\_PORTS}]);
140     addr6\_loopback.sin6\_addr = in6addr\_loopback;
141 
142     \textcolor{keywordtype}{int} ret = connect(sock, (\textcolor{keyword}{struct} sockaddr *)&addr6\_loopback, \textcolor{keyword}{sizeof}(addr6\_loopback));
143     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(ret == 0, \textcolor{stringliteral}{"Failed to connect to TCP relay server"});
144 
145     uint8\_t f\_secret\_key[crypto\_box\_SECRETKEYBYTES];
146     crypto\_box\_keypair(sec\_c->\hyperlink{structsec___t_c_p__con_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, f\_secret\_key);
147     \hyperlink{crypto__core_8c_a15ef255ab026d4881a16b99148b05dd7}{random\_nonce}(sec\_c->\hyperlink{structsec___t_c_p__con_a9df0e00e8f493ed6cd1ff45e7da33c0d}{sent\_nonce});
148 
149     uint8\_t t\_secret\_key[crypto\_box\_SECRETKEYBYTES];
150     uint8\_t handshake\_plain[\hyperlink{_t_c_p__server_8h_a9b820bd1123c0fbdfd8391cce314b35b}{TCP\_HANDSHAKE\_PLAIN\_SIZE}];
151     crypto\_box\_keypair(handshake\_plain, t\_secret\_key);
152     memcpy(handshake\_plain + crypto\_box\_PUBLICKEYBYTES, sec\_c->\hyperlink{structsec___t_c_p__con_a9df0e00e8f493ed6cd1ff45e7da33c0d}{sent\_nonce}, crypto\_box\_NONCEBYTES)
      ;
153     uint8\_t handshake[\hyperlink{_t_c_p__server_8h_aa5f4778a5c176dbd24018f61cc7524f7}{TCP\_CLIENT\_HANDSHAKE\_SIZE}];
154     memcpy(handshake, sec\_c->\hyperlink{structsec___t_c_p__con_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, crypto\_box\_PUBLICKEYBYTES);
155     \hyperlink{crypto__core_8c_a8b1033efb47c625779d11be7d8eb9e24}{new\_nonce}(handshake + crypto\_box\_PUBLICKEYBYTES);
156 
157     ret = \hyperlink{crypto__core_8c_a014149333522d211490304255e139ec3}{encrypt\_data}(tcp\_s->\hyperlink{struct_t_c_p___server_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, f\_secret\_key, handshake + 
      crypto\_box\_PUBLICKEYBYTES, handshake\_plain,
158                        \hyperlink{_t_c_p__server_8h_a9b820bd1123c0fbdfd8391cce314b35b}{TCP\_HANDSHAKE\_PLAIN\_SIZE}, handshake + 
      crypto\_box\_PUBLICKEYBYTES + crypto\_box\_NONCEBYTES);
159     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(ret == \hyperlink{_t_c_p__server_8h_aa5f4778a5c176dbd24018f61cc7524f7}{TCP\_CLIENT\_HANDSHAKE\_SIZE} - (
      crypto\_box\_PUBLICKEYBYTES + crypto\_box\_NONCEBYTES),
160                   \textcolor{stringliteral}{"Encrypt failed."});
161     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(send(sock, handshake, \hyperlink{_t_c_p__server_8h_aa5f4778a5c176dbd24018f61cc7524f7}{TCP\_CLIENT\_HANDSHAKE\_SIZE} - 1
      , 0) == \hyperlink{_t_c_p__server_8h_aa5f4778a5c176dbd24018f61cc7524f7}{TCP\_CLIENT\_HANDSHAKE\_SIZE} - 1, \textcolor{stringliteral}{"send Failed."});
162     \hyperlink{_t_c_p__server_8c_a40e8a0302a359dd4f712eb1e9c346fe5}{do\_TCP\_server}(tcp\_s);
163     \hyperlink{_t_c_p__test_8c_a5d21ea3d7da27fbd9f40c59aaa04da62}{c\_sleep}(50);
164     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(send(sock, handshake + (\hyperlink{_t_c_p__server_8h_aa5f4778a5c176dbd24018f61cc7524f7}{TCP\_CLIENT\_HANDSHAKE\_SIZE} -
       1), 1, 0) == 1, \textcolor{stringliteral}{"send Failed."});
165     \hyperlink{_t_c_p__test_8c_a5d21ea3d7da27fbd9f40c59aaa04da62}{c\_sleep}(50);
166     \hyperlink{_t_c_p__server_8c_a40e8a0302a359dd4f712eb1e9c346fe5}{do\_TCP\_server}(tcp\_s);
167     uint8\_t response[\hyperlink{_t_c_p__server_8h_a88a61b02e465cd8c05fbae1def1066f2}{TCP\_SERVER\_HANDSHAKE\_SIZE}];
168     uint8\_t response\_plain[\hyperlink{_t_c_p__server_8h_a9b820bd1123c0fbdfd8391cce314b35b}{TCP\_HANDSHAKE\_PLAIN\_SIZE}];
169     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(recv(sock, response, \hyperlink{_t_c_p__server_8h_a88a61b02e465cd8c05fbae1def1066f2}{TCP\_SERVER\_HANDSHAKE\_SIZE}, 0) 
      == \hyperlink{_t_c_p__server_8h_a88a61b02e465cd8c05fbae1def1066f2}{TCP\_SERVER\_HANDSHAKE\_SIZE}, \textcolor{stringliteral}{"recv Failed."});
170     ret = \hyperlink{crypto__core_8c_ab0aff79180f3852c24ad8f6fd88caf18}{decrypt\_data}(tcp\_s->\hyperlink{struct_t_c_p___server_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, f\_secret\_key, response, response + 
      crypto\_box\_NONCEBYTES,
171                        \hyperlink{_t_c_p__server_8h_a88a61b02e465cd8c05fbae1def1066f2}{TCP\_SERVER\_HANDSHAKE\_SIZE} - crypto\_box\_NONCEBYTES, 
      response\_plain);
172     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(ret == \hyperlink{_t_c_p__server_8h_a9b820bd1123c0fbdfd8391cce314b35b}{TCP\_HANDSHAKE\_PLAIN\_SIZE}, \textcolor{stringliteral}{"Decrypt Failed."});
173     \hyperlink{crypto__core_8c_a0d8eaef49981c5dc3ada078866b42f6d}{encrypt\_precompute}(response\_plain, t\_secret\_key, sec\_c->
      \hyperlink{structsec___t_c_p__con_a81ead9fac55a0cedc30a96253a2c5119}{shared\_key});
174     memcpy(sec\_c->\hyperlink{structsec___t_c_p__con_aae0467706f97aa3ef23e5dc9c3c199d7}{recv\_nonce}, response\_plain + crypto\_box\_BEFORENMBYTES, crypto\_box\_NONCEBYTES);
175     sec\_c->\hyperlink{structsec___t_c_p__con_a35b19d84fb632ca8ce5cab237f7089a5}{sock} = \hyperlink{irc__syncbot_8c_a5903d0b282fc5eae503de618f896b5e1}{sock};
176     \textcolor{keywordflow}{return} sec\_c;
177 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d8d/_t_c_p__test_8c_a8958ca530ce6534e81eaa06e582a26ad_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=277pt]{d2/d8d/_t_c_p__test_8c_a8958ca530ce6534e81eaa06e582a26ad_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__test_8c_a7a0dc2152e401dc318c450f172b3c124}{\index{T\+C\+P\+\_\+test.\+c@{T\+C\+P\+\_\+test.\+c}!oob\+\_\+data\+\_\+callback@{oob\+\_\+data\+\_\+callback}}
\index{oob\+\_\+data\+\_\+callback@{oob\+\_\+data\+\_\+callback}!T\+C\+P\+\_\+test.\+c@{T\+C\+P\+\_\+test.\+c}}
\subsubsection[{oob\+\_\+data\+\_\+callback}]{\setlength{\rightskip}{0pt plus 5cm}static int oob\+\_\+data\+\_\+callback (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{object, }
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key, }
\item[{const uint8\+\_\+t $\ast$}]{data, }
\item[{uint16\+\_\+t}]{length}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_t_c_p__test_8c_a7a0dc2152e401dc318c450f172b3c124}


Definition at line 358 of file T\+C\+P\+\_\+test.\+c.



References oob\+\_\+data\+\_\+callback\+\_\+good, and oob\+\_\+pubkey.



Referenced by oob\+\_\+data\+\_\+handler(), and S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T().


\begin{DoxyCode}
359 \{
360     \textcolor{keywordflow}{if} (\textcolor{keywordtype}{object} != (\textcolor{keywordtype}{void} *)4)
361         \textcolor{keywordflow}{return} 1;
362 
363     \textcolor{keywordflow}{if} (length != 5)
364         \textcolor{keywordflow}{return} 1;
365 
366     \textcolor{keywordflow}{if} (memcmp(\hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, \hyperlink{_t_c_p__test_8c_a17306a75951c9f71ee922cb4e69ff786}{oob\_pubkey}, crypto\_box\_PUBLICKEYBYTES) != 0)
367         \textcolor{keywordflow}{return} 1;
368 
369     \textcolor{keywordflow}{if} (\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[0] == 1 && \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[1] == 2 && \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[2] == 3 && \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[3] == 4 && 
      \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[4] == 5) \{
370         \hyperlink{_t_c_p__test_8c_abca7ecb374ce72cbc9af98ab83209885}{oob\_data\_callback\_good}++;
371         \textcolor{keywordflow}{return} 0;
372     \}
373 
374     \textcolor{keywordflow}{return} 1;
375 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d8d/_t_c_p__test_8c_a7a0dc2152e401dc318c450f172b3c124_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__test_8c_a18769b8a942f1fc9a296f5e807e3b575}{\index{T\+C\+P\+\_\+test.\+c@{T\+C\+P\+\_\+test.\+c}!read\+\_\+packet\+\_\+sec\+\_\+\+T\+C\+P@{read\+\_\+packet\+\_\+sec\+\_\+\+T\+C\+P}}
\index{read\+\_\+packet\+\_\+sec\+\_\+\+T\+C\+P@{read\+\_\+packet\+\_\+sec\+\_\+\+T\+C\+P}!T\+C\+P\+\_\+test.\+c@{T\+C\+P\+\_\+test.\+c}}
\subsubsection[{read\+\_\+packet\+\_\+sec\+\_\+\+T\+C\+P}]{\setlength{\rightskip}{0pt plus 5cm}int read\+\_\+packet\+\_\+sec\+\_\+\+T\+C\+P (
\begin{DoxyParamCaption}
\item[{struct {\bf sec\+\_\+\+T\+C\+P\+\_\+con} $\ast$}]{con, }
\item[{uint8\+\_\+t $\ast$}]{data, }
\item[{uint16\+\_\+t}]{length}
\end{DoxyParamCaption}
)}}\label{_t_c_p__test_8c_a18769b8a942f1fc9a296f5e807e3b575}


Definition at line 202 of file T\+C\+P\+\_\+test.\+c.



References ck\+\_\+assert\+\_\+msg(), decrypt\+\_\+data\+\_\+symmetric(), increment\+\_\+nonce(), sec\+\_\+\+T\+C\+P\+\_\+con\+::recv\+\_\+nonce, sec\+\_\+\+T\+C\+P\+\_\+con\+::shared\+\_\+key, and sec\+\_\+\+T\+C\+P\+\_\+con\+::sock.



Referenced by S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T().


\begin{DoxyCode}
203 \{
204     \textcolor{keywordtype}{int} len;
205     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}((len = recv(con->\hyperlink{structsec___t_c_p__con_a35b19d84fb632ca8ce5cab237f7089a5}{sock}, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}, length, 0)) == length, \textcolor{stringliteral}{"wrong len %i\(\backslash\)n"}
      , len);
206     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}((len = \hyperlink{crypto__core_8c_a824b257fcff74b9d17c5247223fbed29}{decrypt\_data\_symmetric}(con->
      \hyperlink{structsec___t_c_p__con_a81ead9fac55a0cedc30a96253a2c5119}{shared\_key}, con->\hyperlink{structsec___t_c_p__con_aae0467706f97aa3ef23e5dc9c3c199d7}{recv\_nonce}, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} + 2, length - 2, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data})) != -1,
207                   \textcolor{stringliteral}{"Decrypt failed"});
208     \hyperlink{crypto__core_8c_ab953f1e92b8a9a193f69f02323b9c980}{increment\_nonce}(con->\hyperlink{structsec___t_c_p__con_aae0467706f97aa3ef23e5dc9c3c199d7}{recv\_nonce});
209     \textcolor{keywordflow}{return} len;
210 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d8d/_t_c_p__test_8c_a18769b8a942f1fc9a296f5e807e3b575_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=312pt]{d2/d8d/_t_c_p__test_8c_a18769b8a942f1fc9a296f5e807e3b575_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__test_8c_aabbbe757608283acb298ba44b3b01706}{\index{T\+C\+P\+\_\+test.\+c@{T\+C\+P\+\_\+test.\+c}!response\+\_\+callback@{response\+\_\+callback}}
\index{response\+\_\+callback@{response\+\_\+callback}!T\+C\+P\+\_\+test.\+c@{T\+C\+P\+\_\+test.\+c}}
\subsubsection[{response\+\_\+callback}]{\setlength{\rightskip}{0pt plus 5cm}static int response\+\_\+callback (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{object, }
\item[{uint8\+\_\+t}]{connection\+\_\+id, }
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_t_c_p__test_8c_aabbbe757608283acb298ba44b3b01706}


Definition at line 310 of file T\+C\+P\+\_\+test.\+c.



References response\+\_\+callback\+\_\+connection\+\_\+id, response\+\_\+callback\+\_\+good, response\+\_\+callback\+\_\+public\+\_\+key, and set\+\_\+tcp\+\_\+connection\+\_\+number().



Referenced by routing\+\_\+response\+\_\+handler(), and S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T().


\begin{DoxyCode}
311 \{
312     \textcolor{keywordflow}{if} (\hyperlink{_t_c_p__client_8c_a52921fadd1366f32c75e66d9c4340ed2}{set\_tcp\_connection\_number}(\textcolor{keywordtype}{object} - 2, connection\_id, 7) != 0)
313         \textcolor{keywordflow}{return} 1;
314 
315     \hyperlink{_t_c_p__test_8c_a11a7f4760ef556ac61b828cb15ac883d}{response\_callback\_connection\_id} = connection\_id;
316     memcpy(\hyperlink{_t_c_p__test_8c_a9b22a226187b8d0a3d0333c9f12d4518}{response\_callback\_public\_key}, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, 
      crypto\_box\_PUBLICKEYBYTES);
317     \hyperlink{_t_c_p__test_8c_a6cc5f5429af8eac44a61d96130d90892}{response\_callback\_good}++;
318     \textcolor{keywordflow}{return} 0;
319 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=315pt]{d2/d8d/_t_c_p__test_8c_aabbbe757608283acb298ba44b3b01706_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d8d/_t_c_p__test_8c_aabbbe757608283acb298ba44b3b01706_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__test_8c_ad7475d1539db4bb3bcf8673dd7f7cf68}{\index{T\+C\+P\+\_\+test.\+c@{T\+C\+P\+\_\+test.\+c}!S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T@{S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T}}
\index{S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T@{S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T}!T\+C\+P\+\_\+test.\+c@{T\+C\+P\+\_\+test.\+c}}
\subsubsection[{S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T}]{\setlength{\rightskip}{0pt plus 5cm}S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T (
\begin{DoxyParamCaption}
\item[{test\+\_\+basic}]{}
\end{DoxyParamCaption}
)}}\label{_t_c_p__test_8c_ad7475d1539db4bb3bcf8673dd7f7cf68}


Definition at line 30 of file T\+C\+P\+\_\+test.\+c.



References c\+\_\+sleep, ck\+\_\+assert\+\_\+msg(), decrypt\+\_\+data(), decrypt\+\_\+data\+\_\+symmetric(), do\+\_\+\+T\+C\+P\+\_\+server(), encrypt\+\_\+data(), encrypt\+\_\+data\+\_\+symmetric(), encrypt\+\_\+precompute(), i, increment\+\_\+nonce(), kill\+\_\+\+T\+C\+P\+\_\+server(), new\+\_\+nonce(), new\+\_\+\+T\+C\+P\+\_\+server(), T\+C\+P\+\_\+\+Server\+::num\+\_\+listening\+\_\+socks, N\+U\+M\+\_\+\+P\+O\+R\+T\+S, ports, random\+\_\+nonce(), sock, T\+C\+P\+\_\+\+C\+L\+I\+E\+N\+T\+\_\+\+H\+A\+N\+D\+S\+H\+A\+K\+E\+\_\+\+S\+I\+Z\+E, T\+C\+P\+\_\+\+H\+A\+N\+D\+S\+H\+A\+K\+E\+\_\+\+P\+L\+A\+I\+N\+\_\+\+S\+I\+Z\+E, and T\+C\+P\+\_\+\+S\+E\+R\+V\+E\+R\+\_\+\+H\+A\+N\+D\+S\+H\+A\+K\+E\+\_\+\+S\+I\+Z\+E.


\begin{DoxyCode}
31 \{
32     uint8\_t self\_public\_key[crypto\_box\_PUBLICKEYBYTES];
33     uint8\_t self\_secret\_key[crypto\_box\_SECRETKEYBYTES];
34     crypto\_box\_keypair(self\_public\_key, self\_secret\_key);
35     \hyperlink{struct_t_c_p___server}{TCP\_Server} *tcp\_s = \hyperlink{_t_c_p__server_8c_a148e632f4c51645cbc1b414bc3584b60}{new\_TCP\_server}(1, \hyperlink{_t_c_p__test_8c_af89985dbf9e670e3e7baebb0e05a0f46}{NUM\_PORTS}, 
      \hyperlink{_t_c_p__test_8c_a04e5444bf6a826487066ba973577f674}{ports}, self\_secret\_key, NULL);
36     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(tcp\_s != NULL, \textcolor{stringliteral}{"Failed to create TCP relay server"});
37     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(tcp\_s->\hyperlink{struct_t_c_p___server_a5efc50bc21a4b488b17bb593b2758718}{num\_listening\_socks} == 
      \hyperlink{_t_c_p__test_8c_af89985dbf9e670e3e7baebb0e05a0f46}{NUM\_PORTS}, \textcolor{stringliteral}{"Failed to bind to all ports"});
38 
39     \hyperlink{network_8h_ae5faf8a8d23da59c3e3025a62039d8c1}{sock\_t} \hyperlink{irc__syncbot_8c_a5903d0b282fc5eae503de618f896b5e1}{sock} = \hyperlink{namespacesocket}{socket}(AF\_INET6, SOCK\_STREAM, IPPROTO\_TCP);
40     \textcolor{keyword}{struct }sockaddr\_in6 addr6\_loopback = \{0\};
41     addr6\_loopback.sin6\_family = AF\_INET6;
42     addr6\_loopback.sin6\_port = htons(\hyperlink{_t_c_p__test_8c_a04e5444bf6a826487066ba973577f674}{ports}[rand() % \hyperlink{_t_c_p__test_8c_af89985dbf9e670e3e7baebb0e05a0f46}{NUM\_PORTS}]);
43     addr6\_loopback.sin6\_addr = in6addr\_loopback;
44 
45     \textcolor{keywordtype}{int} ret = connect(sock, (\textcolor{keyword}{struct} sockaddr *)&addr6\_loopback, \textcolor{keyword}{sizeof}(addr6\_loopback));
46     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(ret == 0, \textcolor{stringliteral}{"Failed to connect to TCP relay server"});
47 
48     uint8\_t f\_public\_key[crypto\_box\_PUBLICKEYBYTES];
49     uint8\_t f\_secret\_key[crypto\_box\_SECRETKEYBYTES];
50     uint8\_t f\_nonce[crypto\_box\_NONCEBYTES];
51     crypto\_box\_keypair(f\_public\_key, f\_secret\_key);
52     \hyperlink{crypto__core_8c_a15ef255ab026d4881a16b99148b05dd7}{random\_nonce}(f\_nonce);
53 
54     uint8\_t t\_secret\_key[crypto\_box\_SECRETKEYBYTES];
55     uint8\_t handshake\_plain[\hyperlink{_t_c_p__server_8h_a9b820bd1123c0fbdfd8391cce314b35b}{TCP\_HANDSHAKE\_PLAIN\_SIZE}];
56     crypto\_box\_keypair(handshake\_plain, t\_secret\_key);
57     memcpy(handshake\_plain + crypto\_box\_PUBLICKEYBYTES, f\_nonce, crypto\_box\_NONCEBYTES);
58     uint8\_t handshake[\hyperlink{_t_c_p__server_8h_aa5f4778a5c176dbd24018f61cc7524f7}{TCP\_CLIENT\_HANDSHAKE\_SIZE}];
59     memcpy(handshake, f\_public\_key, crypto\_box\_PUBLICKEYBYTES);
60     \hyperlink{crypto__core_8c_a8b1033efb47c625779d11be7d8eb9e24}{new\_nonce}(handshake + crypto\_box\_PUBLICKEYBYTES);
61 
62     ret = \hyperlink{crypto__core_8c_a014149333522d211490304255e139ec3}{encrypt\_data}(self\_public\_key, f\_secret\_key, handshake + crypto\_box\_PUBLICKEYBYTES, 
      handshake\_plain,
63                        \hyperlink{_t_c_p__server_8h_a9b820bd1123c0fbdfd8391cce314b35b}{TCP\_HANDSHAKE\_PLAIN\_SIZE}, handshake + 
      crypto\_box\_PUBLICKEYBYTES + crypto\_box\_NONCEBYTES);
64     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(ret == \hyperlink{_t_c_p__server_8h_aa5f4778a5c176dbd24018f61cc7524f7}{TCP\_CLIENT\_HANDSHAKE\_SIZE} - (
      crypto\_box\_PUBLICKEYBYTES + crypto\_box\_NONCEBYTES),
65                   \textcolor{stringliteral}{"Encrypt failed."});
66     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(send(sock, handshake, \hyperlink{_t_c_p__server_8h_aa5f4778a5c176dbd24018f61cc7524f7}{TCP\_CLIENT\_HANDSHAKE\_SIZE} - 1
      , 0) == \hyperlink{_t_c_p__server_8h_aa5f4778a5c176dbd24018f61cc7524f7}{TCP\_CLIENT\_HANDSHAKE\_SIZE} - 1, \textcolor{stringliteral}{"send Failed."});
67     \hyperlink{_t_c_p__test_8c_a5d21ea3d7da27fbd9f40c59aaa04da62}{c\_sleep}(50);
68     \hyperlink{_t_c_p__server_8c_a40e8a0302a359dd4f712eb1e9c346fe5}{do\_TCP\_server}(tcp\_s);
69     \hyperlink{_t_c_p__test_8c_a5d21ea3d7da27fbd9f40c59aaa04da62}{c\_sleep}(50);
70     \hyperlink{_t_c_p__server_8c_a40e8a0302a359dd4f712eb1e9c346fe5}{do\_TCP\_server}(tcp\_s);
71     \hyperlink{_t_c_p__test_8c_a5d21ea3d7da27fbd9f40c59aaa04da62}{c\_sleep}(50);
72     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(send(sock, handshake + (\hyperlink{_t_c_p__server_8h_aa5f4778a5c176dbd24018f61cc7524f7}{TCP\_CLIENT\_HANDSHAKE\_SIZE} -
       1), 1, 0) == 1, \textcolor{stringliteral}{"send Failed."});
73     \hyperlink{_t_c_p__test_8c_a5d21ea3d7da27fbd9f40c59aaa04da62}{c\_sleep}(50);
74     \hyperlink{_t_c_p__server_8c_a40e8a0302a359dd4f712eb1e9c346fe5}{do\_TCP\_server}(tcp\_s);
75     \hyperlink{_t_c_p__test_8c_a5d21ea3d7da27fbd9f40c59aaa04da62}{c\_sleep}(50);
76     \hyperlink{_t_c_p__server_8c_a40e8a0302a359dd4f712eb1e9c346fe5}{do\_TCP\_server}(tcp\_s);
77     \hyperlink{_t_c_p__test_8c_a5d21ea3d7da27fbd9f40c59aaa04da62}{c\_sleep}(50);
78     uint8\_t response[\hyperlink{_t_c_p__server_8h_a88a61b02e465cd8c05fbae1def1066f2}{TCP\_SERVER\_HANDSHAKE\_SIZE}];
79     uint8\_t response\_plain[\hyperlink{_t_c_p__server_8h_a9b820bd1123c0fbdfd8391cce314b35b}{TCP\_HANDSHAKE\_PLAIN\_SIZE}];
80     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(recv(sock, response, \hyperlink{_t_c_p__server_8h_a88a61b02e465cd8c05fbae1def1066f2}{TCP\_SERVER\_HANDSHAKE\_SIZE}, 0) 
      == \hyperlink{_t_c_p__server_8h_a88a61b02e465cd8c05fbae1def1066f2}{TCP\_SERVER\_HANDSHAKE\_SIZE}, \textcolor{stringliteral}{"recv Failed."});
81     ret = \hyperlink{crypto__core_8c_ab0aff79180f3852c24ad8f6fd88caf18}{decrypt\_data}(self\_public\_key, f\_secret\_key, response, response + 
      crypto\_box\_NONCEBYTES,
82                        \hyperlink{_t_c_p__server_8h_a88a61b02e465cd8c05fbae1def1066f2}{TCP\_SERVER\_HANDSHAKE\_SIZE} - crypto\_box\_NONCEBYTES, 
      response\_plain);
83     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(ret == \hyperlink{_t_c_p__server_8h_a9b820bd1123c0fbdfd8391cce314b35b}{TCP\_HANDSHAKE\_PLAIN\_SIZE}, \textcolor{stringliteral}{"Decrypt Failed."});
84     uint8\_t f\_nonce\_r[crypto\_box\_NONCEBYTES];
85     uint8\_t f\_shared\_key[crypto\_box\_BEFORENMBYTES];
86     \hyperlink{crypto__core_8c_a0d8eaef49981c5dc3ada078866b42f6d}{encrypt\_precompute}(response\_plain, t\_secret\_key, f\_shared\_key);
87     memcpy(f\_nonce\_r, response\_plain + crypto\_box\_BEFORENMBYTES, crypto\_box\_NONCEBYTES);
88 
89     uint8\_t r\_req\_p[1 + crypto\_box\_PUBLICKEYBYTES] = \{0\};
90     memcpy(r\_req\_p + 1, f\_public\_key, crypto\_box\_PUBLICKEYBYTES);
91     uint8\_t r\_req[2 + 1 + crypto\_box\_PUBLICKEYBYTES + crypto\_box\_MACBYTES];
92     uint16\_t size = 1 + crypto\_box\_PUBLICKEYBYTES + crypto\_box\_MACBYTES;
93     size = htons(size);
94     ret = \hyperlink{crypto__core_8c_a81efc0a4a6e0efe372651e26e342a6e5}{encrypt\_data\_symmetric}(f\_shared\_key, f\_nonce, r\_req\_p, 1 + 
      crypto\_box\_PUBLICKEYBYTES, r\_req + 2);
95     \hyperlink{crypto__core_8c_ab953f1e92b8a9a193f69f02323b9c980}{increment\_nonce}(f\_nonce);
96     memcpy(r\_req, &size, 2);
97     uint32\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
98 
99     \textcolor{keywordflow}{for} (i = 0; i < \textcolor{keyword}{sizeof}(r\_req); ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
100         \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(send(sock, r\_req + i, 1, 0) == 1, \textcolor{stringliteral}{"send Failed."});
101         \textcolor{comment}{//ck\_assert\_msg(send(sock, r\_req, sizeof(r\_req), 0) == sizeof(r\_req), "send Failed.");}
102         \hyperlink{_t_c_p__server_8c_a40e8a0302a359dd4f712eb1e9c346fe5}{do\_TCP\_server}(tcp\_s);
103         \hyperlink{_t_c_p__test_8c_a5d21ea3d7da27fbd9f40c59aaa04da62}{c\_sleep}(50);
104     \}
105 
106     \hyperlink{_t_c_p__server_8c_a40e8a0302a359dd4f712eb1e9c346fe5}{do\_TCP\_server}(tcp\_s);
107     \hyperlink{_t_c_p__test_8c_a5d21ea3d7da27fbd9f40c59aaa04da62}{c\_sleep}(50);
108     uint8\_t packet\_resp[4096];
109     \textcolor{keywordtype}{int} recv\_data\_len;
110     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}((recv\_data\_len = recv(sock, packet\_resp, 2 + 2 + crypto\_box\_PUBLICKEYBYTES +
       crypto\_box\_MACBYTES,
111                                         0)) == 2 + 2 + crypto\_box\_PUBLICKEYBYTES + crypto\_box\_MACBYTES, \textcolor{stringliteral}{"
      recv Failed. %u"}, recv\_data\_len);
112     memcpy(&size, packet\_resp, 2);
113     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(ntohs(size) == 2 + crypto\_box\_PUBLICKEYBYTES + crypto\_box\_MACBYTES, \textcolor{stringliteral}{"Wrong
       packet size."});
114     uint8\_t packet\_resp\_plain[4096];
115     ret = \hyperlink{crypto__core_8c_a824b257fcff74b9d17c5247223fbed29}{decrypt\_data\_symmetric}(f\_shared\_key, f\_nonce\_r, packet\_resp + 2, 
      recv\_data\_len - 2, packet\_resp\_plain);
116     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(ret != -1, \textcolor{stringliteral}{"decryption failed"});
117     \hyperlink{crypto__core_8c_ab953f1e92b8a9a193f69f02323b9c980}{increment\_nonce}(f\_nonce\_r);
118     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(packet\_resp\_plain[0] == 1, \textcolor{stringliteral}{"wrong packet id %u"}, packet\_resp\_plain[0]);
119     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(packet\_resp\_plain[1] == 0, \textcolor{stringliteral}{"connection not refused %u"}, packet\_resp\_plain[1]
      );
120     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(memcmp(packet\_resp\_plain + 2, f\_public\_key, crypto\_box\_PUBLICKEYBYTES) == 0,
       \textcolor{stringliteral}{"key in packet wrong"});
121     \hyperlink{_t_c_p__server_8c_af6df6382ad309456dcf5b7b350313714}{kill\_TCP\_server}(tcp\_s);
122 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d8d/_t_c_p__test_8c_ad7475d1539db4bb3bcf8673dd7f7cf68_cgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__test_8c_a0ee98d716eb7311dd4b6d217289734ff}{\index{T\+C\+P\+\_\+test.\+c@{T\+C\+P\+\_\+test.\+c}!S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T@{S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T}}
\index{S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T@{S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T}!T\+C\+P\+\_\+test.\+c@{T\+C\+P\+\_\+test.\+c}}
\subsubsection[{S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T}]{\setlength{\rightskip}{0pt plus 5cm}S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T (
\begin{DoxyParamCaption}
\item[{test\+\_\+some}]{}
\end{DoxyParamCaption}
)}}\label{_t_c_p__test_8c_a0ee98d716eb7311dd4b6d217289734ff}


Definition at line 212 of file T\+C\+P\+\_\+test.\+c.



References c\+\_\+sleep, ck\+\_\+assert\+\_\+msg(), make-\/funny-\/savefile\+::data, do\+\_\+\+T\+C\+P\+\_\+server(), kill\+\_\+\+T\+C\+P\+\_\+con(), kill\+\_\+\+T\+C\+P\+\_\+server(), new\+\_\+\+T\+C\+P\+\_\+con(), new\+\_\+\+T\+C\+P\+\_\+server(), T\+C\+P\+\_\+\+Server\+::num\+\_\+listening\+\_\+socks, N\+U\+M\+\_\+\+P\+O\+R\+T\+S, ports, sec\+\_\+\+T\+C\+P\+\_\+con\+::public\+\_\+key, read\+\_\+packet\+\_\+sec\+\_\+\+T\+C\+P(), and write\+\_\+packet\+\_\+\+T\+C\+P\+\_\+secure\+\_\+connection().


\begin{DoxyCode}
213 \{
214     uint8\_t self\_public\_key[crypto\_box\_PUBLICKEYBYTES];
215     uint8\_t self\_secret\_key[crypto\_box\_SECRETKEYBYTES];
216     crypto\_box\_keypair(self\_public\_key, self\_secret\_key);
217     \hyperlink{struct_t_c_p___server}{TCP\_Server} *tcp\_s = \hyperlink{_t_c_p__server_8c_a148e632f4c51645cbc1b414bc3584b60}{new\_TCP\_server}(1, \hyperlink{_t_c_p__test_8c_af89985dbf9e670e3e7baebb0e05a0f46}{NUM\_PORTS}, 
      \hyperlink{_t_c_p__test_8c_a04e5444bf6a826487066ba973577f674}{ports}, self\_secret\_key, NULL);
218     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(tcp\_s != NULL, \textcolor{stringliteral}{"Failed to create TCP relay server"});
219     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(tcp\_s->\hyperlink{struct_t_c_p___server_a5efc50bc21a4b488b17bb593b2758718}{num\_listening\_socks} == 
      \hyperlink{_t_c_p__test_8c_af89985dbf9e670e3e7baebb0e05a0f46}{NUM\_PORTS}, \textcolor{stringliteral}{"Failed to bind to all ports"});
220 
221     \textcolor{keyword}{struct }\hyperlink{structsec___t_c_p__con}{sec\_TCP\_con} *con1 = \hyperlink{_t_c_p__test_8c_a8958ca530ce6534e81eaa06e582a26ad}{new\_TCP\_con}(tcp\_s);
222     \textcolor{keyword}{struct }\hyperlink{structsec___t_c_p__con}{sec\_TCP\_con} *con2 = \hyperlink{_t_c_p__test_8c_a8958ca530ce6534e81eaa06e582a26ad}{new\_TCP\_con}(tcp\_s);
223     \textcolor{keyword}{struct }\hyperlink{structsec___t_c_p__con}{sec\_TCP\_con} *con3 = \hyperlink{_t_c_p__test_8c_a8958ca530ce6534e81eaa06e582a26ad}{new\_TCP\_con}(tcp\_s);
224 
225     uint8\_t requ\_p[1 + crypto\_box\_PUBLICKEYBYTES];
226     requ\_p[0] = 0;
227     memcpy(requ\_p + 1, con3->\hyperlink{structsec___t_c_p__con_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, crypto\_box\_PUBLICKEYBYTES);
228     \hyperlink{_t_c_p__test_8c_aa54773b9420df5d5d443bc0cfcec1784}{write\_packet\_TCP\_secure\_connection}(con1, requ\_p, \textcolor{keyword}{sizeof}(requ\_p));
229     memcpy(requ\_p + 1, con1->\hyperlink{structsec___t_c_p__con_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, crypto\_box\_PUBLICKEYBYTES);
230     \hyperlink{_t_c_p__test_8c_aa54773b9420df5d5d443bc0cfcec1784}{write\_packet\_TCP\_secure\_connection}(con3, requ\_p, \textcolor{keyword}{sizeof}(requ\_p));
231     \hyperlink{_t_c_p__server_8c_a40e8a0302a359dd4f712eb1e9c346fe5}{do\_TCP\_server}(tcp\_s);
232     \hyperlink{_t_c_p__test_8c_a5d21ea3d7da27fbd9f40c59aaa04da62}{c\_sleep}(50);
233     uint8\_t \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[2048];
234     \textcolor{keywordtype}{int} len = \hyperlink{_t_c_p__test_8c_a18769b8a942f1fc9a296f5e807e3b575}{read\_packet\_sec\_TCP}(con1, data, 2 + 1 + 1 + crypto\_box\_PUBLICKEYBYTES + 
      crypto\_box\_MACBYTES);
235     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(len == 1 + 1 + crypto\_box\_PUBLICKEYBYTES, \textcolor{stringliteral}{"wrong len %u"}, len);
236     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(data[0] == 1, \textcolor{stringliteral}{"wrong packet id %u"}, data[0]);
237     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(data[1] == 16, \textcolor{stringliteral}{"connection not refused %u"}, data[1]);
238     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(memcmp(data + 2, con3->\hyperlink{structsec___t_c_p__con_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, crypto\_box\_PUBLICKEYBYTES) == 0
      , \textcolor{stringliteral}{"key in packet wrong"});
239     len = \hyperlink{_t_c_p__test_8c_a18769b8a942f1fc9a296f5e807e3b575}{read\_packet\_sec\_TCP}(con3, data, 2 + 1 + 1 + crypto\_box\_PUBLICKEYBYTES + 
      crypto\_box\_MACBYTES);
240     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(len == 1 + 1 + crypto\_box\_PUBLICKEYBYTES, \textcolor{stringliteral}{"wrong len %u"}, len);
241     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(data[0] == 1, \textcolor{stringliteral}{"wrong packet id %u"}, data[0]);
242     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(data[1] == 16, \textcolor{stringliteral}{"connection not refused %u"}, data[1]);
243     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(memcmp(data + 2, con1->\hyperlink{structsec___t_c_p__con_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, crypto\_box\_PUBLICKEYBYTES) == 0
      , \textcolor{stringliteral}{"key in packet wrong"});
244 
245     uint8\_t test\_packet[512] = \{16, 17, 16, 86, 99, 127, 255, 189, 78\};
246     \hyperlink{_t_c_p__test_8c_aa54773b9420df5d5d443bc0cfcec1784}{write\_packet\_TCP\_secure\_connection}(con3, test\_packet, \textcolor{keyword}{sizeof}(
      test\_packet));
247     \hyperlink{_t_c_p__test_8c_aa54773b9420df5d5d443bc0cfcec1784}{write\_packet\_TCP\_secure\_connection}(con3, test\_packet, \textcolor{keyword}{sizeof}(
      test\_packet));
248     \hyperlink{_t_c_p__test_8c_aa54773b9420df5d5d443bc0cfcec1784}{write\_packet\_TCP\_secure\_connection}(con3, test\_packet, \textcolor{keyword}{sizeof}(
      test\_packet));
249     \hyperlink{_t_c_p__test_8c_a5d21ea3d7da27fbd9f40c59aaa04da62}{c\_sleep}(50);
250     \hyperlink{_t_c_p__server_8c_a40e8a0302a359dd4f712eb1e9c346fe5}{do\_TCP\_server}(tcp\_s);
251     \hyperlink{_t_c_p__test_8c_a5d21ea3d7da27fbd9f40c59aaa04da62}{c\_sleep}(50);
252     len = \hyperlink{_t_c_p__test_8c_a18769b8a942f1fc9a296f5e807e3b575}{read\_packet\_sec\_TCP}(con1, data, 2 + 2 + crypto\_box\_MACBYTES);
253     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(len == 2, \textcolor{stringliteral}{"wrong len %u"}, len);
254     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(data[0] == 2, \textcolor{stringliteral}{"wrong packet id %u"}, data[0]);
255     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(data[1] == 16, \textcolor{stringliteral}{"wrong peer id %u"}, data[1]);
256     len = \hyperlink{_t_c_p__test_8c_a18769b8a942f1fc9a296f5e807e3b575}{read\_packet\_sec\_TCP}(con3, data, 2 + 2 + crypto\_box\_MACBYTES);
257     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(len == 2, \textcolor{stringliteral}{"wrong len %u"}, len);
258     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(data[0] == 2, \textcolor{stringliteral}{"wrong packet id %u"}, data[0]);
259     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(data[1] == 16, \textcolor{stringliteral}{"wrong peer id %u"}, data[1]);
260     len = \hyperlink{_t_c_p__test_8c_a18769b8a942f1fc9a296f5e807e3b575}{read\_packet\_sec\_TCP}(con1, data, 2 + \textcolor{keyword}{sizeof}(test\_packet) + crypto\_box\_MACBYTES)
      ;
261     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(len == \textcolor{keyword}{sizeof}(test\_packet), \textcolor{stringliteral}{"wrong len %u"}, len);
262     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(memcmp(data, test\_packet, \textcolor{keyword}{sizeof}(test\_packet)) == 0, \textcolor{stringliteral}{"packet is wrong %u %u
       %u %u"}, data[0], data[1],
263                   data[\textcolor{keyword}{sizeof}(test\_packet) - 2], data[\textcolor{keyword}{sizeof}(test\_packet) - 1]);
264     len = \hyperlink{_t_c_p__test_8c_a18769b8a942f1fc9a296f5e807e3b575}{read\_packet\_sec\_TCP}(con1, data, 2 + \textcolor{keyword}{sizeof}(test\_packet) + crypto\_box\_MACBYTES)
      ;
265     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(len == \textcolor{keyword}{sizeof}(test\_packet), \textcolor{stringliteral}{"wrong len %u"}, len);
266     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(memcmp(data, test\_packet, \textcolor{keyword}{sizeof}(test\_packet)) == 0, \textcolor{stringliteral}{"packet is wrong %u %u
       %u %u"}, data[0], data[1],
267                   data[\textcolor{keyword}{sizeof}(test\_packet) - 2], data[\textcolor{keyword}{sizeof}(test\_packet) - 1]);
268     len = \hyperlink{_t_c_p__test_8c_a18769b8a942f1fc9a296f5e807e3b575}{read\_packet\_sec\_TCP}(con1, data, 2 + \textcolor{keyword}{sizeof}(test\_packet) + crypto\_box\_MACBYTES)
      ;
269     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(len == \textcolor{keyword}{sizeof}(test\_packet), \textcolor{stringliteral}{"wrong len %u"}, len);
270     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(memcmp(data, test\_packet, \textcolor{keyword}{sizeof}(test\_packet)) == 0, \textcolor{stringliteral}{"packet is wrong %u %u
       %u %u"}, data[0], data[1],
271                   data[\textcolor{keyword}{sizeof}(test\_packet) - 2], data[\textcolor{keyword}{sizeof}(test\_packet) - 1]);
272     \hyperlink{_t_c_p__test_8c_aa54773b9420df5d5d443bc0cfcec1784}{write\_packet\_TCP\_secure\_connection}(con1, test\_packet, \textcolor{keyword}{sizeof}(
      test\_packet));
273     \hyperlink{_t_c_p__test_8c_aa54773b9420df5d5d443bc0cfcec1784}{write\_packet\_TCP\_secure\_connection}(con1, test\_packet, \textcolor{keyword}{sizeof}(
      test\_packet));
274     \hyperlink{_t_c_p__test_8c_aa54773b9420df5d5d443bc0cfcec1784}{write\_packet\_TCP\_secure\_connection}(con1, test\_packet, \textcolor{keyword}{sizeof}(
      test\_packet));
275     \hyperlink{_t_c_p__test_8c_a5d21ea3d7da27fbd9f40c59aaa04da62}{c\_sleep}(50);
276     \hyperlink{_t_c_p__server_8c_a40e8a0302a359dd4f712eb1e9c346fe5}{do\_TCP\_server}(tcp\_s);
277     \hyperlink{_t_c_p__test_8c_a5d21ea3d7da27fbd9f40c59aaa04da62}{c\_sleep}(50);
278     len = \hyperlink{_t_c_p__test_8c_a18769b8a942f1fc9a296f5e807e3b575}{read\_packet\_sec\_TCP}(con3, data, 2 + \textcolor{keyword}{sizeof}(test\_packet) + crypto\_box\_MACBYTES)
      ;
279     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(len == \textcolor{keyword}{sizeof}(test\_packet), \textcolor{stringliteral}{"wrong len %u"}, len);
280     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(memcmp(data, test\_packet, \textcolor{keyword}{sizeof}(test\_packet)) == 0, \textcolor{stringliteral}{"packet is wrong %u %u
       %u %u"}, data[0], data[1],
281                   data[\textcolor{keyword}{sizeof}(test\_packet) - 2], data[\textcolor{keyword}{sizeof}(test\_packet) - 1]);
282     len = \hyperlink{_t_c_p__test_8c_a18769b8a942f1fc9a296f5e807e3b575}{read\_packet\_sec\_TCP}(con3, data, 2 + \textcolor{keyword}{sizeof}(test\_packet) + crypto\_box\_MACBYTES)
      ;
283     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(len == \textcolor{keyword}{sizeof}(test\_packet), \textcolor{stringliteral}{"wrong len %u"}, len);
284     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(memcmp(data, test\_packet, \textcolor{keyword}{sizeof}(test\_packet)) == 0, \textcolor{stringliteral}{"packet is wrong %u %u
       %u %u"}, data[0], data[1],
285                   data[\textcolor{keyword}{sizeof}(test\_packet) - 2], data[\textcolor{keyword}{sizeof}(test\_packet) - 1]);
286     len = \hyperlink{_t_c_p__test_8c_a18769b8a942f1fc9a296f5e807e3b575}{read\_packet\_sec\_TCP}(con3, data, 2 + \textcolor{keyword}{sizeof}(test\_packet) + crypto\_box\_MACBYTES)
      ;
287     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(len == \textcolor{keyword}{sizeof}(test\_packet), \textcolor{stringliteral}{"wrong len %u"}, len);
288     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(memcmp(data, test\_packet, \textcolor{keyword}{sizeof}(test\_packet)) == 0, \textcolor{stringliteral}{"packet is wrong %u %u
       %u %u"}, data[0], data[1],
289                   data[\textcolor{keyword}{sizeof}(test\_packet) - 2], data[\textcolor{keyword}{sizeof}(test\_packet) - 1]);
290 
291     uint8\_t ping\_packet[1 + \textcolor{keyword}{sizeof}(uint64\_t)] = \{4, 8, 6, 9, 67\};
292     \hyperlink{_t_c_p__test_8c_aa54773b9420df5d5d443bc0cfcec1784}{write\_packet\_TCP\_secure\_connection}(con1, ping\_packet, \textcolor{keyword}{sizeof}(
      ping\_packet));
293     \hyperlink{_t_c_p__test_8c_a5d21ea3d7da27fbd9f40c59aaa04da62}{c\_sleep}(50);
294     \hyperlink{_t_c_p__server_8c_a40e8a0302a359dd4f712eb1e9c346fe5}{do\_TCP\_server}(tcp\_s);
295     \hyperlink{_t_c_p__test_8c_a5d21ea3d7da27fbd9f40c59aaa04da62}{c\_sleep}(50);
296     len = \hyperlink{_t_c_p__test_8c_a18769b8a942f1fc9a296f5e807e3b575}{read\_packet\_sec\_TCP}(con1, data, 2 + \textcolor{keyword}{sizeof}(ping\_packet) + crypto\_box\_MACBYTES)
      ;
297     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(len == \textcolor{keyword}{sizeof}(ping\_packet), \textcolor{stringliteral}{"wrong len %u"}, len);
298     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(data[0] == 5, \textcolor{stringliteral}{"wrong packet id %u"}, data[0]);
299     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(memcmp(ping\_packet + 1, data + 1, \textcolor{keyword}{sizeof}(uint64\_t)) == 0, \textcolor{stringliteral}{"wrong packet data
      "});
300     \hyperlink{_t_c_p__server_8c_af6df6382ad309456dcf5b7b350313714}{kill\_TCP\_server}(tcp\_s);
301     \hyperlink{_t_c_p__test_8c_a45b16f4a525767c13ad26ad71c7045f2}{kill\_TCP\_con}(con1);
302     \hyperlink{_t_c_p__test_8c_a45b16f4a525767c13ad26ad71c7045f2}{kill\_TCP\_con}(con2);
303     \hyperlink{_t_c_p__test_8c_a45b16f4a525767c13ad26ad71c7045f2}{kill\_TCP\_con}(con3);
304 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d8d/_t_c_p__test_8c_a0ee98d716eb7311dd4b6d217289734ff_cgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__test_8c_a54051584eff6e81044025b36d88c9a2b}{\index{T\+C\+P\+\_\+test.\+c@{T\+C\+P\+\_\+test.\+c}!S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T@{S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T}}
\index{S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T@{S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T}!T\+C\+P\+\_\+test.\+c@{T\+C\+P\+\_\+test.\+c}}
\subsubsection[{S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T}]{\setlength{\rightskip}{0pt plus 5cm}S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T (
\begin{DoxyParamCaption}
\item[{test\+\_\+client}]{}
\end{DoxyParamCaption}
)}}\label{_t_c_p__test_8c_a54051584eff6e81044025b36d88c9a2b}


Definition at line 377 of file T\+C\+P\+\_\+test.\+c.



References c\+\_\+sleep, ck\+\_\+assert\+\_\+msg(), make-\/funny-\/savefile\+::data, data\+\_\+callback(), data\+\_\+callback\+\_\+good, do\+\_\+\+T\+C\+P\+\_\+connection(), do\+\_\+\+T\+C\+P\+\_\+server(), I\+P\+::family, I\+P6\+::in6\+\_\+addr, I\+P\+\_\+\+Port\+::ip, I\+P\+::ip6, kill\+\_\+\+T\+C\+P\+\_\+connection(), kill\+\_\+\+T\+C\+P\+\_\+server(), new\+\_\+\+T\+C\+P\+\_\+connection(), new\+\_\+\+T\+C\+P\+\_\+server(), T\+C\+P\+\_\+\+Server\+::num\+\_\+listening\+\_\+socks, N\+U\+M\+\_\+\+P\+O\+R\+T\+S, oob\+\_\+data\+\_\+callback(), oob\+\_\+data\+\_\+callback\+\_\+good, oob\+\_\+data\+\_\+handler(), oob\+\_\+pubkey, I\+P\+\_\+\+Port\+::port, ports, response\+\_\+callback(), response\+\_\+callback\+\_\+connection\+\_\+id, response\+\_\+callback\+\_\+good, response\+\_\+callback\+\_\+public\+\_\+key, routing\+\_\+data\+\_\+handler(), routing\+\_\+response\+\_\+handler(), routing\+\_\+status\+\_\+handler(), send\+\_\+data(), send\+\_\+disconnect\+\_\+request(), send\+\_\+oob\+\_\+packet(), send\+\_\+routing\+\_\+request(), T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::status, status\+\_\+callback(), status\+\_\+callback\+\_\+connection\+\_\+id, status\+\_\+callback\+\_\+good, status\+\_\+callback\+\_\+status, T\+C\+P\+\_\+\+C\+L\+I\+E\+N\+T\+\_\+\+C\+O\+N\+F\+I\+R\+M\+E\+D, T\+C\+P\+\_\+\+C\+L\+I\+E\+N\+T\+\_\+\+U\+N\+C\+O\+N\+F\+I\+R\+M\+E\+D, and unix\+\_\+time\+\_\+update().


\begin{DoxyCode}
378 \{
379     \hyperlink{util_8c_a849af10dd491723cf3abdef599846897}{unix\_time\_update}();
380     uint8\_t self\_public\_key[crypto\_box\_PUBLICKEYBYTES];
381     uint8\_t self\_secret\_key[crypto\_box\_SECRETKEYBYTES];
382     crypto\_box\_keypair(self\_public\_key, self\_secret\_key);
383     \hyperlink{struct_t_c_p___server}{TCP\_Server} *tcp\_s = \hyperlink{_t_c_p__server_8c_a148e632f4c51645cbc1b414bc3584b60}{new\_TCP\_server}(1, \hyperlink{_t_c_p__test_8c_af89985dbf9e670e3e7baebb0e05a0f46}{NUM\_PORTS}, 
      \hyperlink{_t_c_p__test_8c_a04e5444bf6a826487066ba973577f674}{ports}, self\_secret\_key, NULL);
384     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(tcp\_s != NULL, \textcolor{stringliteral}{"Failed to create TCP relay server"});
385     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(tcp\_s->\hyperlink{struct_t_c_p___server_a5efc50bc21a4b488b17bb593b2758718}{num\_listening\_socks} == 
      \hyperlink{_t_c_p__test_8c_af89985dbf9e670e3e7baebb0e05a0f46}{NUM\_PORTS}, \textcolor{stringliteral}{"Failed to bind to all ports"});
386 
387     uint8\_t f\_public\_key[crypto\_box\_PUBLICKEYBYTES];
388     uint8\_t f\_secret\_key[crypto\_box\_SECRETKEYBYTES];
389     crypto\_box\_keypair(f\_public\_key, f\_secret\_key);
390     \hyperlink{struct_i_p___port}{IP\_Port} ip\_port\_tcp\_s;
391 
392     ip\_port\_tcp\_s.\hyperlink{struct_i_p___port_a8e0798404bf2cf5dabb84c5ba9a4f236}{port} = htons(\hyperlink{_t_c_p__test_8c_a04e5444bf6a826487066ba973577f674}{ports}[rand() % \hyperlink{_t_c_p__test_8c_af89985dbf9e670e3e7baebb0e05a0f46}{NUM\_PORTS}]);
393     ip\_port\_tcp\_s.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} = AF\_INET6;
394     ip\_port\_tcp\_s.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_a14c606eb5ffb078c38ad854dc4e79507}{ip6}.\hyperlink{union_i_p6_ac312c20ade57f180c50585e9ea42314c}{in6\_addr} = in6addr\_loopback;
395     \hyperlink{struct_t_c_p___client___connection}{TCP\_Client\_Connection} *conn = \hyperlink{_t_c_p__client_8c_aedb0d5c54ac7754bb342517247ac632d}{new\_TCP\_connection}(ip\_port\_tcp\_s, 
      self\_public\_key, f\_public\_key, f\_secret\_key, 0);
396     \hyperlink{_t_c_p__test_8c_a5d21ea3d7da27fbd9f40c59aaa04da62}{c\_sleep}(50);
397     \hyperlink{_t_c_p__client_8c_a3333858c51935f9f546cf923b07ed845}{do\_TCP\_connection}(conn);
398     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(conn->\hyperlink{struct_t_c_p___client___connection_ade818037fd6c985038ff29656089758d}{status} == \hyperlink{_t_c_p__client_8h_ae4d5251432e1a9e6803c0240cc492e18a1d498784503bcb95d53252e4fee9ef31}{TCP\_CLIENT\_UNCONFIRMED}, \textcolor{stringliteral}{"Wrong
       status. Expected: %u, is: %u"}, \hyperlink{_t_c_p__client_8h_ae4d5251432e1a9e6803c0240cc492e18a1d498784503bcb95d53252e4fee9ef31}{TCP\_CLIENT\_UNCONFIRMED},
399                   conn->\hyperlink{struct_t_c_p___client___connection_ade818037fd6c985038ff29656089758d}{status});
400     \hyperlink{_t_c_p__test_8c_a5d21ea3d7da27fbd9f40c59aaa04da62}{c\_sleep}(50);
401     \hyperlink{_t_c_p__server_8c_a40e8a0302a359dd4f712eb1e9c346fe5}{do\_TCP\_server}(tcp\_s);
402     \hyperlink{_t_c_p__test_8c_a5d21ea3d7da27fbd9f40c59aaa04da62}{c\_sleep}(50);
403     \hyperlink{_t_c_p__client_8c_a3333858c51935f9f546cf923b07ed845}{do\_TCP\_connection}(conn);
404     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(conn->\hyperlink{struct_t_c_p___client___connection_ade818037fd6c985038ff29656089758d}{status} == \hyperlink{_t_c_p__client_8h_ae4d5251432e1a9e6803c0240cc492e18a5751b9ce4d04cb2496f4eeec142ddaf1}{TCP\_CLIENT\_CONFIRMED}, \textcolor{stringliteral}{"Wrong
       status. Expected: %u, is: %u"}, \hyperlink{_t_c_p__client_8h_ae4d5251432e1a9e6803c0240cc492e18a5751b9ce4d04cb2496f4eeec142ddaf1}{TCP\_CLIENT\_CONFIRMED},
405                   conn->\hyperlink{struct_t_c_p___client___connection_ade818037fd6c985038ff29656089758d}{status});
406     \hyperlink{_t_c_p__test_8c_a5d21ea3d7da27fbd9f40c59aaa04da62}{c\_sleep}(500);
407     \hyperlink{_t_c_p__client_8c_a3333858c51935f9f546cf923b07ed845}{do\_TCP\_connection}(conn);
408     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(conn->\hyperlink{struct_t_c_p___client___connection_ade818037fd6c985038ff29656089758d}{status} == \hyperlink{_t_c_p__client_8h_ae4d5251432e1a9e6803c0240cc492e18a5751b9ce4d04cb2496f4eeec142ddaf1}{TCP\_CLIENT\_CONFIRMED}, \textcolor{stringliteral}{"Wrong
       status. Expected: %u, is: %u"}, \hyperlink{_t_c_p__client_8h_ae4d5251432e1a9e6803c0240cc492e18a5751b9ce4d04cb2496f4eeec142ddaf1}{TCP\_CLIENT\_CONFIRMED},
409                   conn->\hyperlink{struct_t_c_p___client___connection_ade818037fd6c985038ff29656089758d}{status});
410     \hyperlink{_t_c_p__test_8c_a5d21ea3d7da27fbd9f40c59aaa04da62}{c\_sleep}(500);
411     \hyperlink{_t_c_p__client_8c_a3333858c51935f9f546cf923b07ed845}{do\_TCP\_connection}(conn);
412     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(conn->\hyperlink{struct_t_c_p___client___connection_ade818037fd6c985038ff29656089758d}{status} == \hyperlink{_t_c_p__client_8h_ae4d5251432e1a9e6803c0240cc492e18a5751b9ce4d04cb2496f4eeec142ddaf1}{TCP\_CLIENT\_CONFIRMED}, \textcolor{stringliteral}{"Wrong
       status. Expected: %u, is: %u"}, \hyperlink{_t_c_p__client_8h_ae4d5251432e1a9e6803c0240cc492e18a5751b9ce4d04cb2496f4eeec142ddaf1}{TCP\_CLIENT\_CONFIRMED},
413                   conn->\hyperlink{struct_t_c_p___client___connection_ade818037fd6c985038ff29656089758d}{status});
414     \hyperlink{_t_c_p__server_8c_a40e8a0302a359dd4f712eb1e9c346fe5}{do\_TCP\_server}(tcp\_s);
415     \hyperlink{_t_c_p__test_8c_a5d21ea3d7da27fbd9f40c59aaa04da62}{c\_sleep}(50);
416     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(conn->\hyperlink{struct_t_c_p___client___connection_ade818037fd6c985038ff29656089758d}{status} == \hyperlink{_t_c_p__client_8h_ae4d5251432e1a9e6803c0240cc492e18a5751b9ce4d04cb2496f4eeec142ddaf1}{TCP\_CLIENT\_CONFIRMED}, \textcolor{stringliteral}{"Wrong
       status. Expected: %u, is: %u"}, \hyperlink{_t_c_p__client_8h_ae4d5251432e1a9e6803c0240cc492e18a5751b9ce4d04cb2496f4eeec142ddaf1}{TCP\_CLIENT\_CONFIRMED},
417                   conn->\hyperlink{struct_t_c_p___client___connection_ade818037fd6c985038ff29656089758d}{status});
418 
419     uint8\_t f2\_public\_key[crypto\_box\_PUBLICKEYBYTES];
420     uint8\_t f2\_secret\_key[crypto\_box\_SECRETKEYBYTES];
421     crypto\_box\_keypair(f2\_public\_key, f2\_secret\_key);
422     ip\_port\_tcp\_s.\hyperlink{struct_i_p___port_a8e0798404bf2cf5dabb84c5ba9a4f236}{port} = htons(\hyperlink{_t_c_p__test_8c_a04e5444bf6a826487066ba973577f674}{ports}[rand() % \hyperlink{_t_c_p__test_8c_af89985dbf9e670e3e7baebb0e05a0f46}{NUM\_PORTS}]);
423     \hyperlink{struct_t_c_p___client___connection}{TCP\_Client\_Connection} *conn2 = \hyperlink{_t_c_p__client_8c_aedb0d5c54ac7754bb342517247ac632d}{new\_TCP\_connection}(ip\_port\_tcp\_s,
       self\_public\_key, f2\_public\_key, f2\_secret\_key, 0);
424     \hyperlink{_t_c_p__client_8c_ac795068d9a0ba7b00db3db7bb5e217a7}{routing\_response\_handler}(conn, \hyperlink{_t_c_p__test_8c_aabbbe757608283acb298ba44b3b01706}{response\_callback}, ((\textcolor{keywordtype}{void} *)
      conn) + 2);
425     \hyperlink{_t_c_p__client_8c_a263bc470c2cc015cbb0f975ab5632eb8}{routing\_status\_handler}(conn, \hyperlink{_t_c_p__test_8c_ae4f12b6805a17277d33e73ac030d7aca}{status\_callback}, (\textcolor{keywordtype}{void} *)2);
426     \hyperlink{_t_c_p__client_8c_ab913946e478e2ead06cb9eccb7b7249b}{routing\_data\_handler}(conn, \hyperlink{_t_c_p__test_8c_a36ed22ce4a6bec3fb113a4eaf29df5e1}{data\_callback}, (\textcolor{keywordtype}{void} *)3);
427     \hyperlink{_t_c_p__client_8c_a34d78d05e93ac72b24092da391b05aa8}{oob\_data\_handler}(conn, \hyperlink{_t_c_p__test_8c_a7a0dc2152e401dc318c450f172b3c124}{oob\_data\_callback}, (\textcolor{keywordtype}{void} *)4);
428     \hyperlink{_t_c_p__test_8c_abca7ecb374ce72cbc9af98ab83209885}{oob\_data\_callback\_good} = \hyperlink{_t_c_p__test_8c_a6cc5f5429af8eac44a61d96130d90892}{response\_callback\_good} = 
      \hyperlink{_t_c_p__test_8c_a56f484ef0812f6fe7d948f2546fed8d0}{status\_callback\_good} = \hyperlink{_t_c_p__test_8c_ad6e4db92d778379939f9bc01b517a0b2}{data\_callback\_good} = 0;
429     \hyperlink{_t_c_p__test_8c_a5d21ea3d7da27fbd9f40c59aaa04da62}{c\_sleep}(50);
430     \hyperlink{_t_c_p__client_8c_a3333858c51935f9f546cf923b07ed845}{do\_TCP\_connection}(conn);
431     \hyperlink{_t_c_p__client_8c_a3333858c51935f9f546cf923b07ed845}{do\_TCP\_connection}(conn2);
432     \hyperlink{_t_c_p__test_8c_a5d21ea3d7da27fbd9f40c59aaa04da62}{c\_sleep}(50);
433     \hyperlink{_t_c_p__server_8c_a40e8a0302a359dd4f712eb1e9c346fe5}{do\_TCP\_server}(tcp\_s);
434     \hyperlink{_t_c_p__test_8c_a5d21ea3d7da27fbd9f40c59aaa04da62}{c\_sleep}(50);
435     \hyperlink{_t_c_p__client_8c_a3333858c51935f9f546cf923b07ed845}{do\_TCP\_connection}(conn);
436     \hyperlink{_t_c_p__client_8c_a3333858c51935f9f546cf923b07ed845}{do\_TCP\_connection}(conn2);
437     \hyperlink{_t_c_p__test_8c_a5d21ea3d7da27fbd9f40c59aaa04da62}{c\_sleep}(50);
438     uint8\_t \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[5] = \{1, 2, 3, 4, 5\};
439     memcpy(\hyperlink{_t_c_p__test_8c_a17306a75951c9f71ee922cb4e69ff786}{oob\_pubkey}, f2\_public\_key, crypto\_box\_PUBLICKEYBYTES);
440     \hyperlink{_t_c_p__client_8c_a7818a314434c2bb01c3ea406744f076b}{send\_oob\_packet}(conn2, f\_public\_key, data, 5);
441     \hyperlink{_t_c_p__client_8c_a0dc7de6475c22a0a31722bbf7ebb8dc5}{send\_routing\_request}(conn, f2\_public\_key);
442     \hyperlink{_t_c_p__client_8c_a0dc7de6475c22a0a31722bbf7ebb8dc5}{send\_routing\_request}(conn2, f\_public\_key);
443     \hyperlink{_t_c_p__test_8c_a5d21ea3d7da27fbd9f40c59aaa04da62}{c\_sleep}(50);
444     \hyperlink{_t_c_p__server_8c_a40e8a0302a359dd4f712eb1e9c346fe5}{do\_TCP\_server}(tcp\_s);
445     \hyperlink{_t_c_p__test_8c_a5d21ea3d7da27fbd9f40c59aaa04da62}{c\_sleep}(50);
446     \hyperlink{_t_c_p__client_8c_a3333858c51935f9f546cf923b07ed845}{do\_TCP\_connection}(conn);
447     \hyperlink{_t_c_p__client_8c_a3333858c51935f9f546cf923b07ed845}{do\_TCP\_connection}(conn2);
448     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(\hyperlink{_t_c_p__test_8c_abca7ecb374ce72cbc9af98ab83209885}{oob\_data\_callback\_good} == 1, \textcolor{stringliteral}{"oob callback not called"}
      );
449     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(\hyperlink{_t_c_p__test_8c_a6cc5f5429af8eac44a61d96130d90892}{response\_callback\_good} == 1, \textcolor{stringliteral}{"response callback not
       called"});
450     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(memcmp(\hyperlink{_t_c_p__test_8c_a9b22a226187b8d0a3d0333c9f12d4518}{response\_callback\_public\_key}, 
      f2\_public\_key, crypto\_box\_PUBLICKEYBYTES) == 0, \textcolor{stringliteral}{"wrong public key"});
451     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(\hyperlink{_t_c_p__test_8c_a56f484ef0812f6fe7d948f2546fed8d0}{status\_callback\_good} == 1, \textcolor{stringliteral}{"status callback not called"})
      ;
452     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(\hyperlink{_t_c_p__test_8c_a42d85e1f7a64f14bff24e31b09a3a4f3}{status\_callback\_status} == 2, \textcolor{stringliteral}{"wrong status"});
453     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(\hyperlink{_t_c_p__test_8c_a785c292a23140df70c0821eba58a4349}{status\_callback\_connection\_id} == 
      \hyperlink{_t_c_p__test_8c_a11a7f4760ef556ac61b828cb15ac883d}{response\_callback\_connection\_id}, \textcolor{stringliteral}{"connection ids not equal"});
454     \hyperlink{_t_c_p__test_8c_a5d21ea3d7da27fbd9f40c59aaa04da62}{c\_sleep}(50);
455     \hyperlink{_t_c_p__server_8c_a40e8a0302a359dd4f712eb1e9c346fe5}{do\_TCP\_server}(tcp\_s);
456     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(\hyperlink{_t_c_p__client_8c_aea842652030d00bd8302e3c0201f95b9}{send\_data}(conn2, 0, data, 5) == 1, \textcolor{stringliteral}{"send data failed"});
457     \hyperlink{_t_c_p__test_8c_a5d21ea3d7da27fbd9f40c59aaa04da62}{c\_sleep}(50);
458     \hyperlink{_t_c_p__server_8c_a40e8a0302a359dd4f712eb1e9c346fe5}{do\_TCP\_server}(tcp\_s);
459     \hyperlink{_t_c_p__test_8c_a5d21ea3d7da27fbd9f40c59aaa04da62}{c\_sleep}(50);
460     \hyperlink{_t_c_p__client_8c_a3333858c51935f9f546cf923b07ed845}{do\_TCP\_connection}(conn);
461     \hyperlink{_t_c_p__client_8c_a3333858c51935f9f546cf923b07ed845}{do\_TCP\_connection}(conn2);
462     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(\hyperlink{_t_c_p__test_8c_ad6e4db92d778379939f9bc01b517a0b2}{data\_callback\_good} == 1, \textcolor{stringliteral}{"data callback not called"});
463     \hyperlink{_t_c_p__test_8c_a56f484ef0812f6fe7d948f2546fed8d0}{status\_callback\_good} = 0;
464     \hyperlink{_t_c_p__client_8c_af83d9fac2256a46428ad95bf337c05b7}{send\_disconnect\_request}(conn2, 0);
465     \hyperlink{_t_c_p__test_8c_a5d21ea3d7da27fbd9f40c59aaa04da62}{c\_sleep}(50);
466     \hyperlink{_t_c_p__server_8c_a40e8a0302a359dd4f712eb1e9c346fe5}{do\_TCP\_server}(tcp\_s);
467     \hyperlink{_t_c_p__test_8c_a5d21ea3d7da27fbd9f40c59aaa04da62}{c\_sleep}(50);
468     \hyperlink{_t_c_p__client_8c_a3333858c51935f9f546cf923b07ed845}{do\_TCP\_connection}(conn);
469     \hyperlink{_t_c_p__client_8c_a3333858c51935f9f546cf923b07ed845}{do\_TCP\_connection}(conn2);
470     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(\hyperlink{_t_c_p__test_8c_a56f484ef0812f6fe7d948f2546fed8d0}{status\_callback\_good} == 1, \textcolor{stringliteral}{"status callback not called"})
      ;
471     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(\hyperlink{_t_c_p__test_8c_a42d85e1f7a64f14bff24e31b09a3a4f3}{status\_callback\_status} == 1, \textcolor{stringliteral}{"wrong status"});
472     \hyperlink{_t_c_p__server_8c_af6df6382ad309456dcf5b7b350313714}{kill\_TCP\_server}(tcp\_s);
473     \hyperlink{_t_c_p__client_8c_a437ba55ccf24fb881acf298f3e225a63}{kill\_TCP\_connection}(conn);
474     \hyperlink{_t_c_p__client_8c_a437ba55ccf24fb881acf298f3e225a63}{kill\_TCP\_connection}(conn2);
475 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=550pt]{d2/d8d/_t_c_p__test_8c_a54051584eff6e81044025b36d88c9a2b_cgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__test_8c_a8d592cfda9af8c42ae12853983f50c87}{\index{T\+C\+P\+\_\+test.\+c@{T\+C\+P\+\_\+test.\+c}!S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T@{S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T}}
\index{S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T@{S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T}!T\+C\+P\+\_\+test.\+c@{T\+C\+P\+\_\+test.\+c}}
\subsubsection[{S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T}]{\setlength{\rightskip}{0pt plus 5cm}E\+N\+D\+\_\+\+T\+E\+S\+T S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T (
\begin{DoxyParamCaption}
\item[{test\+\_\+client\+\_\+invalid}]{}
\end{DoxyParamCaption}
)}}\label{_t_c_p__test_8c_a8d592cfda9af8c42ae12853983f50c87}


Definition at line 478 of file T\+C\+P\+\_\+test.\+c.



References c\+\_\+sleep, ck\+\_\+assert\+\_\+msg(), do\+\_\+\+T\+C\+P\+\_\+connection(), I\+P\+::family, I\+P6\+::in6\+\_\+addr, I\+P\+\_\+\+Port\+::ip, I\+P\+::ip6, kill\+\_\+\+T\+C\+P\+\_\+connection(), new\+\_\+\+T\+C\+P\+\_\+connection(), N\+U\+M\+\_\+\+P\+O\+R\+T\+S, I\+P\+\_\+\+Port\+::port, ports, T\+C\+P\+\_\+\+Client\+\_\+\+Connection\+::status, T\+C\+P\+\_\+\+C\+L\+I\+E\+N\+T\+\_\+\+C\+O\+N\+N\+E\+C\+T\+I\+N\+G, T\+C\+P\+\_\+\+C\+L\+I\+E\+N\+T\+\_\+\+D\+I\+S\+C\+O\+N\+N\+E\+C\+T\+E\+D, and unix\+\_\+time\+\_\+update().


\begin{DoxyCode}
479 \{
480     \hyperlink{util_8c_a849af10dd491723cf3abdef599846897}{unix\_time\_update}();
481     uint8\_t self\_public\_key[crypto\_box\_PUBLICKEYBYTES];
482     uint8\_t self\_secret\_key[crypto\_box\_SECRETKEYBYTES];
483     crypto\_box\_keypair(self\_public\_key, self\_secret\_key);
484 
485     uint8\_t f\_public\_key[crypto\_box\_PUBLICKEYBYTES];
486     uint8\_t f\_secret\_key[crypto\_box\_SECRETKEYBYTES];
487     crypto\_box\_keypair(f\_public\_key, f\_secret\_key);
488     \hyperlink{struct_i_p___port}{IP\_Port} ip\_port\_tcp\_s;
489 
490     ip\_port\_tcp\_s.\hyperlink{struct_i_p___port_a8e0798404bf2cf5dabb84c5ba9a4f236}{port} = htons(\hyperlink{_t_c_p__test_8c_a04e5444bf6a826487066ba973577f674}{ports}[rand() % \hyperlink{_t_c_p__test_8c_af89985dbf9e670e3e7baebb0e05a0f46}{NUM\_PORTS}]);
491     ip\_port\_tcp\_s.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} = AF\_INET6;
492     ip\_port\_tcp\_s.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_a14c606eb5ffb078c38ad854dc4e79507}{ip6}.\hyperlink{union_i_p6_ac312c20ade57f180c50585e9ea42314c}{in6\_addr} = in6addr\_loopback;
493     \hyperlink{struct_t_c_p___client___connection}{TCP\_Client\_Connection} *conn = \hyperlink{_t_c_p__client_8c_aedb0d5c54ac7754bb342517247ac632d}{new\_TCP\_connection}(ip\_port\_tcp\_s, 
      self\_public\_key, f\_public\_key, f\_secret\_key, 0);
494     \hyperlink{_t_c_p__test_8c_a5d21ea3d7da27fbd9f40c59aaa04da62}{c\_sleep}(50);
495     \hyperlink{_t_c_p__client_8c_a3333858c51935f9f546cf923b07ed845}{do\_TCP\_connection}(conn);
496     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(conn->\hyperlink{struct_t_c_p___client___connection_ade818037fd6c985038ff29656089758d}{status} == \hyperlink{_t_c_p__client_8h_ae4d5251432e1a9e6803c0240cc492e18a9430d92af78e28f5ac054a303886c124}{TCP\_CLIENT\_CONNECTING}, \textcolor{stringliteral}{"Wrong
       status. Expected: %u, is: %u"}, \hyperlink{_t_c_p__client_8h_ae4d5251432e1a9e6803c0240cc492e18a9430d92af78e28f5ac054a303886c124}{TCP\_CLIENT\_CONNECTING},
497                   conn->\hyperlink{struct_t_c_p___client___connection_ade818037fd6c985038ff29656089758d}{status});
498     \hyperlink{_t_c_p__test_8c_a5d21ea3d7da27fbd9f40c59aaa04da62}{c\_sleep}(5000);
499     \hyperlink{_t_c_p__client_8c_a3333858c51935f9f546cf923b07ed845}{do\_TCP\_connection}(conn);
500     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(conn->\hyperlink{struct_t_c_p___client___connection_ade818037fd6c985038ff29656089758d}{status} == \hyperlink{_t_c_p__client_8h_ae4d5251432e1a9e6803c0240cc492e18a9430d92af78e28f5ac054a303886c124}{TCP\_CLIENT\_CONNECTING}, \textcolor{stringliteral}{"Wrong
       status. Expected: %u, is: %u"}, \hyperlink{_t_c_p__client_8h_ae4d5251432e1a9e6803c0240cc492e18a9430d92af78e28f5ac054a303886c124}{TCP\_CLIENT\_CONNECTING},
501                   conn->\hyperlink{struct_t_c_p___client___connection_ade818037fd6c985038ff29656089758d}{status});
502     \hyperlink{_t_c_p__test_8c_a5d21ea3d7da27fbd9f40c59aaa04da62}{c\_sleep}(6000);
503     \hyperlink{_t_c_p__client_8c_a3333858c51935f9f546cf923b07ed845}{do\_TCP\_connection}(conn);
504     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(conn->\hyperlink{struct_t_c_p___client___connection_ade818037fd6c985038ff29656089758d}{status} == \hyperlink{_t_c_p__client_8h_ae4d5251432e1a9e6803c0240cc492e18a066a0f8bc9d1c9b8e46e6eba719e703c}{TCP\_CLIENT\_DISCONNECTED}, \textcolor{stringliteral}{"Wrong
       status. Expected: %u, is: %u"}, \hyperlink{_t_c_p__client_8h_ae4d5251432e1a9e6803c0240cc492e18a066a0f8bc9d1c9b8e46e6eba719e703c}{TCP\_CLIENT\_DISCONNECTED},
505                   conn->\hyperlink{struct_t_c_p___client___connection_ade818037fd6c985038ff29656089758d}{status});
506 
507     \hyperlink{_t_c_p__client_8c_a437ba55ccf24fb881acf298f3e225a63}{kill\_TCP\_connection}(conn);
508 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d8d/_t_c_p__test_8c_a8d592cfda9af8c42ae12853983f50c87_cgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__test_8c_a1b7f98a901f4b8685223ec1dac1c1ce3}{\index{T\+C\+P\+\_\+test.\+c@{T\+C\+P\+\_\+test.\+c}!S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T@{S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T}}
\index{S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T@{S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T}!T\+C\+P\+\_\+test.\+c@{T\+C\+P\+\_\+test.\+c}}
\subsubsection[{S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T}]{\setlength{\rightskip}{0pt plus 5cm}S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T (
\begin{DoxyParamCaption}
\item[{test\+\_\+tcp\+\_\+connection}]{}
\end{DoxyParamCaption}
)}}\label{_t_c_p__test_8c_a1b7f98a901f4b8685223ec1dac1c1ce3}


Definition at line 533 of file T\+C\+P\+\_\+test.\+c.



References add\+\_\+tcp\+\_\+relay\+\_\+connection(), c\+\_\+sleep, ck\+\_\+assert\+\_\+msg(), do\+\_\+tcp\+\_\+connections(), do\+\_\+\+T\+C\+P\+\_\+server(), I\+P\+::family, I\+P6\+::in6\+\_\+addr, I\+P\+\_\+\+Port\+::ip, I\+P\+::ip6, kill\+\_\+tcp\+\_\+connection\+\_\+to(), kill\+\_\+tcp\+\_\+connections(), kill\+\_\+\+T\+C\+P\+\_\+server(), new\+\_\+tcp\+\_\+connection\+\_\+to(), new\+\_\+tcp\+\_\+connections(), new\+\_\+\+T\+C\+P\+\_\+server(), N\+U\+M\+\_\+\+P\+O\+R\+T\+S, I\+P\+\_\+\+Port\+::port, ports, T\+C\+P\+\_\+\+Proxy\+\_\+\+Info\+::proxy\+\_\+type, T\+C\+P\+\_\+\+Server\+::public\+\_\+key, T\+C\+P\+\_\+\+Connections\+::self\+\_\+public\+\_\+key, send\+\_\+packet\+\_\+tcp\+\_\+connection(), set\+\_\+packet\+\_\+tcp\+\_\+connection\+\_\+callback(), tcp\+\_\+connection\+\_\+to\+\_\+online\+\_\+tcp\+\_\+relays(), tcp\+\_\+data\+\_\+callback(), tcp\+\_\+data\+\_\+callback\+\_\+called, T\+C\+P\+\_\+\+P\+R\+O\+X\+Y\+\_\+\+N\+O\+N\+E, and unix\+\_\+time\+\_\+update().


\begin{DoxyCode}
534 \{
535     \hyperlink{_t_c_p__test_8c_a13b39dc467dbf69283b5399761400315}{tcp\_data\_callback\_called} = 0;
536     \hyperlink{util_8c_a849af10dd491723cf3abdef599846897}{unix\_time\_update}();
537     uint8\_t self\_public\_key[crypto\_box\_PUBLICKEYBYTES];
538     uint8\_t self\_secret\_key[crypto\_box\_SECRETKEYBYTES];
539     crypto\_box\_keypair(self\_public\_key, self\_secret\_key);
540     \hyperlink{struct_t_c_p___server}{TCP\_Server} *tcp\_s = \hyperlink{_t_c_p__server_8c_a148e632f4c51645cbc1b414bc3584b60}{new\_TCP\_server}(1, \hyperlink{_t_c_p__test_8c_af89985dbf9e670e3e7baebb0e05a0f46}{NUM\_PORTS}, 
      \hyperlink{_t_c_p__test_8c_a04e5444bf6a826487066ba973577f674}{ports}, self\_secret\_key, NULL);
541     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(memcmp(tcp\_s->\hyperlink{struct_t_c_p___server_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, self\_public\_key, 
      crypto\_box\_PUBLICKEYBYTES) == 0, \textcolor{stringliteral}{"Wrong public key"});
542 
543     \hyperlink{struct_t_c_p___proxy___info}{TCP\_Proxy\_Info} proxy\_info;
544     proxy\_info.\hyperlink{struct_t_c_p___proxy___info_a23a098bd0536ae2000e1944e353b7d8b}{proxy\_type} = \hyperlink{_t_c_p__client_8h_ae3f1e841d616cab3ff982b5560aa215fa03246331c1cd872e9461ec9cd79f1f7c}{TCP\_PROXY\_NONE};
545     crypto\_box\_keypair(self\_public\_key, self\_secret\_key);
546     \hyperlink{struct_t_c_p___connections}{TCP\_Connections} *tc\_1 = \hyperlink{_t_c_p__connection_8c_a3526d187a2a8f91d672f0bde2dff4633}{new\_tcp\_connections}(self\_secret\_key, &
      proxy\_info);
547     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(memcmp(tc\_1->\hyperlink{struct_t_c_p___connections_ae726df8bdc26380e5a6c3187a00d6881}{self\_public\_key}, self\_public\_key, 
      crypto\_box\_PUBLICKEYBYTES) == 0, \textcolor{stringliteral}{"Wrong public key"});
548 
549     crypto\_box\_keypair(self\_public\_key, self\_secret\_key);
550     \hyperlink{struct_t_c_p___connections}{TCP\_Connections} *tc\_2 = \hyperlink{_t_c_p__connection_8c_a3526d187a2a8f91d672f0bde2dff4633}{new\_tcp\_connections}(self\_secret\_key, &
      proxy\_info);
551     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(memcmp(tc\_2->\hyperlink{struct_t_c_p___connections_ae726df8bdc26380e5a6c3187a00d6881}{self\_public\_key}, self\_public\_key, 
      crypto\_box\_PUBLICKEYBYTES) == 0, \textcolor{stringliteral}{"Wrong public key"});
552 
553     \hyperlink{struct_i_p___port}{IP\_Port} ip\_port\_tcp\_s;
554 
555     ip\_port\_tcp\_s.\hyperlink{struct_i_p___port_a8e0798404bf2cf5dabb84c5ba9a4f236}{port} = htons(\hyperlink{_t_c_p__test_8c_a04e5444bf6a826487066ba973577f674}{ports}[rand() % \hyperlink{_t_c_p__test_8c_af89985dbf9e670e3e7baebb0e05a0f46}{NUM\_PORTS}]);
556     ip\_port\_tcp\_s.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} = AF\_INET6;
557     ip\_port\_tcp\_s.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_a14c606eb5ffb078c38ad854dc4e79507}{ip6}.\hyperlink{union_i_p6_ac312c20ade57f180c50585e9ea42314c}{in6\_addr} = in6addr\_loopback;
558 
559     \textcolor{keywordtype}{int} connection = \hyperlink{_t_c_p__connection_8c_a22c797c7e0ef3ad66e171f05b1cb52bd}{new\_tcp\_connection\_to}(tc\_1, tc\_2->
      \hyperlink{struct_t_c_p___connections_ae726df8bdc26380e5a6c3187a00d6881}{self\_public\_key}, 123);
560     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(connection == 0, \textcolor{stringliteral}{"Connection id wrong"});
561     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(\hyperlink{_t_c_p__connection_8c_a26901882c0b134822660515493683132}{add\_tcp\_relay\_connection}(tc\_1, connection, 
      ip\_port\_tcp\_s, tcp\_s->\hyperlink{struct_t_c_p___server_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}) == 0,
562                   \textcolor{stringliteral}{"Could not add tcp relay to connection\(\backslash\)n"});
563 
564     ip\_port\_tcp\_s.\hyperlink{struct_i_p___port_a8e0798404bf2cf5dabb84c5ba9a4f236}{port} = htons(\hyperlink{_t_c_p__test_8c_a04e5444bf6a826487066ba973577f674}{ports}[rand() % \hyperlink{_t_c_p__test_8c_af89985dbf9e670e3e7baebb0e05a0f46}{NUM\_PORTS}]);
565     connection = \hyperlink{_t_c_p__connection_8c_a22c797c7e0ef3ad66e171f05b1cb52bd}{new\_tcp\_connection\_to}(tc\_2, tc\_1->
      \hyperlink{struct_t_c_p___connections_ae726df8bdc26380e5a6c3187a00d6881}{self\_public\_key}, 123);
566     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(connection == 0, \textcolor{stringliteral}{"Connection id wrong"});
567     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(\hyperlink{_t_c_p__connection_8c_a26901882c0b134822660515493683132}{add\_tcp\_relay\_connection}(tc\_2, connection, 
      ip\_port\_tcp\_s, tcp\_s->\hyperlink{struct_t_c_p___server_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}) == 0,
568                   \textcolor{stringliteral}{"Could not add tcp relay to connection\(\backslash\)n"});
569 
570     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(\hyperlink{_t_c_p__connection_8c_a22c797c7e0ef3ad66e171f05b1cb52bd}{new\_tcp\_connection\_to}(tc\_2, tc\_1->
      \hyperlink{struct_t_c_p___connections_ae726df8bdc26380e5a6c3187a00d6881}{self\_public\_key}, 123) == -1, \textcolor{stringliteral}{"Managed to readd same connection\(\backslash\)n"});
571 
572     \hyperlink{_t_c_p__test_8c_a5d21ea3d7da27fbd9f40c59aaa04da62}{c\_sleep}(50);
573     \hyperlink{_t_c_p__server_8c_a40e8a0302a359dd4f712eb1e9c346fe5}{do\_TCP\_server}(tcp\_s);
574     \hyperlink{_t_c_p__test_8c_a5d21ea3d7da27fbd9f40c59aaa04da62}{c\_sleep}(50);
575     \hyperlink{_t_c_p__connection_8c_a30c1a9c57a8d07cc2327c0505d6619a4}{do\_tcp\_connections}(tc\_1);
576     \hyperlink{_t_c_p__connection_8c_a30c1a9c57a8d07cc2327c0505d6619a4}{do\_tcp\_connections}(tc\_2);
577     \hyperlink{_t_c_p__test_8c_a5d21ea3d7da27fbd9f40c59aaa04da62}{c\_sleep}(50);
578     \hyperlink{_t_c_p__server_8c_a40e8a0302a359dd4f712eb1e9c346fe5}{do\_TCP\_server}(tcp\_s);
579     \hyperlink{_t_c_p__test_8c_a5d21ea3d7da27fbd9f40c59aaa04da62}{c\_sleep}(50);
580     \hyperlink{_t_c_p__connection_8c_a30c1a9c57a8d07cc2327c0505d6619a4}{do\_tcp\_connections}(tc\_1);
581     \hyperlink{_t_c_p__connection_8c_a30c1a9c57a8d07cc2327c0505d6619a4}{do\_tcp\_connections}(tc\_2);
582     \hyperlink{_t_c_p__test_8c_a5d21ea3d7da27fbd9f40c59aaa04da62}{c\_sleep}(50);
583     \hyperlink{_t_c_p__server_8c_a40e8a0302a359dd4f712eb1e9c346fe5}{do\_TCP\_server}(tcp\_s);
584     \hyperlink{_t_c_p__test_8c_a5d21ea3d7da27fbd9f40c59aaa04da62}{c\_sleep}(50);
585     \hyperlink{_t_c_p__connection_8c_a30c1a9c57a8d07cc2327c0505d6619a4}{do\_tcp\_connections}(tc\_1);
586     \hyperlink{_t_c_p__connection_8c_a30c1a9c57a8d07cc2327c0505d6619a4}{do\_tcp\_connections}(tc\_2);
587 
588     \textcolor{keywordtype}{int} ret = \hyperlink{_t_c_p__connection_8c_a455e955e01d34ff3db0b22b8f6d49d98}{send\_packet\_tcp\_connection}(tc\_1, 0, \textcolor{stringliteral}{"Gentoo"}, 6);
589     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(ret == 0, \textcolor{stringliteral}{"could not send packet."});
590     \hyperlink{_t_c_p__connection_8c_afdea860d77b12c79ee24c3ade58d4ac6}{set\_packet\_tcp\_connection\_callback}(tc\_2, &
      \hyperlink{_t_c_p__test_8c_ab2eaad4448a5deca58a00316b522e380}{tcp\_data\_callback}, (\textcolor{keywordtype}{void} *) 120397);
591 
592     \hyperlink{_t_c_p__test_8c_a5d21ea3d7da27fbd9f40c59aaa04da62}{c\_sleep}(50);
593     \hyperlink{_t_c_p__server_8c_a40e8a0302a359dd4f712eb1e9c346fe5}{do\_TCP\_server}(tcp\_s);
594     \hyperlink{_t_c_p__test_8c_a5d21ea3d7da27fbd9f40c59aaa04da62}{c\_sleep}(50);
595 
596     \hyperlink{_t_c_p__connection_8c_a30c1a9c57a8d07cc2327c0505d6619a4}{do\_tcp\_connections}(tc\_1);
597     \hyperlink{_t_c_p__connection_8c_a30c1a9c57a8d07cc2327c0505d6619a4}{do\_tcp\_connections}(tc\_2);
598 
599     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(\hyperlink{_t_c_p__test_8c_a13b39dc467dbf69283b5399761400315}{tcp\_data\_callback\_called}, \textcolor{stringliteral}{"could not recv packet."});
600     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(\hyperlink{_t_c_p__connection_8c_ae843b0b4c8041f08bf9c18f68cae8a61}{tcp\_connection\_to\_online\_tcp\_relays}(tc\_1,
       0) == 1, \textcolor{stringliteral}{"Wrong number of connected relays"});
601     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(\hyperlink{_t_c_p__connection_8c_a2369688a49bef46cb2029b3bb680e11d}{kill\_tcp\_connection\_to}(tc\_1, 0) == 0, \textcolor{stringliteral}{"could not kill
       connection to\(\backslash\)n"});
602 
603     \hyperlink{_t_c_p__test_8c_a5d21ea3d7da27fbd9f40c59aaa04da62}{c\_sleep}(50);
604     \hyperlink{_t_c_p__server_8c_a40e8a0302a359dd4f712eb1e9c346fe5}{do\_TCP\_server}(tcp\_s);
605     \hyperlink{_t_c_p__test_8c_a5d21ea3d7da27fbd9f40c59aaa04da62}{c\_sleep}(50);
606     \hyperlink{_t_c_p__connection_8c_a30c1a9c57a8d07cc2327c0505d6619a4}{do\_tcp\_connections}(tc\_1);
607     \hyperlink{_t_c_p__connection_8c_a30c1a9c57a8d07cc2327c0505d6619a4}{do\_tcp\_connections}(tc\_2);
608 
609     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(\hyperlink{_t_c_p__connection_8c_a455e955e01d34ff3db0b22b8f6d49d98}{send\_packet\_tcp\_connection}(tc\_1, 0, \textcolor{stringliteral}{"Gentoo"}, 6) 
      == -1, \textcolor{stringliteral}{"could send packet."});
610     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(\hyperlink{_t_c_p__connection_8c_a2369688a49bef46cb2029b3bb680e11d}{kill\_tcp\_connection\_to}(tc\_2, 0) == 0, \textcolor{stringliteral}{"could not kill
       connection to\(\backslash\)n"});
611 
612     \hyperlink{_t_c_p__server_8c_af6df6382ad309456dcf5b7b350313714}{kill\_TCP\_server}(tcp\_s);
613     \hyperlink{_t_c_p__connection_8c_a6938788005ebe33a896755ac2b9f501a}{kill\_tcp\_connections}(tc\_1);
614     \hyperlink{_t_c_p__connection_8c_a6938788005ebe33a896755ac2b9f501a}{kill\_tcp\_connections}(tc\_2);
615 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d8d/_t_c_p__test_8c_a1b7f98a901f4b8685223ec1dac1c1ce3_cgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__test_8c_ac45927e61cae5bb70dbde2b32c8f62ff}{\index{T\+C\+P\+\_\+test.\+c@{T\+C\+P\+\_\+test.\+c}!S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T@{S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T}}
\index{S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T@{S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T}!T\+C\+P\+\_\+test.\+c@{T\+C\+P\+\_\+test.\+c}}
\subsubsection[{S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T}]{\setlength{\rightskip}{0pt plus 5cm}S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T (
\begin{DoxyParamCaption}
\item[{test\+\_\+tcp\+\_\+connection2}]{}
\end{DoxyParamCaption}
)}}\label{_t_c_p__test_8c_ac45927e61cae5bb70dbde2b32c8f62ff}


Definition at line 634 of file T\+C\+P\+\_\+test.\+c.



References add\+\_\+tcp\+\_\+relay\+\_\+connection(), add\+\_\+tcp\+\_\+relay\+\_\+global(), c\+\_\+sleep, ck\+\_\+assert\+\_\+msg(), do\+\_\+tcp\+\_\+connections(), do\+\_\+\+T\+C\+P\+\_\+server(), I\+P\+::family, I\+P6\+::in6\+\_\+addr, I\+P\+\_\+\+Port\+::ip, I\+P\+::ip6, kill\+\_\+tcp\+\_\+connection\+\_\+to(), kill\+\_\+tcp\+\_\+connections(), kill\+\_\+\+T\+C\+P\+\_\+server(), new\+\_\+tcp\+\_\+connection\+\_\+to(), new\+\_\+tcp\+\_\+connections(), new\+\_\+\+T\+C\+P\+\_\+server(), N\+U\+M\+\_\+\+P\+O\+R\+T\+S, I\+P\+\_\+\+Port\+::port, ports, T\+C\+P\+\_\+\+Proxy\+\_\+\+Info\+::proxy\+\_\+type, T\+C\+P\+\_\+\+Server\+::public\+\_\+key, T\+C\+P\+\_\+\+Connections\+::self\+\_\+public\+\_\+key, send\+\_\+packet\+\_\+tcp\+\_\+connection(), set\+\_\+oob\+\_\+packet\+\_\+tcp\+\_\+connection\+\_\+callback(), set\+\_\+packet\+\_\+tcp\+\_\+connection\+\_\+callback(), tcp\+\_\+data\+\_\+callback(), tcp\+\_\+data\+\_\+callback\+\_\+called, tcp\+\_\+oobdata\+\_\+callback(), tcp\+\_\+oobdata\+\_\+callback\+\_\+called, T\+C\+P\+\_\+\+P\+R\+O\+X\+Y\+\_\+\+N\+O\+N\+E, and unix\+\_\+time\+\_\+update().


\begin{DoxyCode}
635 \{
636     \hyperlink{_t_c_p__test_8c_a8abafa082d888febbe0d3999d7799cc6}{tcp\_oobdata\_callback\_called} = 0;
637     \hyperlink{_t_c_p__test_8c_a13b39dc467dbf69283b5399761400315}{tcp\_data\_callback\_called} = 0;
638 
639     \hyperlink{util_8c_a849af10dd491723cf3abdef599846897}{unix\_time\_update}();
640     uint8\_t self\_public\_key[crypto\_box\_PUBLICKEYBYTES];
641     uint8\_t self\_secret\_key[crypto\_box\_SECRETKEYBYTES];
642     crypto\_box\_keypair(self\_public\_key, self\_secret\_key);
643     \hyperlink{struct_t_c_p___server}{TCP\_Server} *tcp\_s = \hyperlink{_t_c_p__server_8c_a148e632f4c51645cbc1b414bc3584b60}{new\_TCP\_server}(1, \hyperlink{_t_c_p__test_8c_af89985dbf9e670e3e7baebb0e05a0f46}{NUM\_PORTS}, 
      \hyperlink{_t_c_p__test_8c_a04e5444bf6a826487066ba973577f674}{ports}, self\_secret\_key, NULL);
644     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(memcmp(tcp\_s->\hyperlink{struct_t_c_p___server_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}, self\_public\_key, 
      crypto\_box\_PUBLICKEYBYTES) == 0, \textcolor{stringliteral}{"Wrong public key"});
645 
646     \hyperlink{struct_t_c_p___proxy___info}{TCP\_Proxy\_Info} proxy\_info;
647     proxy\_info.\hyperlink{struct_t_c_p___proxy___info_a23a098bd0536ae2000e1944e353b7d8b}{proxy\_type} = \hyperlink{_t_c_p__client_8h_ae3f1e841d616cab3ff982b5560aa215fa03246331c1cd872e9461ec9cd79f1f7c}{TCP\_PROXY\_NONE};
648     crypto\_box\_keypair(self\_public\_key, self\_secret\_key);
649     \hyperlink{struct_t_c_p___connections}{TCP\_Connections} *tc\_1 = \hyperlink{_t_c_p__connection_8c_a3526d187a2a8f91d672f0bde2dff4633}{new\_tcp\_connections}(self\_secret\_key, &
      proxy\_info);
650     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(memcmp(tc\_1->\hyperlink{struct_t_c_p___connections_ae726df8bdc26380e5a6c3187a00d6881}{self\_public\_key}, self\_public\_key, 
      crypto\_box\_PUBLICKEYBYTES) == 0, \textcolor{stringliteral}{"Wrong public key"});
651 
652     crypto\_box\_keypair(self\_public\_key, self\_secret\_key);
653     \hyperlink{struct_t_c_p___connections}{TCP\_Connections} *tc\_2 = \hyperlink{_t_c_p__connection_8c_a3526d187a2a8f91d672f0bde2dff4633}{new\_tcp\_connections}(self\_secret\_key, &
      proxy\_info);
654     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(memcmp(tc\_2->\hyperlink{struct_t_c_p___connections_ae726df8bdc26380e5a6c3187a00d6881}{self\_public\_key}, self\_public\_key, 
      crypto\_box\_PUBLICKEYBYTES) == 0, \textcolor{stringliteral}{"Wrong public key"});
655 
656     \hyperlink{struct_i_p___port}{IP\_Port} ip\_port\_tcp\_s;
657 
658     ip\_port\_tcp\_s.\hyperlink{struct_i_p___port_a8e0798404bf2cf5dabb84c5ba9a4f236}{port} = htons(\hyperlink{_t_c_p__test_8c_a04e5444bf6a826487066ba973577f674}{ports}[rand() % \hyperlink{_t_c_p__test_8c_af89985dbf9e670e3e7baebb0e05a0f46}{NUM\_PORTS}]);
659     ip\_port\_tcp\_s.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_adad4493a852deb413bb8c515368deaac}{family} = AF\_INET6;
660     ip\_port\_tcp\_s.\hyperlink{struct_i_p___port_a0c6193a337a223c63411b2fe722d79ec}{ip}.\hyperlink{struct_i_p_a14c606eb5ffb078c38ad854dc4e79507}{ip6}.\hyperlink{union_i_p6_ac312c20ade57f180c50585e9ea42314c}{in6\_addr} = in6addr\_loopback;
661 
662     \textcolor{keywordtype}{int} connection = \hyperlink{_t_c_p__connection_8c_a22c797c7e0ef3ad66e171f05b1cb52bd}{new\_tcp\_connection\_to}(tc\_1, tc\_2->
      \hyperlink{struct_t_c_p___connections_ae726df8bdc26380e5a6c3187a00d6881}{self\_public\_key}, 123);
663     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(connection == 0, \textcolor{stringliteral}{"Connection id wrong"});
664     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(\hyperlink{_t_c_p__connection_8c_a26901882c0b134822660515493683132}{add\_tcp\_relay\_connection}(tc\_1, connection, 
      ip\_port\_tcp\_s, tcp\_s->\hyperlink{struct_t_c_p___server_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}) == 0,
665                   \textcolor{stringliteral}{"Could not add tcp relay to connection\(\backslash\)n"});
666 
667     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(\hyperlink{_t_c_p__connection_8c_a5ee1dbaa28ff59e0f452eda3c97418e3}{add\_tcp\_relay\_global}(tc\_2, ip\_port\_tcp\_s, tcp\_s->
      \hyperlink{struct_t_c_p___server_aaa806bb1136fb3d4b5d8d8970b596ff7}{public\_key}) == 0, \textcolor{stringliteral}{"Could not add global relay"});
668 
669     \hyperlink{_t_c_p__test_8c_a5d21ea3d7da27fbd9f40c59aaa04da62}{c\_sleep}(50);
670     \hyperlink{_t_c_p__server_8c_a40e8a0302a359dd4f712eb1e9c346fe5}{do\_TCP\_server}(tcp\_s);
671     \hyperlink{_t_c_p__test_8c_a5d21ea3d7da27fbd9f40c59aaa04da62}{c\_sleep}(50);
672     \hyperlink{_t_c_p__connection_8c_a30c1a9c57a8d07cc2327c0505d6619a4}{do\_tcp\_connections}(tc\_1);
673     \hyperlink{_t_c_p__connection_8c_a30c1a9c57a8d07cc2327c0505d6619a4}{do\_tcp\_connections}(tc\_2);
674     \hyperlink{_t_c_p__test_8c_a5d21ea3d7da27fbd9f40c59aaa04da62}{c\_sleep}(50);
675     \hyperlink{_t_c_p__server_8c_a40e8a0302a359dd4f712eb1e9c346fe5}{do\_TCP\_server}(tcp\_s);
676     \hyperlink{_t_c_p__test_8c_a5d21ea3d7da27fbd9f40c59aaa04da62}{c\_sleep}(50);
677     \hyperlink{_t_c_p__connection_8c_a30c1a9c57a8d07cc2327c0505d6619a4}{do\_tcp\_connections}(tc\_1);
678     \hyperlink{_t_c_p__connection_8c_a30c1a9c57a8d07cc2327c0505d6619a4}{do\_tcp\_connections}(tc\_2);
679     \hyperlink{_t_c_p__test_8c_a5d21ea3d7da27fbd9f40c59aaa04da62}{c\_sleep}(50);
680     \hyperlink{_t_c_p__server_8c_a40e8a0302a359dd4f712eb1e9c346fe5}{do\_TCP\_server}(tcp\_s);
681     \hyperlink{_t_c_p__test_8c_a5d21ea3d7da27fbd9f40c59aaa04da62}{c\_sleep}(50);
682     \hyperlink{_t_c_p__connection_8c_a30c1a9c57a8d07cc2327c0505d6619a4}{do\_tcp\_connections}(tc\_1);
683     \hyperlink{_t_c_p__connection_8c_a30c1a9c57a8d07cc2327c0505d6619a4}{do\_tcp\_connections}(tc\_2);
684 
685     \textcolor{keywordtype}{int} ret = \hyperlink{_t_c_p__connection_8c_a455e955e01d34ff3db0b22b8f6d49d98}{send\_packet\_tcp\_connection}(tc\_1, 0, \textcolor{stringliteral}{"Gentoo"}, 6);
686     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(ret == 0, \textcolor{stringliteral}{"could not send packet."});
687     \hyperlink{_t_c_p__connection_8c_a13df5ebd6110288f192070b8c1c28328}{set\_oob\_packet\_tcp\_connection\_callback}(tc\_2, &
      \hyperlink{_t_c_p__test_8c_aa506c7db9407212fb8fd6d767aa974c2}{tcp\_oobdata\_callback}, tc\_2);
688     \hyperlink{_t_c_p__connection_8c_afdea860d77b12c79ee24c3ade58d4ac6}{set\_packet\_tcp\_connection\_callback}(tc\_1, &
      \hyperlink{_t_c_p__test_8c_ab2eaad4448a5deca58a00316b522e380}{tcp\_data\_callback}, (\textcolor{keywordtype}{void} *) 120397);
689 
690     \hyperlink{_t_c_p__test_8c_a5d21ea3d7da27fbd9f40c59aaa04da62}{c\_sleep}(50);
691     \hyperlink{_t_c_p__server_8c_a40e8a0302a359dd4f712eb1e9c346fe5}{do\_TCP\_server}(tcp\_s);
692     \hyperlink{_t_c_p__test_8c_a5d21ea3d7da27fbd9f40c59aaa04da62}{c\_sleep}(50);
693 
694     \hyperlink{_t_c_p__connection_8c_a30c1a9c57a8d07cc2327c0505d6619a4}{do\_tcp\_connections}(tc\_1);
695     \hyperlink{_t_c_p__connection_8c_a30c1a9c57a8d07cc2327c0505d6619a4}{do\_tcp\_connections}(tc\_2);
696 
697     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(\hyperlink{_t_c_p__test_8c_a8abafa082d888febbe0d3999d7799cc6}{tcp\_oobdata\_callback\_called}, \textcolor{stringliteral}{"could not recv
       packet."});
698 
699     \hyperlink{_t_c_p__test_8c_a5d21ea3d7da27fbd9f40c59aaa04da62}{c\_sleep}(50);
700     \hyperlink{_t_c_p__server_8c_a40e8a0302a359dd4f712eb1e9c346fe5}{do\_TCP\_server}(tcp\_s);
701     \hyperlink{_t_c_p__test_8c_a5d21ea3d7da27fbd9f40c59aaa04da62}{c\_sleep}(50);
702 
703     \hyperlink{_t_c_p__connection_8c_a30c1a9c57a8d07cc2327c0505d6619a4}{do\_tcp\_connections}(tc\_1);
704     \hyperlink{_t_c_p__connection_8c_a30c1a9c57a8d07cc2327c0505d6619a4}{do\_tcp\_connections}(tc\_2);
705 
706     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(\hyperlink{_t_c_p__test_8c_a13b39dc467dbf69283b5399761400315}{tcp\_data\_callback\_called}, \textcolor{stringliteral}{"could not recv packet."});
707     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(\hyperlink{_t_c_p__connection_8c_a2369688a49bef46cb2029b3bb680e11d}{kill\_tcp\_connection\_to}(tc\_1, 0) == 0, \textcolor{stringliteral}{"could not kill
       connection to\(\backslash\)n"});
708 
709     \hyperlink{_t_c_p__server_8c_af6df6382ad309456dcf5b7b350313714}{kill\_TCP\_server}(tcp\_s);
710     \hyperlink{_t_c_p__connection_8c_a6938788005ebe33a896755ac2b9f501a}{kill\_tcp\_connections}(tc\_1);
711     \hyperlink{_t_c_p__connection_8c_a6938788005ebe33a896755ac2b9f501a}{kill\_tcp\_connections}(tc\_2);
712 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d8d/_t_c_p__test_8c_ac45927e61cae5bb70dbde2b32c8f62ff_cgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__test_8c_ae4f12b6805a17277d33e73ac030d7aca}{\index{T\+C\+P\+\_\+test.\+c@{T\+C\+P\+\_\+test.\+c}!status\+\_\+callback@{status\+\_\+callback}}
\index{status\+\_\+callback@{status\+\_\+callback}!T\+C\+P\+\_\+test.\+c@{T\+C\+P\+\_\+test.\+c}}
\subsubsection[{status\+\_\+callback}]{\setlength{\rightskip}{0pt plus 5cm}static int status\+\_\+callback (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{object, }
\item[{uint32\+\_\+t}]{number, }
\item[{uint8\+\_\+t}]{connection\+\_\+id, }
\item[{uint8\+\_\+t}]{status}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_t_c_p__test_8c_ae4f12b6805a17277d33e73ac030d7aca}


Definition at line 323 of file T\+C\+P\+\_\+test.\+c.



References status\+\_\+callback\+\_\+connection\+\_\+id, status\+\_\+callback\+\_\+good, and status\+\_\+callback\+\_\+status.



Referenced by friend\+\_\+connection\+\_\+callbacks(), routing\+\_\+status\+\_\+handler(), and S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T().


\begin{DoxyCode}
324 \{
325     \textcolor{keywordflow}{if} (\textcolor{keywordtype}{object} != (\textcolor{keywordtype}{void} *)2)
326         \textcolor{keywordflow}{return} 1;
327 
328     \textcolor{keywordflow}{if} (number != 7)
329         \textcolor{keywordflow}{return} 1;
330 
331     \hyperlink{_t_c_p__test_8c_a785c292a23140df70c0821eba58a4349}{status\_callback\_connection\_id} = connection\_id;
332     \hyperlink{_t_c_p__test_8c_a42d85e1f7a64f14bff24e31b09a3a4f3}{status\_callback\_status} = status;
333     \hyperlink{_t_c_p__test_8c_a56f484ef0812f6fe7d948f2546fed8d0}{status\_callback\_good}++;
334     \textcolor{keywordflow}{return} 0;
335 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d8d/_t_c_p__test_8c_ae4f12b6805a17277d33e73ac030d7aca_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__test_8c_ab2eaad4448a5deca58a00316b522e380}{\index{T\+C\+P\+\_\+test.\+c@{T\+C\+P\+\_\+test.\+c}!tcp\+\_\+data\+\_\+callback@{tcp\+\_\+data\+\_\+callback}}
\index{tcp\+\_\+data\+\_\+callback@{tcp\+\_\+data\+\_\+callback}!T\+C\+P\+\_\+test.\+c@{T\+C\+P\+\_\+test.\+c}}
\subsubsection[{tcp\+\_\+data\+\_\+callback}]{\setlength{\rightskip}{0pt plus 5cm}static int tcp\+\_\+data\+\_\+callback (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{object, }
\item[{int}]{id, }
\item[{const uint8\+\_\+t $\ast$}]{data, }
\item[{uint16\+\_\+t}]{length}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_t_c_p__test_8c_ab2eaad4448a5deca58a00316b522e380}


Definition at line 514 of file T\+C\+P\+\_\+test.\+c.



References tcp\+\_\+data\+\_\+callback\+\_\+called.



Referenced by S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T().


\begin{DoxyCode}
515 \{
516     \textcolor{keywordflow}{if} (\textcolor{keywordtype}{object} != (\textcolor{keywordtype}{void} *)120397)
517         \textcolor{keywordflow}{return} -1;
518 
519     \textcolor{keywordflow}{if} (\textcolor{keywordtype}{id} != 123)
520         \textcolor{keywordflow}{return} -1;
521 
522     \textcolor{keywordflow}{if} (length != 6)
523         \textcolor{keywordflow}{return} -1;
524 
525     \textcolor{keywordflow}{if} (memcmp(\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}, \textcolor{stringliteral}{"Gentoo"}, length) != 0)
526         \textcolor{keywordflow}{return} -1;
527 
528     \hyperlink{_t_c_p__test_8c_a13b39dc467dbf69283b5399761400315}{tcp\_data\_callback\_called} = 1;
529     \textcolor{keywordflow}{return} 0;
530 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=291pt]{d2/d8d/_t_c_p__test_8c_ab2eaad4448a5deca58a00316b522e380_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__test_8c_aa506c7db9407212fb8fd6d767aa974c2}{\index{T\+C\+P\+\_\+test.\+c@{T\+C\+P\+\_\+test.\+c}!tcp\+\_\+oobdata\+\_\+callback@{tcp\+\_\+oobdata\+\_\+callback}}
\index{tcp\+\_\+oobdata\+\_\+callback@{tcp\+\_\+oobdata\+\_\+callback}!T\+C\+P\+\_\+test.\+c@{T\+C\+P\+\_\+test.\+c}}
\subsubsection[{tcp\+\_\+oobdata\+\_\+callback}]{\setlength{\rightskip}{0pt plus 5cm}static int tcp\+\_\+oobdata\+\_\+callback (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{object, }
\item[{const uint8\+\_\+t $\ast$}]{public\+\_\+key, }
\item[{unsigned int}]{id, }
\item[{const uint8\+\_\+t $\ast$}]{data, }
\item[{uint16\+\_\+t}]{length}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{_t_c_p__test_8c_aa506c7db9407212fb8fd6d767aa974c2}


Definition at line 619 of file T\+C\+P\+\_\+test.\+c.



References tcp\+\_\+oobdata\+\_\+callback\+\_\+called, and tcp\+\_\+send\+\_\+oob\+\_\+packet().



Referenced by S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T().


\begin{DoxyCode}
621 \{
622     \textcolor{keywordflow}{if} (length != 6)
623         \textcolor{keywordflow}{return} -1;
624 
625     \textcolor{keywordflow}{if} (memcmp(\hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}, \textcolor{stringliteral}{"Gentoo"}, length) != 0)
626         \textcolor{keywordflow}{return} -1;
627 
628     \textcolor{keywordflow}{if} (\hyperlink{_t_c_p__connection_8c_a5effabd83d700cccf9bcc51174f041f1}{tcp\_send\_oob\_packet}(\textcolor{keywordtype}{object}, \textcolor{keywordtype}{id}, \hyperlink{namespacemake-funny-savefile_a6734667aeff5c30ad9e5624ccb556a87}{public\_key}, 
      \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}, length) == 0)
629         \hyperlink{_t_c_p__test_8c_a8abafa082d888febbe0d3999d7799cc6}{tcp\_oobdata\_callback\_called} = 1;
630 
631     \textcolor{keywordflow}{return} 0;
632 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d8d/_t_c_p__test_8c_aa506c7db9407212fb8fd6d767aa974c2_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=307pt]{d2/d8d/_t_c_p__test_8c_aa506c7db9407212fb8fd6d767aa974c2_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__test_8c_a8089614950e49b4d49f390862dc5e352}{\index{T\+C\+P\+\_\+test.\+c@{T\+C\+P\+\_\+test.\+c}!T\+C\+P\+\_\+suite@{T\+C\+P\+\_\+suite}}
\index{T\+C\+P\+\_\+suite@{T\+C\+P\+\_\+suite}!T\+C\+P\+\_\+test.\+c@{T\+C\+P\+\_\+test.\+c}}
\subsubsection[{T\+C\+P\+\_\+suite}]{\setlength{\rightskip}{0pt plus 5cm}E\+N\+D\+\_\+\+T\+E\+S\+T Suite$\ast$ T\+C\+P\+\_\+suite (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{_t_c_p__test_8c_a8089614950e49b4d49f390862dc5e352}


Definition at line 715 of file T\+C\+P\+\_\+test.\+c.



References D\+E\+F\+T\+E\+S\+T\+C\+A\+S\+E\+\_\+\+S\+L\+O\+W.



Referenced by main().


\begin{DoxyCode}
716 \{
717     Suite *s = suite\_create(\textcolor{stringliteral}{"TCP"});
718 
719     \hyperlink{helpers_8h_a04d7721023739a366a0baae1b1a32b50}{DEFTESTCASE\_SLOW}(basic, 5);
720     \hyperlink{helpers_8h_a04d7721023739a366a0baae1b1a32b50}{DEFTESTCASE\_SLOW}(some, 10);
721     \hyperlink{helpers_8h_a04d7721023739a366a0baae1b1a32b50}{DEFTESTCASE\_SLOW}(client, 10);
722     \hyperlink{helpers_8h_a04d7721023739a366a0baae1b1a32b50}{DEFTESTCASE\_SLOW}(client\_invalid, 15);
723     \hyperlink{helpers_8h_a04d7721023739a366a0baae1b1a32b50}{DEFTESTCASE\_SLOW}(tcp\_connection, 20);
724     \hyperlink{helpers_8h_a04d7721023739a366a0baae1b1a32b50}{DEFTESTCASE\_SLOW}(tcp\_connection2, 20);
725     \textcolor{keywordflow}{return} s;
726 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=217pt]{d2/d8d/_t_c_p__test_8c_a8089614950e49b4d49f390862dc5e352_icgraph}
\end{center}
\end{figure}


\hypertarget{_t_c_p__test_8c_aa54773b9420df5d5d443bc0cfcec1784}{\index{T\+C\+P\+\_\+test.\+c@{T\+C\+P\+\_\+test.\+c}!write\+\_\+packet\+\_\+\+T\+C\+P\+\_\+secure\+\_\+connection@{write\+\_\+packet\+\_\+\+T\+C\+P\+\_\+secure\+\_\+connection}}
\index{write\+\_\+packet\+\_\+\+T\+C\+P\+\_\+secure\+\_\+connection@{write\+\_\+packet\+\_\+\+T\+C\+P\+\_\+secure\+\_\+connection}!T\+C\+P\+\_\+test.\+c@{T\+C\+P\+\_\+test.\+c}}
\subsubsection[{write\+\_\+packet\+\_\+\+T\+C\+P\+\_\+secure\+\_\+connection}]{\setlength{\rightskip}{0pt plus 5cm}int write\+\_\+packet\+\_\+\+T\+C\+P\+\_\+secure\+\_\+connection (
\begin{DoxyParamCaption}
\item[{struct {\bf sec\+\_\+\+T\+C\+P\+\_\+con} $\ast$}]{con, }
\item[{uint8\+\_\+t $\ast$}]{data, }
\item[{uint16\+\_\+t}]{length}
\end{DoxyParamCaption}
)}}\label{_t_c_p__test_8c_aa54773b9420df5d5d443bc0cfcec1784}


Definition at line 185 of file T\+C\+P\+\_\+test.\+c.



References ck\+\_\+assert\+\_\+msg(), encrypt\+\_\+data\+\_\+symmetric(), increment\+\_\+nonce(), sec\+\_\+\+T\+C\+P\+\_\+con\+::sent\+\_\+nonce, sec\+\_\+\+T\+C\+P\+\_\+con\+::shared\+\_\+key, and sec\+\_\+\+T\+C\+P\+\_\+con\+::sock.



Referenced by S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T().


\begin{DoxyCode}
186 \{
187     uint8\_t packet[\textcolor{keyword}{sizeof}(uint16\_t) + length + crypto\_box\_MACBYTES];
188 
189     uint16\_t c\_length = htons(length + crypto\_box\_MACBYTES);
190     memcpy(packet, &c\_length, \textcolor{keyword}{sizeof}(uint16\_t));
191     \textcolor{keywordtype}{int} len = \hyperlink{crypto__core_8c_a81efc0a4a6e0efe372651e26e342a6e5}{encrypt\_data\_symmetric}(con->\hyperlink{structsec___t_c_p__con_a81ead9fac55a0cedc30a96253a2c5119}{shared\_key}, con->
      \hyperlink{structsec___t_c_p__con_a9df0e00e8f493ed6cd1ff45e7da33c0d}{sent\_nonce}, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}, length, packet + \textcolor{keyword}{sizeof}(uint16\_t));
192 
193     \textcolor{keywordflow}{if} ((\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int})len != (\textcolor{keyword}{sizeof}(packet) - \textcolor{keyword}{sizeof}(uint16\_t)))
194         \textcolor{keywordflow}{return} -1;
195 
196     \hyperlink{crypto__core_8c_ab953f1e92b8a9a193f69f02323b9c980}{increment\_nonce}(con->\hyperlink{structsec___t_c_p__con_a9df0e00e8f493ed6cd1ff45e7da33c0d}{sent\_nonce});
197 
198     \hyperlink{toxav__many__test_8c_a4bd4b2294bdedc4af8c708ecc5c58516}{ck\_assert\_msg}(send(con->\hyperlink{structsec___t_c_p__con_a35b19d84fb632ca8ce5cab237f7089a5}{sock}, packet, \textcolor{keyword}{sizeof}(packet), 0) == \textcolor{keyword}{sizeof}(packet), \textcolor{stringliteral}{"send
       failed"});
199     \textcolor{keywordflow}{return} 0;
200 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d8d/_t_c_p__test_8c_aa54773b9420df5d5d443bc0cfcec1784_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=328pt]{d2/d8d/_t_c_p__test_8c_aa54773b9420df5d5d443bc0cfcec1784_icgraph}
\end{center}
\end{figure}




\subsection{Variable Documentation}
\hypertarget{_t_c_p__test_8c_ad6e4db92d778379939f9bc01b517a0b2}{\index{T\+C\+P\+\_\+test.\+c@{T\+C\+P\+\_\+test.\+c}!data\+\_\+callback\+\_\+good@{data\+\_\+callback\+\_\+good}}
\index{data\+\_\+callback\+\_\+good@{data\+\_\+callback\+\_\+good}!T\+C\+P\+\_\+test.\+c@{T\+C\+P\+\_\+test.\+c}}
\subsubsection[{data\+\_\+callback\+\_\+good}]{\setlength{\rightskip}{0pt plus 5cm}int data\+\_\+callback\+\_\+good\hspace{0.3cm}{\ttfamily [static]}}}\label{_t_c_p__test_8c_ad6e4db92d778379939f9bc01b517a0b2}


Definition at line 336 of file T\+C\+P\+\_\+test.\+c.



Referenced by data\+\_\+callback(), and S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T().

\hypertarget{_t_c_p__test_8c_abca7ecb374ce72cbc9af98ab83209885}{\index{T\+C\+P\+\_\+test.\+c@{T\+C\+P\+\_\+test.\+c}!oob\+\_\+data\+\_\+callback\+\_\+good@{oob\+\_\+data\+\_\+callback\+\_\+good}}
\index{oob\+\_\+data\+\_\+callback\+\_\+good@{oob\+\_\+data\+\_\+callback\+\_\+good}!T\+C\+P\+\_\+test.\+c@{T\+C\+P\+\_\+test.\+c}}
\subsubsection[{oob\+\_\+data\+\_\+callback\+\_\+good}]{\setlength{\rightskip}{0pt plus 5cm}int oob\+\_\+data\+\_\+callback\+\_\+good\hspace{0.3cm}{\ttfamily [static]}}}\label{_t_c_p__test_8c_abca7ecb374ce72cbc9af98ab83209885}


Definition at line 356 of file T\+C\+P\+\_\+test.\+c.



Referenced by oob\+\_\+data\+\_\+callback(), and S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T().

\hypertarget{_t_c_p__test_8c_a17306a75951c9f71ee922cb4e69ff786}{\index{T\+C\+P\+\_\+test.\+c@{T\+C\+P\+\_\+test.\+c}!oob\+\_\+pubkey@{oob\+\_\+pubkey}}
\index{oob\+\_\+pubkey@{oob\+\_\+pubkey}!T\+C\+P\+\_\+test.\+c@{T\+C\+P\+\_\+test.\+c}}
\subsubsection[{oob\+\_\+pubkey}]{\setlength{\rightskip}{0pt plus 5cm}uint8\+\_\+t oob\+\_\+pubkey\mbox{[}crypto\+\_\+box\+\_\+\+P\+U\+B\+L\+I\+C\+K\+E\+Y\+B\+Y\+T\+E\+S\mbox{]}\hspace{0.3cm}{\ttfamily [static]}}}\label{_t_c_p__test_8c_a17306a75951c9f71ee922cb4e69ff786}


Definition at line 357 of file T\+C\+P\+\_\+test.\+c.



Referenced by oob\+\_\+data\+\_\+callback(), and S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T().

\hypertarget{_t_c_p__test_8c_a04e5444bf6a826487066ba973577f674}{\index{T\+C\+P\+\_\+test.\+c@{T\+C\+P\+\_\+test.\+c}!ports@{ports}}
\index{ports@{ports}!T\+C\+P\+\_\+test.\+c@{T\+C\+P\+\_\+test.\+c}}
\subsubsection[{ports}]{\setlength{\rightskip}{0pt plus 5cm}uint16\+\_\+t ports\mbox{[}{\bf N\+U\+M\+\_\+\+P\+O\+R\+T\+S}\mbox{]} = \{1234, 33445, 25643\}}}\label{_t_c_p__test_8c_a04e5444bf6a826487066ba973577f674}


Definition at line 28 of file T\+C\+P\+\_\+test.\+c.



Referenced by main(), new\+\_\+\+T\+C\+P\+\_\+con(), and S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T().

\hypertarget{_t_c_p__test_8c_a11a7f4760ef556ac61b828cb15ac883d}{\index{T\+C\+P\+\_\+test.\+c@{T\+C\+P\+\_\+test.\+c}!response\+\_\+callback\+\_\+connection\+\_\+id@{response\+\_\+callback\+\_\+connection\+\_\+id}}
\index{response\+\_\+callback\+\_\+connection\+\_\+id@{response\+\_\+callback\+\_\+connection\+\_\+id}!T\+C\+P\+\_\+test.\+c@{T\+C\+P\+\_\+test.\+c}}
\subsubsection[{response\+\_\+callback\+\_\+connection\+\_\+id}]{\setlength{\rightskip}{0pt plus 5cm}uint8\+\_\+t response\+\_\+callback\+\_\+connection\+\_\+id\hspace{0.3cm}{\ttfamily [static]}}}\label{_t_c_p__test_8c_a11a7f4760ef556ac61b828cb15ac883d}


Definition at line 308 of file T\+C\+P\+\_\+test.\+c.



Referenced by response\+\_\+callback(), and S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T().

\hypertarget{_t_c_p__test_8c_a6cc5f5429af8eac44a61d96130d90892}{\index{T\+C\+P\+\_\+test.\+c@{T\+C\+P\+\_\+test.\+c}!response\+\_\+callback\+\_\+good@{response\+\_\+callback\+\_\+good}}
\index{response\+\_\+callback\+\_\+good@{response\+\_\+callback\+\_\+good}!T\+C\+P\+\_\+test.\+c@{T\+C\+P\+\_\+test.\+c}}
\subsubsection[{response\+\_\+callback\+\_\+good}]{\setlength{\rightskip}{0pt plus 5cm}E\+N\+D\+\_\+\+T\+E\+S\+T int response\+\_\+callback\+\_\+good\hspace{0.3cm}{\ttfamily [static]}}}\label{_t_c_p__test_8c_a6cc5f5429af8eac44a61d96130d90892}


Definition at line 307 of file T\+C\+P\+\_\+test.\+c.



Referenced by response\+\_\+callback(), and S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T().

\hypertarget{_t_c_p__test_8c_a9b22a226187b8d0a3d0333c9f12d4518}{\index{T\+C\+P\+\_\+test.\+c@{T\+C\+P\+\_\+test.\+c}!response\+\_\+callback\+\_\+public\+\_\+key@{response\+\_\+callback\+\_\+public\+\_\+key}}
\index{response\+\_\+callback\+\_\+public\+\_\+key@{response\+\_\+callback\+\_\+public\+\_\+key}!T\+C\+P\+\_\+test.\+c@{T\+C\+P\+\_\+test.\+c}}
\subsubsection[{response\+\_\+callback\+\_\+public\+\_\+key}]{\setlength{\rightskip}{0pt plus 5cm}uint8\+\_\+t response\+\_\+callback\+\_\+public\+\_\+key\mbox{[}crypto\+\_\+box\+\_\+\+P\+U\+B\+L\+I\+C\+K\+E\+Y\+B\+Y\+T\+E\+S\mbox{]}\hspace{0.3cm}{\ttfamily [static]}}}\label{_t_c_p__test_8c_a9b22a226187b8d0a3d0333c9f12d4518}


Definition at line 309 of file T\+C\+P\+\_\+test.\+c.



Referenced by response\+\_\+callback(), and S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T().

\hypertarget{_t_c_p__test_8c_a785c292a23140df70c0821eba58a4349}{\index{T\+C\+P\+\_\+test.\+c@{T\+C\+P\+\_\+test.\+c}!status\+\_\+callback\+\_\+connection\+\_\+id@{status\+\_\+callback\+\_\+connection\+\_\+id}}
\index{status\+\_\+callback\+\_\+connection\+\_\+id@{status\+\_\+callback\+\_\+connection\+\_\+id}!T\+C\+P\+\_\+test.\+c@{T\+C\+P\+\_\+test.\+c}}
\subsubsection[{status\+\_\+callback\+\_\+connection\+\_\+id}]{\setlength{\rightskip}{0pt plus 5cm}uint8\+\_\+t status\+\_\+callback\+\_\+connection\+\_\+id\hspace{0.3cm}{\ttfamily [static]}}}\label{_t_c_p__test_8c_a785c292a23140df70c0821eba58a4349}


Definition at line 321 of file T\+C\+P\+\_\+test.\+c.



Referenced by S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T(), and status\+\_\+callback().

\hypertarget{_t_c_p__test_8c_a56f484ef0812f6fe7d948f2546fed8d0}{\index{T\+C\+P\+\_\+test.\+c@{T\+C\+P\+\_\+test.\+c}!status\+\_\+callback\+\_\+good@{status\+\_\+callback\+\_\+good}}
\index{status\+\_\+callback\+\_\+good@{status\+\_\+callback\+\_\+good}!T\+C\+P\+\_\+test.\+c@{T\+C\+P\+\_\+test.\+c}}
\subsubsection[{status\+\_\+callback\+\_\+good}]{\setlength{\rightskip}{0pt plus 5cm}int status\+\_\+callback\+\_\+good\hspace{0.3cm}{\ttfamily [static]}}}\label{_t_c_p__test_8c_a56f484ef0812f6fe7d948f2546fed8d0}


Definition at line 320 of file T\+C\+P\+\_\+test.\+c.



Referenced by S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T(), and status\+\_\+callback().

\hypertarget{_t_c_p__test_8c_a42d85e1f7a64f14bff24e31b09a3a4f3}{\index{T\+C\+P\+\_\+test.\+c@{T\+C\+P\+\_\+test.\+c}!status\+\_\+callback\+\_\+status@{status\+\_\+callback\+\_\+status}}
\index{status\+\_\+callback\+\_\+status@{status\+\_\+callback\+\_\+status}!T\+C\+P\+\_\+test.\+c@{T\+C\+P\+\_\+test.\+c}}
\subsubsection[{status\+\_\+callback\+\_\+status}]{\setlength{\rightskip}{0pt plus 5cm}uint8\+\_\+t status\+\_\+callback\+\_\+status\hspace{0.3cm}{\ttfamily [static]}}}\label{_t_c_p__test_8c_a42d85e1f7a64f14bff24e31b09a3a4f3}


Definition at line 322 of file T\+C\+P\+\_\+test.\+c.



Referenced by S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T(), and status\+\_\+callback().

\hypertarget{_t_c_p__test_8c_a13b39dc467dbf69283b5399761400315}{\index{T\+C\+P\+\_\+test.\+c@{T\+C\+P\+\_\+test.\+c}!tcp\+\_\+data\+\_\+callback\+\_\+called@{tcp\+\_\+data\+\_\+callback\+\_\+called}}
\index{tcp\+\_\+data\+\_\+callback\+\_\+called@{tcp\+\_\+data\+\_\+callback\+\_\+called}!T\+C\+P\+\_\+test.\+c@{T\+C\+P\+\_\+test.\+c}}
\subsubsection[{tcp\+\_\+data\+\_\+callback\+\_\+called}]{\setlength{\rightskip}{0pt plus 5cm}E\+N\+D\+\_\+\+T\+E\+S\+T \+\_\+\+Bool tcp\+\_\+data\+\_\+callback\+\_\+called}}\label{_t_c_p__test_8c_a13b39dc467dbf69283b5399761400315}


Definition at line 513 of file T\+C\+P\+\_\+test.\+c.



Referenced by S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T(), and tcp\+\_\+data\+\_\+callback().

\hypertarget{_t_c_p__test_8c_a8abafa082d888febbe0d3999d7799cc6}{\index{T\+C\+P\+\_\+test.\+c@{T\+C\+P\+\_\+test.\+c}!tcp\+\_\+oobdata\+\_\+callback\+\_\+called@{tcp\+\_\+oobdata\+\_\+callback\+\_\+called}}
\index{tcp\+\_\+oobdata\+\_\+callback\+\_\+called@{tcp\+\_\+oobdata\+\_\+callback\+\_\+called}!T\+C\+P\+\_\+test.\+c@{T\+C\+P\+\_\+test.\+c}}
\subsubsection[{tcp\+\_\+oobdata\+\_\+callback\+\_\+called}]{\setlength{\rightskip}{0pt plus 5cm}E\+N\+D\+\_\+\+T\+E\+S\+T \+\_\+\+Bool tcp\+\_\+oobdata\+\_\+callback\+\_\+called}}\label{_t_c_p__test_8c_a8abafa082d888febbe0d3999d7799cc6}


Definition at line 618 of file T\+C\+P\+\_\+test.\+c.



Referenced by S\+T\+A\+R\+T\+\_\+\+T\+E\+S\+T(), and tcp\+\_\+oobdata\+\_\+callback().

