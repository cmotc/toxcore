\hypertarget{msi_8c}{\section{toxav/msi.c File Reference}
\label{msi_8c}\index{toxav/msi.\+c@{toxav/msi.\+c}}
}
{\ttfamily \#include \char`\"{}msi.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}../toxcore/logger.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}../toxcore/util.\+h\char`\"{}}\\*
{\ttfamily \#include $<$unistd.\+h$>$}\\*
{\ttfamily \#include $<$string.\+h$>$}\\*
{\ttfamily \#include $<$stdlib.\+h$>$}\\*
{\ttfamily \#include $<$stdbool.\+h$>$}\\*
Include dependency graph for msi.\+c\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d4/d25/msi_8c__incl}
\end{center}
\end{figure}
\subsection*{Data Structures}
\begin{DoxyCompactItemize}
\item 
struct \hyperlink{struct___m_s_i_message}{\+\_\+\+M\+S\+I\+Message}
\item 
struct \hyperlink{struct___timer}{\+\_\+\+Timer}
\item 
struct \hyperlink{struct___timer_handler}{\+\_\+\+Timer\+Handler}
\end{DoxyCompactItemize}
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{msi_8c_a8df39ace36437e03047c050b2580536b}{M\+S\+I\+\_\+\+M\+A\+X\+M\+S\+G\+\_\+\+S\+I\+Z\+E}~256
\item 
\#define \hyperlink{msi_8c_a41cb7a80dff15699d766e4364228a47c}{m\+\_\+deftout}~10000 /$\ast$ in milliseconds $\ast$/
\item 
\#define \hyperlink{msi_8c_a457a5bfbddb08fdde4cb8854616a088c}{G\+E\+N\+E\+R\+I\+C\+\_\+\+H\+E\+A\+D\+E\+R}(header, val\+\_\+type)
\item 
\#define \hyperlink{msi_8c_a3785df56bb359bc7613cfab5f08dd94b}{F\+A\+I\+L\+\_\+\+C\+O\+N\+S\+T\+R\+A\+I\+N\+T}(constraint, wanted)~if ((constraint -\/= wanted) $<$ 1) \{ \hyperlink{logger_8h_aedad6a1e3ffe0d4cd0992b822ec0eeeb}{L\+O\+G\+G\+E\+R\+\_\+\+E\+R\+R\+O\+R}(\char`\"{}Read over length!\char`\"{}); return -\/1; \}
\item 
\#define \hyperlink{msi_8c_a57143c0fea08f509ce3d4be05a051a44}{F\+A\+I\+L\+\_\+\+S\+I\+Z\+E}(byte, valid)~if ( byte != valid ) \{ \hyperlink{logger_8h_aedad6a1e3ffe0d4cd0992b822ec0eeeb}{L\+O\+G\+G\+E\+R\+\_\+\+E\+R\+R\+O\+R}(\char`\"{}Invalid data size!\char`\"{}); return -\/1; \}
\item 
\#define \hyperlink{msi_8c_abf9b878e14616e9d2c224646f1096fd1}{F\+A\+I\+L\+\_\+\+L\+I\+M\+I\+T\+S}(byte, high)~if ( byte $>$ high ) \{ \hyperlink{logger_8h_aedad6a1e3ffe0d4cd0992b822ec0eeeb}{L\+O\+G\+G\+E\+R\+\_\+\+E\+R\+R\+O\+R}(\char`\"{}Failed limit!\char`\"{}); return -\/1; \}
\end{DoxyCompactItemize}
\subsection*{Typedefs}
\begin{DoxyCompactItemize}
\item 
typedef uint8\+\_\+t \hyperlink{msi_8c_a1eaa1b2e6ca0fb65790e2e7e0dd62735}{M\+S\+I\+Raw\+C\+Settings\+Type} \mbox{[}23\mbox{]}
\item 
typedef struct \hyperlink{struct___m_s_i_message}{\+\_\+\+M\+S\+I\+Message} \hyperlink{msi_8c_a1440d42a36a5734a5876b98e87ad66aa}{M\+S\+I\+Message}
\item 
typedef struct \hyperlink{struct___timer}{\+\_\+\+Timer} \hyperlink{msi_8c_a331ddf64cc0ad62ea466e7cc2d010a5c}{Timer}
\item 
typedef struct \hyperlink{struct___timer_handler}{\+\_\+\+Timer\+Handler} \hyperlink{msi_8c_a7b7cb3325d6f27e4cefb0d97e776733d}{Timer\+Handler}
\end{DoxyCompactItemize}
\subsection*{Enumerations}
\begin{DoxyCompactItemize}
\item 
enum \hyperlink{msi_8c_a54be6a6ec118139a2cd0a21e490a7deb}{M\+S\+I\+Header\+I\+D} \{ \\*
\hyperlink{msi_8c_a54be6a6ec118139a2cd0a21e490a7deba8d1bbc36c628c8c70dd0b5343064118d}{I\+D\+Request} = 1, 
\hyperlink{msi_8c_a54be6a6ec118139a2cd0a21e490a7deba569155714fc04f9d3d70224ab8fb700a}{I\+D\+Response}, 
\hyperlink{msi_8c_a54be6a6ec118139a2cd0a21e490a7deba377727aa6f1757d466f0d62d169debd0}{I\+D\+Reason}, 
\hyperlink{msi_8c_a54be6a6ec118139a2cd0a21e490a7deba59f19c1ff36c01aed8f32835fa655ee2}{I\+D\+Call\+Id}, 
\\*
\hyperlink{msi_8c_a54be6a6ec118139a2cd0a21e490a7deba6e1521034cf248217314e040e34dc595}{I\+D\+C\+Settings}
 \}
\item 
enum \hyperlink{msi_8c_a6557c179987e0c84ccb97c9f29a302ef}{M\+S\+I\+Message\+Type} \{ \hyperlink{msi_8c_a6557c179987e0c84ccb97c9f29a302efa3bc11c46b5beb3df428936d6f53b03f7}{Type\+Request}, 
\hyperlink{msi_8c_a6557c179987e0c84ccb97c9f29a302efa44af861e1cb1f54554d3a48a9dfa343b}{Type\+Response}
 \}
\item 
enum \hyperlink{msi_8c_ae511d1f1e345bb77cd4120b39679f028}{M\+S\+I\+Request} \{ \\*
\hyperlink{msi_8c_ae511d1f1e345bb77cd4120b39679f028a1626b80e8928e701cbf05e1794eb4504}{invite}, 
\hyperlink{msi_8c_ae511d1f1e345bb77cd4120b39679f028a0e97c69c73117f6c0109b2d7d1d9cedc}{start}, 
\hyperlink{msi_8c_ae511d1f1e345bb77cd4120b39679f028afa28df73c87d81742155531f0f36dc71}{cancel}, 
\hyperlink{msi_8c_ae511d1f1e345bb77cd4120b39679f028ac3938f36421013c679a406260a404daa}{reject}, 
\\*
\hyperlink{msi_8c_ae511d1f1e345bb77cd4120b39679f028a80b1a820e533d7cf0e1715319339e6d0}{end}
 \}
\item 
enum \hyperlink{msi_8c_a7251f9a01631fc788dd7c8eff23a422e}{M\+S\+I\+Response} \{ \hyperlink{msi_8c_a7251f9a01631fc788dd7c8eff23a422eaa27786b5857031d78494d47532ecbb78}{ringing}, 
\hyperlink{msi_8c_a7251f9a01631fc788dd7c8eff23a422ea658598d69535d5877bf2fa0af0dcfafa}{starting}, 
\hyperlink{msi_8c_a7251f9a01631fc788dd7c8eff23a422ea6135603307626f48d62e2faa86a1d255}{ending}, 
\hyperlink{msi_8c_a7251f9a01631fc788dd7c8eff23a422ead606e435413ea0944dd00d49e901e4ed}{error}
 \}
\item 
enum \hyperlink{msi_8c_ab543e56b09aa092d084f4da3ae646423}{M\+S\+I\+Call\+Error} \{ \\*
\hyperlink{msi_8c_ab543e56b09aa092d084f4da3ae646423a021380030e124f879f67daf259d571fa}{error\+\_\+none}, 
\hyperlink{msi_8c_ab543e56b09aa092d084f4da3ae646423add2eb51143f096a20fe26e491617ca9f}{error\+\_\+deadcall}, 
\hyperlink{msi_8c_ab543e56b09aa092d084f4da3ae646423a374ca3bb8847b31bda31bb279096f76d}{error\+\_\+id\+\_\+mismatch}, 
\hyperlink{msi_8c_ab543e56b09aa092d084f4da3ae646423af1013422b03a404f37f53cdacca18dea}{error\+\_\+no\+\_\+callid}, 
\\*
\hyperlink{msi_8c_ab543e56b09aa092d084f4da3ae646423a12308009882b0e18008b8f483ec1b819}{error\+\_\+no\+\_\+call}, 
\hyperlink{msi_8c_ab543e56b09aa092d084f4da3ae646423abad69fa094c03be3b9c71858b9bef066}{error\+\_\+no\+\_\+crypto\+\_\+key}, 
\hyperlink{msi_8c_ab543e56b09aa092d084f4da3ae646423a4d9b7fd794c2916ff10e69f9fc801466}{error\+\_\+busy}
 \}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
static void \hyperlink{msi_8c_af6701ab999e1734c40580997749daf6f}{invoke\+\_\+callback} (\hyperlink{msi_8h_adc69aa9b8f2f21b2b54e542cc9bb4329}{M\+S\+I\+Session} $\ast$s, int32\+\_\+t c, \hyperlink{msi_8h_aba083d202aa40ee6d37db924fe486401}{M\+S\+I\+Callback\+I\+D} \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i})
\item 
static int \hyperlink{msi_8c_af39b54cd1086b4efb315083874e5e9ed}{parse\+\_\+raw\+\_\+data} (\hyperlink{msi_8c_a1440d42a36a5734a5876b98e87ad66aa}{M\+S\+I\+Message} $\ast$msg, const uint8\+\_\+t $\ast$data, uint16\+\_\+t length)
\item 
\hyperlink{msi_8c_a1440d42a36a5734a5876b98e87ad66aa}{M\+S\+I\+Message} $\ast$ \hyperlink{msi_8c_aed030e510836ee3cc994f84f06a0cc98}{msi\+\_\+new\+\_\+message} (\hyperlink{msi_8c_a6557c179987e0c84ccb97c9f29a302ef}{M\+S\+I\+Message\+Type} type, const uint8\+\_\+t type\+\_\+value)
\item 
\hyperlink{msi_8c_a1440d42a36a5734a5876b98e87ad66aa}{M\+S\+I\+Message} $\ast$ \hyperlink{msi_8c_a7941e06f6114e6d26a9c0538c941eb8a}{parse\+\_\+recv} (const uint8\+\_\+t $\ast$data, uint16\+\_\+t length)
\item 
uint8\+\_\+t $\ast$ \hyperlink{msi_8c_acd3f86de9a0df45caf147b8a095a89a0}{format\+\_\+output} (uint8\+\_\+t $\ast$dest, \hyperlink{msi_8c_a54be6a6ec118139a2cd0a21e490a7deb}{M\+S\+I\+Header\+I\+D} id, const void $\ast$value, uint8\+\_\+t value\+\_\+len, uint16\+\_\+t $\ast$length)
\item 
uint16\+\_\+t \hyperlink{msi_8c_aea77316761ab5ed482dc78f727ee9c76}{parse\+\_\+send} (\hyperlink{msi_8c_a1440d42a36a5734a5876b98e87ad66aa}{M\+S\+I\+Message} $\ast$msg, uint8\+\_\+t $\ast$dest)
\item 
void \hyperlink{msi_8c_abc73c78a9121c32f35e4847af962c889}{msi\+\_\+msg\+\_\+set\+\_\+reason} (\hyperlink{msi_8c_a1440d42a36a5734a5876b98e87ad66aa}{M\+S\+I\+Message} $\ast$msg, const \hyperlink{msi_8h_acc1e8c2d1829721c4addd8547458c9db}{M\+S\+I\+Reason\+Str\+Type} value)
\item 
void \hyperlink{msi_8c_a16a648334fa4007ea0d39927bd89eb0b}{msi\+\_\+msg\+\_\+set\+\_\+callid} (\hyperlink{msi_8c_a1440d42a36a5734a5876b98e87ad66aa}{M\+S\+I\+Message} $\ast$msg, const \hyperlink{msi_8h_a861af5c5c180987c1c86739b4321076c}{M\+S\+I\+Call\+I\+D\+Type} value)
\item 
void \hyperlink{msi_8c_ad8cf444077a0744601cf9107fbb6dbb8}{msi\+\_\+msg\+\_\+set\+\_\+csettings} (\hyperlink{msi_8c_a1440d42a36a5734a5876b98e87ad66aa}{M\+S\+I\+Message} $\ast$msg, const \hyperlink{msi_8h_abe548d26a24458ebf9ab33310ee19600}{M\+S\+I\+C\+Settings} $\ast$value)
\item 
void \hyperlink{msi_8c_a1d6d84b54016402734b0bc352f654699}{msi\+\_\+msg\+\_\+get\+\_\+csettings} (\hyperlink{msi_8c_a1440d42a36a5734a5876b98e87ad66aa}{M\+S\+I\+Message} $\ast$msg, \hyperlink{msi_8h_abe548d26a24458ebf9ab33310ee19600}{M\+S\+I\+C\+Settings} $\ast$dest)
\item 
static int \hyperlink{msi_8c_a0a093063a8a2e48ca88d8d47234415cb}{timer\+\_\+alloc} (\hyperlink{msi_8h_adc69aa9b8f2f21b2b54e542cc9bb4329}{M\+S\+I\+Session} $\ast$session, void($\ast$func)(\hyperlink{msi_8c_a331ddf64cc0ad62ea466e7cc2d010a5c}{Timer} $\ast$), int call\+\_\+idx, uint32\+\_\+t timeout)
\item 
static int \hyperlink{msi_8c_ab6f36f5852629fabd6e3c85451e5be65}{timer\+\_\+release} (\hyperlink{msi_8c_a7b7cb3325d6f27e4cefb0d97e776733d}{Timer\+Handler} $\ast$timers\+\_\+container, int id)
\item 
static void \hyperlink{msi_8c_acab20b1c203cf44d500df2307b62ae9c}{t\+\_\+randomstr} (uint8\+\_\+t $\ast$str, uint32\+\_\+t size)
\item 
static const uint8\+\_\+t $\ast$ \hyperlink{msi_8c_af3fb90754ded4536f9314f5d48e477e5}{stringify\+\_\+error} (\hyperlink{msi_8c_ab543e56b09aa092d084f4da3ae646423}{M\+S\+I\+Call\+Error} error\+\_\+code)
\item 
static int \hyperlink{msi_8c_ae174427d97e924339f9e2a961ec773a1}{send\+\_\+message} (\hyperlink{msi_8h_adc69aa9b8f2f21b2b54e542cc9bb4329}{M\+S\+I\+Session} $\ast$session, \hyperlink{msi_8h_abec1a89deb19c1a1494d473b613e76eb}{M\+S\+I\+Call} $\ast$call, \hyperlink{msi_8c_a1440d42a36a5734a5876b98e87ad66aa}{M\+S\+I\+Message} $\ast$msg, uint32\+\_\+t to)
\item 
static int \hyperlink{msi_8c_aeac54d94bd4b3bfceab3a080cbf5e100}{send\+\_\+reponse} (\hyperlink{msi_8h_adc69aa9b8f2f21b2b54e542cc9bb4329}{M\+S\+I\+Session} $\ast$session, \hyperlink{msi_8h_abec1a89deb19c1a1494d473b613e76eb}{M\+S\+I\+Call} $\ast$call, \hyperlink{msi_8c_a7251f9a01631fc788dd7c8eff23a422e}{M\+S\+I\+Response} response, uint32\+\_\+t to)
\item 
static int \hyperlink{msi_8c_a61759c89740aba4cdeea164816115d32}{send\+\_\+error} (\hyperlink{msi_8h_adc69aa9b8f2f21b2b54e542cc9bb4329}{M\+S\+I\+Session} $\ast$session, \hyperlink{msi_8h_abec1a89deb19c1a1494d473b613e76eb}{M\+S\+I\+Call} $\ast$call, \hyperlink{msi_8c_ab543e56b09aa092d084f4da3ae646423}{M\+S\+I\+Call\+Error} errid, uint32\+\_\+t to)
\item 
static int \hyperlink{msi_8c_a9511a4026ab002ee24e988df1829f67b}{call\+\_\+id\+\_\+bigger} (const uint8\+\_\+t $\ast$\hyperlink{onion__test_8c_a49c185b8248f424bbab4359e461ae734}{first}, const uint8\+\_\+t $\ast$second)
\item 
static int \hyperlink{msi_8c_a92f71169666532a395aa396591e0426e}{flush\+\_\+peer\+\_\+csettings} (\hyperlink{msi_8h_abec1a89deb19c1a1494d473b613e76eb}{M\+S\+I\+Call} $\ast$call, \hyperlink{msi_8c_a1440d42a36a5734a5876b98e87ad66aa}{M\+S\+I\+Message} $\ast$msg, int peer\+\_\+id)
\item 
static void \hyperlink{msi_8c_ae93f60c5c6d4713db189c4059e36e4c1}{add\+\_\+peer} (\hyperlink{msi_8h_abec1a89deb19c1a1494d473b613e76eb}{M\+S\+I\+Call} $\ast$call, int peer\+\_\+id)
\item 
static \hyperlink{msi_8h_abec1a89deb19c1a1494d473b613e76eb}{M\+S\+I\+Call} $\ast$ \hyperlink{msi_8c_aecbf66ee30b2ec4003caed2455e4c02d}{find\+\_\+call} (\hyperlink{msi_8h_adc69aa9b8f2f21b2b54e542cc9bb4329}{M\+S\+I\+Session} $\ast$session, uint8\+\_\+t $\ast$call\+\_\+id)
\item 
static \hyperlink{msi_8h_abec1a89deb19c1a1494d473b613e76eb}{M\+S\+I\+Call} $\ast$ \hyperlink{msi_8c_adac49290dc2c80bd0921ffbedb78966f}{init\+\_\+call} (\hyperlink{msi_8h_adc69aa9b8f2f21b2b54e542cc9bb4329}{M\+S\+I\+Session} $\ast$session, int peers, int ringing\+\_\+timeout)
\item 
static int \hyperlink{msi_8c_abf7deacfacdcb5b7cc4cfc163583c40d}{terminate\+\_\+call} (\hyperlink{msi_8h_adc69aa9b8f2f21b2b54e542cc9bb4329}{M\+S\+I\+Session} $\ast$session, \hyperlink{msi_8h_abec1a89deb19c1a1494d473b613e76eb}{M\+S\+I\+Call} $\ast$call)
\item 
static void \hyperlink{msi_8c_a4d438c93388bdd8b338bd50632144de5}{handle\+\_\+remote\+\_\+connection\+\_\+change} (\hyperlink{struct_messenger}{Messenger} $\ast$messenger, uint32\+\_\+t friend\+\_\+num, uint8\+\_\+t status, void $\ast$session\+\_\+p)
\item 
static void \hyperlink{msi_8c_a7a5b1246a4f5680ee60c45e69e04dcd4}{handle\+\_\+timeout} (\hyperlink{msi_8c_a331ddf64cc0ad62ea466e7cc2d010a5c}{Timer} $\ast$timer)
\item 
static int \hyperlink{msi_8c_a6c1d69163b2cfedea11ed5ed688dc669}{handle\+\_\+recv\+\_\+invite} (\hyperlink{msi_8h_adc69aa9b8f2f21b2b54e542cc9bb4329}{M\+S\+I\+Session} $\ast$session, \hyperlink{msi_8h_abec1a89deb19c1a1494d473b613e76eb}{M\+S\+I\+Call} $\ast$call, \hyperlink{msi_8c_a1440d42a36a5734a5876b98e87ad66aa}{M\+S\+I\+Message} $\ast$msg)
\item 
static int \hyperlink{msi_8c_a4d75b79b31c9451a723522b891ec75fd}{handle\+\_\+recv\+\_\+start} (\hyperlink{msi_8h_adc69aa9b8f2f21b2b54e542cc9bb4329}{M\+S\+I\+Session} $\ast$session, \hyperlink{msi_8h_abec1a89deb19c1a1494d473b613e76eb}{M\+S\+I\+Call} $\ast$call, \hyperlink{msi_8c_a1440d42a36a5734a5876b98e87ad66aa}{M\+S\+I\+Message} $\ast$msg)
\item 
static int \hyperlink{msi_8c_adab5cbd8d80ff38f19008ee3fec808b8}{handle\+\_\+recv\+\_\+reject} (\hyperlink{msi_8h_adc69aa9b8f2f21b2b54e542cc9bb4329}{M\+S\+I\+Session} $\ast$session, \hyperlink{msi_8h_abec1a89deb19c1a1494d473b613e76eb}{M\+S\+I\+Call} $\ast$call, \hyperlink{msi_8c_a1440d42a36a5734a5876b98e87ad66aa}{M\+S\+I\+Message} $\ast$msg)
\item 
static int \hyperlink{msi_8c_ac97b77c7ecac429b769a3e7b54047d1f}{handle\+\_\+recv\+\_\+cancel} (\hyperlink{msi_8h_adc69aa9b8f2f21b2b54e542cc9bb4329}{M\+S\+I\+Session} $\ast$session, \hyperlink{msi_8h_abec1a89deb19c1a1494d473b613e76eb}{M\+S\+I\+Call} $\ast$call, \hyperlink{msi_8c_a1440d42a36a5734a5876b98e87ad66aa}{M\+S\+I\+Message} $\ast$msg)
\item 
static int \hyperlink{msi_8c_a94cb98234fb1cdeffe8ad8b8601c8dc9}{handle\+\_\+recv\+\_\+end} (\hyperlink{msi_8h_adc69aa9b8f2f21b2b54e542cc9bb4329}{M\+S\+I\+Session} $\ast$session, \hyperlink{msi_8h_abec1a89deb19c1a1494d473b613e76eb}{M\+S\+I\+Call} $\ast$call, \hyperlink{msi_8c_a1440d42a36a5734a5876b98e87ad66aa}{M\+S\+I\+Message} $\ast$msg)
\item 
static int \hyperlink{msi_8c_ac4fd005ce0f0c990e7982acd92e341e3}{handle\+\_\+recv\+\_\+ringing} (\hyperlink{msi_8h_adc69aa9b8f2f21b2b54e542cc9bb4329}{M\+S\+I\+Session} $\ast$session, \hyperlink{msi_8h_abec1a89deb19c1a1494d473b613e76eb}{M\+S\+I\+Call} $\ast$call, \hyperlink{msi_8c_a1440d42a36a5734a5876b98e87ad66aa}{M\+S\+I\+Message} $\ast$msg)
\item 
static int \hyperlink{msi_8c_ada9b9ef63c3c73e22b672d7cfb5bd6a3}{handle\+\_\+recv\+\_\+starting} (\hyperlink{msi_8h_adc69aa9b8f2f21b2b54e542cc9bb4329}{M\+S\+I\+Session} $\ast$session, \hyperlink{msi_8h_abec1a89deb19c1a1494d473b613e76eb}{M\+S\+I\+Call} $\ast$call, \hyperlink{msi_8c_a1440d42a36a5734a5876b98e87ad66aa}{M\+S\+I\+Message} $\ast$msg)
\item 
static int \hyperlink{msi_8c_ae71247b244dc60d6f5ce9de8b26365db}{handle\+\_\+recv\+\_\+ending} (\hyperlink{msi_8h_adc69aa9b8f2f21b2b54e542cc9bb4329}{M\+S\+I\+Session} $\ast$session, \hyperlink{msi_8h_abec1a89deb19c1a1494d473b613e76eb}{M\+S\+I\+Call} $\ast$call, \hyperlink{msi_8c_a1440d42a36a5734a5876b98e87ad66aa}{M\+S\+I\+Message} $\ast$msg)
\item 
static int \hyperlink{msi_8c_aa2af3e4ed6abb65d7b747763a41a1b70}{handle\+\_\+recv\+\_\+error} (\hyperlink{msi_8h_adc69aa9b8f2f21b2b54e542cc9bb4329}{M\+S\+I\+Session} $\ast$session, \hyperlink{msi_8h_abec1a89deb19c1a1494d473b613e76eb}{M\+S\+I\+Call} $\ast$call, \hyperlink{msi_8c_a1440d42a36a5734a5876b98e87ad66aa}{M\+S\+I\+Message} $\ast$msg)
\item 
static void \hyperlink{msi_8c_aa944624a15314d9d2eff6373f9506725}{msi\+\_\+handle\+\_\+packet} (\hyperlink{struct_messenger}{Messenger} $\ast$messenger, uint32\+\_\+t source, const uint8\+\_\+t $\ast$data, uint16\+\_\+t length, void $\ast$object)
\item 
void \hyperlink{msi_8c_a1121e56554f776e97436cc9a6a3769c4}{msi\+\_\+register\+\_\+callback} (\hyperlink{msi_8h_adc69aa9b8f2f21b2b54e542cc9bb4329}{M\+S\+I\+Session} $\ast$session, \hyperlink{msi_8h_afe514f5cbbbb1153f50ab068d405b864}{M\+S\+I\+Callback\+Type} callback, \hyperlink{msi_8h_aba083d202aa40ee6d37db924fe486401}{M\+S\+I\+Callback\+I\+D} id, void $\ast$userdata)
\item 
\hyperlink{msi_8h_adc69aa9b8f2f21b2b54e542cc9bb4329}{M\+S\+I\+Session} $\ast$ \hyperlink{msi_8c_af33f2706f6d0f8e547716e2f6c5f68d3}{msi\+\_\+new} (\hyperlink{struct_messenger}{Messenger} $\ast$messenger, int32\+\_\+t max\+\_\+calls)
\item 
int \hyperlink{msi_8c_a85e4f629815819ee2abed82041bd9436}{msi\+\_\+kill} (\hyperlink{msi_8h_adc69aa9b8f2f21b2b54e542cc9bb4329}{M\+S\+I\+Session} $\ast$session)
\item 
int \hyperlink{msi_8c_a9f714a4729f22ca5810ff0ee89313fab}{msi\+\_\+invite} (\hyperlink{msi_8h_adc69aa9b8f2f21b2b54e542cc9bb4329}{M\+S\+I\+Session} $\ast$session, int32\+\_\+t $\ast$call\+\_\+index, const \hyperlink{msi_8h_abe548d26a24458ebf9ab33310ee19600}{M\+S\+I\+C\+Settings} $\ast$csettings, uint32\+\_\+t rngsec, uint32\+\_\+t \hyperlink{messenger__test_8c_a5d7925718457bca84bda0952f9463a3c}{friend\+\_\+id})
\item 
int \hyperlink{msi_8c_a8023a8417a3e79e382a9ff3d99cdd24a}{msi\+\_\+hangup} (\hyperlink{msi_8h_adc69aa9b8f2f21b2b54e542cc9bb4329}{M\+S\+I\+Session} $\ast$session, int32\+\_\+t call\+\_\+index)
\item 
int \hyperlink{msi_8c_a3cf8337cde29970de207c3c77c953261}{msi\+\_\+answer} (\hyperlink{msi_8h_adc69aa9b8f2f21b2b54e542cc9bb4329}{M\+S\+I\+Session} $\ast$session, int32\+\_\+t call\+\_\+index, const \hyperlink{msi_8h_abe548d26a24458ebf9ab33310ee19600}{M\+S\+I\+C\+Settings} $\ast$csettings)
\item 
int \hyperlink{msi_8c_aefbf5f591676d4b56853b21fdf215e69}{msi\+\_\+cancel} (\hyperlink{msi_8h_adc69aa9b8f2f21b2b54e542cc9bb4329}{M\+S\+I\+Session} $\ast$session, int32\+\_\+t call\+\_\+index, uint32\+\_\+t peer, const char $\ast$reason)
\item 
int \hyperlink{msi_8c_a9d846fba046c8539b9e183cc01a25fe9}{msi\+\_\+reject} (\hyperlink{msi_8h_adc69aa9b8f2f21b2b54e542cc9bb4329}{M\+S\+I\+Session} $\ast$session, int32\+\_\+t call\+\_\+index, const char $\ast$reason)
\item 
int \hyperlink{msi_8c_a4d2aa9bfe7f4a96275204f2797d6e7eb}{msi\+\_\+stopcall} (\hyperlink{msi_8h_adc69aa9b8f2f21b2b54e542cc9bb4329}{M\+S\+I\+Session} $\ast$session, int32\+\_\+t call\+\_\+index)
\item 
int \hyperlink{msi_8c_ad82b81e88f4a912b7ec492baf6ab7ea8}{msi\+\_\+change\+\_\+csettings} (\hyperlink{msi_8h_adc69aa9b8f2f21b2b54e542cc9bb4329}{M\+S\+I\+Session} $\ast$session, int32\+\_\+t call\+\_\+index, const \hyperlink{msi_8h_abe548d26a24458ebf9ab33310ee19600}{M\+S\+I\+C\+Settings} $\ast$csettings)
\item 
void \hyperlink{msi_8c_a6596ff23a6bcdd19c4fa1985dcc6b257}{msi\+\_\+do} (\hyperlink{msi_8h_adc69aa9b8f2f21b2b54e542cc9bb4329}{M\+S\+I\+Session} $\ast$session)
\end{DoxyCompactItemize}


\subsection{Macro Definition Documentation}
\hypertarget{msi_8c_a3785df56bb359bc7613cfab5f08dd94b}{\index{msi.\+c@{msi.\+c}!F\+A\+I\+L\+\_\+\+C\+O\+N\+S\+T\+R\+A\+I\+N\+T@{F\+A\+I\+L\+\_\+\+C\+O\+N\+S\+T\+R\+A\+I\+N\+T}}
\index{F\+A\+I\+L\+\_\+\+C\+O\+N\+S\+T\+R\+A\+I\+N\+T@{F\+A\+I\+L\+\_\+\+C\+O\+N\+S\+T\+R\+A\+I\+N\+T}!msi.\+c@{msi.\+c}}
\subsubsection[{F\+A\+I\+L\+\_\+\+C\+O\+N\+S\+T\+R\+A\+I\+N\+T}]{\setlength{\rightskip}{0pt plus 5cm}\#define F\+A\+I\+L\+\_\+\+C\+O\+N\+S\+T\+R\+A\+I\+N\+T(
\begin{DoxyParamCaption}
\item[{}]{constraint, }
\item[{}]{wanted}
\end{DoxyParamCaption}
)~if ((constraint -\/= wanted) $<$ 1) \{ {\bf L\+O\+G\+G\+E\+R\+\_\+\+E\+R\+R\+O\+R}(\char`\"{}Read over length!\char`\"{}); return -\/1; \}}}\label{msi_8c_a3785df56bb359bc7613cfab5f08dd94b}


Referenced by parse\+\_\+raw\+\_\+data().

\hypertarget{msi_8c_abf9b878e14616e9d2c224646f1096fd1}{\index{msi.\+c@{msi.\+c}!F\+A\+I\+L\+\_\+\+L\+I\+M\+I\+T\+S@{F\+A\+I\+L\+\_\+\+L\+I\+M\+I\+T\+S}}
\index{F\+A\+I\+L\+\_\+\+L\+I\+M\+I\+T\+S@{F\+A\+I\+L\+\_\+\+L\+I\+M\+I\+T\+S}!msi.\+c@{msi.\+c}}
\subsubsection[{F\+A\+I\+L\+\_\+\+L\+I\+M\+I\+T\+S}]{\setlength{\rightskip}{0pt plus 5cm}\#define F\+A\+I\+L\+\_\+\+L\+I\+M\+I\+T\+S(
\begin{DoxyParamCaption}
\item[{}]{byte, }
\item[{}]{high}
\end{DoxyParamCaption}
)~if ( byte $>$ high ) \{ {\bf L\+O\+G\+G\+E\+R\+\_\+\+E\+R\+R\+O\+R}(\char`\"{}Failed limit!\char`\"{}); return -\/1; \}}}\label{msi_8c_abf9b878e14616e9d2c224646f1096fd1}


Referenced by parse\+\_\+raw\+\_\+data().

\hypertarget{msi_8c_a57143c0fea08f509ce3d4be05a051a44}{\index{msi.\+c@{msi.\+c}!F\+A\+I\+L\+\_\+\+S\+I\+Z\+E@{F\+A\+I\+L\+\_\+\+S\+I\+Z\+E}}
\index{F\+A\+I\+L\+\_\+\+S\+I\+Z\+E@{F\+A\+I\+L\+\_\+\+S\+I\+Z\+E}!msi.\+c@{msi.\+c}}
\subsubsection[{F\+A\+I\+L\+\_\+\+S\+I\+Z\+E}]{\setlength{\rightskip}{0pt plus 5cm}\#define F\+A\+I\+L\+\_\+\+S\+I\+Z\+E(
\begin{DoxyParamCaption}
\item[{}]{byte, }
\item[{}]{valid}
\end{DoxyParamCaption}
)~if ( byte != valid ) \{ {\bf L\+O\+G\+G\+E\+R\+\_\+\+E\+R\+R\+O\+R}(\char`\"{}Invalid data size!\char`\"{}); return -\/1; \}}}\label{msi_8c_a57143c0fea08f509ce3d4be05a051a44}


Referenced by parse\+\_\+raw\+\_\+data().

\hypertarget{msi_8c_a457a5bfbddb08fdde4cb8854616a088c}{\index{msi.\+c@{msi.\+c}!G\+E\+N\+E\+R\+I\+C\+\_\+\+H\+E\+A\+D\+E\+R@{G\+E\+N\+E\+R\+I\+C\+\_\+\+H\+E\+A\+D\+E\+R}}
\index{G\+E\+N\+E\+R\+I\+C\+\_\+\+H\+E\+A\+D\+E\+R@{G\+E\+N\+E\+R\+I\+C\+\_\+\+H\+E\+A\+D\+E\+R}!msi.\+c@{msi.\+c}}
\subsubsection[{G\+E\+N\+E\+R\+I\+C\+\_\+\+H\+E\+A\+D\+E\+R}]{\setlength{\rightskip}{0pt plus 5cm}\#define G\+E\+N\+E\+R\+I\+C\+\_\+\+H\+E\+A\+D\+E\+R(
\begin{DoxyParamCaption}
\item[{}]{header, }
\item[{}]{val\+\_\+type}
\end{DoxyParamCaption}
)}}\label{msi_8c_a457a5bfbddb08fdde4cb8854616a088c}
{\bfseries Value\+:}
\begin{DoxyCode}
\textcolor{keyword}{typedef} \textcolor{keyword}{struct }\_MSIHeader##header \{ \(\backslash\)
val\_type value; \(\backslash\)
\_Bool exists; \(\backslash\)
\} MSIHeader##header;
\end{DoxyCode}


Definition at line 85 of file msi.\+c.

\hypertarget{msi_8c_a41cb7a80dff15699d766e4364228a47c}{\index{msi.\+c@{msi.\+c}!m\+\_\+deftout@{m\+\_\+deftout}}
\index{m\+\_\+deftout@{m\+\_\+deftout}!msi.\+c@{msi.\+c}}
\subsubsection[{m\+\_\+deftout}]{\setlength{\rightskip}{0pt plus 5cm}\#define m\+\_\+deftout~10000 /$\ast$ in milliseconds $\ast$/}}\label{msi_8c_a41cb7a80dff15699d766e4364228a47c}


Definition at line 42 of file msi.\+c.



Referenced by msi\+\_\+hangup(), msi\+\_\+invite(), and msi\+\_\+reject().

\hypertarget{msi_8c_a8df39ace36437e03047c050b2580536b}{\index{msi.\+c@{msi.\+c}!M\+S\+I\+\_\+\+M\+A\+X\+M\+S\+G\+\_\+\+S\+I\+Z\+E@{M\+S\+I\+\_\+\+M\+A\+X\+M\+S\+G\+\_\+\+S\+I\+Z\+E}}
\index{M\+S\+I\+\_\+\+M\+A\+X\+M\+S\+G\+\_\+\+S\+I\+Z\+E@{M\+S\+I\+\_\+\+M\+A\+X\+M\+S\+G\+\_\+\+S\+I\+Z\+E}!msi.\+c@{msi.\+c}}
\subsubsection[{M\+S\+I\+\_\+\+M\+A\+X\+M\+S\+G\+\_\+\+S\+I\+Z\+E}]{\setlength{\rightskip}{0pt plus 5cm}\#define M\+S\+I\+\_\+\+M\+A\+X\+M\+S\+G\+\_\+\+S\+I\+Z\+E~256}}\label{msi_8c_a8df39ace36437e03047c050b2580536b}
\hyperlink{msi_8c}{msi.\+c}

Copyright (C) 2013 Tox project All Rights Reserved.

This file is part of Tox.

Tox is free software\+: you can redistribute it and/or modify it under the terms of the G\+N\+U General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.

Tox is distributed in the hope that it will be useful, but W\+I\+T\+H\+O\+U\+T A\+N\+Y W\+A\+R\+R\+A\+N\+T\+Y; without even the implied warranty of M\+E\+R\+C\+H\+A\+N\+T\+A\+B\+I\+L\+I\+T\+Y or F\+I\+T\+N\+E\+S\+S F\+O\+R A P\+A\+R\+T\+I\+C\+U\+L\+A\+R P\+U\+R\+P\+O\+S\+E. See the G\+N\+U General Public License for more details.

You should have received a copy of the G\+N\+U General Public License along with Tox. If not, see \href{http://www.gnu.org/licenses/}{\tt http\+://www.\+gnu.\+org/licenses/}. 

Definition at line 36 of file msi.\+c.



Referenced by send\+\_\+message().



\subsection{Typedef Documentation}
\hypertarget{msi_8c_a1440d42a36a5734a5876b98e87ad66aa}{\index{msi.\+c@{msi.\+c}!M\+S\+I\+Message@{M\+S\+I\+Message}}
\index{M\+S\+I\+Message@{M\+S\+I\+Message}!msi.\+c@{msi.\+c}}
\subsubsection[{M\+S\+I\+Message}]{\setlength{\rightskip}{0pt plus 5cm}typedef struct {\bf \+\_\+\+M\+S\+I\+Message}  {\bf M\+S\+I\+Message}}}\label{msi_8c_a1440d42a36a5734a5876b98e87ad66aa}
\hypertarget{msi_8c_a1eaa1b2e6ca0fb65790e2e7e0dd62735}{\index{msi.\+c@{msi.\+c}!M\+S\+I\+Raw\+C\+Settings\+Type@{M\+S\+I\+Raw\+C\+Settings\+Type}}
\index{M\+S\+I\+Raw\+C\+Settings\+Type@{M\+S\+I\+Raw\+C\+Settings\+Type}!msi.\+c@{msi.\+c}}
\subsubsection[{M\+S\+I\+Raw\+C\+Settings\+Type}]{\setlength{\rightskip}{0pt plus 5cm}typedef uint8\+\_\+t M\+S\+I\+Raw\+C\+Settings\+Type\mbox{[}23\mbox{]}}}\label{msi_8c_a1eaa1b2e6ca0fb65790e2e7e0dd62735}
Protocol\+:

$\vert$id \mbox{[}1 byte\mbox{]}$\vert$ $\vert$size \mbox{[}1 byte\mbox{]}$\vert$ $\vert$data \mbox{[}\$size bytes\mbox{]}$\vert$ $\vert$...\{repeat\}$\vert$ $\vert$0 \{end byte\}$\vert$ 

Definition at line 50 of file msi.\+c.

\hypertarget{msi_8c_a331ddf64cc0ad62ea466e7cc2d010a5c}{\index{msi.\+c@{msi.\+c}!Timer@{Timer}}
\index{Timer@{Timer}!msi.\+c@{msi.\+c}}
\subsubsection[{Timer}]{\setlength{\rightskip}{0pt plus 5cm}typedef struct {\bf \+\_\+\+Timer}  {\bf Timer}}}\label{msi_8c_a331ddf64cc0ad62ea466e7cc2d010a5c}
\hypertarget{msi_8c_a7b7cb3325d6f27e4cefb0d97e776733d}{\index{msi.\+c@{msi.\+c}!Timer\+Handler@{Timer\+Handler}}
\index{Timer\+Handler@{Timer\+Handler}!msi.\+c@{msi.\+c}}
\subsubsection[{Timer\+Handler}]{\setlength{\rightskip}{0pt plus 5cm}typedef struct {\bf \+\_\+\+Timer\+Handler}  {\bf Timer\+Handler}}}\label{msi_8c_a7b7cb3325d6f27e4cefb0d97e776733d}


\subsection{Enumeration Type Documentation}
\hypertarget{msi_8c_ab543e56b09aa092d084f4da3ae646423}{\index{msi.\+c@{msi.\+c}!M\+S\+I\+Call\+Error@{M\+S\+I\+Call\+Error}}
\index{M\+S\+I\+Call\+Error@{M\+S\+I\+Call\+Error}!msi.\+c@{msi.\+c}}
\subsubsection[{M\+S\+I\+Call\+Error}]{\setlength{\rightskip}{0pt plus 5cm}enum {\bf M\+S\+I\+Call\+Error}}}\label{msi_8c_ab543e56b09aa092d084f4da3ae646423}
\begin{Desc}
\item[Enumerator]\par
\begin{description}
\index{error\+\_\+none@{error\+\_\+none}!msi.\+c@{msi.\+c}}\index{msi.\+c@{msi.\+c}!error\+\_\+none@{error\+\_\+none}}\item[{\em 
\hypertarget{msi_8c_ab543e56b09aa092d084f4da3ae646423a021380030e124f879f67daf259d571fa}{error\+\_\+none}\label{msi_8c_ab543e56b09aa092d084f4da3ae646423a021380030e124f879f67daf259d571fa}
}]\index{error\+\_\+deadcall@{error\+\_\+deadcall}!msi.\+c@{msi.\+c}}\index{msi.\+c@{msi.\+c}!error\+\_\+deadcall@{error\+\_\+deadcall}}\item[{\em 
\hypertarget{msi_8c_ab543e56b09aa092d084f4da3ae646423add2eb51143f096a20fe26e491617ca9f}{error\+\_\+deadcall}\label{msi_8c_ab543e56b09aa092d084f4da3ae646423add2eb51143f096a20fe26e491617ca9f}
}]\index{error\+\_\+id\+\_\+mismatch@{error\+\_\+id\+\_\+mismatch}!msi.\+c@{msi.\+c}}\index{msi.\+c@{msi.\+c}!error\+\_\+id\+\_\+mismatch@{error\+\_\+id\+\_\+mismatch}}\item[{\em 
\hypertarget{msi_8c_ab543e56b09aa092d084f4da3ae646423a374ca3bb8847b31bda31bb279096f76d}{error\+\_\+id\+\_\+mismatch}\label{msi_8c_ab543e56b09aa092d084f4da3ae646423a374ca3bb8847b31bda31bb279096f76d}
}]\index{error\+\_\+no\+\_\+callid@{error\+\_\+no\+\_\+callid}!msi.\+c@{msi.\+c}}\index{msi.\+c@{msi.\+c}!error\+\_\+no\+\_\+callid@{error\+\_\+no\+\_\+callid}}\item[{\em 
\hypertarget{msi_8c_ab543e56b09aa092d084f4da3ae646423af1013422b03a404f37f53cdacca18dea}{error\+\_\+no\+\_\+callid}\label{msi_8c_ab543e56b09aa092d084f4da3ae646423af1013422b03a404f37f53cdacca18dea}
}]\index{error\+\_\+no\+\_\+call@{error\+\_\+no\+\_\+call}!msi.\+c@{msi.\+c}}\index{msi.\+c@{msi.\+c}!error\+\_\+no\+\_\+call@{error\+\_\+no\+\_\+call}}\item[{\em 
\hypertarget{msi_8c_ab543e56b09aa092d084f4da3ae646423a12308009882b0e18008b8f483ec1b819}{error\+\_\+no\+\_\+call}\label{msi_8c_ab543e56b09aa092d084f4da3ae646423a12308009882b0e18008b8f483ec1b819}
}]\index{error\+\_\+no\+\_\+crypto\+\_\+key@{error\+\_\+no\+\_\+crypto\+\_\+key}!msi.\+c@{msi.\+c}}\index{msi.\+c@{msi.\+c}!error\+\_\+no\+\_\+crypto\+\_\+key@{error\+\_\+no\+\_\+crypto\+\_\+key}}\item[{\em 
\hypertarget{msi_8c_ab543e56b09aa092d084f4da3ae646423abad69fa094c03be3b9c71858b9bef066}{error\+\_\+no\+\_\+crypto\+\_\+key}\label{msi_8c_ab543e56b09aa092d084f4da3ae646423abad69fa094c03be3b9c71858b9bef066}
}]\index{error\+\_\+busy@{error\+\_\+busy}!msi.\+c@{msi.\+c}}\index{msi.\+c@{msi.\+c}!error\+\_\+busy@{error\+\_\+busy}}\item[{\em 
\hypertarget{msi_8c_ab543e56b09aa092d084f4da3ae646423a4d9b7fd794c2916ff10e69f9fc801466}{error\+\_\+busy}\label{msi_8c_ab543e56b09aa092d084f4da3ae646423a4d9b7fd794c2916ff10e69f9fc801466}
}]\end{description}
\end{Desc}


Definition at line 548 of file msi.\+c.


\begin{DoxyCode}
548              \{
549     \hyperlink{msi_8c_ab543e56b09aa092d084f4da3ae646423a021380030e124f879f67daf259d571fa}{error\_none},
550     \hyperlink{msi_8c_ab543e56b09aa092d084f4da3ae646423add2eb51143f096a20fe26e491617ca9f}{error\_deadcall},      \textcolor{comment}{/* has call id but it's from old call */}
551     \hyperlink{msi_8c_ab543e56b09aa092d084f4da3ae646423a374ca3bb8847b31bda31bb279096f76d}{error\_id\_mismatch},   \textcolor{comment}{/* non-existing call */}
552 
553     \hyperlink{msi_8c_ab543e56b09aa092d084f4da3ae646423af1013422b03a404f37f53cdacca18dea}{error\_no\_callid},     \textcolor{comment}{/* not having call id */}
554     \hyperlink{msi_8c_ab543e56b09aa092d084f4da3ae646423a12308009882b0e18008b8f483ec1b819}{error\_no\_call},       \textcolor{comment}{/* no call in session */}
555     \hyperlink{msi_8c_ab543e56b09aa092d084f4da3ae646423abad69fa094c03be3b9c71858b9bef066}{error\_no\_crypto\_key}, \textcolor{comment}{/* no crypto key */}
556 
557     \hyperlink{msi_8c_ab543e56b09aa092d084f4da3ae646423a4d9b7fd794c2916ff10e69f9fc801466}{error\_busy}
558 
559 \} \hyperlink{msi_8c_ab543e56b09aa092d084f4da3ae646423}{MSICallError};          \textcolor{comment}{/* Error codes */}
\end{DoxyCode}
\hypertarget{msi_8c_a54be6a6ec118139a2cd0a21e490a7deb}{\index{msi.\+c@{msi.\+c}!M\+S\+I\+Header\+I\+D@{M\+S\+I\+Header\+I\+D}}
\index{M\+S\+I\+Header\+I\+D@{M\+S\+I\+Header\+I\+D}!msi.\+c@{msi.\+c}}
\subsubsection[{M\+S\+I\+Header\+I\+D}]{\setlength{\rightskip}{0pt plus 5cm}enum {\bf M\+S\+I\+Header\+I\+D}}}\label{msi_8c_a54be6a6ec118139a2cd0a21e490a7deb}
\begin{Desc}
\item[Enumerator]\par
\begin{description}
\index{I\+D\+Request@{I\+D\+Request}!msi.\+c@{msi.\+c}}\index{msi.\+c@{msi.\+c}!I\+D\+Request@{I\+D\+Request}}\item[{\em 
\hypertarget{msi_8c_a54be6a6ec118139a2cd0a21e490a7deba8d1bbc36c628c8c70dd0b5343064118d}{I\+D\+Request}\label{msi_8c_a54be6a6ec118139a2cd0a21e490a7deba8d1bbc36c628c8c70dd0b5343064118d}
}]\index{I\+D\+Response@{I\+D\+Response}!msi.\+c@{msi.\+c}}\index{msi.\+c@{msi.\+c}!I\+D\+Response@{I\+D\+Response}}\item[{\em 
\hypertarget{msi_8c_a54be6a6ec118139a2cd0a21e490a7deba569155714fc04f9d3d70224ab8fb700a}{I\+D\+Response}\label{msi_8c_a54be6a6ec118139a2cd0a21e490a7deba569155714fc04f9d3d70224ab8fb700a}
}]\index{I\+D\+Reason@{I\+D\+Reason}!msi.\+c@{msi.\+c}}\index{msi.\+c@{msi.\+c}!I\+D\+Reason@{I\+D\+Reason}}\item[{\em 
\hypertarget{msi_8c_a54be6a6ec118139a2cd0a21e490a7deba377727aa6f1757d466f0d62d169debd0}{I\+D\+Reason}\label{msi_8c_a54be6a6ec118139a2cd0a21e490a7deba377727aa6f1757d466f0d62d169debd0}
}]\index{I\+D\+Call\+Id@{I\+D\+Call\+Id}!msi.\+c@{msi.\+c}}\index{msi.\+c@{msi.\+c}!I\+D\+Call\+Id@{I\+D\+Call\+Id}}\item[{\em 
\hypertarget{msi_8c_a54be6a6ec118139a2cd0a21e490a7deba59f19c1ff36c01aed8f32835fa655ee2}{I\+D\+Call\+Id}\label{msi_8c_a54be6a6ec118139a2cd0a21e490a7deba59f19c1ff36c01aed8f32835fa655ee2}
}]\index{I\+D\+C\+Settings@{I\+D\+C\+Settings}!msi.\+c@{msi.\+c}}\index{msi.\+c@{msi.\+c}!I\+D\+C\+Settings@{I\+D\+C\+Settings}}\item[{\em 
\hypertarget{msi_8c_a54be6a6ec118139a2cd0a21e490a7deba6e1521034cf248217314e040e34dc595}{I\+D\+C\+Settings}\label{msi_8c_a54be6a6ec118139a2cd0a21e490a7deba6e1521034cf248217314e040e34dc595}
}]\end{description}
\end{Desc}


Definition at line 52 of file msi.\+c.


\begin{DoxyCode}
52              \{
53     \hyperlink{msi_8c_a54be6a6ec118139a2cd0a21e490a7deba8d1bbc36c628c8c70dd0b5343064118d}{IDRequest} = 1,
54     \hyperlink{msi_8c_a54be6a6ec118139a2cd0a21e490a7deba569155714fc04f9d3d70224ab8fb700a}{IDResponse},
55     \hyperlink{msi_8c_a54be6a6ec118139a2cd0a21e490a7deba377727aa6f1757d466f0d62d169debd0}{IDReason},
56     \hyperlink{msi_8c_a54be6a6ec118139a2cd0a21e490a7deba59f19c1ff36c01aed8f32835fa655ee2}{IDCallId},
57     \hyperlink{msi_8c_a54be6a6ec118139a2cd0a21e490a7deba6e1521034cf248217314e040e34dc595}{IDCSettings},
58 
59 \} \hyperlink{msi_8c_a54be6a6ec118139a2cd0a21e490a7deb}{MSIHeaderID};
\end{DoxyCode}
\hypertarget{msi_8c_a6557c179987e0c84ccb97c9f29a302ef}{\index{msi.\+c@{msi.\+c}!M\+S\+I\+Message\+Type@{M\+S\+I\+Message\+Type}}
\index{M\+S\+I\+Message\+Type@{M\+S\+I\+Message\+Type}!msi.\+c@{msi.\+c}}
\subsubsection[{M\+S\+I\+Message\+Type}]{\setlength{\rightskip}{0pt plus 5cm}enum {\bf M\+S\+I\+Message\+Type}}}\label{msi_8c_a6557c179987e0c84ccb97c9f29a302ef}
\begin{Desc}
\item[Enumerator]\par
\begin{description}
\index{Type\+Request@{Type\+Request}!msi.\+c@{msi.\+c}}\index{msi.\+c@{msi.\+c}!Type\+Request@{Type\+Request}}\item[{\em 
\hypertarget{msi_8c_a6557c179987e0c84ccb97c9f29a302efa3bc11c46b5beb3df428936d6f53b03f7}{Type\+Request}\label{msi_8c_a6557c179987e0c84ccb97c9f29a302efa3bc11c46b5beb3df428936d6f53b03f7}
}]\index{Type\+Response@{Type\+Response}!msi.\+c@{msi.\+c}}\index{msi.\+c@{msi.\+c}!Type\+Response@{Type\+Response}}\item[{\em 
\hypertarget{msi_8c_a6557c179987e0c84ccb97c9f29a302efa44af861e1cb1f54554d3a48a9dfa343b}{Type\+Response}\label{msi_8c_a6557c179987e0c84ccb97c9f29a302efa44af861e1cb1f54554d3a48a9dfa343b}
}]\end{description}
\end{Desc}


Definition at line 61 of file msi.\+c.


\begin{DoxyCode}
61              \{
62     \hyperlink{msi_8c_a6557c179987e0c84ccb97c9f29a302efa3bc11c46b5beb3df428936d6f53b03f7}{TypeRequest},
63     \hyperlink{msi_8c_a6557c179987e0c84ccb97c9f29a302efa44af861e1cb1f54554d3a48a9dfa343b}{TypeResponse},
64 
65 \} \hyperlink{msi_8c_a6557c179987e0c84ccb97c9f29a302ef}{MSIMessageType};
\end{DoxyCode}
\hypertarget{msi_8c_ae511d1f1e345bb77cd4120b39679f028}{\index{msi.\+c@{msi.\+c}!M\+S\+I\+Request@{M\+S\+I\+Request}}
\index{M\+S\+I\+Request@{M\+S\+I\+Request}!msi.\+c@{msi.\+c}}
\subsubsection[{M\+S\+I\+Request}]{\setlength{\rightskip}{0pt plus 5cm}enum {\bf M\+S\+I\+Request}}}\label{msi_8c_ae511d1f1e345bb77cd4120b39679f028}
\begin{Desc}
\item[Enumerator]\par
\begin{description}
\index{invite@{invite}!msi.\+c@{msi.\+c}}\index{msi.\+c@{msi.\+c}!invite@{invite}}\item[{\em 
\hypertarget{msi_8c_ae511d1f1e345bb77cd4120b39679f028a1626b80e8928e701cbf05e1794eb4504}{invite}\label{msi_8c_ae511d1f1e345bb77cd4120b39679f028a1626b80e8928e701cbf05e1794eb4504}
}]\index{start@{start}!msi.\+c@{msi.\+c}}\index{msi.\+c@{msi.\+c}!start@{start}}\item[{\em 
\hypertarget{msi_8c_ae511d1f1e345bb77cd4120b39679f028a0e97c69c73117f6c0109b2d7d1d9cedc}{start}\label{msi_8c_ae511d1f1e345bb77cd4120b39679f028a0e97c69c73117f6c0109b2d7d1d9cedc}
}]\index{cancel@{cancel}!msi.\+c@{msi.\+c}}\index{msi.\+c@{msi.\+c}!cancel@{cancel}}\item[{\em 
\hypertarget{msi_8c_ae511d1f1e345bb77cd4120b39679f028afa28df73c87d81742155531f0f36dc71}{cancel}\label{msi_8c_ae511d1f1e345bb77cd4120b39679f028afa28df73c87d81742155531f0f36dc71}
}]\index{reject@{reject}!msi.\+c@{msi.\+c}}\index{msi.\+c@{msi.\+c}!reject@{reject}}\item[{\em 
\hypertarget{msi_8c_ae511d1f1e345bb77cd4120b39679f028ac3938f36421013c679a406260a404daa}{reject}\label{msi_8c_ae511d1f1e345bb77cd4120b39679f028ac3938f36421013c679a406260a404daa}
}]\index{end@{end}!msi.\+c@{msi.\+c}}\index{msi.\+c@{msi.\+c}!end@{end}}\item[{\em 
\hypertarget{msi_8c_ae511d1f1e345bb77cd4120b39679f028a80b1a820e533d7cf0e1715319339e6d0}{end}\label{msi_8c_ae511d1f1e345bb77cd4120b39679f028a80b1a820e533d7cf0e1715319339e6d0}
}]\end{description}
\end{Desc}


Definition at line 67 of file msi.\+c.


\begin{DoxyCode}
67              \{
68     \hyperlink{msi_8c_ae511d1f1e345bb77cd4120b39679f028a1626b80e8928e701cbf05e1794eb4504}{invite},
69     \hyperlink{msi_8c_ae511d1f1e345bb77cd4120b39679f028a0e97c69c73117f6c0109b2d7d1d9cedc}{start},
70     \hyperlink{msi_8c_ae511d1f1e345bb77cd4120b39679f028afa28df73c87d81742155531f0f36dc71}{cancel},
71     \hyperlink{msi_8c_ae511d1f1e345bb77cd4120b39679f028ac3938f36421013c679a406260a404daa}{reject},
72     \hyperlink{msi_8c_ae511d1f1e345bb77cd4120b39679f028a80b1a820e533d7cf0e1715319339e6d0}{end},
73 
74 \} \hyperlink{msi_8c_ae511d1f1e345bb77cd4120b39679f028}{MSIRequest};
\end{DoxyCode}
\hypertarget{msi_8c_a7251f9a01631fc788dd7c8eff23a422e}{\index{msi.\+c@{msi.\+c}!M\+S\+I\+Response@{M\+S\+I\+Response}}
\index{M\+S\+I\+Response@{M\+S\+I\+Response}!msi.\+c@{msi.\+c}}
\subsubsection[{M\+S\+I\+Response}]{\setlength{\rightskip}{0pt plus 5cm}enum {\bf M\+S\+I\+Response}}}\label{msi_8c_a7251f9a01631fc788dd7c8eff23a422e}
\begin{Desc}
\item[Enumerator]\par
\begin{description}
\index{ringing@{ringing}!msi.\+c@{msi.\+c}}\index{msi.\+c@{msi.\+c}!ringing@{ringing}}\item[{\em 
\hypertarget{msi_8c_a7251f9a01631fc788dd7c8eff23a422eaa27786b5857031d78494d47532ecbb78}{ringing}\label{msi_8c_a7251f9a01631fc788dd7c8eff23a422eaa27786b5857031d78494d47532ecbb78}
}]\index{starting@{starting}!msi.\+c@{msi.\+c}}\index{msi.\+c@{msi.\+c}!starting@{starting}}\item[{\em 
\hypertarget{msi_8c_a7251f9a01631fc788dd7c8eff23a422ea658598d69535d5877bf2fa0af0dcfafa}{starting}\label{msi_8c_a7251f9a01631fc788dd7c8eff23a422ea658598d69535d5877bf2fa0af0dcfafa}
}]\index{ending@{ending}!msi.\+c@{msi.\+c}}\index{msi.\+c@{msi.\+c}!ending@{ending}}\item[{\em 
\hypertarget{msi_8c_a7251f9a01631fc788dd7c8eff23a422ea6135603307626f48d62e2faa86a1d255}{ending}\label{msi_8c_a7251f9a01631fc788dd7c8eff23a422ea6135603307626f48d62e2faa86a1d255}
}]\index{error@{error}!msi.\+c@{msi.\+c}}\index{msi.\+c@{msi.\+c}!error@{error}}\item[{\em 
\hypertarget{msi_8c_a7251f9a01631fc788dd7c8eff23a422ead606e435413ea0944dd00d49e901e4ed}{error}\label{msi_8c_a7251f9a01631fc788dd7c8eff23a422ead606e435413ea0944dd00d49e901e4ed}
}]\end{description}
\end{Desc}


Definition at line 76 of file msi.\+c.


\begin{DoxyCode}
76              \{
77     \hyperlink{msi_8c_a7251f9a01631fc788dd7c8eff23a422eaa27786b5857031d78494d47532ecbb78}{ringing},
78     \hyperlink{msi_8c_a7251f9a01631fc788dd7c8eff23a422ea658598d69535d5877bf2fa0af0dcfafa}{starting},
79     \hyperlink{msi_8c_a7251f9a01631fc788dd7c8eff23a422ea6135603307626f48d62e2faa86a1d255}{ending},
80     \hyperlink{msi_8c_a7251f9a01631fc788dd7c8eff23a422ead606e435413ea0944dd00d49e901e4ed}{error}
81 
82 \} \hyperlink{msi_8c_a7251f9a01631fc788dd7c8eff23a422e}{MSIResponse};
\end{DoxyCode}


\subsection{Function Documentation}
\hypertarget{msi_8c_ae93f60c5c6d4713db189c4059e36e4c1}{\index{msi.\+c@{msi.\+c}!add\+\_\+peer@{add\+\_\+peer}}
\index{add\+\_\+peer@{add\+\_\+peer}!msi.\+c@{msi.\+c}}
\subsubsection[{add\+\_\+peer}]{\setlength{\rightskip}{0pt plus 5cm}static void add\+\_\+peer (
\begin{DoxyParamCaption}
\item[{{\bf M\+S\+I\+Call} $\ast$}]{call, }
\item[{int}]{peer\+\_\+id}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{msi_8c_ae93f60c5c6d4713db189c4059e36e4c1}
Add peer to peer list. 

Definition at line 672 of file msi.\+c.



References L\+O\+G\+G\+E\+R\+\_\+\+D\+E\+B\+U\+G, L\+O\+G\+G\+E\+R\+\_\+\+W\+A\+R\+N\+I\+N\+G, \+\_\+\+M\+S\+I\+Call\+::peer\+\_\+count, and \+\_\+\+M\+S\+I\+Call\+::peers.



Referenced by handle\+\_\+recv\+\_\+invite(), and msi\+\_\+invite().


\begin{DoxyCode}
673 \{
674     uint32\_t *peers = !call->\hyperlink{struct___m_s_i_call_a55d2568491d616f7fef07bc7137c8c23}{peers} ? peers = calloc(\textcolor{keyword}{sizeof}(uint32\_t), 1) :
675                       realloc( call->peers, sizeof(uint32\_t) * call->peer\_count);
676 
677     \textcolor{keywordflow}{if} (!peers) \{
678         \hyperlink{logger_8h_ab3e970f3c1ecb5b71f17eccee4ebb286}{LOGGER\_WARNING}(\textcolor{stringliteral}{"Allocation failed! Program might misbehave!"});
679         \textcolor{keywordflow}{return};
680     \}
681 
682     call->\hyperlink{struct___m_s_i_call_a62e9da1e57f84fd224590c4d466724aa}{peer\_count} ++;
683     call->\hyperlink{struct___m_s_i_call_a55d2568491d616f7fef07bc7137c8c23}{peers} = peers;
684     call->\hyperlink{struct___m_s_i_call_a55d2568491d616f7fef07bc7137c8c23}{peers}[call->\hyperlink{struct___m_s_i_call_a62e9da1e57f84fd224590c4d466724aa}{peer\_count} - 1] = peer\_id;
685 
686     \hyperlink{logger_8h_a9885ca09ce5f94d936c91a5b0856a024}{LOGGER\_DEBUG}(\textcolor{stringliteral}{"Added peer: %d"}, peer\_id);
687 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_ae93f60c5c6d4713db189c4059e36e4c1_icgraph}
\end{center}
\end{figure}


\hypertarget{msi_8c_a9511a4026ab002ee24e988df1829f67b}{\index{msi.\+c@{msi.\+c}!call\+\_\+id\+\_\+bigger@{call\+\_\+id\+\_\+bigger}}
\index{call\+\_\+id\+\_\+bigger@{call\+\_\+id\+\_\+bigger}!msi.\+c@{msi.\+c}}
\subsubsection[{call\+\_\+id\+\_\+bigger}]{\setlength{\rightskip}{0pt plus 5cm}static int call\+\_\+id\+\_\+bigger (
\begin{DoxyParamCaption}
\item[{const uint8\+\_\+t $\ast$}]{first, }
\item[{const uint8\+\_\+t $\ast$}]{second}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{msi_8c_a9511a4026ab002ee24e988df1829f67b}
Determine 'bigger' call id 

Definition at line 629 of file msi.\+c.



Referenced by handle\+\_\+recv\+\_\+invite().


\begin{DoxyCode}
630 \{
631     \textcolor{keywordflow}{return} (memcmp(\hyperlink{onion__test_8c_a49c185b8248f424bbab4359e461ae734}{first}, second, \textcolor{keyword}{sizeof}(\hyperlink{msi_8h_a861af5c5c180987c1c86739b4321076c}{MSICallIDType})) < 0);
632 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_a9511a4026ab002ee24e988df1829f67b_icgraph}
\end{center}
\end{figure}


\hypertarget{msi_8c_aecbf66ee30b2ec4003caed2455e4c02d}{\index{msi.\+c@{msi.\+c}!find\+\_\+call@{find\+\_\+call}}
\index{find\+\_\+call@{find\+\_\+call}!msi.\+c@{msi.\+c}}
\subsubsection[{find\+\_\+call}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf M\+S\+I\+Call}$\ast$ find\+\_\+call (
\begin{DoxyParamCaption}
\item[{{\bf M\+S\+I\+Session} $\ast$}]{session, }
\item[{uint8\+\_\+t $\ast$}]{call\+\_\+id}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{msi_8c_aecbf66ee30b2ec4003caed2455e4c02d}


Definition at line 690 of file msi.\+c.



References \+\_\+\+M\+S\+I\+Session\+::calls, i, \+\_\+\+M\+S\+I\+Call\+::id, and \+\_\+\+M\+S\+I\+Session\+::max\+\_\+calls.



Referenced by msi\+\_\+handle\+\_\+packet().


\begin{DoxyCode}
691 \{
692     \textcolor{keywordflow}{if} ( call\_id == NULL ) \textcolor{keywordflow}{return} NULL;
693 
694     int32\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i} = 0;
695 
696     \textcolor{keywordflow}{for} (; i < session->\hyperlink{struct___m_s_i_session_ae4bbb4682dc5c74588083ca06ac2f76f}{max\_calls}; i ++ )
697         \textcolor{keywordflow}{if} ( session->\hyperlink{struct___m_s_i_session_ac40fee673bae4030b812579c57389a02}{calls}[i] && memcmp(session->\hyperlink{struct___m_s_i_session_ac40fee673bae4030b812579c57389a02}{calls}[i]->\hyperlink{struct___m_s_i_call_aa135fbffd11268758f5f21269fb46853}{id}, call\_id, \textcolor{keyword}{sizeof}(session->
      \hyperlink{struct___m_s_i_session_ac40fee673bae4030b812579c57389a02}{calls}[i]->\hyperlink{struct___m_s_i_call_aa135fbffd11268758f5f21269fb46853}{id})) == 0 ) \{
698             \textcolor{keywordflow}{return} session->\hyperlink{struct___m_s_i_session_ac40fee673bae4030b812579c57389a02}{calls}[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}];
699         \}
700 
701     \textcolor{keywordflow}{return} NULL;
702 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_aecbf66ee30b2ec4003caed2455e4c02d_icgraph}
\end{center}
\end{figure}


\hypertarget{msi_8c_a92f71169666532a395aa396591e0426e}{\index{msi.\+c@{msi.\+c}!flush\+\_\+peer\+\_\+csettings@{flush\+\_\+peer\+\_\+csettings}}
\index{flush\+\_\+peer\+\_\+csettings@{flush\+\_\+peer\+\_\+csettings}!msi.\+c@{msi.\+c}}
\subsubsection[{flush\+\_\+peer\+\_\+csettings}]{\setlength{\rightskip}{0pt plus 5cm}static int flush\+\_\+peer\+\_\+csettings (
\begin{DoxyParamCaption}
\item[{{\bf M\+S\+I\+Call} $\ast$}]{call, }
\item[{{\bf M\+S\+I\+Message} $\ast$}]{msg, }
\item[{int}]{peer\+\_\+id}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{msi_8c_a92f71169666532a395aa396591e0426e}
Set/change peer csettings 

Definition at line 638 of file msi.\+c.



References \+\_\+\+M\+S\+I\+Codec\+Settings\+::audio\+\_\+bitrate, \+\_\+\+M\+S\+I\+Codec\+Settings\+::audio\+\_\+channels, \+\_\+\+M\+S\+I\+Codec\+Settings\+::audio\+\_\+frame\+\_\+duration, \+\_\+\+M\+S\+I\+Codec\+Settings\+::audio\+\_\+sample\+\_\+rate, \+\_\+\+M\+S\+I\+Codec\+Settings\+::call\+\_\+type, \+\_\+\+M\+S\+I\+Message\+::csettings, \+\_\+\+M\+S\+I\+Call\+::csettings\+\_\+peer, L\+O\+G\+G\+E\+R\+\_\+\+D\+E\+B\+U\+G, L\+O\+G\+G\+E\+R\+\_\+\+W\+A\+R\+N\+I\+N\+G, \+\_\+\+M\+S\+I\+Codec\+Settings\+::max\+\_\+video\+\_\+height, \+\_\+\+M\+S\+I\+Codec\+Settings\+::max\+\_\+video\+\_\+width, msi\+\_\+msg\+\_\+get\+\_\+csettings(), and \+\_\+\+M\+S\+I\+Codec\+Settings\+::video\+\_\+bitrate.



Referenced by handle\+\_\+recv\+\_\+invite(), and handle\+\_\+recv\+\_\+starting().


\begin{DoxyCode}
639 \{
640     \textcolor{keywordflow}{if} ( msg->\hyperlink{struct___m_s_i_message_a4b09316f11dc8e9fe3b3357a6d48db56}{csettings}.exists ) \{
641         \hyperlink{msi_8c_a1d6d84b54016402734b0bc352f654699}{msi\_msg\_get\_csettings}(msg, &call->\hyperlink{struct___m_s_i_call_a3b7fc70c2772bbdc453eeff763fc0b4c}{csettings\_peer}[peer\_id]);
642 
643         \hyperlink{logger_8h_a9885ca09ce5f94d936c91a5b0856a024}{LOGGER\_DEBUG}(\textcolor{stringliteral}{"Peer: %d \(\backslash\)n"}
644                      \textcolor{stringliteral}{"Type: %u \(\backslash\)n"}
645                      \textcolor{stringliteral}{"Video bitrate: %u \(\backslash\)n"}
646                      \textcolor{stringliteral}{"Video height: %u \(\backslash\)n"}
647                      \textcolor{stringliteral}{"Video width: %u \(\backslash\)n"}
648                      \textcolor{stringliteral}{"Audio bitrate: %u \(\backslash\)n"}
649                      \textcolor{stringliteral}{"Audio framedur: %u \(\backslash\)n"}
650                      \textcolor{stringliteral}{"Audio sample rate: %u \(\backslash\)n"}
651                      \textcolor{stringliteral}{"Audio channels: %u \(\backslash\)n"}, peer\_id,
652                      call->\hyperlink{struct___m_s_i_call_a3b7fc70c2772bbdc453eeff763fc0b4c}{csettings\_peer}[peer\_id].\hyperlink{struct___m_s_i_codec_settings_a24d841d0ab8a0b3f12f559aec494e4fe}{call\_type},
653                      call->\hyperlink{struct___m_s_i_call_a3b7fc70c2772bbdc453eeff763fc0b4c}{csettings\_peer}[peer\_id].\hyperlink{struct___m_s_i_codec_settings_af0eac99d4181795e8a595d244e745192}{video\_bitrate},
654                      call->\hyperlink{struct___m_s_i_call_a3b7fc70c2772bbdc453eeff763fc0b4c}{csettings\_peer}[peer\_id].
      \hyperlink{struct___m_s_i_codec_settings_a4fef4b2fa1a8ae8446314ad0af4ce698}{max\_video\_height},
655                      call->\hyperlink{struct___m_s_i_call_a3b7fc70c2772bbdc453eeff763fc0b4c}{csettings\_peer}[peer\_id].\hyperlink{struct___m_s_i_codec_settings_ab81ecded1f7c46e120c8f2afa7b2c5cc}{max\_video\_width},
656                      call->\hyperlink{struct___m_s_i_call_a3b7fc70c2772bbdc453eeff763fc0b4c}{csettings\_peer}[peer\_id].\hyperlink{struct___m_s_i_codec_settings_a5d9a8b59b2eb1eef8dbdcb032bf1dd01}{audio\_bitrate},
657                      call->\hyperlink{struct___m_s_i_call_a3b7fc70c2772bbdc453eeff763fc0b4c}{csettings\_peer}[peer\_id].
      \hyperlink{struct___m_s_i_codec_settings_a61b592233f5a65705eb2600d38e365cd}{audio\_frame\_duration},
658                      call->\hyperlink{struct___m_s_i_call_a3b7fc70c2772bbdc453eeff763fc0b4c}{csettings\_peer}[peer\_id].
      \hyperlink{struct___m_s_i_codec_settings_a66da4482e934a2700e07a39fa0838559}{audio\_sample\_rate},
659                      call->\hyperlink{struct___m_s_i_call_a3b7fc70c2772bbdc453eeff763fc0b4c}{csettings\_peer}[peer\_id].\hyperlink{struct___m_s_i_codec_settings_a1b04e9669a2929f425e867440b6d826d}{audio\_channels} );
660 
661         \textcolor{keywordflow}{return} 0;
662     \}
663 
664     \hyperlink{logger_8h_ab3e970f3c1ecb5b71f17eccee4ebb286}{LOGGER\_WARNING}(\textcolor{stringliteral}{"No csettings header!"});
665     \textcolor{keywordflow}{return} -1;
666 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=343pt]{d2/d9b/msi_8c_a92f71169666532a395aa396591e0426e_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_a92f71169666532a395aa396591e0426e_icgraph}
\end{center}
\end{figure}


\hypertarget{msi_8c_acd3f86de9a0df45caf147b8a095a89a0}{\index{msi.\+c@{msi.\+c}!format\+\_\+output@{format\+\_\+output}}
\index{format\+\_\+output@{format\+\_\+output}!msi.\+c@{msi.\+c}}
\subsubsection[{format\+\_\+output}]{\setlength{\rightskip}{0pt plus 5cm}uint8\+\_\+t$\ast$ format\+\_\+output (
\begin{DoxyParamCaption}
\item[{uint8\+\_\+t $\ast$}]{dest, }
\item[{{\bf M\+S\+I\+Header\+I\+D}}]{id, }
\item[{const void $\ast$}]{value, }
\item[{uint8\+\_\+t}]{value\+\_\+len, }
\item[{uint16\+\_\+t $\ast$}]{length}
\end{DoxyParamCaption}
)}}\label{msi_8c_acd3f86de9a0df45caf147b8a095a89a0}
Speaks for itself. 

Definition at line 257 of file msi.\+c.



References L\+O\+G\+G\+E\+R\+\_\+\+E\+R\+R\+O\+R.



Referenced by parse\+\_\+send().


\begin{DoxyCode}
262 \{
263     \textcolor{keywordflow}{if} ( dest == NULL ) \{
264         \hyperlink{logger_8h_aedad6a1e3ffe0d4cd0992b822ec0eeeb}{LOGGER\_ERROR}(\textcolor{stringliteral}{"No destination space!"});
265         \textcolor{keywordflow}{return} NULL;
266     \}
267 
268     \textcolor{keywordflow}{if} (value == NULL || value\_len == 0) \{
269         \hyperlink{logger_8h_aedad6a1e3ffe0d4cd0992b822ec0eeeb}{LOGGER\_ERROR}(\textcolor{stringliteral}{"Empty header value"});
270         \textcolor{keywordflow}{return} NULL;
271     \}
272 
273     *dest = id;
274     dest ++;
275     *dest = value\_len;
276     dest ++;
277 
278     memcpy(dest, value, value\_len);
279 
280     *length += (2 + value\_len);
281 
282     \textcolor{keywordflow}{return} dest + value\_len; \textcolor{comment}{/* Set to next position ready to be written */}
283 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_acd3f86de9a0df45caf147b8a095a89a0_icgraph}
\end{center}
\end{figure}


\hypertarget{msi_8c_ac97b77c7ecac429b769a3e7b54047d1f}{\index{msi.\+c@{msi.\+c}!handle\+\_\+recv\+\_\+cancel@{handle\+\_\+recv\+\_\+cancel}}
\index{handle\+\_\+recv\+\_\+cancel@{handle\+\_\+recv\+\_\+cancel}!msi.\+c@{msi.\+c}}
\subsubsection[{handle\+\_\+recv\+\_\+cancel}]{\setlength{\rightskip}{0pt plus 5cm}static int handle\+\_\+recv\+\_\+cancel (
\begin{DoxyParamCaption}
\item[{{\bf M\+S\+I\+Session} $\ast$}]{session, }
\item[{{\bf M\+S\+I\+Call} $\ast$}]{call, }
\item[{{\bf M\+S\+I\+Message} $\ast$}]{msg}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{msi_8c_ac97b77c7ecac429b769a3e7b54047d1f}


Definition at line 943 of file msi.\+c.



References \+\_\+\+M\+S\+I\+Call\+::call\+\_\+idx, invoke\+\_\+callback(), L\+O\+G\+G\+E\+R\+\_\+\+D\+E\+B\+U\+G, L\+O\+G\+G\+E\+R\+\_\+\+W\+A\+R\+N\+I\+N\+G, msi\+\_\+\+On\+Cancel, and terminate\+\_\+call().



Referenced by msi\+\_\+handle\+\_\+packet().


\begin{DoxyCode}
944 \{
945     \textcolor{keywordflow}{if} ( !call ) \{
946         \hyperlink{logger_8h_ab3e970f3c1ecb5b71f17eccee4ebb286}{LOGGER\_WARNING}(\textcolor{stringliteral}{"Session: %p Handling 'start' on no call"});
947         \textcolor{keywordflow}{return} 0;
948     \}
949 
950     (void)msg;
951 
952     \hyperlink{logger_8h_a9885ca09ce5f94d936c91a5b0856a024}{LOGGER\_DEBUG}(\textcolor{stringliteral}{"Session: %p Handling 'cancel' on call: %u"}, session, call->
      \hyperlink{struct___m_s_i_call_ad6b287fd08a0cc466cd41bd2e76d5808}{call\_idx});
953 
954     \hyperlink{msi_8c_af6701ab999e1734c40580997749daf6f}{invoke\_callback}(session, call->\hyperlink{struct___m_s_i_call_ad6b287fd08a0cc466cd41bd2e76d5808}{call\_idx}, \hyperlink{msi_8h_aba083d202aa40ee6d37db924fe486401a50c912182b9d89d9b43643ab91517a3a}{msi\_OnCancel});
955     \hyperlink{msi_8c_abf7deacfacdcb5b7cc4cfc163583c40d}{terminate\_call} ( session, call );
956 
957     \textcolor{keywordflow}{return} 1;
958 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_ac97b77c7ecac429b769a3e7b54047d1f_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_ac97b77c7ecac429b769a3e7b54047d1f_icgraph}
\end{center}
\end{figure}


\hypertarget{msi_8c_a94cb98234fb1cdeffe8ad8b8601c8dc9}{\index{msi.\+c@{msi.\+c}!handle\+\_\+recv\+\_\+end@{handle\+\_\+recv\+\_\+end}}
\index{handle\+\_\+recv\+\_\+end@{handle\+\_\+recv\+\_\+end}!msi.\+c@{msi.\+c}}
\subsubsection[{handle\+\_\+recv\+\_\+end}]{\setlength{\rightskip}{0pt plus 5cm}static int handle\+\_\+recv\+\_\+end (
\begin{DoxyParamCaption}
\item[{{\bf M\+S\+I\+Session} $\ast$}]{session, }
\item[{{\bf M\+S\+I\+Call} $\ast$}]{call, }
\item[{{\bf M\+S\+I\+Message} $\ast$}]{msg}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{msi_8c_a94cb98234fb1cdeffe8ad8b8601c8dc9}


Definition at line 960 of file msi.\+c.



References \+\_\+\+M\+S\+I\+Call\+::call\+\_\+idx, ending, \+\_\+\+M\+S\+I\+Message\+::friend\+\_\+id, invoke\+\_\+callback(), L\+O\+G\+G\+E\+R\+\_\+\+D\+E\+B\+U\+G, L\+O\+G\+G\+E\+R\+\_\+\+W\+A\+R\+N\+I\+N\+G, msi\+\_\+\+On\+End, send\+\_\+reponse(), and terminate\+\_\+call().



Referenced by msi\+\_\+handle\+\_\+packet().


\begin{DoxyCode}
961 \{
962     \textcolor{keywordflow}{if} ( !call ) \{
963         \hyperlink{logger_8h_ab3e970f3c1ecb5b71f17eccee4ebb286}{LOGGER\_WARNING}(\textcolor{stringliteral}{"Session: %p Handling 'start' on no call"});
964         \textcolor{keywordflow}{return} 0;
965     \}
966 
967     \hyperlink{logger_8h_a9885ca09ce5f94d936c91a5b0856a024}{LOGGER\_DEBUG}(\textcolor{stringliteral}{"Session: %p Handling 'end' on call: %d"}, session, call->
      \hyperlink{struct___m_s_i_call_ad6b287fd08a0cc466cd41bd2e76d5808}{call\_idx});
968 
969     \hyperlink{msi_8c_af6701ab999e1734c40580997749daf6f}{invoke\_callback}(session, call->\hyperlink{struct___m_s_i_call_ad6b287fd08a0cc466cd41bd2e76d5808}{call\_idx}, \hyperlink{msi_8h_aba083d202aa40ee6d37db924fe486401a621554da0c501fc1b3f8be5b46ad7eaa}{msi\_OnEnd});
970     \hyperlink{msi_8c_aeac54d94bd4b3bfceab3a080cbf5e100}{send\_reponse}(session, call, \hyperlink{msi_8c_a7251f9a01631fc788dd7c8eff23a422ea6135603307626f48d62e2faa86a1d255}{ending}, msg->\hyperlink{struct___m_s_i_message_af43a034662e9bcac38e3bf4c9c150c19}{friend\_id});
971     \hyperlink{msi_8c_abf7deacfacdcb5b7cc4cfc163583c40d}{terminate\_call} ( session, call );
972 
973     \textcolor{keywordflow}{return} 1;
974 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_a94cb98234fb1cdeffe8ad8b8601c8dc9_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_a94cb98234fb1cdeffe8ad8b8601c8dc9_icgraph}
\end{center}
\end{figure}


\hypertarget{msi_8c_ae71247b244dc60d6f5ce9de8b26365db}{\index{msi.\+c@{msi.\+c}!handle\+\_\+recv\+\_\+ending@{handle\+\_\+recv\+\_\+ending}}
\index{handle\+\_\+recv\+\_\+ending@{handle\+\_\+recv\+\_\+ending}!msi.\+c@{msi.\+c}}
\subsubsection[{handle\+\_\+recv\+\_\+ending}]{\setlength{\rightskip}{0pt plus 5cm}static int handle\+\_\+recv\+\_\+ending (
\begin{DoxyParamCaption}
\item[{{\bf M\+S\+I\+Session} $\ast$}]{session, }
\item[{{\bf M\+S\+I\+Call} $\ast$}]{call, }
\item[{{\bf M\+S\+I\+Message} $\ast$}]{msg}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{msi_8c_ae71247b244dc60d6f5ce9de8b26365db}


Definition at line 1034 of file msi.\+c.



References \+\_\+\+M\+S\+I\+Call\+::call\+\_\+idx, invoke\+\_\+callback(), L\+O\+G\+G\+E\+R\+\_\+\+D\+E\+B\+U\+G, L\+O\+G\+G\+E\+R\+\_\+\+W\+A\+R\+N\+I\+N\+G, msi\+\_\+\+On\+End, and terminate\+\_\+call().



Referenced by msi\+\_\+handle\+\_\+packet().


\begin{DoxyCode}
1035 \{
1036     \textcolor{keywordflow}{if} ( !call ) \{
1037         \hyperlink{logger_8h_ab3e970f3c1ecb5b71f17eccee4ebb286}{LOGGER\_WARNING}(\textcolor{stringliteral}{"Session: %p Handling 'start' on no call"});
1038         \textcolor{keywordflow}{return} 0;
1039     \}
1040 
1041     (void)msg;
1042 
1043     \hyperlink{logger_8h_a9885ca09ce5f94d936c91a5b0856a024}{LOGGER\_DEBUG}(\textcolor{stringliteral}{"Session: %p Handling 'ending' on call: %d"}, session, call->
      \hyperlink{struct___m_s_i_call_ad6b287fd08a0cc466cd41bd2e76d5808}{call\_idx} );
1044 
1045     \hyperlink{msi_8c_af6701ab999e1734c40580997749daf6f}{invoke\_callback}(session, call->\hyperlink{struct___m_s_i_call_ad6b287fd08a0cc466cd41bd2e76d5808}{call\_idx}, \hyperlink{msi_8h_aba083d202aa40ee6d37db924fe486401a621554da0c501fc1b3f8be5b46ad7eaa}{msi\_OnEnd});
1046     \hyperlink{msi_8c_abf7deacfacdcb5b7cc4cfc163583c40d}{terminate\_call} ( session, call );
1047 
1048     \textcolor{keywordflow}{return} 1;
1049 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_ae71247b244dc60d6f5ce9de8b26365db_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_ae71247b244dc60d6f5ce9de8b26365db_icgraph}
\end{center}
\end{figure}


\hypertarget{msi_8c_aa2af3e4ed6abb65d7b747763a41a1b70}{\index{msi.\+c@{msi.\+c}!handle\+\_\+recv\+\_\+error@{handle\+\_\+recv\+\_\+error}}
\index{handle\+\_\+recv\+\_\+error@{handle\+\_\+recv\+\_\+error}!msi.\+c@{msi.\+c}}
\subsubsection[{handle\+\_\+recv\+\_\+error}]{\setlength{\rightskip}{0pt plus 5cm}static int handle\+\_\+recv\+\_\+error (
\begin{DoxyParamCaption}
\item[{{\bf M\+S\+I\+Session} $\ast$}]{session, }
\item[{{\bf M\+S\+I\+Call} $\ast$}]{call, }
\item[{{\bf M\+S\+I\+Message} $\ast$}]{msg}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{msi_8c_aa2af3e4ed6abb65d7b747763a41a1b70}


Definition at line 1050 of file msi.\+c.



References \+\_\+\+M\+S\+I\+Call\+::call\+\_\+idx, invoke\+\_\+callback(), L\+O\+G\+G\+E\+R\+\_\+\+D\+E\+B\+U\+G, L\+O\+G\+G\+E\+R\+\_\+\+W\+A\+R\+N\+I\+N\+G, msi\+\_\+\+On\+End, \+\_\+\+M\+S\+I\+Message\+::reason, and terminate\+\_\+call().



Referenced by msi\+\_\+handle\+\_\+packet().


\begin{DoxyCode}
1051 \{
1052     \textcolor{keywordflow}{if} ( !call ) \{
1053         \hyperlink{logger_8h_ab3e970f3c1ecb5b71f17eccee4ebb286}{LOGGER\_WARNING}(\textcolor{stringliteral}{"Handling 'error' on non-existing call!"});
1054         \textcolor{keywordflow}{return} -1;
1055     \}
1056 
1057     \hyperlink{logger_8h_a9885ca09ce5f94d936c91a5b0856a024}{LOGGER\_DEBUG}(\textcolor{stringliteral}{"Session: %p Handling 'error' on call: %d"}, session, call->
      \hyperlink{struct___m_s_i_call_ad6b287fd08a0cc466cd41bd2e76d5808}{call\_idx} );
1058 
1059     \hyperlink{msi_8c_af6701ab999e1734c40580997749daf6f}{invoke\_callback}(session, call->\hyperlink{struct___m_s_i_call_ad6b287fd08a0cc466cd41bd2e76d5808}{call\_idx}, \hyperlink{msi_8h_aba083d202aa40ee6d37db924fe486401a621554da0c501fc1b3f8be5b46ad7eaa}{msi\_OnEnd});
1060 
1061     \textcolor{comment}{/* Handle error accordingly */}
1062     \textcolor{keywordflow}{if} ( msg->\hyperlink{struct___m_s_i_message_aec4373dacf43cd56b5e67d2b04b63f5a}{reason}.exists ) \{
1063         \textcolor{comment}{/* TODO */}
1064     \}
1065 
1066     \hyperlink{msi_8c_abf7deacfacdcb5b7cc4cfc163583c40d}{terminate\_call} ( session, call );
1067 
1068     \textcolor{keywordflow}{return} 1;
1069 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_aa2af3e4ed6abb65d7b747763a41a1b70_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_aa2af3e4ed6abb65d7b747763a41a1b70_icgraph}
\end{center}
\end{figure}


\hypertarget{msi_8c_a6c1d69163b2cfedea11ed5ed688dc669}{\index{msi.\+c@{msi.\+c}!handle\+\_\+recv\+\_\+invite@{handle\+\_\+recv\+\_\+invite}}
\index{handle\+\_\+recv\+\_\+invite@{handle\+\_\+recv\+\_\+invite}!msi.\+c@{msi.\+c}}
\subsubsection[{handle\+\_\+recv\+\_\+invite}]{\setlength{\rightskip}{0pt plus 5cm}static int handle\+\_\+recv\+\_\+invite (
\begin{DoxyParamCaption}
\item[{{\bf M\+S\+I\+Session} $\ast$}]{session, }
\item[{{\bf M\+S\+I\+Call} $\ast$}]{call, }
\item[{{\bf M\+S\+I\+Message} $\ast$}]{msg}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{msi_8c_a6c1d69163b2cfedea11ed5ed688dc669}


Definition at line 829 of file msi.\+c.



References add\+\_\+peer(), call\+\_\+id\+\_\+bigger(), \+\_\+\+M\+S\+I\+Call\+::call\+\_\+idx, \+\_\+\+M\+S\+I\+Codec\+Settings\+::call\+\_\+type, \+\_\+\+M\+S\+I\+Message\+::callid, \+\_\+\+M\+S\+I\+Message\+::csettings, \+\_\+\+M\+S\+I\+Call\+::csettings\+\_\+peer, error\+\_\+busy, error\+\_\+no\+\_\+callid, flush\+\_\+peer\+\_\+csettings(), \+\_\+\+M\+S\+I\+Message\+::friend\+\_\+id, \+\_\+\+M\+S\+I\+Call\+::id, init\+\_\+call(), invoke\+\_\+callback(), L\+O\+G\+G\+E\+R\+\_\+\+D\+E\+B\+U\+G, L\+O\+G\+G\+E\+R\+\_\+\+E\+R\+R\+O\+R, L\+O\+G\+G\+E\+R\+\_\+\+W\+A\+R\+N\+I\+N\+G, msi\+\_\+\+Call\+Active, msi\+\_\+\+Call\+Inviting, msi\+\_\+\+Call\+Starting, msi\+\_\+\+On\+Invite, msi\+\_\+\+On\+Peer\+C\+S\+Change, msi\+\_\+\+Type\+Audio, \+\_\+\+M\+S\+I\+Call\+::peers, ringing, send\+\_\+error(), send\+\_\+reponse(), starting, \+\_\+\+M\+S\+I\+Call\+::state, and terminate\+\_\+call().



Referenced by msi\+\_\+handle\+\_\+packet().


\begin{DoxyCode}
830 \{
831     \hyperlink{logger_8h_a9885ca09ce5f94d936c91a5b0856a024}{LOGGER\_DEBUG}(\textcolor{stringliteral}{"Session: %p Handling 'invite' on call: %d"}, session, call ? call->
      \hyperlink{struct___m_s_i_call_ad6b287fd08a0cc466cd41bd2e76d5808}{call\_idx} : -1);
832 
833 
834     \textcolor{keywordflow}{if} (!msg->\hyperlink{struct___m_s_i_message_a4b09316f11dc8e9fe3b3357a6d48db56}{csettings}.exists) \{
835         \hyperlink{logger_8h_ab3e970f3c1ecb5b71f17eccee4ebb286}{LOGGER\_WARNING}(\textcolor{stringliteral}{"Peer sent invalid codec settings!"});
836         \hyperlink{msi_8c_a61759c89740aba4cdeea164816115d32}{send\_error} ( session, call, \hyperlink{msi_8c_ab543e56b09aa092d084f4da3ae646423af1013422b03a404f37f53cdacca18dea}{error\_no\_callid}, msg->
      \hyperlink{struct___m_s_i_message_af43a034662e9bcac38e3bf4c9c150c19}{friend\_id} );
837         \textcolor{keywordflow}{return} 0;
838     \}
839 
840     \textcolor{keywordflow}{if} ( call ) \{
841         \textcolor{keywordflow}{if} ( call->\hyperlink{struct___m_s_i_call_a55d2568491d616f7fef07bc7137c8c23}{peers}[0] == (uint32\_t)msg->\hyperlink{struct___m_s_i_message_af43a034662e9bcac38e3bf4c9c150c19}{friend\_id} ) \{
842             \textcolor{keywordflow}{if} (call->\hyperlink{struct___m_s_i_call_a4a1fc0e5d23dbdc357786d4c69eda9b9}{state} == \hyperlink{msi_8h_afbc789bbdb9a4d00eda005500f7c1675a8985e709f0a11b30a998d833c7e29132}{msi\_CallInviting}) \{
843                 \textcolor{comment}{/* The glare case. A calls B when at the same time}
844 \textcolor{comment}{                 * B calls A. Who has advantage is set bey calculating}
845 \textcolor{comment}{                 * 'bigger' Call id and then that call id is being used in}
846 \textcolor{comment}{                 * future. User with 'bigger' Call id has the advantage}
847 \textcolor{comment}{                 * as in he will wait the response from the other.}
848 \textcolor{comment}{                 */}
849                 \hyperlink{logger_8h_a9885ca09ce5f94d936c91a5b0856a024}{LOGGER\_DEBUG}(\textcolor{stringliteral}{"Glare case; Peer: %d"}, call->\hyperlink{struct___m_s_i_call_a55d2568491d616f7fef07bc7137c8c23}{peers}[0]);
850 
851                 \textcolor{keywordflow}{if} ( \hyperlink{msi_8c_a9511a4026ab002ee24e988df1829f67b}{call\_id\_bigger} (call->\hyperlink{struct___m_s_i_call_aa135fbffd11268758f5f21269fb46853}{id}, msg->\hyperlink{struct___m_s_i_message_a0cb3f797b633561175096933c2eb003e}{callid}.value) == 1 ) \{ \textcolor{comment}{/* Peer
       has advantage */}
852 
853                     \textcolor{comment}{/* Terminate call; peer will timeout(call) if call initialization fails */}
854                     \hyperlink{msi_8c_abf7deacfacdcb5b7cc4cfc163583c40d}{terminate\_call}(session, call);
855 
856                     call = \hyperlink{msi_8c_adac49290dc2c80bd0921ffbedb78966f}{init\_call} ( session, 1, 0 );
857 
858                     \textcolor{keywordflow}{if} ( !call ) \{
859                         \hyperlink{logger_8h_aedad6a1e3ffe0d4cd0992b822ec0eeeb}{LOGGER\_ERROR}(\textcolor{stringliteral}{"Starting call"});
860                         \textcolor{keywordflow}{return} 0;
861                     \}
862 
863                 \} \textcolor{keywordflow}{else} \{
864                     \textcolor{keywordflow}{return} 0; \textcolor{comment}{/* Wait for ringing from peer */}
865                 \}
866             \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (call->\hyperlink{struct___m_s_i_call_a4a1fc0e5d23dbdc357786d4c69eda9b9}{state} == \hyperlink{msi_8h_afbc789bbdb9a4d00eda005500f7c1675abd210588def2a0d8ee3355cefbd28156}{msi\_CallActive}) \{
867                 \textcolor{comment}{/* Request for media change; call callback and send starting response */}
868                 \textcolor{keywordflow}{if} (\hyperlink{msi_8c_a92f71169666532a395aa396591e0426e}{flush\_peer\_csettings}(call, msg, 0) != 0) \{ 
869                     \hyperlink{logger_8h_ab3e970f3c1ecb5b71f17eccee4ebb286}{LOGGER\_WARNING}(\textcolor{stringliteral}{"Peer sent invalid csetting!"});
870                     \hyperlink{msi_8c_a61759c89740aba4cdeea164816115d32}{send\_error} ( session, call, \hyperlink{msi_8c_ab543e56b09aa092d084f4da3ae646423af1013422b03a404f37f53cdacca18dea}{error\_no\_callid}, msg->
      \hyperlink{struct___m_s_i_message_af43a034662e9bcac38e3bf4c9c150c19}{friend\_id} );
871                     \textcolor{keywordflow}{return} 0;
872                 \}
873 
874                 \hyperlink{logger_8h_a9885ca09ce5f94d936c91a5b0856a024}{LOGGER\_DEBUG}(\textcolor{stringliteral}{"Set new call type: %s"}, call->
      \hyperlink{struct___m_s_i_call_a3b7fc70c2772bbdc453eeff763fc0b4c}{csettings\_peer}[0].\hyperlink{struct___m_s_i_codec_settings_a24d841d0ab8a0b3f12f559aec494e4fe}{call\_type} == \hyperlink{msi_8h_a54df3a97d8d112a3a4a6476c9f9284a6a4a64c16a6c74d9e29598b14b97bf5a45}{msi\_TypeAudio} ? \textcolor{stringliteral}{"audio"} : \textcolor{stringliteral}{"video"});
875                 \hyperlink{msi_8c_aeac54d94bd4b3bfceab3a080cbf5e100}{send\_reponse}(session, call, \hyperlink{msi_8c_a7251f9a01631fc788dd7c8eff23a422ea658598d69535d5877bf2fa0af0dcfafa}{starting}, msg->
      \hyperlink{struct___m_s_i_message_af43a034662e9bcac38e3bf4c9c150c19}{friend\_id});
876                 \hyperlink{msi_8c_af6701ab999e1734c40580997749daf6f}{invoke\_callback}(session, call->\hyperlink{struct___m_s_i_call_ad6b287fd08a0cc466cd41bd2e76d5808}{call\_idx}, 
      \hyperlink{msi_8h_aba083d202aa40ee6d37db924fe486401a29ce7dec5e8fb8c8b5e5603b3c5f0ec4}{msi\_OnPeerCSChange});
877                 \textcolor{keywordflow}{return} 1;
878             \}
879         \} \textcolor{keywordflow}{else} \{
880             \hyperlink{msi_8c_a61759c89740aba4cdeea164816115d32}{send\_error} ( session, call, \hyperlink{msi_8c_ab543e56b09aa092d084f4da3ae646423a4d9b7fd794c2916ff10e69f9fc801466}{error\_busy}, msg->
      \hyperlink{struct___m_s_i_message_af43a034662e9bcac38e3bf4c9c150c19}{friend\_id} ); \textcolor{comment}{/* TODO: Ugh*/}
881             \hyperlink{msi_8c_abf7deacfacdcb5b7cc4cfc163583c40d}{terminate\_call}(session, call);
882             \textcolor{keywordflow}{return} 0;
883         \}
884     \} \textcolor{keywordflow}{else} \{
885         call = \hyperlink{msi_8c_adac49290dc2c80bd0921ffbedb78966f}{init\_call} ( session, 1, 0 );
886 
887         \textcolor{keywordflow}{if} ( !call ) \{
888             \hyperlink{logger_8h_aedad6a1e3ffe0d4cd0992b822ec0eeeb}{LOGGER\_ERROR}(\textcolor{stringliteral}{"Starting call"});
889             \textcolor{keywordflow}{return} 0;
890         \}
891     \}
892 
893     \textcolor{keywordflow}{if} ( !msg->\hyperlink{struct___m_s_i_message_a0cb3f797b633561175096933c2eb003e}{callid}.exists ) \{
894         \hyperlink{msi_8c_a61759c89740aba4cdeea164816115d32}{send\_error} ( session, call, \hyperlink{msi_8c_ab543e56b09aa092d084f4da3ae646423af1013422b03a404f37f53cdacca18dea}{error\_no\_callid}, msg->
      \hyperlink{struct___m_s_i_message_af43a034662e9bcac38e3bf4c9c150c19}{friend\_id} );
895         \hyperlink{msi_8c_abf7deacfacdcb5b7cc4cfc163583c40d}{terminate\_call}(session, call);
896         \textcolor{keywordflow}{return} 0;
897     \}
898 
899     memcpy ( call->\hyperlink{struct___m_s_i_call_aa135fbffd11268758f5f21269fb46853}{id}, msg->\hyperlink{struct___m_s_i_message_a0cb3f797b633561175096933c2eb003e}{callid}.value, \textcolor{keyword}{sizeof}(msg->\hyperlink{struct___m_s_i_message_a0cb3f797b633561175096933c2eb003e}{callid}.value) );
900     call->\hyperlink{struct___m_s_i_call_a4a1fc0e5d23dbdc357786d4c69eda9b9}{state} = \hyperlink{msi_8h_afbc789bbdb9a4d00eda005500f7c1675a62ecc3b8e850f62e9e14a2e38d6061bf}{msi\_CallStarting};
901 
902     \hyperlink{msi_8c_ae93f60c5c6d4713db189c4059e36e4c1}{add\_peer}( call, msg->\hyperlink{struct___m_s_i_message_af43a034662e9bcac38e3bf4c9c150c19}{friend\_id});
903     \hyperlink{msi_8c_a92f71169666532a395aa396591e0426e}{flush\_peer\_csettings} ( call, msg, 0 );
904     \hyperlink{msi_8c_aeac54d94bd4b3bfceab3a080cbf5e100}{send\_reponse}(session, call, \hyperlink{msi_8c_a7251f9a01631fc788dd7c8eff23a422eaa27786b5857031d78494d47532ecbb78}{ringing}, msg->\hyperlink{struct___m_s_i_message_af43a034662e9bcac38e3bf4c9c150c19}{friend\_id});
905     \hyperlink{msi_8c_af6701ab999e1734c40580997749daf6f}{invoke\_callback}(session, call->\hyperlink{struct___m_s_i_call_ad6b287fd08a0cc466cd41bd2e76d5808}{call\_idx}, \hyperlink{msi_8h_aba083d202aa40ee6d37db924fe486401ac7af67722adb9603bff7b9eaff69134b}{msi\_OnInvite});
906 
907     \textcolor{keywordflow}{return} 1;
908 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_a6c1d69163b2cfedea11ed5ed688dc669_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_a6c1d69163b2cfedea11ed5ed688dc669_icgraph}
\end{center}
\end{figure}


\hypertarget{msi_8c_adab5cbd8d80ff38f19008ee3fec808b8}{\index{msi.\+c@{msi.\+c}!handle\+\_\+recv\+\_\+reject@{handle\+\_\+recv\+\_\+reject}}
\index{handle\+\_\+recv\+\_\+reject@{handle\+\_\+recv\+\_\+reject}!msi.\+c@{msi.\+c}}
\subsubsection[{handle\+\_\+recv\+\_\+reject}]{\setlength{\rightskip}{0pt plus 5cm}static int handle\+\_\+recv\+\_\+reject (
\begin{DoxyParamCaption}
\item[{{\bf M\+S\+I\+Session} $\ast$}]{session, }
\item[{{\bf M\+S\+I\+Call} $\ast$}]{call, }
\item[{{\bf M\+S\+I\+Message} $\ast$}]{msg}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{msi_8c_adab5cbd8d80ff38f19008ee3fec808b8}


Definition at line 926 of file msi.\+c.



References \+\_\+\+M\+S\+I\+Call\+::call\+\_\+idx, ending, \+\_\+\+M\+S\+I\+Message\+::friend\+\_\+id, invoke\+\_\+callback(), L\+O\+G\+G\+E\+R\+\_\+\+D\+E\+B\+U\+G, L\+O\+G\+G\+E\+R\+\_\+\+W\+A\+R\+N\+I\+N\+G, msi\+\_\+\+On\+Reject, send\+\_\+reponse(), and terminate\+\_\+call().



Referenced by msi\+\_\+handle\+\_\+packet().


\begin{DoxyCode}
927 \{
928     \textcolor{keywordflow}{if} ( !call ) \{
929         \hyperlink{logger_8h_ab3e970f3c1ecb5b71f17eccee4ebb286}{LOGGER\_WARNING}(\textcolor{stringliteral}{"Session: %p Handling 'start' on no call"});
930         \textcolor{keywordflow}{return} 0;
931     \}
932 
933     \hyperlink{logger_8h_a9885ca09ce5f94d936c91a5b0856a024}{LOGGER\_DEBUG}(\textcolor{stringliteral}{"Session: %p Handling 'reject' on call: %u"}, session, call->
      \hyperlink{struct___m_s_i_call_ad6b287fd08a0cc466cd41bd2e76d5808}{call\_idx});
934 
935     \hyperlink{msi_8c_af6701ab999e1734c40580997749daf6f}{invoke\_callback}(session, call->\hyperlink{struct___m_s_i_call_ad6b287fd08a0cc466cd41bd2e76d5808}{call\_idx}, \hyperlink{msi_8h_aba083d202aa40ee6d37db924fe486401a97b05086f1a248b23580d3dbb8e4aa13}{msi\_OnReject});
936 
937     \hyperlink{msi_8c_aeac54d94bd4b3bfceab3a080cbf5e100}{send\_reponse}(session, call, \hyperlink{msi_8c_a7251f9a01631fc788dd7c8eff23a422ea6135603307626f48d62e2faa86a1d255}{ending}, msg->\hyperlink{struct___m_s_i_message_af43a034662e9bcac38e3bf4c9c150c19}{friend\_id});
938     \hyperlink{msi_8c_abf7deacfacdcb5b7cc4cfc163583c40d}{terminate\_call}(session, call);
939 
940     \textcolor{keywordflow}{return} 1;
941 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_adab5cbd8d80ff38f19008ee3fec808b8_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_adab5cbd8d80ff38f19008ee3fec808b8_icgraph}
\end{center}
\end{figure}


\hypertarget{msi_8c_ac4fd005ce0f0c990e7982acd92e341e3}{\index{msi.\+c@{msi.\+c}!handle\+\_\+recv\+\_\+ringing@{handle\+\_\+recv\+\_\+ringing}}
\index{handle\+\_\+recv\+\_\+ringing@{handle\+\_\+recv\+\_\+ringing}!msi.\+c@{msi.\+c}}
\subsubsection[{handle\+\_\+recv\+\_\+ringing}]{\setlength{\rightskip}{0pt plus 5cm}static int handle\+\_\+recv\+\_\+ringing (
\begin{DoxyParamCaption}
\item[{{\bf M\+S\+I\+Session} $\ast$}]{session, }
\item[{{\bf M\+S\+I\+Call} $\ast$}]{call, }
\item[{{\bf M\+S\+I\+Message} $\ast$}]{msg}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{msi_8c_ac4fd005ce0f0c990e7982acd92e341e3}


Definition at line 977 of file msi.\+c.



References \+\_\+\+M\+S\+I\+Call\+::call\+\_\+idx, handle\+\_\+timeout(), invoke\+\_\+callback(), L\+O\+G\+G\+E\+R\+\_\+\+D\+E\+B\+U\+G, L\+O\+G\+G\+E\+R\+\_\+\+W\+A\+R\+N\+I\+N\+G, msi\+\_\+\+On\+Ringing, \+\_\+\+M\+S\+I\+Call\+::ringing\+\_\+timer\+\_\+id, \+\_\+\+M\+S\+I\+Call\+::ringing\+\_\+tout\+\_\+ms, and timer\+\_\+alloc().



Referenced by msi\+\_\+handle\+\_\+packet().


\begin{DoxyCode}
978 \{
979     \textcolor{keywordflow}{if} ( !call ) \{
980         \hyperlink{logger_8h_ab3e970f3c1ecb5b71f17eccee4ebb286}{LOGGER\_WARNING}(\textcolor{stringliteral}{"Session: %p Handling 'start' on no call"});
981         \textcolor{keywordflow}{return} 0;
982     \}
983 
984     (void)msg;
985 
986     \textcolor{keywordflow}{if} ( call->\hyperlink{struct___m_s_i_call_a94fdc66dbd509ba4e89edcedb8e11022}{ringing\_timer\_id} ) \{
987         \hyperlink{logger_8h_ab3e970f3c1ecb5b71f17eccee4ebb286}{LOGGER\_WARNING}(\textcolor{stringliteral}{"Call already ringing"});
988         \textcolor{keywordflow}{return} 0;
989     \}
990 
991     \hyperlink{logger_8h_a9885ca09ce5f94d936c91a5b0856a024}{LOGGER\_DEBUG}(\textcolor{stringliteral}{"Session: %p Handling 'ringing' on call: %d"}, session, call->
      \hyperlink{struct___m_s_i_call_ad6b287fd08a0cc466cd41bd2e76d5808}{call\_idx} );
992 
993     call->\hyperlink{struct___m_s_i_call_a94fdc66dbd509ba4e89edcedb8e11022}{ringing\_timer\_id} = \hyperlink{msi_8c_a0a093063a8a2e48ca88d8d47234415cb}{timer\_alloc}
994                              ( session, \hyperlink{msi_8c_a7a5b1246a4f5680ee60c45e69e04dcd4}{handle\_timeout}, call->
      \hyperlink{struct___m_s_i_call_ad6b287fd08a0cc466cd41bd2e76d5808}{call\_idx}, call->\hyperlink{struct___m_s_i_call_ad8fefcfbba597fbff4216644f2872acf}{ringing\_tout\_ms} );
995     \hyperlink{msi_8c_af6701ab999e1734c40580997749daf6f}{invoke\_callback}(session, call->\hyperlink{struct___m_s_i_call_ad6b287fd08a0cc466cd41bd2e76d5808}{call\_idx}, 
      \hyperlink{msi_8h_aba083d202aa40ee6d37db924fe486401a00f6e10224bff238634a317bae38eca0}{msi\_OnRinging});
996     \textcolor{keywordflow}{return} 1;
997 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_ac4fd005ce0f0c990e7982acd92e341e3_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_ac4fd005ce0f0c990e7982acd92e341e3_icgraph}
\end{center}
\end{figure}


\hypertarget{msi_8c_a4d75b79b31c9451a723522b891ec75fd}{\index{msi.\+c@{msi.\+c}!handle\+\_\+recv\+\_\+start@{handle\+\_\+recv\+\_\+start}}
\index{handle\+\_\+recv\+\_\+start@{handle\+\_\+recv\+\_\+start}!msi.\+c@{msi.\+c}}
\subsubsection[{handle\+\_\+recv\+\_\+start}]{\setlength{\rightskip}{0pt plus 5cm}static int handle\+\_\+recv\+\_\+start (
\begin{DoxyParamCaption}
\item[{{\bf M\+S\+I\+Session} $\ast$}]{session, }
\item[{{\bf M\+S\+I\+Call} $\ast$}]{call, }
\item[{{\bf M\+S\+I\+Message} $\ast$}]{msg}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{msi_8c_a4d75b79b31c9451a723522b891ec75fd}


Definition at line 910 of file msi.\+c.



References \+\_\+\+M\+S\+I\+Call\+::call\+\_\+idx, \+\_\+\+M\+S\+I\+Message\+::friend\+\_\+id, invoke\+\_\+callback(), L\+O\+G\+G\+E\+R\+\_\+\+D\+E\+B\+U\+G, L\+O\+G\+G\+E\+R\+\_\+\+W\+A\+R\+N\+I\+N\+G, msi\+\_\+\+Call\+Active, msi\+\_\+\+On\+Start, and \+\_\+\+M\+S\+I\+Call\+::state.



Referenced by msi\+\_\+handle\+\_\+packet().


\begin{DoxyCode}
911 \{
912     \textcolor{keywordflow}{if} ( !call ) \{
913         \hyperlink{logger_8h_ab3e970f3c1ecb5b71f17eccee4ebb286}{LOGGER\_WARNING}(\textcolor{stringliteral}{"Session: %p Handling 'start' on no call"});
914         \textcolor{keywordflow}{return} 0;
915     \}
916 
917     (void)msg;
918 
919     \hyperlink{logger_8h_a9885ca09ce5f94d936c91a5b0856a024}{LOGGER\_DEBUG}(\textcolor{stringliteral}{"Session: %p Handling 'start' on call: %d, friend id: %d"}, session, call->
      \hyperlink{struct___m_s_i_call_ad6b287fd08a0cc466cd41bd2e76d5808}{call\_idx}, msg->\hyperlink{struct___m_s_i_message_af43a034662e9bcac38e3bf4c9c150c19}{friend\_id} );
920 
921     call->\hyperlink{struct___m_s_i_call_a4a1fc0e5d23dbdc357786d4c69eda9b9}{state} = \hyperlink{msi_8h_afbc789bbdb9a4d00eda005500f7c1675abd210588def2a0d8ee3355cefbd28156}{msi\_CallActive};
922     \hyperlink{msi_8c_af6701ab999e1734c40580997749daf6f}{invoke\_callback}(session, call->\hyperlink{struct___m_s_i_call_ad6b287fd08a0cc466cd41bd2e76d5808}{call\_idx}, \hyperlink{msi_8h_aba083d202aa40ee6d37db924fe486401af7cf963a6bd2bb46d8c387d5d65b7a4a}{msi\_OnStart});
923     \textcolor{keywordflow}{return} 1;
924 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=296pt]{d2/d9b/msi_8c_a4d75b79b31c9451a723522b891ec75fd_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_a4d75b79b31c9451a723522b891ec75fd_icgraph}
\end{center}
\end{figure}


\hypertarget{msi_8c_ada9b9ef63c3c73e22b672d7cfb5bd6a3}{\index{msi.\+c@{msi.\+c}!handle\+\_\+recv\+\_\+starting@{handle\+\_\+recv\+\_\+starting}}
\index{handle\+\_\+recv\+\_\+starting@{handle\+\_\+recv\+\_\+starting}!msi.\+c@{msi.\+c}}
\subsubsection[{handle\+\_\+recv\+\_\+starting}]{\setlength{\rightskip}{0pt plus 5cm}static int handle\+\_\+recv\+\_\+starting (
\begin{DoxyParamCaption}
\item[{{\bf M\+S\+I\+Session} $\ast$}]{session, }
\item[{{\bf M\+S\+I\+Call} $\ast$}]{call, }
\item[{{\bf M\+S\+I\+Message} $\ast$}]{msg}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{msi_8c_ada9b9ef63c3c73e22b672d7cfb5bd6a3}


Definition at line 998 of file msi.\+c.



References \+\_\+\+M\+S\+I\+Call\+::call\+\_\+idx, flush\+\_\+peer\+\_\+csettings(), \+\_\+\+M\+S\+I\+Message\+::friend\+\_\+id, invoke\+\_\+callback(), L\+O\+G\+G\+E\+R\+\_\+\+D\+E\+B\+U\+G, L\+O\+G\+G\+E\+R\+\_\+\+E\+R\+R\+O\+R, L\+O\+G\+G\+E\+R\+\_\+\+W\+A\+R\+N\+I\+N\+G, msi\+\_\+\+Call\+Active, msi\+\_\+\+Call\+Inviting, msi\+\_\+new\+\_\+message(), msi\+\_\+\+On\+Self\+C\+S\+Change, msi\+\_\+\+On\+Start, \+\_\+\+M\+S\+I\+Call\+::ringing\+\_\+timer\+\_\+id, send\+\_\+message(), start, \+\_\+\+M\+S\+I\+Call\+::state, terminate\+\_\+call(), \+\_\+\+M\+S\+I\+Session\+::timer\+\_\+handler, timer\+\_\+release(), and Type\+Request.



Referenced by msi\+\_\+handle\+\_\+packet().


\begin{DoxyCode}
999 \{
1000     \textcolor{keywordflow}{if} ( !call ) \{
1001         \hyperlink{logger_8h_ab3e970f3c1ecb5b71f17eccee4ebb286}{LOGGER\_WARNING}(\textcolor{stringliteral}{"Session: %p Handling 'starting' on non-existing call"});
1002         \textcolor{keywordflow}{return} 0;
1003     \}
1004 
1005     \textcolor{keywordflow}{if} ( call->\hyperlink{struct___m_s_i_call_a4a1fc0e5d23dbdc357786d4c69eda9b9}{state} == \hyperlink{msi_8h_afbc789bbdb9a4d00eda005500f7c1675abd210588def2a0d8ee3355cefbd28156}{msi\_CallActive} ) \{ \textcolor{comment}{/* Change media */}
1006 
1007         \hyperlink{logger_8h_a9885ca09ce5f94d936c91a5b0856a024}{LOGGER\_DEBUG}(\textcolor{stringliteral}{"Session: %p Changing media on call: %d"}, session, call->
      \hyperlink{struct___m_s_i_call_ad6b287fd08a0cc466cd41bd2e76d5808}{call\_idx} );
1008 
1009         \hyperlink{msi_8c_af6701ab999e1734c40580997749daf6f}{invoke\_callback}(session, call->\hyperlink{struct___m_s_i_call_ad6b287fd08a0cc466cd41bd2e76d5808}{call\_idx}, 
      \hyperlink{msi_8h_aba083d202aa40ee6d37db924fe486401a06d2be36247d0a05f55070c644149b0f}{msi\_OnSelfCSChange});
1010 
1011     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( call->\hyperlink{struct___m_s_i_call_a4a1fc0e5d23dbdc357786d4c69eda9b9}{state} == \hyperlink{msi_8h_afbc789bbdb9a4d00eda005500f7c1675a8985e709f0a11b30a998d833c7e29132}{msi\_CallInviting} ) \{
1012         \hyperlink{logger_8h_a9885ca09ce5f94d936c91a5b0856a024}{LOGGER\_DEBUG}(\textcolor{stringliteral}{"Session: %p Handling 'starting' on call: %d"}, session, call->
      \hyperlink{struct___m_s_i_call_ad6b287fd08a0cc466cd41bd2e76d5808}{call\_idx} );
1013 
1014         call->\hyperlink{struct___m_s_i_call_a4a1fc0e5d23dbdc357786d4c69eda9b9}{state} = \hyperlink{msi_8h_afbc789bbdb9a4d00eda005500f7c1675abd210588def2a0d8ee3355cefbd28156}{msi\_CallActive};
1015 
1016         \hyperlink{struct___m_s_i_message}{MSIMessage} *msg\_start = \hyperlink{msi_8c_aed030e510836ee3cc994f84f06a0cc98}{msi\_new\_message} ( 
      \hyperlink{msi_8c_a6557c179987e0c84ccb97c9f29a302efa3bc11c46b5beb3df428936d6f53b03f7}{TypeRequest}, \hyperlink{msi_8c_ae511d1f1e345bb77cd4120b39679f028a0e97c69c73117f6c0109b2d7d1d9cedc}{start} );
1017         \hyperlink{msi_8c_ae174427d97e924339f9e2a961ec773a1}{send\_message} ( session, call, msg\_start, msg->\hyperlink{struct___m_s_i_message_af43a034662e9bcac38e3bf4c9c150c19}{friend\_id} );
1018         free ( msg\_start );
1019 
1020 
1021         \hyperlink{msi_8c_a92f71169666532a395aa396591e0426e}{flush\_peer\_csettings} ( call, msg, 0 );
1022 
1023         \textcolor{comment}{/* This is here in case of glare */}
1024         \hyperlink{msi_8c_ab6f36f5852629fabd6e3c85451e5be65}{timer\_release}(session->\hyperlink{struct___m_s_i_session_a06ab765308a606d809c4c2a2c71710ce}{timer\_handler}, call->
      \hyperlink{struct___m_s_i_call_a94fdc66dbd509ba4e89edcedb8e11022}{ringing\_timer\_id});
1025         \hyperlink{msi_8c_af6701ab999e1734c40580997749daf6f}{invoke\_callback}(session, call->\hyperlink{struct___m_s_i_call_ad6b287fd08a0cc466cd41bd2e76d5808}{call\_idx}, 
      \hyperlink{msi_8h_aba083d202aa40ee6d37db924fe486401af7cf963a6bd2bb46d8c387d5d65b7a4a}{msi\_OnStart});
1026     \} \textcolor{keywordflow}{else} \{
1027         \hyperlink{logger_8h_aedad6a1e3ffe0d4cd0992b822ec0eeeb}{LOGGER\_ERROR}(\textcolor{stringliteral}{"Invalid call state"});
1028         \hyperlink{msi_8c_abf7deacfacdcb5b7cc4cfc163583c40d}{terminate\_call}(session, call );
1029         \textcolor{keywordflow}{return} 0;
1030     \}
1031 
1032     \textcolor{keywordflow}{return} 1;
1033 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_ada9b9ef63c3c73e22b672d7cfb5bd6a3_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_ada9b9ef63c3c73e22b672d7cfb5bd6a3_icgraph}
\end{center}
\end{figure}


\hypertarget{msi_8c_a4d438c93388bdd8b338bd50632144de5}{\index{msi.\+c@{msi.\+c}!handle\+\_\+remote\+\_\+connection\+\_\+change@{handle\+\_\+remote\+\_\+connection\+\_\+change}}
\index{handle\+\_\+remote\+\_\+connection\+\_\+change@{handle\+\_\+remote\+\_\+connection\+\_\+change}!msi.\+c@{msi.\+c}}
\subsubsection[{handle\+\_\+remote\+\_\+connection\+\_\+change}]{\setlength{\rightskip}{0pt plus 5cm}static void handle\+\_\+remote\+\_\+connection\+\_\+change (
\begin{DoxyParamCaption}
\item[{{\bf Messenger} $\ast$}]{messenger, }
\item[{uint32\+\_\+t}]{friend\+\_\+num, }
\item[{uint8\+\_\+t}]{status, }
\item[{void $\ast$}]{session\+\_\+p}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{msi_8c_a4d438c93388bdd8b338bd50632144de5}


Definition at line 776 of file msi.\+c.



References \+\_\+\+M\+S\+I\+Session\+::calls, i, invoke\+\_\+callback(), L\+O\+G\+G\+E\+R\+\_\+\+D\+E\+B\+U\+G, \+\_\+\+M\+S\+I\+Session\+::max\+\_\+calls, msi\+\_\+\+On\+Peer\+Timeout, \+\_\+\+M\+S\+I\+Call\+::peer\+\_\+count, \+\_\+\+M\+S\+I\+Call\+::peers, and terminate\+\_\+call().



Referenced by msi\+\_\+new().


\begin{DoxyCode}
777 \{
778     (void)messenger;
779     \hyperlink{struct___m_s_i_session}{MSISession} *session = session\_p;
780 
781     \textcolor{keywordflow}{switch} ( status ) \{
782         \textcolor{keywordflow}{case} 0: \{ \textcolor{comment}{/* Went offline */}
783             int32\_t j = 0;
784 
785             \textcolor{keywordflow}{for} ( ; j < session->\hyperlink{struct___m_s_i_session_ae4bbb4682dc5c74588083ca06ac2f76f}{max\_calls}; j ++ ) \{
786 
787                 \textcolor{keywordflow}{if} ( !session->\hyperlink{struct___m_s_i_session_ac40fee673bae4030b812579c57389a02}{calls}[j] ) \textcolor{keywordflow}{continue};
788 
789                 uint16\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i} = 0;
790 
791                 \textcolor{keywordflow}{for} ( ; i < session->\hyperlink{struct___m_s_i_session_ac40fee673bae4030b812579c57389a02}{calls}[j]->\hyperlink{struct___m_s_i_call_a62e9da1e57f84fd224590c4d466724aa}{peer\_count}; i ++ )
792                     \textcolor{keywordflow}{if} ( session->\hyperlink{struct___m_s_i_session_ac40fee673bae4030b812579c57389a02}{calls}[j]->\hyperlink{struct___m_s_i_call_a55d2568491d616f7fef07bc7137c8c23}{peers}[i] == (uint32\_t)friend\_num ) \{
793                         \hyperlink{msi_8c_af6701ab999e1734c40580997749daf6f}{invoke\_callback}(session, j, 
      \hyperlink{msi_8h_aba083d202aa40ee6d37db924fe486401ab8bd4ae06f000c0b590128c472218343}{msi\_OnPeerTimeout});
794                         \hyperlink{msi_8c_abf7deacfacdcb5b7cc4cfc163583c40d}{terminate\_call}(session, session->\hyperlink{struct___m_s_i_session_ac40fee673bae4030b812579c57389a02}{calls}[j]);
795                         \hyperlink{logger_8h_a9885ca09ce5f94d936c91a5b0856a024}{LOGGER\_DEBUG}(\textcolor{stringliteral}{"Remote: %d timed out!"}, friend\_num);
796                         \textcolor{keywordflow}{return}; \textcolor{comment}{/* TODO: On group calls change behaviour */}
797                     \}
798             \}
799         \}
800         \textcolor{keywordflow}{break};
801 
802         \textcolor{keywordflow}{default}:
803             \textcolor{keywordflow}{break};
804     \}
805 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_a4d438c93388bdd8b338bd50632144de5_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_a4d438c93388bdd8b338bd50632144de5_icgraph}
\end{center}
\end{figure}


\hypertarget{msi_8c_a7a5b1246a4f5680ee60c45e69e04dcd4}{\index{msi.\+c@{msi.\+c}!handle\+\_\+timeout@{handle\+\_\+timeout}}
\index{handle\+\_\+timeout@{handle\+\_\+timeout}!msi.\+c@{msi.\+c}}
\subsubsection[{handle\+\_\+timeout}]{\setlength{\rightskip}{0pt plus 5cm}static void handle\+\_\+timeout (
\begin{DoxyParamCaption}
\item[{{\bf Timer} $\ast$}]{timer}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{msi_8c_a7a5b1246a4f5680ee60c45e69e04dcd4}
Function called at request timeout 

Definition at line 810 of file msi.\+c.



References \+\_\+\+M\+S\+I\+Call\+::call\+\_\+idx, \+\_\+\+Timer\+::call\+\_\+idx, \+\_\+\+M\+S\+I\+Session\+::calls, invoke\+\_\+callback(), L\+O\+G\+G\+E\+R\+\_\+\+D\+E\+B\+U\+G, msi\+\_\+cancel(), msi\+\_\+\+On\+Request\+Timeout, \+\_\+\+M\+S\+I\+Call\+::peers, and \+\_\+\+Timer\+::session.



Referenced by handle\+\_\+recv\+\_\+ringing(), msi\+\_\+hangup(), msi\+\_\+invite(), and msi\+\_\+reject().


\begin{DoxyCode}
811 \{
812     \textcolor{comment}{/* TODO: Cancel might not arrive there; set up}
813 \textcolor{comment}{     * timers on these cancels and terminate call on}
814 \textcolor{comment}{     * their timeout}
815 \textcolor{comment}{     */}
816     \hyperlink{struct___m_s_i_call}{MSICall} *call = timer->\hyperlink{struct___timer_affcb6f96b80aecebae0f1b157c6242b5}{session}->\hyperlink{struct___m_s_i_session_ac40fee673bae4030b812579c57389a02}{calls}[timer->\hyperlink{struct___timer_a1137c8c8a662d51868eda69bd73915d0}{call\_idx}];
817 
818 
819     \textcolor{keywordflow}{if} (call) \{
820         \hyperlink{logger_8h_a9885ca09ce5f94d936c91a5b0856a024}{LOGGER\_DEBUG}(\textcolor{stringliteral}{"[Call: %d] Request timed out!"}, call->\hyperlink{struct___m_s_i_call_ad6b287fd08a0cc466cd41bd2e76d5808}{call\_idx});
821 
822         \hyperlink{msi_8c_af6701ab999e1734c40580997749daf6f}{invoke\_callback}(timer->\hyperlink{struct___timer_affcb6f96b80aecebae0f1b157c6242b5}{session}, timer->\hyperlink{struct___timer_a1137c8c8a662d51868eda69bd73915d0}{call\_idx}, 
      \hyperlink{msi_8h_aba083d202aa40ee6d37db924fe486401a211f73b9481d8f9468b79059a6ef24ec}{msi\_OnRequestTimeout});
823         \hyperlink{msi_8c_aefbf5f591676d4b56853b21fdf215e69}{msi\_cancel}(timer->\hyperlink{struct___timer_affcb6f96b80aecebae0f1b157c6242b5}{session}, timer->\hyperlink{struct___timer_a1137c8c8a662d51868eda69bd73915d0}{call\_idx}, call->
      \hyperlink{struct___m_s_i_call_a55d2568491d616f7fef07bc7137c8c23}{peers} [0], \textcolor{stringliteral}{"Request timed out"});
824     \}
825 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_a7a5b1246a4f5680ee60c45e69e04dcd4_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_a7a5b1246a4f5680ee60c45e69e04dcd4_icgraph}
\end{center}
\end{figure}


\hypertarget{msi_8c_adac49290dc2c80bd0921ffbedb78966f}{\index{msi.\+c@{msi.\+c}!init\+\_\+call@{init\+\_\+call}}
\index{init\+\_\+call@{init\+\_\+call}!msi.\+c@{msi.\+c}}
\subsubsection[{init\+\_\+call}]{\setlength{\rightskip}{0pt plus 5cm}static {\bf M\+S\+I\+Call}$\ast$ init\+\_\+call (
\begin{DoxyParamCaption}
\item[{{\bf M\+S\+I\+Session} $\ast$}]{session, }
\item[{int}]{peers, }
\item[{int}]{ringing\+\_\+timeout}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{msi_8c_adac49290dc2c80bd0921ffbedb78966f}


Definition at line 704 of file msi.\+c.



References \+\_\+\+M\+S\+I\+Call\+::call\+\_\+idx, \+\_\+\+M\+S\+I\+Session\+::calls, \+\_\+\+M\+S\+I\+Call\+::csettings\+\_\+peer, L\+O\+G\+G\+E\+R\+\_\+\+D\+E\+B\+U\+G, L\+O\+G\+G\+E\+R\+\_\+\+E\+R\+R\+O\+R, L\+O\+G\+G\+E\+R\+\_\+\+W\+A\+R\+N\+I\+N\+G, \+\_\+\+M\+S\+I\+Session\+::max\+\_\+calls, \+\_\+\+M\+S\+I\+Call\+::request\+\_\+timer\+\_\+id, \+\_\+\+M\+S\+I\+Call\+::ringing\+\_\+timer\+\_\+id, \+\_\+\+M\+S\+I\+Call\+::ringing\+\_\+tout\+\_\+ms, and \+\_\+\+M\+S\+I\+Call\+::session.



Referenced by handle\+\_\+recv\+\_\+invite(), and msi\+\_\+invite().


\begin{DoxyCode}
705 \{
706 
707     \textcolor{keywordflow}{if} (peers == 0) \{
708         \hyperlink{logger_8h_aedad6a1e3ffe0d4cd0992b822ec0eeeb}{LOGGER\_ERROR}(\textcolor{stringliteral}{"No peers!"});
709         \textcolor{keywordflow}{return} NULL;
710     \}
711 
712     int32\_t call\_idx = 0;
713 
714     \textcolor{keywordflow}{for} (; call\_idx < session->\hyperlink{struct___m_s_i_session_ae4bbb4682dc5c74588083ca06ac2f76f}{max\_calls}; call\_idx ++) \{
715         \textcolor{keywordflow}{if} ( !session->\hyperlink{struct___m_s_i_session_ac40fee673bae4030b812579c57389a02}{calls}[call\_idx] ) \{
716 
717             \textcolor{keywordflow}{if} (!(session->\hyperlink{struct___m_s_i_session_ac40fee673bae4030b812579c57389a02}{calls}[call\_idx] = calloc ( \textcolor{keyword}{sizeof} ( \hyperlink{struct___m_s_i_call}{MSICall} ), 1 ))) \{
718                 \hyperlink{logger_8h_ab3e970f3c1ecb5b71f17eccee4ebb286}{LOGGER\_WARNING}(\textcolor{stringliteral}{"Allocation failed! Program might misbehave!"});
719                 \textcolor{keywordflow}{return} NULL;
720             \}
721 
722             \textcolor{keywordflow}{break};
723         \}
724     \}
725 
726     \textcolor{keywordflow}{if} ( call\_idx == session->\hyperlink{struct___m_s_i_session_ae4bbb4682dc5c74588083ca06ac2f76f}{max\_calls} ) \{
727         \hyperlink{logger_8h_ab3e970f3c1ecb5b71f17eccee4ebb286}{LOGGER\_WARNING}(\textcolor{stringliteral}{"Reached maximum amount of calls!"});
728         \textcolor{keywordflow}{return} NULL;
729     \}
730 
731 
732     \hyperlink{struct___m_s_i_call}{MSICall} *call = session->\hyperlink{struct___m_s_i_session_ac40fee673bae4030b812579c57389a02}{calls}[call\_idx];
733 
734     call->\hyperlink{struct___m_s_i_call_ad6b287fd08a0cc466cd41bd2e76d5808}{call\_idx} = call\_idx;
735 
736     \textcolor{keywordflow}{if} ( !(call->\hyperlink{struct___m_s_i_call_a3b7fc70c2772bbdc453eeff763fc0b4c}{csettings\_peer} = calloc ( \textcolor{keyword}{sizeof} ( \hyperlink{struct___m_s_i_codec_settings}{MSICSettings} ), peers )) ) \{
737         \hyperlink{logger_8h_ab3e970f3c1ecb5b71f17eccee4ebb286}{LOGGER\_WARNING}(\textcolor{stringliteral}{"Allocation failed! Program might misbehave!"});
738         free(call);
739         \textcolor{keywordflow}{return} NULL;
740     \}
741 
742     call->\hyperlink{struct___m_s_i_call_ab8c2a41964c26c7f08f62fa440541b12}{session} = session;
743 
744     call->\hyperlink{struct___m_s_i_call_a8ccfd1cd9f807007763f41eafd801130}{request\_timer\_id} = 0;
745     call->\hyperlink{struct___m_s_i_call_a94fdc66dbd509ba4e89edcedb8e11022}{ringing\_timer\_id} = 0;
746 
747     call->\hyperlink{struct___m_s_i_call_ad8fefcfbba597fbff4216644f2872acf}{ringing\_tout\_ms} = ringing\_timeout;
748 
749     \hyperlink{logger_8h_a9885ca09ce5f94d936c91a5b0856a024}{LOGGER\_DEBUG}(\textcolor{stringliteral}{"Started new call with index: %u"}, call\_idx);
750     \textcolor{keywordflow}{return} call;
751 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_adac49290dc2c80bd0921ffbedb78966f_icgraph}
\end{center}
\end{figure}


\hypertarget{msi_8c_af6701ab999e1734c40580997749daf6f}{\index{msi.\+c@{msi.\+c}!invoke\+\_\+callback@{invoke\+\_\+callback}}
\index{invoke\+\_\+callback@{invoke\+\_\+callback}!msi.\+c@{msi.\+c}}
\subsubsection[{invoke\+\_\+callback}]{\setlength{\rightskip}{0pt plus 5cm}static void invoke\+\_\+callback (
\begin{DoxyParamCaption}
\item[{{\bf M\+S\+I\+Session} $\ast$}]{s, }
\item[{int32\+\_\+t}]{c, }
\item[{{\bf M\+S\+I\+Callback\+I\+D}}]{i}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{msi_8c_af6701ab999e1734c40580997749daf6f}


Definition at line 112 of file msi.\+c.



References \+\_\+\+M\+S\+I\+Session\+::agent\+\_\+handler, i, and L\+O\+G\+G\+E\+R\+\_\+\+D\+E\+B\+U\+G.



Referenced by handle\+\_\+recv\+\_\+cancel(), handle\+\_\+recv\+\_\+end(), handle\+\_\+recv\+\_\+ending(), handle\+\_\+recv\+\_\+error(), handle\+\_\+recv\+\_\+invite(), handle\+\_\+recv\+\_\+reject(), handle\+\_\+recv\+\_\+ringing(), handle\+\_\+recv\+\_\+start(), handle\+\_\+recv\+\_\+starting(), handle\+\_\+remote\+\_\+connection\+\_\+change(), and handle\+\_\+timeout().


\begin{DoxyCode}
113 \{
114     \textcolor{keywordflow}{if} ( s->callbacks[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}].first ) \{
115         \hyperlink{logger_8h_a9885ca09ce5f94d936c91a5b0856a024}{LOGGER\_DEBUG}(\textcolor{stringliteral}{"Invoking callback function: %d"}, \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i});
116 
117         s->callbacks[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}].first( s->\hyperlink{struct___m_s_i_session_ae284478ea42e8d4ed283876c3ae18c8a}{agent\_handler}, c, s->callbacks[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}].second );
118     \}
119 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_af6701ab999e1734c40580997749daf6f_icgraph}
\end{center}
\end{figure}


\hypertarget{msi_8c_a3cf8337cde29970de207c3c77c953261}{\index{msi.\+c@{msi.\+c}!msi\+\_\+answer@{msi\+\_\+answer}}
\index{msi\+\_\+answer@{msi\+\_\+answer}!msi.\+c@{msi.\+c}}
\subsubsection[{msi\+\_\+answer}]{\setlength{\rightskip}{0pt plus 5cm}int msi\+\_\+answer (
\begin{DoxyParamCaption}
\item[{{\bf M\+S\+I\+Session} $\ast$}]{session, }
\item[{int32\+\_\+t}]{call\+\_\+index, }
\item[{const {\bf M\+S\+I\+C\+Settings} $\ast$}]{csettings}
\end{DoxyParamCaption}
)}}\label{msi_8c_a3cf8337cde29970de207c3c77c953261}
Answer active call request. 

Definition at line 1403 of file msi.\+c.



References \+\_\+\+M\+S\+I\+Session\+::calls, \+\_\+\+M\+S\+I\+Call\+::csettings\+\_\+local, L\+O\+G\+G\+E\+R\+\_\+\+D\+E\+B\+U\+G, L\+O\+G\+G\+E\+R\+\_\+\+E\+R\+R\+O\+R, \+\_\+\+M\+S\+I\+Session\+::max\+\_\+calls, msi\+\_\+\+Call\+Active, msi\+\_\+\+Call\+Starting, msi\+\_\+\+Error\+Invalid\+State, msi\+\_\+\+Error\+No\+Call, msi\+\_\+msg\+\_\+set\+\_\+csettings(), msi\+\_\+new\+\_\+message(), \+\_\+\+M\+S\+I\+Session\+::mutex, \+\_\+\+M\+S\+I\+Call\+::peers, send\+\_\+message(), starting, \+\_\+\+M\+S\+I\+Call\+::state, and Type\+Response.



Referenced by toxav\+\_\+answer().


\begin{DoxyCode}
1404 \{
1405     pthread\_mutex\_lock(session->\hyperlink{struct___m_s_i_session_ab4293016252c4d4e63549b0773fa0f33}{mutex});
1406     \hyperlink{logger_8h_a9885ca09ce5f94d936c91a5b0856a024}{LOGGER\_DEBUG}(\textcolor{stringliteral}{"Session: %p Answering call: %u"}, session, call\_index);
1407 
1408     \textcolor{keywordflow}{if} ( call\_index < 0 || call\_index >= session->\hyperlink{struct___m_s_i_session_ae4bbb4682dc5c74588083ca06ac2f76f}{max\_calls} || !session->
      \hyperlink{struct___m_s_i_session_ac40fee673bae4030b812579c57389a02}{calls}[call\_index] ) \{
1409         \hyperlink{logger_8h_aedad6a1e3ffe0d4cd0992b822ec0eeeb}{LOGGER\_ERROR}(\textcolor{stringliteral}{"Invalid call index!"});
1410         pthread\_mutex\_unlock(session->\hyperlink{struct___m_s_i_session_ab4293016252c4d4e63549b0773fa0f33}{mutex});
1411         \textcolor{keywordflow}{return} \hyperlink{msi_8h_a52e2ed4d0fa75f870135d452f1f6c229ad3798ce3d9dc448484bf6bfea7a176d3}{msi\_ErrorNoCall};
1412     \}
1413 
1414     \textcolor{keywordflow}{if} ( session->\hyperlink{struct___m_s_i_session_ac40fee673bae4030b812579c57389a02}{calls}[call\_index]->\hyperlink{struct___m_s_i_call_a4a1fc0e5d23dbdc357786d4c69eda9b9}{state} != \hyperlink{msi_8h_afbc789bbdb9a4d00eda005500f7c1675a62ecc3b8e850f62e9e14a2e38d6061bf}{msi\_CallStarting} ) \{
1415         \hyperlink{logger_8h_aedad6a1e3ffe0d4cd0992b822ec0eeeb}{LOGGER\_ERROR}(\textcolor{stringliteral}{"Call is in invalid state!"});
1416         pthread\_mutex\_unlock(session->\hyperlink{struct___m_s_i_session_ab4293016252c4d4e63549b0773fa0f33}{mutex});
1417         \textcolor{keywordflow}{return} \hyperlink{msi_8h_a52e2ed4d0fa75f870135d452f1f6c229a4c874bed9952017bb68e0a27d87a9cde}{msi\_ErrorInvalidState};
1418     \}
1419 
1420     \hyperlink{struct___m_s_i_message}{MSIMessage} *msg\_starting = \hyperlink{msi_8c_aed030e510836ee3cc994f84f06a0cc98}{msi\_new\_message} ( 
      \hyperlink{msi_8c_a6557c179987e0c84ccb97c9f29a302efa44af861e1cb1f54554d3a48a9dfa343b}{TypeResponse}, \hyperlink{msi_8c_a7251f9a01631fc788dd7c8eff23a422ea658598d69535d5877bf2fa0af0dcfafa}{starting} );
1421 
1422     session->\hyperlink{struct___m_s_i_session_ac40fee673bae4030b812579c57389a02}{calls}[call\_index]->\hyperlink{struct___m_s_i_call_ae57cfc81fffd82f53953c6546bb9f3c3}{csettings\_local} = *csettings;
1423 
1424     \hyperlink{msi_8c_ad8cf444077a0744601cf9107fbb6dbb8}{msi\_msg\_set\_csettings}(msg\_starting, csettings);
1425 
1426     \hyperlink{msi_8c_ae174427d97e924339f9e2a961ec773a1}{send\_message} ( session, session->\hyperlink{struct___m_s_i_session_ac40fee673bae4030b812579c57389a02}{calls}[call\_index], msg\_starting, session->
      \hyperlink{struct___m_s_i_session_ac40fee673bae4030b812579c57389a02}{calls}[call\_index]->\hyperlink{struct___m_s_i_call_a55d2568491d616f7fef07bc7137c8c23}{peers}[0] );
1427     free ( msg\_starting );
1428 
1429     session->\hyperlink{struct___m_s_i_session_ac40fee673bae4030b812579c57389a02}{calls}[call\_index]->\hyperlink{struct___m_s_i_call_a4a1fc0e5d23dbdc357786d4c69eda9b9}{state} = \hyperlink{msi_8h_afbc789bbdb9a4d00eda005500f7c1675abd210588def2a0d8ee3355cefbd28156}{msi\_CallActive};
1430 
1431     pthread\_mutex\_unlock(session->\hyperlink{struct___m_s_i_session_ab4293016252c4d4e63549b0773fa0f33}{mutex});
1432     \textcolor{keywordflow}{return} 0;
1433 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_a3cf8337cde29970de207c3c77c953261_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_a3cf8337cde29970de207c3c77c953261_icgraph}
\end{center}
\end{figure}


\hypertarget{msi_8c_aefbf5f591676d4b56853b21fdf215e69}{\index{msi.\+c@{msi.\+c}!msi\+\_\+cancel@{msi\+\_\+cancel}}
\index{msi\+\_\+cancel@{msi\+\_\+cancel}!msi.\+c@{msi.\+c}}
\subsubsection[{msi\+\_\+cancel}]{\setlength{\rightskip}{0pt plus 5cm}int msi\+\_\+cancel (
\begin{DoxyParamCaption}
\item[{{\bf M\+S\+I\+Session} $\ast$}]{session, }
\item[{int32\+\_\+t}]{call\+\_\+index, }
\item[{uint32\+\_\+t}]{peer, }
\item[{const char $\ast$}]{reason}
\end{DoxyParamCaption}
)}}\label{msi_8c_aefbf5f591676d4b56853b21fdf215e69}
Cancel request. 

Definition at line 1435 of file msi.\+c.



References \+\_\+\+M\+S\+I\+Session\+::calls, cancel, L\+O\+G\+G\+E\+R\+\_\+\+D\+E\+B\+U\+G, L\+O\+G\+G\+E\+R\+\_\+\+E\+R\+R\+O\+R, \+\_\+\+M\+S\+I\+Session\+::max\+\_\+calls, msi\+\_\+\+Call\+Inviting, msi\+\_\+\+Error\+Invalid\+State, msi\+\_\+\+Error\+No\+Call, msi\+\_\+msg\+\_\+set\+\_\+reason(), msi\+\_\+new\+\_\+message(), \+\_\+\+M\+S\+I\+Session\+::mutex, send\+\_\+message(), \+\_\+\+M\+S\+I\+Call\+::state, terminate\+\_\+call(), and Type\+Request.



Referenced by handle\+\_\+timeout(), msi\+\_\+kill(), and toxav\+\_\+cancel().


\begin{DoxyCode}
1436 \{
1437     pthread\_mutex\_lock(session->\hyperlink{struct___m_s_i_session_ab4293016252c4d4e63549b0773fa0f33}{mutex});
1438     \hyperlink{logger_8h_a9885ca09ce5f94d936c91a5b0856a024}{LOGGER\_DEBUG}(\textcolor{stringliteral}{"Session: %p Canceling call: %u; reason: %s"}, session, call\_index, reason ? 
      reason : \textcolor{stringliteral}{"Unknown"});
1439 
1440     \textcolor{keywordflow}{if} ( call\_index < 0 || call\_index >= session->\hyperlink{struct___m_s_i_session_ae4bbb4682dc5c74588083ca06ac2f76f}{max\_calls} || !session->
      \hyperlink{struct___m_s_i_session_ac40fee673bae4030b812579c57389a02}{calls}[call\_index] ) \{
1441         \hyperlink{logger_8h_aedad6a1e3ffe0d4cd0992b822ec0eeeb}{LOGGER\_ERROR}(\textcolor{stringliteral}{"Invalid call index!"});
1442         pthread\_mutex\_unlock(session->\hyperlink{struct___m_s_i_session_ab4293016252c4d4e63549b0773fa0f33}{mutex});
1443         \textcolor{keywordflow}{return} \hyperlink{msi_8h_a52e2ed4d0fa75f870135d452f1f6c229ad3798ce3d9dc448484bf6bfea7a176d3}{msi\_ErrorNoCall};
1444     \}
1445 
1446     \textcolor{keywordflow}{if} ( session->\hyperlink{struct___m_s_i_session_ac40fee673bae4030b812579c57389a02}{calls}[call\_index]->\hyperlink{struct___m_s_i_call_a4a1fc0e5d23dbdc357786d4c69eda9b9}{state} != \hyperlink{msi_8h_afbc789bbdb9a4d00eda005500f7c1675a8985e709f0a11b30a998d833c7e29132}{msi\_CallInviting} ) \{
1447         \hyperlink{logger_8h_aedad6a1e3ffe0d4cd0992b822ec0eeeb}{LOGGER\_ERROR}(\textcolor{stringliteral}{"Call is in invalid state: %u"}, session->\hyperlink{struct___m_s_i_session_ac40fee673bae4030b812579c57389a02}{calls}[call\_index]->
      \hyperlink{struct___m_s_i_call_a4a1fc0e5d23dbdc357786d4c69eda9b9}{state});
1448         pthread\_mutex\_unlock(session->\hyperlink{struct___m_s_i_session_ab4293016252c4d4e63549b0773fa0f33}{mutex});
1449         \textcolor{keywordflow}{return} \hyperlink{msi_8h_a52e2ed4d0fa75f870135d452f1f6c229a4c874bed9952017bb68e0a27d87a9cde}{msi\_ErrorInvalidState};
1450     \}
1451 
1452     \hyperlink{struct___m_s_i_message}{MSIMessage} *msg\_cancel = \hyperlink{msi_8c_aed030e510836ee3cc994f84f06a0cc98}{msi\_new\_message} ( 
      \hyperlink{msi_8c_a6557c179987e0c84ccb97c9f29a302efa3bc11c46b5beb3df428936d6f53b03f7}{TypeRequest}, \hyperlink{msi_8c_ae511d1f1e345bb77cd4120b39679f028afa28df73c87d81742155531f0f36dc71}{cancel} );
1453 
1454     \textcolor{comment}{/* FIXME */}
1455 \textcolor{preprocessor}{#if 0}
1456 
1457     \textcolor{keywordflow}{if} ( reason && strlen(reason) < \textcolor{keyword}{sizeof}(\hyperlink{msi_8h_acc1e8c2d1829721c4addd8547458c9db}{MSIReasonStrType}) ) \{
1458         \hyperlink{msi_8h_acc1e8c2d1829721c4addd8547458c9db}{MSIReasonStrType} reason\_cast;
1459         memset(reason\_cast, \textcolor{charliteral}{'\(\backslash\)0'}, \textcolor{keyword}{sizeof}(\hyperlink{msi_8h_acc1e8c2d1829721c4addd8547458c9db}{MSIReasonStrType}));
1460         memcpy(reason\_cast, reason, strlen(reason));
1461         \hyperlink{msi_8c_abc73c78a9121c32f35e4847af962c889}{msi\_msg\_set\_reason}(msg\_cancel, reason\_cast);
1462     \}
1463 
1464 \textcolor{preprocessor}{#else}
1465     (void)reason;
1466 
1467 \textcolor{preprocessor}{#endif}
1468 
1469     \hyperlink{msi_8c_ae174427d97e924339f9e2a961ec773a1}{send\_message} ( session, session->\hyperlink{struct___m_s_i_session_ac40fee673bae4030b812579c57389a02}{calls}[call\_index], msg\_cancel, peer );
1470     free ( msg\_cancel );
1471 
1472     \hyperlink{msi_8c_abf7deacfacdcb5b7cc4cfc163583c40d}{terminate\_call} ( session, session->\hyperlink{struct___m_s_i_session_ac40fee673bae4030b812579c57389a02}{calls}[call\_index] );
1473     pthread\_mutex\_unlock(session->\hyperlink{struct___m_s_i_session_ab4293016252c4d4e63549b0773fa0f33}{mutex});
1474 
1475     \textcolor{keywordflow}{return} 0;
1476 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_aefbf5f591676d4b56853b21fdf215e69_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_aefbf5f591676d4b56853b21fdf215e69_icgraph}
\end{center}
\end{figure}


\hypertarget{msi_8c_ad82b81e88f4a912b7ec492baf6ab7ea8}{\index{msi.\+c@{msi.\+c}!msi\+\_\+change\+\_\+csettings@{msi\+\_\+change\+\_\+csettings}}
\index{msi\+\_\+change\+\_\+csettings@{msi\+\_\+change\+\_\+csettings}!msi.\+c@{msi.\+c}}
\subsubsection[{msi\+\_\+change\+\_\+csettings}]{\setlength{\rightskip}{0pt plus 5cm}int msi\+\_\+change\+\_\+csettings (
\begin{DoxyParamCaption}
\item[{{\bf M\+S\+I\+Session} $\ast$}]{session, }
\item[{int32\+\_\+t}]{call\+\_\+index, }
\item[{const {\bf M\+S\+I\+C\+Settings} $\ast$}]{csettings}
\end{DoxyParamCaption}
)}}\label{msi_8c_ad82b81e88f4a912b7ec492baf6ab7ea8}
Change codec settings of the current call. 

Definition at line 1542 of file msi.\+c.



References \+\_\+\+M\+S\+I\+Codec\+Settings\+::audio\+\_\+bitrate, \+\_\+\+M\+S\+I\+Codec\+Settings\+::audio\+\_\+channels, \+\_\+\+M\+S\+I\+Codec\+Settings\+::audio\+\_\+frame\+\_\+duration, \+\_\+\+M\+S\+I\+Codec\+Settings\+::audio\+\_\+sample\+\_\+rate, \+\_\+\+M\+S\+I\+Codec\+Settings\+::call\+\_\+type, \+\_\+\+M\+S\+I\+Session\+::calls, \+\_\+\+M\+S\+I\+Call\+::csettings\+\_\+local, invite, L\+O\+G\+G\+E\+R\+\_\+\+D\+E\+B\+U\+G, L\+O\+G\+G\+E\+R\+\_\+\+E\+R\+R\+O\+R, \+\_\+\+M\+S\+I\+Session\+::max\+\_\+calls, \+\_\+\+M\+S\+I\+Codec\+Settings\+::max\+\_\+video\+\_\+height, \+\_\+\+M\+S\+I\+Codec\+Settings\+::max\+\_\+video\+\_\+width, msi\+\_\+\+Call\+Active, msi\+\_\+\+Error\+Invalid\+State, msi\+\_\+\+Error\+No\+Call, msi\+\_\+msg\+\_\+set\+\_\+csettings(), msi\+\_\+new\+\_\+message(), \+\_\+\+M\+S\+I\+Session\+::mutex, \+\_\+\+M\+S\+I\+Call\+::peers, send\+\_\+message(), \+\_\+\+M\+S\+I\+Call\+::state, Type\+Request, and \+\_\+\+M\+S\+I\+Codec\+Settings\+::video\+\_\+bitrate.



Referenced by toxav\+\_\+change\+\_\+settings().


\begin{DoxyCode}
1543 \{
1544     pthread\_mutex\_lock(session->\hyperlink{struct___m_s_i_session_ab4293016252c4d4e63549b0773fa0f33}{mutex});
1545 
1546     \hyperlink{logger_8h_a9885ca09ce5f94d936c91a5b0856a024}{LOGGER\_DEBUG}(\textcolor{stringliteral}{"Changing media on call: %d"}, call\_index);
1547 
1548     \textcolor{keywordflow}{if} ( call\_index < 0 || call\_index >= session->\hyperlink{struct___m_s_i_session_ae4bbb4682dc5c74588083ca06ac2f76f}{max\_calls} || !session->
      \hyperlink{struct___m_s_i_session_ac40fee673bae4030b812579c57389a02}{calls}[call\_index] ) \{
1549         \hyperlink{logger_8h_aedad6a1e3ffe0d4cd0992b822ec0eeeb}{LOGGER\_ERROR}(\textcolor{stringliteral}{"Invalid call index!"});
1550         pthread\_mutex\_unlock(session->\hyperlink{struct___m_s_i_session_ab4293016252c4d4e63549b0773fa0f33}{mutex});
1551         \textcolor{keywordflow}{return} \hyperlink{msi_8h_a52e2ed4d0fa75f870135d452f1f6c229ad3798ce3d9dc448484bf6bfea7a176d3}{msi\_ErrorNoCall};
1552     \}
1553 
1554     \hyperlink{struct___m_s_i_call}{MSICall} *call = session->\hyperlink{struct___m_s_i_session_ac40fee673bae4030b812579c57389a02}{calls}[call\_index];
1555 
1556     \textcolor{keywordflow}{if} ( call->\hyperlink{struct___m_s_i_call_a4a1fc0e5d23dbdc357786d4c69eda9b9}{state} != \hyperlink{msi_8h_afbc789bbdb9a4d00eda005500f7c1675abd210588def2a0d8ee3355cefbd28156}{msi\_CallActive} ) \{
1557         \hyperlink{logger_8h_aedad6a1e3ffe0d4cd0992b822ec0eeeb}{LOGGER\_ERROR}(\textcolor{stringliteral}{"Call is not active!"});
1558         pthread\_mutex\_unlock(session->\hyperlink{struct___m_s_i_session_ab4293016252c4d4e63549b0773fa0f33}{mutex});
1559         \textcolor{keywordflow}{return} \hyperlink{msi_8h_a52e2ed4d0fa75f870135d452f1f6c229a4c874bed9952017bb68e0a27d87a9cde}{msi\_ErrorInvalidState};
1560     \}
1561 
1562     \hyperlink{struct___m_s_i_codec_settings}{MSICSettings} *local = &call->\hyperlink{struct___m_s_i_call_ae57cfc81fffd82f53953c6546bb9f3c3}{csettings\_local};
1563 
1564     \textcolor{keywordflow}{if} (
1565         local->\hyperlink{struct___m_s_i_codec_settings_a24d841d0ab8a0b3f12f559aec494e4fe}{call\_type} == csettings->\hyperlink{struct___m_s_i_codec_settings_a24d841d0ab8a0b3f12f559aec494e4fe}{call\_type} &&
1566         local->\hyperlink{struct___m_s_i_codec_settings_af0eac99d4181795e8a595d244e745192}{video\_bitrate} == csettings->\hyperlink{struct___m_s_i_codec_settings_af0eac99d4181795e8a595d244e745192}{video\_bitrate} &&
1567         local->\hyperlink{struct___m_s_i_codec_settings_ab81ecded1f7c46e120c8f2afa7b2c5cc}{max\_video\_width} == csettings->\hyperlink{struct___m_s_i_codec_settings_ab81ecded1f7c46e120c8f2afa7b2c5cc}{max\_video\_width} &&
1568         local->\hyperlink{struct___m_s_i_codec_settings_a4fef4b2fa1a8ae8446314ad0af4ce698}{max\_video\_height} == csettings->\hyperlink{struct___m_s_i_codec_settings_a4fef4b2fa1a8ae8446314ad0af4ce698}{max\_video\_height} &&
1569         local->\hyperlink{struct___m_s_i_codec_settings_a5d9a8b59b2eb1eef8dbdcb032bf1dd01}{audio\_bitrate} == csettings->\hyperlink{struct___m_s_i_codec_settings_a5d9a8b59b2eb1eef8dbdcb032bf1dd01}{audio\_bitrate} &&
1570         local->\hyperlink{struct___m_s_i_codec_settings_a61b592233f5a65705eb2600d38e365cd}{audio\_frame\_duration} == csettings->
      \hyperlink{struct___m_s_i_codec_settings_a61b592233f5a65705eb2600d38e365cd}{audio\_frame\_duration} &&
1571         local->\hyperlink{struct___m_s_i_codec_settings_a66da4482e934a2700e07a39fa0838559}{audio\_sample\_rate} == csettings->
      \hyperlink{struct___m_s_i_codec_settings_a66da4482e934a2700e07a39fa0838559}{audio\_sample\_rate} &&
1572         local->\hyperlink{struct___m_s_i_codec_settings_a1b04e9669a2929f425e867440b6d826d}{audio\_channels} == csettings->\hyperlink{struct___m_s_i_codec_settings_a1b04e9669a2929f425e867440b6d826d}{audio\_channels} ) \{
1573         \hyperlink{logger_8h_aedad6a1e3ffe0d4cd0992b822ec0eeeb}{LOGGER\_ERROR}(\textcolor{stringliteral}{"Call is already set accordingly!"});
1574         pthread\_mutex\_unlock(session->\hyperlink{struct___m_s_i_session_ab4293016252c4d4e63549b0773fa0f33}{mutex});
1575         \textcolor{keywordflow}{return} -1;
1576     \}
1577 
1578     *local = *csettings;
1579 
1580     \hyperlink{struct___m_s_i_message}{MSIMessage} *msg\_invite = \hyperlink{msi_8c_aed030e510836ee3cc994f84f06a0cc98}{msi\_new\_message} ( 
      \hyperlink{msi_8c_a6557c179987e0c84ccb97c9f29a302efa3bc11c46b5beb3df428936d6f53b03f7}{TypeRequest}, \hyperlink{msi_8c_ae511d1f1e345bb77cd4120b39679f028a1626b80e8928e701cbf05e1794eb4504}{invite} );
1581 
1582     \hyperlink{msi_8c_ad8cf444077a0744601cf9107fbb6dbb8}{msi\_msg\_set\_csettings} ( msg\_invite, local );
1583     \hyperlink{msi_8c_ae174427d97e924339f9e2a961ec773a1}{send\_message} ( session, call, msg\_invite, call->\hyperlink{struct___m_s_i_call_a55d2568491d616f7fef07bc7137c8c23}{peers}[0] );
1584     free ( msg\_invite );
1585 
1586     \hyperlink{logger_8h_a9885ca09ce5f94d936c91a5b0856a024}{LOGGER\_DEBUG}(\textcolor{stringliteral}{"Request for media change sent"});
1587 
1588     pthread\_mutex\_unlock(session->\hyperlink{struct___m_s_i_session_ab4293016252c4d4e63549b0773fa0f33}{mutex});
1589 
1590     \textcolor{keywordflow}{return} 0;
1591 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_ad82b81e88f4a912b7ec492baf6ab7ea8_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_ad82b81e88f4a912b7ec492baf6ab7ea8_icgraph}
\end{center}
\end{figure}


\hypertarget{msi_8c_a6596ff23a6bcdd19c4fa1985dcc6b257}{\index{msi.\+c@{msi.\+c}!msi\+\_\+do@{msi\+\_\+do}}
\index{msi\+\_\+do@{msi\+\_\+do}!msi.\+c@{msi.\+c}}
\subsubsection[{msi\+\_\+do}]{\setlength{\rightskip}{0pt plus 5cm}void msi\+\_\+do (
\begin{DoxyParamCaption}
\item[{{\bf M\+S\+I\+Session} $\ast$}]{session}
\end{DoxyParamCaption}
)}}\label{msi_8c_a6596ff23a6bcdd19c4fa1985dcc6b257}
Main msi loop 

Definition at line 1593 of file msi.\+c.



References current\+\_\+time\+\_\+monotonic(), \+\_\+\+Timer\+::func, \+\_\+\+Timer\+::id, L\+O\+G\+G\+E\+R\+\_\+\+D\+E\+B\+U\+G, \+\_\+\+M\+S\+I\+Session\+::mutex, \+\_\+\+Timer\+::timeout, \+\_\+\+M\+S\+I\+Session\+::timer\+\_\+handler, timer\+\_\+release(), and \+\_\+\+Timer\+Handler\+::timers.



Referenced by toxav\+\_\+do().


\begin{DoxyCode}
1594 \{
1595     pthread\_mutex\_lock(session->\hyperlink{struct___m_s_i_session_ab4293016252c4d4e63549b0773fa0f33}{mutex});
1596 
1597     \hyperlink{struct___timer_handler}{TimerHandler} *timer = session->\hyperlink{struct___m_s_i_session_a06ab765308a606d809c4c2a2c71710ce}{timer\_handler};
1598 
1599     uint64\_t time = \hyperlink{irc__syncbot_8c_ae8ecaef140b786a2720eadbb85918e81}{current\_time\_monotonic}();
1600 
1601     \textcolor{keywordflow}{while} ( timer->\hyperlink{struct___timer_handler_af6a69553fb8462326147c121a4c3e98c}{timers}[0] && timer->\hyperlink{struct___timer_handler_af6a69553fb8462326147c121a4c3e98c}{timers}[0]->\hyperlink{struct___timer_a053cdea1d85795444fe1aaa6b277a0ec}{timeout} < time ) \{
1602         \hyperlink{logger_8h_a9885ca09ce5f94d936c91a5b0856a024}{LOGGER\_DEBUG}(\textcolor{stringliteral}{"Executing timer assigned at: %d"}, timer->
      \hyperlink{struct___timer_handler_af6a69553fb8462326147c121a4c3e98c}{timers}[0]->\hyperlink{struct___timer_a053cdea1d85795444fe1aaa6b277a0ec}{timeout});
1603 
1604         \textcolor{keywordtype}{int} \textcolor{keywordtype}{id} = timer->\hyperlink{struct___timer_handler_af6a69553fb8462326147c121a4c3e98c}{timers}[0]->\hyperlink{struct___timer_a7441ef0865bcb3db9b8064dd7375c1ea}{id};
1605         timer->\hyperlink{struct___timer_handler_af6a69553fb8462326147c121a4c3e98c}{timers}[0]->\hyperlink{struct___timer_a7b75ecf42c49a289b6dd4fefdbf86605}{func}(timer->\hyperlink{struct___timer_handler_af6a69553fb8462326147c121a4c3e98c}{timers}[0]);
1606 
1607         \textcolor{comment}{/* In case function has released timer */}
1608         \textcolor{keywordflow}{if} (timer->\hyperlink{struct___timer_handler_af6a69553fb8462326147c121a4c3e98c}{timers}[0] && timer->\hyperlink{struct___timer_handler_af6a69553fb8462326147c121a4c3e98c}{timers}[0]->\hyperlink{struct___timer_a7441ef0865bcb3db9b8064dd7375c1ea}{id} == \textcolor{keywordtype}{id})
1609             \hyperlink{msi_8c_ab6f36f5852629fabd6e3c85451e5be65}{timer\_release}(timer, \textcolor{keywordtype}{id});
1610     \}
1611 
1612     pthread\_mutex\_unlock(session->\hyperlink{struct___m_s_i_session_ab4293016252c4d4e63549b0773fa0f33}{mutex});
1613 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=285pt]{d2/d9b/msi_8c_a6596ff23a6bcdd19c4fa1985dcc6b257_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=336pt]{d2/d9b/msi_8c_a6596ff23a6bcdd19c4fa1985dcc6b257_icgraph}
\end{center}
\end{figure}


\hypertarget{msi_8c_aa944624a15314d9d2eff6373f9506725}{\index{msi.\+c@{msi.\+c}!msi\+\_\+handle\+\_\+packet@{msi\+\_\+handle\+\_\+packet}}
\index{msi\+\_\+handle\+\_\+packet@{msi\+\_\+handle\+\_\+packet}!msi.\+c@{msi.\+c}}
\subsubsection[{msi\+\_\+handle\+\_\+packet}]{\setlength{\rightskip}{0pt plus 5cm}static void msi\+\_\+handle\+\_\+packet (
\begin{DoxyParamCaption}
\item[{{\bf Messenger} $\ast$}]{messenger, }
\item[{uint32\+\_\+t}]{source, }
\item[{const uint8\+\_\+t $\ast$}]{data, }
\item[{uint16\+\_\+t}]{length, }
\item[{void $\ast$}]{object}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{msi_8c_aa944624a15314d9d2eff6373f9506725}
B\+A\+S\+I\+C call flow\+:

A\+L\+I\+C\+E B\+O\+B \begin{TabularC}{1}
\hline
\rowcolor{lightgray}{\bf invite --$>$  }\\\cline{1-1}
$<$-- ringing \\\cline{1-1}
\\\cline{1-1}
$<$-- starting \\\cline{1-1}
\\\cline{1-1}
start --$>$ \\\cline{1-1}
\\\cline{1-1}
$<$-- M\+E\+D\+I\+A T\+R\+A\+N\+S --$>$ \\\cline{1-1}
\\\cline{1-1}
end --$>$ \\\cline{1-1}
\\\cline{1-1}
$<$-- ending \\\cline{1-1}
\end{TabularC}
Alice calls Bob by sending invite packet. Bob recvs the packet and sends an ringing packet; which notifies Alice that her invite is acknowledged. Ringing screen shown on both sides. Bob accepts the invite for a call by sending starting packet. Alice recvs the starting packet and sends the started packet to inform Bob that she recved the starting packet. Now the media transmission is established ( i.\+e. R\+T\+P transmission ). Alice hangs up and sends end packet. Bob recves the end packet and sends ending packet as the acknowledgement that the call is ending. 

Definition at line 1103 of file msi.\+c.



References \+\_\+\+M\+S\+I\+Message\+::callid, cancel, end, ending, error, find\+\_\+call(), \+\_\+\+M\+S\+I\+Message\+::friend\+\_\+id, handle\+\_\+recv\+\_\+cancel(), handle\+\_\+recv\+\_\+end(), handle\+\_\+recv\+\_\+ending(), handle\+\_\+recv\+\_\+error(), handle\+\_\+recv\+\_\+invite(), handle\+\_\+recv\+\_\+reject(), handle\+\_\+recv\+\_\+ringing(), handle\+\_\+recv\+\_\+start(), handle\+\_\+recv\+\_\+starting(), invite, L\+O\+G\+G\+E\+R\+\_\+\+D\+E\+B\+U\+G, L\+O\+G\+G\+E\+R\+\_\+\+W\+A\+R\+N\+I\+N\+G, \+\_\+\+M\+S\+I\+Session\+::mutex, parse\+\_\+recv(), reject, \+\_\+\+M\+S\+I\+Message\+::request, \+\_\+\+M\+S\+I\+Call\+::request\+\_\+timer\+\_\+id, \+\_\+\+M\+S\+I\+Message\+::response, ringing, start, starting, \+\_\+\+M\+S\+I\+Session\+::timer\+\_\+handler, and timer\+\_\+release().



Referenced by msi\+\_\+new().


\begin{DoxyCode}
1105 \{
1106     \hyperlink{logger_8h_a9885ca09ce5f94d936c91a5b0856a024}{LOGGER\_DEBUG}(\textcolor{stringliteral}{"Got msi message"});
1107     \textcolor{comment}{/* Unused */}
1108     (void)messenger;
1109 
1110     \hyperlink{struct___m_s_i_session}{MSISession} *session = object;
1111     \hyperlink{struct___m_s_i_message}{MSIMessage} *msg;
1112 
1113     \textcolor{keywordflow}{if} ( !length ) \{
1114         \hyperlink{logger_8h_ab3e970f3c1ecb5b71f17eccee4ebb286}{LOGGER\_WARNING}(\textcolor{stringliteral}{"Length param negative"});
1115         \textcolor{keywordflow}{return};
1116     \}
1117 
1118     msg = \hyperlink{msi_8c_a7941e06f6114e6d26a9c0538c941eb8a}{parse\_recv} ( \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}, length );
1119 
1120     \textcolor{keywordflow}{if} ( !msg ) \{
1121         \hyperlink{logger_8h_ab3e970f3c1ecb5b71f17eccee4ebb286}{LOGGER\_WARNING}(\textcolor{stringliteral}{"Error parsing message"});
1122         \textcolor{keywordflow}{return};
1123     \} \textcolor{keywordflow}{else} \{
1124         \hyperlink{logger_8h_a9885ca09ce5f94d936c91a5b0856a024}{LOGGER\_DEBUG}(\textcolor{stringliteral}{"Successfully parsed message"});
1125     \}
1126 
1127     msg->\hyperlink{struct___m_s_i_message_af43a034662e9bcac38e3bf4c9c150c19}{friend\_id} = source;
1128 
1129     pthread\_mutex\_lock(session->\hyperlink{struct___m_s_i_session_ab4293016252c4d4e63549b0773fa0f33}{mutex});
1130 
1131     \textcolor{comment}{/* Find what call */}
1132     \hyperlink{struct___m_s_i_call}{MSICall} *call = msg->\hyperlink{struct___m_s_i_message_a0cb3f797b633561175096933c2eb003e}{callid}.exists ? \hyperlink{msi_8c_aecbf66ee30b2ec4003caed2455e4c02d}{find\_call}(session, msg->
      \hyperlink{struct___m_s_i_message_a0cb3f797b633561175096933c2eb003e}{callid}.value ) : NULL;
1133 
1134     \textcolor{comment}{/* Now handle message */}
1135 
1136     \textcolor{keywordflow}{if} ( msg->\hyperlink{struct___m_s_i_message_a43928947ba3f33772bdeee09fd89557a}{request}.exists ) \{ \textcolor{comment}{/* Handle request */}
1137 
1138         \textcolor{keywordflow}{switch} (msg->\hyperlink{struct___m_s_i_message_a43928947ba3f33772bdeee09fd89557a}{request}.value) \{
1139             \textcolor{keywordflow}{case} \hyperlink{msi_8c_ae511d1f1e345bb77cd4120b39679f028a1626b80e8928e701cbf05e1794eb4504}{invite}:
1140                 \hyperlink{msi_8c_a6c1d69163b2cfedea11ed5ed688dc669}{handle\_recv\_invite} ( session, call, msg );
1141                 \textcolor{keywordflow}{break};
1142 
1143             \textcolor{keywordflow}{case} \hyperlink{msi_8c_ae511d1f1e345bb77cd4120b39679f028a0e97c69c73117f6c0109b2d7d1d9cedc}{start}:
1144                 \hyperlink{msi_8c_a4d75b79b31c9451a723522b891ec75fd}{handle\_recv\_start} ( session, call, msg );
1145                 \textcolor{keywordflow}{break};
1146 
1147             \textcolor{keywordflow}{case} \hyperlink{msi_8c_ae511d1f1e345bb77cd4120b39679f028afa28df73c87d81742155531f0f36dc71}{cancel}:
1148                 \hyperlink{msi_8c_ac97b77c7ecac429b769a3e7b54047d1f}{handle\_recv\_cancel} ( session, call, msg );
1149                 \textcolor{keywordflow}{break};
1150 
1151             \textcolor{keywordflow}{case} \hyperlink{msi_8c_ae511d1f1e345bb77cd4120b39679f028ac3938f36421013c679a406260a404daa}{reject}:
1152                 \hyperlink{msi_8c_adab5cbd8d80ff38f19008ee3fec808b8}{handle\_recv\_reject} ( session, call, msg );
1153                 \textcolor{keywordflow}{break};
1154 
1155             \textcolor{keywordflow}{case} \hyperlink{msi_8c_ae511d1f1e345bb77cd4120b39679f028a80b1a820e533d7cf0e1715319339e6d0}{end}:
1156                 \hyperlink{msi_8c_a94cb98234fb1cdeffe8ad8b8601c8dc9}{handle\_recv\_end} ( session, call, msg );
1157                 \textcolor{keywordflow}{break};
1158         \}
1159 
1160     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( msg->\hyperlink{struct___m_s_i_message_a03f0f34008bf8be095af614ca99ea53f}{response}.exists ) \{ \textcolor{comment}{/* Handle response */}
1161 
1162         \textcolor{comment}{/* Got response so cancel timer */}
1163         \textcolor{keywordflow}{if} ( call ) \hyperlink{msi_8c_ab6f36f5852629fabd6e3c85451e5be65}{timer\_release}(session->\hyperlink{struct___m_s_i_session_a06ab765308a606d809c4c2a2c71710ce}{timer\_handler}, call->
      \hyperlink{struct___m_s_i_call_a8ccfd1cd9f807007763f41eafd801130}{request\_timer\_id});
1164 
1165         \textcolor{keywordflow}{switch} (msg->\hyperlink{struct___m_s_i_message_a03f0f34008bf8be095af614ca99ea53f}{response}.value) \{
1166             \textcolor{keywordflow}{case} \hyperlink{msi_8c_a7251f9a01631fc788dd7c8eff23a422eaa27786b5857031d78494d47532ecbb78}{ringing}:
1167                 \hyperlink{msi_8c_ac4fd005ce0f0c990e7982acd92e341e3}{handle\_recv\_ringing} ( session, call, msg );
1168                 \textcolor{keywordflow}{break};
1169 
1170             \textcolor{keywordflow}{case} \hyperlink{msi_8c_a7251f9a01631fc788dd7c8eff23a422ea658598d69535d5877bf2fa0af0dcfafa}{starting}:
1171                 \hyperlink{msi_8c_ada9b9ef63c3c73e22b672d7cfb5bd6a3}{handle\_recv\_starting} ( session, call, msg );
1172                 \textcolor{keywordflow}{break};
1173 
1174             \textcolor{keywordflow}{case} \hyperlink{msi_8c_a7251f9a01631fc788dd7c8eff23a422ea6135603307626f48d62e2faa86a1d255}{ending}:
1175                 \hyperlink{msi_8c_ae71247b244dc60d6f5ce9de8b26365db}{handle\_recv\_ending} ( session, call, msg );
1176                 \textcolor{keywordflow}{break};
1177 
1178             \textcolor{keywordflow}{case} \hyperlink{msi_8c_a7251f9a01631fc788dd7c8eff23a422ead606e435413ea0944dd00d49e901e4ed}{error}:
1179                 \hyperlink{msi_8c_aa2af3e4ed6abb65d7b747763a41a1b70}{handle\_recv\_error} ( session, call, msg );
1180                 \textcolor{keywordflow}{break};
1181         \}
1182 
1183     \} \textcolor{keywordflow}{else} \{
1184         \hyperlink{logger_8h_ab3e970f3c1ecb5b71f17eccee4ebb286}{LOGGER\_WARNING}(\textcolor{stringliteral}{"Invalid message: no resp nor requ headers"});
1185     \}
1186 
1187     free ( msg );
1188 
1189     pthread\_mutex\_unlock(session->\hyperlink{struct___m_s_i_session_ab4293016252c4d4e63549b0773fa0f33}{mutex});
1190 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_aa944624a15314d9d2eff6373f9506725_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_aa944624a15314d9d2eff6373f9506725_icgraph}
\end{center}
\end{figure}


\hypertarget{msi_8c_a8023a8417a3e79e382a9ff3d99cdd24a}{\index{msi.\+c@{msi.\+c}!msi\+\_\+hangup@{msi\+\_\+hangup}}
\index{msi\+\_\+hangup@{msi\+\_\+hangup}!msi.\+c@{msi.\+c}}
\subsubsection[{msi\+\_\+hangup}]{\setlength{\rightskip}{0pt plus 5cm}int msi\+\_\+hangup (
\begin{DoxyParamCaption}
\item[{{\bf M\+S\+I\+Session} $\ast$}]{session, }
\item[{int32\+\_\+t}]{call\+\_\+index}
\end{DoxyParamCaption}
)}}\label{msi_8c_a8023a8417a3e79e382a9ff3d99cdd24a}
Hangup active call. 

Definition at line 1367 of file msi.\+c.



References \+\_\+\+M\+S\+I\+Session\+::calls, end, handle\+\_\+timeout(), L\+O\+G\+G\+E\+R\+\_\+\+D\+E\+B\+U\+G, L\+O\+G\+G\+E\+R\+\_\+\+E\+R\+R\+O\+R, m\+\_\+deftout, \+\_\+\+M\+S\+I\+Session\+::max\+\_\+calls, msi\+\_\+\+Call\+Active, msi\+\_\+\+Call\+Over, msi\+\_\+\+Error\+Invalid\+State, msi\+\_\+\+Error\+No\+Call, msi\+\_\+new\+\_\+message(), \+\_\+\+M\+S\+I\+Session\+::mutex, \+\_\+\+M\+S\+I\+Call\+::peer\+\_\+count, \+\_\+\+M\+S\+I\+Call\+::peers, \+\_\+\+M\+S\+I\+Call\+::request\+\_\+timer\+\_\+id, send\+\_\+message(), \+\_\+\+M\+S\+I\+Call\+::state, timer\+\_\+alloc(), and Type\+Request.



Referenced by toxav\+\_\+hangup().


\begin{DoxyCode}
1368 \{
1369     pthread\_mutex\_lock(session->\hyperlink{struct___m_s_i_session_ab4293016252c4d4e63549b0773fa0f33}{mutex});
1370     \hyperlink{logger_8h_a9885ca09ce5f94d936c91a5b0856a024}{LOGGER\_DEBUG}(\textcolor{stringliteral}{"Session: %p Hanging up call: %u"}, session, call\_index);
1371 
1372     \textcolor{keywordflow}{if} ( call\_index < 0 || call\_index >= session->\hyperlink{struct___m_s_i_session_ae4bbb4682dc5c74588083ca06ac2f76f}{max\_calls} || !session->
      \hyperlink{struct___m_s_i_session_ac40fee673bae4030b812579c57389a02}{calls}[call\_index] ) \{
1373         \hyperlink{logger_8h_aedad6a1e3ffe0d4cd0992b822ec0eeeb}{LOGGER\_ERROR}(\textcolor{stringliteral}{"Invalid call index!"});
1374         pthread\_mutex\_unlock(session->\hyperlink{struct___m_s_i_session_ab4293016252c4d4e63549b0773fa0f33}{mutex});
1375         \textcolor{keywordflow}{return} \hyperlink{msi_8h_a52e2ed4d0fa75f870135d452f1f6c229ad3798ce3d9dc448484bf6bfea7a176d3}{msi\_ErrorNoCall};
1376     \}
1377 
1378     \textcolor{keywordflow}{if} ( session->\hyperlink{struct___m_s_i_session_ac40fee673bae4030b812579c57389a02}{calls}[call\_index]->\hyperlink{struct___m_s_i_call_a4a1fc0e5d23dbdc357786d4c69eda9b9}{state} != \hyperlink{msi_8h_afbc789bbdb9a4d00eda005500f7c1675abd210588def2a0d8ee3355cefbd28156}{msi\_CallActive} ) \{
1379         \hyperlink{logger_8h_aedad6a1e3ffe0d4cd0992b822ec0eeeb}{LOGGER\_ERROR}(\textcolor{stringliteral}{"Call is not active!"});
1380         pthread\_mutex\_unlock(session->\hyperlink{struct___m_s_i_session_ab4293016252c4d4e63549b0773fa0f33}{mutex});
1381         \textcolor{keywordflow}{return} \hyperlink{msi_8h_a52e2ed4d0fa75f870135d452f1f6c229a4c874bed9952017bb68e0a27d87a9cde}{msi\_ErrorInvalidState};
1382     \}
1383 
1384     \hyperlink{struct___m_s_i_message}{MSIMessage} *msg\_end = \hyperlink{msi_8c_aed030e510836ee3cc994f84f06a0cc98}{msi\_new\_message} ( \hyperlink{msi_8c_a6557c179987e0c84ccb97c9f29a302efa3bc11c46b5beb3df428936d6f53b03f7}{TypeRequest}, 
      \hyperlink{msi_8c_ae511d1f1e345bb77cd4120b39679f028a80b1a820e533d7cf0e1715319339e6d0}{end} );
1385 
1386     \textcolor{comment}{/* hangup for each peer */}
1387     \textcolor{keywordtype}{int} it = 0;
1388 
1389     \textcolor{keywordflow}{for} ( ; it < session->\hyperlink{struct___m_s_i_session_ac40fee673bae4030b812579c57389a02}{calls}[call\_index]->\hyperlink{struct___m_s_i_call_a62e9da1e57f84fd224590c4d466724aa}{peer\_count}; it ++ )
1390         \hyperlink{msi_8c_ae174427d97e924339f9e2a961ec773a1}{send\_message} ( session, session->\hyperlink{struct___m_s_i_session_ac40fee673bae4030b812579c57389a02}{calls}[call\_index], msg\_end, session->
      \hyperlink{struct___m_s_i_session_ac40fee673bae4030b812579c57389a02}{calls}[call\_index]->\hyperlink{struct___m_s_i_call_a55d2568491d616f7fef07bc7137c8c23}{peers}[it] );
1391 
1392     session->\hyperlink{struct___m_s_i_session_ac40fee673bae4030b812579c57389a02}{calls}[call\_index]->\hyperlink{struct___m_s_i_call_a4a1fc0e5d23dbdc357786d4c69eda9b9}{state} = \hyperlink{msi_8h_afbc789bbdb9a4d00eda005500f7c1675a925ec11e0e4a3a9af7d714629632d44b}{msi\_CallOver};
1393 
1394     free ( msg\_end );
1395 
1396     session->\hyperlink{struct___m_s_i_session_ac40fee673bae4030b812579c57389a02}{calls}[call\_index]->\hyperlink{struct___m_s_i_call_a8ccfd1cd9f807007763f41eafd801130}{request\_timer\_id} =
1397         \hyperlink{msi_8c_a0a093063a8a2e48ca88d8d47234415cb}{timer\_alloc} ( session, \hyperlink{msi_8c_a7a5b1246a4f5680ee60c45e69e04dcd4}{handle\_timeout}, call\_index, 
      \hyperlink{msi_8c_a41cb7a80dff15699d766e4364228a47c}{m\_deftout} );
1398 
1399     pthread\_mutex\_unlock(session->\hyperlink{struct___m_s_i_session_ab4293016252c4d4e63549b0773fa0f33}{mutex});
1400     \textcolor{keywordflow}{return} 0;
1401 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_a8023a8417a3e79e382a9ff3d99cdd24a_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_a8023a8417a3e79e382a9ff3d99cdd24a_icgraph}
\end{center}
\end{figure}


\hypertarget{msi_8c_a9f714a4729f22ca5810ff0ee89313fab}{\index{msi.\+c@{msi.\+c}!msi\+\_\+invite@{msi\+\_\+invite}}
\index{msi\+\_\+invite@{msi\+\_\+invite}!msi.\+c@{msi.\+c}}
\subsubsection[{msi\+\_\+invite}]{\setlength{\rightskip}{0pt plus 5cm}int msi\+\_\+invite (
\begin{DoxyParamCaption}
\item[{{\bf M\+S\+I\+Session} $\ast$}]{session, }
\item[{int32\+\_\+t $\ast$}]{call\+\_\+index, }
\item[{const {\bf M\+S\+I\+C\+Settings} $\ast$}]{csettings, }
\item[{uint32\+\_\+t}]{rngsec, }
\item[{uint32\+\_\+t}]{friend\+\_\+id}
\end{DoxyParamCaption}
)}}\label{msi_8c_a9f714a4729f22ca5810ff0ee89313fab}
Send invite request to friend\+\_\+id. 

Definition at line 1313 of file msi.\+c.



References add\+\_\+peer(), \+\_\+\+M\+S\+I\+Call\+::call\+\_\+idx, \+\_\+\+M\+S\+I\+Session\+::calls, \+\_\+\+M\+S\+I\+Call\+::csettings\+\_\+local, handle\+\_\+timeout(), i, \+\_\+\+M\+S\+I\+Call\+::id, init\+\_\+call(), invite, L\+O\+G\+G\+E\+R\+\_\+\+D\+E\+B\+U\+G, L\+O\+G\+G\+E\+R\+\_\+\+E\+R\+R\+O\+R, m\+\_\+deftout, \+\_\+\+M\+S\+I\+Session\+::max\+\_\+calls, msi\+\_\+\+Call\+Inviting, msi\+\_\+\+Error\+Already\+In\+Call\+With\+Peer, msi\+\_\+\+Error\+Reached\+Call\+Limit, msi\+\_\+msg\+\_\+set\+\_\+csettings(), msi\+\_\+new\+\_\+message(), \+\_\+\+M\+S\+I\+Session\+::mutex, \+\_\+\+M\+S\+I\+Call\+::peers, \+\_\+\+M\+S\+I\+Call\+::request\+\_\+timer\+\_\+id, send\+\_\+message(), \+\_\+\+M\+S\+I\+Call\+::state, t\+\_\+randomstr(), timer\+\_\+alloc(), and Type\+Request.



Referenced by toxav\+\_\+call().


\begin{DoxyCode}
1318 \{
1319     pthread\_mutex\_lock(session->\hyperlink{struct___m_s_i_session_ab4293016252c4d4e63549b0773fa0f33}{mutex});
1320 
1321     \hyperlink{logger_8h_a9885ca09ce5f94d936c91a5b0856a024}{LOGGER\_DEBUG}(\textcolor{stringliteral}{"Session: %p Inviting friend: %u"}, session, 
      \hyperlink{messenger__test_8c_a5d7925718457bca84bda0952f9463a3c}{friend\_id});
1322 
1323 
1324     \textcolor{keywordtype}{int} \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i} = 0;
1325 
1326     \textcolor{keywordflow}{for} (; i < session->\hyperlink{struct___m_s_i_session_ae4bbb4682dc5c74588083ca06ac2f76f}{max\_calls}; i ++)
1327         \textcolor{keywordflow}{if} (session->\hyperlink{struct___m_s_i_session_ac40fee673bae4030b812579c57389a02}{calls}[i] && session->\hyperlink{struct___m_s_i_session_ac40fee673bae4030b812579c57389a02}{calls}[i]->\hyperlink{struct___m_s_i_call_a55d2568491d616f7fef07bc7137c8c23}{peers}[0] == 
      \hyperlink{messenger__test_8c_a5d7925718457bca84bda0952f9463a3c}{friend\_id}) \{
1328             \hyperlink{logger_8h_aedad6a1e3ffe0d4cd0992b822ec0eeeb}{LOGGER\_ERROR}(\textcolor{stringliteral}{"Already in a call with friend %d"}, 
      \hyperlink{messenger__test_8c_a5d7925718457bca84bda0952f9463a3c}{friend\_id});
1329             pthread\_mutex\_unlock(session->\hyperlink{struct___m_s_i_session_ab4293016252c4d4e63549b0773fa0f33}{mutex});
1330             \textcolor{keywordflow}{return} \hyperlink{msi_8h_a52e2ed4d0fa75f870135d452f1f6c229af5059b2f3d7d5e755fcb41848c892980}{msi\_ErrorAlreadyInCallWithPeer};
1331         \}
1332 
1333 
1334     \hyperlink{struct___m_s_i_call}{MSICall} *call = \hyperlink{msi_8c_adac49290dc2c80bd0921ffbedb78966f}{init\_call} ( session, 1, rngsec ); \textcolor{comment}{/* Just one peer for now */}
1335 
1336     \textcolor{keywordflow}{if} ( !call ) \{
1337         pthread\_mutex\_unlock(session->\hyperlink{struct___m_s_i_session_ab4293016252c4d4e63549b0773fa0f33}{mutex});
1338         \hyperlink{logger_8h_aedad6a1e3ffe0d4cd0992b822ec0eeeb}{LOGGER\_ERROR}(\textcolor{stringliteral}{"Cannot handle more calls"});
1339         \textcolor{keywordflow}{return} \hyperlink{msi_8h_a52e2ed4d0fa75f870135d452f1f6c229a0ac1d3777fd5cd52a50e7ce8aec7d4ed}{msi\_ErrorReachedCallLimit};
1340     \}
1341 
1342     *call\_index = call->\hyperlink{struct___m_s_i_call_ad6b287fd08a0cc466cd41bd2e76d5808}{call\_idx};
1343 
1344     \hyperlink{msi_8c_acab20b1c203cf44d500df2307b62ae9c}{t\_randomstr} ( call->\hyperlink{struct___m_s_i_call_aa135fbffd11268758f5f21269fb46853}{id}, \textcolor{keyword}{sizeof}(call->\hyperlink{struct___m_s_i_call_aa135fbffd11268758f5f21269fb46853}{id}) );
1345 
1346     \hyperlink{msi_8c_ae93f60c5c6d4713db189c4059e36e4c1}{add\_peer} ( call, \hyperlink{messenger__test_8c_a5d7925718457bca84bda0952f9463a3c}{friend\_id} );
1347 
1348     call->\hyperlink{struct___m_s_i_call_ae57cfc81fffd82f53953c6546bb9f3c3}{csettings\_local} = *csettings;
1349 
1350     \hyperlink{struct___m_s_i_message}{MSIMessage} *msg\_invite = \hyperlink{msi_8c_aed030e510836ee3cc994f84f06a0cc98}{msi\_new\_message} ( 
      \hyperlink{msi_8c_a6557c179987e0c84ccb97c9f29a302efa3bc11c46b5beb3df428936d6f53b03f7}{TypeRequest}, \hyperlink{msi_8c_ae511d1f1e345bb77cd4120b39679f028a1626b80e8928e701cbf05e1794eb4504}{invite} );
1351 
1352     \hyperlink{msi_8c_ad8cf444077a0744601cf9107fbb6dbb8}{msi\_msg\_set\_csettings}(msg\_invite, csettings);
1353     \hyperlink{msi_8c_ae174427d97e924339f9e2a961ec773a1}{send\_message} ( session, call, msg\_invite, \hyperlink{messenger__test_8c_a5d7925718457bca84bda0952f9463a3c}{friend\_id} );
1354     free( msg\_invite );
1355 
1356     call->\hyperlink{struct___m_s_i_call_a4a1fc0e5d23dbdc357786d4c69eda9b9}{state} = \hyperlink{msi_8h_afbc789bbdb9a4d00eda005500f7c1675a8985e709f0a11b30a998d833c7e29132}{msi\_CallInviting};
1357 
1358     call->\hyperlink{struct___m_s_i_call_a8ccfd1cd9f807007763f41eafd801130}{request\_timer\_id} = \hyperlink{msi_8c_a0a093063a8a2e48ca88d8d47234415cb}{timer\_alloc} ( session, 
      \hyperlink{msi_8c_a7a5b1246a4f5680ee60c45e69e04dcd4}{handle\_timeout}, call->\hyperlink{struct___m_s_i_call_ad6b287fd08a0cc466cd41bd2e76d5808}{call\_idx}, \hyperlink{msi_8c_a41cb7a80dff15699d766e4364228a47c}{m\_deftout} );
1359 
1360     \hyperlink{logger_8h_a9885ca09ce5f94d936c91a5b0856a024}{LOGGER\_DEBUG}(\textcolor{stringliteral}{"Invite sent"});
1361 
1362     pthread\_mutex\_unlock(session->\hyperlink{struct___m_s_i_session_ab4293016252c4d4e63549b0773fa0f33}{mutex});
1363 
1364     \textcolor{keywordflow}{return} 0;
1365 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_a9f714a4729f22ca5810ff0ee89313fab_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_a9f714a4729f22ca5810ff0ee89313fab_icgraph}
\end{center}
\end{figure}


\hypertarget{msi_8c_a85e4f629815819ee2abed82041bd9436}{\index{msi.\+c@{msi.\+c}!msi\+\_\+kill@{msi\+\_\+kill}}
\index{msi\+\_\+kill@{msi\+\_\+kill}!msi.\+c@{msi.\+c}}
\subsubsection[{msi\+\_\+kill}]{\setlength{\rightskip}{0pt plus 5cm}int msi\+\_\+kill (
\begin{DoxyParamCaption}
\item[{{\bf M\+S\+I\+Session} $\ast$}]{session}
\end{DoxyParamCaption}
)}}\label{msi_8c_a85e4f629815819ee2abed82041bd9436}
Terminate control session. 

Definition at line 1273 of file msi.\+c.



References \+\_\+\+M\+S\+I\+Session\+::calls, L\+O\+G\+G\+E\+R\+\_\+\+D\+E\+B\+U\+G, L\+O\+G\+G\+E\+R\+\_\+\+E\+R\+R\+O\+R, m\+\_\+callback\+\_\+msi\+\_\+packet(), \+\_\+\+M\+S\+I\+Session\+::max\+\_\+calls, \+\_\+\+M\+S\+I\+Session\+::messenger\+\_\+handle, msi\+\_\+\+Call\+Inviting, msi\+\_\+cancel(), msi\+\_\+stopcall(), \+\_\+\+M\+S\+I\+Session\+::mutex, \+\_\+\+M\+S\+I\+Call\+::peers, \+\_\+\+M\+S\+I\+Call\+::state, and \+\_\+\+M\+S\+I\+Session\+::timer\+\_\+handler.



Referenced by toxav\+\_\+kill(), and toxav\+\_\+new().


\begin{DoxyCode}
1274 \{
1275     \textcolor{keywordflow}{if} (session == NULL) \{
1276         \hyperlink{logger_8h_aedad6a1e3ffe0d4cd0992b822ec0eeeb}{LOGGER\_ERROR}(\textcolor{stringliteral}{"Tried to terminate non-existing session"});
1277         \textcolor{keywordflow}{return} -1;
1278     \}
1279 
1280     \hyperlink{_messenger_8c_a6f1431ef7ea09d3bac1b93f4dfa75764}{m\_callback\_msi\_packet}((\textcolor{keyword}{struct} \hyperlink{struct_messenger}{Messenger} *) session->
      \hyperlink{struct___m_s_i_session_a2adfe301d17504006b8321f71f642039}{messenger\_handle}, NULL, NULL);
1281     pthread\_mutex\_lock(session->\hyperlink{struct___m_s_i_session_ab4293016252c4d4e63549b0773fa0f33}{mutex});
1282 
1283     \textcolor{comment}{/* Cancel active calls */}
1284     int32\_t idx = 0;
1285 
1286     \textcolor{keywordflow}{for} (; idx < session->\hyperlink{struct___m_s_i_session_ae4bbb4682dc5c74588083ca06ac2f76f}{max\_calls}; idx ++) \textcolor{keywordflow}{if} ( session->\hyperlink{struct___m_s_i_session_ac40fee673bae4030b812579c57389a02}{calls}[idx] ) \{
1287             \textcolor{comment}{/* Cancel all? */}
1288             uint16\_t \_it = 0;
1289             \textcolor{comment}{/*for ( ; \_it < session->calls[idx]->peer\_count; \_it++ )}
1290 \textcolor{comment}{                * FIXME: will not work on multiple peers, must cancel call for all peers}
1291 \textcolor{comment}{                */}
1292             \hyperlink{msi_8h_afbc789bbdb9a4d00eda005500f7c1675}{MSICallState} state = session->\hyperlink{struct___m_s_i_session_ac40fee673bae4030b812579c57389a02}{calls}[idx]->\hyperlink{struct___m_s_i_call_a4a1fc0e5d23dbdc357786d4c69eda9b9}{state};
1293 
1294             \textcolor{keywordflow}{if} (state == \hyperlink{msi_8h_afbc789bbdb9a4d00eda005500f7c1675a8985e709f0a11b30a998d833c7e29132}{msi\_CallInviting}) \{
1295                 \hyperlink{msi_8c_aefbf5f591676d4b56853b21fdf215e69}{msi\_cancel}( session, idx, session->\hyperlink{struct___m_s_i_session_ac40fee673bae4030b812579c57389a02}{calls}[idx]->
      \hyperlink{struct___m_s_i_call_a55d2568491d616f7fef07bc7137c8c23}{peers} [\_it], \textcolor{stringliteral}{"MSI session terminated!"} );
1296             \} \textcolor{keywordflow}{else} \{
1297                 \hyperlink{msi_8c_a4d2aa9bfe7f4a96275204f2797d6e7eb}{msi\_stopcall}(session, idx);
1298             \}
1299         \}
1300 
1301     free(((\hyperlink{struct___timer_handler}{TimerHandler} *)session->\hyperlink{struct___m_s_i_session_a06ab765308a606d809c4c2a2c71710ce}{timer\_handler})->timers);
1302     free(session->\hyperlink{struct___m_s_i_session_a06ab765308a606d809c4c2a2c71710ce}{timer\_handler});
1303 
1304     free ( session->\hyperlink{struct___m_s_i_session_ac40fee673bae4030b812579c57389a02}{calls} );
1305     pthread\_mutex\_unlock(session->\hyperlink{struct___m_s_i_session_ab4293016252c4d4e63549b0773fa0f33}{mutex});
1306     pthread\_mutex\_destroy(session->\hyperlink{struct___m_s_i_session_ab4293016252c4d4e63549b0773fa0f33}{mutex});
1307 
1308     \hyperlink{logger_8h_a9885ca09ce5f94d936c91a5b0856a024}{LOGGER\_DEBUG}(\textcolor{stringliteral}{"Terminated session: %p"}, session);
1309     free ( session );
1310     \textcolor{keywordflow}{return} 0;
1311 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_a85e4f629815819ee2abed82041bd9436_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=346pt]{d2/d9b/msi_8c_a85e4f629815819ee2abed82041bd9436_icgraph}
\end{center}
\end{figure}


\hypertarget{msi_8c_a1d6d84b54016402734b0bc352f654699}{\index{msi.\+c@{msi.\+c}!msi\+\_\+msg\+\_\+get\+\_\+csettings@{msi\+\_\+msg\+\_\+get\+\_\+csettings}}
\index{msi\+\_\+msg\+\_\+get\+\_\+csettings@{msi\+\_\+msg\+\_\+get\+\_\+csettings}!msi.\+c@{msi.\+c}}
\subsubsection[{msi\+\_\+msg\+\_\+get\+\_\+csettings}]{\setlength{\rightskip}{0pt plus 5cm}void msi\+\_\+msg\+\_\+get\+\_\+csettings (
\begin{DoxyParamCaption}
\item[{{\bf M\+S\+I\+Message} $\ast$}]{msg, }
\item[{{\bf M\+S\+I\+C\+Settings} $\ast$}]{dest}
\end{DoxyParamCaption}
)}}\label{msi_8c_a1d6d84b54016402734b0bc352f654699}


Definition at line 392 of file msi.\+c.



References \+\_\+\+M\+S\+I\+Codec\+Settings\+::audio\+\_\+bitrate, \+\_\+\+M\+S\+I\+Codec\+Settings\+::audio\+\_\+channels, \+\_\+\+M\+S\+I\+Codec\+Settings\+::audio\+\_\+frame\+\_\+duration, \+\_\+\+M\+S\+I\+Codec\+Settings\+::audio\+\_\+sample\+\_\+rate, \+\_\+\+M\+S\+I\+Codec\+Settings\+::call\+\_\+type, \+\_\+\+M\+S\+I\+Message\+::csettings, \+\_\+\+M\+S\+I\+Codec\+Settings\+::max\+\_\+video\+\_\+height, \+\_\+\+M\+S\+I\+Codec\+Settings\+::max\+\_\+video\+\_\+width, and \+\_\+\+M\+S\+I\+Codec\+Settings\+::video\+\_\+bitrate.



Referenced by flush\+\_\+peer\+\_\+csettings().


\begin{DoxyCode}
393 \{
394     \textcolor{keywordflow}{if} ( !msg || !dest || !msg->\hyperlink{struct___m_s_i_message_a4b09316f11dc8e9fe3b3357a6d48db56}{csettings}.exists ) \textcolor{keywordflow}{return};
395 
396     dest->\hyperlink{struct___m_s_i_codec_settings_a24d841d0ab8a0b3f12f559aec494e4fe}{call\_type} = msg->\hyperlink{struct___m_s_i_message_a4b09316f11dc8e9fe3b3357a6d48db56}{csettings}.value[0];
397     uint8\_t *iter = msg->\hyperlink{struct___m_s_i_message_a4b09316f11dc8e9fe3b3357a6d48db56}{csettings}.value + 1;
398 
399     memcpy(&dest->\hyperlink{struct___m_s_i_codec_settings_af0eac99d4181795e8a595d244e745192}{video\_bitrate}, iter, 4);
400     iter += 4;
401     dest->\hyperlink{struct___m_s_i_codec_settings_af0eac99d4181795e8a595d244e745192}{video\_bitrate} = ntohl(dest->\hyperlink{struct___m_s_i_codec_settings_af0eac99d4181795e8a595d244e745192}{video\_bitrate});
402 
403     memcpy(&dest->\hyperlink{struct___m_s_i_codec_settings_ab81ecded1f7c46e120c8f2afa7b2c5cc}{max\_video\_width}, iter, 2);
404     iter += 2;
405     dest->\hyperlink{struct___m_s_i_codec_settings_ab81ecded1f7c46e120c8f2afa7b2c5cc}{max\_video\_width} = ntohs(dest->\hyperlink{struct___m_s_i_codec_settings_ab81ecded1f7c46e120c8f2afa7b2c5cc}{max\_video\_width});
406 
407     memcpy(&dest->\hyperlink{struct___m_s_i_codec_settings_a4fef4b2fa1a8ae8446314ad0af4ce698}{max\_video\_height}, iter, 2);
408     iter += 2;
409     dest->\hyperlink{struct___m_s_i_codec_settings_a4fef4b2fa1a8ae8446314ad0af4ce698}{max\_video\_height} = ntohs(dest->\hyperlink{struct___m_s_i_codec_settings_a4fef4b2fa1a8ae8446314ad0af4ce698}{max\_video\_height});
410 
411     memcpy(&dest->\hyperlink{struct___m_s_i_codec_settings_a5d9a8b59b2eb1eef8dbdcb032bf1dd01}{audio\_bitrate}, iter, 4);
412     iter += 4;
413     dest->\hyperlink{struct___m_s_i_codec_settings_a5d9a8b59b2eb1eef8dbdcb032bf1dd01}{audio\_bitrate} = ntohl(dest->\hyperlink{struct___m_s_i_codec_settings_a5d9a8b59b2eb1eef8dbdcb032bf1dd01}{audio\_bitrate});
414 
415     memcpy(&dest->\hyperlink{struct___m_s_i_codec_settings_a61b592233f5a65705eb2600d38e365cd}{audio\_frame\_duration}, iter, 2);
416     iter += 2;
417     dest->\hyperlink{struct___m_s_i_codec_settings_a61b592233f5a65705eb2600d38e365cd}{audio\_frame\_duration} = ntohs(dest->
      \hyperlink{struct___m_s_i_codec_settings_a61b592233f5a65705eb2600d38e365cd}{audio\_frame\_duration});
418 
419     memcpy(&dest->\hyperlink{struct___m_s_i_codec_settings_a66da4482e934a2700e07a39fa0838559}{audio\_sample\_rate}, iter, 4);
420     iter += 4;
421     dest->\hyperlink{struct___m_s_i_codec_settings_a66da4482e934a2700e07a39fa0838559}{audio\_sample\_rate} = ntohl(dest->\hyperlink{struct___m_s_i_codec_settings_a66da4482e934a2700e07a39fa0838559}{audio\_sample\_rate});
422 
423     memcpy(&dest->\hyperlink{struct___m_s_i_codec_settings_a1b04e9669a2929f425e867440b6d826d}{audio\_channels}, iter, 4);
424     dest->\hyperlink{struct___m_s_i_codec_settings_a1b04e9669a2929f425e867440b6d826d}{audio\_channels} = ntohl(dest->\hyperlink{struct___m_s_i_codec_settings_a1b04e9669a2929f425e867440b6d826d}{audio\_channels});
425 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_a1d6d84b54016402734b0bc352f654699_icgraph}
\end{center}
\end{figure}


\hypertarget{msi_8c_a16a648334fa4007ea0d39927bd89eb0b}{\index{msi.\+c@{msi.\+c}!msi\+\_\+msg\+\_\+set\+\_\+callid@{msi\+\_\+msg\+\_\+set\+\_\+callid}}
\index{msi\+\_\+msg\+\_\+set\+\_\+callid@{msi\+\_\+msg\+\_\+set\+\_\+callid}!msi.\+c@{msi.\+c}}
\subsubsection[{msi\+\_\+msg\+\_\+set\+\_\+callid}]{\setlength{\rightskip}{0pt plus 5cm}void msi\+\_\+msg\+\_\+set\+\_\+callid (
\begin{DoxyParamCaption}
\item[{{\bf M\+S\+I\+Message} $\ast$}]{msg, }
\item[{const {\bf M\+S\+I\+Call\+I\+D\+Type}}]{value}
\end{DoxyParamCaption}
)}}\label{msi_8c_a16a648334fa4007ea0d39927bd89eb0b}


Definition at line 340 of file msi.\+c.



References \+\_\+\+M\+S\+I\+Message\+::callid.



Referenced by send\+\_\+message().


\begin{DoxyCode}
341 \{
342     \textcolor{keywordflow}{if} ( !msg ) \textcolor{keywordflow}{return};
343 
344     msg->\hyperlink{struct___m_s_i_message_a0cb3f797b633561175096933c2eb003e}{callid}.exists = 1;
345     memcpy(msg->\hyperlink{struct___m_s_i_message_a0cb3f797b633561175096933c2eb003e}{callid}.value, value, \textcolor{keyword}{sizeof}(\hyperlink{msi_8h_a861af5c5c180987c1c86739b4321076c}{MSICallIDType}));
346 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_a16a648334fa4007ea0d39927bd89eb0b_icgraph}
\end{center}
\end{figure}


\hypertarget{msi_8c_ad8cf444077a0744601cf9107fbb6dbb8}{\index{msi.\+c@{msi.\+c}!msi\+\_\+msg\+\_\+set\+\_\+csettings@{msi\+\_\+msg\+\_\+set\+\_\+csettings}}
\index{msi\+\_\+msg\+\_\+set\+\_\+csettings@{msi\+\_\+msg\+\_\+set\+\_\+csettings}!msi.\+c@{msi.\+c}}
\subsubsection[{msi\+\_\+msg\+\_\+set\+\_\+csettings}]{\setlength{\rightskip}{0pt plus 5cm}void msi\+\_\+msg\+\_\+set\+\_\+csettings (
\begin{DoxyParamCaption}
\item[{{\bf M\+S\+I\+Message} $\ast$}]{msg, }
\item[{const {\bf M\+S\+I\+C\+Settings} $\ast$}]{value}
\end{DoxyParamCaption}
)}}\label{msi_8c_ad8cf444077a0744601cf9107fbb6dbb8}


Definition at line 348 of file msi.\+c.



References \+\_\+\+M\+S\+I\+Codec\+Settings\+::audio\+\_\+bitrate, \+\_\+\+M\+S\+I\+Codec\+Settings\+::audio\+\_\+channels, \+\_\+\+M\+S\+I\+Codec\+Settings\+::audio\+\_\+frame\+\_\+duration, \+\_\+\+M\+S\+I\+Codec\+Settings\+::audio\+\_\+sample\+\_\+rate, \+\_\+\+M\+S\+I\+Codec\+Settings\+::call\+\_\+type, \+\_\+\+M\+S\+I\+Message\+::csettings, \+\_\+\+M\+S\+I\+Codec\+Settings\+::max\+\_\+video\+\_\+height, \+\_\+\+M\+S\+I\+Codec\+Settings\+::max\+\_\+video\+\_\+width, and \+\_\+\+M\+S\+I\+Codec\+Settings\+::video\+\_\+bitrate.



Referenced by msi\+\_\+answer(), msi\+\_\+change\+\_\+csettings(), and msi\+\_\+invite().


\begin{DoxyCode}
349 \{
350     \textcolor{keywordflow}{if} ( !msg ) \textcolor{keywordflow}{return};
351 
352     msg->\hyperlink{struct___m_s_i_message_a4b09316f11dc8e9fe3b3357a6d48db56}{csettings}.exists = 1;
353 
354     msg->\hyperlink{struct___m_s_i_message_a4b09316f11dc8e9fe3b3357a6d48db56}{csettings}.value[0] = value->\hyperlink{struct___m_s_i_codec_settings_a24d841d0ab8a0b3f12f559aec494e4fe}{call\_type};
355     uint8\_t *iter = msg->\hyperlink{struct___m_s_i_message_a4b09316f11dc8e9fe3b3357a6d48db56}{csettings}.value + 1;
356 
357     \textcolor{comment}{/* Video bitrate */}
358     uint32\_t lval = htonl(value->\hyperlink{struct___m_s_i_codec_settings_af0eac99d4181795e8a595d244e745192}{video\_bitrate});
359     memcpy(iter, &lval, 4);
360     iter += 4;
361 
362     \textcolor{comment}{/* Video max width */}
363     uint16\_t sval = htons(value->\hyperlink{struct___m_s_i_codec_settings_ab81ecded1f7c46e120c8f2afa7b2c5cc}{max\_video\_width});
364     memcpy(iter, &sval, 2);
365     iter += 2;
366 
367     \textcolor{comment}{/* Video max height */}
368     sval = htons(value->\hyperlink{struct___m_s_i_codec_settings_a4fef4b2fa1a8ae8446314ad0af4ce698}{max\_video\_height});
369     memcpy(iter, &sval, 2);
370     iter += 2;
371 
372     \textcolor{comment}{/* Audio bitrate */}
373     lval = htonl(value->\hyperlink{struct___m_s_i_codec_settings_a5d9a8b59b2eb1eef8dbdcb032bf1dd01}{audio\_bitrate});
374     memcpy(iter, &lval, 4);
375     iter += 4;
376 
377     \textcolor{comment}{/* Audio frame duration */}
378     sval = htons(value->\hyperlink{struct___m_s_i_codec_settings_a61b592233f5a65705eb2600d38e365cd}{audio\_frame\_duration});
379     memcpy(iter, &sval, 2);
380     iter += 2;
381 
382     \textcolor{comment}{/* Audio sample rate */}
383     lval = htonl(value->\hyperlink{struct___m_s_i_codec_settings_a66da4482e934a2700e07a39fa0838559}{audio\_sample\_rate});
384     memcpy(iter, &lval, 4);
385     iter += 4;
386 
387     \textcolor{comment}{/* Audio channels */}
388     lval = htonl(value->\hyperlink{struct___m_s_i_codec_settings_a1b04e9669a2929f425e867440b6d826d}{audio\_channels});
389     memcpy(iter, &lval, 4);
390 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_ad8cf444077a0744601cf9107fbb6dbb8_icgraph}
\end{center}
\end{figure}


\hypertarget{msi_8c_abc73c78a9121c32f35e4847af962c889}{\index{msi.\+c@{msi.\+c}!msi\+\_\+msg\+\_\+set\+\_\+reason@{msi\+\_\+msg\+\_\+set\+\_\+reason}}
\index{msi\+\_\+msg\+\_\+set\+\_\+reason@{msi\+\_\+msg\+\_\+set\+\_\+reason}!msi.\+c@{msi.\+c}}
\subsubsection[{msi\+\_\+msg\+\_\+set\+\_\+reason}]{\setlength{\rightskip}{0pt plus 5cm}void msi\+\_\+msg\+\_\+set\+\_\+reason (
\begin{DoxyParamCaption}
\item[{{\bf M\+S\+I\+Message} $\ast$}]{msg, }
\item[{const {\bf M\+S\+I\+Reason\+Str\+Type}}]{value}
\end{DoxyParamCaption}
)}}\label{msi_8c_abc73c78a9121c32f35e4847af962c889}


Definition at line 332 of file msi.\+c.



References \+\_\+\+M\+S\+I\+Message\+::reason.



Referenced by msi\+\_\+cancel(), msi\+\_\+reject(), and send\+\_\+error().


\begin{DoxyCode}
333 \{
334     \textcolor{keywordflow}{if} ( !msg ) \textcolor{keywordflow}{return};
335 
336     msg->\hyperlink{struct___m_s_i_message_aec4373dacf43cd56b5e67d2b04b63f5a}{reason}.exists = 1;
337     memcpy(msg->\hyperlink{struct___m_s_i_message_aec4373dacf43cd56b5e67d2b04b63f5a}{reason}.value, value, \textcolor{keyword}{sizeof}(\hyperlink{msi_8h_acc1e8c2d1829721c4addd8547458c9db}{MSIReasonStrType}));
338 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_abc73c78a9121c32f35e4847af962c889_icgraph}
\end{center}
\end{figure}


\hypertarget{msi_8c_af33f2706f6d0f8e547716e2f6c5f68d3}{\index{msi.\+c@{msi.\+c}!msi\+\_\+new@{msi\+\_\+new}}
\index{msi\+\_\+new@{msi\+\_\+new}!msi.\+c@{msi.\+c}}
\subsubsection[{msi\+\_\+new}]{\setlength{\rightskip}{0pt plus 5cm}{\bf M\+S\+I\+Session}$\ast$ msi\+\_\+new (
\begin{DoxyParamCaption}
\item[{{\bf Messenger} $\ast$}]{messenger, }
\item[{int32\+\_\+t}]{max\+\_\+calls}
\end{DoxyParamCaption}
)}}\label{msi_8c_af33f2706f6d0f8e547716e2f6c5f68d3}
Start the control session. 

Definition at line 1202 of file msi.\+c.



References \+\_\+\+M\+S\+I\+Session\+::agent\+\_\+handler, \+\_\+\+M\+S\+I\+Session\+::call\+\_\+timeout, \+\_\+\+M\+S\+I\+Session\+::calls, create\+\_\+recursive\+\_\+mutex(), error, \+\_\+\+M\+S\+I\+Session\+::frequ, handle\+\_\+remote\+\_\+connection\+\_\+change(), L\+O\+G\+G\+E\+R\+\_\+\+D\+E\+B\+U\+G, L\+O\+G\+G\+E\+R\+\_\+\+E\+R\+R\+O\+R, L\+O\+G\+G\+E\+R\+\_\+\+W\+A\+R\+N\+I\+N\+G, m\+\_\+callback\+\_\+connectionstatus\+\_\+internal\+\_\+av(), m\+\_\+callback\+\_\+msi\+\_\+packet(), \+\_\+\+M\+S\+I\+Session\+::max\+\_\+calls, \+\_\+\+M\+S\+I\+Session\+::messenger\+\_\+handle, msi\+\_\+handle\+\_\+packet(), \+\_\+\+M\+S\+I\+Session\+::mutex, and \+\_\+\+M\+S\+I\+Session\+::timer\+\_\+handler.



Referenced by toxav\+\_\+new().


\begin{DoxyCode}
1203 \{
1204     \textcolor{keywordflow}{if} (messenger == NULL) \{
1205         \hyperlink{logger_8h_aedad6a1e3ffe0d4cd0992b822ec0eeeb}{LOGGER\_ERROR}(\textcolor{stringliteral}{"Could not init session on empty messenger!"});
1206         \textcolor{keywordflow}{return} NULL;
1207     \}
1208 
1209     \textcolor{keywordflow}{if} ( !max\_calls ) \{
1210         \hyperlink{logger_8h_ab3e970f3c1ecb5b71f17eccee4ebb286}{LOGGER\_WARNING}(\textcolor{stringliteral}{"Invalid max call treshold!"});
1211         \textcolor{keywordflow}{return} NULL;
1212     \}
1213 
1214     \hyperlink{struct___m_s_i_session}{MSISession} *retu = calloc ( \textcolor{keyword}{sizeof} ( \hyperlink{struct___m_s_i_session}{MSISession} ), 1 );
1215 
1216     \textcolor{keywordflow}{if} (retu == NULL) \{
1217         \hyperlink{logger_8h_aedad6a1e3ffe0d4cd0992b822ec0eeeb}{LOGGER\_ERROR}(\textcolor{stringliteral}{"Allocation failed! Program might misbehave!"});
1218         \textcolor{keywordflow}{return} NULL;
1219     \}
1220 
1221     \textcolor{keywordflow}{if} (!(retu->\hyperlink{struct___m_s_i_session_ac40fee673bae4030b812579c57389a02}{calls} = calloc( \textcolor{keyword}{sizeof} (\hyperlink{struct___m_s_i_call}{MSICall} *), max\_calls ))) \{
1222         \hyperlink{logger_8h_aedad6a1e3ffe0d4cd0992b822ec0eeeb}{LOGGER\_ERROR}(\textcolor{stringliteral}{"Allocation failed! Program might misbehave!"});
1223         \textcolor{keywordflow}{goto} \hyperlink{msi_8c_a7251f9a01631fc788dd7c8eff23a422ead606e435413ea0944dd00d49e901e4ed}{error};
1224     \}
1225 
1226     retu->\hyperlink{struct___m_s_i_session_a06ab765308a606d809c4c2a2c71710ce}{timer\_handler} = calloc(1, \textcolor{keyword}{sizeof}(\hyperlink{struct___timer_handler}{TimerHandler}));
1227 
1228     \textcolor{keywordflow}{if} (retu->\hyperlink{struct___m_s_i_session_a06ab765308a606d809c4c2a2c71710ce}{timer\_handler} == NULL) \{
1229         \hyperlink{logger_8h_aedad6a1e3ffe0d4cd0992b822ec0eeeb}{LOGGER\_ERROR}(\textcolor{stringliteral}{"Allocation failed! Program might misbehave!"});
1230         \textcolor{keywordflow}{goto} \hyperlink{msi_8c_a7251f9a01631fc788dd7c8eff23a422ead606e435413ea0944dd00d49e901e4ed}{error};
1231     \}
1232 
1233     \textcolor{comment}{/* Allocate space for timers */}
1234     ((\hyperlink{struct___timer_handler}{TimerHandler} *)retu->\hyperlink{struct___m_s_i_session_a06ab765308a606d809c4c2a2c71710ce}{timer\_handler})->max\_capacity = max\_calls * 10;
1235 
1236     \textcolor{keywordflow}{if} (!(((\hyperlink{struct___timer_handler}{TimerHandler} *)retu->\hyperlink{struct___m_s_i_session_a06ab765308a606d809c4c2a2c71710ce}{timer\_handler})->timers = calloc(max\_calls * 10, \textcolor{keyword}{
      sizeof}(\hyperlink{struct___timer}{Timer} *)))) \{
1237         \hyperlink{logger_8h_aedad6a1e3ffe0d4cd0992b822ec0eeeb}{LOGGER\_ERROR}(\textcolor{stringliteral}{"Allocation failed! Program might misbehave!"});
1238         \textcolor{keywordflow}{goto} \hyperlink{msi_8c_a7251f9a01631fc788dd7c8eff23a422ead606e435413ea0944dd00d49e901e4ed}{error};
1239     \}
1240 
1241     \textcolor{keywordflow}{if} (\hyperlink{util_8c_a2f0ae269c015342e2d29a251237ccce2}{create\_recursive\_mutex}(retu->\hyperlink{struct___m_s_i_session_ab4293016252c4d4e63549b0773fa0f33}{mutex}) != 0) \{
1242         \hyperlink{logger_8h_aedad6a1e3ffe0d4cd0992b822ec0eeeb}{LOGGER\_ERROR}(\textcolor{stringliteral}{"Failed to init mutex! Program might misbehave"});
1243         \textcolor{keywordflow}{goto} \hyperlink{msi_8c_a7251f9a01631fc788dd7c8eff23a422ead606e435413ea0944dd00d49e901e4ed}{error};
1244     \}
1245 
1246     retu->\hyperlink{struct___m_s_i_session_a2adfe301d17504006b8321f71f642039}{messenger\_handle} = messenger;
1247     retu->\hyperlink{struct___m_s_i_session_ae284478ea42e8d4ed283876c3ae18c8a}{agent\_handler} = NULL;
1248     retu->\hyperlink{struct___m_s_i_session_ae4bbb4682dc5c74588083ca06ac2f76f}{max\_calls} = max\_calls;
1249     retu->\hyperlink{struct___m_s_i_session_a54c9341406a254204cca6d48dd54cdc8}{frequ} = 10000; \textcolor{comment}{/* default value? */}
1250     retu->\hyperlink{struct___m_s_i_session_a4a61d9413f442d27898849e0d8a26720}{call\_timeout} = 30000; \textcolor{comment}{/* default value? */}
1251 
1252     \hyperlink{_messenger_8c_a6f1431ef7ea09d3bac1b93f4dfa75764}{m\_callback\_msi\_packet}(messenger, \hyperlink{msi_8c_aa944624a15314d9d2eff6373f9506725}{msi\_handle\_packet}, retu );
1253 
1254     \textcolor{comment}{/* This is called when remote terminates session */}
1255     \hyperlink{_messenger_8c_a306c3602085500d8d23adbd52ac59006}{m\_callback\_connectionstatus\_internal\_av}(messenger, 
      \hyperlink{msi_8c_a4d438c93388bdd8b338bd50632144de5}{handle\_remote\_connection\_change}, retu);
1256 
1257     \hyperlink{logger_8h_a9885ca09ce5f94d936c91a5b0856a024}{LOGGER\_DEBUG}(\textcolor{stringliteral}{"New msi session: %p max calls: %u"}, retu, max\_calls);
1258     \textcolor{keywordflow}{return} retu;
1259 
1260 \hyperlink{msi_8c_a7251f9a01631fc788dd7c8eff23a422ead606e435413ea0944dd00d49e901e4ed}{error}:
1261 
1262     \textcolor{keywordflow}{if} (retu->\hyperlink{struct___m_s_i_session_a06ab765308a606d809c4c2a2c71710ce}{timer\_handler}) \{
1263         free(((\hyperlink{struct___timer_handler}{TimerHandler} *)retu->\hyperlink{struct___m_s_i_session_a06ab765308a606d809c4c2a2c71710ce}{timer\_handler})->timers);
1264         free(retu->\hyperlink{struct___m_s_i_session_a06ab765308a606d809c4c2a2c71710ce}{timer\_handler});
1265     \}
1266 
1267     free(retu->\hyperlink{struct___m_s_i_session_ac40fee673bae4030b812579c57389a02}{calls});
1268     free(retu);
1269     \textcolor{keywordflow}{return} NULL;
1270 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_af33f2706f6d0f8e547716e2f6c5f68d3_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_af33f2706f6d0f8e547716e2f6c5f68d3_icgraph}
\end{center}
\end{figure}


\hypertarget{msi_8c_aed030e510836ee3cc994f84f06a0cc98}{\index{msi.\+c@{msi.\+c}!msi\+\_\+new\+\_\+message@{msi\+\_\+new\+\_\+message}}
\index{msi\+\_\+new\+\_\+message@{msi\+\_\+new\+\_\+message}!msi.\+c@{msi.\+c}}
\subsubsection[{msi\+\_\+new\+\_\+message}]{\setlength{\rightskip}{0pt plus 5cm}{\bf M\+S\+I\+Message}$\ast$ msi\+\_\+new\+\_\+message (
\begin{DoxyParamCaption}
\item[{{\bf M\+S\+I\+Message\+Type}}]{type, }
\item[{const uint8\+\_\+t}]{type\+\_\+value}
\end{DoxyParamCaption}
)}}\label{msi_8c_aed030e510836ee3cc994f84f06a0cc98}
Create the message. 

Definition at line 205 of file msi.\+c.



References L\+O\+G\+G\+E\+R\+\_\+\+W\+A\+R\+N\+I\+N\+G, \+\_\+\+M\+S\+I\+Message\+::request, \+\_\+\+M\+S\+I\+Message\+::response, and Type\+Request.



Referenced by handle\+\_\+recv\+\_\+starting(), msi\+\_\+answer(), msi\+\_\+cancel(), msi\+\_\+change\+\_\+csettings(), msi\+\_\+hangup(), msi\+\_\+invite(), msi\+\_\+reject(), send\+\_\+error(), and send\+\_\+reponse().


\begin{DoxyCode}
206 \{
207     \hyperlink{struct___m_s_i_message}{MSIMessage} *retu = calloc ( \textcolor{keyword}{sizeof} ( \hyperlink{struct___m_s_i_message}{MSIMessage} ), 1 );
208 
209     \textcolor{keywordflow}{if} ( retu == NULL ) \{
210         \hyperlink{logger_8h_ab3e970f3c1ecb5b71f17eccee4ebb286}{LOGGER\_WARNING}(\textcolor{stringliteral}{"Allocation failed! Program might misbehave!"});
211         \textcolor{keywordflow}{return} NULL;
212     \}
213 
214     \textcolor{keywordflow}{if} ( type == \hyperlink{msi_8c_a6557c179987e0c84ccb97c9f29a302efa3bc11c46b5beb3df428936d6f53b03f7}{TypeRequest} ) \{
215         retu->\hyperlink{struct___m_s_i_message_a43928947ba3f33772bdeee09fd89557a}{request}.exists = 1;
216         retu->\hyperlink{struct___m_s_i_message_a43928947ba3f33772bdeee09fd89557a}{request}.value = type\_value;
217 
218     \} \textcolor{keywordflow}{else} \{
219         retu->\hyperlink{struct___m_s_i_message_a03f0f34008bf8be095af614ca99ea53f}{response}.exists = 1;
220         retu->\hyperlink{struct___m_s_i_message_a03f0f34008bf8be095af614ca99ea53f}{response}.value = type\_value;
221     \}
222 
223     \textcolor{keywordflow}{return} retu;
224 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_aed030e510836ee3cc994f84f06a0cc98_icgraph}
\end{center}
\end{figure}


\hypertarget{msi_8c_a1121e56554f776e97436cc9a6a3769c4}{\index{msi.\+c@{msi.\+c}!msi\+\_\+register\+\_\+callback@{msi\+\_\+register\+\_\+callback}}
\index{msi\+\_\+register\+\_\+callback@{msi\+\_\+register\+\_\+callback}!msi.\+c@{msi.\+c}}
\subsubsection[{msi\+\_\+register\+\_\+callback}]{\setlength{\rightskip}{0pt plus 5cm}void msi\+\_\+register\+\_\+callback (
\begin{DoxyParamCaption}
\item[{{\bf M\+S\+I\+Session} $\ast$}]{session, }
\item[{{\bf M\+S\+I\+Callback\+Type}}]{callback, }
\item[{{\bf M\+S\+I\+Callback\+I\+D}}]{id, }
\item[{void $\ast$}]{userdata}
\end{DoxyParamCaption}
)}}\label{msi_8c_a1121e56554f776e97436cc9a6a3769c4}
Callback setter. 

Definition at line 1195 of file msi.\+c.



Referenced by toxav\+\_\+register\+\_\+callstate\+\_\+callback().


\begin{DoxyCode}
1196 \{
1197     session->callbacks[id].first = callback;
1198     session->callbacks[id].second = userdata;
1199 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_a1121e56554f776e97436cc9a6a3769c4_icgraph}
\end{center}
\end{figure}


\hypertarget{msi_8c_a9d846fba046c8539b9e183cc01a25fe9}{\index{msi.\+c@{msi.\+c}!msi\+\_\+reject@{msi\+\_\+reject}}
\index{msi\+\_\+reject@{msi\+\_\+reject}!msi.\+c@{msi.\+c}}
\subsubsection[{msi\+\_\+reject}]{\setlength{\rightskip}{0pt plus 5cm}int msi\+\_\+reject (
\begin{DoxyParamCaption}
\item[{{\bf M\+S\+I\+Session} $\ast$}]{session, }
\item[{int32\+\_\+t}]{call\+\_\+index, }
\item[{const char $\ast$}]{reason}
\end{DoxyParamCaption}
)}}\label{msi_8c_a9d846fba046c8539b9e183cc01a25fe9}
Reject incoming call. 

Definition at line 1478 of file msi.\+c.



References \+\_\+\+M\+S\+I\+Session\+::calls, handle\+\_\+timeout(), L\+O\+G\+G\+E\+R\+\_\+\+D\+E\+B\+U\+G, L\+O\+G\+G\+E\+R\+\_\+\+E\+R\+R\+O\+R, m\+\_\+deftout, \+\_\+\+M\+S\+I\+Session\+::max\+\_\+calls, msi\+\_\+\+Call\+Over, msi\+\_\+\+Call\+Starting, msi\+\_\+\+Error\+Invalid\+State, msi\+\_\+\+Error\+No\+Call, msi\+\_\+msg\+\_\+set\+\_\+reason(), msi\+\_\+new\+\_\+message(), \+\_\+\+M\+S\+I\+Session\+::mutex, \+\_\+\+M\+S\+I\+Call\+::peer\+\_\+count, \+\_\+\+M\+S\+I\+Call\+::peers, reject, \+\_\+\+M\+S\+I\+Call\+::request\+\_\+timer\+\_\+id, send\+\_\+message(), \+\_\+\+M\+S\+I\+Call\+::state, timer\+\_\+alloc(), and Type\+Request.



Referenced by toxav\+\_\+reject().


\begin{DoxyCode}
1479 \{
1480     pthread\_mutex\_lock(session->\hyperlink{struct___m_s_i_session_ab4293016252c4d4e63549b0773fa0f33}{mutex});
1481     \hyperlink{logger_8h_a9885ca09ce5f94d936c91a5b0856a024}{LOGGER\_DEBUG}(\textcolor{stringliteral}{"Session: %p Rejecting call: %u; reason: %s"}, session, call\_index, reason ? 
      reason : \textcolor{stringliteral}{"Unknown"});
1482 
1483     \textcolor{keywordflow}{if} ( call\_index < 0 || call\_index >= session->\hyperlink{struct___m_s_i_session_ae4bbb4682dc5c74588083ca06ac2f76f}{max\_calls} || !session->
      \hyperlink{struct___m_s_i_session_ac40fee673bae4030b812579c57389a02}{calls}[call\_index] ) \{
1484         \hyperlink{logger_8h_aedad6a1e3ffe0d4cd0992b822ec0eeeb}{LOGGER\_ERROR}(\textcolor{stringliteral}{"Invalid call index!"});
1485         pthread\_mutex\_unlock(session->\hyperlink{struct___m_s_i_session_ab4293016252c4d4e63549b0773fa0f33}{mutex});
1486         \textcolor{keywordflow}{return} \hyperlink{msi_8h_a52e2ed4d0fa75f870135d452f1f6c229ad3798ce3d9dc448484bf6bfea7a176d3}{msi\_ErrorNoCall};
1487     \}
1488 
1489     \textcolor{keywordflow}{if} ( session->\hyperlink{struct___m_s_i_session_ac40fee673bae4030b812579c57389a02}{calls}[call\_index]->\hyperlink{struct___m_s_i_call_a4a1fc0e5d23dbdc357786d4c69eda9b9}{state} != \hyperlink{msi_8h_afbc789bbdb9a4d00eda005500f7c1675a62ecc3b8e850f62e9e14a2e38d6061bf}{msi\_CallStarting} ) \{
1490         \hyperlink{logger_8h_aedad6a1e3ffe0d4cd0992b822ec0eeeb}{LOGGER\_ERROR}(\textcolor{stringliteral}{"Call is in invalid state!"});
1491         pthread\_mutex\_unlock(session->\hyperlink{struct___m_s_i_session_ab4293016252c4d4e63549b0773fa0f33}{mutex});
1492         \textcolor{keywordflow}{return} \hyperlink{msi_8h_a52e2ed4d0fa75f870135d452f1f6c229a4c874bed9952017bb68e0a27d87a9cde}{msi\_ErrorInvalidState};
1493     \}
1494 
1495     \hyperlink{struct___m_s_i_message}{MSIMessage} *msg\_reject = \hyperlink{msi_8c_aed030e510836ee3cc994f84f06a0cc98}{msi\_new\_message} ( 
      \hyperlink{msi_8c_a6557c179987e0c84ccb97c9f29a302efa3bc11c46b5beb3df428936d6f53b03f7}{TypeRequest}, \hyperlink{msi_8c_ae511d1f1e345bb77cd4120b39679f028ac3938f36421013c679a406260a404daa}{reject} );
1496 
1497     \textcolor{comment}{/* FIXME */}
1498 \textcolor{preprocessor}{#if 0}
1499 
1500     \textcolor{keywordflow}{if} ( reason && strlen(reason) < \textcolor{keyword}{sizeof}(\hyperlink{msi_8h_acc1e8c2d1829721c4addd8547458c9db}{MSIReasonStrType}) ) \{
1501         \hyperlink{msi_8h_acc1e8c2d1829721c4addd8547458c9db}{MSIReasonStrType} reason\_cast;
1502         memset(reason\_cast, \textcolor{charliteral}{'\(\backslash\)0'}, \textcolor{keyword}{sizeof}(\hyperlink{msi_8h_acc1e8c2d1829721c4addd8547458c9db}{MSIReasonStrType}));
1503         memcpy(reason\_cast, reason, strlen(reason));
1504         \hyperlink{msi_8c_abc73c78a9121c32f35e4847af962c889}{msi\_msg\_set\_reason}(msg\_reject, reason\_cast);
1505     \}
1506 
1507 \textcolor{preprocessor}{#else}
1508     (void)reason;
1509 
1510 \textcolor{preprocessor}{#endif}
1511 
1512     \hyperlink{msi_8c_ae174427d97e924339f9e2a961ec773a1}{send\_message} ( session, session->\hyperlink{struct___m_s_i_session_ac40fee673bae4030b812579c57389a02}{calls}[call\_index], msg\_reject,
1513                    session->\hyperlink{struct___m_s_i_session_ac40fee673bae4030b812579c57389a02}{calls}[call\_index]->\hyperlink{struct___m_s_i_call_a55d2568491d616f7fef07bc7137c8c23}{peers}[session->\hyperlink{struct___m_s_i_session_ac40fee673bae4030b812579c57389a02}{calls}[call\_index]->
      \hyperlink{struct___m_s_i_call_a62e9da1e57f84fd224590c4d466724aa}{peer\_count} - 1] );
1514     free ( msg\_reject );
1515 
1516     session->\hyperlink{struct___m_s_i_session_ac40fee673bae4030b812579c57389a02}{calls}[call\_index]->\hyperlink{struct___m_s_i_call_a4a1fc0e5d23dbdc357786d4c69eda9b9}{state} = \hyperlink{msi_8h_afbc789bbdb9a4d00eda005500f7c1675a925ec11e0e4a3a9af7d714629632d44b}{msi\_CallOver};
1517     session->\hyperlink{struct___m_s_i_session_ac40fee673bae4030b812579c57389a02}{calls}[call\_index]->\hyperlink{struct___m_s_i_call_a8ccfd1cd9f807007763f41eafd801130}{request\_timer\_id} =
1518         \hyperlink{msi_8c_a0a093063a8a2e48ca88d8d47234415cb}{timer\_alloc} ( session, \hyperlink{msi_8c_a7a5b1246a4f5680ee60c45e69e04dcd4}{handle\_timeout}, call\_index, 
      \hyperlink{msi_8c_a41cb7a80dff15699d766e4364228a47c}{m\_deftout} );
1519 
1520     pthread\_mutex\_unlock(session->\hyperlink{struct___m_s_i_session_ab4293016252c4d4e63549b0773fa0f33}{mutex});
1521     \textcolor{keywordflow}{return} 0;
1522 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_a9d846fba046c8539b9e183cc01a25fe9_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_a9d846fba046c8539b9e183cc01a25fe9_icgraph}
\end{center}
\end{figure}


\hypertarget{msi_8c_a4d2aa9bfe7f4a96275204f2797d6e7eb}{\index{msi.\+c@{msi.\+c}!msi\+\_\+stopcall@{msi\+\_\+stopcall}}
\index{msi\+\_\+stopcall@{msi\+\_\+stopcall}!msi.\+c@{msi.\+c}}
\subsubsection[{msi\+\_\+stopcall}]{\setlength{\rightskip}{0pt plus 5cm}int msi\+\_\+stopcall (
\begin{DoxyParamCaption}
\item[{{\bf M\+S\+I\+Session} $\ast$}]{session, }
\item[{int32\+\_\+t}]{call\+\_\+index}
\end{DoxyParamCaption}
)}}\label{msi_8c_a4d2aa9bfe7f4a96275204f2797d6e7eb}
Terminate the call. 

Definition at line 1524 of file msi.\+c.



References \+\_\+\+M\+S\+I\+Session\+::calls, L\+O\+G\+G\+E\+R\+\_\+\+D\+E\+B\+U\+G, \+\_\+\+M\+S\+I\+Session\+::max\+\_\+calls, msi\+\_\+\+Error\+No\+Call, \+\_\+\+M\+S\+I\+Session\+::mutex, and terminate\+\_\+call().



Referenced by msi\+\_\+kill(), and toxav\+\_\+stop\+\_\+call().


\begin{DoxyCode}
1525 \{
1526     pthread\_mutex\_lock(session->\hyperlink{struct___m_s_i_session_ab4293016252c4d4e63549b0773fa0f33}{mutex});
1527     \hyperlink{logger_8h_a9885ca09ce5f94d936c91a5b0856a024}{LOGGER\_DEBUG}(\textcolor{stringliteral}{"Session: %p Stopping call index: %u"}, session, call\_index);
1528 
1529     \textcolor{keywordflow}{if} ( call\_index < 0 || call\_index >= session->\hyperlink{struct___m_s_i_session_ae4bbb4682dc5c74588083ca06ac2f76f}{max\_calls} || !session->
      \hyperlink{struct___m_s_i_session_ac40fee673bae4030b812579c57389a02}{calls}[call\_index] ) \{
1530         pthread\_mutex\_unlock(session->\hyperlink{struct___m_s_i_session_ab4293016252c4d4e63549b0773fa0f33}{mutex});
1531         \textcolor{keywordflow}{return} \hyperlink{msi_8h_a52e2ed4d0fa75f870135d452f1f6c229ad3798ce3d9dc448484bf6bfea7a176d3}{msi\_ErrorNoCall};
1532     \}
1533 
1534     \textcolor{comment}{/* just terminate it */}
1535 
1536     \hyperlink{msi_8c_abf7deacfacdcb5b7cc4cfc163583c40d}{terminate\_call} ( session, session->\hyperlink{struct___m_s_i_session_ac40fee673bae4030b812579c57389a02}{calls}[call\_index] );
1537 
1538     pthread\_mutex\_unlock(session->\hyperlink{struct___m_s_i_session_ab4293016252c4d4e63549b0773fa0f33}{mutex});
1539     \textcolor{keywordflow}{return} 0;
1540 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_a4d2aa9bfe7f4a96275204f2797d6e7eb_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_a4d2aa9bfe7f4a96275204f2797d6e7eb_icgraph}
\end{center}
\end{figure}


\hypertarget{msi_8c_af39b54cd1086b4efb315083874e5e9ed}{\index{msi.\+c@{msi.\+c}!parse\+\_\+raw\+\_\+data@{parse\+\_\+raw\+\_\+data}}
\index{parse\+\_\+raw\+\_\+data@{parse\+\_\+raw\+\_\+data}!msi.\+c@{msi.\+c}}
\subsubsection[{parse\+\_\+raw\+\_\+data}]{\setlength{\rightskip}{0pt plus 5cm}static int parse\+\_\+raw\+\_\+data (
\begin{DoxyParamCaption}
\item[{{\bf M\+S\+I\+Message} $\ast$}]{msg, }
\item[{const uint8\+\_\+t $\ast$}]{data, }
\item[{uint16\+\_\+t}]{length}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{msi_8c_af39b54cd1086b4efb315083874e5e9ed}
Parse raw 'data' received from socket into M\+S\+I\+Message struct. Every message has to have end value of 'end\+\_\+byte' or {\itshape undefined} behavior occures. The best practice is to check the end of the message at the handle\+\_\+packet. 

Definition at line 126 of file msi.\+c.



References \+\_\+\+M\+S\+I\+Message\+::callid, \+\_\+\+M\+S\+I\+Message\+::csettings, make-\/funny-\/savefile\+::data, end, error, F\+A\+I\+L\+\_\+\+C\+O\+N\+S\+T\+R\+A\+I\+N\+T, F\+A\+I\+L\+\_\+\+L\+I\+M\+I\+T\+S, F\+A\+I\+L\+\_\+\+S\+I\+Z\+E, I\+D\+Call\+Id, I\+D\+C\+Settings, I\+D\+Reason, I\+D\+Request, I\+D\+Response, L\+O\+G\+G\+E\+R\+\_\+\+E\+R\+R\+O\+R, \+\_\+\+M\+S\+I\+Message\+::reason, \+\_\+\+M\+S\+I\+Message\+::request, and \+\_\+\+M\+S\+I\+Message\+::response.



Referenced by parse\+\_\+recv().


\begin{DoxyCode}
127 \{
128 
129 \textcolor{preprocessor}{#define FAIL\_CONSTRAINT(constraint, wanted) if ((constraint -= wanted) < 1) \{ LOGGER\_ERROR("Read over
       length!"); return -1; \}}
130 \textcolor{preprocessor}{#define FAIL\_SIZE(byte, valid) if ( byte != valid ) \{ LOGGER\_ERROR("Invalid data size!"); return -1; \}}
131 \textcolor{preprocessor}{#define FAIL\_LIMITS(byte, high) if ( byte > high ) \{ LOGGER\_ERROR("Failed limit!"); return -1; \}}
132 
133     \textcolor{keywordflow}{if} ( msg == NULL ) \{
134         \hyperlink{logger_8h_aedad6a1e3ffe0d4cd0992b822ec0eeeb}{LOGGER\_ERROR}(\textcolor{stringliteral}{"Could not parse message: no storage!"});
135         \textcolor{keywordflow}{return} -1;
136     \}
137 
138     \textcolor{keywordflow}{if} ( \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}[length - 1] ) \{ \textcolor{comment}{/* End byte must have value 0 */}
139         \hyperlink{logger_8h_aedad6a1e3ffe0d4cd0992b822ec0eeeb}{LOGGER\_ERROR}(\textcolor{stringliteral}{"Invalid end byte"});
140         \textcolor{keywordflow}{return} -1;
141     \}
142 
143     \textcolor{keyword}{const} uint8\_t *it = \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data};
144     \textcolor{keywordtype}{int} size\_constraint = length;
145 
146     \textcolor{keywordflow}{while} ( *it ) \{\textcolor{comment}{/* until end byte is hit */}
147         \textcolor{keywordflow}{switch} (*it) \{
148             \textcolor{keywordflow}{case} \hyperlink{msi_8c_a54be6a6ec118139a2cd0a21e490a7deba8d1bbc36c628c8c70dd0b5343064118d}{IDRequest}:
149                 \hyperlink{msi_8c_a3785df56bb359bc7613cfab5f08dd94b}{FAIL\_CONSTRAINT}(size\_constraint, 3);
150                 \hyperlink{msi_8c_a57143c0fea08f509ce3d4be05a051a44}{FAIL\_SIZE}(it[1], 1);
151 \textcolor{comment}{//                 FAIL\_LIMITS(it[2], invite, end);}
152                 \hyperlink{msi_8c_abf9b878e14616e9d2c224646f1096fd1}{FAIL\_LIMITS}(it[2], \hyperlink{msi_8c_ae511d1f1e345bb77cd4120b39679f028a80b1a820e533d7cf0e1715319339e6d0}{end});
153                 msg->\hyperlink{struct___m_s_i_message_a43928947ba3f33772bdeee09fd89557a}{request}.value = it[2];
154                 it += 3;
155                 msg->\hyperlink{struct___m_s_i_message_a43928947ba3f33772bdeee09fd89557a}{request}.exists = 1;
156                 \textcolor{keywordflow}{break};
157 
158             \textcolor{keywordflow}{case} \hyperlink{msi_8c_a54be6a6ec118139a2cd0a21e490a7deba569155714fc04f9d3d70224ab8fb700a}{IDResponse}:
159                 \hyperlink{msi_8c_a3785df56bb359bc7613cfab5f08dd94b}{FAIL\_CONSTRAINT}(size\_constraint, 3);
160                 \hyperlink{msi_8c_a57143c0fea08f509ce3d4be05a051a44}{FAIL\_SIZE}(it[1], 1);
161 \textcolor{comment}{//                 FAIL\_LIMITS(it[2], ringing, error);}
162                 \hyperlink{msi_8c_abf9b878e14616e9d2c224646f1096fd1}{FAIL\_LIMITS}(it[2], \hyperlink{msi_8c_a7251f9a01631fc788dd7c8eff23a422ead606e435413ea0944dd00d49e901e4ed}{error});
163                 msg->\hyperlink{struct___m_s_i_message_a03f0f34008bf8be095af614ca99ea53f}{response}.value = it[2];
164                 it += 3;
165                 msg->\hyperlink{struct___m_s_i_message_a03f0f34008bf8be095af614ca99ea53f}{response}.exists = 1;
166                 \textcolor{keywordflow}{break};
167 
168             \textcolor{keywordflow}{case} \hyperlink{msi_8c_a54be6a6ec118139a2cd0a21e490a7deba59f19c1ff36c01aed8f32835fa655ee2}{IDCallId}:
169                 \hyperlink{msi_8c_a3785df56bb359bc7613cfab5f08dd94b}{FAIL\_CONSTRAINT}(size\_constraint, \textcolor{keyword}{sizeof}(
      \hyperlink{msi_8h_a861af5c5c180987c1c86739b4321076c}{MSICallIDType}) + 2);
170                 \hyperlink{msi_8c_a57143c0fea08f509ce3d4be05a051a44}{FAIL\_SIZE}(it[1], \textcolor{keyword}{sizeof}(\hyperlink{msi_8h_a861af5c5c180987c1c86739b4321076c}{MSICallIDType}));
171                 memcpy(msg->\hyperlink{struct___m_s_i_message_a0cb3f797b633561175096933c2eb003e}{callid}.value, it + 2, \textcolor{keyword}{sizeof}(\hyperlink{msi_8h_a861af5c5c180987c1c86739b4321076c}{MSICallIDType}));
172                 it += \textcolor{keyword}{sizeof}(\hyperlink{msi_8h_a861af5c5c180987c1c86739b4321076c}{MSICallIDType}) + 2;
173                 msg->\hyperlink{struct___m_s_i_message_a0cb3f797b633561175096933c2eb003e}{callid}.exists = 1;
174                 \textcolor{keywordflow}{break};
175 
176             \textcolor{keywordflow}{case} \hyperlink{msi_8c_a54be6a6ec118139a2cd0a21e490a7deba377727aa6f1757d466f0d62d169debd0}{IDReason}:
177                 \hyperlink{msi_8c_a3785df56bb359bc7613cfab5f08dd94b}{FAIL\_CONSTRAINT}(size\_constraint, \textcolor{keyword}{sizeof}(
      \hyperlink{msi_8h_acc1e8c2d1829721c4addd8547458c9db}{MSIReasonStrType}) + 2);
178                 \hyperlink{msi_8c_a57143c0fea08f509ce3d4be05a051a44}{FAIL\_SIZE}(it[1], \textcolor{keyword}{sizeof}(\hyperlink{msi_8h_acc1e8c2d1829721c4addd8547458c9db}{MSIReasonStrType}));
179                 memcpy(msg->\hyperlink{struct___m_s_i_message_aec4373dacf43cd56b5e67d2b04b63f5a}{reason}.value, it + 2, \textcolor{keyword}{sizeof}(\hyperlink{msi_8h_acc1e8c2d1829721c4addd8547458c9db}{MSIReasonStrType}));
180                 it += \textcolor{keyword}{sizeof}(\hyperlink{msi_8h_acc1e8c2d1829721c4addd8547458c9db}{MSIReasonStrType}) + 2;
181                 msg->\hyperlink{struct___m_s_i_message_aec4373dacf43cd56b5e67d2b04b63f5a}{reason}.exists = 1;
182                 \textcolor{keywordflow}{break};
183 
184             \textcolor{keywordflow}{case} \hyperlink{msi_8c_a54be6a6ec118139a2cd0a21e490a7deba6e1521034cf248217314e040e34dc595}{IDCSettings}:
185                 \hyperlink{msi_8c_a3785df56bb359bc7613cfab5f08dd94b}{FAIL\_CONSTRAINT}(size\_constraint, \textcolor{keyword}{sizeof}(
      \hyperlink{msi_8c_a1eaa1b2e6ca0fb65790e2e7e0dd62735}{MSIRawCSettingsType}) + 2);
186                 \hyperlink{msi_8c_a57143c0fea08f509ce3d4be05a051a44}{FAIL\_SIZE}(it[1], \textcolor{keyword}{sizeof}(\hyperlink{msi_8c_a1eaa1b2e6ca0fb65790e2e7e0dd62735}{MSIRawCSettingsType}));
187                 memcpy(msg->\hyperlink{struct___m_s_i_message_a4b09316f11dc8e9fe3b3357a6d48db56}{csettings}.value, it + 2, \textcolor{keyword}{sizeof}(
      \hyperlink{msi_8c_a1eaa1b2e6ca0fb65790e2e7e0dd62735}{MSIRawCSettingsType}));
188                 it += \textcolor{keyword}{sizeof}(\hyperlink{msi_8c_a1eaa1b2e6ca0fb65790e2e7e0dd62735}{MSIRawCSettingsType}) + 2;
189                 msg->\hyperlink{struct___m_s_i_message_a4b09316f11dc8e9fe3b3357a6d48db56}{csettings}.exists = 1;
190                 \textcolor{keywordflow}{break};
191 
192             \textcolor{keywordflow}{default}:
193                 \hyperlink{logger_8h_aedad6a1e3ffe0d4cd0992b822ec0eeeb}{LOGGER\_ERROR}(\textcolor{stringliteral}{"Invalid id byte"});
194                 \textcolor{keywordflow}{return} -1;
195                 \textcolor{keywordflow}{break};
196         \}
197     \}
198 
199     \textcolor{keywordflow}{return} 0;
200 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_af39b54cd1086b4efb315083874e5e9ed_icgraph}
\end{center}
\end{figure}


\hypertarget{msi_8c_a7941e06f6114e6d26a9c0538c941eb8a}{\index{msi.\+c@{msi.\+c}!parse\+\_\+recv@{parse\+\_\+recv}}
\index{parse\+\_\+recv@{parse\+\_\+recv}!msi.\+c@{msi.\+c}}
\subsubsection[{parse\+\_\+recv}]{\setlength{\rightskip}{0pt plus 5cm}{\bf M\+S\+I\+Message}$\ast$ parse\+\_\+recv (
\begin{DoxyParamCaption}
\item[{const uint8\+\_\+t $\ast$}]{data, }
\item[{uint16\+\_\+t}]{length}
\end{DoxyParamCaption}
)}}\label{msi_8c_a7941e06f6114e6d26a9c0538c941eb8a}
Parse data from handle\+\_\+packet. 

Definition at line 230 of file msi.\+c.



References L\+O\+G\+G\+E\+R\+\_\+\+W\+A\+R\+N\+I\+N\+G, and parse\+\_\+raw\+\_\+data().



Referenced by msi\+\_\+handle\+\_\+packet().


\begin{DoxyCode}
231 \{
232     \textcolor{keywordflow}{if} ( \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data} == NULL ) \{
233         \hyperlink{logger_8h_ab3e970f3c1ecb5b71f17eccee4ebb286}{LOGGER\_WARNING}(\textcolor{stringliteral}{"Tried to parse empty message!"});
234         \textcolor{keywordflow}{return} NULL;
235     \}
236 
237     \hyperlink{struct___m_s_i_message}{MSIMessage} *retu = calloc ( \textcolor{keyword}{sizeof} ( \hyperlink{struct___m_s_i_message}{MSIMessage} ), 1 );
238 
239     \textcolor{keywordflow}{if} ( retu == NULL ) \{
240         \hyperlink{logger_8h_ab3e970f3c1ecb5b71f17eccee4ebb286}{LOGGER\_WARNING}(\textcolor{stringliteral}{"Allocation failed! Program might misbehave!"});
241         \textcolor{keywordflow}{return} NULL;
242     \}
243 
244     \textcolor{keywordflow}{if} ( \hyperlink{msi_8c_af39b54cd1086b4efb315083874e5e9ed}{parse\_raw\_data} ( retu, \hyperlink{namespacemake-funny-savefile_aa7a0efb8690a34f61a95b00cc723ca27}{data}, length ) == -1 ) \{
245 
246         free ( retu );
247         \textcolor{keywordflow}{return} NULL;
248     \}
249 
250     \textcolor{keywordflow}{return} retu;
251 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=267pt]{d2/d9b/msi_8c_a7941e06f6114e6d26a9c0538c941eb8a_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_a7941e06f6114e6d26a9c0538c941eb8a_icgraph}
\end{center}
\end{figure}


\hypertarget{msi_8c_aea77316761ab5ed482dc78f727ee9c76}{\index{msi.\+c@{msi.\+c}!parse\+\_\+send@{parse\+\_\+send}}
\index{parse\+\_\+send@{parse\+\_\+send}!msi.\+c@{msi.\+c}}
\subsubsection[{parse\+\_\+send}]{\setlength{\rightskip}{0pt plus 5cm}uint16\+\_\+t parse\+\_\+send (
\begin{DoxyParamCaption}
\item[{{\bf M\+S\+I\+Message} $\ast$}]{msg, }
\item[{uint8\+\_\+t $\ast$}]{dest}
\end{DoxyParamCaption}
)}}\label{msi_8c_aea77316761ab5ed482dc78f727ee9c76}
Parse M\+S\+I\+Message to send. 

Definition at line 289 of file msi.\+c.



References \+\_\+\+M\+S\+I\+Message\+::callid, \+\_\+\+M\+S\+I\+Message\+::csettings, format\+\_\+output(), I\+D\+Call\+Id, I\+D\+C\+Settings, I\+D\+Reason, I\+D\+Request, I\+D\+Response, L\+O\+G\+G\+E\+R\+\_\+\+E\+R\+R\+O\+R, \+\_\+\+M\+S\+I\+Message\+::reason, \+\_\+\+M\+S\+I\+Message\+::request, and \+\_\+\+M\+S\+I\+Message\+::response.



Referenced by send\+\_\+message().


\begin{DoxyCode}
290 \{
291     \textcolor{keywordflow}{if} (msg == NULL) \{
292         \hyperlink{logger_8h_aedad6a1e3ffe0d4cd0992b822ec0eeeb}{LOGGER\_ERROR}(\textcolor{stringliteral}{"No message!"});
293         \textcolor{keywordflow}{return} 0;
294     \}
295 
296     \textcolor{keywordflow}{if} (dest == NULL ) \{
297         \hyperlink{logger_8h_aedad6a1e3ffe0d4cd0992b822ec0eeeb}{LOGGER\_ERROR}(\textcolor{stringliteral}{"No destination!"});
298         \textcolor{keywordflow}{return} 0;
299     \}
300 
301     uint8\_t *it = dest;
302     uint16\_t size = 0;
303 
304     \textcolor{keywordflow}{if} (msg->\hyperlink{struct___m_s_i_message_a43928947ba3f33772bdeee09fd89557a}{request}.exists) \{
305         uint8\_t cast = msg->\hyperlink{struct___m_s_i_message_a43928947ba3f33772bdeee09fd89557a}{request}.value;
306         it = \hyperlink{msi_8c_acd3f86de9a0df45caf147b8a095a89a0}{format\_output}(it, \hyperlink{msi_8c_a54be6a6ec118139a2cd0a21e490a7deba8d1bbc36c628c8c70dd0b5343064118d}{IDRequest}, &cast, 1, &size);
307     \}
308 
309     \textcolor{keywordflow}{if} (msg->\hyperlink{struct___m_s_i_message_a03f0f34008bf8be095af614ca99ea53f}{response}.exists) \{
310         uint8\_t cast = msg->\hyperlink{struct___m_s_i_message_a03f0f34008bf8be095af614ca99ea53f}{response}.value;
311         it = \hyperlink{msi_8c_acd3f86de9a0df45caf147b8a095a89a0}{format\_output}(it, \hyperlink{msi_8c_a54be6a6ec118139a2cd0a21e490a7deba569155714fc04f9d3d70224ab8fb700a}{IDResponse}, &cast, 1, &size);
312     \}
313 
314     \textcolor{keywordflow}{if} (msg->\hyperlink{struct___m_s_i_message_a0cb3f797b633561175096933c2eb003e}{callid}.exists) \{
315         it = \hyperlink{msi_8c_acd3f86de9a0df45caf147b8a095a89a0}{format\_output}(it, \hyperlink{msi_8c_a54be6a6ec118139a2cd0a21e490a7deba59f19c1ff36c01aed8f32835fa655ee2}{IDCallId}, &msg->\hyperlink{struct___m_s_i_message_a0cb3f797b633561175096933c2eb003e}{callid}.value, \textcolor{keyword}{sizeof}(msg->
      \hyperlink{struct___m_s_i_message_a0cb3f797b633561175096933c2eb003e}{callid}.value), &size);
316     \}
317 
318     \textcolor{keywordflow}{if} (msg->\hyperlink{struct___m_s_i_message_aec4373dacf43cd56b5e67d2b04b63f5a}{reason}.exists) \{
319         it = \hyperlink{msi_8c_acd3f86de9a0df45caf147b8a095a89a0}{format\_output}(it, \hyperlink{msi_8c_a54be6a6ec118139a2cd0a21e490a7deba377727aa6f1757d466f0d62d169debd0}{IDReason}, &msg->\hyperlink{struct___m_s_i_message_aec4373dacf43cd56b5e67d2b04b63f5a}{reason}.value, \textcolor{keyword}{sizeof}(msg->
      \hyperlink{struct___m_s_i_message_aec4373dacf43cd56b5e67d2b04b63f5a}{reason}.value), &size);
320     \}
321 
322     \textcolor{keywordflow}{if} (msg->\hyperlink{struct___m_s_i_message_a4b09316f11dc8e9fe3b3357a6d48db56}{csettings}.exists) \{
323         it = \hyperlink{msi_8c_acd3f86de9a0df45caf147b8a095a89a0}{format\_output}(it, \hyperlink{msi_8c_a54be6a6ec118139a2cd0a21e490a7deba6e1521034cf248217314e040e34dc595}{IDCSettings}, &msg->
      \hyperlink{struct___m_s_i_message_a4b09316f11dc8e9fe3b3357a6d48db56}{csettings}.value, \textcolor{keyword}{sizeof}(msg->\hyperlink{struct___m_s_i_message_a4b09316f11dc8e9fe3b3357a6d48db56}{csettings}.value), &size);
324     \}
325 
326     *it = 0;
327     size ++;
328 
329     \textcolor{keywordflow}{return} size;
330 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=260pt]{d2/d9b/msi_8c_aea77316761ab5ed482dc78f727ee9c76_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_aea77316761ab5ed482dc78f727ee9c76_icgraph}
\end{center}
\end{figure}


\hypertarget{msi_8c_a61759c89740aba4cdeea164816115d32}{\index{msi.\+c@{msi.\+c}!send\+\_\+error@{send\+\_\+error}}
\index{send\+\_\+error@{send\+\_\+error}!msi.\+c@{msi.\+c}}
\subsubsection[{send\+\_\+error}]{\setlength{\rightskip}{0pt plus 5cm}static int send\+\_\+error (
\begin{DoxyParamCaption}
\item[{{\bf M\+S\+I\+Session} $\ast$}]{session, }
\item[{{\bf M\+S\+I\+Call} $\ast$}]{call, }
\item[{{\bf M\+S\+I\+Call\+Error}}]{errid, }
\item[{uint32\+\_\+t}]{to}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{msi_8c_a61759c89740aba4cdeea164816115d32}


Definition at line 608 of file msi.\+c.



References error, \+\_\+\+M\+S\+I\+Call\+::id, L\+O\+G\+G\+E\+R\+\_\+\+D\+E\+B\+U\+G, L\+O\+G\+G\+E\+R\+\_\+\+W\+A\+R\+N\+I\+N\+G, msi\+\_\+msg\+\_\+set\+\_\+reason(), msi\+\_\+new\+\_\+message(), send\+\_\+message(), stringify\+\_\+error(), and Type\+Response.



Referenced by handle\+\_\+recv\+\_\+invite().


\begin{DoxyCode}
609 \{
610     \textcolor{keywordflow}{if} (!call) \{
611         \hyperlink{logger_8h_ab3e970f3c1ecb5b71f17eccee4ebb286}{LOGGER\_WARNING}(\textcolor{stringliteral}{"Cannot handle error on 'null' call"});
612         \textcolor{keywordflow}{return} -1;
613     \}
614 
615     \hyperlink{logger_8h_a9885ca09ce5f94d936c91a5b0856a024}{LOGGER\_DEBUG}(\textcolor{stringliteral}{"Sending error: %d on call: %s"}, errid, call->\hyperlink{struct___m_s_i_call_aa135fbffd11268758f5f21269fb46853}{id});
616 
617     \hyperlink{struct___m_s_i_message}{MSIMessage} *msg\_error = \hyperlink{msi_8c_aed030e510836ee3cc994f84f06a0cc98}{msi\_new\_message} ( 
      \hyperlink{msi_8c_a6557c179987e0c84ccb97c9f29a302efa44af861e1cb1f54554d3a48a9dfa343b}{TypeResponse}, \hyperlink{msi_8c_a7251f9a01631fc788dd7c8eff23a422ead606e435413ea0944dd00d49e901e4ed}{error} );
618 
619     \hyperlink{msi_8c_abc73c78a9121c32f35e4847af962c889}{msi\_msg\_set\_reason} ( msg\_error, \hyperlink{msi_8c_af3fb90754ded4536f9314f5d48e477e5}{stringify\_error}(errid) );
620     \hyperlink{msi_8c_ae174427d97e924339f9e2a961ec773a1}{send\_message} ( session, call, msg\_error, to );
621     free ( msg\_error );
622 
623     \textcolor{keywordflow}{return} 0;
624 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_a61759c89740aba4cdeea164816115d32_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_a61759c89740aba4cdeea164816115d32_icgraph}
\end{center}
\end{figure}


\hypertarget{msi_8c_ae174427d97e924339f9e2a961ec773a1}{\index{msi.\+c@{msi.\+c}!send\+\_\+message@{send\+\_\+message}}
\index{send\+\_\+message@{send\+\_\+message}!msi.\+c@{msi.\+c}}
\subsubsection[{send\+\_\+message}]{\setlength{\rightskip}{0pt plus 5cm}static int send\+\_\+message (
\begin{DoxyParamCaption}
\item[{{\bf M\+S\+I\+Session} $\ast$}]{session, }
\item[{{\bf M\+S\+I\+Call} $\ast$}]{call, }
\item[{{\bf M\+S\+I\+Message} $\ast$}]{msg, }
\item[{uint32\+\_\+t}]{to}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{msi_8c_ae174427d97e924339f9e2a961ec773a1}


Definition at line 580 of file msi.\+c.



References \+\_\+\+M\+S\+I\+Call\+::id, L\+O\+G\+G\+E\+R\+\_\+\+D\+E\+B\+U\+G, L\+O\+G\+G\+E\+R\+\_\+\+W\+A\+R\+N\+I\+N\+G, m\+\_\+msi\+\_\+packet(), \+\_\+\+M\+S\+I\+Session\+::messenger\+\_\+handle, M\+S\+I\+\_\+\+M\+A\+X\+M\+S\+G\+\_\+\+S\+I\+Z\+E, msi\+\_\+msg\+\_\+set\+\_\+callid(), and parse\+\_\+send().



Referenced by handle\+\_\+recv\+\_\+starting(), msi\+\_\+answer(), msi\+\_\+cancel(), msi\+\_\+change\+\_\+csettings(), msi\+\_\+hangup(), msi\+\_\+invite(), msi\+\_\+reject(), send\+\_\+error(), and send\+\_\+reponse().


\begin{DoxyCode}
581 \{
582     \hyperlink{msi_8c_a16a648334fa4007ea0d39927bd89eb0b}{msi\_msg\_set\_callid} ( msg, call->\hyperlink{struct___m_s_i_call_aa135fbffd11268758f5f21269fb46853}{id} );
583 
584     uint8\_t msg\_string\_final [\hyperlink{msi_8c_a8df39ace36437e03047c050b2580536b}{MSI\_MAXMSG\_SIZE}];
585     uint16\_t length = \hyperlink{msi_8c_aea77316761ab5ed482dc78f727ee9c76}{parse\_send} ( msg, msg\_string\_final );
586 
587     \textcolor{keywordflow}{if} (!length) \{
588         \hyperlink{logger_8h_ab3e970f3c1ecb5b71f17eccee4ebb286}{LOGGER\_WARNING}(\textcolor{stringliteral}{"Parsing message failed; nothing sent!"});
589         \textcolor{keywordflow}{return} -1;
590     \}
591 
592     \textcolor{keywordflow}{if} ( \hyperlink{_messenger_8c_a2374f56c7aeb5fa6d1a3f1a29bb5016b}{m\_msi\_packet}(session->\hyperlink{struct___m_s_i_session_a2adfe301d17504006b8321f71f642039}{messenger\_handle}, to, msg\_string\_final, length) 
      ) \{
593         \hyperlink{logger_8h_a9885ca09ce5f94d936c91a5b0856a024}{LOGGER\_DEBUG}(\textcolor{stringliteral}{"Sent message"});
594         \textcolor{keywordflow}{return} 0;
595     \}
596 
597     \textcolor{keywordflow}{return} -1;
598 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_ae174427d97e924339f9e2a961ec773a1_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_ae174427d97e924339f9e2a961ec773a1_icgraph}
\end{center}
\end{figure}


\hypertarget{msi_8c_aeac54d94bd4b3bfceab3a080cbf5e100}{\index{msi.\+c@{msi.\+c}!send\+\_\+reponse@{send\+\_\+reponse}}
\index{send\+\_\+reponse@{send\+\_\+reponse}!msi.\+c@{msi.\+c}}
\subsubsection[{send\+\_\+reponse}]{\setlength{\rightskip}{0pt plus 5cm}static int send\+\_\+reponse (
\begin{DoxyParamCaption}
\item[{{\bf M\+S\+I\+Session} $\ast$}]{session, }
\item[{{\bf M\+S\+I\+Call} $\ast$}]{call, }
\item[{{\bf M\+S\+I\+Response}}]{response, }
\item[{uint32\+\_\+t}]{to}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{msi_8c_aeac54d94bd4b3bfceab3a080cbf5e100}


Definition at line 600 of file msi.\+c.



References msi\+\_\+new\+\_\+message(), send\+\_\+message(), and Type\+Response.



Referenced by handle\+\_\+recv\+\_\+end(), handle\+\_\+recv\+\_\+invite(), and handle\+\_\+recv\+\_\+reject().


\begin{DoxyCode}
601 \{
602     \hyperlink{struct___m_s_i_message}{MSIMessage} *msg = \hyperlink{msi_8c_aed030e510836ee3cc994f84f06a0cc98}{msi\_new\_message} ( \hyperlink{msi_8c_a6557c179987e0c84ccb97c9f29a302efa44af861e1cb1f54554d3a48a9dfa343b}{TypeResponse}, response );
603     \textcolor{keywordtype}{int} ret = \hyperlink{msi_8c_ae174427d97e924339f9e2a961ec773a1}{send\_message} ( session, call, msg, to );
604     free ( msg );
605     \textcolor{keywordflow}{return} ret;
606 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_aeac54d94bd4b3bfceab3a080cbf5e100_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_aeac54d94bd4b3bfceab3a080cbf5e100_icgraph}
\end{center}
\end{figure}


\hypertarget{msi_8c_af3fb90754ded4536f9314f5d48e477e5}{\index{msi.\+c@{msi.\+c}!stringify\+\_\+error@{stringify\+\_\+error}}
\index{stringify\+\_\+error@{stringify\+\_\+error}!msi.\+c@{msi.\+c}}
\subsubsection[{stringify\+\_\+error}]{\setlength{\rightskip}{0pt plus 5cm}static const uint8\+\_\+t$\ast$ stringify\+\_\+error (
\begin{DoxyParamCaption}
\item[{{\bf M\+S\+I\+Call\+Error}}]{error\+\_\+code}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{msi_8c_af3fb90754ded4536f9314f5d48e477e5}
Stringify error code. 

Definition at line 565 of file msi.\+c.



Referenced by send\+\_\+error().


\begin{DoxyCode}
566 \{
567     \textcolor{keyword}{static} \textcolor{keyword}{const} uint8\_t *strings[] = \{
568         ( uint8\_t *) \textcolor{stringliteral}{""},
569         ( uint8\_t *) \textcolor{stringliteral}{"Using dead call"},
570         ( uint8\_t *) \textcolor{stringliteral}{"Call id not set to any call"},
571         ( uint8\_t *) \textcolor{stringliteral}{"Call id not available"},
572         ( uint8\_t *) \textcolor{stringliteral}{"No active call in session"},
573         ( uint8\_t *) \textcolor{stringliteral}{"No Crypto-key set"},
574         ( uint8\_t *) \textcolor{stringliteral}{"Callee busy"}
575     \};
576 
577     \textcolor{keywordflow}{return} strings[error\_code];
578 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_af3fb90754ded4536f9314f5d48e477e5_icgraph}
\end{center}
\end{figure}


\hypertarget{msi_8c_acab20b1c203cf44d500df2307b62ae9c}{\index{msi.\+c@{msi.\+c}!t\+\_\+randomstr@{t\+\_\+randomstr}}
\index{t\+\_\+randomstr@{t\+\_\+randomstr}!msi.\+c@{msi.\+c}}
\subsubsection[{t\+\_\+randomstr}]{\setlength{\rightskip}{0pt plus 5cm}static void t\+\_\+randomstr (
\begin{DoxyParamCaption}
\item[{uint8\+\_\+t $\ast$}]{str, }
\item[{uint32\+\_\+t}]{size}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{msi_8c_acab20b1c203cf44d500df2307b62ae9c}
Generate {\itshape random} alphanumerical string. 

Definition at line 528 of file msi.\+c.



References L\+O\+G\+G\+E\+R\+\_\+\+D\+E\+B\+U\+G, and random\+\_\+int().



Referenced by msi\+\_\+invite().


\begin{DoxyCode}
529 \{
530     \textcolor{keywordflow}{if} (str == NULL) \{
531         \hyperlink{logger_8h_a9885ca09ce5f94d936c91a5b0856a024}{LOGGER\_DEBUG}(\textcolor{stringliteral}{"Empty destination!"});
532         \textcolor{keywordflow}{return};
533     \}
534 
535     \textcolor{keyword}{static} \textcolor{keyword}{const} uint8\_t \_bytes[] =
536         \textcolor{stringliteral}{"0123456789"}
537         \textcolor{stringliteral}{"ABCDEFGHIJKLMNOPQRSTUVWXYZ"}
538         \textcolor{stringliteral}{"abcdefghijklmnopqrstuvwxyz"};
539 
540     uint32\_t \_it = 0;
541 
542     \textcolor{keywordflow}{for} ( ; \_it < size; \_it++ ) \{
543         str[\_it] = \_bytes[ \hyperlink{crypto__core_8c_a5f13cbe4c46d8801e2c7467068f87306}{random\_int}() % 61 ];
544     \}
545 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=249pt]{d2/d9b/msi_8c_acab20b1c203cf44d500df2307b62ae9c_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_acab20b1c203cf44d500df2307b62ae9c_icgraph}
\end{center}
\end{figure}


\hypertarget{msi_8c_abf7deacfacdcb5b7cc4cfc163583c40d}{\index{msi.\+c@{msi.\+c}!terminate\+\_\+call@{terminate\+\_\+call}}
\index{terminate\+\_\+call@{terminate\+\_\+call}!msi.\+c@{msi.\+c}}
\subsubsection[{terminate\+\_\+call}]{\setlength{\rightskip}{0pt plus 5cm}static int terminate\+\_\+call (
\begin{DoxyParamCaption}
\item[{{\bf M\+S\+I\+Session} $\ast$}]{session, }
\item[{{\bf M\+S\+I\+Call} $\ast$}]{call}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{msi_8c_abf7deacfacdcb5b7cc4cfc163583c40d}


Definition at line 753 of file msi.\+c.



References \+\_\+\+M\+S\+I\+Call\+::call\+\_\+idx, \+\_\+\+M\+S\+I\+Session\+::calls, \+\_\+\+M\+S\+I\+Call\+::csettings\+\_\+peer, L\+O\+G\+G\+E\+R\+\_\+\+D\+E\+B\+U\+G, L\+O\+G\+G\+E\+R\+\_\+\+W\+A\+R\+N\+I\+N\+G, \+\_\+\+M\+S\+I\+Call\+::peers, \+\_\+\+M\+S\+I\+Call\+::request\+\_\+timer\+\_\+id, \+\_\+\+M\+S\+I\+Call\+::ringing\+\_\+timer\+\_\+id, \+\_\+\+M\+S\+I\+Session\+::timer\+\_\+handler, and timer\+\_\+release().



Referenced by handle\+\_\+recv\+\_\+cancel(), handle\+\_\+recv\+\_\+end(), handle\+\_\+recv\+\_\+ending(), handle\+\_\+recv\+\_\+error(), handle\+\_\+recv\+\_\+invite(), handle\+\_\+recv\+\_\+reject(), handle\+\_\+recv\+\_\+starting(), handle\+\_\+remote\+\_\+connection\+\_\+change(), msi\+\_\+cancel(), and msi\+\_\+stopcall().


\begin{DoxyCode}
754 \{
755     \textcolor{keywordflow}{if} ( !call ) \{
756         \hyperlink{logger_8h_ab3e970f3c1ecb5b71f17eccee4ebb286}{LOGGER\_WARNING}(\textcolor{stringliteral}{"Tried to terminate non-existing call!"});
757         \textcolor{keywordflow}{return} -1;
758     \}
759 
760     \textcolor{comment}{/* Check event loop and cancel timed events if there are any}
761 \textcolor{comment}{     */}
762     \hyperlink{msi_8c_ab6f36f5852629fabd6e3c85451e5be65}{timer\_release} ( session->\hyperlink{struct___m_s_i_session_a06ab765308a606d809c4c2a2c71710ce}{timer\_handler}, call->
      \hyperlink{struct___m_s_i_call_a8ccfd1cd9f807007763f41eafd801130}{request\_timer\_id});
763     \hyperlink{msi_8c_ab6f36f5852629fabd6e3c85451e5be65}{timer\_release} ( session->\hyperlink{struct___m_s_i_session_a06ab765308a606d809c4c2a2c71710ce}{timer\_handler}, call->
      \hyperlink{struct___m_s_i_call_a94fdc66dbd509ba4e89edcedb8e11022}{ringing\_timer\_id});
764 
765     session->\hyperlink{struct___m_s_i_session_ac40fee673bae4030b812579c57389a02}{calls}[call->\hyperlink{struct___m_s_i_call_ad6b287fd08a0cc466cd41bd2e76d5808}{call\_idx}] = NULL;
766 
767     \hyperlink{logger_8h_a9885ca09ce5f94d936c91a5b0856a024}{LOGGER\_DEBUG}(\textcolor{stringliteral}{"Terminated call id: %d"}, call->\hyperlink{struct___m_s_i_call_ad6b287fd08a0cc466cd41bd2e76d5808}{call\_idx});
768 
769     free ( call->\hyperlink{struct___m_s_i_call_a3b7fc70c2772bbdc453eeff763fc0b4c}{csettings\_peer} );
770     free ( call->\hyperlink{struct___m_s_i_call_a55d2568491d616f7fef07bc7137c8c23}{peers} );
771     free ( call );
772 
773     \textcolor{keywordflow}{return} 0;
774 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=268pt]{d2/d9b/msi_8c_abf7deacfacdcb5b7cc4cfc163583c40d_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_abf7deacfacdcb5b7cc4cfc163583c40d_icgraph}
\end{center}
\end{figure}


\hypertarget{msi_8c_a0a093063a8a2e48ca88d8d47234415cb}{\index{msi.\+c@{msi.\+c}!timer\+\_\+alloc@{timer\+\_\+alloc}}
\index{timer\+\_\+alloc@{timer\+\_\+alloc}!msi.\+c@{msi.\+c}}
\subsubsection[{timer\+\_\+alloc}]{\setlength{\rightskip}{0pt plus 5cm}static int timer\+\_\+alloc (
\begin{DoxyParamCaption}
\item[{{\bf M\+S\+I\+Session} $\ast$}]{session, }
\item[{void($\ast$)({\bf Timer} $\ast$)}]{func, }
\item[{int}]{call\+\_\+idx, }
\item[{uint32\+\_\+t}]{timeout}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{msi_8c_a0a093063a8a2e48ca88d8d47234415cb}


Definition at line 444 of file msi.\+c.



References \+\_\+\+Timer\+::call\+\_\+idx, current\+\_\+time\+\_\+monotonic(), \+\_\+\+Timer\+::func, i, \+\_\+\+Timer\+::id, L\+O\+G\+G\+E\+R\+\_\+\+D\+E\+B\+U\+G, L\+O\+G\+G\+E\+R\+\_\+\+E\+R\+R\+O\+R, L\+O\+G\+G\+E\+R\+\_\+\+W\+A\+R\+N\+I\+N\+G, \+\_\+\+Timer\+Handler\+::max\+\_\+capacity, \+\_\+\+Timer\+::session, \+\_\+\+Timer\+Handler\+::size, \+\_\+\+Timer\+::timeout, \+\_\+\+M\+S\+I\+Session\+::timer\+\_\+handler, and \+\_\+\+Timer\+Handler\+::timers.



Referenced by handle\+\_\+recv\+\_\+ringing(), msi\+\_\+hangup(), msi\+\_\+invite(), and msi\+\_\+reject().


\begin{DoxyCode}
445 \{
446     \textcolor{keyword}{static} \textcolor{keywordtype}{int} timer\_id;
447     \hyperlink{struct___timer_handler}{TimerHandler} *timer\_handler = session->\hyperlink{struct___m_s_i_session_a06ab765308a606d809c4c2a2c71710ce}{timer\_handler};
448 
449     uint32\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i} = 0;
450 
451     \textcolor{keywordflow}{for} (; i < timer\_handler->\hyperlink{struct___timer_handler_a75d656828e87eb82559cb02fa2219d98}{max\_capacity} && timer\_handler->\hyperlink{struct___timer_handler_af6a69553fb8462326147c121a4c3e98c}{timers}[
      \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}]; i ++);
452 
453     \textcolor{keywordflow}{if} (i == timer\_handler->\hyperlink{struct___timer_handler_a75d656828e87eb82559cb02fa2219d98}{max\_capacity}) \{
454         \hyperlink{logger_8h_ab3e970f3c1ecb5b71f17eccee4ebb286}{LOGGER\_WARNING}(\textcolor{stringliteral}{"Maximum capacity reached!"});
455         \textcolor{keywordflow}{return} -1;
456     \}
457 
458     \hyperlink{struct___timer}{Timer} *timer = timer\_handler->\hyperlink{struct___timer_handler_af6a69553fb8462326147c121a4c3e98c}{timers}[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}] = calloc(\textcolor{keyword}{sizeof}(\hyperlink{struct___timer}{Timer}), 1);
459 
460     \textcolor{keywordflow}{if} (timer == NULL) \{
461         \hyperlink{logger_8h_aedad6a1e3ffe0d4cd0992b822ec0eeeb}{LOGGER\_ERROR}(\textcolor{stringliteral}{"Failed to allocate timer!"});
462         \textcolor{keywordflow}{return} -1;
463     \}
464 
465     timer\_handler->\hyperlink{struct___timer_handler_ab2c6b258f02add8fdf4cfc7c371dd772}{size} ++;
466 
467     timer->\hyperlink{struct___timer_a7b75ecf42c49a289b6dd4fefdbf86605}{func} = func;
468     timer->\hyperlink{struct___timer_affcb6f96b80aecebae0f1b157c6242b5}{session} = session;
469     timer->\hyperlink{struct___timer_a1137c8c8a662d51868eda69bd73915d0}{call\_idx} = call\_idx;
470     timer->\hyperlink{struct___timer_a053cdea1d85795444fe1aaa6b277a0ec}{timeout} = timeout + \hyperlink{irc__syncbot_8c_ae8ecaef140b786a2720eadbb85918e81}{current\_time\_monotonic}(); \textcolor{comment}{/* In ms */}
471     ++timer\_id;
472     timer->\hyperlink{struct___timer_a7441ef0865bcb3db9b8064dd7375c1ea}{id} = timer\_id;
473 
474     \textcolor{comment}{/* reorder */}
475     \textcolor{keywordflow}{if} (i) \{
476         int64\_t j = i - 1;
477 
478         \textcolor{keywordflow}{for} (; j >= 0 && timeout < timer\_handler->\hyperlink{struct___timer_handler_af6a69553fb8462326147c121a4c3e98c}{timers}[j]->\hyperlink{struct___timer_a053cdea1d85795444fe1aaa6b277a0ec}{timeout}; j--) \{
479             \hyperlink{struct___timer}{Timer} *tmp = timer\_handler->\hyperlink{struct___timer_handler_af6a69553fb8462326147c121a4c3e98c}{timers}[j];
480             timer\_handler->\hyperlink{struct___timer_handler_af6a69553fb8462326147c121a4c3e98c}{timers}[j] = timer;
481             timer\_handler->\hyperlink{struct___timer_handler_af6a69553fb8462326147c121a4c3e98c}{timers}[j + 1] = tmp;
482         \}
483     \}
484 
485     \hyperlink{logger_8h_a9885ca09ce5f94d936c91a5b0856a024}{LOGGER\_DEBUG}(\textcolor{stringliteral}{"Allocated timer index: %ull timeout: %ull, current size: %ull"}, i, timeout, 
      timer\_handler->\hyperlink{struct___timer_handler_ab2c6b258f02add8fdf4cfc7c371dd772}{size});
486     \textcolor{keywordflow}{return} timer->\hyperlink{struct___timer_a7441ef0865bcb3db9b8064dd7375c1ea}{id};
487 \}
\end{DoxyCode}


Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=301pt]{d2/d9b/msi_8c_a0a093063a8a2e48ca88d8d47234415cb_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_a0a093063a8a2e48ca88d8d47234415cb_icgraph}
\end{center}
\end{figure}


\hypertarget{msi_8c_ab6f36f5852629fabd6e3c85451e5be65}{\index{msi.\+c@{msi.\+c}!timer\+\_\+release@{timer\+\_\+release}}
\index{timer\+\_\+release@{timer\+\_\+release}!msi.\+c@{msi.\+c}}
\subsubsection[{timer\+\_\+release}]{\setlength{\rightskip}{0pt plus 5cm}static int timer\+\_\+release (
\begin{DoxyParamCaption}
\item[{{\bf Timer\+Handler} $\ast$}]{timers\+\_\+container, }
\item[{int}]{id}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{msi_8c_ab6f36f5852629fabd6e3c85451e5be65}


Definition at line 489 of file msi.\+c.



References i, L\+O\+G\+G\+E\+R\+\_\+\+D\+E\+B\+U\+G, L\+O\+G\+G\+E\+R\+\_\+\+W\+A\+R\+N\+I\+N\+G, \+\_\+\+Timer\+Handler\+::max\+\_\+capacity, \+\_\+\+Timer\+Handler\+::size, and \+\_\+\+Timer\+Handler\+::timers.



Referenced by handle\+\_\+recv\+\_\+starting(), msi\+\_\+do(), msi\+\_\+handle\+\_\+packet(), and terminate\+\_\+call().


\begin{DoxyCode}
490 \{
491     \hyperlink{struct___timer}{Timer} **timed\_events = timers\_container->\hyperlink{struct___timer_handler_af6a69553fb8462326147c121a4c3e98c}{timers};
492 
493     uint32\_t \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
494     \textcolor{keywordtype}{int} rc = -1;
495 
496     \textcolor{keywordflow}{for} (i = 0; i < timers\_container->\hyperlink{struct___timer_handler_a75d656828e87eb82559cb02fa2219d98}{max\_capacity}; ++\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}) \{
497         \textcolor{keywordflow}{if} (timed\_events[i] && timed\_events[i]->\textcolor{keywordtype}{id} == \textcolor{keywordtype}{id}) \{
498             rc = \hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i};
499             \textcolor{keywordflow}{break};
500         \}
501     \}
502 
503     \textcolor{keywordflow}{if} (rc == -1) \{
504         \hyperlink{logger_8h_ab3e970f3c1ecb5b71f17eccee4ebb286}{LOGGER\_WARNING}(\textcolor{stringliteral}{"No event with id: %d"}, \textcolor{keywordtype}{id});
505         \textcolor{keywordflow}{return} -1;
506     \}
507 
508     free(timed\_events[rc]);
509 
510     timed\_events[rc] = NULL;
511 
512     i = rc + 1;
513 
514     \textcolor{keywordflow}{for} (; i < timers\_container->\hyperlink{struct___timer_handler_a75d656828e87eb82559cb02fa2219d98}{max\_capacity} && timed\_events[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}]; i ++) \{
515         timed\_events[i - 1] = timed\_events[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}];
516         timed\_events[\hyperlink{toxav__many__test_8c_acb559820d9ca11295b4500f179ef6392}{i}] = NULL;
517     \}
518 
519     timers\_container->\hyperlink{struct___timer_handler_ab2c6b258f02add8fdf4cfc7c371dd772}{size}--;
520 
521     \hyperlink{logger_8h_a9885ca09ce5f94d936c91a5b0856a024}{LOGGER\_DEBUG}(\textcolor{stringliteral}{"Popped id: %d, current size: %ull "}, \textcolor{keywordtype}{id}, timers\_container->
      \hyperlink{struct___timer_handler_ab2c6b258f02add8fdf4cfc7c371dd772}{size});
522     \textcolor{keywordflow}{return} 0;
523 \}
\end{DoxyCode}


Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d2/d9b/msi_8c_ab6f36f5852629fabd6e3c85451e5be65_icgraph}
\end{center}
\end{figure}


